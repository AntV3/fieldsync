const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SignatureLinkGenerator-I5rscaL1.js","assets/icons-DpyUM8B6.js","assets/react-DXGY7bZi.js","assets/pdf-aQqpMATS.js","assets/supabase-VuevzHjS.js","assets/TMClientSignature-DYw0qox2.js","assets/Dashboard-CI_COe-0.js","assets/corCalculations-D9qkkIbo.js","assets/Setup-Cqwt7kNa.js","assets/BrandingSettings-D7uCxP-R.js","assets/PricingManager-CboiK1Nm.js","assets/PublicView-CClRK6vh.js","assets/SignaturePage-xBem7Os3.js","assets/MembershipManager-DJ_mJtBS.js"])))=>i.map(i=>d[i]);
import{r as N,H as _n,B as Sg,S as ih,M as oh,T as Di,C as al,G as Ng,F as rs,a as Hc,b as Eg,c as Ci,d as Ca,L as rl,e as Cg,f as $c,g as qg,U as Dg,W as Tg,Z as Ag,P as Lc,R as Yf,h as ch,i as kg,j as Og,k as zg,l as Wc,m as Gf,n as Bc,X as Mg,o as Rg,p as Ug,q as uh,s as dh,t as Hg,u as Lg,v as Bg,w as Yg,x as el,A as as,D as Gg,y as mh,I as Qg,z as Xg,E as Vg,J as Qf,K as Zg,N as Kg,O as Jg,Q as Fg}from"./icons-DpyUM8B6.js";import{r as $g,b as Wg,a as Pg}from"./react-DXGY7bZi.js";import{_ as sr}from"./pdf-aQqpMATS.js";import{c as fh}from"./supabase-VuevzHjS.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))o(d);new MutationObserver(d=>{for(const m of d)if(m.type==="childList")for(const h of m.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function i(d){const m={};return d.integrity&&(m.integrity=d.integrity),d.referrerPolicy&&(m.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?m.credentials="include":d.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function o(d){if(d.ep)return;d.ep=!0;const m=i(d);fetch(d.href,m)}})();var Yc={exports:{}},Ws={};var Xf;function Ig(){if(Xf)return Ws;Xf=1;var n=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function i(o,d,m){var h=null;if(m!==void 0&&(h=""+m),d.key!==void 0&&(h=""+d.key),"key"in d){m={};for(var g in d)g!=="key"&&(m[g]=d[g])}else m=d;return d=m.ref,{$$typeof:n,type:o,key:h,ref:d!==void 0?d:null,props:m}}return Ws.Fragment=l,Ws.jsx=i,Ws.jsxs=i,Ws}var Vf;function e_(){return Vf||(Vf=1,Yc.exports=Ig()),Yc.exports}var s=e_(),Gc={exports:{}},Ps={},Qc={exports:{}},Xc={};var Zf;function t_(){return Zf||(Zf=1,(function(n){function l(D,Q){var te=D.length;D.push(Q);e:for(;0<te;){var G=te-1>>>1,R=D[G];if(0<d(R,Q))D[G]=Q,D[te]=R,te=G;else break e}}function i(D){return D.length===0?null:D[0]}function o(D){if(D.length===0)return null;var Q=D[0],te=D.pop();if(te!==Q){D[0]=te;e:for(var G=0,R=D.length,ie=R>>>1;G<ie;){var P=2*(G+1)-1,_e=D[P],Ne=P+1,et=D[Ne];if(0>d(_e,te))Ne<R&&0>d(et,_e)?(D[G]=et,D[Ne]=te,G=Ne):(D[G]=_e,D[P]=te,G=P);else if(Ne<R&&0>d(et,te))D[G]=et,D[Ne]=te,G=Ne;else break e}}return Q}function d(D,Q){var te=D.sortIndex-Q.sortIndex;return te!==0?te:D.id-Q.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var m=performance;n.unstable_now=function(){return m.now()}}else{var h=Date,g=h.now();n.unstable_now=function(){return h.now()-g}}var b=[],O=[],H=1,x=null,X=3,re=!1,F=!1,$=!1,M=!1,K=typeof setTimeout=="function"?setTimeout:null,se=typeof clearTimeout=="function"?clearTimeout:null,le=typeof setImmediate<"u"?setImmediate:null;function ue(D){for(var Q=i(O);Q!==null;){if(Q.callback===null)o(O);else if(Q.startTime<=D)o(O),Q.sortIndex=Q.expirationTime,l(b,Q);else break;Q=i(O)}}function we(D){if($=!1,ue(D),!F)if(i(b)!==null)F=!0,xe||(xe=!0,W());else{var Q=i(O);Q!==null&&ve(we,Q.startTime-D)}}var xe=!1,Le=-1,Qe=5,Me=-1;function Ie(){return M?!0:!(n.unstable_now()-Me<Qe)}function Ke(){if(M=!1,xe){var D=n.unstable_now();Me=D;var Q=!0;try{e:{F=!1,$&&($=!1,se(Le),Le=-1),re=!0;var te=X;try{t:{for(ue(D),x=i(b);x!==null&&!(x.expirationTime>D&&Ie());){var G=x.callback;if(typeof G=="function"){x.callback=null,X=x.priorityLevel;var R=G(x.expirationTime<=D);if(D=n.unstable_now(),typeof R=="function"){x.callback=R,ue(D),Q=!0;break t}x===i(b)&&o(b),ue(D)}else o(b);x=i(b)}if(x!==null)Q=!0;else{var ie=i(O);ie!==null&&ve(we,ie.startTime-D),Q=!1}}break e}finally{x=null,X=te,re=!1}Q=void 0}}finally{Q?W():xe=!1}}}var W;if(typeof le=="function")W=function(){le(Ke)};else if(typeof MessageChannel<"u"){var ye=new MessageChannel,Ae=ye.port2;ye.port1.onmessage=Ke,W=function(){Ae.postMessage(null)}}else W=function(){K(Ke,0)};function ve(D,Q){Le=K(function(){D(n.unstable_now())},Q)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(D){D.callback=null},n.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Qe=0<D?Math.floor(1e3/D):5},n.unstable_getCurrentPriorityLevel=function(){return X},n.unstable_next=function(D){switch(X){case 1:case 2:case 3:var Q=3;break;default:Q=X}var te=X;X=Q;try{return D()}finally{X=te}},n.unstable_requestPaint=function(){M=!0},n.unstable_runWithPriority=function(D,Q){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var te=X;X=D;try{return Q()}finally{X=te}},n.unstable_scheduleCallback=function(D,Q,te){var G=n.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?G+te:G):te=G,D){case 1:var R=-1;break;case 2:R=250;break;case 5:R=1073741823;break;case 4:R=1e4;break;default:R=5e3}return R=te+R,D={id:H++,callback:Q,priorityLevel:D,startTime:te,expirationTime:R,sortIndex:-1},te>G?(D.sortIndex=te,l(O,D),i(b)===null&&D===i(O)&&($?(se(Le),Le=-1):$=!0,ve(we,te-G))):(D.sortIndex=R,l(b,D),F||re||(F=!0,xe||(xe=!0,W()))),D},n.unstable_shouldYield=Ie,n.unstable_wrapCallback=function(D){var Q=X;return function(){var te=X;X=Q;try{return D.apply(this,arguments)}finally{X=te}}}})(Xc)),Xc}var Kf;function a_(){return Kf||(Kf=1,Qc.exports=t_()),Qc.exports}var Jf;function r_(){if(Jf)return Ps;Jf=1;var n=a_(),l=$g(),i=Wg();function o(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function d(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function m(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(a=t.return),e=t.return;while(e)}return t.tag===3?a:null}function h(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function g(e){if(e.tag===31){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function b(e){if(m(e)!==e)throw Error(o(188))}function O(e){var t=e.alternate;if(!t){if(t=m(e),t===null)throw Error(o(188));return t!==e?null:e}for(var a=e,r=t;;){var c=a.return;if(c===null)break;var u=c.alternate;if(u===null){if(r=c.return,r!==null){a=r;continue}break}if(c.child===u.child){for(u=c.child;u;){if(u===a)return b(c),e;if(u===r)return b(c),t;u=u.sibling}throw Error(o(188))}if(a.return!==r.return)a=c,r=u;else{for(var f=!1,_=c.child;_;){if(_===a){f=!0,a=c,r=u;break}if(_===r){f=!0,r=c,a=u;break}_=_.sibling}if(!f){for(_=u.child;_;){if(_===a){f=!0,a=u,r=c;break}if(_===r){f=!0,r=u,a=c;break}_=_.sibling}if(!f)throw Error(o(189))}}if(a.alternate!==r)throw Error(o(190))}if(a.tag!==3)throw Error(o(188));return a.stateNode.current===a?e:t}function H(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=H(e),t!==null)return t;e=e.sibling}return null}var x=Object.assign,X=Symbol.for("react.element"),re=Symbol.for("react.transitional.element"),F=Symbol.for("react.portal"),$=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),K=Symbol.for("react.profiler"),se=Symbol.for("react.consumer"),le=Symbol.for("react.context"),ue=Symbol.for("react.forward_ref"),we=Symbol.for("react.suspense"),xe=Symbol.for("react.suspense_list"),Le=Symbol.for("react.memo"),Qe=Symbol.for("react.lazy"),Me=Symbol.for("react.activity"),Ie=Symbol.for("react.memo_cache_sentinel"),Ke=Symbol.iterator;function W(e){return e===null||typeof e!="object"?null:(e=Ke&&e[Ke]||e["@@iterator"],typeof e=="function"?e:null)}var ye=Symbol.for("react.client.reference");function Ae(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===ye?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case $:return"Fragment";case K:return"Profiler";case M:return"StrictMode";case we:return"Suspense";case xe:return"SuspenseList";case Me:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case F:return"Portal";case le:return e.displayName||"Context";case se:return(e._context.displayName||"Context")+".Consumer";case ue:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Le:return t=e.displayName||null,t!==null?t:Ae(e.type)||"Memo";case Qe:t=e._payload,e=e._init;try{return Ae(e(t))}catch{}}return null}var ve=Array.isArray,D=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},G=[],R=-1;function ie(e){return{current:e}}function P(e){0>R||(e.current=G[R],G[R]=null,R--)}function _e(e,t){R++,G[R]=e.current,e.current=t}var Ne=ie(null),et=ie(null),qe=ie(null),J=ie(null);function ee(e,t){switch(_e(qe,t),_e(et,e),_e(Ne,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?uf(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=uf(t),e=df(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}P(Ne),_e(Ne,e)}function je(){P(Ne),P(et),P(qe)}function Te(e){e.memoizedState!==null&&_e(J,e);var t=Ne.current,a=df(t,e.type);t!==a&&(_e(et,e),_e(Ne,a))}function tt(e){et.current===e&&(P(Ne),P(et)),J.current===e&&(P(J),Ks._currentValue=te)}var We,lt;function it(e){if(We===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);We=t&&t[1]||"",lt=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+We+e+lt}var Ht=!1;function dt(e,t){if(!e||Ht)return"";Ht=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var Y=function(){throw Error()};if(Object.defineProperty(Y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Y,[])}catch(z){var k=z}Reflect.construct(e,[],Y)}else{try{Y.call()}catch(z){k=z}e.call(Y.prototype)}}else{try{throw Error()}catch(z){k=z}(Y=e())&&typeof Y.catch=="function"&&Y.catch(function(){})}}catch(z){if(z&&k&&typeof z.stack=="string")return[z.stack,k.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var c=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");c&&c.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var u=r.DetermineComponentFrameRoot(),f=u[0],_=u[1];if(f&&_){var j=f.split(`
`),A=_.split(`
`);for(c=r=0;r<j.length&&!j[r].includes("DetermineComponentFrameRoot");)r++;for(;c<A.length&&!A[c].includes("DetermineComponentFrameRoot");)c++;if(r===j.length||c===A.length)for(r=j.length-1,c=A.length-1;1<=r&&0<=c&&j[r]!==A[c];)c--;for(;1<=r&&0<=c;r--,c--)if(j[r]!==A[c]){if(r!==1||c!==1)do if(r--,c--,0>c||j[r]!==A[c]){var L=`
`+j[r].replace(" at new "," at ");return e.displayName&&L.includes("<anonymous>")&&(L=L.replace("<anonymous>",e.displayName)),L}while(1<=r&&0<=c);break}}}finally{Ht=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?it(a):""}function St(e,t){switch(e.tag){case 26:case 27:case 5:return it(e.type);case 16:return it("Lazy");case 13:return e.child!==t&&t!==null?it("Suspense Fallback"):it("Suspense");case 19:return it("SuspenseList");case 0:case 15:return dt(e.type,!1);case 11:return dt(e.type.render,!1);case 1:return dt(e.type,!0);case 31:return it("Activity");default:return""}}function vn(e){try{var t="",a=null;do t+=St(e,a),a=e,e=e.return;while(e);return t}catch(r){return`
Error generating stack: `+r.message+`
`+r.stack}}var ir=Object.prototype.hasOwnProperty,Yr=n.unstable_scheduleCallback,Ra=n.unstable_cancelCallback,or=n.unstable_shouldYield,cr=n.unstable_requestPaint,vt=n.unstable_now,Ua=n.unstable_getCurrentPriorityLevel,Gr=n.unstable_ImmediatePriority,Qr=n.unstable_UserBlockingPriority,ia=n.unstable_NormalPriority,Ha=n.unstable_LowPriority,bt=n.unstable_IdlePriority,La=n.log,Xr=n.unstable_setDisableYieldValue,oa=null,Nt=null;function Lt(e){if(typeof La=="function"&&Xr(e),Nt&&typeof Nt.setStrictMode=="function")try{Nt.setStrictMode(oa,e)}catch{}}var I=Math.clz32?Math.clz32:Vr,bn=Math.log,ae=Math.LN2;function Vr(e){return e>>>=0,e===0?32:31-(bn(e)/ae|0)|0}var ur=256,Mt=262144,dr=4194304;function ot(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Et(e,t,a){var r=e.pendingLanes;if(r===0)return 0;var c=0,u=e.suspendedLanes,f=e.pingedLanes;e=e.warmLanes;var _=r&134217727;return _!==0?(r=_&~u,r!==0?c=ot(r):(f&=_,f!==0?c=ot(f):a||(a=_&~e,a!==0&&(c=ot(a))))):(_=r&~u,_!==0?c=ot(_):f!==0?c=ot(f):a||(a=r&~e,a!==0&&(c=ot(a)))),c===0?0:t!==0&&t!==c&&(t&u)===0&&(u=c&-c,a=t&-t,u>=a||u===32&&(a&4194048)!==0)?t:c}function Ft(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function jn(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function V(){var e=dr;return dr<<=1,(dr&62914560)===0&&(dr=4194304),e}function Bt(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function at(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function mr(e,t,a,r,c,u){var f=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var _=e.entanglements,j=e.expirationTimes,A=e.hiddenUpdates;for(a=f&~a;0<a;){var L=31-I(a),Y=1<<L;_[L]=0,j[L]=-1;var k=A[L];if(k!==null)for(A[L]=null,L=0;L<k.length;L++){var z=k[L];z!==null&&(z.lane&=-536870913)}a&=~Y}r!==0&&fr(e,r,0),u!==0&&c===0&&e.tag!==0&&(e.suspendedLanes|=u&~(f&~t))}function fr(e,t,a){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-I(t);e.entangledLanes|=t,e.entanglements[r]=e.entanglements[r]|1073741824|a&261930}function wn(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var r=31-I(a),c=1<<r;c&t|e[r]&t&&(e[r]|=t),a&=~c}}function sl(e,t){var a=t&-t;return a=(a&42)!==0?1:ns(a),(a&(e.suspendedLanes|t))!==0?0:a}function ns(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Zr(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function ll(){var e=Q.p;return e!==0?e:(e=window.event,e===void 0?32:zf(e.type))}function il(e,t){var a=Q.p;try{return Q.p=e,t()}finally{Q.p=a}}var qa=Math.random().toString(36).slice(2),jt="__reactFiber$"+qa,Rt="__reactProps$"+qa,hr="__reactContainer$"+qa,ca="__reactEvents$"+qa,Ai="__reactListeners$"+qa,ki="__reactHandles$"+qa,Ba="__reactResources$"+qa,Kr="__reactMarker$"+qa;function ss(e){delete e[jt],delete e[Rt],delete e[ca],delete e[Ai],delete e[ki]}function $t(e){var t=e[jt];if(t)return t;for(var a=e.parentNode;a;){if(t=a[hr]||a[jt]){if(a=t.alternate,t.child!==null||a!==null&&a.child!==null)for(e=yf(e);e!==null;){if(a=e[jt])return a;e=yf(e)}return t}e=a,a=e.parentNode}return null}function pr(e){if(e=e[jt]||e[hr]){var t=e.tag;if(t===5||t===6||t===13||t===31||t===26||t===27||t===3)return e}return null}function gr(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(o(33))}function Dt(e){var t=e[Ba];return t||(t=e[Ba]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function mt(e){e[Kr]=!0}var ol=new Set,ls={};function ua(e,t){Da(e,t),Da(e+"Capture",t)}function Da(e,t){for(ls[e]=t,e=0;e<t.length;e++)ol.add(t[e])}var Oi=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),cl={},xn={};function zi(e){return ir.call(xn,e)?!0:ir.call(cl,e)?!1:Oi.test(e)?xn[e]=!0:(cl[e]=!0,!1)}function Sn(e,t,a){if(zi(t))if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var r=t.toLowerCase().slice(0,5);if(r!=="data-"&&r!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+a)}}function Wt(e,t,a){if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+a)}}function da(e,t,a,r){if(r===null)e.removeAttribute(a);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(t,a,""+r)}}function Yt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function is(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function _r(e,t,a){var r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var c=r.get,u=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(f){a=""+f,u.call(this,f)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return a},setValue:function(f){a=""+f},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ta(e){if(!e._valueTracker){var t=is(e)?"checked":"value";e._valueTracker=_r(e,t,""+e[t])}}function Ya(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),r="";return e&&(r=is(e)?e.checked?"true":"false":e.value),e=r,e!==a?(t.setValue(e),!0):!1}function Aa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var Jr=/[\n"\\]/g;function Ct(e){return e.replace(Jr,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function Ga(e,t,a,r,c,u,f,_){e.name="",f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"?e.type=f:e.removeAttribute("type"),t!=null?f==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+Yt(t)):e.value!==""+Yt(t)&&(e.value=""+Yt(t)):f!=="submit"&&f!=="reset"||e.removeAttribute("value"),t!=null?os(e,f,Yt(t)):a!=null?os(e,f,Yt(a)):r!=null&&e.removeAttribute("value"),c==null&&u!=null&&(e.defaultChecked=!!u),c!=null&&(e.checked=c&&typeof c!="function"&&typeof c!="symbol"),_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"?e.name=""+Yt(_):e.removeAttribute("name")}function Fr(e,t,a,r,c,u,f,_){if(u!=null&&typeof u!="function"&&typeof u!="symbol"&&typeof u!="boolean"&&(e.type=u),t!=null||a!=null){if(!(u!=="submit"&&u!=="reset"||t!=null)){Ta(e);return}a=a!=null?""+Yt(a):"",t=t!=null?""+Yt(t):a,_||t===e.value||(e.value=t),e.defaultValue=t}r=r??c,r=typeof r!="function"&&typeof r!="symbol"&&!!r,e.checked=_?e.checked:!!r,e.defaultChecked=!!r,f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"&&(e.name=f),Ta(e)}function os(e,t,a){t==="number"&&Aa(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function ma(e,t,a,r){if(e=e.options,t){t={};for(var c=0;c<a.length;c++)t["$"+a[c]]=!0;for(a=0;a<e.length;a++)c=t.hasOwnProperty("$"+e[a].value),e[a].selected!==c&&(e[a].selected=c),c&&r&&(e[a].defaultSelected=!0)}else{for(a=""+Yt(a),t=null,c=0;c<e.length;c++){if(e[c].value===a){e[c].selected=!0,r&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function Mi(e,t,a){if(t!=null&&(t=""+Yt(t),t!==e.value&&(e.value=t),a==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=a!=null?""+Yt(a):""}function cs(e,t,a,r){if(t==null){if(r!=null){if(a!=null)throw Error(o(92));if(ve(r)){if(1<r.length)throw Error(o(93));r=r[0]}a=r}a==null&&(a=""),t=a}a=Yt(t),e.defaultValue=a,r=e.textContent,r===a&&r!==""&&r!==null&&(e.value=r),Ta(e)}function xa(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=t;return}}e.textContent=t}var ul=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function dl(e,t,a){var r=t.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?r?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":r?e.setProperty(t,a):typeof a!="number"||a===0||ul.has(t)?t==="float"?e.cssFloat=a:e[t]=(""+a).trim():e[t]=a+"px"}function p(e,t,a){if(t!=null&&typeof t!="object")throw Error(o(62));if(e=e.style,a!=null){for(var r in a)!a.hasOwnProperty(r)||t!=null&&t.hasOwnProperty(r)||(r.indexOf("--")===0?e.setProperty(r,""):r==="float"?e.cssFloat="":e[r]="");for(var c in t)r=t[c],t.hasOwnProperty(c)&&a[c]!==r&&dl(e,c,r)}else for(var u in t)t.hasOwnProperty(u)&&dl(e,u,t[u])}function w(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var C=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),q=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function U(e){return q.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Z(){}var me=null;function pe(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var fe=null,Ee=null;function Tt(e){var t=pr(e);if(t&&(e=t.stateNode)){var a=e[Rt]||null;e:switch(e=t.stateNode,t.type){case"input":if(Ga(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),t=a.name,a.type==="radio"&&t!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+Ct(""+t)+'"][type="radio"]'),t=0;t<a.length;t++){var r=a[t];if(r!==e&&r.form===e.form){var c=r[Rt]||null;if(!c)throw Error(o(90));Ga(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name)}}for(t=0;t<a.length;t++)r=a[t],r.form===e.form&&Ya(r)}break e;case"textarea":Mi(e,a.value,a.defaultValue);break e;case"select":t=a.value,t!=null&&ma(e,!!a.multiple,t,!1)}}}var Ri=!1;function cu(e,t,a){if(Ri)return e(t,a);Ri=!0;try{var r=e(t);return r}finally{if(Ri=!1,(fe!==null||Ee!==null)&&(Pl(),fe&&(t=fe,e=Ee,Ee=fe=null,Tt(t),e)))for(t=0;t<e.length;t++)Tt(e[t])}}function us(e,t){var a=e.stateNode;if(a===null)return null;var r=a[Rt]||null;if(r===null)return null;a=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(o(231,t,typeof a));return a}var Qa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ui=!1;if(Qa)try{var ds={};Object.defineProperty(ds,"passive",{get:function(){Ui=!0}}),window.addEventListener("test",ds,ds),window.removeEventListener("test",ds,ds)}catch{Ui=!1}var yr=null,Hi=null,ml=null;function uu(){if(ml)return ml;var e,t=Hi,a=t.length,r,c="value"in yr?yr.value:yr.textContent,u=c.length;for(e=0;e<a&&t[e]===c[e];e++);var f=a-e;for(r=1;r<=f&&t[a-r]===c[u-r];r++);return ml=c.slice(e,1<r?1-r:void 0)}function fl(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function hl(){return!0}function du(){return!1}function Gt(e){function t(a,r,c,u,f){this._reactName=a,this._targetInst=c,this.type=r,this.nativeEvent=u,this.target=f,this.currentTarget=null;for(var _ in e)e.hasOwnProperty(_)&&(a=e[_],this[_]=a?a(u):u[_]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?hl:du,this.isPropagationStopped=du,this}return x(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=hl)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=hl)},persist:function(){},isPersistent:hl}),t}var $r={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pl=Gt($r),ms=x({},$r,{view:0,detail:0}),wh=Gt(ms),Li,Bi,fs,gl=x({},ms,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Gi,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==fs&&(fs&&e.type==="mousemove"?(Li=e.screenX-fs.screenX,Bi=e.screenY-fs.screenY):Bi=Li=0,fs=e),Li)},movementY:function(e){return"movementY"in e?e.movementY:Bi}}),mu=Gt(gl),xh=x({},gl,{dataTransfer:0}),Sh=Gt(xh),Nh=x({},ms,{relatedTarget:0}),Yi=Gt(Nh),Eh=x({},$r,{animationName:0,elapsedTime:0,pseudoElement:0}),Ch=Gt(Eh),qh=x({},$r,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Dh=Gt(qh),Th=x({},$r,{data:0}),fu=Gt(Th),Ah={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},kh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Oh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zh(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Oh[e])?!!t[e]:!1}function Gi(){return zh}var Mh=x({},ms,{key:function(e){if(e.key){var t=Ah[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=fl(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?kh[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Gi,charCode:function(e){return e.type==="keypress"?fl(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?fl(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Rh=Gt(Mh),Uh=x({},gl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hu=Gt(Uh),Hh=x({},ms,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Gi}),Lh=Gt(Hh),Bh=x({},$r,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yh=Gt(Bh),Gh=x({},gl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Qh=Gt(Gh),Xh=x({},$r,{newState:0,oldState:0}),Vh=Gt(Xh),Zh=[9,13,27,32],Qi=Qa&&"CompositionEvent"in window,hs=null;Qa&&"documentMode"in document&&(hs=document.documentMode);var Kh=Qa&&"TextEvent"in window&&!hs,pu=Qa&&(!Qi||hs&&8<hs&&11>=hs),gu=" ",_u=!1;function yu(e,t){switch(e){case"keyup":return Zh.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function vu(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Nn=!1;function Jh(e,t){switch(e){case"compositionend":return vu(t);case"keypress":return t.which!==32?null:(_u=!0,gu);case"textInput":return e=t.data,e===gu&&_u?null:e;default:return null}}function Fh(e,t){if(Nn)return e==="compositionend"||!Qi&&yu(e,t)?(e=uu(),ml=Hi=yr=null,Nn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return pu&&t.locale!=="ko"?null:t.data;default:return null}}var $h={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bu(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!$h[e.type]:t==="textarea"}function ju(e,t,a,r){fe?Ee?Ee.push(r):Ee=[r]:fe=r,t=si(t,"onChange"),0<t.length&&(a=new pl("onChange","change",null,a,r),e.push({event:a,listeners:t}))}var ps=null,gs=null;function Wh(e){rf(e,0)}function _l(e){var t=gr(e);if(Ya(t))return e}function wu(e,t){if(e==="change")return t}var xu=!1;if(Qa){var Xi;if(Qa){var Vi="oninput"in document;if(!Vi){var Su=document.createElement("div");Su.setAttribute("oninput","return;"),Vi=typeof Su.oninput=="function"}Xi=Vi}else Xi=!1;xu=Xi&&(!document.documentMode||9<document.documentMode)}function Nu(){ps&&(ps.detachEvent("onpropertychange",Eu),gs=ps=null)}function Eu(e){if(e.propertyName==="value"&&_l(gs)){var t=[];ju(t,gs,e,pe(e)),cu(Wh,t)}}function Ph(e,t,a){e==="focusin"?(Nu(),ps=t,gs=a,ps.attachEvent("onpropertychange",Eu)):e==="focusout"&&Nu()}function Ih(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return _l(gs)}function ep(e,t){if(e==="click")return _l(t)}function tp(e,t){if(e==="input"||e==="change")return _l(t)}function ap(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Pt=typeof Object.is=="function"?Object.is:ap;function _s(e,t){if(Pt(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var a=Object.keys(e),r=Object.keys(t);if(a.length!==r.length)return!1;for(r=0;r<a.length;r++){var c=a[r];if(!ir.call(t,c)||!Pt(e[c],t[c]))return!1}return!0}function Cu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function qu(e,t){var a=Cu(e);e=0;for(var r;a;){if(a.nodeType===3){if(r=e+a.textContent.length,e<=t&&r>=t)return{node:a,offset:t-e};e=r}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Cu(a)}}function Du(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Du(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Tu(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=Aa(e.document);t instanceof e.HTMLIFrameElement;){try{var a=typeof t.contentWindow.location.href=="string"}catch{a=!1}if(a)e=t.contentWindow;else break;t=Aa(e.document)}return t}function Zi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var rp=Qa&&"documentMode"in document&&11>=document.documentMode,En=null,Ki=null,ys=null,Ji=!1;function Au(e,t,a){var r=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Ji||En==null||En!==Aa(r)||(r=En,"selectionStart"in r&&Zi(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ys&&_s(ys,r)||(ys=r,r=si(Ki,"onSelect"),0<r.length&&(t=new pl("onSelect","select",null,t,a),e.push({event:t,listeners:r}),t.target=En)))}function Wr(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var Cn={animationend:Wr("Animation","AnimationEnd"),animationiteration:Wr("Animation","AnimationIteration"),animationstart:Wr("Animation","AnimationStart"),transitionrun:Wr("Transition","TransitionRun"),transitionstart:Wr("Transition","TransitionStart"),transitioncancel:Wr("Transition","TransitionCancel"),transitionend:Wr("Transition","TransitionEnd")},Fi={},ku={};Qa&&(ku=document.createElement("div").style,"AnimationEvent"in window||(delete Cn.animationend.animation,delete Cn.animationiteration.animation,delete Cn.animationstart.animation),"TransitionEvent"in window||delete Cn.transitionend.transition);function Pr(e){if(Fi[e])return Fi[e];if(!Cn[e])return e;var t=Cn[e],a;for(a in t)if(t.hasOwnProperty(a)&&a in ku)return Fi[e]=t[a];return e}var Ou=Pr("animationend"),zu=Pr("animationiteration"),Mu=Pr("animationstart"),np=Pr("transitionrun"),sp=Pr("transitionstart"),lp=Pr("transitioncancel"),Ru=Pr("transitionend"),Uu=new Map,$i="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");$i.push("scrollEnd");function Sa(e,t){Uu.set(e,t),ua(t,[e])}var yl=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},fa=[],qn=0,Wi=0;function vl(){for(var e=qn,t=Wi=qn=0;t<e;){var a=fa[t];fa[t++]=null;var r=fa[t];fa[t++]=null;var c=fa[t];fa[t++]=null;var u=fa[t];if(fa[t++]=null,r!==null&&c!==null){var f=r.pending;f===null?c.next=c:(c.next=f.next,f.next=c),r.pending=c}u!==0&&Hu(a,c,u)}}function bl(e,t,a,r){fa[qn++]=e,fa[qn++]=t,fa[qn++]=a,fa[qn++]=r,Wi|=r,e.lanes|=r,e=e.alternate,e!==null&&(e.lanes|=r)}function Pi(e,t,a,r){return bl(e,t,a,r),jl(e)}function Ir(e,t){return bl(e,null,null,t),jl(e)}function Hu(e,t,a){e.lanes|=a;var r=e.alternate;r!==null&&(r.lanes|=a);for(var c=!1,u=e.return;u!==null;)u.childLanes|=a,r=u.alternate,r!==null&&(r.childLanes|=a),u.tag===22&&(e=u.stateNode,e===null||e._visibility&1||(c=!0)),e=u,u=u.return;return e.tag===3?(u=e.stateNode,c&&t!==null&&(c=31-I(a),e=u.hiddenUpdates,r=e[c],r===null?e[c]=[t]:r.push(t),t.lane=a|536870912),u):null}function jl(e){if(50<Bs)throw Bs=0,oc=null,Error(o(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var Dn={};function ip(e,t,a,r){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function It(e,t,a,r){return new ip(e,t,a,r)}function Ii(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Xa(e,t){var a=e.alternate;return a===null?(a=It(e.tag,t,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function Lu(e,t){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,t=a.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function wl(e,t,a,r,c,u){var f=0;if(r=e,typeof e=="function")Ii(e)&&(f=1);else if(typeof e=="string")f=mg(e,a,Ne.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case Me:return e=It(31,a,t,c),e.elementType=Me,e.lanes=u,e;case $:return en(a.children,c,u,t);case M:f=8,c|=24;break;case K:return e=It(12,a,t,c|2),e.elementType=K,e.lanes=u,e;case we:return e=It(13,a,t,c),e.elementType=we,e.lanes=u,e;case xe:return e=It(19,a,t,c),e.elementType=xe,e.lanes=u,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case le:f=10;break e;case se:f=9;break e;case ue:f=11;break e;case Le:f=14;break e;case Qe:f=16,r=null;break e}f=29,a=Error(o(130,e===null?"null":typeof e,"")),r=null}return t=It(f,a,t,c),t.elementType=e,t.type=r,t.lanes=u,t}function en(e,t,a,r){return e=It(7,e,r,t),e.lanes=a,e}function eo(e,t,a){return e=It(6,e,null,t),e.lanes=a,e}function Bu(e){var t=It(18,null,null,0);return t.stateNode=e,t}function to(e,t,a){return t=It(4,e.children!==null?e.children:[],e.key,t),t.lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Yu=new WeakMap;function ha(e,t){if(typeof e=="object"&&e!==null){var a=Yu.get(e);return a!==void 0?a:(t={value:e,source:t,stack:vn(t)},Yu.set(e,t),t)}return{value:e,source:t,stack:vn(t)}}var Tn=[],An=0,xl=null,vs=0,pa=[],ga=0,vr=null,ka=1,Oa="";function Va(e,t){Tn[An++]=vs,Tn[An++]=xl,xl=e,vs=t}function Gu(e,t,a){pa[ga++]=ka,pa[ga++]=Oa,pa[ga++]=vr,vr=e;var r=ka;e=Oa;var c=32-I(r)-1;r&=~(1<<c),a+=1;var u=32-I(t)+c;if(30<u){var f=c-c%5;u=(r&(1<<f)-1).toString(32),r>>=f,c-=f,ka=1<<32-I(t)+c|a<<c|r,Oa=u+e}else ka=1<<u|a<<c|r,Oa=e}function ao(e){e.return!==null&&(Va(e,1),Gu(e,1,0))}function ro(e){for(;e===xl;)xl=Tn[--An],Tn[An]=null,vs=Tn[--An],Tn[An]=null;for(;e===vr;)vr=pa[--ga],pa[ga]=null,Oa=pa[--ga],pa[ga]=null,ka=pa[--ga],pa[ga]=null}function Qu(e,t){pa[ga++]=ka,pa[ga++]=Oa,pa[ga++]=vr,ka=t.id,Oa=t.overflow,vr=e}var At=null,rt=null,He=!1,br=null,_a=!1,no=Error(o(519));function jr(e){var t=Error(o(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw bs(ha(t,e)),no}function Xu(e){var t=e.stateNode,a=e.type,r=e.memoizedProps;switch(t[jt]=e,t[Rt]=r,a){case"dialog":ze("cancel",t),ze("close",t);break;case"iframe":case"object":case"embed":ze("load",t);break;case"video":case"audio":for(a=0;a<Gs.length;a++)ze(Gs[a],t);break;case"source":ze("error",t);break;case"img":case"image":case"link":ze("error",t),ze("load",t);break;case"details":ze("toggle",t);break;case"input":ze("invalid",t),Fr(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0);break;case"select":ze("invalid",t);break;case"textarea":ze("invalid",t),cs(t,r.value,r.defaultValue,r.children)}a=r.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||t.textContent===""+a||r.suppressHydrationWarning===!0||of(t.textContent,a)?(r.popover!=null&&(ze("beforetoggle",t),ze("toggle",t)),r.onScroll!=null&&ze("scroll",t),r.onScrollEnd!=null&&ze("scrollend",t),r.onClick!=null&&(t.onclick=Z),t=!0):t=!1,t||jr(e,!0)}function Vu(e){for(At=e.return;At;)switch(At.tag){case 5:case 31:case 13:_a=!1;return;case 27:case 3:_a=!0;return;default:At=At.return}}function kn(e){if(e!==At)return!1;if(!He)return Vu(e),He=!0,!1;var t=e.tag,a;if((a=t!==3&&t!==27)&&((a=t===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||xc(e.type,e.memoizedProps)),a=!a),a&&rt&&jr(e),Vu(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(317));rt=_f(e)}else if(t===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(317));rt=_f(e)}else t===27?(t=rt,Mr(e.type)?(e=qc,qc=null,rt=e):rt=t):rt=At?va(e.stateNode.nextSibling):null;return!0}function tn(){rt=At=null,He=!1}function so(){var e=br;return e!==null&&(Zt===null?Zt=e:Zt.push.apply(Zt,e),br=null),e}function bs(e){br===null?br=[e]:br.push(e)}var lo=ie(null),an=null,Za=null;function wr(e,t,a){_e(lo,t._currentValue),t._currentValue=a}function Ka(e){e._currentValue=lo.current,P(lo)}function io(e,t,a){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===a)break;e=e.return}}function oo(e,t,a,r){var c=e.child;for(c!==null&&(c.return=e);c!==null;){var u=c.dependencies;if(u!==null){var f=c.child;u=u.firstContext;e:for(;u!==null;){var _=u;u=c;for(var j=0;j<t.length;j++)if(_.context===t[j]){u.lanes|=a,_=u.alternate,_!==null&&(_.lanes|=a),io(u.return,a,e),r||(f=null);break e}u=_.next}}else if(c.tag===18){if(f=c.return,f===null)throw Error(o(341));f.lanes|=a,u=f.alternate,u!==null&&(u.lanes|=a),io(f,a,e),f=null}else f=c.child;if(f!==null)f.return=c;else for(f=c;f!==null;){if(f===e){f=null;break}if(c=f.sibling,c!==null){c.return=f.return,f=c;break}f=f.return}c=f}}function On(e,t,a,r){e=null;for(var c=t,u=!1;c!==null;){if(!u){if((c.flags&524288)!==0)u=!0;else if((c.flags&262144)!==0)break}if(c.tag===10){var f=c.alternate;if(f===null)throw Error(o(387));if(f=f.memoizedProps,f!==null){var _=c.type;Pt(c.pendingProps.value,f.value)||(e!==null?e.push(_):e=[_])}}else if(c===J.current){if(f=c.alternate,f===null)throw Error(o(387));f.memoizedState.memoizedState!==c.memoizedState.memoizedState&&(e!==null?e.push(Ks):e=[Ks])}c=c.return}e!==null&&oo(t,e,a,r),t.flags|=262144}function Sl(e){for(e=e.firstContext;e!==null;){if(!Pt(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function rn(e){an=e,Za=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function kt(e){return Zu(an,e)}function Nl(e,t){return an===null&&rn(e),Zu(e,t)}function Zu(e,t){var a=t._currentValue;if(t={context:t,memoizedValue:a,next:null},Za===null){if(e===null)throw Error(o(308));Za=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Za=Za.next=t;return a}var op=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(a,r){e.push(r)}};this.abort=function(){t.aborted=!0,e.forEach(function(a){return a()})}},cp=n.unstable_scheduleCallback,up=n.unstable_NormalPriority,pt={$$typeof:le,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function co(){return{controller:new op,data:new Map,refCount:0}}function js(e){e.refCount--,e.refCount===0&&cp(up,function(){e.controller.abort()})}var ws=null,uo=0,zn=0,Mn=null;function dp(e,t){if(ws===null){var a=ws=[];uo=0,zn=hc(),Mn={status:"pending",value:void 0,then:function(r){a.push(r)}}}return uo++,t.then(Ku,Ku),t}function Ku(){if(--uo===0&&ws!==null){Mn!==null&&(Mn.status="fulfilled");var e=ws;ws=null,zn=0,Mn=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function mp(e,t){var a=[],r={status:"pending",value:null,reason:null,then:function(c){a.push(c)}};return e.then(function(){r.status="fulfilled",r.value=t;for(var c=0;c<a.length;c++)(0,a[c])(t)},function(c){for(r.status="rejected",r.reason=c,c=0;c<a.length;c++)(0,a[c])(void 0)}),r}var Ju=D.S;D.S=function(e,t){Am=vt(),typeof t=="object"&&t!==null&&typeof t.then=="function"&&dp(e,t),Ju!==null&&Ju(e,t)};var nn=ie(null);function mo(){var e=nn.current;return e!==null?e:Pe.pooledCache}function El(e,t){t===null?_e(nn,nn.current):_e(nn,t.pool)}function Fu(){var e=mo();return e===null?null:{parent:pt._currentValue,pool:e}}var Rn=Error(o(460)),fo=Error(o(474)),Cl=Error(o(542)),ql={then:function(){}};function $u(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Wu(e,t,a){switch(a=e[a],a===void 0?e.push(t):a!==t&&(t.then(Z,Z),t=a),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Iu(e),e;default:if(typeof t.status=="string")t.then(Z,Z);else{if(e=Pe,e!==null&&100<e.shellSuspendCounter)throw Error(o(482));e=t,e.status="pending",e.then(function(r){if(t.status==="pending"){var c=t;c.status="fulfilled",c.value=r}},function(r){if(t.status==="pending"){var c=t;c.status="rejected",c.reason=r}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Iu(e),e}throw ln=t,Rn}}function sn(e){try{var t=e._init;return t(e._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(ln=a,Rn):a}}var ln=null;function Pu(){if(ln===null)throw Error(o(459));var e=ln;return ln=null,e}function Iu(e){if(e===Rn||e===Cl)throw Error(o(483))}var Un=null,xs=0;function Dl(e){var t=xs;return xs+=1,Un===null&&(Un=[]),Wu(Un,e,t)}function Ss(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function Tl(e,t){throw t.$$typeof===X?Error(o(525)):(e=Object.prototype.toString.call(t),Error(o(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function ed(e){function t(E,S){if(e){var T=E.deletions;T===null?(E.deletions=[S],E.flags|=16):T.push(S)}}function a(E,S){if(!e)return null;for(;S!==null;)t(E,S),S=S.sibling;return null}function r(E){for(var S=new Map;E!==null;)E.key!==null?S.set(E.key,E):S.set(E.index,E),E=E.sibling;return S}function c(E,S){return E=Xa(E,S),E.index=0,E.sibling=null,E}function u(E,S,T){return E.index=T,e?(T=E.alternate,T!==null?(T=T.index,T<S?(E.flags|=67108866,S):T):(E.flags|=67108866,S)):(E.flags|=1048576,S)}function f(E){return e&&E.alternate===null&&(E.flags|=67108866),E}function _(E,S,T,B){return S===null||S.tag!==6?(S=eo(T,E.mode,B),S.return=E,S):(S=c(S,T),S.return=E,S)}function j(E,S,T,B){var ge=T.type;return ge===$?L(E,S,T.props.children,B,T.key):S!==null&&(S.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===Qe&&sn(ge)===S.type)?(S=c(S,T.props),Ss(S,T),S.return=E,S):(S=wl(T.type,T.key,T.props,null,E.mode,B),Ss(S,T),S.return=E,S)}function A(E,S,T,B){return S===null||S.tag!==4||S.stateNode.containerInfo!==T.containerInfo||S.stateNode.implementation!==T.implementation?(S=to(T,E.mode,B),S.return=E,S):(S=c(S,T.children||[]),S.return=E,S)}function L(E,S,T,B,ge){return S===null||S.tag!==7?(S=en(T,E.mode,B,ge),S.return=E,S):(S=c(S,T),S.return=E,S)}function Y(E,S,T){if(typeof S=="string"&&S!==""||typeof S=="number"||typeof S=="bigint")return S=eo(""+S,E.mode,T),S.return=E,S;if(typeof S=="object"&&S!==null){switch(S.$$typeof){case re:return T=wl(S.type,S.key,S.props,null,E.mode,T),Ss(T,S),T.return=E,T;case F:return S=to(S,E.mode,T),S.return=E,S;case Qe:return S=sn(S),Y(E,S,T)}if(ve(S)||W(S))return S=en(S,E.mode,T,null),S.return=E,S;if(typeof S.then=="function")return Y(E,Dl(S),T);if(S.$$typeof===le)return Y(E,Nl(E,S),T);Tl(E,S)}return null}function k(E,S,T,B){var ge=S!==null?S.key:null;if(typeof T=="string"&&T!==""||typeof T=="number"||typeof T=="bigint")return ge!==null?null:_(E,S,""+T,B);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case re:return T.key===ge?j(E,S,T,B):null;case F:return T.key===ge?A(E,S,T,B):null;case Qe:return T=sn(T),k(E,S,T,B)}if(ve(T)||W(T))return ge!==null?null:L(E,S,T,B,null);if(typeof T.then=="function")return k(E,S,Dl(T),B);if(T.$$typeof===le)return k(E,S,Nl(E,T),B);Tl(E,T)}return null}function z(E,S,T,B,ge){if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return E=E.get(T)||null,_(S,E,""+B,ge);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case re:return E=E.get(B.key===null?T:B.key)||null,j(S,E,B,ge);case F:return E=E.get(B.key===null?T:B.key)||null,A(S,E,B,ge);case Qe:return B=sn(B),z(E,S,T,B,ge)}if(ve(B)||W(B))return E=E.get(T)||null,L(S,E,B,ge,null);if(typeof B.then=="function")return z(E,S,T,Dl(B),ge);if(B.$$typeof===le)return z(E,S,T,Nl(S,B),ge);Tl(S,B)}return null}function oe(E,S,T,B){for(var ge=null,Be=null,de=S,Ce=S=0,Ue=null;de!==null&&Ce<T.length;Ce++){de.index>Ce?(Ue=de,de=null):Ue=de.sibling;var Ye=k(E,de,T[Ce],B);if(Ye===null){de===null&&(de=Ue);break}e&&de&&Ye.alternate===null&&t(E,de),S=u(Ye,S,Ce),Be===null?ge=Ye:Be.sibling=Ye,Be=Ye,de=Ue}if(Ce===T.length)return a(E,de),He&&Va(E,Ce),ge;if(de===null){for(;Ce<T.length;Ce++)de=Y(E,T[Ce],B),de!==null&&(S=u(de,S,Ce),Be===null?ge=de:Be.sibling=de,Be=de);return He&&Va(E,Ce),ge}for(de=r(de);Ce<T.length;Ce++)Ue=z(de,E,Ce,T[Ce],B),Ue!==null&&(e&&Ue.alternate!==null&&de.delete(Ue.key===null?Ce:Ue.key),S=u(Ue,S,Ce),Be===null?ge=Ue:Be.sibling=Ue,Be=Ue);return e&&de.forEach(function(Br){return t(E,Br)}),He&&Va(E,Ce),ge}function be(E,S,T,B){if(T==null)throw Error(o(151));for(var ge=null,Be=null,de=S,Ce=S=0,Ue=null,Ye=T.next();de!==null&&!Ye.done;Ce++,Ye=T.next()){de.index>Ce?(Ue=de,de=null):Ue=de.sibling;var Br=k(E,de,Ye.value,B);if(Br===null){de===null&&(de=Ue);break}e&&de&&Br.alternate===null&&t(E,de),S=u(Br,S,Ce),Be===null?ge=Br:Be.sibling=Br,Be=Br,de=Ue}if(Ye.done)return a(E,de),He&&Va(E,Ce),ge;if(de===null){for(;!Ye.done;Ce++,Ye=T.next())Ye=Y(E,Ye.value,B),Ye!==null&&(S=u(Ye,S,Ce),Be===null?ge=Ye:Be.sibling=Ye,Be=Ye);return He&&Va(E,Ce),ge}for(de=r(de);!Ye.done;Ce++,Ye=T.next())Ye=z(de,E,Ce,Ye.value,B),Ye!==null&&(e&&Ye.alternate!==null&&de.delete(Ye.key===null?Ce:Ye.key),S=u(Ye,S,Ce),Be===null?ge=Ye:Be.sibling=Ye,Be=Ye);return e&&de.forEach(function(xg){return t(E,xg)}),He&&Va(E,Ce),ge}function $e(E,S,T,B){if(typeof T=="object"&&T!==null&&T.type===$&&T.key===null&&(T=T.props.children),typeof T=="object"&&T!==null){switch(T.$$typeof){case re:e:{for(var ge=T.key;S!==null;){if(S.key===ge){if(ge=T.type,ge===$){if(S.tag===7){a(E,S.sibling),B=c(S,T.props.children),B.return=E,E=B;break e}}else if(S.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===Qe&&sn(ge)===S.type){a(E,S.sibling),B=c(S,T.props),Ss(B,T),B.return=E,E=B;break e}a(E,S);break}else t(E,S);S=S.sibling}T.type===$?(B=en(T.props.children,E.mode,B,T.key),B.return=E,E=B):(B=wl(T.type,T.key,T.props,null,E.mode,B),Ss(B,T),B.return=E,E=B)}return f(E);case F:e:{for(ge=T.key;S!==null;){if(S.key===ge)if(S.tag===4&&S.stateNode.containerInfo===T.containerInfo&&S.stateNode.implementation===T.implementation){a(E,S.sibling),B=c(S,T.children||[]),B.return=E,E=B;break e}else{a(E,S);break}else t(E,S);S=S.sibling}B=to(T,E.mode,B),B.return=E,E=B}return f(E);case Qe:return T=sn(T),$e(E,S,T,B)}if(ve(T))return oe(E,S,T,B);if(W(T)){if(ge=W(T),typeof ge!="function")throw Error(o(150));return T=ge.call(T),be(E,S,T,B)}if(typeof T.then=="function")return $e(E,S,Dl(T),B);if(T.$$typeof===le)return $e(E,S,Nl(E,T),B);Tl(E,T)}return typeof T=="string"&&T!==""||typeof T=="number"||typeof T=="bigint"?(T=""+T,S!==null&&S.tag===6?(a(E,S.sibling),B=c(S,T),B.return=E,E=B):(a(E,S),B=eo(T,E.mode,B),B.return=E,E=B),f(E)):a(E,S)}return function(E,S,T,B){try{xs=0;var ge=$e(E,S,T,B);return Un=null,ge}catch(de){if(de===Rn||de===Cl)throw de;var Be=It(29,de,null,E.mode);return Be.lanes=B,Be.return=E,Be}finally{}}}var on=ed(!0),td=ed(!1),xr=!1;function ho(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function po(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function Sr(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Nr(e,t,a){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,(Xe&2)!==0){var c=r.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),r.pending=t,t=jl(e),Hu(e,null,a),t}return bl(e,r,t,a),jl(e)}function Ns(e,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194048)!==0)){var r=t.lanes;r&=e.pendingLanes,a|=r,t.lanes=a,wn(e,a)}}function go(e,t){var a=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,a===r)){var c=null,u=null;if(a=a.firstBaseUpdate,a!==null){do{var f={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};u===null?c=u=f:u=u.next=f,a=a.next}while(a!==null);u===null?c=u=t:u=u.next=t}else c=u=t;a={baseState:r.baseState,firstBaseUpdate:c,lastBaseUpdate:u,shared:r.shared,callbacks:r.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}var _o=!1;function Es(){if(_o){var e=Mn;if(e!==null)throw e}}function Cs(e,t,a,r){_o=!1;var c=e.updateQueue;xr=!1;var u=c.firstBaseUpdate,f=c.lastBaseUpdate,_=c.shared.pending;if(_!==null){c.shared.pending=null;var j=_,A=j.next;j.next=null,f===null?u=A:f.next=A,f=j;var L=e.alternate;L!==null&&(L=L.updateQueue,_=L.lastBaseUpdate,_!==f&&(_===null?L.firstBaseUpdate=A:_.next=A,L.lastBaseUpdate=j))}if(u!==null){var Y=c.baseState;f=0,L=A=j=null,_=u;do{var k=_.lane&-536870913,z=k!==_.lane;if(z?(Re&k)===k:(r&k)===k){k!==0&&k===zn&&(_o=!0),L!==null&&(L=L.next={lane:0,tag:_.tag,payload:_.payload,callback:null,next:null});e:{var oe=e,be=_;k=t;var $e=a;switch(be.tag){case 1:if(oe=be.payload,typeof oe=="function"){Y=oe.call($e,Y,k);break e}Y=oe;break e;case 3:oe.flags=oe.flags&-65537|128;case 0:if(oe=be.payload,k=typeof oe=="function"?oe.call($e,Y,k):oe,k==null)break e;Y=x({},Y,k);break e;case 2:xr=!0}}k=_.callback,k!==null&&(e.flags|=64,z&&(e.flags|=8192),z=c.callbacks,z===null?c.callbacks=[k]:z.push(k))}else z={lane:k,tag:_.tag,payload:_.payload,callback:_.callback,next:null},L===null?(A=L=z,j=Y):L=L.next=z,f|=k;if(_=_.next,_===null){if(_=c.shared.pending,_===null)break;z=_,_=z.next,z.next=null,c.lastBaseUpdate=z,c.shared.pending=null}}while(!0);L===null&&(j=Y),c.baseState=j,c.firstBaseUpdate=A,c.lastBaseUpdate=L,u===null&&(c.shared.lanes=0),Tr|=f,e.lanes=f,e.memoizedState=Y}}function ad(e,t){if(typeof e!="function")throw Error(o(191,e));e.call(t)}function rd(e,t){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)ad(a[e],t)}var Hn=ie(null),Al=ie(0);function nd(e,t){e=ar,_e(Al,e),_e(Hn,t),ar=e|t.baseLanes}function yo(){_e(Al,ar),_e(Hn,Hn.current)}function vo(){ar=Al.current,P(Hn),P(Al)}var ea=ie(null),ya=null;function Er(e){var t=e.alternate;_e(ft,ft.current&1),_e(ea,e),ya===null&&(t===null||Hn.current!==null||t.memoizedState!==null)&&(ya=e)}function bo(e){_e(ft,ft.current),_e(ea,e),ya===null&&(ya=e)}function sd(e){e.tag===22?(_e(ft,ft.current),_e(ea,e),ya===null&&(ya=e)):Cr()}function Cr(){_e(ft,ft.current),_e(ea,ea.current)}function ta(e){P(ea),ya===e&&(ya=null),P(ft)}var ft=ie(0);function kl(e){for(var t=e;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||Ec(a)||Cc(a)))return t}else if(t.tag===19&&(t.memoizedProps.revealOrder==="forwards"||t.memoizedProps.revealOrder==="backwards"||t.memoizedProps.revealOrder==="unstable_legacy-backwards"||t.memoizedProps.revealOrder==="together")){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Ja=0,Se=null,Je=null,gt=null,Ol=!1,Ln=!1,cn=!1,zl=0,qs=0,Bn=null,fp=0;function ct(){throw Error(o(321))}function jo(e,t){if(t===null)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!Pt(e[a],t[a]))return!1;return!0}function wo(e,t,a,r,c,u){return Ja=u,Se=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,D.H=e===null||e.memoizedState===null?Gd:Uo,cn=!1,u=a(r,c),cn=!1,Ln&&(u=id(t,a,r,c)),ld(e),u}function ld(e){D.H=As;var t=Je!==null&&Je.next!==null;if(Ja=0,gt=Je=Se=null,Ol=!1,qs=0,Bn=null,t)throw Error(o(300));e===null||_t||(e=e.dependencies,e!==null&&Sl(e)&&(_t=!0))}function id(e,t,a,r){Se=e;var c=0;do{if(Ln&&(Bn=null),qs=0,Ln=!1,25<=c)throw Error(o(301));if(c+=1,gt=Je=null,e.updateQueue!=null){var u=e.updateQueue;u.lastEffect=null,u.events=null,u.stores=null,u.memoCache!=null&&(u.memoCache.index=0)}D.H=Qd,u=t(a,r)}while(Ln);return u}function hp(){var e=D.H,t=e.useState()[0];return t=typeof t.then=="function"?Ds(t):t,e=e.useState()[0],(Je!==null?Je.memoizedState:null)!==e&&(Se.flags|=1024),t}function xo(){var e=zl!==0;return zl=0,e}function So(e,t,a){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a}function No(e){if(Ol){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}Ol=!1}Ja=0,gt=Je=Se=null,Ln=!1,qs=zl=0,Bn=null}function Ut(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gt===null?Se.memoizedState=gt=e:gt=gt.next=e,gt}function ht(){if(Je===null){var e=Se.alternate;e=e!==null?e.memoizedState:null}else e=Je.next;var t=gt===null?Se.memoizedState:gt.next;if(t!==null)gt=t,Je=e;else{if(e===null)throw Se.alternate===null?Error(o(467)):Error(o(310));Je=e,e={memoizedState:Je.memoizedState,baseState:Je.baseState,baseQueue:Je.baseQueue,queue:Je.queue,next:null},gt===null?Se.memoizedState=gt=e:gt=gt.next=e}return gt}function Ml(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ds(e){var t=qs;return qs+=1,Bn===null&&(Bn=[]),e=Wu(Bn,e,t),t=Se,(gt===null?t.memoizedState:gt.next)===null&&(t=t.alternate,D.H=t===null||t.memoizedState===null?Gd:Uo),e}function Rl(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Ds(e);if(e.$$typeof===le)return kt(e)}throw Error(o(438,String(e)))}function Eo(e){var t=null,a=Se.updateQueue;if(a!==null&&(t=a.memoCache),t==null){var r=Se.alternate;r!==null&&(r=r.updateQueue,r!==null&&(r=r.memoCache,r!=null&&(t={data:r.data.map(function(c){return c.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),a===null&&(a=Ml(),Se.updateQueue=a),a.memoCache=t,a=t.data[t.index],a===void 0)for(a=t.data[t.index]=Array(e),r=0;r<e;r++)a[r]=Ie;return t.index++,a}function Fa(e,t){return typeof t=="function"?t(e):t}function Ul(e){var t=ht();return Co(t,Je,e)}function Co(e,t,a){var r=e.queue;if(r===null)throw Error(o(311));r.lastRenderedReducer=a;var c=e.baseQueue,u=r.pending;if(u!==null){if(c!==null){var f=c.next;c.next=u.next,u.next=f}t.baseQueue=c=u,r.pending=null}if(u=e.baseState,c===null)e.memoizedState=u;else{t=c.next;var _=f=null,j=null,A=t,L=!1;do{var Y=A.lane&-536870913;if(Y!==A.lane?(Re&Y)===Y:(Ja&Y)===Y){var k=A.revertLane;if(k===0)j!==null&&(j=j.next={lane:0,revertLane:0,gesture:null,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null}),Y===zn&&(L=!0);else if((Ja&k)===k){A=A.next,k===zn&&(L=!0);continue}else Y={lane:0,revertLane:A.revertLane,gesture:null,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null},j===null?(_=j=Y,f=u):j=j.next=Y,Se.lanes|=k,Tr|=k;Y=A.action,cn&&a(u,Y),u=A.hasEagerState?A.eagerState:a(u,Y)}else k={lane:Y,revertLane:A.revertLane,gesture:A.gesture,action:A.action,hasEagerState:A.hasEagerState,eagerState:A.eagerState,next:null},j===null?(_=j=k,f=u):j=j.next=k,Se.lanes|=Y,Tr|=Y;A=A.next}while(A!==null&&A!==t);if(j===null?f=u:j.next=_,!Pt(u,e.memoizedState)&&(_t=!0,L&&(a=Mn,a!==null)))throw a;e.memoizedState=u,e.baseState=f,e.baseQueue=j,r.lastRenderedState=u}return c===null&&(r.lanes=0),[e.memoizedState,r.dispatch]}function qo(e){var t=ht(),a=t.queue;if(a===null)throw Error(o(311));a.lastRenderedReducer=e;var r=a.dispatch,c=a.pending,u=t.memoizedState;if(c!==null){a.pending=null;var f=c=c.next;do u=e(u,f.action),f=f.next;while(f!==c);Pt(u,t.memoizedState)||(_t=!0),t.memoizedState=u,t.baseQueue===null&&(t.baseState=u),a.lastRenderedState=u}return[u,r]}function od(e,t,a){var r=Se,c=ht(),u=He;if(u){if(a===void 0)throw Error(o(407));a=a()}else a=t();var f=!Pt((Je||c).memoizedState,a);if(f&&(c.memoizedState=a,_t=!0),c=c.queue,Ao(dd.bind(null,r,c,e),[e]),c.getSnapshot!==t||f||gt!==null&&gt.memoizedState.tag&1){if(r.flags|=2048,Yn(9,{destroy:void 0},ud.bind(null,r,c,a,t),null),Pe===null)throw Error(o(349));u||(Ja&127)!==0||cd(r,t,a)}return a}function cd(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},t=Se.updateQueue,t===null?(t=Ml(),Se.updateQueue=t,t.stores=[e]):(a=t.stores,a===null?t.stores=[e]:a.push(e))}function ud(e,t,a,r){t.value=a,t.getSnapshot=r,md(t)&&fd(e)}function dd(e,t,a){return a(function(){md(t)&&fd(e)})}function md(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!Pt(e,a)}catch{return!0}}function fd(e){var t=Ir(e,2);t!==null&&Kt(t,e,2)}function Do(e){var t=Ut();if(typeof e=="function"){var a=e;if(e=a(),cn){Lt(!0);try{a()}finally{Lt(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Fa,lastRenderedState:e},t}function hd(e,t,a,r){return e.baseState=a,Co(e,Je,typeof r=="function"?r:Fa)}function pp(e,t,a,r,c){if(Bl(e))throw Error(o(485));if(e=t.action,e!==null){var u={payload:c,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(f){u.listeners.push(f)}};D.T!==null?a(!0):u.isTransition=!1,r(u),a=t.pending,a===null?(u.next=t.pending=u,pd(t,u)):(u.next=a.next,t.pending=a.next=u)}}function pd(e,t){var a=t.action,r=t.payload,c=e.state;if(t.isTransition){var u=D.T,f={};D.T=f;try{var _=a(c,r),j=D.S;j!==null&&j(f,_),gd(e,t,_)}catch(A){To(e,t,A)}finally{u!==null&&f.types!==null&&(u.types=f.types),D.T=u}}else try{u=a(c,r),gd(e,t,u)}catch(A){To(e,t,A)}}function gd(e,t,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(r){_d(e,t,r)},function(r){return To(e,t,r)}):_d(e,t,a)}function _d(e,t,a){t.status="fulfilled",t.value=a,yd(t),e.state=a,t=e.pending,t!==null&&(a=t.next,a===t?e.pending=null:(a=a.next,t.next=a,pd(e,a)))}function To(e,t,a){var r=e.pending;if(e.pending=null,r!==null){r=r.next;do t.status="rejected",t.reason=a,yd(t),t=t.next;while(t!==r)}e.action=null}function yd(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function vd(e,t){return t}function bd(e,t){if(He){var a=Pe.formState;if(a!==null){e:{var r=Se;if(He){if(rt){t:{for(var c=rt,u=_a;c.nodeType!==8;){if(!u){c=null;break t}if(c=va(c.nextSibling),c===null){c=null;break t}}u=c.data,c=u==="F!"||u==="F"?c:null}if(c){rt=va(c.nextSibling),r=c.data==="F!";break e}}jr(r)}r=!1}r&&(t=a[0])}}return a=Ut(),a.memoizedState=a.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:vd,lastRenderedState:t},a.queue=r,a=Ld.bind(null,Se,r),r.dispatch=a,r=Do(!1),u=Ro.bind(null,Se,!1,r.queue),r=Ut(),c={state:t,dispatch:null,action:e,pending:null},r.queue=c,a=pp.bind(null,Se,c,u,a),c.dispatch=a,r.memoizedState=e,[t,a,!1]}function jd(e){var t=ht();return wd(t,Je,e)}function wd(e,t,a){if(t=Co(e,t,vd)[0],e=Ul(Fa)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var r=Ds(t)}catch(f){throw f===Rn?Cl:f}else r=t;t=ht();var c=t.queue,u=c.dispatch;return a!==t.memoizedState&&(Se.flags|=2048,Yn(9,{destroy:void 0},gp.bind(null,c,a),null)),[r,u,e]}function gp(e,t){e.action=t}function xd(e){var t=ht(),a=Je;if(a!==null)return wd(t,a,e);ht(),t=t.memoizedState,a=ht();var r=a.queue.dispatch;return a.memoizedState=e,[t,r,!1]}function Yn(e,t,a,r){return e={tag:e,create:a,deps:r,inst:t,next:null},t=Se.updateQueue,t===null&&(t=Ml(),Se.updateQueue=t),a=t.lastEffect,a===null?t.lastEffect=e.next=e:(r=a.next,a.next=e,e.next=r,t.lastEffect=e),e}function Sd(){return ht().memoizedState}function Hl(e,t,a,r){var c=Ut();Se.flags|=e,c.memoizedState=Yn(1|t,{destroy:void 0},a,r===void 0?null:r)}function Ll(e,t,a,r){var c=ht();r=r===void 0?null:r;var u=c.memoizedState.inst;Je!==null&&r!==null&&jo(r,Je.memoizedState.deps)?c.memoizedState=Yn(t,u,a,r):(Se.flags|=e,c.memoizedState=Yn(1|t,u,a,r))}function Nd(e,t){Hl(8390656,8,e,t)}function Ao(e,t){Ll(2048,8,e,t)}function _p(e){Se.flags|=4;var t=Se.updateQueue;if(t===null)t=Ml(),Se.updateQueue=t,t.events=[e];else{var a=t.events;a===null?t.events=[e]:a.push(e)}}function Ed(e){var t=ht().memoizedState;return _p({ref:t,nextImpl:e}),function(){if((Xe&2)!==0)throw Error(o(440));return t.impl.apply(void 0,arguments)}}function Cd(e,t){return Ll(4,2,e,t)}function qd(e,t){return Ll(4,4,e,t)}function Dd(e,t){if(typeof t=="function"){e=e();var a=t(e);return function(){typeof a=="function"?a():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Td(e,t,a){a=a!=null?a.concat([e]):null,Ll(4,4,Dd.bind(null,t,e),a)}function ko(){}function Ad(e,t){var a=ht();t=t===void 0?null:t;var r=a.memoizedState;return t!==null&&jo(t,r[1])?r[0]:(a.memoizedState=[e,t],e)}function kd(e,t){var a=ht();t=t===void 0?null:t;var r=a.memoizedState;if(t!==null&&jo(t,r[1]))return r[0];if(r=e(),cn){Lt(!0);try{e()}finally{Lt(!1)}}return a.memoizedState=[r,t],r}function Oo(e,t,a){return a===void 0||(Ja&1073741824)!==0&&(Re&261930)===0?e.memoizedState=t:(e.memoizedState=a,e=Om(),Se.lanes|=e,Tr|=e,a)}function Od(e,t,a,r){return Pt(a,t)?a:Hn.current!==null?(e=Oo(e,a,r),Pt(e,t)||(_t=!0),e):(Ja&42)===0||(Ja&1073741824)!==0&&(Re&261930)===0?(_t=!0,e.memoizedState=a):(e=Om(),Se.lanes|=e,Tr|=e,t)}function zd(e,t,a,r,c){var u=Q.p;Q.p=u!==0&&8>u?u:8;var f=D.T,_={};D.T=_,Ro(e,!1,t,a);try{var j=c(),A=D.S;if(A!==null&&A(_,j),j!==null&&typeof j=="object"&&typeof j.then=="function"){var L=mp(j,r);Ts(e,t,L,na(e))}else Ts(e,t,r,na(e))}catch(Y){Ts(e,t,{then:function(){},status:"rejected",reason:Y},na())}finally{Q.p=u,f!==null&&_.types!==null&&(f.types=_.types),D.T=f}}function yp(){}function zo(e,t,a,r){if(e.tag!==5)throw Error(o(476));var c=Md(e).queue;zd(e,c,t,te,a===null?yp:function(){return Rd(e),a(r)})}function Md(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Fa,lastRenderedState:te},next:null};var a={};return t.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Fa,lastRenderedState:a},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function Rd(e){var t=Md(e);t.next===null&&(t=e.alternate.memoizedState),Ts(e,t.next.queue,{},na())}function Mo(){return kt(Ks)}function Ud(){return ht().memoizedState}function Hd(){return ht().memoizedState}function vp(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var a=na();e=Sr(a);var r=Nr(t,e,a);r!==null&&(Kt(r,t,a),Ns(r,t,a)),t={cache:co()},e.payload=t;return}t=t.return}}function bp(e,t,a){var r=na();a={lane:r,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},Bl(e)?Bd(t,a):(a=Pi(e,t,a,r),a!==null&&(Kt(a,e,r),Yd(a,t,r)))}function Ld(e,t,a){var r=na();Ts(e,t,a,r)}function Ts(e,t,a,r){var c={lane:r,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(Bl(e))Bd(t,c);else{var u=e.alternate;if(e.lanes===0&&(u===null||u.lanes===0)&&(u=t.lastRenderedReducer,u!==null))try{var f=t.lastRenderedState,_=u(f,a);if(c.hasEagerState=!0,c.eagerState=_,Pt(_,f))return bl(e,t,c,0),Pe===null&&vl(),!1}catch{}finally{}if(a=Pi(e,t,c,r),a!==null)return Kt(a,e,r),Yd(a,t,r),!0}return!1}function Ro(e,t,a,r){if(r={lane:2,revertLane:hc(),gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},Bl(e)){if(t)throw Error(o(479))}else t=Pi(e,a,r,2),t!==null&&Kt(t,e,2)}function Bl(e){var t=e.alternate;return e===Se||t!==null&&t===Se}function Bd(e,t){Ln=Ol=!0;var a=e.pending;a===null?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function Yd(e,t,a){if((a&4194048)!==0){var r=t.lanes;r&=e.pendingLanes,a|=r,t.lanes=a,wn(e,a)}}var As={readContext:kt,use:Rl,useCallback:ct,useContext:ct,useEffect:ct,useImperativeHandle:ct,useLayoutEffect:ct,useInsertionEffect:ct,useMemo:ct,useReducer:ct,useRef:ct,useState:ct,useDebugValue:ct,useDeferredValue:ct,useTransition:ct,useSyncExternalStore:ct,useId:ct,useHostTransitionStatus:ct,useFormState:ct,useActionState:ct,useOptimistic:ct,useMemoCache:ct,useCacheRefresh:ct};As.useEffectEvent=ct;var Gd={readContext:kt,use:Rl,useCallback:function(e,t){return Ut().memoizedState=[e,t===void 0?null:t],e},useContext:kt,useEffect:Nd,useImperativeHandle:function(e,t,a){a=a!=null?a.concat([e]):null,Hl(4194308,4,Dd.bind(null,t,e),a)},useLayoutEffect:function(e,t){return Hl(4194308,4,e,t)},useInsertionEffect:function(e,t){Hl(4,2,e,t)},useMemo:function(e,t){var a=Ut();t=t===void 0?null:t;var r=e();if(cn){Lt(!0);try{e()}finally{Lt(!1)}}return a.memoizedState=[r,t],r},useReducer:function(e,t,a){var r=Ut();if(a!==void 0){var c=a(t);if(cn){Lt(!0);try{a(t)}finally{Lt(!1)}}}else c=t;return r.memoizedState=r.baseState=c,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:c},r.queue=e,e=e.dispatch=bp.bind(null,Se,e),[r.memoizedState,e]},useRef:function(e){var t=Ut();return e={current:e},t.memoizedState=e},useState:function(e){e=Do(e);var t=e.queue,a=Ld.bind(null,Se,t);return t.dispatch=a,[e.memoizedState,a]},useDebugValue:ko,useDeferredValue:function(e,t){var a=Ut();return Oo(a,e,t)},useTransition:function(){var e=Do(!1);return e=zd.bind(null,Se,e.queue,!0,!1),Ut().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,a){var r=Se,c=Ut();if(He){if(a===void 0)throw Error(o(407));a=a()}else{if(a=t(),Pe===null)throw Error(o(349));(Re&127)!==0||cd(r,t,a)}c.memoizedState=a;var u={value:a,getSnapshot:t};return c.queue=u,Nd(dd.bind(null,r,u,e),[e]),r.flags|=2048,Yn(9,{destroy:void 0},ud.bind(null,r,u,a,t),null),a},useId:function(){var e=Ut(),t=Pe.identifierPrefix;if(He){var a=Oa,r=ka;a=(r&~(1<<32-I(r)-1)).toString(32)+a,t="_"+t+"R_"+a,a=zl++,0<a&&(t+="H"+a.toString(32)),t+="_"}else a=fp++,t="_"+t+"r_"+a.toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:Mo,useFormState:bd,useActionState:bd,useOptimistic:function(e){var t=Ut();t.memoizedState=t.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=a,t=Ro.bind(null,Se,!0,a),a.dispatch=t,[e,t]},useMemoCache:Eo,useCacheRefresh:function(){return Ut().memoizedState=vp.bind(null,Se)},useEffectEvent:function(e){var t=Ut(),a={impl:e};return t.memoizedState=a,function(){if((Xe&2)!==0)throw Error(o(440));return a.impl.apply(void 0,arguments)}}},Uo={readContext:kt,use:Rl,useCallback:Ad,useContext:kt,useEffect:Ao,useImperativeHandle:Td,useInsertionEffect:Cd,useLayoutEffect:qd,useMemo:kd,useReducer:Ul,useRef:Sd,useState:function(){return Ul(Fa)},useDebugValue:ko,useDeferredValue:function(e,t){var a=ht();return Od(a,Je.memoizedState,e,t)},useTransition:function(){var e=Ul(Fa)[0],t=ht().memoizedState;return[typeof e=="boolean"?e:Ds(e),t]},useSyncExternalStore:od,useId:Ud,useHostTransitionStatus:Mo,useFormState:jd,useActionState:jd,useOptimistic:function(e,t){var a=ht();return hd(a,Je,e,t)},useMemoCache:Eo,useCacheRefresh:Hd};Uo.useEffectEvent=Ed;var Qd={readContext:kt,use:Rl,useCallback:Ad,useContext:kt,useEffect:Ao,useImperativeHandle:Td,useInsertionEffect:Cd,useLayoutEffect:qd,useMemo:kd,useReducer:qo,useRef:Sd,useState:function(){return qo(Fa)},useDebugValue:ko,useDeferredValue:function(e,t){var a=ht();return Je===null?Oo(a,e,t):Od(a,Je.memoizedState,e,t)},useTransition:function(){var e=qo(Fa)[0],t=ht().memoizedState;return[typeof e=="boolean"?e:Ds(e),t]},useSyncExternalStore:od,useId:Ud,useHostTransitionStatus:Mo,useFormState:xd,useActionState:xd,useOptimistic:function(e,t){var a=ht();return Je!==null?hd(a,Je,e,t):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:Eo,useCacheRefresh:Hd};Qd.useEffectEvent=Ed;function Ho(e,t,a,r){t=e.memoizedState,a=a(r,t),a=a==null?t:x({},t,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var Lo={enqueueSetState:function(e,t,a){e=e._reactInternals;var r=na(),c=Sr(r);c.payload=t,a!=null&&(c.callback=a),t=Nr(e,c,r),t!==null&&(Kt(t,e,r),Ns(t,e,r))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var r=na(),c=Sr(r);c.tag=1,c.payload=t,a!=null&&(c.callback=a),t=Nr(e,c,r),t!==null&&(Kt(t,e,r),Ns(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=na(),r=Sr(a);r.tag=2,t!=null&&(r.callback=t),t=Nr(e,r,a),t!==null&&(Kt(t,e,a),Ns(t,e,a))}};function Xd(e,t,a,r,c,u,f){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,u,f):t.prototype&&t.prototype.isPureReactComponent?!_s(a,r)||!_s(c,u):!0}function Vd(e,t,a,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,r),t.state!==e&&Lo.enqueueReplaceState(t,t.state,null)}function un(e,t){var a=t;if("ref"in t){a={};for(var r in t)r!=="ref"&&(a[r]=t[r])}if(e=e.defaultProps){a===t&&(a=x({},a));for(var c in e)a[c]===void 0&&(a[c]=e[c])}return a}function Zd(e){yl(e)}function Kd(e){console.error(e)}function Jd(e){yl(e)}function Yl(e,t){try{var a=e.onUncaughtError;a(t.value,{componentStack:t.stack})}catch(r){setTimeout(function(){throw r})}}function Fd(e,t,a){try{var r=e.onCaughtError;r(a.value,{componentStack:a.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(c){setTimeout(function(){throw c})}}function Bo(e,t,a){return a=Sr(a),a.tag=3,a.payload={element:null},a.callback=function(){Yl(e,t)},a}function $d(e){return e=Sr(e),e.tag=3,e}function Wd(e,t,a,r){var c=a.type.getDerivedStateFromError;if(typeof c=="function"){var u=r.value;e.payload=function(){return c(u)},e.callback=function(){Fd(t,a,r)}}var f=a.stateNode;f!==null&&typeof f.componentDidCatch=="function"&&(e.callback=function(){Fd(t,a,r),typeof c!="function"&&(Ar===null?Ar=new Set([this]):Ar.add(this));var _=r.stack;this.componentDidCatch(r.value,{componentStack:_!==null?_:""})})}function jp(e,t,a,r,c){if(a.flags|=32768,r!==null&&typeof r=="object"&&typeof r.then=="function"){if(t=a.alternate,t!==null&&On(t,a,c,!0),a=ea.current,a!==null){switch(a.tag){case 31:case 13:return ya===null?Il():a.alternate===null&&ut===0&&(ut=3),a.flags&=-257,a.flags|=65536,a.lanes=c,r===ql?a.flags|=16384:(t=a.updateQueue,t===null?a.updateQueue=new Set([r]):t.add(r),dc(e,r,c)),!1;case 22:return a.flags|=65536,r===ql?a.flags|=16384:(t=a.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},a.updateQueue=t):(a=t.retryQueue,a===null?t.retryQueue=new Set([r]):a.add(r)),dc(e,r,c)),!1}throw Error(o(435,a.tag))}return dc(e,r,c),Il(),!1}if(He)return t=ea.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=c,r!==no&&(e=Error(o(422),{cause:r}),bs(ha(e,a)))):(r!==no&&(t=Error(o(423),{cause:r}),bs(ha(t,a))),e=e.current.alternate,e.flags|=65536,c&=-c,e.lanes|=c,r=ha(r,a),c=Bo(e.stateNode,r,c),go(e,c),ut!==4&&(ut=2)),!1;var u=Error(o(520),{cause:r});if(u=ha(u,a),Ls===null?Ls=[u]:Ls.push(u),ut!==4&&(ut=2),t===null)return!0;r=ha(r,a),a=t;do{switch(a.tag){case 3:return a.flags|=65536,e=c&-c,a.lanes|=e,e=Bo(a.stateNode,r,e),go(a,e),!1;case 1:if(t=a.type,u=a.stateNode,(a.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||u!==null&&typeof u.componentDidCatch=="function"&&(Ar===null||!Ar.has(u))))return a.flags|=65536,c&=-c,a.lanes|=c,c=$d(c),Wd(c,e,a,r),go(a,c),!1}a=a.return}while(a!==null);return!1}var Yo=Error(o(461)),_t=!1;function Ot(e,t,a,r){t.child=e===null?td(t,null,a,r):on(t,e.child,a,r)}function Pd(e,t,a,r,c){a=a.render;var u=t.ref;if("ref"in r){var f={};for(var _ in r)_!=="ref"&&(f[_]=r[_])}else f=r;return rn(t),r=wo(e,t,a,f,u,c),_=xo(),e!==null&&!_t?(So(e,t,c),$a(e,t,c)):(He&&_&&ao(t),t.flags|=1,Ot(e,t,r,c),t.child)}function Id(e,t,a,r,c){if(e===null){var u=a.type;return typeof u=="function"&&!Ii(u)&&u.defaultProps===void 0&&a.compare===null?(t.tag=15,t.type=u,em(e,t,u,r,c)):(e=wl(a.type,null,r,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(u=e.child,!Fo(e,c)){var f=u.memoizedProps;if(a=a.compare,a=a!==null?a:_s,a(f,r)&&e.ref===t.ref)return $a(e,t,c)}return t.flags|=1,e=Xa(u,r),e.ref=t.ref,e.return=t,t.child=e}function em(e,t,a,r,c){if(e!==null){var u=e.memoizedProps;if(_s(u,r)&&e.ref===t.ref)if(_t=!1,t.pendingProps=r=u,Fo(e,c))(e.flags&131072)!==0&&(_t=!0);else return t.lanes=e.lanes,$a(e,t,c)}return Go(e,t,a,r,c)}function tm(e,t,a,r){var c=r.children,u=e!==null?e.memoizedState:null;if(e===null&&t.stateNode===null&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.mode==="hidden"){if((t.flags&128)!==0){if(u=u!==null?u.baseLanes|a:a,e!==null){for(r=t.child=e.child,c=0;r!==null;)c=c|r.lanes|r.childLanes,r=r.sibling;r=c&~u}else r=0,t.child=null;return am(e,t,u,a,r)}if((a&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&El(t,u!==null?u.cachePool:null),u!==null?nd(t,u):yo(),sd(t);else return r=t.lanes=536870912,am(e,t,u!==null?u.baseLanes|a:a,a,r)}else u!==null?(El(t,u.cachePool),nd(t,u),Cr(),t.memoizedState=null):(e!==null&&El(t,null),yo(),Cr());return Ot(e,t,c,a),t.child}function ks(e,t){return e!==null&&e.tag===22||t.stateNode!==null||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function am(e,t,a,r,c){var u=mo();return u=u===null?null:{parent:pt._currentValue,pool:u},t.memoizedState={baseLanes:a,cachePool:u},e!==null&&El(t,null),yo(),sd(t),e!==null&&On(e,t,r,!0),t.childLanes=c,null}function Gl(e,t){return t=Xl({mode:t.mode,children:t.children},e.mode),t.ref=e.ref,e.child=t,t.return=e,t}function rm(e,t,a){return on(t,e.child,null,a),e=Gl(t,t.pendingProps),e.flags|=2,ta(t),t.memoizedState=null,e}function wp(e,t,a){var r=t.pendingProps,c=(t.flags&128)!==0;if(t.flags&=-129,e===null){if(He){if(r.mode==="hidden")return e=Gl(t,r),t.lanes=536870912,ks(null,e);if(bo(t),(e=rt)?(e=gf(e,_a),e=e!==null&&e.data==="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:vr!==null?{id:ka,overflow:Oa}:null,retryLane:536870912,hydrationErrors:null},a=Bu(e),a.return=t,t.child=a,At=t,rt=null)):e=null,e===null)throw jr(t);return t.lanes=536870912,null}return Gl(t,r)}var u=e.memoizedState;if(u!==null){var f=u.dehydrated;if(bo(t),c)if(t.flags&256)t.flags&=-257,t=rm(e,t,a);else if(t.memoizedState!==null)t.child=e.child,t.flags|=128,t=null;else throw Error(o(558));else if(_t||On(e,t,a,!1),c=(a&e.childLanes)!==0,_t||c){if(r=Pe,r!==null&&(f=sl(r,a),f!==0&&f!==u.retryLane))throw u.retryLane=f,Ir(e,f),Kt(r,e,f),Yo;Il(),t=rm(e,t,a)}else e=u.treeContext,rt=va(f.nextSibling),At=t,He=!0,br=null,_a=!1,e!==null&&Qu(t,e),t=Gl(t,r),t.flags|=4096;return t}return e=Xa(e.child,{mode:r.mode,children:r.children}),e.ref=t.ref,t.child=e,e.return=t,e}function Ql(e,t){var a=t.ref;if(a===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(o(284));(e===null||e.ref!==a)&&(t.flags|=4194816)}}function Go(e,t,a,r,c){return rn(t),a=wo(e,t,a,r,void 0,c),r=xo(),e!==null&&!_t?(So(e,t,c),$a(e,t,c)):(He&&r&&ao(t),t.flags|=1,Ot(e,t,a,c),t.child)}function nm(e,t,a,r,c,u){return rn(t),t.updateQueue=null,a=id(t,r,a,c),ld(e),r=xo(),e!==null&&!_t?(So(e,t,u),$a(e,t,u)):(He&&r&&ao(t),t.flags|=1,Ot(e,t,a,u),t.child)}function sm(e,t,a,r,c){if(rn(t),t.stateNode===null){var u=Dn,f=a.contextType;typeof f=="object"&&f!==null&&(u=kt(f)),u=new a(r,u),t.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,u.updater=Lo,t.stateNode=u,u._reactInternals=t,u=t.stateNode,u.props=r,u.state=t.memoizedState,u.refs={},ho(t),f=a.contextType,u.context=typeof f=="object"&&f!==null?kt(f):Dn,u.state=t.memoizedState,f=a.getDerivedStateFromProps,typeof f=="function"&&(Ho(t,a,f,r),u.state=t.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(f=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),f!==u.state&&Lo.enqueueReplaceState(u,u.state,null),Cs(t,r,u,c),Es(),u.state=t.memoizedState),typeof u.componentDidMount=="function"&&(t.flags|=4194308),r=!0}else if(e===null){u=t.stateNode;var _=t.memoizedProps,j=un(a,_);u.props=j;var A=u.context,L=a.contextType;f=Dn,typeof L=="object"&&L!==null&&(f=kt(L));var Y=a.getDerivedStateFromProps;L=typeof Y=="function"||typeof u.getSnapshotBeforeUpdate=="function",_=t.pendingProps!==_,L||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(_||A!==f)&&Vd(t,u,r,f),xr=!1;var k=t.memoizedState;u.state=k,Cs(t,r,u,c),Es(),A=t.memoizedState,_||k!==A||xr?(typeof Y=="function"&&(Ho(t,a,Y,r),A=t.memoizedState),(j=xr||Xd(t,a,j,r,k,A,f))?(L||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount()),typeof u.componentDidMount=="function"&&(t.flags|=4194308)):(typeof u.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=A),u.props=r,u.state=A,u.context=f,r=j):(typeof u.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{u=t.stateNode,po(e,t),f=t.memoizedProps,L=un(a,f),u.props=L,Y=t.pendingProps,k=u.context,A=a.contextType,j=Dn,typeof A=="object"&&A!==null&&(j=kt(A)),_=a.getDerivedStateFromProps,(A=typeof _=="function"||typeof u.getSnapshotBeforeUpdate=="function")||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(f!==Y||k!==j)&&Vd(t,u,r,j),xr=!1,k=t.memoizedState,u.state=k,Cs(t,r,u,c),Es();var z=t.memoizedState;f!==Y||k!==z||xr||e!==null&&e.dependencies!==null&&Sl(e.dependencies)?(typeof _=="function"&&(Ho(t,a,_,r),z=t.memoizedState),(L=xr||Xd(t,a,L,r,k,z,j)||e!==null&&e.dependencies!==null&&Sl(e.dependencies))?(A||typeof u.UNSAFE_componentWillUpdate!="function"&&typeof u.componentWillUpdate!="function"||(typeof u.componentWillUpdate=="function"&&u.componentWillUpdate(r,z,j),typeof u.UNSAFE_componentWillUpdate=="function"&&u.UNSAFE_componentWillUpdate(r,z,j)),typeof u.componentDidUpdate=="function"&&(t.flags|=4),typeof u.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof u.componentDidUpdate!="function"||f===e.memoizedProps&&k===e.memoizedState||(t.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||f===e.memoizedProps&&k===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=z),u.props=r,u.state=z,u.context=j,r=L):(typeof u.componentDidUpdate!="function"||f===e.memoizedProps&&k===e.memoizedState||(t.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||f===e.memoizedProps&&k===e.memoizedState||(t.flags|=1024),r=!1)}return u=r,Ql(e,t),r=(t.flags&128)!==0,u||r?(u=t.stateNode,a=r&&typeof a.getDerivedStateFromError!="function"?null:u.render(),t.flags|=1,e!==null&&r?(t.child=on(t,e.child,null,c),t.child=on(t,null,a,c)):Ot(e,t,a,c),t.memoizedState=u.state,e=t.child):e=$a(e,t,c),e}function lm(e,t,a,r){return tn(),t.flags|=256,Ot(e,t,a,r),t.child}var Qo={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Xo(e){return{baseLanes:e,cachePool:Fu()}}function Vo(e,t,a){return e=e!==null?e.childLanes&~a:0,t&&(e|=ra),e}function im(e,t,a){var r=t.pendingProps,c=!1,u=(t.flags&128)!==0,f;if((f=u)||(f=e!==null&&e.memoizedState===null?!1:(ft.current&2)!==0),f&&(c=!0,t.flags&=-129),f=(t.flags&32)!==0,t.flags&=-33,e===null){if(He){if(c?Er(t):Cr(),(e=rt)?(e=gf(e,_a),e=e!==null&&e.data!=="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:vr!==null?{id:ka,overflow:Oa}:null,retryLane:536870912,hydrationErrors:null},a=Bu(e),a.return=t,t.child=a,At=t,rt=null)):e=null,e===null)throw jr(t);return Cc(e)?t.lanes=32:t.lanes=536870912,null}var _=r.children;return r=r.fallback,c?(Cr(),c=t.mode,_=Xl({mode:"hidden",children:_},c),r=en(r,c,a,null),_.return=t,r.return=t,_.sibling=r,t.child=_,r=t.child,r.memoizedState=Xo(a),r.childLanes=Vo(e,f,a),t.memoizedState=Qo,ks(null,r)):(Er(t),Zo(t,_))}var j=e.memoizedState;if(j!==null&&(_=j.dehydrated,_!==null)){if(u)t.flags&256?(Er(t),t.flags&=-257,t=Ko(e,t,a)):t.memoizedState!==null?(Cr(),t.child=e.child,t.flags|=128,t=null):(Cr(),_=r.fallback,c=t.mode,r=Xl({mode:"visible",children:r.children},c),_=en(_,c,a,null),_.flags|=2,r.return=t,_.return=t,r.sibling=_,t.child=r,on(t,e.child,null,a),r=t.child,r.memoizedState=Xo(a),r.childLanes=Vo(e,f,a),t.memoizedState=Qo,t=ks(null,r));else if(Er(t),Cc(_)){if(f=_.nextSibling&&_.nextSibling.dataset,f)var A=f.dgst;f=A,r=Error(o(419)),r.stack="",r.digest=f,bs({value:r,source:null,stack:null}),t=Ko(e,t,a)}else if(_t||On(e,t,a,!1),f=(a&e.childLanes)!==0,_t||f){if(f=Pe,f!==null&&(r=sl(f,a),r!==0&&r!==j.retryLane))throw j.retryLane=r,Ir(e,r),Kt(f,e,r),Yo;Ec(_)||Il(),t=Ko(e,t,a)}else Ec(_)?(t.flags|=192,t.child=e.child,t=null):(e=j.treeContext,rt=va(_.nextSibling),At=t,He=!0,br=null,_a=!1,e!==null&&Qu(t,e),t=Zo(t,r.children),t.flags|=4096);return t}return c?(Cr(),_=r.fallback,c=t.mode,j=e.child,A=j.sibling,r=Xa(j,{mode:"hidden",children:r.children}),r.subtreeFlags=j.subtreeFlags&65011712,A!==null?_=Xa(A,_):(_=en(_,c,a,null),_.flags|=2),_.return=t,r.return=t,r.sibling=_,t.child=r,ks(null,r),r=t.child,_=e.child.memoizedState,_===null?_=Xo(a):(c=_.cachePool,c!==null?(j=pt._currentValue,c=c.parent!==j?{parent:j,pool:j}:c):c=Fu(),_={baseLanes:_.baseLanes|a,cachePool:c}),r.memoizedState=_,r.childLanes=Vo(e,f,a),t.memoizedState=Qo,ks(e.child,r)):(Er(t),a=e.child,e=a.sibling,a=Xa(a,{mode:"visible",children:r.children}),a.return=t,a.sibling=null,e!==null&&(f=t.deletions,f===null?(t.deletions=[e],t.flags|=16):f.push(e)),t.child=a,t.memoizedState=null,a)}function Zo(e,t){return t=Xl({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function Xl(e,t){return e=It(22,e,null,t),e.lanes=0,e}function Ko(e,t,a){return on(t,e.child,null,a),e=Zo(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function om(e,t,a){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),io(e.return,t,a)}function Jo(e,t,a,r,c,u){var f=e.memoizedState;f===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:a,tailMode:c,treeForkCount:u}:(f.isBackwards=t,f.rendering=null,f.renderingStartTime=0,f.last=r,f.tail=a,f.tailMode=c,f.treeForkCount=u)}function cm(e,t,a){var r=t.pendingProps,c=r.revealOrder,u=r.tail;r=r.children;var f=ft.current,_=(f&2)!==0;if(_?(f=f&1|2,t.flags|=128):f&=1,_e(ft,f),Ot(e,t,r,a),r=He?vs:0,!_&&e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&om(e,a,t);else if(e.tag===19)om(e,a,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(c){case"forwards":for(a=t.child,c=null;a!==null;)e=a.alternate,e!==null&&kl(e)===null&&(c=a),a=a.sibling;a=c,a===null?(c=t.child,t.child=null):(c=a.sibling,a.sibling=null),Jo(t,!1,c,a,u,r);break;case"backwards":case"unstable_legacy-backwards":for(a=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&kl(e)===null){t.child=c;break}e=c.sibling,c.sibling=a,a=c,c=e}Jo(t,!0,a,null,u,r);break;case"together":Jo(t,!1,null,null,void 0,r);break;default:t.memoizedState=null}return t.child}function $a(e,t,a){if(e!==null&&(t.dependencies=e.dependencies),Tr|=t.lanes,(a&t.childLanes)===0)if(e!==null){if(On(e,t,a,!1),(a&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(o(153));if(t.child!==null){for(e=t.child,a=Xa(e,e.pendingProps),t.child=a,a.return=t;e.sibling!==null;)e=e.sibling,a=a.sibling=Xa(e,e.pendingProps),a.return=t;a.sibling=null}return t.child}function Fo(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&Sl(e)))}function xp(e,t,a){switch(t.tag){case 3:ee(t,t.stateNode.containerInfo),wr(t,pt,e.memoizedState.cache),tn();break;case 27:case 5:Te(t);break;case 4:ee(t,t.stateNode.containerInfo);break;case 10:wr(t,t.type,t.memoizedProps.value);break;case 31:if(t.memoizedState!==null)return t.flags|=128,bo(t),null;break;case 13:var r=t.memoizedState;if(r!==null)return r.dehydrated!==null?(Er(t),t.flags|=128,null):(a&t.child.childLanes)!==0?im(e,t,a):(Er(t),e=$a(e,t,a),e!==null?e.sibling:null);Er(t);break;case 19:var c=(e.flags&128)!==0;if(r=(a&t.childLanes)!==0,r||(On(e,t,a,!1),r=(a&t.childLanes)!==0),c){if(r)return cm(e,t,a);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),_e(ft,ft.current),r)break;return null;case 22:return t.lanes=0,tm(e,t,a,t.pendingProps);case 24:wr(t,pt,e.memoizedState.cache)}return $a(e,t,a)}function um(e,t,a){if(e!==null)if(e.memoizedProps!==t.pendingProps)_t=!0;else{if(!Fo(e,a)&&(t.flags&128)===0)return _t=!1,xp(e,t,a);_t=(e.flags&131072)!==0}else _t=!1,He&&(t.flags&1048576)!==0&&Gu(t,vs,t.index);switch(t.lanes=0,t.tag){case 16:e:{var r=t.pendingProps;if(e=sn(t.elementType),t.type=e,typeof e=="function")Ii(e)?(r=un(e,r),t.tag=1,t=sm(null,t,e,r,a)):(t.tag=0,t=Go(null,t,e,r,a));else{if(e!=null){var c=e.$$typeof;if(c===ue){t.tag=11,t=Pd(null,t,e,r,a);break e}else if(c===Le){t.tag=14,t=Id(null,t,e,r,a);break e}}throw t=Ae(e)||e,Error(o(306,t,""))}}return t;case 0:return Go(e,t,t.type,t.pendingProps,a);case 1:return r=t.type,c=un(r,t.pendingProps),sm(e,t,r,c,a);case 3:e:{if(ee(t,t.stateNode.containerInfo),e===null)throw Error(o(387));r=t.pendingProps;var u=t.memoizedState;c=u.element,po(e,t),Cs(t,r,null,a);var f=t.memoizedState;if(r=f.cache,wr(t,pt,r),r!==u.cache&&oo(t,[pt],a,!0),Es(),r=f.element,u.isDehydrated)if(u={element:r,isDehydrated:!1,cache:f.cache},t.updateQueue.baseState=u,t.memoizedState=u,t.flags&256){t=lm(e,t,r,a);break e}else if(r!==c){c=ha(Error(o(424)),t),bs(c),t=lm(e,t,r,a);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(rt=va(e.firstChild),At=t,He=!0,br=null,_a=!0,a=td(t,null,r,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(tn(),r===c){t=$a(e,t,a);break e}Ot(e,t,r,a)}t=t.child}return t;case 26:return Ql(e,t),e===null?(a=wf(t.type,null,t.pendingProps,null))?t.memoizedState=a:He||(a=t.type,e=t.pendingProps,r=li(qe.current).createElement(a),r[jt]=t,r[Rt]=e,zt(r,a,e),mt(r),t.stateNode=r):t.memoizedState=wf(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Te(t),e===null&&He&&(r=t.stateNode=vf(t.type,t.pendingProps,qe.current),At=t,_a=!0,c=rt,Mr(t.type)?(qc=c,rt=va(r.firstChild)):rt=c),Ot(e,t,t.pendingProps.children,a),Ql(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&He&&((c=r=rt)&&(r=Ip(r,t.type,t.pendingProps,_a),r!==null?(t.stateNode=r,At=t,rt=va(r.firstChild),_a=!1,c=!0):c=!1),c||jr(t)),Te(t),c=t.type,u=t.pendingProps,f=e!==null?e.memoizedProps:null,r=u.children,xc(c,u)?r=null:f!==null&&xc(c,f)&&(t.flags|=32),t.memoizedState!==null&&(c=wo(e,t,hp,null,null,a),Ks._currentValue=c),Ql(e,t),Ot(e,t,r,a),t.child;case 6:return e===null&&He&&((e=a=rt)&&(a=eg(a,t.pendingProps,_a),a!==null?(t.stateNode=a,At=t,rt=null,e=!0):e=!1),e||jr(t)),null;case 13:return im(e,t,a);case 4:return ee(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=on(t,null,r,a):Ot(e,t,r,a),t.child;case 11:return Pd(e,t,t.type,t.pendingProps,a);case 7:return Ot(e,t,t.pendingProps,a),t.child;case 8:return Ot(e,t,t.pendingProps.children,a),t.child;case 12:return Ot(e,t,t.pendingProps.children,a),t.child;case 10:return r=t.pendingProps,wr(t,t.type,r.value),Ot(e,t,r.children,a),t.child;case 9:return c=t.type._context,r=t.pendingProps.children,rn(t),c=kt(c),r=r(c),t.flags|=1,Ot(e,t,r,a),t.child;case 14:return Id(e,t,t.type,t.pendingProps,a);case 15:return em(e,t,t.type,t.pendingProps,a);case 19:return cm(e,t,a);case 31:return wp(e,t,a);case 22:return tm(e,t,a,t.pendingProps);case 24:return rn(t),r=kt(pt),e===null?(c=mo(),c===null&&(c=Pe,u=co(),c.pooledCache=u,u.refCount++,u!==null&&(c.pooledCacheLanes|=a),c=u),t.memoizedState={parent:r,cache:c},ho(t),wr(t,pt,c)):((e.lanes&a)!==0&&(po(e,t),Cs(t,null,null,a),Es()),c=e.memoizedState,u=t.memoizedState,c.parent!==r?(c={parent:r,cache:r},t.memoizedState=c,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=c),wr(t,pt,r)):(r=u.cache,wr(t,pt,r),r!==c.cache&&oo(t,[pt],a,!0))),Ot(e,t,t.pendingProps.children,a),t.child;case 29:throw t.pendingProps}throw Error(o(156,t.tag))}function Wa(e){e.flags|=4}function $o(e,t,a,r,c){if((t=(e.mode&32)!==0)&&(t=!1),t){if(e.flags|=16777216,(c&335544128)===c)if(e.stateNode.complete)e.flags|=8192;else if(Um())e.flags|=8192;else throw ln=ql,fo}else e.flags&=-16777217}function dm(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Cf(t))if(Um())e.flags|=8192;else throw ln=ql,fo}function Vl(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?V():536870912,e.lanes|=t,Vn|=t)}function Os(e,t){if(!He)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var r=null;a!==null;)a.alternate!==null&&(r=a),a=a.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function nt(e){var t=e.alternate!==null&&e.alternate.child===e.child,a=0,r=0;if(t)for(var c=e.child;c!==null;)a|=c.lanes|c.childLanes,r|=c.subtreeFlags&65011712,r|=c.flags&65011712,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)a|=c.lanes|c.childLanes,r|=c.subtreeFlags,r|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=r,e.childLanes=a,t}function Sp(e,t,a){var r=t.pendingProps;switch(ro(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return nt(t),null;case 1:return nt(t),null;case 3:return a=t.stateNode,r=null,e!==null&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),Ka(pt),je(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(kn(t)?Wa(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,so())),nt(t),null;case 26:var c=t.type,u=t.memoizedState;return e===null?(Wa(t),u!==null?(nt(t),dm(t,u)):(nt(t),$o(t,c,null,r,a))):u?u!==e.memoizedState?(Wa(t),nt(t),dm(t,u)):(nt(t),t.flags&=-16777217):(e=e.memoizedProps,e!==r&&Wa(t),nt(t),$o(t,c,e,r,a)),null;case 27:if(tt(t),a=qe.current,c=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==r&&Wa(t);else{if(!r){if(t.stateNode===null)throw Error(o(166));return nt(t),null}e=Ne.current,kn(t)?Xu(t):(e=vf(c,r,a),t.stateNode=e,Wa(t))}return nt(t),null;case 5:if(tt(t),c=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==r&&Wa(t);else{if(!r){if(t.stateNode===null)throw Error(o(166));return nt(t),null}if(u=Ne.current,kn(t))Xu(t);else{var f=li(qe.current);switch(u){case 1:u=f.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:u=f.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":u=f.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":u=f.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":u=f.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild);break;case"select":u=typeof r.is=="string"?f.createElement("select",{is:r.is}):f.createElement("select"),r.multiple?u.multiple=!0:r.size&&(u.size=r.size);break;default:u=typeof r.is=="string"?f.createElement(c,{is:r.is}):f.createElement(c)}}u[jt]=t,u[Rt]=r;e:for(f=t.child;f!==null;){if(f.tag===5||f.tag===6)u.appendChild(f.stateNode);else if(f.tag!==4&&f.tag!==27&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}t.stateNode=u;e:switch(zt(u,c,r),c){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&Wa(t)}}return nt(t),$o(t,t.type,e===null?null:e.memoizedProps,t.pendingProps,a),null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==r&&Wa(t);else{if(typeof r!="string"&&t.stateNode===null)throw Error(o(166));if(e=qe.current,kn(t)){if(e=t.stateNode,a=t.memoizedProps,r=null,c=At,c!==null)switch(c.tag){case 27:case 5:r=c.memoizedProps}e[jt]=t,e=!!(e.nodeValue===a||r!==null&&r.suppressHydrationWarning===!0||of(e.nodeValue,a)),e||jr(t,!0)}else e=li(e).createTextNode(r),e[jt]=t,t.stateNode=e}return nt(t),null;case 31:if(a=t.memoizedState,e===null||e.memoizedState!==null){if(r=kn(t),a!==null){if(e===null){if(!r)throw Error(o(318));if(e=t.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(557));e[jt]=t}else tn(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;nt(t),e=!1}else a=so(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),e=!0;if(!e)return t.flags&256?(ta(t),t):(ta(t),null);if((t.flags&128)!==0)throw Error(o(558))}return nt(t),null;case 13:if(r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(c=kn(t),r!==null&&r.dehydrated!==null){if(e===null){if(!c)throw Error(o(318));if(c=t.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(o(317));c[jt]=t}else tn(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;nt(t),c=!1}else c=so(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=c),c=!0;if(!c)return t.flags&256?(ta(t),t):(ta(t),null)}return ta(t),(t.flags&128)!==0?(t.lanes=a,t):(a=r!==null,e=e!==null&&e.memoizedState!==null,a&&(r=t.child,c=null,r.alternate!==null&&r.alternate.memoizedState!==null&&r.alternate.memoizedState.cachePool!==null&&(c=r.alternate.memoizedState.cachePool.pool),u=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),u!==c&&(r.flags|=2048)),a!==e&&a&&(t.child.flags|=8192),Vl(t,t.updateQueue),nt(t),null);case 4:return je(),e===null&&yc(t.stateNode.containerInfo),nt(t),null;case 10:return Ka(t.type),nt(t),null;case 19:if(P(ft),r=t.memoizedState,r===null)return nt(t),null;if(c=(t.flags&128)!==0,u=r.rendering,u===null)if(c)Os(r,!1);else{if(ut!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(u=kl(e),u!==null){for(t.flags|=128,Os(r,!1),e=u.updateQueue,t.updateQueue=e,Vl(t,e),t.subtreeFlags=0,e=a,a=t.child;a!==null;)Lu(a,e),a=a.sibling;return _e(ft,ft.current&1|2),He&&Va(t,r.treeForkCount),t.child}e=e.sibling}r.tail!==null&&vt()>$l&&(t.flags|=128,c=!0,Os(r,!1),t.lanes=4194304)}else{if(!c)if(e=kl(u),e!==null){if(t.flags|=128,c=!0,e=e.updateQueue,t.updateQueue=e,Vl(t,e),Os(r,!0),r.tail===null&&r.tailMode==="hidden"&&!u.alternate&&!He)return nt(t),null}else 2*vt()-r.renderingStartTime>$l&&a!==536870912&&(t.flags|=128,c=!0,Os(r,!1),t.lanes=4194304);r.isBackwards?(u.sibling=t.child,t.child=u):(e=r.last,e!==null?e.sibling=u:t.child=u,r.last=u)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=vt(),e.sibling=null,a=ft.current,_e(ft,c?a&1|2:a&1),He&&Va(t,r.treeForkCount),e):(nt(t),null);case 22:case 23:return ta(t),vo(),r=t.memoizedState!==null,e!==null?e.memoizedState!==null!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?(a&536870912)!==0&&(t.flags&128)===0&&(nt(t),t.subtreeFlags&6&&(t.flags|=8192)):nt(t),a=t.updateQueue,a!==null&&Vl(t,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),r=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(r=t.memoizedState.cachePool.pool),r!==a&&(t.flags|=2048),e!==null&&P(nn),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),Ka(pt),nt(t),null;case 25:return null;case 30:return null}throw Error(o(156,t.tag))}function Np(e,t){switch(ro(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ka(pt),je(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return tt(t),null;case 31:if(t.memoizedState!==null){if(ta(t),t.alternate===null)throw Error(o(340));tn()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 13:if(ta(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(o(340));tn()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return P(ft),null;case 4:return je(),null;case 10:return Ka(t.type),null;case 22:case 23:return ta(t),vo(),e!==null&&P(nn),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return Ka(pt),null;case 25:return null;default:return null}}function mm(e,t){switch(ro(t),t.tag){case 3:Ka(pt),je();break;case 26:case 27:case 5:tt(t);break;case 4:je();break;case 31:t.memoizedState!==null&&ta(t);break;case 13:ta(t);break;case 19:P(ft);break;case 10:Ka(t.type);break;case 22:case 23:ta(t),vo(),e!==null&&P(nn);break;case 24:Ka(pt)}}function zs(e,t){try{var a=t.updateQueue,r=a!==null?a.lastEffect:null;if(r!==null){var c=r.next;a=c;do{if((a.tag&e)===e){r=void 0;var u=a.create,f=a.inst;r=u(),f.destroy=r}a=a.next}while(a!==c)}}catch(_){Ze(t,t.return,_)}}function qr(e,t,a){try{var r=t.updateQueue,c=r!==null?r.lastEffect:null;if(c!==null){var u=c.next;r=u;do{if((r.tag&e)===e){var f=r.inst,_=f.destroy;if(_!==void 0){f.destroy=void 0,c=t;var j=a,A=_;try{A()}catch(L){Ze(c,j,L)}}}r=r.next}while(r!==u)}}catch(L){Ze(t,t.return,L)}}function fm(e){var t=e.updateQueue;if(t!==null){var a=e.stateNode;try{rd(t,a)}catch(r){Ze(e,e.return,r)}}}function hm(e,t,a){a.props=un(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(r){Ze(e,t,r)}}function Ms(e,t){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var r=e.stateNode;break;case 30:r=e.stateNode;break;default:r=e.stateNode}typeof a=="function"?e.refCleanup=a(r):a.current=r}}catch(c){Ze(e,t,c)}}function za(e,t){var a=e.ref,r=e.refCleanup;if(a!==null)if(typeof r=="function")try{r()}catch(c){Ze(e,t,c)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(c){Ze(e,t,c)}else a.current=null}function pm(e){var t=e.type,a=e.memoizedProps,r=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":a.autoFocus&&r.focus();break e;case"img":a.src?r.src=a.src:a.srcSet&&(r.srcset=a.srcSet)}}catch(c){Ze(e,e.return,c)}}function Wo(e,t,a){try{var r=e.stateNode;Kp(r,e.type,a,t),r[Rt]=t}catch(c){Ze(e,e.return,c)}}function gm(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Mr(e.type)||e.tag===4}function Po(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||gm(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Mr(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Io(e,t,a){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,t):(t=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,t.appendChild(e),a=a._reactRootContainer,a!=null||t.onclick!==null||(t.onclick=Z));else if(r!==4&&(r===27&&Mr(e.type)&&(a=e.stateNode,t=null),e=e.child,e!==null))for(Io(e,t,a),e=e.sibling;e!==null;)Io(e,t,a),e=e.sibling}function Zl(e,t,a){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(r!==4&&(r===27&&Mr(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(Zl(e,t,a),e=e.sibling;e!==null;)Zl(e,t,a),e=e.sibling}function _m(e){var t=e.stateNode,a=e.memoizedProps;try{for(var r=e.type,c=t.attributes;c.length;)t.removeAttributeNode(c[0]);zt(t,r,a),t[jt]=e,t[Rt]=a}catch(u){Ze(e,e.return,u)}}var Pa=!1,yt=!1,ec=!1,ym=typeof WeakSet=="function"?WeakSet:Set,qt=null;function Ep(e,t){if(e=e.containerInfo,jc=fi,e=Tu(e),Zi(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var r=a.getSelection&&a.getSelection();if(r&&r.rangeCount!==0){a=r.anchorNode;var c=r.anchorOffset,u=r.focusNode;r=r.focusOffset;try{a.nodeType,u.nodeType}catch{a=null;break e}var f=0,_=-1,j=-1,A=0,L=0,Y=e,k=null;t:for(;;){for(var z;Y!==a||c!==0&&Y.nodeType!==3||(_=f+c),Y!==u||r!==0&&Y.nodeType!==3||(j=f+r),Y.nodeType===3&&(f+=Y.nodeValue.length),(z=Y.firstChild)!==null;)k=Y,Y=z;for(;;){if(Y===e)break t;if(k===a&&++A===c&&(_=f),k===u&&++L===r&&(j=f),(z=Y.nextSibling)!==null)break;Y=k,k=Y.parentNode}Y=z}a=_===-1||j===-1?null:{start:_,end:j}}else a=null}a=a||{start:0,end:0}}else a=null;for(wc={focusedElem:e,selectionRange:a},fi=!1,qt=t;qt!==null;)if(t=qt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,qt=e;else for(;qt!==null;){switch(t=qt,u=t.alternate,e=t.flags,t.tag){case 0:if((e&4)!==0&&(e=t.updateQueue,e=e!==null?e.events:null,e!==null))for(a=0;a<e.length;a++)c=e[a],c.ref.impl=c.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&u!==null){e=void 0,a=t,c=u.memoizedProps,u=u.memoizedState,r=a.stateNode;try{var oe=un(a.type,c);e=r.getSnapshotBeforeUpdate(oe,u),r.__reactInternalSnapshotBeforeUpdate=e}catch(be){Ze(a,a.return,be)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,a=e.nodeType,a===9)Nc(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Nc(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(o(163))}if(e=t.sibling,e!==null){e.return=t.return,qt=e;break}qt=t.return}}function vm(e,t,a){var r=a.flags;switch(a.tag){case 0:case 11:case 15:er(e,a),r&4&&zs(5,a);break;case 1:if(er(e,a),r&4)if(e=a.stateNode,t===null)try{e.componentDidMount()}catch(f){Ze(a,a.return,f)}else{var c=un(a.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(c,t,e.__reactInternalSnapshotBeforeUpdate)}catch(f){Ze(a,a.return,f)}}r&64&&fm(a),r&512&&Ms(a,a.return);break;case 3:if(er(e,a),r&64&&(e=a.updateQueue,e!==null)){if(t=null,a.child!==null)switch(a.child.tag){case 27:case 5:t=a.child.stateNode;break;case 1:t=a.child.stateNode}try{rd(e,t)}catch(f){Ze(a,a.return,f)}}break;case 27:t===null&&r&4&&_m(a);case 26:case 5:er(e,a),t===null&&r&4&&pm(a),r&512&&Ms(a,a.return);break;case 12:er(e,a);break;case 31:er(e,a),r&4&&wm(e,a);break;case 13:er(e,a),r&4&&xm(e,a),r&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=Mp.bind(null,a),tg(e,a))));break;case 22:if(r=a.memoizedState!==null||Pa,!r){t=t!==null&&t.memoizedState!==null||yt,c=Pa;var u=yt;Pa=r,(yt=t)&&!u?tr(e,a,(a.subtreeFlags&8772)!==0):er(e,a),Pa=c,yt=u}break;case 30:break;default:er(e,a)}}function bm(e){var t=e.alternate;t!==null&&(e.alternate=null,bm(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&ss(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var st=null,Qt=!1;function Ia(e,t,a){for(a=a.child;a!==null;)jm(e,t,a),a=a.sibling}function jm(e,t,a){if(Nt&&typeof Nt.onCommitFiberUnmount=="function")try{Nt.onCommitFiberUnmount(oa,a)}catch{}switch(a.tag){case 26:yt||za(a,t),Ia(e,t,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:yt||za(a,t);var r=st,c=Qt;Mr(a.type)&&(st=a.stateNode,Qt=!1),Ia(e,t,a),Xs(a.stateNode),st=r,Qt=c;break;case 5:yt||za(a,t);case 6:if(r=st,c=Qt,st=null,Ia(e,t,a),st=r,Qt=c,st!==null)if(Qt)try{(st.nodeType===9?st.body:st.nodeName==="HTML"?st.ownerDocument.body:st).removeChild(a.stateNode)}catch(u){Ze(a,t,u)}else try{st.removeChild(a.stateNode)}catch(u){Ze(a,t,u)}break;case 18:st!==null&&(Qt?(e=st,hf(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),In(e)):hf(st,a.stateNode));break;case 4:r=st,c=Qt,st=a.stateNode.containerInfo,Qt=!0,Ia(e,t,a),st=r,Qt=c;break;case 0:case 11:case 14:case 15:qr(2,a,t),yt||qr(4,a,t),Ia(e,t,a);break;case 1:yt||(za(a,t),r=a.stateNode,typeof r.componentWillUnmount=="function"&&hm(a,t,r)),Ia(e,t,a);break;case 21:Ia(e,t,a);break;case 22:yt=(r=yt)||a.memoizedState!==null,Ia(e,t,a),yt=r;break;default:Ia(e,t,a)}}function wm(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{In(e)}catch(a){Ze(t,t.return,a)}}}function xm(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{In(e)}catch(a){Ze(t,t.return,a)}}function Cp(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new ym),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new ym),t;default:throw Error(o(435,e.tag))}}function Kl(e,t){var a=Cp(e);t.forEach(function(r){if(!a.has(r)){a.add(r);var c=Rp.bind(null,e,r);r.then(c,c)}})}function Xt(e,t){var a=t.deletions;if(a!==null)for(var r=0;r<a.length;r++){var c=a[r],u=e,f=t,_=f;e:for(;_!==null;){switch(_.tag){case 27:if(Mr(_.type)){st=_.stateNode,Qt=!1;break e}break;case 5:st=_.stateNode,Qt=!1;break e;case 3:case 4:st=_.stateNode.containerInfo,Qt=!0;break e}_=_.return}if(st===null)throw Error(o(160));jm(u,f,c),st=null,Qt=!1,u=c.alternate,u!==null&&(u.return=null),c.return=null}if(t.subtreeFlags&13886)for(t=t.child;t!==null;)Sm(t,e),t=t.sibling}var Na=null;function Sm(e,t){var a=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Xt(t,e),Vt(e),r&4&&(qr(3,e,e.return),zs(3,e),qr(5,e,e.return));break;case 1:Xt(t,e),Vt(e),r&512&&(yt||a===null||za(a,a.return)),r&64&&Pa&&(e=e.updateQueue,e!==null&&(r=e.callbacks,r!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?r:a.concat(r))));break;case 26:var c=Na;if(Xt(t,e),Vt(e),r&512&&(yt||a===null||za(a,a.return)),r&4){var u=a!==null?a.memoizedState:null;if(r=e.memoizedState,a===null)if(r===null)if(e.stateNode===null){e:{r=e.type,a=e.memoizedProps,c=c.ownerDocument||c;t:switch(r){case"title":u=c.getElementsByTagName("title")[0],(!u||u[Kr]||u[jt]||u.namespaceURI==="http://www.w3.org/2000/svg"||u.hasAttribute("itemprop"))&&(u=c.createElement(r),c.head.insertBefore(u,c.querySelector("head > title"))),zt(u,r,a),u[jt]=e,mt(u),r=u;break e;case"link":var f=Nf("link","href",c).get(r+(a.href||""));if(f){for(var _=0;_<f.length;_++)if(u=f[_],u.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&u.getAttribute("rel")===(a.rel==null?null:a.rel)&&u.getAttribute("title")===(a.title==null?null:a.title)&&u.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){f.splice(_,1);break t}}u=c.createElement(r),zt(u,r,a),c.head.appendChild(u);break;case"meta":if(f=Nf("meta","content",c).get(r+(a.content||""))){for(_=0;_<f.length;_++)if(u=f[_],u.getAttribute("content")===(a.content==null?null:""+a.content)&&u.getAttribute("name")===(a.name==null?null:a.name)&&u.getAttribute("property")===(a.property==null?null:a.property)&&u.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&u.getAttribute("charset")===(a.charSet==null?null:a.charSet)){f.splice(_,1);break t}}u=c.createElement(r),zt(u,r,a),c.head.appendChild(u);break;default:throw Error(o(468,r))}u[jt]=e,mt(u),r=u}e.stateNode=r}else Ef(c,e.type,e.stateNode);else e.stateNode=Sf(c,r,e.memoizedProps);else u!==r?(u===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):u.count--,r===null?Ef(c,e.type,e.stateNode):Sf(c,r,e.memoizedProps)):r===null&&e.stateNode!==null&&Wo(e,e.memoizedProps,a.memoizedProps)}break;case 27:Xt(t,e),Vt(e),r&512&&(yt||a===null||za(a,a.return)),a!==null&&r&4&&Wo(e,e.memoizedProps,a.memoizedProps);break;case 5:if(Xt(t,e),Vt(e),r&512&&(yt||a===null||za(a,a.return)),e.flags&32){c=e.stateNode;try{xa(c,"")}catch(oe){Ze(e,e.return,oe)}}r&4&&e.stateNode!=null&&(c=e.memoizedProps,Wo(e,c,a!==null?a.memoizedProps:c)),r&1024&&(ec=!0);break;case 6:if(Xt(t,e),Vt(e),r&4){if(e.stateNode===null)throw Error(o(162));r=e.memoizedProps,a=e.stateNode;try{a.nodeValue=r}catch(oe){Ze(e,e.return,oe)}}break;case 3:if(ci=null,c=Na,Na=ii(t.containerInfo),Xt(t,e),Na=c,Vt(e),r&4&&a!==null&&a.memoizedState.isDehydrated)try{In(t.containerInfo)}catch(oe){Ze(e,e.return,oe)}ec&&(ec=!1,Nm(e));break;case 4:r=Na,Na=ii(e.stateNode.containerInfo),Xt(t,e),Vt(e),Na=r;break;case 12:Xt(t,e),Vt(e);break;case 31:Xt(t,e),Vt(e),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,Kl(e,r)));break;case 13:Xt(t,e),Vt(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(Fl=vt()),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,Kl(e,r)));break;case 22:c=e.memoizedState!==null;var j=a!==null&&a.memoizedState!==null,A=Pa,L=yt;if(Pa=A||c,yt=L||j,Xt(t,e),yt=L,Pa=A,Vt(e),r&8192)e:for(t=e.stateNode,t._visibility=c?t._visibility&-2:t._visibility|1,c&&(a===null||j||Pa||yt||dn(e)),a=null,t=e;;){if(t.tag===5||t.tag===26){if(a===null){j=a=t;try{if(u=j.stateNode,c)f=u.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none";else{_=j.stateNode;var Y=j.memoizedProps.style,k=Y!=null&&Y.hasOwnProperty("display")?Y.display:null;_.style.display=k==null||typeof k=="boolean"?"":(""+k).trim()}}catch(oe){Ze(j,j.return,oe)}}}else if(t.tag===6){if(a===null){j=t;try{j.stateNode.nodeValue=c?"":j.memoizedProps}catch(oe){Ze(j,j.return,oe)}}}else if(t.tag===18){if(a===null){j=t;try{var z=j.stateNode;c?pf(z,!0):pf(j.stateNode,!1)}catch(oe){Ze(j,j.return,oe)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;a===t&&(a=null),t=t.return}a===t&&(a=null),t.sibling.return=t.return,t=t.sibling}r&4&&(r=e.updateQueue,r!==null&&(a=r.retryQueue,a!==null&&(r.retryQueue=null,Kl(e,a))));break;case 19:Xt(t,e),Vt(e),r&4&&(r=e.updateQueue,r!==null&&(e.updateQueue=null,Kl(e,r)));break;case 30:break;case 21:break;default:Xt(t,e),Vt(e)}}function Vt(e){var t=e.flags;if(t&2){try{for(var a,r=e.return;r!==null;){if(gm(r)){a=r;break}r=r.return}if(a==null)throw Error(o(160));switch(a.tag){case 27:var c=a.stateNode,u=Po(e);Zl(e,u,c);break;case 5:var f=a.stateNode;a.flags&32&&(xa(f,""),a.flags&=-33);var _=Po(e);Zl(e,_,f);break;case 3:case 4:var j=a.stateNode.containerInfo,A=Po(e);Io(e,A,j);break;default:throw Error(o(161))}}catch(L){Ze(e,e.return,L)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Nm(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;Nm(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function er(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)vm(e,t.alternate,t),t=t.sibling}function dn(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:qr(4,t,t.return),dn(t);break;case 1:za(t,t.return);var a=t.stateNode;typeof a.componentWillUnmount=="function"&&hm(t,t.return,a),dn(t);break;case 27:Xs(t.stateNode);case 26:case 5:za(t,t.return),dn(t);break;case 22:t.memoizedState===null&&dn(t);break;case 30:dn(t);break;default:dn(t)}e=e.sibling}}function tr(e,t,a){for(a=a&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var r=t.alternate,c=e,u=t,f=u.flags;switch(u.tag){case 0:case 11:case 15:tr(c,u,a),zs(4,u);break;case 1:if(tr(c,u,a),r=u,c=r.stateNode,typeof c.componentDidMount=="function")try{c.componentDidMount()}catch(A){Ze(r,r.return,A)}if(r=u,c=r.updateQueue,c!==null){var _=r.stateNode;try{var j=c.shared.hiddenCallbacks;if(j!==null)for(c.shared.hiddenCallbacks=null,c=0;c<j.length;c++)ad(j[c],_)}catch(A){Ze(r,r.return,A)}}a&&f&64&&fm(u),Ms(u,u.return);break;case 27:_m(u);case 26:case 5:tr(c,u,a),a&&r===null&&f&4&&pm(u),Ms(u,u.return);break;case 12:tr(c,u,a);break;case 31:tr(c,u,a),a&&f&4&&wm(c,u);break;case 13:tr(c,u,a),a&&f&4&&xm(c,u);break;case 22:u.memoizedState===null&&tr(c,u,a),Ms(u,u.return);break;case 30:break;default:tr(c,u,a)}t=t.sibling}}function tc(e,t){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&js(a))}function ac(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&js(e))}function Ea(e,t,a,r){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Em(e,t,a,r),t=t.sibling}function Em(e,t,a,r){var c=t.flags;switch(t.tag){case 0:case 11:case 15:Ea(e,t,a,r),c&2048&&zs(9,t);break;case 1:Ea(e,t,a,r);break;case 3:Ea(e,t,a,r),c&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&js(e)));break;case 12:if(c&2048){Ea(e,t,a,r),e=t.stateNode;try{var u=t.memoizedProps,f=u.id,_=u.onPostCommit;typeof _=="function"&&_(f,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(j){Ze(t,t.return,j)}}else Ea(e,t,a,r);break;case 31:Ea(e,t,a,r);break;case 13:Ea(e,t,a,r);break;case 23:break;case 22:u=t.stateNode,f=t.alternate,t.memoizedState!==null?u._visibility&2?Ea(e,t,a,r):Rs(e,t):u._visibility&2?Ea(e,t,a,r):(u._visibility|=2,Gn(e,t,a,r,(t.subtreeFlags&10256)!==0||!1)),c&2048&&tc(f,t);break;case 24:Ea(e,t,a,r),c&2048&&ac(t.alternate,t);break;default:Ea(e,t,a,r)}}function Gn(e,t,a,r,c){for(c=c&&((t.subtreeFlags&10256)!==0||!1),t=t.child;t!==null;){var u=e,f=t,_=a,j=r,A=f.flags;switch(f.tag){case 0:case 11:case 15:Gn(u,f,_,j,c),zs(8,f);break;case 23:break;case 22:var L=f.stateNode;f.memoizedState!==null?L._visibility&2?Gn(u,f,_,j,c):Rs(u,f):(L._visibility|=2,Gn(u,f,_,j,c)),c&&A&2048&&tc(f.alternate,f);break;case 24:Gn(u,f,_,j,c),c&&A&2048&&ac(f.alternate,f);break;default:Gn(u,f,_,j,c)}t=t.sibling}}function Rs(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var a=e,r=t,c=r.flags;switch(r.tag){case 22:Rs(a,r),c&2048&&tc(r.alternate,r);break;case 24:Rs(a,r),c&2048&&ac(r.alternate,r);break;default:Rs(a,r)}t=t.sibling}}var Us=8192;function Qn(e,t,a){if(e.subtreeFlags&Us)for(e=e.child;e!==null;)Cm(e,t,a),e=e.sibling}function Cm(e,t,a){switch(e.tag){case 26:Qn(e,t,a),e.flags&Us&&e.memoizedState!==null&&fg(a,Na,e.memoizedState,e.memoizedProps);break;case 5:Qn(e,t,a);break;case 3:case 4:var r=Na;Na=ii(e.stateNode.containerInfo),Qn(e,t,a),Na=r;break;case 22:e.memoizedState===null&&(r=e.alternate,r!==null&&r.memoizedState!==null?(r=Us,Us=16777216,Qn(e,t,a),Us=r):Qn(e,t,a));break;default:Qn(e,t,a)}}function qm(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function Hs(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var r=t[a];qt=r,Tm(r,e)}qm(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Dm(e),e=e.sibling}function Dm(e){switch(e.tag){case 0:case 11:case 15:Hs(e),e.flags&2048&&qr(9,e,e.return);break;case 3:Hs(e);break;case 12:Hs(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Jl(e)):Hs(e);break;default:Hs(e)}}function Jl(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var r=t[a];qt=r,Tm(r,e)}qm(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:qr(8,t,t.return),Jl(t);break;case 22:a=t.stateNode,a._visibility&2&&(a._visibility&=-3,Jl(t));break;default:Jl(t)}e=e.sibling}}function Tm(e,t){for(;qt!==null;){var a=qt;switch(a.tag){case 0:case 11:case 15:qr(8,a,t);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var r=a.memoizedState.cachePool.pool;r!=null&&r.refCount++}break;case 24:js(a.memoizedState.cache)}if(r=a.child,r!==null)r.return=a,qt=r;else e:for(a=e;qt!==null;){r=qt;var c=r.sibling,u=r.return;if(bm(r),r===a){qt=null;break e}if(c!==null){c.return=u,qt=c;break e}qt=u}}}var qp={getCacheForType:function(e){var t=kt(pt),a=t.data.get(e);return a===void 0&&(a=e(),t.data.set(e,a)),a},cacheSignal:function(){return kt(pt).controller.signal}},Dp=typeof WeakMap=="function"?WeakMap:Map,Xe=0,Pe=null,Oe=null,Re=0,Ve=0,aa=null,Dr=!1,Xn=!1,rc=!1,ar=0,ut=0,Tr=0,mn=0,nc=0,ra=0,Vn=0,Ls=null,Zt=null,sc=!1,Fl=0,Am=0,$l=1/0,Wl=null,Ar=null,wt=0,kr=null,Zn=null,rr=0,lc=0,ic=null,km=null,Bs=0,oc=null;function na(){return(Xe&2)!==0&&Re!==0?Re&-Re:D.T!==null?hc():ll()}function Om(){if(ra===0)if((Re&536870912)===0||He){var e=Mt;Mt<<=1,(Mt&3932160)===0&&(Mt=262144),ra=e}else ra=536870912;return e=ea.current,e!==null&&(e.flags|=32),ra}function Kt(e,t,a){(e===Pe&&(Ve===2||Ve===9)||e.cancelPendingCommit!==null)&&(Kn(e,0),Or(e,Re,ra,!1)),at(e,a),((Xe&2)===0||e!==Pe)&&(e===Pe&&((Xe&2)===0&&(mn|=a),ut===4&&Or(e,Re,ra,!1)),Ma(e))}function zm(e,t,a){if((Xe&6)!==0)throw Error(o(327));var r=!a&&(t&127)===0&&(t&e.expiredLanes)===0||Ft(e,t),c=r?kp(e,t):uc(e,t,!0),u=r;do{if(c===0){Xn&&!r&&Or(e,t,0,!1);break}else{if(a=e.current.alternate,u&&!Tp(a)){c=uc(e,t,!1),u=!1;continue}if(c===2){if(u=t,e.errorRecoveryDisabledLanes&u)var f=0;else f=e.pendingLanes&-536870913,f=f!==0?f:f&536870912?536870912:0;if(f!==0){t=f;e:{var _=e;c=Ls;var j=_.current.memoizedState.isDehydrated;if(j&&(Kn(_,f).flags|=256),f=uc(_,f,!1),f!==2){if(rc&&!j){_.errorRecoveryDisabledLanes|=u,mn|=u,c=4;break e}u=Zt,Zt=c,u!==null&&(Zt===null?Zt=u:Zt.push.apply(Zt,u))}c=f}if(u=!1,c!==2)continue}}if(c===1){Kn(e,0),Or(e,t,0,!0);break}e:{switch(r=e,u=c,u){case 0:case 1:throw Error(o(345));case 4:if((t&4194048)!==t)break;case 6:Or(r,t,ra,!Dr);break e;case 2:Zt=null;break;case 3:case 5:break;default:throw Error(o(329))}if((t&62914560)===t&&(c=Fl+300-vt(),10<c)){if(Or(r,t,ra,!Dr),Et(r,0,!0)!==0)break e;rr=t,r.timeoutHandle=mf(Mm.bind(null,r,a,Zt,Wl,sc,t,ra,mn,Vn,Dr,u,"Throttled",-0,0),c);break e}Mm(r,a,Zt,Wl,sc,t,ra,mn,Vn,Dr,u,null,-0,0)}}break}while(!0);Ma(e)}function Mm(e,t,a,r,c,u,f,_,j,A,L,Y,k,z){if(e.timeoutHandle=-1,Y=t.subtreeFlags,Y&8192||(Y&16785408)===16785408){Y={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Z},Cm(t,u,Y);var oe=(u&62914560)===u?Fl-vt():(u&4194048)===u?Am-vt():0;if(oe=hg(Y,oe),oe!==null){rr=u,e.cancelPendingCommit=oe(Qm.bind(null,e,t,u,a,r,c,f,_,j,L,Y,null,k,z)),Or(e,u,f,!A);return}}Qm(e,t,u,a,r,c,f,_,j)}function Tp(e){for(var t=e;;){var a=t.tag;if((a===0||a===11||a===15)&&t.flags&16384&&(a=t.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var r=0;r<a.length;r++){var c=a[r],u=c.getSnapshot;c=c.value;try{if(!Pt(u(),c))return!1}catch{return!1}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Or(e,t,a,r){t&=~nc,t&=~mn,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var c=t;0<c;){var u=31-I(c),f=1<<u;r[u]=-1,c&=~f}a!==0&&fr(e,a,t)}function Pl(){return(Xe&6)===0?(Ys(0),!1):!0}function cc(){if(Oe!==null){if(Ve===0)var e=Oe.return;else e=Oe,Za=an=null,No(e),Un=null,xs=0,e=Oe;for(;e!==null;)mm(e.alternate,e),e=e.return;Oe=null}}function Kn(e,t){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,$p(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),rr=0,cc(),Pe=e,Oe=a=Xa(e.current,null),Re=t,Ve=0,aa=null,Dr=!1,Xn=Ft(e,t),rc=!1,Vn=ra=nc=mn=Tr=ut=0,Zt=Ls=null,sc=!1,(t&8)!==0&&(t|=t&32);var r=e.entangledLanes;if(r!==0)for(e=e.entanglements,r&=t;0<r;){var c=31-I(r),u=1<<c;t|=e[c],r&=~u}return ar=t,vl(),a}function Rm(e,t){Se=null,D.H=As,t===Rn||t===Cl?(t=Pu(),Ve=3):t===fo?(t=Pu(),Ve=4):Ve=t===Yo?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,aa=t,Oe===null&&(ut=1,Yl(e,ha(t,e.current)))}function Um(){var e=ea.current;return e===null?!0:(Re&4194048)===Re?ya===null:(Re&62914560)===Re||(Re&536870912)!==0?e===ya:!1}function Hm(){var e=D.H;return D.H=As,e===null?As:e}function Lm(){var e=D.A;return D.A=qp,e}function Il(){ut=4,Dr||(Re&4194048)!==Re&&ea.current!==null||(Xn=!0),(Tr&134217727)===0&&(mn&134217727)===0||Pe===null||Or(Pe,Re,ra,!1)}function uc(e,t,a){var r=Xe;Xe|=2;var c=Hm(),u=Lm();(Pe!==e||Re!==t)&&(Wl=null,Kn(e,t)),t=!1;var f=ut;e:do try{if(Ve!==0&&Oe!==null){var _=Oe,j=aa;switch(Ve){case 8:cc(),f=6;break e;case 3:case 2:case 9:case 6:ea.current===null&&(t=!0);var A=Ve;if(Ve=0,aa=null,Jn(e,_,j,A),a&&Xn){f=0;break e}break;default:A=Ve,Ve=0,aa=null,Jn(e,_,j,A)}}Ap(),f=ut;break}catch(L){Rm(e,L)}while(!0);return t&&e.shellSuspendCounter++,Za=an=null,Xe=r,D.H=c,D.A=u,Oe===null&&(Pe=null,Re=0,vl()),f}function Ap(){for(;Oe!==null;)Bm(Oe)}function kp(e,t){var a=Xe;Xe|=2;var r=Hm(),c=Lm();Pe!==e||Re!==t?(Wl=null,$l=vt()+500,Kn(e,t)):Xn=Ft(e,t);e:do try{if(Ve!==0&&Oe!==null){t=Oe;var u=aa;t:switch(Ve){case 1:Ve=0,aa=null,Jn(e,t,u,1);break;case 2:case 9:if($u(u)){Ve=0,aa=null,Ym(t);break}t=function(){Ve!==2&&Ve!==9||Pe!==e||(Ve=7),Ma(e)},u.then(t,t);break e;case 3:Ve=7;break e;case 4:Ve=5;break e;case 7:$u(u)?(Ve=0,aa=null,Ym(t)):(Ve=0,aa=null,Jn(e,t,u,7));break;case 5:var f=null;switch(Oe.tag){case 26:f=Oe.memoizedState;case 5:case 27:var _=Oe;if(f?Cf(f):_.stateNode.complete){Ve=0,aa=null;var j=_.sibling;if(j!==null)Oe=j;else{var A=_.return;A!==null?(Oe=A,ei(A)):Oe=null}break t}}Ve=0,aa=null,Jn(e,t,u,5);break;case 6:Ve=0,aa=null,Jn(e,t,u,6);break;case 8:cc(),ut=6;break e;default:throw Error(o(462))}}Op();break}catch(L){Rm(e,L)}while(!0);return Za=an=null,D.H=r,D.A=c,Xe=a,Oe!==null?0:(Pe=null,Re=0,vl(),ut)}function Op(){for(;Oe!==null&&!or();)Bm(Oe)}function Bm(e){var t=um(e.alternate,e,ar);e.memoizedProps=e.pendingProps,t===null?ei(e):Oe=t}function Ym(e){var t=e,a=t.alternate;switch(t.tag){case 15:case 0:t=nm(a,t,t.pendingProps,t.type,void 0,Re);break;case 11:t=nm(a,t,t.pendingProps,t.type.render,t.ref,Re);break;case 5:No(t);default:mm(a,t),t=Oe=Lu(t,ar),t=um(a,t,ar)}e.memoizedProps=e.pendingProps,t===null?ei(e):Oe=t}function Jn(e,t,a,r){Za=an=null,No(t),Un=null,xs=0;var c=t.return;try{if(jp(e,c,t,a,Re)){ut=1,Yl(e,ha(a,e.current)),Oe=null;return}}catch(u){if(c!==null)throw Oe=c,u;ut=1,Yl(e,ha(a,e.current)),Oe=null;return}t.flags&32768?(He||r===1?e=!0:Xn||(Re&536870912)!==0?e=!1:(Dr=e=!0,(r===2||r===9||r===3||r===6)&&(r=ea.current,r!==null&&r.tag===13&&(r.flags|=16384))),Gm(t,e)):ei(t)}function ei(e){var t=e;do{if((t.flags&32768)!==0){Gm(t,Dr);return}e=t.return;var a=Sp(t.alternate,t,ar);if(a!==null){Oe=a;return}if(t=t.sibling,t!==null){Oe=t;return}Oe=t=e}while(t!==null);ut===0&&(ut=5)}function Gm(e,t){do{var a=Np(e.alternate,e);if(a!==null){a.flags&=32767,Oe=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!t&&(e=e.sibling,e!==null)){Oe=e;return}Oe=e=a}while(e!==null);ut=6,Oe=null}function Qm(e,t,a,r,c,u,f,_,j){e.cancelPendingCommit=null;do ti();while(wt!==0);if((Xe&6)!==0)throw Error(o(327));if(t!==null){if(t===e.current)throw Error(o(177));if(u=t.lanes|t.childLanes,u|=Wi,mr(e,a,u,f,_,j),e===Pe&&(Oe=Pe=null,Re=0),Zn=t,kr=e,rr=a,lc=u,ic=c,km=r,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Up(ia,function(){return Jm(),null})):(e.callbackNode=null,e.callbackPriority=0),r=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||r){r=D.T,D.T=null,c=Q.p,Q.p=2,f=Xe,Xe|=4;try{Ep(e,t,a)}finally{Xe=f,Q.p=c,D.T=r}}wt=1,Xm(),Vm(),Zm()}}function Xm(){if(wt===1){wt=0;var e=kr,t=Zn,a=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||a){a=D.T,D.T=null;var r=Q.p;Q.p=2;var c=Xe;Xe|=4;try{Sm(t,e);var u=wc,f=Tu(e.containerInfo),_=u.focusedElem,j=u.selectionRange;if(f!==_&&_&&_.ownerDocument&&Du(_.ownerDocument.documentElement,_)){if(j!==null&&Zi(_)){var A=j.start,L=j.end;if(L===void 0&&(L=A),"selectionStart"in _)_.selectionStart=A,_.selectionEnd=Math.min(L,_.value.length);else{var Y=_.ownerDocument||document,k=Y&&Y.defaultView||window;if(k.getSelection){var z=k.getSelection(),oe=_.textContent.length,be=Math.min(j.start,oe),$e=j.end===void 0?be:Math.min(j.end,oe);!z.extend&&be>$e&&(f=$e,$e=be,be=f);var E=qu(_,be),S=qu(_,$e);if(E&&S&&(z.rangeCount!==1||z.anchorNode!==E.node||z.anchorOffset!==E.offset||z.focusNode!==S.node||z.focusOffset!==S.offset)){var T=Y.createRange();T.setStart(E.node,E.offset),z.removeAllRanges(),be>$e?(z.addRange(T),z.extend(S.node,S.offset)):(T.setEnd(S.node,S.offset),z.addRange(T))}}}}for(Y=[],z=_;z=z.parentNode;)z.nodeType===1&&Y.push({element:z,left:z.scrollLeft,top:z.scrollTop});for(typeof _.focus=="function"&&_.focus(),_=0;_<Y.length;_++){var B=Y[_];B.element.scrollLeft=B.left,B.element.scrollTop=B.top}}fi=!!jc,wc=jc=null}finally{Xe=c,Q.p=r,D.T=a}}e.current=t,wt=2}}function Vm(){if(wt===2){wt=0;var e=kr,t=Zn,a=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||a){a=D.T,D.T=null;var r=Q.p;Q.p=2;var c=Xe;Xe|=4;try{vm(e,t.alternate,t)}finally{Xe=c,Q.p=r,D.T=a}}wt=3}}function Zm(){if(wt===4||wt===3){wt=0,cr();var e=kr,t=Zn,a=rr,r=km;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?wt=5:(wt=0,Zn=kr=null,Km(e,e.pendingLanes));var c=e.pendingLanes;if(c===0&&(Ar=null),Zr(a),t=t.stateNode,Nt&&typeof Nt.onCommitFiberRoot=="function")try{Nt.onCommitFiberRoot(oa,t,void 0,(t.current.flags&128)===128)}catch{}if(r!==null){t=D.T,c=Q.p,Q.p=2,D.T=null;try{for(var u=e.onRecoverableError,f=0;f<r.length;f++){var _=r[f];u(_.value,{componentStack:_.stack})}}finally{D.T=t,Q.p=c}}(rr&3)!==0&&ti(),Ma(e),c=e.pendingLanes,(a&261930)!==0&&(c&42)!==0?e===oc?Bs++:(Bs=0,oc=e):Bs=0,Ys(0)}}function Km(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,js(t)))}function ti(){return Xm(),Vm(),Zm(),Jm()}function Jm(){if(wt!==5)return!1;var e=kr,t=lc;lc=0;var a=Zr(rr),r=D.T,c=Q.p;try{Q.p=32>a?32:a,D.T=null,a=ic,ic=null;var u=kr,f=rr;if(wt=0,Zn=kr=null,rr=0,(Xe&6)!==0)throw Error(o(331));var _=Xe;if(Xe|=4,Dm(u.current),Em(u,u.current,f,a),Xe=_,Ys(0,!1),Nt&&typeof Nt.onPostCommitFiberRoot=="function")try{Nt.onPostCommitFiberRoot(oa,u)}catch{}return!0}finally{Q.p=c,D.T=r,Km(e,t)}}function Fm(e,t,a){t=ha(a,t),t=Bo(e.stateNode,t,2),e=Nr(e,t,2),e!==null&&(at(e,2),Ma(e))}function Ze(e,t,a){if(e.tag===3)Fm(e,e,a);else for(;t!==null;){if(t.tag===3){Fm(t,e,a);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ar===null||!Ar.has(r))){e=ha(a,e),a=$d(2),r=Nr(t,a,2),r!==null&&(Wd(a,r,t,e),at(r,2),Ma(r));break}}t=t.return}}function dc(e,t,a){var r=e.pingCache;if(r===null){r=e.pingCache=new Dp;var c=new Set;r.set(t,c)}else c=r.get(t),c===void 0&&(c=new Set,r.set(t,c));c.has(a)||(rc=!0,c.add(a),e=zp.bind(null,e,t,a),t.then(e,e))}function zp(e,t,a){var r=e.pingCache;r!==null&&r.delete(t),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,Pe===e&&(Re&a)===a&&(ut===4||ut===3&&(Re&62914560)===Re&&300>vt()-Fl?(Xe&2)===0&&Kn(e,0):nc|=a,Vn===Re&&(Vn=0)),Ma(e)}function $m(e,t){t===0&&(t=V()),e=Ir(e,t),e!==null&&(at(e,t),Ma(e))}function Mp(e){var t=e.memoizedState,a=0;t!==null&&(a=t.retryLane),$m(e,a)}function Rp(e,t){var a=0;switch(e.tag){case 31:case 13:var r=e.stateNode,c=e.memoizedState;c!==null&&(a=c.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(o(314))}r!==null&&r.delete(t),$m(e,a)}function Up(e,t){return Yr(e,t)}var ai=null,Fn=null,mc=!1,ri=!1,fc=!1,zr=0;function Ma(e){e!==Fn&&e.next===null&&(Fn===null?ai=Fn=e:Fn=Fn.next=e),ri=!0,mc||(mc=!0,Lp())}function Ys(e,t){if(!fc&&ri){fc=!0;do for(var a=!1,r=ai;r!==null;){if(e!==0){var c=r.pendingLanes;if(c===0)var u=0;else{var f=r.suspendedLanes,_=r.pingedLanes;u=(1<<31-I(42|e)+1)-1,u&=c&~(f&~_),u=u&201326741?u&201326741|1:u?u|2:0}u!==0&&(a=!0,ef(r,u))}else u=Re,u=Et(r,r===Pe?u:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),(u&3)===0||Ft(r,u)||(a=!0,ef(r,u));r=r.next}while(a);fc=!1}}function Hp(){Wm()}function Wm(){ri=mc=!1;var e=0;zr!==0&&Fp()&&(e=zr);for(var t=vt(),a=null,r=ai;r!==null;){var c=r.next,u=Pm(r,t);u===0?(r.next=null,a===null?ai=c:a.next=c,c===null&&(Fn=a)):(a=r,(e!==0||(u&3)!==0)&&(ri=!0)),r=c}wt!==0&&wt!==5||Ys(e),zr!==0&&(zr=0)}function Pm(e,t){for(var a=e.suspendedLanes,r=e.pingedLanes,c=e.expirationTimes,u=e.pendingLanes&-62914561;0<u;){var f=31-I(u),_=1<<f,j=c[f];j===-1?((_&a)===0||(_&r)!==0)&&(c[f]=jn(_,t)):j<=t&&(e.expiredLanes|=_),u&=~_}if(t=Pe,a=Re,a=Et(e,e===t?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),r=e.callbackNode,a===0||e===t&&(Ve===2||Ve===9)||e.cancelPendingCommit!==null)return r!==null&&r!==null&&Ra(r),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||Ft(e,a)){if(t=a&-a,t===e.callbackPriority)return t;switch(r!==null&&Ra(r),Zr(a)){case 2:case 8:a=Qr;break;case 32:a=ia;break;case 268435456:a=bt;break;default:a=ia}return r=Im.bind(null,e),a=Yr(a,r),e.callbackPriority=t,e.callbackNode=a,t}return r!==null&&r!==null&&Ra(r),e.callbackPriority=2,e.callbackNode=null,2}function Im(e,t){if(wt!==0&&wt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(ti()&&e.callbackNode!==a)return null;var r=Re;return r=Et(e,e===Pe?r:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),r===0?null:(zm(e,r,t),Pm(e,vt()),e.callbackNode!=null&&e.callbackNode===a?Im.bind(null,e):null)}function ef(e,t){if(ti())return null;zm(e,t,!0)}function Lp(){Wp(function(){(Xe&6)!==0?Yr(Gr,Hp):Wm()})}function hc(){if(zr===0){var e=zn;e===0&&(e=ur,ur<<=1,(ur&261888)===0&&(ur=256)),zr=e}return zr}function tf(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:U(""+e)}function af(e,t){var a=t.ownerDocument.createElement("input");return a.name=t.name,a.value=t.value,e.id&&a.setAttribute("form",e.id),t.parentNode.insertBefore(a,t),e=new FormData(e),a.parentNode.removeChild(a),e}function Bp(e,t,a,r,c){if(t==="submit"&&a&&a.stateNode===c){var u=tf((c[Rt]||null).action),f=r.submitter;f&&(t=(t=f[Rt]||null)?tf(t.formAction):f.getAttribute("formAction"),t!==null&&(u=t,f=null));var _=new pl("action","action",null,r,c);e.push({event:_,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(zr!==0){var j=f?af(c,f):new FormData(c);zo(a,{pending:!0,data:j,method:c.method,action:u},null,j)}}else typeof u=="function"&&(_.preventDefault(),j=f?af(c,f):new FormData(c),zo(a,{pending:!0,data:j,method:c.method,action:u},u,j))},currentTarget:c}]})}}for(var pc=0;pc<$i.length;pc++){var gc=$i[pc],Yp=gc.toLowerCase(),Gp=gc[0].toUpperCase()+gc.slice(1);Sa(Yp,"on"+Gp)}Sa(Ou,"onAnimationEnd"),Sa(zu,"onAnimationIteration"),Sa(Mu,"onAnimationStart"),Sa("dblclick","onDoubleClick"),Sa("focusin","onFocus"),Sa("focusout","onBlur"),Sa(np,"onTransitionRun"),Sa(sp,"onTransitionStart"),Sa(lp,"onTransitionCancel"),Sa(Ru,"onTransitionEnd"),Da("onMouseEnter",["mouseout","mouseover"]),Da("onMouseLeave",["mouseout","mouseover"]),Da("onPointerEnter",["pointerout","pointerover"]),Da("onPointerLeave",["pointerout","pointerover"]),ua("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ua("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ua("onBeforeInput",["compositionend","keypress","textInput","paste"]),ua("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ua("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ua("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Gs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Qp=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Gs));function rf(e,t){t=(t&4)!==0;for(var a=0;a<e.length;a++){var r=e[a],c=r.event;r=r.listeners;e:{var u=void 0;if(t)for(var f=r.length-1;0<=f;f--){var _=r[f],j=_.instance,A=_.currentTarget;if(_=_.listener,j!==u&&c.isPropagationStopped())break e;u=_,c.currentTarget=A;try{u(c)}catch(L){yl(L)}c.currentTarget=null,u=j}else for(f=0;f<r.length;f++){if(_=r[f],j=_.instance,A=_.currentTarget,_=_.listener,j!==u&&c.isPropagationStopped())break e;u=_,c.currentTarget=A;try{u(c)}catch(L){yl(L)}c.currentTarget=null,u=j}}}}function ze(e,t){var a=t[ca];a===void 0&&(a=t[ca]=new Set);var r=e+"__bubble";a.has(r)||(nf(t,e,2,!1),a.add(r))}function _c(e,t,a){var r=0;t&&(r|=4),nf(a,e,r,t)}var ni="_reactListening"+Math.random().toString(36).slice(2);function yc(e){if(!e[ni]){e[ni]=!0,ol.forEach(function(a){a!=="selectionchange"&&(Qp.has(a)||_c(a,!1,e),_c(a,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[ni]||(t[ni]=!0,_c("selectionchange",!1,t))}}function nf(e,t,a,r){switch(zf(t)){case 2:var c=_g;break;case 8:c=yg;break;default:c=Oc}a=c.bind(null,t,a,e),c=void 0,!Ui||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),r?c!==void 0?e.addEventListener(t,a,{capture:!0,passive:c}):e.addEventListener(t,a,!0):c!==void 0?e.addEventListener(t,a,{passive:c}):e.addEventListener(t,a,!1)}function vc(e,t,a,r,c){var u=r;if((t&1)===0&&(t&2)===0&&r!==null)e:for(;;){if(r===null)return;var f=r.tag;if(f===3||f===4){var _=r.stateNode.containerInfo;if(_===c)break;if(f===4)for(f=r.return;f!==null;){var j=f.tag;if((j===3||j===4)&&f.stateNode.containerInfo===c)return;f=f.return}for(;_!==null;){if(f=$t(_),f===null)return;if(j=f.tag,j===5||j===6||j===26||j===27){r=u=f;continue e}_=_.parentNode}}r=r.return}cu(function(){var A=u,L=pe(a),Y=[];e:{var k=Uu.get(e);if(k!==void 0){var z=pl,oe=e;switch(e){case"keypress":if(fl(a)===0)break e;case"keydown":case"keyup":z=Rh;break;case"focusin":oe="focus",z=Yi;break;case"focusout":oe="blur",z=Yi;break;case"beforeblur":case"afterblur":z=Yi;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":z=mu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":z=Sh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":z=Lh;break;case Ou:case zu:case Mu:z=Ch;break;case Ru:z=Yh;break;case"scroll":case"scrollend":z=wh;break;case"wheel":z=Qh;break;case"copy":case"cut":case"paste":z=Dh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":z=hu;break;case"toggle":case"beforetoggle":z=Vh}var be=(t&4)!==0,$e=!be&&(e==="scroll"||e==="scrollend"),E=be?k!==null?k+"Capture":null:k;be=[];for(var S=A,T;S!==null;){var B=S;if(T=B.stateNode,B=B.tag,B!==5&&B!==26&&B!==27||T===null||E===null||(B=us(S,E),B!=null&&be.push(Qs(S,B,T))),$e)break;S=S.return}0<be.length&&(k=new z(k,oe,null,a,L),Y.push({event:k,listeners:be}))}}if((t&7)===0){e:{if(k=e==="mouseover"||e==="pointerover",z=e==="mouseout"||e==="pointerout",k&&a!==me&&(oe=a.relatedTarget||a.fromElement)&&($t(oe)||oe[hr]))break e;if((z||k)&&(k=L.window===L?L:(k=L.ownerDocument)?k.defaultView||k.parentWindow:window,z?(oe=a.relatedTarget||a.toElement,z=A,oe=oe?$t(oe):null,oe!==null&&($e=m(oe),be=oe.tag,oe!==$e||be!==5&&be!==27&&be!==6)&&(oe=null)):(z=null,oe=A),z!==oe)){if(be=mu,B="onMouseLeave",E="onMouseEnter",S="mouse",(e==="pointerout"||e==="pointerover")&&(be=hu,B="onPointerLeave",E="onPointerEnter",S="pointer"),$e=z==null?k:gr(z),T=oe==null?k:gr(oe),k=new be(B,S+"leave",z,a,L),k.target=$e,k.relatedTarget=T,B=null,$t(L)===A&&(be=new be(E,S+"enter",oe,a,L),be.target=T,be.relatedTarget=$e,B=be),$e=B,z&&oe)t:{for(be=Xp,E=z,S=oe,T=0,B=E;B;B=be(B))T++;B=0;for(var ge=S;ge;ge=be(ge))B++;for(;0<T-B;)E=be(E),T--;for(;0<B-T;)S=be(S),B--;for(;T--;){if(E===S||S!==null&&E===S.alternate){be=E;break t}E=be(E),S=be(S)}be=null}else be=null;z!==null&&sf(Y,k,z,be,!1),oe!==null&&$e!==null&&sf(Y,$e,oe,be,!0)}}e:{if(k=A?gr(A):window,z=k.nodeName&&k.nodeName.toLowerCase(),z==="select"||z==="input"&&k.type==="file")var Be=wu;else if(bu(k))if(xu)Be=tp;else{Be=Ih;var de=Ph}else z=k.nodeName,!z||z.toLowerCase()!=="input"||k.type!=="checkbox"&&k.type!=="radio"?A&&w(A.elementType)&&(Be=wu):Be=ep;if(Be&&(Be=Be(e,A))){ju(Y,Be,a,L);break e}de&&de(e,k,A),e==="focusout"&&A&&k.type==="number"&&A.memoizedProps.value!=null&&os(k,"number",k.value)}switch(de=A?gr(A):window,e){case"focusin":(bu(de)||de.contentEditable==="true")&&(En=de,Ki=A,ys=null);break;case"focusout":ys=Ki=En=null;break;case"mousedown":Ji=!0;break;case"contextmenu":case"mouseup":case"dragend":Ji=!1,Au(Y,a,L);break;case"selectionchange":if(rp)break;case"keydown":case"keyup":Au(Y,a,L)}var Ce;if(Qi)e:{switch(e){case"compositionstart":var Ue="onCompositionStart";break e;case"compositionend":Ue="onCompositionEnd";break e;case"compositionupdate":Ue="onCompositionUpdate";break e}Ue=void 0}else Nn?yu(e,a)&&(Ue="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(Ue="onCompositionStart");Ue&&(pu&&a.locale!=="ko"&&(Nn||Ue!=="onCompositionStart"?Ue==="onCompositionEnd"&&Nn&&(Ce=uu()):(yr=L,Hi="value"in yr?yr.value:yr.textContent,Nn=!0)),de=si(A,Ue),0<de.length&&(Ue=new fu(Ue,e,null,a,L),Y.push({event:Ue,listeners:de}),Ce?Ue.data=Ce:(Ce=vu(a),Ce!==null&&(Ue.data=Ce)))),(Ce=Kh?Jh(e,a):Fh(e,a))&&(Ue=si(A,"onBeforeInput"),0<Ue.length&&(de=new fu("onBeforeInput","beforeinput",null,a,L),Y.push({event:de,listeners:Ue}),de.data=Ce)),Bp(Y,e,A,a,L)}rf(Y,t)})}function Qs(e,t,a){return{instance:e,listener:t,currentTarget:a}}function si(e,t){for(var a=t+"Capture",r=[];e!==null;){var c=e,u=c.stateNode;if(c=c.tag,c!==5&&c!==26&&c!==27||u===null||(c=us(e,a),c!=null&&r.unshift(Qs(e,c,u)),c=us(e,t),c!=null&&r.push(Qs(e,c,u))),e.tag===3)return r;e=e.return}return[]}function Xp(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function sf(e,t,a,r,c){for(var u=t._reactName,f=[];a!==null&&a!==r;){var _=a,j=_.alternate,A=_.stateNode;if(_=_.tag,j!==null&&j===r)break;_!==5&&_!==26&&_!==27||A===null||(j=A,c?(A=us(a,u),A!=null&&f.unshift(Qs(a,A,j))):c||(A=us(a,u),A!=null&&f.push(Qs(a,A,j)))),a=a.return}f.length!==0&&e.push({event:t,listeners:f})}var Vp=/\r\n?/g,Zp=/\u0000|\uFFFD/g;function lf(e){return(typeof e=="string"?e:""+e).replace(Vp,`
`).replace(Zp,"")}function of(e,t){return t=lf(t),lf(e)===t}function Fe(e,t,a,r,c,u){switch(a){case"children":typeof r=="string"?t==="body"||t==="textarea"&&r===""||xa(e,r):(typeof r=="number"||typeof r=="bigint")&&t!=="body"&&xa(e,""+r);break;case"className":Wt(e,"class",r);break;case"tabIndex":Wt(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":Wt(e,a,r);break;case"style":p(e,r,u);break;case"data":if(t!=="object"){Wt(e,"data",r);break}case"src":case"href":if(r===""&&(t!=="a"||a!=="href")){e.removeAttribute(a);break}if(r==null||typeof r=="function"||typeof r=="symbol"||typeof r=="boolean"){e.removeAttribute(a);break}r=U(""+r),e.setAttribute(a,r);break;case"action":case"formAction":if(typeof r=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof u=="function"&&(a==="formAction"?(t!=="input"&&Fe(e,t,"name",c.name,c,null),Fe(e,t,"formEncType",c.formEncType,c,null),Fe(e,t,"formMethod",c.formMethod,c,null),Fe(e,t,"formTarget",c.formTarget,c,null)):(Fe(e,t,"encType",c.encType,c,null),Fe(e,t,"method",c.method,c,null),Fe(e,t,"target",c.target,c,null)));if(r==null||typeof r=="symbol"||typeof r=="boolean"){e.removeAttribute(a);break}r=U(""+r),e.setAttribute(a,r);break;case"onClick":r!=null&&(e.onclick=Z);break;case"onScroll":r!=null&&ze("scroll",e);break;case"onScrollEnd":r!=null&&ze("scrollend",e);break;case"dangerouslySetInnerHTML":if(r!=null){if(typeof r!="object"||!("__html"in r))throw Error(o(61));if(a=r.__html,a!=null){if(c.children!=null)throw Error(o(60));e.innerHTML=a}}break;case"multiple":e.multiple=r&&typeof r!="function"&&typeof r!="symbol";break;case"muted":e.muted=r&&typeof r!="function"&&typeof r!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(r==null||typeof r=="function"||typeof r=="boolean"||typeof r=="symbol"){e.removeAttribute("xlink:href");break}a=U(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":r!=null&&typeof r!="function"&&typeof r!="symbol"?e.setAttribute(a,""+r):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&typeof r!="function"&&typeof r!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":r===!0?e.setAttribute(a,""):r!==!1&&r!=null&&typeof r!="function"&&typeof r!="symbol"?e.setAttribute(a,r):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":r!=null&&typeof r!="function"&&typeof r!="symbol"&&!isNaN(r)&&1<=r?e.setAttribute(a,r):e.removeAttribute(a);break;case"rowSpan":case"start":r==null||typeof r=="function"||typeof r=="symbol"||isNaN(r)?e.removeAttribute(a):e.setAttribute(a,r);break;case"popover":ze("beforetoggle",e),ze("toggle",e),Sn(e,"popover",r);break;case"xlinkActuate":da(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":da(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":da(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":da(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":da(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":da(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":da(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":da(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":da(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":Sn(e,"is",r);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=C.get(a)||a,Sn(e,a,r))}}function bc(e,t,a,r,c,u){switch(a){case"style":p(e,r,u);break;case"dangerouslySetInnerHTML":if(r!=null){if(typeof r!="object"||!("__html"in r))throw Error(o(61));if(a=r.__html,a!=null){if(c.children!=null)throw Error(o(60));e.innerHTML=a}}break;case"children":typeof r=="string"?xa(e,r):(typeof r=="number"||typeof r=="bigint")&&xa(e,""+r);break;case"onScroll":r!=null&&ze("scroll",e);break;case"onScrollEnd":r!=null&&ze("scrollend",e);break;case"onClick":r!=null&&(e.onclick=Z);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ls.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(c=a.endsWith("Capture"),t=a.slice(2,c?a.length-7:void 0),u=e[Rt]||null,u=u!=null?u[a]:null,typeof u=="function"&&e.removeEventListener(t,u,c),typeof r=="function")){typeof u!="function"&&u!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(t,r,c);break e}a in e?e[a]=r:r===!0?e.setAttribute(a,""):Sn(e,a,r)}}}function zt(e,t,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ze("error",e),ze("load",e);var r=!1,c=!1,u;for(u in a)if(a.hasOwnProperty(u)){var f=a[u];if(f!=null)switch(u){case"src":r=!0;break;case"srcSet":c=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,t));default:Fe(e,t,u,f,a,null)}}c&&Fe(e,t,"srcSet",a.srcSet,a,null),r&&Fe(e,t,"src",a.src,a,null);return;case"input":ze("invalid",e);var _=u=f=c=null,j=null,A=null;for(r in a)if(a.hasOwnProperty(r)){var L=a[r];if(L!=null)switch(r){case"name":c=L;break;case"type":f=L;break;case"checked":j=L;break;case"defaultChecked":A=L;break;case"value":u=L;break;case"defaultValue":_=L;break;case"children":case"dangerouslySetInnerHTML":if(L!=null)throw Error(o(137,t));break;default:Fe(e,t,r,L,a,null)}}Fr(e,u,_,j,A,f,c,!1);return;case"select":ze("invalid",e),r=f=u=null;for(c in a)if(a.hasOwnProperty(c)&&(_=a[c],_!=null))switch(c){case"value":u=_;break;case"defaultValue":f=_;break;case"multiple":r=_;default:Fe(e,t,c,_,a,null)}t=u,a=f,e.multiple=!!r,t!=null?ma(e,!!r,t,!1):a!=null&&ma(e,!!r,a,!0);return;case"textarea":ze("invalid",e),u=c=r=null;for(f in a)if(a.hasOwnProperty(f)&&(_=a[f],_!=null))switch(f){case"value":r=_;break;case"defaultValue":c=_;break;case"children":u=_;break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(o(91));break;default:Fe(e,t,f,_,a,null)}cs(e,r,c,u);return;case"option":for(j in a)if(a.hasOwnProperty(j)&&(r=a[j],r!=null))switch(j){case"selected":e.selected=r&&typeof r!="function"&&typeof r!="symbol";break;default:Fe(e,t,j,r,a,null)}return;case"dialog":ze("beforetoggle",e),ze("toggle",e),ze("cancel",e),ze("close",e);break;case"iframe":case"object":ze("load",e);break;case"video":case"audio":for(r=0;r<Gs.length;r++)ze(Gs[r],e);break;case"image":ze("error",e),ze("load",e);break;case"details":ze("toggle",e);break;case"embed":case"source":case"link":ze("error",e),ze("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(A in a)if(a.hasOwnProperty(A)&&(r=a[A],r!=null))switch(A){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,t));default:Fe(e,t,A,r,a,null)}return;default:if(w(t)){for(L in a)a.hasOwnProperty(L)&&(r=a[L],r!==void 0&&bc(e,t,L,r,a,void 0));return}}for(_ in a)a.hasOwnProperty(_)&&(r=a[_],r!=null&&Fe(e,t,_,r,a,null))}function Kp(e,t,a,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var c=null,u=null,f=null,_=null,j=null,A=null,L=null;for(z in a){var Y=a[z];if(a.hasOwnProperty(z)&&Y!=null)switch(z){case"checked":break;case"value":break;case"defaultValue":j=Y;default:r.hasOwnProperty(z)||Fe(e,t,z,null,r,Y)}}for(var k in r){var z=r[k];if(Y=a[k],r.hasOwnProperty(k)&&(z!=null||Y!=null))switch(k){case"type":u=z;break;case"name":c=z;break;case"checked":A=z;break;case"defaultChecked":L=z;break;case"value":f=z;break;case"defaultValue":_=z;break;case"children":case"dangerouslySetInnerHTML":if(z!=null)throw Error(o(137,t));break;default:z!==Y&&Fe(e,t,k,z,r,Y)}}Ga(e,f,_,j,A,L,u,c);return;case"select":z=f=_=k=null;for(u in a)if(j=a[u],a.hasOwnProperty(u)&&j!=null)switch(u){case"value":break;case"multiple":z=j;default:r.hasOwnProperty(u)||Fe(e,t,u,null,r,j)}for(c in r)if(u=r[c],j=a[c],r.hasOwnProperty(c)&&(u!=null||j!=null))switch(c){case"value":k=u;break;case"defaultValue":_=u;break;case"multiple":f=u;default:u!==j&&Fe(e,t,c,u,r,j)}t=_,a=f,r=z,k!=null?ma(e,!!a,k,!1):!!r!=!!a&&(t!=null?ma(e,!!a,t,!0):ma(e,!!a,a?[]:"",!1));return;case"textarea":z=k=null;for(_ in a)if(c=a[_],a.hasOwnProperty(_)&&c!=null&&!r.hasOwnProperty(_))switch(_){case"value":break;case"children":break;default:Fe(e,t,_,null,r,c)}for(f in r)if(c=r[f],u=a[f],r.hasOwnProperty(f)&&(c!=null||u!=null))switch(f){case"value":k=c;break;case"defaultValue":z=c;break;case"children":break;case"dangerouslySetInnerHTML":if(c!=null)throw Error(o(91));break;default:c!==u&&Fe(e,t,f,c,r,u)}Mi(e,k,z);return;case"option":for(var oe in a)if(k=a[oe],a.hasOwnProperty(oe)&&k!=null&&!r.hasOwnProperty(oe))switch(oe){case"selected":e.selected=!1;break;default:Fe(e,t,oe,null,r,k)}for(j in r)if(k=r[j],z=a[j],r.hasOwnProperty(j)&&k!==z&&(k!=null||z!=null))switch(j){case"selected":e.selected=k&&typeof k!="function"&&typeof k!="symbol";break;default:Fe(e,t,j,k,r,z)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var be in a)k=a[be],a.hasOwnProperty(be)&&k!=null&&!r.hasOwnProperty(be)&&Fe(e,t,be,null,r,k);for(A in r)if(k=r[A],z=a[A],r.hasOwnProperty(A)&&k!==z&&(k!=null||z!=null))switch(A){case"children":case"dangerouslySetInnerHTML":if(k!=null)throw Error(o(137,t));break;default:Fe(e,t,A,k,r,z)}return;default:if(w(t)){for(var $e in a)k=a[$e],a.hasOwnProperty($e)&&k!==void 0&&!r.hasOwnProperty($e)&&bc(e,t,$e,void 0,r,k);for(L in r)k=r[L],z=a[L],!r.hasOwnProperty(L)||k===z||k===void 0&&z===void 0||bc(e,t,L,k,r,z);return}}for(var E in a)k=a[E],a.hasOwnProperty(E)&&k!=null&&!r.hasOwnProperty(E)&&Fe(e,t,E,null,r,k);for(Y in r)k=r[Y],z=a[Y],!r.hasOwnProperty(Y)||k===z||k==null&&z==null||Fe(e,t,Y,k,r,z)}function cf(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Jp(){if(typeof performance.getEntriesByType=="function"){for(var e=0,t=0,a=performance.getEntriesByType("resource"),r=0;r<a.length;r++){var c=a[r],u=c.transferSize,f=c.initiatorType,_=c.duration;if(u&&_&&cf(f)){for(f=0,_=c.responseEnd,r+=1;r<a.length;r++){var j=a[r],A=j.startTime;if(A>_)break;var L=j.transferSize,Y=j.initiatorType;L&&cf(Y)&&(j=j.responseEnd,f+=L*(j<_?1:(_-A)/(j-A)))}if(--r,t+=8*(u+f)/(c.duration/1e3),e++,10<e)break}}if(0<e)return t/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var jc=null,wc=null;function li(e){return e.nodeType===9?e:e.ownerDocument}function uf(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function df(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function xc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Sc=null;function Fp(){var e=window.event;return e&&e.type==="popstate"?e===Sc?!1:(Sc=e,!0):(Sc=null,!1)}var mf=typeof setTimeout=="function"?setTimeout:void 0,$p=typeof clearTimeout=="function"?clearTimeout:void 0,ff=typeof Promise=="function"?Promise:void 0,Wp=typeof queueMicrotask=="function"?queueMicrotask:typeof ff<"u"?function(e){return ff.resolve(null).then(e).catch(Pp)}:mf;function Pp(e){setTimeout(function(){throw e})}function Mr(e){return e==="head"}function hf(e,t){var a=t,r=0;do{var c=a.nextSibling;if(e.removeChild(a),c&&c.nodeType===8)if(a=c.data,a==="/$"||a==="/&"){if(r===0){e.removeChild(c),In(t);return}r--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")r++;else if(a==="html")Xs(e.ownerDocument.documentElement);else if(a==="head"){a=e.ownerDocument.head,Xs(a);for(var u=a.firstChild;u;){var f=u.nextSibling,_=u.nodeName;u[Kr]||_==="SCRIPT"||_==="STYLE"||_==="LINK"&&u.rel.toLowerCase()==="stylesheet"||a.removeChild(u),u=f}}else a==="body"&&Xs(e.ownerDocument.body);a=c}while(a);In(t)}function pf(e,t){var a=e;e=0;do{var r=a.nextSibling;if(a.nodeType===1?t?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(t?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),r&&r.nodeType===8)if(a=r.data,a==="/$"){if(e===0)break;e--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||e++;a=r}while(a)}function Nc(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var a=t;switch(t=t.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":Nc(a),ss(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function Ip(e,t,a,r){for(;e.nodeType===1;){var c=a;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(r){if(!e[Kr])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(u=e.getAttribute("rel"),u==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(u!==c.rel||e.getAttribute("href")!==(c.href==null||c.href===""?null:c.href)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin)||e.getAttribute("title")!==(c.title==null?null:c.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(u=e.getAttribute("src"),(u!==(c.src==null?null:c.src)||e.getAttribute("type")!==(c.type==null?null:c.type)||e.getAttribute("crossorigin")!==(c.crossOrigin==null?null:c.crossOrigin))&&u&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var u=c.name==null?null:""+c.name;if(c.type==="hidden"&&e.getAttribute("name")===u)return e}else return e;if(e=va(e.nextSibling),e===null)break}return null}function eg(e,t,a){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=va(e.nextSibling),e===null))return null;return e}function gf(e,t){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!t||(e=va(e.nextSibling),e===null))return null;return e}function Ec(e){return e.data==="$?"||e.data==="$~"}function Cc(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function tg(e,t){var a=e.ownerDocument;if(e.data==="$~")e._reactRetry=t;else if(e.data!=="$?"||a.readyState!=="loading")t();else{var r=function(){t(),a.removeEventListener("DOMContentLoaded",r)};a.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}function va(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="$~"||t==="&"||t==="F!"||t==="F")break;if(t==="/$"||t==="/&")return null}}return e}var qc=null;function _f(e){e=e.nextSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"||a==="/&"){if(t===0)return va(e.nextSibling);t--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||t++}e=e.nextSibling}return null}function yf(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(t===0)return e;t--}else a!=="/$"&&a!=="/&"||t++}e=e.previousSibling}return null}function vf(e,t,a){switch(t=li(a),e){case"html":if(e=t.documentElement,!e)throw Error(o(452));return e;case"head":if(e=t.head,!e)throw Error(o(453));return e;case"body":if(e=t.body,!e)throw Error(o(454));return e;default:throw Error(o(451))}}function Xs(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);ss(e)}var ba=new Map,bf=new Set;function ii(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var nr=Q.d;Q.d={f:ag,r:rg,D:ng,C:sg,L:lg,m:ig,X:cg,S:og,M:ug};function ag(){var e=nr.f(),t=Pl();return e||t}function rg(e){var t=pr(e);t!==null&&t.tag===5&&t.type==="form"?Rd(t):nr.r(e)}var $n=typeof document>"u"?null:document;function jf(e,t,a){var r=$n;if(r&&typeof t=="string"&&t){var c=Ct(t);c='link[rel="'+e+'"][href="'+c+'"]',typeof a=="string"&&(c+='[crossorigin="'+a+'"]'),bf.has(c)||(bf.add(c),e={rel:e,crossOrigin:a,href:t},r.querySelector(c)===null&&(t=r.createElement("link"),zt(t,"link",e),mt(t),r.head.appendChild(t)))}}function ng(e){nr.D(e),jf("dns-prefetch",e,null)}function sg(e,t){nr.C(e,t),jf("preconnect",e,t)}function lg(e,t,a){nr.L(e,t,a);var r=$n;if(r&&e&&t){var c='link[rel="preload"][as="'+Ct(t)+'"]';t==="image"&&a&&a.imageSrcSet?(c+='[imagesrcset="'+Ct(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(c+='[imagesizes="'+Ct(a.imageSizes)+'"]')):c+='[href="'+Ct(e)+'"]';var u=c;switch(t){case"style":u=Wn(e);break;case"script":u=Pn(e)}ba.has(u)||(e=x({rel:"preload",href:t==="image"&&a&&a.imageSrcSet?void 0:e,as:t},a),ba.set(u,e),r.querySelector(c)!==null||t==="style"&&r.querySelector(Vs(u))||t==="script"&&r.querySelector(Zs(u))||(t=r.createElement("link"),zt(t,"link",e),mt(t),r.head.appendChild(t)))}}function ig(e,t){nr.m(e,t);var a=$n;if(a&&e){var r=t&&typeof t.as=="string"?t.as:"script",c='link[rel="modulepreload"][as="'+Ct(r)+'"][href="'+Ct(e)+'"]',u=c;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":u=Pn(e)}if(!ba.has(u)&&(e=x({rel:"modulepreload",href:e},t),ba.set(u,e),a.querySelector(c)===null)){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Zs(u)))return}r=a.createElement("link"),zt(r,"link",e),mt(r),a.head.appendChild(r)}}}function og(e,t,a){nr.S(e,t,a);var r=$n;if(r&&e){var c=Dt(r).hoistableStyles,u=Wn(e);t=t||"default";var f=c.get(u);if(!f){var _={loading:0,preload:null};if(f=r.querySelector(Vs(u)))_.loading=5;else{e=x({rel:"stylesheet",href:e,"data-precedence":t},a),(a=ba.get(u))&&Dc(e,a);var j=f=r.createElement("link");mt(j),zt(j,"link",e),j._p=new Promise(function(A,L){j.onload=A,j.onerror=L}),j.addEventListener("load",function(){_.loading|=1}),j.addEventListener("error",function(){_.loading|=2}),_.loading|=4,oi(f,t,r)}f={type:"stylesheet",instance:f,count:1,state:_},c.set(u,f)}}}function cg(e,t){nr.X(e,t);var a=$n;if(a&&e){var r=Dt(a).hoistableScripts,c=Pn(e),u=r.get(c);u||(u=a.querySelector(Zs(c)),u||(e=x({src:e,async:!0},t),(t=ba.get(c))&&Tc(e,t),u=a.createElement("script"),mt(u),zt(u,"link",e),a.head.appendChild(u)),u={type:"script",instance:u,count:1,state:null},r.set(c,u))}}function ug(e,t){nr.M(e,t);var a=$n;if(a&&e){var r=Dt(a).hoistableScripts,c=Pn(e),u=r.get(c);u||(u=a.querySelector(Zs(c)),u||(e=x({src:e,async:!0,type:"module"},t),(t=ba.get(c))&&Tc(e,t),u=a.createElement("script"),mt(u),zt(u,"link",e),a.head.appendChild(u)),u={type:"script",instance:u,count:1,state:null},r.set(c,u))}}function wf(e,t,a,r){var c=(c=qe.current)?ii(c):null;if(!c)throw Error(o(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(t=Wn(a.href),a=Dt(c).hoistableStyles,r=a.get(t),r||(r={type:"style",instance:null,count:0,state:null},a.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=Wn(a.href);var u=Dt(c).hoistableStyles,f=u.get(e);if(f||(c=c.ownerDocument||c,f={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,f),(u=c.querySelector(Vs(e)))&&!u._p&&(f.instance=u,f.state.loading=5),ba.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},ba.set(e,a),u||dg(c,e,a,f.state))),t&&r===null)throw Error(o(528,""));return f}if(t&&r!==null)throw Error(o(529,""));return null;case"script":return t=a.async,a=a.src,typeof a=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=Pn(a),a=Dt(c).hoistableScripts,r=a.get(t),r||(r={type:"script",instance:null,count:0,state:null},a.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,e))}}function Wn(e){return'href="'+Ct(e)+'"'}function Vs(e){return'link[rel="stylesheet"]['+e+"]"}function xf(e){return x({},e,{"data-precedence":e.precedence,precedence:null})}function dg(e,t,a,r){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?r.loading=1:(t=e.createElement("link"),r.preload=t,t.addEventListener("load",function(){return r.loading|=1}),t.addEventListener("error",function(){return r.loading|=2}),zt(t,"link",a),mt(t),e.head.appendChild(t))}function Pn(e){return'[src="'+Ct(e)+'"]'}function Zs(e){return"script[async]"+e}function Sf(e,t,a){if(t.count++,t.instance===null)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+Ct(a.href)+'"]');if(r)return t.instance=r,mt(r),r;var c=x({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return r=(e.ownerDocument||e).createElement("style"),mt(r),zt(r,"style",c),oi(r,a.precedence,e),t.instance=r;case"stylesheet":c=Wn(a.href);var u=e.querySelector(Vs(c));if(u)return t.state.loading|=4,t.instance=u,mt(u),u;r=xf(a),(c=ba.get(c))&&Dc(r,c),u=(e.ownerDocument||e).createElement("link"),mt(u);var f=u;return f._p=new Promise(function(_,j){f.onload=_,f.onerror=j}),zt(u,"link",r),t.state.loading|=4,oi(u,a.precedence,e),t.instance=u;case"script":return u=Pn(a.src),(c=e.querySelector(Zs(u)))?(t.instance=c,mt(c),c):(r=a,(c=ba.get(u))&&(r=x({},a),Tc(r,c)),e=e.ownerDocument||e,c=e.createElement("script"),mt(c),zt(c,"link",r),e.head.appendChild(c),t.instance=c);case"void":return null;default:throw Error(o(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(r=t.instance,t.state.loading|=4,oi(r,a.precedence,e));return t.instance}function oi(e,t,a){for(var r=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),c=r.length?r[r.length-1]:null,u=c,f=0;f<r.length;f++){var _=r[f];if(_.dataset.precedence===t)u=_;else if(u!==c)break}u?u.parentNode.insertBefore(e,u.nextSibling):(t=a.nodeType===9?a.head:a,t.insertBefore(e,t.firstChild))}function Dc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function Tc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var ci=null;function Nf(e,t,a){if(ci===null){var r=new Map,c=ci=new Map;c.set(a,r)}else c=ci,r=c.get(a),r||(r=new Map,c.set(a,r));if(r.has(e))return r;for(r.set(e,null),a=a.getElementsByTagName(e),c=0;c<a.length;c++){var u=a[c];if(!(u[Kr]||u[jt]||e==="link"&&u.getAttribute("rel")==="stylesheet")&&u.namespaceURI!=="http://www.w3.org/2000/svg"){var f=u.getAttribute(t)||"";f=e+f;var _=r.get(f);_?_.push(u):r.set(f,[u])}}return r}function Ef(e,t,a){e=e.ownerDocument||e,e.head.insertBefore(a,t==="title"?e.querySelector("head > title"):null)}function mg(e,t,a){if(a===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function Cf(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function fg(e,t,a,r){if(a.type==="stylesheet"&&(typeof r.media!="string"||matchMedia(r.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var c=Wn(r.href),u=t.querySelector(Vs(c));if(u){t=u._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(e.count++,e=ui.bind(e),t.then(e,e)),a.state.loading|=4,a.instance=u,mt(u);return}u=t.ownerDocument||t,r=xf(r),(c=ba.get(c))&&Dc(r,c),u=u.createElement("link"),mt(u);var f=u;f._p=new Promise(function(_,j){f.onload=_,f.onerror=j}),zt(u,"link",r),a.instance=u}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(a,t),(t=a.state.preload)&&(a.state.loading&3)===0&&(e.count++,a=ui.bind(e),t.addEventListener("load",a),t.addEventListener("error",a))}}var Ac=0;function hg(e,t){return e.stylesheets&&e.count===0&&mi(e,e.stylesheets),0<e.count||0<e.imgCount?function(a){var r=setTimeout(function(){if(e.stylesheets&&mi(e,e.stylesheets),e.unsuspend){var u=e.unsuspend;e.unsuspend=null,u()}},6e4+t);0<e.imgBytes&&Ac===0&&(Ac=62500*Jp());var c=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&mi(e,e.stylesheets),e.unsuspend)){var u=e.unsuspend;e.unsuspend=null,u()}},(e.imgBytes>Ac?50:800)+t);return e.unsuspend=a,function(){e.unsuspend=null,clearTimeout(r),clearTimeout(c)}}:null}function ui(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)mi(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var di=null;function mi(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,di=new Map,t.forEach(pg,e),di=null,ui.call(e))}function pg(e,t){if(!(t.state.loading&4)){var a=di.get(e);if(a)var r=a.get(null);else{a=new Map,di.set(e,a);for(var c=e.querySelectorAll("link[data-precedence],style[data-precedence]"),u=0;u<c.length;u++){var f=c[u];(f.nodeName==="LINK"||f.getAttribute("media")!=="not all")&&(a.set(f.dataset.precedence,f),r=f)}r&&a.set(null,r)}c=t.instance,f=c.getAttribute("data-precedence"),u=a.get(f)||r,u===r&&a.set(null,c),a.set(f,c),this.count++,r=ui.bind(this),c.addEventListener("load",r),c.addEventListener("error",r),u?u.parentNode.insertBefore(c,u.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(c,e.firstChild)),t.state.loading|=4}}var Ks={$$typeof:le,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function gg(e,t,a,r,c,u,f,_,j){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Bt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bt(0),this.hiddenUpdates=Bt(null),this.identifierPrefix=r,this.onUncaughtError=c,this.onCaughtError=u,this.onRecoverableError=f,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=j,this.incompleteTransitions=new Map}function qf(e,t,a,r,c,u,f,_,j,A,L,Y){return e=new gg(e,t,a,f,j,A,L,Y,_),t=1,u===!0&&(t|=24),u=It(3,null,null,t),e.current=u,u.stateNode=e,t=co(),t.refCount++,e.pooledCache=t,t.refCount++,u.memoizedState={element:r,isDehydrated:a,cache:t},ho(u),e}function Df(e){return e?(e=Dn,e):Dn}function Tf(e,t,a,r,c,u){c=Df(c),r.context===null?r.context=c:r.pendingContext=c,r=Sr(t),r.payload={element:a},u=u===void 0?null:u,u!==null&&(r.callback=u),a=Nr(e,r,t),a!==null&&(Kt(a,e,t),Ns(a,e,t))}function Af(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<t?a:t}}function kc(e,t){Af(e,t),(e=e.alternate)&&Af(e,t)}function kf(e){if(e.tag===13||e.tag===31){var t=Ir(e,67108864);t!==null&&Kt(t,e,67108864),kc(e,67108864)}}function Of(e){if(e.tag===13||e.tag===31){var t=na();t=ns(t);var a=Ir(e,t);a!==null&&Kt(a,e,t),kc(e,t)}}var fi=!0;function _g(e,t,a,r){var c=D.T;D.T=null;var u=Q.p;try{Q.p=2,Oc(e,t,a,r)}finally{Q.p=u,D.T=c}}function yg(e,t,a,r){var c=D.T;D.T=null;var u=Q.p;try{Q.p=8,Oc(e,t,a,r)}finally{Q.p=u,D.T=c}}function Oc(e,t,a,r){if(fi){var c=zc(r);if(c===null)vc(e,t,r,hi,a),Mf(e,r);else if(bg(c,e,t,a,r))r.stopPropagation();else if(Mf(e,r),t&4&&-1<vg.indexOf(e)){for(;c!==null;){var u=pr(c);if(u!==null)switch(u.tag){case 3:if(u=u.stateNode,u.current.memoizedState.isDehydrated){var f=ot(u.pendingLanes);if(f!==0){var _=u;for(_.pendingLanes|=2,_.entangledLanes|=2;f;){var j=1<<31-I(f);_.entanglements[1]|=j,f&=~j}Ma(u),(Xe&6)===0&&($l=vt()+500,Ys(0))}}break;case 31:case 13:_=Ir(u,2),_!==null&&Kt(_,u,2),Pl(),kc(u,2)}if(u=zc(r),u===null&&vc(e,t,r,hi,a),u===c)break;c=u}c!==null&&r.stopPropagation()}else vc(e,t,r,null,a)}}function zc(e){return e=pe(e),Mc(e)}var hi=null;function Mc(e){if(hi=null,e=$t(e),e!==null){var t=m(e);if(t===null)e=null;else{var a=t.tag;if(a===13){if(e=h(t),e!==null)return e;e=null}else if(a===31){if(e=g(t),e!==null)return e;e=null}else if(a===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return hi=e,null}function zf(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ua()){case Gr:return 2;case Qr:return 8;case ia:case Ha:return 32;case bt:return 268435456;default:return 32}default:return 32}}var Rc=!1,Rr=null,Ur=null,Hr=null,Js=new Map,Fs=new Map,Lr=[],vg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Mf(e,t){switch(e){case"focusin":case"focusout":Rr=null;break;case"dragenter":case"dragleave":Ur=null;break;case"mouseover":case"mouseout":Hr=null;break;case"pointerover":case"pointerout":Js.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fs.delete(t.pointerId)}}function $s(e,t,a,r,c,u){return e===null||e.nativeEvent!==u?(e={blockedOn:t,domEventName:a,eventSystemFlags:r,nativeEvent:u,targetContainers:[c]},t!==null&&(t=pr(t),t!==null&&kf(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function bg(e,t,a,r,c){switch(t){case"focusin":return Rr=$s(Rr,e,t,a,r,c),!0;case"dragenter":return Ur=$s(Ur,e,t,a,r,c),!0;case"mouseover":return Hr=$s(Hr,e,t,a,r,c),!0;case"pointerover":var u=c.pointerId;return Js.set(u,$s(Js.get(u)||null,e,t,a,r,c)),!0;case"gotpointercapture":return u=c.pointerId,Fs.set(u,$s(Fs.get(u)||null,e,t,a,r,c)),!0}return!1}function Rf(e){var t=$t(e.target);if(t!==null){var a=m(t);if(a!==null){if(t=a.tag,t===13){if(t=h(a),t!==null){e.blockedOn=t,il(e.priority,function(){Of(a)});return}}else if(t===31){if(t=g(a),t!==null){e.blockedOn=t,il(e.priority,function(){Of(a)});return}}else if(t===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function pi(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var a=zc(e.nativeEvent);if(a===null){a=e.nativeEvent;var r=new a.constructor(a.type,a);me=r,a.target.dispatchEvent(r),me=null}else return t=pr(a),t!==null&&kf(t),e.blockedOn=a,!1;t.shift()}return!0}function Uf(e,t,a){pi(e)&&a.delete(t)}function jg(){Rc=!1,Rr!==null&&pi(Rr)&&(Rr=null),Ur!==null&&pi(Ur)&&(Ur=null),Hr!==null&&pi(Hr)&&(Hr=null),Js.forEach(Uf),Fs.forEach(Uf)}function gi(e,t){e.blockedOn===t&&(e.blockedOn=null,Rc||(Rc=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,jg)))}var _i=null;function Hf(e){_i!==e&&(_i=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){_i===e&&(_i=null);for(var t=0;t<e.length;t+=3){var a=e[t],r=e[t+1],c=e[t+2];if(typeof r!="function"){if(Mc(r||a)===null)continue;break}var u=pr(a);u!==null&&(e.splice(t,3),t-=3,zo(u,{pending:!0,data:c,method:a.method,action:r},r,c))}}))}function In(e){function t(j){return gi(j,e)}Rr!==null&&gi(Rr,e),Ur!==null&&gi(Ur,e),Hr!==null&&gi(Hr,e),Js.forEach(t),Fs.forEach(t);for(var a=0;a<Lr.length;a++){var r=Lr[a];r.blockedOn===e&&(r.blockedOn=null)}for(;0<Lr.length&&(a=Lr[0],a.blockedOn===null);)Rf(a),a.blockedOn===null&&Lr.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(r=0;r<a.length;r+=3){var c=a[r],u=a[r+1],f=c[Rt]||null;if(typeof u=="function")f||Hf(a);else if(f){var _=null;if(u&&u.hasAttribute("formAction")){if(c=u,f=u[Rt]||null)_=f.formAction;else if(Mc(c)!==null)continue}else _=f.action;typeof _=="function"?a[r+1]=_:(a.splice(r,3),r-=3),Hf(a)}}}function Lf(){function e(u){u.canIntercept&&u.info==="react-transition"&&u.intercept({handler:function(){return new Promise(function(f){return c=f})},focusReset:"manual",scroll:"manual"})}function t(){c!==null&&(c(),c=null),r||setTimeout(a,20)}function a(){if(!r&&!navigation.transition){var u=navigation.currentEntry;u&&u.url!=null&&navigation.navigate(u.url,{state:u.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var r=!1,c=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(a,100),function(){r=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),c!==null&&(c(),c=null)}}}function Uc(e){this._internalRoot=e}yi.prototype.render=Uc.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(o(409));var a=t.current,r=na();Tf(a,r,e,t,null,null)},yi.prototype.unmount=Uc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Tf(e.current,2,null,e,null,null),Pl(),t[hr]=null}};function yi(e){this._internalRoot=e}yi.prototype.unstable_scheduleHydration=function(e){if(e){var t=ll();e={blockedOn:null,target:e,priority:t};for(var a=0;a<Lr.length&&t!==0&&t<Lr[a].priority;a++);Lr.splice(a,0,e),a===0&&Rf(e)}};var Bf=l.version;if(Bf!=="19.2.0")throw Error(o(527,Bf,"19.2.0"));Q.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(o(188)):(e=Object.keys(e).join(","),Error(o(268,e)));return e=O(t),e=e!==null?H(e):null,e=e===null?null:e.stateNode,e};var wg={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vi.isDisabled&&vi.supportsFiber)try{oa=vi.inject(wg),Nt=vi}catch{}}return Ps.createRoot=function(e,t){if(!d(e))throw Error(o(299));var a=!1,r="",c=Zd,u=Kd,f=Jd;return t!=null&&(t.unstable_strictMode===!0&&(a=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onUncaughtError!==void 0&&(c=t.onUncaughtError),t.onCaughtError!==void 0&&(u=t.onCaughtError),t.onRecoverableError!==void 0&&(f=t.onRecoverableError)),t=qf(e,1,!1,null,null,a,r,null,c,u,f,Lf),e[hr]=t.current,yc(e),new Uc(t)},Ps.hydrateRoot=function(e,t,a){if(!d(e))throw Error(o(299));var r=!1,c="",u=Zd,f=Kd,_=Jd,j=null;return a!=null&&(a.unstable_strictMode===!0&&(r=!0),a.identifierPrefix!==void 0&&(c=a.identifierPrefix),a.onUncaughtError!==void 0&&(u=a.onUncaughtError),a.onCaughtError!==void 0&&(f=a.onCaughtError),a.onRecoverableError!==void 0&&(_=a.onRecoverableError),a.formState!==void 0&&(j=a.formState)),t=qf(e,1,!0,t,a??null,r,c,j,u,f,_,Lf),t.context=Df(null),a=t.current,r=na(),r=ns(r),c=Sr(r),c.callback=null,Nr(a,c,r),a=r,t.current.lanes=a,at(t,a),Ma(t),e[hr]=t.current,yc(e),new yi(t)},Ps.version="19.2.0",Ps}var Ff;function n_(){if(Ff)return Gc.exports;Ff=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(l){console.error(l)}}return n(),Gc.exports=r_(),Gc.exports}var s_=n_();const l_=Pg(s_),i_="fieldsync-offline",o_=2,Ge={PROJECTS:"projects",AREAS:"areas",CREW_CHECKINS:"crew_checkins",TM_TICKETS:"tm_tickets",DAILY_REPORTS:"daily_reports",MESSAGES:"messages",PENDING_ACTIONS:"pending_actions",CACHED_DATA:"cached_data"};let gn=null;const lr=()=>new Promise((n,l)=>{if(gn){n(gn);return}const i=indexedDB.open(i_,o_);i.onerror=()=>{console.error("Failed to open offline database"),l(i.error)},i.onsuccess=()=>{gn=i.result,n(gn)},i.onupgradeneeded=o=>{const d=o.target.result;if(d.objectStoreNames.contains(Ge.PROJECTS)||d.createObjectStore(Ge.PROJECTS,{keyPath:"id"}).createIndex("company_id","company_id",{unique:!1}),d.objectStoreNames.contains(Ge.AREAS)||d.createObjectStore(Ge.AREAS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Ge.CREW_CHECKINS)||d.createObjectStore(Ge.CREW_CHECKINS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Ge.TM_TICKETS)||d.createObjectStore(Ge.TM_TICKETS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Ge.DAILY_REPORTS)||d.createObjectStore(Ge.DAILY_REPORTS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Ge.MESSAGES)||d.createObjectStore(Ge.MESSAGES,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),!d.objectStoreNames.contains(Ge.PENDING_ACTIONS)){const m=d.createObjectStore(Ge.PENDING_ACTIONS,{keyPath:"id",autoIncrement:!0});m.createIndex("type","type",{unique:!1}),m.createIndex("created_at","created_at",{unique:!1})}d.objectStoreNames.contains(Ge.CACHED_DATA)||d.createObjectStore(Ge.CACHED_DATA,{keyPath:"key"})}}),yn=(n,l="readonly")=>{if(!gn)throw new Error("Database not initialized");return gn.transaction(n,l).objectStore(n)},nl=async(n,l)=>(await lr(),new Promise((i,o)=>{const m=yn(n,"readwrite").put(l);m.onsuccess=()=>i(m.result),m.onerror=()=>o(m.error)})),hh=async(n,l)=>(await lr(),new Promise((i,o)=>{const d=gn.transaction(n,"readwrite"),m=d.objectStore(n);l.forEach(h=>m.put(h)),d.oncomplete=()=>i(),d.onerror=()=>o(d.error)})),c_=async(n,l)=>(await lr(),new Promise((i,o)=>{const m=yn(n).get(l);m.onsuccess=()=>i(m.result),m.onerror=()=>o(m.error)})),ph=async n=>(await lr(),new Promise((l,i)=>{const d=yn(n).getAll();d.onsuccess=()=>l(d.result||[]),d.onerror=()=>i(d.error)})),su=async(n,l,i)=>(await lr(),new Promise((o,d)=>{const g=yn(n).index(l).getAll(i);g.onsuccess=()=>o(g.result||[]),g.onerror=()=>d(g.error)})),u_=async(n,l)=>(await lr(),new Promise((i,o)=>{const m=yn(n,"readwrite").delete(l);m.onsuccess=()=>i(),m.onerror=()=>o(m.error)})),xt={UPDATE_AREA_STATUS:"UPDATE_AREA_STATUS",CREATE_TM_TICKET:"CREATE_TM_TICKET",SAVE_CREW_CHECKIN:"SAVE_CREW_CHECKIN",SUBMIT_DAILY_REPORT:"SUBMIT_DAILY_REPORT",SEND_MESSAGE:"SEND_MESSAGE",CREATE_MATERIAL_REQUEST:"CREATE_MATERIAL_REQUEST"},sa=async(n,l,i={})=>{await lr();const o={type:n,payload:l,metadata:i,created_at:new Date().toISOString(),attempts:0,last_error:null};return new Promise((d,m)=>{const g=yn(Ge.PENDING_ACTIONS,"readwrite").add(o);g.onsuccess=()=>{d(g.result)},g.onerror=()=>m(g.error)})},gh=async()=>ph(Ge.PENDING_ACTIONS),Ni=async()=>(await gh()).length,d_=async n=>u_(Ge.PENDING_ACTIONS,n),m_=async(n,l)=>(await lr(),new Promise((i,o)=>{const d=yn(Ge.PENDING_ACTIONS,"readwrite"),m=d.get(n);m.onsuccess=()=>{const h=m.result;if(h){const g={...h,...l},b=d.put(g);b.onsuccess=()=>i(g),b.onerror=()=>o(b.error)}else o(new Error("Action not found"))},m.onerror=()=>o(m.error)})),f_=async n=>hh(Ge.PROJECTS,n),$f=async n=>n?su(Ge.PROJECTS,"company_id",n):ph(Ge.PROJECTS),h_=async n=>hh(Ge.AREAS,n),Wf=async n=>su(Ge.AREAS,"project_id",n),Vc=async(n,l)=>{const i=await c_(Ge.AREAS,n);return i&&(i.status=l,i.updated_at=new Date().toISOString(),await nl(Ge.AREAS,i)),i},bi=async n=>nl(Ge.CREW_CHECKINS,n),Pf=async n=>nl(Ge.TM_TICKETS,n),Jt=()=>{const n=new Uint8Array(6);crypto.getRandomValues(n);const l=Array.from(n,i=>i.toString(36)).join("");return`temp_${Date.now()}_${l}`},es=async n=>nl(Ge.DAILY_REPORTS,n),p_=async(n,l)=>(await su(Ge.DAILY_REPORTS,"project_id",n)).find(o=>o.report_date===l)||null,If=async n=>nl(Ge.MESSAGES,n);let lu=typeof navigator<"u"?navigator.onLine:!0;const Pc=new Set,iu=n=>(Pc.add(n),()=>Pc.delete(n)),ja=()=>lu,eh=n=>{lu=n,Pc.forEach(l=>l(n))};typeof window<"u"&&(window.addEventListener("online",()=>{eh(!0)}),window.addEventListener("offline",()=>{eh(!1)}));let Zc=!1;const _h=async n=>{if(Zc||!lu)return{synced:0,failed:0};Zc=!0;const l={synced:0,failed:0};try{const i=await gh();for(const o of i)try{await g_(o,n),await d_(o.id),l.synced++}catch(d){console.error(`Failed to sync action ${o.type}:`,d),l.failed++,await m_(o.id,{attempts:(o.attempts||0)+1,last_error:d.message,last_attempt:new Date().toISOString()})}}finally{Zc=!1}return l},g_=async(n,l)=>{const{type:i,payload:o}=n;switch(i){case xt.UPDATE_AREA_STATUS:return l.updateAreaStatus(o.areaId,o.status);case xt.CREATE_TM_TICKET:{const d=await l.createTMTicket(o.ticket);return o.workers?.length>0&&await l.addTMWorkers(d.id,o.workers),o.items?.length>0&&await l.addTMItems(d.id,o.items),d}case xt.SAVE_CREW_CHECKIN:return l.saveCrewCheckin(o.projectId,o.workers,o.checkInDate);case xt.SUBMIT_DAILY_REPORT:return await l.saveDailyReport(o.projectId,o.reportData),l.submitDailyReport(o.projectId,o.submittedBy);case xt.SEND_MESSAGE:return l.sendMessage(o.projectId,o.senderType,o.senderName,o.content);case xt.CREATE_MATERIAL_REQUEST:return l.createMaterialRequest(o.projectId,o.items,o.requestedBy,o.neededBy,o.priority,o.notes);default:throw new Error(`Unknown action type: ${i}`)}},yh="https://cegifnrcwdilromcyouq.supabase.co",ou="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlZ2lmbnJjd2RpbHJvbWN5b3VxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NTQ5OTAsImV4cCI6MjA4MDIzMDk5MH0.qAiBG5XaB0C1E0U2tQbQkrhpm1iUhM6A2MXngEHhX4A",v=!!ou,y=v?fh(yh,ou):null,ji={slowQueryThreshold:200,enableSupabase:v},De={query(n,l){const i={type:"query",operation:n,duration_ms:l.duration,rows_returned:l.rows,company_id:l.company_id||null,project_id:l.project_id||null,user_id:l.user_id||null,timestamp:new Date().toISOString()};ji.enableSupabase&&l.duration>=ji.slowQueryThreshold&&Kc("query",i)},error(n,l){const i={type:"error",category:n,severity:l.severity||"error",error_code:l.code||null,message:l.message,company_id:l.company_id||null,user_id:l.user_id||null,project_id:l.project_id||null,operation:l.operation||null,context:l.extra||{},timestamp:new Date().toISOString()};ji.enableSupabase&&Kc("error",i)},storage(n,l){const i={type:"storage",operation:n,company_id:l.company_id||null,project_id:l.project_id||null,file_size_bytes:l.size||0,duration_ms:l.duration||0,success:l.success!==!1,error_message:l.error||null,timestamp:new Date().toISOString()};ji.enableSupabase&&(!i.success||i.duration_ms>5e3)&&Kc("storage",i)},activity(n,l){}};async function Kc(n,l){if(y)try{n==="error"?await y.rpc("log_error",{p_severity:l.severity,p_category:l.category,p_message:l.message,p_company_id:l.company_id,p_user_id:l.user_id,p_project_id:l.project_id,p_operation:l.operation,p_error_code:l.error_code,p_context:l.context||{}}):n==="query"&&await y.rpc("log_query_metric",{p_operation:l.operation,p_duration_ms:l.duration_ms,p_rows_returned:l.rows_returned,p_company_id:l.company_id,p_project_id:l.project_id,p_user_id:l.user_id,p_context:{}})}catch{}}De.wrapQuery=function(n,l){return async function(...i){const o=performance.now();try{const d=await l.apply(this,i),h={duration:Math.round(performance.now()-o),rows:Array.isArray(d)?d.length:void 0};return De.query(n,h),d}catch(d){const m=Math.round(performance.now()-o);throw De.error("database",{message:d.message,operation:n,severity:"error",extra:{duration:m}}),d}}};De.time=async function(n,l){const i=performance.now();try{const o=await l(),d=Math.round(performance.now()-i);return De.query(n,{duration:d}),o}catch(o){throw De.error("general",{message:o.message,operation:n}),o}};typeof window<"u"&&lr().catch(n=>console.error("Failed to init offline DB:",n));const Ic="fieldsync_field_session";let tl=null;const Ti=()=>{if(tl)return tl;try{const n=sessionStorage.getItem(Ic);if(n)return tl=JSON.parse(n),tl}catch{}return null},eu=n=>{tl=n,n?sessionStorage.setItem(Ic,JSON.stringify(n)):sessionStorage.removeItem(Ic)},tu=async()=>{const n=Ti();if(n?.token&&v)try{await y.rpc("invalidate_field_session",{p_session_token:n.token})}catch{}eu(null)};let Is=null;const vh=()=>{const n=Ti();return!n?.token||!v?y:((!Is||Is._sessionToken!==n.token)&&(Is=fh(yh,ou,{global:{headers:{"x-field-session":n.token}}}),Is._sessionToken=n.token),Is)},ce=()=>v?Ti()?.token?vh():y:null,au=()=>{const n=Ti();return!!(n?.token&&n?.projectId)},ru="fieldsync_data",qi="fieldsync_user",__=()=>{const n="fieldsync_device_id";let l=localStorage.getItem(n);return l||(l=crypto.randomUUID(),localStorage.setItem(n,l)),l},th={projects:[],areas:[],users:[],assignments:[]},ne=()=>{try{const n=localStorage.getItem(ru);return n?JSON.parse(n):th}catch{return localStorage.removeItem(ru),th}},ke=n=>{localStorage.setItem(ru,JSON.stringify(n))},wi=()=>{try{const n=localStorage.getItem(qi);return n?JSON.parse(n):null}catch{return localStorage.removeItem(qi),null}},xi=n=>{n?localStorage.setItem(qi,JSON.stringify(n)):localStorage.removeItem(qi)},nu={async signUp(n,l,i,o){if(v){const{data:d,error:m}=await y.auth.signUp({email:n,password:l,options:{data:{name:i,role:o}}});if(m)throw m;return d}else{const d=ne(),m={id:crypto.randomUUID(),email:n,name:i,role:o,created_at:new Date().toISOString()};return d.users.push(m),ke(d),xi(m),{user:m}}},async signIn(n,l){if(v){const{data:i,error:o}=await y.auth.signInWithPassword({email:n,password:l});if(o)throw o;return i}else{const o=ne().users.find(d=>d.email===n);if(!o)throw new Error("User not found");return xi(o),{user:o}}},async signOut(){if(v){const{error:n}=await y.auth.signOut();if(n)throw n}else xi(null)},async getUser(){if(v){const{data:{user:n}}=await y.auth.getUser();return n}else return wi()},async getProfile(){if(v){const{data:{user:n}}=await y.auth.getUser();if(!n)return null;const{data:l,error:i}=await y.from("users").select("*").eq("id",n.id).single();return i?{id:n.id,email:n.email,name:n.user_metadata?.name||"",role:n.user_metadata?.role||"foreman"}:l}else return wi()},async updateRole(n,l){if(v){const{data:i,error:o}=await y.from("users").update({role:l}).eq("id",n).select().single();if(o)throw o;return i}else{const i=ne(),o=i.users.find(d=>d.id===n);return o&&(o.role=l,ke(i),wi()?.id===n&&xi(o)),o}},onAuthStateChange(n){if(v)return y.auth.onAuthStateChange(n);{const l=wi();return n(l?"SIGNED_IN":"SIGNED_OUT",{user:l}),{data:{subscription:{unsubscribe:()=>{}}}}}}},he={async getProjects(n=null,l=!1){if(v){if(!ja()){const o=await $f(n);return l?o:o.filter(d=>d.status!=="archived")}const i=performance.now();try{let o=y.from("projects").select("*").order("created_at",{ascending:!1});n&&(o=o.eq("company_id",n)),l||(o=o.eq("status","active"));const{data:d,error:m}=await o,h=Math.round(performance.now()-i);if(De.query("getProjects",{duration:h,rows:d?.length,company_id:n}),m){De.error("database",{message:m.message,operation:"getProjects",company_id:n});const g=await $f(n);if(g.length>0)return g;throw m}return d?.length>0&&f_(d).catch(g=>console.error("Failed to cache projects:",g)),d}catch(o){throw De.error("database",{message:o.message,operation:"getProjects",company_id:n}),o}}else{const i=ne().projects;return l?i:i.filter(o=>o.status!=="archived")}},async getProjectsPaginated(n,{page:l=0,limit:i=25,status:o="active"}={}){if(v){const h=performance.now();try{let g=y.from("projects").select("*",{count:"exact"}).eq("company_id",n).order("created_at",{ascending:!1}).range(l*i,(l+1)*i-1);o!=="all"&&(g=g.eq("status",o));const{data:b,error:O,count:H}=await g,x=Math.round(performance.now()-h);if(De.query("getProjectsPaginated",{duration:x,rows:b?.length,page:l,company_id:n}),O)throw O;return{projects:b||[],totalCount:H||0,hasMore:(l+1)*i<(H||0),page:l,limit:i}}catch(g){throw De.error("database",{message:g.message,operation:"getProjectsPaginated",company_id:n}),g}}const d=ne().projects.filter(h=>h.company_id===n&&(o==="all"||h.status===o)),m=l*i;return{projects:d.slice(m,m+i),totalCount:d.length,hasMore:m+i<d.length,page:l,limit:i}},async getProjectsWithSummary(n){if(v){const l=performance.now();try{const{data:i,error:o}=await y.from("projects").select(`
            *,
            areas:areas(count),
            tickets:t_and_m_tickets(count),
            pending_tickets:t_and_m_tickets(count),
            daily_reports:daily_reports(count)
          `).eq("company_id",n).eq("status","active").eq("pending_tickets.status","pending").order("created_at",{ascending:!1}),d=Math.round(performance.now()-l);if(De.query("getProjectsWithSummary",{duration:d,rows:i?.length,company_id:n}),o)throw o;return(i||[]).map(m=>({...m,areaCount:m.areas?.[0]?.count||0,ticketCount:m.tickets?.[0]?.count||0,pendingTicketCount:m.pending_tickets?.[0]?.count||0,reportCount:m.daily_reports?.[0]?.count||0,areas:void 0,tickets:void 0,pending_tickets:void 0,daily_reports:void 0}))}catch(i){return De.error("database",{message:i.message,operation:"getProjectsWithSummary",company_id:n}),this.getProjects(n)}}return ne().projects.filter(l=>l.company_id===n&&l.status==="active")},async getProjectDashboardSummary(n){if(v){const l=performance.now();try{const{data:i,error:o}=await y.rpc("get_project_dashboard_summary",{p_company_id:n}),d=Math.round(performance.now()-l);if(De.query("getProjectDashboardSummary",{duration:d,rows:i?.length,company_id:n}),o){if(o.message?.includes("function")||o.code==="42883")return this.getProjectsWithSummary(n);throw o}return(i||[]).map(m=>({id:m.project_id,name:m.project_name,status:m.project_status,job_number:m.project_number,address:m.project_address,pin:m.project_pin,created_at:m.created_at,start_date:m.start_date,end_date:m.end_date,contract_value:Number(m.contract_value)||0,work_type:m.work_type||"demolition",job_type:m.job_type||"standard",general_contractor:m.general_contractor||"",areaCount:Number(m.total_areas)||0,completedAreas:Number(m.completed_areas)||0,inProgressAreas:Number(m.in_progress_areas)||0,pendingAreas:Number(m.pending_areas)||0,ticketCount:Number(m.total_tickets)||0,pendingTicketCount:Number(m.pending_tickets)||0,submittedTicketCount:Number(m.submitted_tickets)||0,approvedTicketCount:Number(m.approved_tickets)||0,totalLaborHours:Number(m.total_labor_hours)||0,todayLaborHours:Number(m.today_labor_hours)||0,todayWorkerCount:Number(m.today_worker_count)||0,lastActivityAt:m.last_activity_at,dailyReportsThisWeek:Number(m.daily_reports_this_week)||0,corCount:Number(m.cor_count)||0,pendingCorCount:Number(m.pending_cor_count)||0,disposalLoadsToday:Number(m.disposal_loads_today)||0}))}catch(i){return De.error("database",{message:i.message,operation:"getProjectDashboardSummary",company_id:n}),this.getProjectsWithSummary(n)}}return ne().projects.filter(l=>l.company_id===n&&l.status==="active")},async getArchivedProjects(n){if(v){const{data:l,error:i}=await y.from("projects").select("*").eq("company_id",n).eq("status","archived").order("archived_at",{ascending:!1});if(i)throw i;return l}else return ne().projects.filter(l=>l.status==="archived")},async getProjectCount(n){if(v){const{count:l,error:i}=await y.from("projects").select("*",{count:"exact",head:!0}).eq("company_id",n).in("status",["active","archived"]);if(i)throw i;return l||0}else return ne().projects.filter(i=>i.company_id===n&&i.status!=="deleted").length},async universalSearch(n,l,i=10){if(!v||!l?.trim())return{projects:[],tickets:[],cors:[],workers:[]};const o=l.trim().toLowerCase(),d={projects:[],tickets:[],cors:[],workers:[]};try{const{data:m}=await y.from("projects").select("id, name, job_number, address, status").eq("company_id",n).eq("status","active").or(`name.ilike.%${o}%,job_number.ilike.%${o}%,address.ilike.%${o}%`).limit(i);d.projects=m||[];const{data:h}=await y.from("t_and_m_tickets").select(`
          id, description, work_date, status, project_id,
          projects!inner(id, name, company_id)
        `).eq("projects.company_id",n).ilike("description",`%${o}%`).order("work_date",{ascending:!1}).limit(i);d.tickets=(h||[]).map(H=>({...H,projectName:H.projects?.name||"Unknown Project"}));const{data:g}=await y.from("change_orders").select(`
          id, cor_number, title, status, project_id,
          projects!inner(id, name, company_id)
        `).eq("projects.company_id",n).or(`title.ilike.%${o}%,cor_number.ilike.%${o}%`).order("created_at",{ascending:!1}).limit(i);d.cors=(g||[]).map(H=>({...H,projectName:H.projects?.name||"Unknown Project"}));const{data:b}=await y.from("crew_checkins").select(`
          workers,
          project_id,
          projects!inner(id, name, company_id)
        `).eq("projects.company_id",n).order("check_in_date",{ascending:!1}).limit(50),O=new Map;return(b||[]).forEach(H=>{(H.workers||[]).forEach(x=>{if(x.name.toLowerCase().includes(o)){const X=x.name.toLowerCase();O.has(X)||O.set(X,{name:x.name,role:x.role,projectName:H.projects?.name,lastProject:H.projects})}})}),d.workers=Array.from(O.values()).slice(0,i),d}catch(m){return console.error("Universal search error:",m),d}},async archiveProject(n){if(v){const{data:l,error:i}=await y.from("projects").update({status:"archived",archived_at:new Date().toISOString()}).eq("id",n).select().single();if(i)throw i;return l}else{const l=ne(),i=l.projects.find(o=>o.id===n);return i&&(i.status="archived",i.archived_at=new Date().toISOString(),ke(l)),i}},async getProjectStorageStats(n){if(!v)return{photoCount:0,estimatedMB:0};const{data:l,error:i}=await y.from("t_and_m_tickets").select("photos").eq("project_id",n);if(i)throw i;let o=0;const d=[];l?.forEach(h=>{h.photos&&Array.isArray(h.photos)&&(o+=h.photos.length,d.push(...h.photos))});const m=o*1.5;return{photoCount:o,estimatedMB:m,photoUrls:d}},async archiveProjectDeep(n,l){if(!v)return null;const{photoUrls:i}=await this.getProjectStorageStats(n);if(i.length>0){const m=i.map(h=>{try{const b=new URL(h).pathname.match(/\/tm-photos\/(.+)$/);return b?b[1]:null}catch{return null}}).filter(Boolean);if(m.length>0)for(let h=0;h<m.length;h+=100){const g=m.slice(h,h+100);await y.storage.from("tm-photos").remove(g)}}await y.from("t_and_m_tickets").update({photos:[]}).eq("project_id",n);const{data:o,error:d}=await y.from("projects").update({status:"archived",archived_at:new Date().toISOString(),photos:[],storage_cleaned:!0}).eq("id",n).select().single();if(d)throw d;return{...o,photosDeleted:i.length}},async restoreProject(n){if(v){const{data:l,error:i}=await y.from("projects").update({status:"active",archived_at:null}).eq("id",n).select().single();if(i)throw i;return l}else{const l=ne(),i=l.projects.find(o=>o.id===n);return i&&(i.status="active",i.archived_at=null,ke(l)),i}},async getProject(n){if(v){const{data:l,error:i}=await y.from("projects").select("*").eq("id",n).single();if(i)throw i;return l}else return ne().projects.find(l=>l.id===n)},async createProject(n){if(v){const{data:l,error:i}=await y.from("projects").insert({...n,status:"active"}).select().single();if(i)throw console.error("Supabase createProject error:",i.message,i.details,i.hint),i;return l}else{const l=ne(),i={...n,id:crypto.randomUUID(),status:"active",created_at:new Date().toISOString()};return l.projects.push(i),ke(l),i}},async getProjectByPin(n){if(v){const{data:l,error:i}=await y.from("projects").select("*").eq("pin",n).eq("status","active").single();return i?null:l}else return ne().projects.find(i=>i.pin===n&&i.status==="active")||null},async getProjectByPinAndCompany(n,l){if(v){const{data:i,error:o}=await y.from("projects").select("*").eq("pin",n).eq("company_id",l).eq("status","active").single();return o?null:i}else return ne().projects.find(o=>o.pin===n&&o.company_id===l&&o.status==="active")||null},async getProjectByPinSecure(n,l){if(v){const i=`pin_attempts_${l}`,o=`pin_lockout_${l}`,d=5,m=300*1e3,h=localStorage.getItem(o);if(h&&Date.now()<parseInt(h)){const $=parseInt(h)-Date.now(),M=Math.ceil($/6e4);return{success:!1,rateLimited:!0,project:null,error:`Too many attempts. Please try again in ${M} minute${M>1?"s":""}.`}}let g=parseInt(localStorage.getItem(i)||"0");if(g++,localStorage.setItem(i,g.toString()),g>d)return localStorage.setItem(o,(Date.now()+m).toString()),{success:!1,rateLimited:!0,project:null,error:"Too many failed attempts. Please try again in 5 minutes."};const b=__(),{data:O,error:H}=await y.rpc("validate_pin_and_create_session",{p_pin:n,p_company_code:l,p_device_id:b,p_ip_address:null});if(H)return console.error("[PIN Auth] RPC error"),{success:!1,rateLimited:!1,project:null,error:H.message};if(!O||O.length===0)return{success:!1,rateLimited:!1,project:null};const x=O[0];if(x.error_code==="RATE_LIMITED")return{success:!1,rateLimited:!0,project:null};if(x.error_code==="INVALID_COMPANY"||x.error_code==="INVALID_PIN")return{success:!1,rateLimited:!1,project:null};if(!x.success||!x.project_id)return{success:!1,rateLimited:!1,project:null};localStorage.removeItem(`pin_attempts_${l}`),localStorage.removeItem(`pin_lockout_${l}`),eu({token:x.session_token,projectId:x.project_id,companyId:x.company_id,projectName:x.project_name,companyName:x.company_name,createdAt:new Date().toISOString()});const X=vh(),{data:re,error:F}=await X.from("projects").select("*").eq("id",x.project_id).single();return{success:!0,rateLimited:!1,sessionToken:x.session_token,project:re||{id:x.project_id,name:x.project_name,company_id:x.company_id,status:"active"}}}else{const i=ne(),d=(i.companies||[]).find(h=>h.code===l);if(!d)return{success:!1,rateLimited:!1,project:null};const m=i.projects.find(h=>h.pin===n&&h.company_id===d.id&&h.status==="active");if(m){const h=`demo_${Date.now()}_${Math.random().toString(36).slice(2)}`;eu({token:h,projectId:m.id,companyId:d.id,projectName:m.name,companyName:d.name,createdAt:new Date().toISOString()})}return{success:!!m,rateLimited:!1,project:m||null}}},async isPinAvailable(n,l=null){if(v){let i=y.from("projects").select("id").eq("pin",n);l&&(i=i.neq("id",l));const{data:o,error:d}=await i;if(d)throw d;return o.length===0}else return!ne().projects.some(o=>o.pin===n&&o.id!==l)},async updateProjectPin(n,l){if(v){const{data:i,error:o}=await y.from("projects").update({pin:l}).eq("id",n).select().single();if(o)throw o;return i}else{const i=ne(),o=i.projects.find(d=>d.id===n);return o&&(o.pin=l,ke(i)),o}},async updateProject(n,l,i=null){if(v){if(!i)throw console.error("[Security] updateProject called without companyId - this is a security risk"),new Error("Company ID is required for security verification");const{data:o,error:d}=await y.from("projects").update(l).eq("id",n).eq("company_id",i).select().single();if(d)throw console.error("Error updating project"),d;return o}else{const o=ne(),d=o.projects.find(m=>m.id===n);return d&&(Object.assign(d,l),ke(o)),d}},async deleteProject(n,l=null){if(v){let i=y.from("projects").delete().eq("id",n);l&&(i=i.eq("company_id",l));const{error:o}=await i;if(o)throw o}else{const i=ne();i.projects=i.projects.filter(o=>o.id!==n),i.areas=i.areas.filter(o=>o.project_id!==n),ke(i)}},async getAreas(n){if(v){if(!ja())return Wf(n);const l=ce(),{data:i,error:o}=await l.from("areas").select("*").eq("project_id",n).order("sort_order",{ascending:!0});if(o){const d=await Wf(n);if(d.length>0)return d;throw o}return i?.length>0&&h_(i).catch(d=>console.error("Failed to cache areas:",d)),i}else return ne().areas.filter(l=>l.project_id===n)},async createArea(n){if(v){const l=ce(),{data:i,error:o}=await l.from("areas").insert(n).select().single();if(o)throw o;return i}else{const l=ne(),i={...n,id:crypto.randomUUID(),created_at:new Date().toISOString()};return l.areas.push(i),ke(l),i}},async updateAreaStatus(n,l,i=null){if(v){if(!ja()){const g=await Vc(n,l);return await sa(xt.UPDATE_AREA_STATUS,{areaId:n,status:l}),g}let d=ce().from("areas").update({status:l}).eq("id",n);i&&(d=d.eq("project_id",i));const{data:m,error:h}=await d.select().single();if(h){if(h.message?.includes("fetch")||h.message?.includes("network")){const g=await Vc(n,l);return await sa(xt.UPDATE_AREA_STATUS,{areaId:n,status:l}),g}throw h}return m&&Vc(n,l).catch(g=>console.error("Failed to update cached area status:",g)),m}else{const o=ne(),d=o.areas.find(m=>m.id===n);return d&&(d.status=l,d.updated_at=new Date().toISOString()),ke(o),d}},async updateArea(n,l,i=null){if(v){let o=y.from("areas").update(l).eq("id",n);i&&(o=o.eq("project_id",i));const{data:d,error:m}=await o.select().single();if(m)throw m;return d}else{const o=ne(),d=o.areas.find(m=>m.id===n);return d&&(Object.assign(d,l),d.updated_at=new Date().toISOString()),ke(o),d}},async deleteArea(n,l=null){if(v){let i=y.from("areas").delete().eq("id",n);l&&(i=i.eq("project_id",l));const{error:o}=await i;if(o)throw o}else{const i=ne();i.areas=i.areas.filter(o=>o.id!==n),ke(i)}},subscribeToAreas(n,l){return v?y.channel(`areas:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"areas",filter:`project_id=eq.${n}`},l).subscribe():null},subscribeToMessages(n,l){return v?y.channel(`messages:${n}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${n}`},l).subscribe():null},subscribeToMaterialRequests(n,l){return v?y.channel(`material_requests:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"material_requests",filter:`project_id=eq.${n}`},l).subscribe():null},subscribeToDailyReports(n,l){return v?y.channel(`daily_reports:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"daily_reports",filter:`project_id=eq.${n}`},l).subscribe():null},subscribeToCrewCheckins(n,l){return v?y.channel(`crew_checkins:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"crew_checkins",filter:`project_id=eq.${n}`},l).subscribe():null},subscribeToInjuryReports(n,l){return v?y.channel(`injury_reports:${n}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${n}`},l).subscribe():null},subscribeToTMTickets(n,l){return v?y.channel(`tm_tickets:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${n}`},l).subscribe():null},subscribeToCompanyActivity(n,l,i){if(!v||!l||l.length===0)return null;const o=y.channel(`company_activity:${n}`);return l.forEach(d=>{o.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${d}`},m=>i.onMessage?.(m)),o.on("postgres_changes",{event:"INSERT",schema:"public",table:"material_requests",filter:`project_id=eq.${d}`},m=>i.onMaterialRequest?.(m)),o.on("postgres_changes",{event:"INSERT",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${d}`},m=>i.onTMTicket?.(m)),o.on("postgres_changes",{event:"UPDATE",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${d}`},m=>i.onTMTicket?.(m)),o.on("postgres_changes",{event:"INSERT",schema:"public",table:"crew_checkins",filter:`project_id=eq.${d}`},m=>i.onCrewCheckin?.(m)),o.on("postgres_changes",{event:"UPDATE",schema:"public",table:"crew_checkins",filter:`project_id=eq.${d}`},m=>i.onCrewCheckin?.(m)),o.on("postgres_changes",{event:"UPDATE",schema:"public",table:"areas",filter:`project_id=eq.${d}`},m=>i.onAreaUpdate?.(m)),o.on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${d}`},m=>i.onCORChange?.(m))}),o.on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${n}`},d=>i.onInjuryReport?.(d)),o.subscribe()},unsubscribe(n){n&&v&&y.removeChannel(n)},async getAssignedProjects(n){if(v){const{data:l,error:i}=await y.from("project_assignments").select(`
          project_id,
          projects (*)
        `).eq("user_id",n);if(i)throw i;return l.map(o=>o.projects)}else{const l=ne();return(l.assignments?.filter(o=>o.user_id===n)||[]).map(o=>l.projects.find(d=>d.id===o.project_id)).filter(Boolean)}},async assignUserToProject(n,l,i){if(v){const{data:o,error:d}=await y.from("project_assignments").insert({project_id:n,user_id:l,assigned_by:i}).select().single();if(d)throw d;return o}else{const o=ne();o.assignments||(o.assignments=[]);const d={id:crypto.randomUUID(),project_id:n,user_id:l,assigned_by:i,assigned_at:new Date().toISOString()};return o.assignments.push(d),ke(o),d}},async removeUserFromProject(n,l){if(v){const{error:i}=await y.from("project_assignments").delete().eq("project_id",n).eq("user_id",l);if(i)throw i}else{const i=ne();i.assignments=i.assignments?.filter(o=>!(o.project_id===n&&o.user_id===l))||[],ke(i)}},async getProjectAssignments(n){if(v){const{data:l,error:i}=await y.from("project_assignments").select(`
          user_id,
          users (id, email, name, role)
        `).eq("project_id",n);if(i)throw i;return l.map(o=>o.users)}else{const l=ne();return(l.assignments?.filter(o=>o.project_id===n)||[]).map(o=>l.users.find(d=>d.id===o.user_id)).filter(Boolean)}},async getAllUsers(){if(v){const{data:n,error:l}=await y.from("users").select("*").order("name");if(l)throw l;return n}else return ne().users||[]},async getForemen(){if(v){const{data:n,error:l}=await y.from("users").select("*").eq("role","foreman").order("name");if(l)throw l;return n}else return(ne().users||[]).filter(n=>n.role==="foreman")},async logActivity(n,l,i,o,d,m){if(v){const{error:h}=await y.from("activity_log").insert({user_id:n,project_id:l,area_id:i,action:o,old_value:d,new_value:m});h&&console.error("Error logging activity:",h)}},async getProjectActivity(n,l=50){if(v){const{data:i,error:o}=await y.from("activity_log").select(`
          *,
          users (name, email),
          areas (name)
        `).eq("project_id",n).order("created_at",{ascending:!1}).limit(l);if(o)throw o;return i}return[]},async getMaterialsEquipment(n){if(v){const{data:l,error:i}=await y.from("materials_equipment").select("*").eq("company_id",n).eq("active",!0).order("category").order("name");if(i)throw i;return l}return[]},async getMaterialsEquipmentByCategory(n,l){if(v){const i=ce();if(!i)return[];const{data:o,error:d}=await i.from("materials_equipment").select("*").eq("company_id",n).eq("category",l).eq("active",!0).order("name");if(d)throw d;return o}return[]},async getAllMaterialsEquipment(n){if(v){const l=ce();if(!l)return[];const{data:i,error:o}=await l.from("materials_equipment").select("*").eq("company_id",n).order("category").order("name");if(o)throw o;return i}return[]},async createMaterialEquipment(n){if(v){const{data:l,error:i}=await y.from("materials_equipment").insert(n).select().single();if(i)throw i;return l}return null},async updateMaterialEquipment(n,l){if(v){const{data:i,error:o}=await y.from("materials_equipment").update(l).eq("id",n).select().single();if(o)throw o;return i}return null},async deleteMaterialEquipment(n){if(v){const{error:l}=await y.from("materials_equipment").update({active:!1}).eq("id",n);if(l)throw l}},async getLaborCategories(n){if(v){const{data:l,error:i}=await y.from("labor_categories").select("*").eq("company_id",n).eq("active",!0).order("sort_order").order("name");if(i)throw i;return l||[]}return[]},async createLaborCategory(n,l,i=0){if(v){const{data:o,error:d}=await y.from("labor_categories").insert({company_id:n,name:l,sort_order:i}).select().single();if(d)throw d;return o}return null},async updateLaborCategory(n,l){if(v){const{data:i,error:o}=await y.from("labor_categories").update(l).eq("id",n).select().single();if(o)throw o;return i}return null},async deleteLaborCategory(n){if(v){const{error:l}=await y.from("labor_categories").update({active:!1}).eq("id",n);if(l)throw l}},async getLaborClasses(n){if(v){const{data:l,error:i}=await y.from("labor_classes").select(`
          *,
          labor_categories (id, name)
        `).eq("company_id",n).eq("active",!0).order("sort_order").order("name");if(i)throw i;return l||[]}return[]},async getLaborClassesWithCategories(n){if(v){const[l,i]=await Promise.all([y.from("labor_categories").select("*").eq("company_id",n).eq("active",!0).order("sort_order").order("name"),y.from("labor_classes").select("*").eq("company_id",n).eq("active",!0).order("sort_order").order("name")]);if(l.error)throw l.error;if(i.error)throw i.error;return{categories:l.data||[],classes:i.data||[]}}return{categories:[],classes:[]}},async getLaborClassesForField(n){if(v){const l=ce();if(!l)return{categories:[],classes:[]};const{data:i,error:o}=await l.rpc("get_labor_classes_for_field",{p_company_id:n});if(o){console.error("Error loading field labor classes:",o);const[h,g]=await Promise.all([l.from("labor_categories").select("id, name").eq("company_id",n).eq("active",!0).order("name"),l.from("labor_classes").select("id, name, category_id").eq("company_id",n).eq("active",!0).order("name")]);return{categories:h.data||[],classes:g.data||[]}}const d=new Map,m=[];for(const h of i||[])h.category_id&&h.category_name&&!d.has(h.category_id)&&d.set(h.category_id,{id:h.category_id,name:h.category_name}),m.push({id:h.id,name:h.name,category_id:h.category_id});return{categories:Array.from(d.values()),classes:m}}return{categories:[],classes:[]}},async createLaborClass(n,l,i,o=0){if(v){const{data:d,error:m}=await y.from("labor_classes").insert({company_id:n,category_id:l,name:i,sort_order:o}).select().single();if(m)throw m;return d}return null},async updateLaborClass(n,l){if(v){const{data:i,error:o}=await y.from("labor_classes").update(l).eq("id",n).select().single();if(o)throw o;return i}return null},async deleteLaborClass(n){if(v){const{error:l}=await y.from("labor_classes").update({active:!1}).eq("id",n);if(l)throw l}},async getLaborClassRates(n){if(v){const{data:l,error:i}=await y.from("labor_class_rates").select("*").eq("labor_class_id",n);if(i)throw i;return l||[]}return[]},async getAllLaborClassRates(n){if(v){const{data:l,error:i}=await y.from("labor_classes").select(`
          id,
          name,
          labor_class_rates (*)
        `).eq("company_id",n).eq("active",!0);if(i)throw i;return l||[]}return[]},async saveLaborClassRates(n,l){if(v){const i=l.map(d=>({...d,labor_class_id:n})),{error:o}=await y.from("labor_class_rates").upsert(i,{onConflict:"labor_class_id,work_type,job_type"});if(o)throw o}},async getLaborClassRate(n,l,i){if(v){const{data:o,error:d}=await y.from("labor_class_rates").select("regular_rate, overtime_rate").eq("labor_class_id",n).eq("work_type",l).eq("job_type",i).single();if(d&&d.code!=="PGRST116")throw d;return o||null}return null},async getTMTickets(n){if(v){const l=performance.now(),i=ce(),d=au()?"materials_equipment (name, unit, category)":"materials_equipment (name, unit, cost_per_unit, category)";try{const{data:m,error:h}=await i.from("t_and_m_tickets").select(`
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              ${d}
            )
          `).eq("project_id",n).order("created_at",{ascending:!1}),g=Math.round(performance.now()-l);if(De.query("getTMTickets",{duration:g,rows:m?.length,project_id:n}),h)throw h;return m}catch(m){throw De.error("database",{message:m.message,operation:"getTMTickets",project_id:n}),m}}return[]},async getTMTicketsPaginated(n,{page:l=0,limit:i=25,status:o=null}={}){if(v){const d=performance.now(),m=ce(),g=au()?"materials_equipment (name, unit, category)":"materials_equipment (name, unit, cost_per_unit, category)";try{let b=m.from("t_and_m_tickets").select(`
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              ${g}
            )
          `,{count:"exact"}).eq("project_id",n).order("created_at",{ascending:!1}).range(l*i,(l+1)*i-1);o&&(b=b.eq("status",o));const{data:O,error:H,count:x}=await b,X=Math.round(performance.now()-d);if(De.query("getTMTicketsPaginated",{duration:X,rows:O?.length,page:l,project_id:n}),H)throw H;return{tickets:O||[],totalCount:x||0,hasMore:(l+1)*i<(x||0),page:l,limit:i}}catch(b){throw De.error("database",{message:b.message,operation:"getTMTicketsPaginated",project_id:n}),b}}return{tickets:[],totalCount:0,hasMore:!1,page:0,limit:25}},async getChangeOrderTotals(n){if(v){const{data:l,error:i}=await y.from("t_and_m_tickets").select("ce_pco_number, change_order_value, status").eq("project_id",n).not("ce_pco_number","is",null).neq("ce_pco_number","");if(i)throw i;const o={};let d=0,m=0;return l?.forEach(h=>{const g=h.ce_pco_number;if(o[g]||(o[g]={approved:0,pending:0,count:0}),o[g].count++,h.status==="approved"||h.status==="billed"){const b=parseFloat(h.change_order_value)||0;o[g].approved+=b,d+=b}else h.status==="pending"&&m++}),{changeOrders:o,totalApprovedValue:d,pendingCount:m}}return{changeOrders:{},totalApprovedValue:0,pendingCount:0}},async getTMTicketsByStatus(n,l){if(v){const{data:i,error:o}=await y.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",n).eq("status",l).order("created_at",{ascending:!1});if(o)throw o;return i}return[]},async getCORTickets(n){if(v){const{data:l,error:i}=await y.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("assigned_cor_id",n).order("work_date",{ascending:!0});if(i)throw i;return l||[]}return[]},async createTMTicket(n){if(v){if(!ja()){const d={id:Jt(),project_id:n.project_id,work_date:n.work_date,ce_pco_number:n.ce_pco_number||null,assigned_cor_id:n.assigned_cor_id||null,notes:n.notes,photos:n.photos||[],status:"pending_sync",created_by_name:n.created_by_name||"Field User",created_at:new Date().toISOString(),_offline:!0};return await Pf(d),await sa(xt.CREATE_TM_TICKET,{ticket:d,workers:n._workers||[],items:n._items||[]}),d}const l=ce();if(!l)throw new Error("Database client not available");const{data:i,error:o}=await l.from("t_and_m_tickets").insert({project_id:n.project_id,work_date:n.work_date,ce_pco_number:n.ce_pco_number||null,assigned_cor_id:n.assigned_cor_id||null,notes:n.notes,photos:n.photos||[],status:"pending",created_by_name:n.created_by_name||"Field User"}).select().single();if(o){if(o.message?.includes("fetch")||o.message?.includes("network")){const d={id:Jt(),...n,status:"pending_sync",_offline:!0};return await Pf(d),await sa(xt.CREATE_TM_TICKET,{ticket:d,workers:n._workers||[],items:n._items||[]}),d}throw o}return i}return null},async addTMWorkers(n,l){if(v){const i=l.map(m=>({ticket_id:n,name:m.name,hours:m.hours,overtime_hours:m.overtime_hours||0,time_started:m.time_started||null,time_ended:m.time_ended||null,role:m.role||"Laborer"})),o=ce();if(!o)throw new Error("Database client not available");const{error:d}=await o.from("t_and_m_workers").insert(i);if(d)throw d}},async addTMItems(n,l){if(v){const i=l.map(m=>({ticket_id:n,material_equipment_id:m.material_equipment_id||null,custom_name:m.custom_name||null,custom_category:m.custom_category||null,quantity:m.quantity})),o=ce();if(!o)throw new Error("Database client not available");const{error:d}=await o.from("t_and_m_items").insert(i);if(d)throw d}},async getPreviousTicketCrew(n,l){if(!v)return null;const i=ce();if(!i)return null;const{data:o,error:d}=await i.from("t_and_m_tickets").select(`
        id,
        work_date,
        t_and_m_workers (*)
      `).eq("project_id",n).lt("work_date",l).order("work_date",{ascending:!1}).limit(1).maybeSingle();if(d||!o)return null;const m=o.t_and_m_workers||[],h=m.some(x=>x.labor_class_id),g={};h&&m.forEach(x=>{x.labor_class_id&&(g[x.labor_class_id]||(g[x.labor_class_id]=[]),g[x.labor_class_id].push({name:x.name,hours:x.hours?.toString()||"",overtimeHours:x.overtime_hours?.toString()||"",timeStarted:x.time_started||"",timeEnded:x.time_ended||""}))});const b=m.filter(x=>["Foreman","General Foreman","Superintendent"].includes(x.role)).map(x=>({name:x.name,hours:x.hours?.toString()||"",overtimeHours:x.overtime_hours?.toString()||"",timeStarted:x.time_started||"",timeEnded:x.time_ended||"",role:x.role})),O=m.filter(x=>x.role==="Operator").map(x=>({name:x.name,hours:x.hours?.toString()||"",overtimeHours:x.overtime_hours?.toString()||"",timeStarted:x.time_started||"",timeEnded:x.time_ended||""})),H=m.filter(x=>x.role==="Laborer").map(x=>({name:x.name,hours:x.hours?.toString()||"",overtimeHours:x.overtime_hours?.toString()||"",timeStarted:x.time_started||"",timeEnded:x.time_ended||""}));return{workDate:o.work_date,supervision:b.length>0?b:null,operators:O.length>0?O:null,laborers:H.length>0?H:null,dynamicWorkers:Object.keys(g).length>0?g:null,totalWorkers:m.length}},async updateTMTicketStatus(n,l){if(v){const{data:i,error:o}=await y.from("t_and_m_tickets").update({status:l}).eq("id",n).select().single();if(o)throw o;return i}return null},async approveTMTicket(n,l,i,o=null){if(v){const d={status:"approved",approved_by_user_id:l,approved_by_name:i,approved_at:new Date().toISOString(),rejected_by_user_id:null,rejected_by_name:null,rejected_at:null,rejection_reason:null};o!==null&&(d.change_order_value=parseFloat(o)||0);const{data:m,error:h}=await y.from("t_and_m_tickets").update(d).eq("id",n).select().single();if(h)throw h;return m}return null},async rejectTMTicket(n,l,i,o=""){if(v){const{data:d,error:m}=await y.from("t_and_m_tickets").update({status:"rejected",rejected_by_user_id:l,rejected_by_name:i,rejected_at:new Date().toISOString(),rejection_reason:o,approved_by_user_id:null,approved_by_name:null,approved_at:null}).eq("id",n).select().single();if(m)throw m;return d}return null},canApproveTickets(n){return["owner","admin","manager"].includes(n)},async updateTMTicketPhotos(n,l){if(v){const i=ce();if(!i)throw new Error("Database client not available");const{data:o,error:d}=await i.from("t_and_m_tickets").update({photos:l}).eq("id",n).select().single();if(d)throw d;return o}return null},async saveTMClientSignature(n,l){if(v){const i=ce();if(!i)throw new Error("Database client not available");const{data:o,error:d}=await i.from("t_and_m_tickets").update({client_signature_data:l.signature,client_signature_name:l.signerName,client_signature_title:l.signerTitle,client_signature_company:l.signerCompany,client_signature_date:l.signedAt,client_signature_ip:null,status:"client_signed"}).eq("id",n).select().single();if(d)throw d;return o}return null},async deleteTMTicket(n){if(v){const{error:l}=await y.from("t_and_m_tickets").delete().eq("id",n);if(l)throw l}},async isTicketEditable(n){if(!n?.assigned_cor_id)return{editable:!0};if(v)try{const{data:l,error:i}=await y.from("change_orders").select("id, status, cor_number").eq("id",n.assigned_cor_id).single();if(i||!l)return{editable:!0};const d=["draft","pending_approval"].includes(l.status);return{editable:d,lockedBy:d?null:l,reason:d?null:`This ticket is linked to ${l.cor_number} which has been ${l.status==="approved"?"approved":l.status}`}}catch(l){return console.error("Error checking ticket editability:",l),{editable:!0}}return{editable:!0}},async getCompanyByCode(n){if(v){const{data:l,error:i}=await y.from("companies").select("*").eq("code",n).single();return i?null:l}return null},async getCompany(n){if(v){const{data:l,error:i}=await y.from("companies").select("*").eq("id",n).single();if(i)throw i;return l}return null},async getUserCompanies(n){if(v){const{data:l,error:i}=await y.from("user_companies").select(`
          id,
          access_level,
          company_id,
          status,
          companies (
            id,
            name,
            code
          )
        `).eq("user_id",n).eq("status","active").order("created_at",{ascending:!0});return i?(console.error("Error fetching user companies:",i),[]):l.map(o=>({id:o.companies.id,name:o.companies.name,code:o.companies.code,access_level:o.access_level}))}return[]},async getUserPendingMemberships(n){if(v){const{count:l,error:i}=await y.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",n).eq("status","pending");return i?(console.error("Error fetching pending memberships:",i),0):l||0}return 0},async getCompanyMemberships(n){if(v){const{data:l,error:i}=await y.from("user_companies").select(`
          id,
          access_level,
          company_role,
          status,
          created_at,
          approved_at,
          approved_by,
          removed_at,
          removed_by,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",n).order("created_at",{ascending:!1});return i?(console.error("Error fetching company memberships:",i),[]):l||[]}return[]},async approveMembership(n,l){if(v){const{error:i}=await y.from("user_companies").update({status:"active",approved_at:new Date().toISOString(),approved_by:l}).eq("id",n);if(i)throw i}},async approveMembershipWithRole(n,l,i="member"){if(v){const{error:o}=await y.rpc("approve_membership_with_role",{membership_id:n,approved_by_user:l,new_access_level:i});if(o)throw o}},async rejectMembership(n){if(v){const{error:l}=await y.from("user_companies").delete().eq("id",n);if(l)throw l}},async removeMember(n,l){if(v){const{error:i}=await y.from("user_companies").update({status:"removed",removed_at:new Date().toISOString(),removed_by:l}).eq("id",n);if(i)throw i}},async getProjectTeam(n){if(v){const{data:l,error:i}=await y.from("project_users").select(`
          id,
          project_role,
          assigned_at,
          notes,
          users!project_users_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("project_id",n).order("assigned_at",{ascending:!0});return i?(console.error("Error fetching project team:",i),[]):l||[]}return[]},async getCompanyMembers(n){if(v){const{data:l,error:i}=await y.from("user_companies").select(`
          id,
          access_level,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",n).eq("status","active").order("created_at",{ascending:!0});return i?(console.error("Error fetching company members:",i),[]):l||[]}return[]},async addProjectMember(n,l,i,o){if(v){const{data:d,error:m}=await y.from("project_users").insert({project_id:n,user_id:l,project_role:i,assigned_by:o}).select().single();if(m)throw m;return d}return null},async updateProjectMemberRole(n,l,i){if(v){const{error:o}=await y.from("project_users").update({project_role:i}).eq("project_id",n).eq("user_id",l);if(o)throw o}},async removeProjectMember(n,l){if(v){const{error:i}=await y.from("project_users").delete().eq("project_id",n).eq("user_id",l);if(i)throw i}},async updateMemberAccessLevel(n,l){if(v){const{error:i}=await y.from("user_companies").update({access_level:l}).eq("id",n);if(i)throw i}},async updateMemberCompanyRole(n,l){if(v){const{error:i}=await y.from("user_companies").update({company_role:l}).eq("id",n);if(i)throw i}},async repairLegacyUser(n,l,i="member"){if(!v||!n||!l)return!1;try{const{data:o,error:d}=await y.rpc("repair_legacy_user",{p_user_id:n,p_company_id:l,p_role:i});return d?(console.error("RPC repair_legacy_user failed:",d),!1):o===!0}catch(o){return console.error("Error repairing legacy user:",o),!1}},async isLegacyUser(n){if(!v)return!1;try{const{data:l}=await y.from("users").select("company_id, role").eq("id",n).single();if(!l?.company_id)return!1;const{count:i}=await y.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",n);return i===0}catch(l){return console.error("Error checking legacy user:",l),!1}},DISPOSAL_LOAD_TYPES:[{value:"concrete",label:"Concrete"},{value:"trash",label:"Trash"},{value:"metals",label:"Metals"},{value:"hazardous_waste",label:"Hazardous Waste"}],async getDisposalLoads(n,l){if(!v)return[];const i=performance.now();try{const{data:o,error:d}=await y.from("disposal_loads").select("*").eq("project_id",n).eq("work_date",l).order("created_at",{ascending:!1}),m=Math.round(performance.now()-i);if(De.query("getDisposalLoads",{duration:m,rows:o?.length,project_id:n}),d)throw d;return o||[]}catch(o){throw De.error("database",{message:o.message,operation:"getDisposalLoads",project_id:n}),o}},async getDisposalLoadsHistory(n,l=14){if(!v)return[];const i=performance.now();try{const o=new Date,d=new Date;d.setDate(d.getDate()-l);const{data:m,error:h}=await y.from("disposal_loads").select("*").eq("project_id",n).gte("work_date",d.toISOString().split("T")[0]).lte("work_date",o.toISOString().split("T")[0]).order("work_date",{ascending:!1}),g=Math.round(performance.now()-i);if(De.query("getDisposalLoadsHistory",{duration:g,rows:m?.length,project_id:n}),h)throw h;return(m||[]).map(b=>({...b,load_date:b.work_date}))}catch(o){throw De.error("database",{message:o.message,operation:"getDisposalLoadsHistory",project_id:n}),o}},async addDisposalLoad(n,l,i,o,d,m=null){if(!v)return null;const{data:h,error:g}=await y.from("disposal_loads").insert({project_id:n,user_id:l,work_date:i,load_type:o,load_count:d,notes:m}).select().single();if(g)throw De.error("database",{message:g.message,operation:"addDisposalLoad",project_id:n}),g;return h},async updateDisposalLoad(n,l,i,o=null){if(!v)return null;const{data:d,error:m}=await y.from("disposal_loads").update({load_type:l,load_count:i,notes:o}).eq("id",n).select().single();if(m)throw De.error("database",{message:m.message,operation:"updateDisposalLoad"}),m;return d},async deleteDisposalLoad(n){if(!v)return!1;const{error:l}=await y.from("disposal_loads").delete().eq("id",n);if(l)throw De.error("database",{message:l.message,operation:"deleteDisposalLoad"}),l;return!0},async getDisposalSummary(n,l=null,i=null){if(!v)return[];const o=performance.now();try{const{data:d,error:m}=await y.rpc("get_disposal_summary",{p_project_id:n,p_start_date:l,p_end_date:i}),h=Math.round(performance.now()-o);if(De.query("getDisposalSummary",{duration:h,rows:d?.length,project_id:n}),m)throw m;return d||[]}catch(d){return De.error("database",{message:d.message,operation:"getDisposalSummary",project_id:n}),this.getDisposalSummaryFallback(n,l,i)}},async getDisposalSummaryFallback(n,l,i){let o=y.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",n);l&&(o=o.gte("work_date",l)),i&&(o=o.lte("work_date",i));const{data:d,error:m}=await o;if(m)throw m;const h={};return d?.forEach(g=>{h[g.load_type]||(h[g.load_type]={load_type:g.load_type,total_loads:0,days:new Set}),h[g.load_type].total_loads+=g.load_count,h[g.load_type].days.add(g.work_date)}),Object.values(h).map(g=>({load_type:g.load_type,total_loads:g.total_loads,days_with_activity:g.days.size}))},async getWeeklyDisposalSummary(n,l=4){if(!v)return[];const i=new Date,o=new Date;o.setDate(o.getDate()-l*7);const{data:d,error:m}=await y.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",n).gte("work_date",o.toISOString().split("T")[0]).lte("work_date",i.toISOString().split("T")[0]).order("work_date",{ascending:!0});if(m)throw m;const h={};return d?.forEach(g=>{const b=new Date(g.work_date),O=new Date(b);O.setDate(b.getDate()-b.getDay());const H=O.toISOString().split("T")[0];h[H]||(h[H]={week:H,concrete:0,trash:0,metals:0,hazardous_waste:0}),h[H][g.load_type]+=g.load_count}),Object.values(h).sort((g,b)=>g.week.localeCompare(b.week))},async uploadPhoto(n,l,i,o){if(!v)return null;const d=ce();if(!d)throw new Error("Database client not available");const m=performance.now(),h=o.size||0,g=Date.now(),b=new Uint8Array(6);crypto.getRandomValues(b);const O=Array.from(b,re=>re.toString(36)).join(""),H=o.name?.split(".").pop()||"jpg",x=`${g}-${O}.${H}`,X=`${n}/${l}/${i}/${x}`;try{const{data:re,error:F}=await d.storage.from("tm-photos").upload(X,o,{cacheControl:"3600",upsert:!1}),$=Math.round(performance.now()-m);if(De.storage("upload",{company_id:n,project_id:l,size:h,duration:$,success:!F}),F)throw F;const{data:M}=d.storage.from("tm-photos").getPublicUrl(X);return M.publicUrl}catch(re){throw De.error("storage",{message:re.message,operation:"uploadPhoto",company_id:n,project_id:l}),re}},async uploadPhotoBase64(n,l,i,o,d="photo.jpg"){if(!v)return null;const m=ce();if(!m)throw new Error("Database client not available");const g=await(await fetch(o)).blob(),b=Date.now(),O=new Uint8Array(6);crypto.getRandomValues(O);const H=Array.from(O,K=>K.toString(36)).join(""),x=d.split(".").pop()||"jpg",X=`${b}-${H}.${x}`,re=`${n}/${l}/${i}/${X}`,{data:F,error:$}=await m.storage.from("tm-photos").upload(re,g,{cacheControl:"3600",upsert:!1,contentType:g.type});if($)throw $;const{data:M}=m.storage.from("tm-photos").getPublicUrl(re);return M.publicUrl},async deletePhoto(n){if(!v)return;const i=new URL(n).pathname.match(/\/tm-photos\/(.+)$/);if(!i)return;const o=i[1],{error:d}=await y.storage.from("tm-photos").remove([o]);if(d)throw d},async verifyPhotoAccessible(n){if(!v||!n)return{accessible:!1,error:"Invalid URL"};try{const l=await fetch(n,{method:"HEAD"});return{accessible:l.ok,status:l.status,error:l.ok?null:`HTTP ${l.status}`}}catch(l){return{accessible:!1,error:l.message||"Network error"}}},async verifyTicketPhotos(n){if(!v)return{verified:!1,issues:[]};try{const{data:l,error:i}=await y.from("t_and_m_tickets").select("photos").eq("id",n).single();if(i)throw i;if(!l?.photos||l.photos.length===0)return await y.from("t_and_m_tickets").update({photos_verified_at:new Date().toISOString(),photos_verification_status:"empty",photos_issue_count:0}).eq("id",n),{verified:!0,status:"empty",issues:[]};const o=[];for(const m of l.photos){const h=await this.verifyPhotoAccessible(m);h.accessible||o.push({url:m,error:h.error})}const d=o.length===0?"verified":"issues";return await y.from("t_and_m_tickets").update({photos_verified_at:new Date().toISOString(),photos_verification_status:d,photos_issue_count:o.length}).eq("id",n),{verified:o.length===0,status:d,totalPhotos:l.photos.length,issues:o}}catch(l){return console.error("Error verifying ticket photos:",l),{verified:!1,error:l.message,issues:[]}}},async queuePhotoUpload(n,l,i,o){if(!v)return null;const{data:d,error:m}=await y.from("photo_upload_queue").insert({ticket_id:n,temp_id:l,file_name:i,file_size_bytes:o,status:"pending"}).select().single();return m?(console.error("Error queueing photo upload:",m),null):d},async confirmQueuedUpload(n,l,i){if(!v)return!1;const{data:o,error:d}=await y.rpc("confirm_photo_upload",{p_queue_id:n,p_uploaded_url:l,p_storage_path:i});return d?(console.error("Error confirming photo upload:",d),!1):o===!0},async markQueuedUploadFailed(n,l){if(!v)return!1;const{data:i,error:o}=await y.rpc("mark_photo_upload_failed",{p_queue_id:n,p_error:l});return o?(console.error("Error marking photo upload failed:",o),!1):i===!0},async getPendingPhotoUploads(n){if(!v)return[];const{data:l,error:i}=await y.rpc("get_pending_photo_uploads",{p_ticket_id:n});return i?(console.error("Error getting pending photo uploads:",i),[]):l||[]},async logPhotoOperation(n,l,i={}){if(v)try{await y.from("photo_audit_log").insert({ticket_id:n,cor_id:i.corId||null,operation:l,photo_url:i.photoUrl||null,storage_path:i.storagePath||null,details:i.metadata?i.metadata:null,error_message:i.error||null,triggered_by:i.triggeredBy||"system"})}catch(o){console.error("Error logging photo operation:",o)}},async saveExportSnapshot(n,l,i={}){if(!v)return null;const{exportType:o="pdf",exportReason:d=null,clientEmail:m=null,clientName:h=null}=i;try{const{data:g,error:b}=await y.from("cor_export_snapshots").insert({cor_id:n,export_type:o,export_reason:d,cor_data:l.cor_data,tickets_data:l.tickets_data,photos_manifest:l.photos_manifest,totals_snapshot:l.totals_snapshot,checksum:l.checksum,client_email:m,client_name:h}).select().single();if(b)throw b;return g}catch(g){return console.error("Error saving export snapshot:",g),null}},async getExportSnapshots(n){if(!v)return[];const{data:l,error:i}=await y.from("cor_export_snapshots").select("id, exported_at, export_type, export_reason, client_name, client_email, checksum").eq("cor_id",n).order("exported_at",{ascending:!1});return i?(console.error("Error fetching export snapshots:",i),[]):l||[]},async getExportSnapshot(n){if(!v)return null;const{data:l,error:i}=await y.from("cor_export_snapshots").select("*").eq("id",n).single();return i?(console.error("Error fetching export snapshot:",i),null):l},async requestCORExport(n,l,i={}){if(!v)return null;try{const o=await y.auth.getUser(),{data:d,error:m}=await y.rpc("request_cor_export",{p_cor_id:n,p_idempotency_key:l,p_options:i,p_requested_by:o?.data?.user?.id||null});if(m)throw m;return d?.[0]||null}catch(o){throw De.error("database",{message:o.message,operation:"requestCORExport",extra:{corId:n}}),o}},async getExportJob(n){if(!v)return null;const{data:l,error:i}=await y.from("cor_export_jobs").select("*").eq("id",n).single();return i?(console.error("Error fetching export job:",i),null):l},async getExportJobs(n,l=10){if(!v)return[];const{data:i,error:o}=await y.from("cor_export_jobs").select("*").eq("cor_id",n).order("created_at",{ascending:!1}).limit(l);return o?(console.error("Error fetching export jobs:",o),[]):i||[]},async updateExportJobStatus(n,l,i={}){if(!v)return null;try{const{data:o,error:d}=await y.rpc("update_export_job_status",{p_job_id:n,p_status:l,p_snapshot_id:i.snapshotId||null,p_pdf_url:i.pdfUrl||null,p_error:i.error||null,p_error_details:i.errorDetails||null,p_metrics:i.metrics||null});if(d)throw d;return o}catch(o){throw De.error("database",{message:o.message,operation:"updateExportJobStatus",extra:{jobId:n,status:l}}),o}},async getCurrentCORSnapshot(n){if(!v)return null;const{data:l}=await y.from("change_orders").select("version, last_snapshot_version").eq("id",n).single();if(!l||l.version!==l.last_snapshot_version)return null;const{data:i}=await y.from("cor_export_snapshots").select("*").eq("cor_id",n).eq("is_current",!0).single();return i||null},async saveCORSnapshot(n,l){if(!v)return null;try{await y.from("cor_export_snapshots").update({is_current:!1}).eq("cor_id",n.corId);const i=await y.auth.getUser(),{data:o,error:d}=await y.from("cor_export_snapshots").insert({id:n.snapshotId,cor_id:n.corId,job_id:l,cor_version:n.corVersion,cor_data:n.corData,tickets_data:n.ticketsData,photos_manifest:n.photoManifest,totals_snapshot:n.totals,checksum:n.checksum,is_current:!0,exported_by:i?.data?.user?.id||null}).select().single();if(d)throw d;return await y.from("change_orders").update({last_snapshot_version:n.corVersion}).eq("id",n.corId),o}catch(i){throw De.error("database",{message:i.message,operation:"saveCORSnapshot",extra:{corId:n.corId}}),i}},async updateCORAggregatedStats(n){if(v)try{await y.rpc("update_cor_aggregated_stats",{p_cor_id:n})}catch(l){console.error("Error updating COR aggregated stats:",l)}},async getCrewCheckin(n,l=null){if(!v)return null;const i=l||new Date().toISOString().split("T")[0],o=ce(),{data:d,error:m}=await o.from("crew_checkins").select("*").eq("project_id",n).eq("check_in_date",i).maybeSingle();return m&&console.error("Error fetching crew checkin:",m),d},async saveCrewCheckin(n,l,i=null,o=null){if(!v)return null;const d=o||new Date().toISOString().split("T")[0];if(!ja()){const b={id:Jt(),project_id:n,check_in_date:d,workers:l,created_by:i,updated_at:new Date().toISOString(),_offline:!0};return await bi(b),await sa(xt.SAVE_CREW_CHECKIN,{projectId:n,workers:l,checkInDate:d}),b}const m=ce();if(!m){const b={id:Jt(),project_id:n,check_in_date:d,workers:l,created_by:i,updated_at:new Date().toISOString(),_offline:!0};return await bi(b),await sa(xt.SAVE_CREW_CHECKIN,{projectId:n,workers:l,checkInDate:d}),b}const{data:h,error:g}=await m.from("crew_checkins").upsert({project_id:n,check_in_date:d,workers:l,created_by:i,updated_at:new Date().toISOString()},{onConflict:"project_id,check_in_date"}).select().single();if(g){if(g.message?.includes("fetch")||g.message?.includes("network")){const b={id:Jt(),project_id:n,check_in_date:d,workers:l,_offline:!0};return await bi(b),await sa(xt.SAVE_CREW_CHECKIN,{projectId:n,workers:l,checkInDate:d}),b}throw console.error("Error saving crew checkin:",g),g}return h&&bi(h).catch(b=>console.error("Failed to cache checkin:",b)),h},async addCrewMember(n,l,i=null){if(!v)return null;const o=await this.getCrewCheckin(n),d=o?.workers||[];return d.find(m=>m.name.toLowerCase()===l.name.toLowerCase())?o:(d.push(l),await this.saveCrewCheckin(n,d,i))},async removeCrewMember(n,l){if(!v)return null;const i=await this.getCrewCheckin(n);if(!i)return null;const o=i.workers.filter(d=>d.name.toLowerCase()!==l.toLowerCase());return await this.saveCrewCheckin(n,o,i.created_by)},async getCrewCheckinHistory(n,l=30){if(!v)return[];const{data:i,error:o}=await y.from("crew_checkins").select("*").eq("project_id",n).order("check_in_date",{ascending:!1}).limit(l);return o?(console.error("Error fetching crew history:",o),[]):i||[]},async getRecentWorkers(n,l=30){if(!v)return[];const i=await this.getCrewCheckinHistory(n,l),o=new Map;return i.forEach(d=>{(d.workers||[]).forEach(m=>{const h=m.name.toLowerCase();o.has(h)||o.set(h,{name:m.name,role:m.role,labor_class_id:m.labor_class_id||null,lastSeen:d.check_in_date})})}),Array.from(o.values()).sort((d,m)=>d.name.localeCompare(m.name))},async getLaborRates(n,l=null,i=null){if(!v)return[];let o=y.from("labor_rates").select("*").eq("company_id",n);l&&(o=o.eq("work_type",l)),i&&(o=o.eq("job_type",i));const{data:d,error:m}=await o;return m?(console.error("Error fetching labor rates:",m),[]):d||[]},async calculateManDayCosts(n,l,i,o){if(!v)return{totalCost:0,totalManDays:0,breakdown:[]};const d=await this.getCrewCheckinHistory(n,365),m=await this.getLaborRates(l,i,o),h={};m.forEach(x=>{h[x.role.toLowerCase()]=parseFloat(x.regular_rate)||0});let g=0,b=0;const O={},H=[];return d.forEach(x=>{const X=x.workers||[];let re=0;const F={};X.forEach($=>{const M=($.role||"laborer").toLowerCase(),K=h[M]||0;F[M]||(F[M]={count:0,cost:0}),F[M].count++,F[M].cost+=K,re+=K,O[M]||(O[M]={count:0,cost:0,rate:K}),O[M].count++,O[M].cost+=K}),g+=re,b+=X.length,H.push({date:x.check_in_date,workers:X.length,cost:re,breakdown:F})}),{totalCost:g,totalManDays:b,byRole:O,byDate:H,daysWorked:d.length}},async getDailyReport(n,l=null){if(!v)return null;const i=l||new Date().toISOString().split("T")[0],o=ce(),{data:d,error:m}=await o.from("daily_reports").select("*").eq("project_id",n).eq("report_date",i).maybeSingle();return m&&console.error("Error fetching daily report:",m),d},async compileDailyReport(n,l=null){if(!v)return null;const i=l||new Date().toISOString().split("T")[0],o=ce(),[d,m,h]=await Promise.all([this.getCrewCheckin(n,i),o.from("areas").select("*").eq("project_id",n),o.from("t_and_m_tickets").select("*").eq("project_id",n).eq("work_date",i)]),g=m?.data||[],b=h?.data||[],O=g.filter(x=>x.status==="done"&&x.completed_at?.startsWith(i)),H=b.reduce((x,X)=>x+(X.photos?.length||0),0);return{crew_count:d?.workers?.length||0,crew_list:d?.workers||[],tasks_completed:O.length,tasks_total:g.length,completed_tasks:O.map(x=>({name:x.name,group:x.group_name})),tm_tickets_count:b.length,photos_count:H}},async saveDailyReport(n,l,i=null){if(!v)return null;const o=i||new Date().toISOString().split("T")[0];if(!ja()){const g={id:Jt(),project_id:n,report_date:o,...l,updated_at:new Date().toISOString(),_offline:!0};return await es(g),g}const d=ce(),{data:m,error:h}=await d.from("daily_reports").upsert({project_id:n,report_date:o,...l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(h){if(h.message?.includes("fetch")||h.message?.includes("network")){const g={id:Jt(),project_id:n,report_date:o,...l,_offline:!0};return await es(g),g}throw console.error("Error saving daily report:",h),h}return m&&es(m).catch(g=>console.error("Failed to cache report:",g)),m},async submitDailyReport(n,l,i=null){if(!v)return null;const o=i||new Date().toISOString().split("T")[0];if(!ja()){const g=await p_(n,o),b={id:Jt(),project_id:n,report_date:o,...g||{},status:"pending_sync",submitted_by:l,submitted_at:new Date().toISOString(),_offline:!0};return await es(b),await sa(xt.SUBMIT_DAILY_REPORT,{projectId:n,reportData:g||{},submittedBy:l}),b}const d=await this.compileDailyReport(n,o),{data:m,error:h}=await y.from("daily_reports").upsert({project_id:n,report_date:o,...d,status:"submitted",submitted_at:new Date().toISOString(),submitted_by:l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(h){if(h.message?.includes("fetch")||h.message?.includes("network")){const g={id:Jt(),project_id:n,report_date:o,...d,status:"pending_sync",submitted_by:l,_offline:!0};return await es(g),await sa(xt.SUBMIT_DAILY_REPORT,{projectId:n,reportData:d,submittedBy:l}),g}throw console.error("Error submitting daily report:",h),h}return m&&es(m).catch(g=>console.error("Failed to cache report:",g)),m},async getDailyReports(n,l=30){if(!v)return[];const{data:i,error:o}=await y.from("daily_reports").select("*").eq("project_id",n).order("report_date",{ascending:!1}).limit(l);return o?(console.error("Error fetching daily reports:",o),[]):i||[]},async sendMessage(n,l,i,o,d=null,m=null,h="general",g=null){if(!v)return null;if(!ja()){const H={id:Jt(),project_id:n,sender_type:i,sender_name:o,sender_user_id:d,message:l,photo_url:m,message_type:h,parent_message_id:g,created_at:new Date().toISOString(),_offline:!0};return await If(H),await sa(xt.SEND_MESSAGE,{projectId:n,senderType:i,senderName:o,content:l}),H}const{data:b,error:O}=await y.from("messages").insert({project_id:n,sender_type:i,sender_name:o,sender_user_id:d,message:l,photo_url:m,message_type:h,parent_message_id:g}).select().single();if(O){if(O.message?.includes("fetch")||O.message?.includes("network")){const H={id:Jt(),project_id:n,sender_type:i,sender_name:o,message:l,created_at:new Date().toISOString(),_offline:!0};return await If(H),await sa(xt.SEND_MESSAGE,{projectId:n,senderType:i,senderName:o,content:l}),H}throw console.error("Error sending message:",O),O}return b},async getMessages(n,l=50){if(!v)return[];const i=ce(),{data:o,error:d}=await i.from("messages").select("*").eq("project_id",n).order("created_at",{ascending:!1}).limit(l);return d?[]:o||[]},async getUnreadCount(n,l){if(!v)return 0;const i=ce(),o=l==="field"?"office":"field",{count:d,error:m}=await i.from("messages").select("*",{count:"exact",head:!0}).eq("project_id",n).eq("sender_type",o).eq("is_read",!1);return m?0:d||0},async markMessagesRead(n,l){if(!v)return;const i=ce(),o=l==="field"?"office":"field";await i.from("messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("project_id",n).eq("sender_type",o).eq("is_read",!1)},async createMaterialRequest(n,l,i,o=null,d="normal",m=null){if(!v)return null;if(!ja()){const b={id:Jt(),project_id:n,items:l,requested_by:i,needed_by:o,priority:d,notes:m,status:"pending_sync",created_at:new Date().toISOString(),_offline:!0};return await sa(xt.CREATE_MATERIAL_REQUEST,{projectId:n,items:l,requestedBy:i,neededBy:o,priority:d,notes:m}),b}const{data:h,error:g}=await y.from("material_requests").insert({project_id:n,items:l,requested_by:i,needed_by:o,priority:d,notes:m}).select().single();if(g){if(g.message?.includes("fetch")||g.message?.includes("network")){const b={id:Jt(),project_id:n,items:l,requested_by:i,status:"pending_sync",_offline:!0};return await sa(xt.CREATE_MATERIAL_REQUEST,{projectId:n,items:l,requestedBy:i,neededBy:o,priority:d,notes:m}),b}throw console.error("Error creating material request:",g),g}return h},async getMaterialRequests(n,l=null){if(!v)return[];let i=y.from("material_requests").select("*").eq("project_id",n).order("created_at",{ascending:!1});l&&(i=i.eq("status",l));const{data:o,error:d}=await i;return d?(console.error("Error fetching material requests:",d),[]):o||[]},async getPendingRequestsCount(n){if(!v)return 0;const{count:l,error:i}=await y.from("material_requests").select("*",{count:"exact",head:!0}).eq("project_id",n).eq("status","pending");return i?0:l||0},async updateMaterialRequest(n,l,i,o=null,d=null){if(!v)return null;const m={status:l,responded_by:i,responded_at:new Date().toISOString(),response_notes:o,updated_at:new Date().toISOString()};d&&(m.expected_delivery=d),l==="delivered"&&(m.delivered_at=new Date().toISOString());const{data:h,error:g}=await y.from("material_requests").update(m).eq("id",n).select().single();if(g)throw console.error("Error updating material request:",g),g;return h},generateShareToken(){const n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",l=new Uint8Array(12);return crypto.getRandomValues(l),Array.from(l,i=>n[i%n.length]).join("")},async createProjectShare(n,l,i,o=null){if(!v){const b=ne();b.projectShares||(b.projectShares=[]);const O={id:crypto.randomUUID(),project_id:n,share_token:this.generateShareToken(),created_by:l,expires_at:o,is_active:!0,permissions:i,view_count:0,last_viewed_at:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return b.projectShares.push(O),ke(b),O}const{data:d,error:m}=await y.rpc("generate_share_token");if(m)throw console.error("Error generating share token:",m),m;const{data:h,error:g}=await y.from("project_shares").insert({project_id:n,share_token:d,created_by:l,expires_at:o,permissions:i}).select().single();if(g)throw console.error("Error creating project share:",g),g;return h},async getShareByToken(n){if(!v){const o=ne();if(!o.projectShares)return null;const d=o.projectShares.find(m=>m.share_token===n&&m.is_active&&(!m.expires_at||new Date(m.expires_at)>new Date));return d&&(d.view_count++,d.last_viewed_at=new Date().toISOString(),ke(o)),d}const{data:l,error:i}=await y.from("project_shares").select("*, projects(*)").eq("share_token",n).eq("is_active",!0).single();return i?(console.error("Error fetching share by token:",i),null):l.expires_at&&new Date(l.expires_at)<new Date?null:(await y.rpc("increment_share_view_count",{token:n}),l)},async getProjectShares(n){if(!v){const o=ne();return o.projectShares?o.projectShares.filter(d=>d.project_id===n):[]}const{data:l,error:i}=await y.from("project_shares").select("*, users(name, email)").eq("project_id",n).order("created_at",{ascending:!1});return i?(console.error("Error fetching project shares:",i),[]):l||[]},async updateProjectShare(n,l){if(!v){const d=ne();if(!d.projectShares)return null;const m=d.projectShares.findIndex(h=>h.id===n);return m===-1?null:(d.projectShares[m]={...d.projectShares[m],...l,updated_at:new Date().toISOString()},ke(d),d.projectShares[m])}const{data:i,error:o}=await y.from("project_shares").update(l).eq("id",n).select().single();if(o)throw console.error("Error updating project share:",o),o;return i},async revokeProjectShare(n){return this.updateProjectShare(n,{is_active:!1})},async deleteProjectShare(n){if(!v){const i=ne();if(!i.projectShares)return;i.projectShares=i.projectShares.filter(o=>o.id!==n),ke(i);return}const{error:l}=await y.from("project_shares").delete().eq("id",n);if(l)throw console.error("Error deleting project share:",l),l},async getPublicProjectData(n){const l=await this.getShareByToken(n);if(!l)return null;const i=l.project_id||l.projects?.id;if(!v){const m=ne(),h=m.projects.find(x=>x.id===i);if(!h)return null;const g=m.areas.filter(x=>x.project_id===i),b=g.reduce((x,X)=>x+parseFloat(X.weight||0),0),O=g.filter(x=>x.status==="done").reduce((x,X)=>x+parseFloat(X.weight||0),0),H=b>0?Math.round(O/b*100):0;return{share:l,project:h,progress:H,areas:l.permissions.progress?g:[],photos:[],dailyReports:[],tmTickets:[]}}const o=l.projects||await this.getProject(i);if(!o)return null;const d={share:l,project:o,areas:[],photos:[],dailyReports:[],tmTickets:[]};if(l.permissions.progress){d.areas=await this.getAreas(i);const m=d.areas.reduce((g,b)=>g+parseFloat(b.weight||0),0),h=d.areas.filter(g=>g.status==="done").reduce((g,b)=>g+parseFloat(b.weight||0),0);d.progress=m>0?Math.round(h/m*100):0}if(l.permissions.photos){const{data:m}=await y.from("t_and_m_tickets").select("photos, work_date").eq("project_id",i).not("photos","is",null).order("work_date",{ascending:!1}).limit(20);d.photos=m?.flatMap(h=>(h.photos||[]).map(g=>({url:g,date:h.work_date})))||[]}if(l.permissions.daily_reports){const{data:m}=await y.from("daily_reports").select("*").eq("project_id",i).order("report_date",{ascending:!1}).limit(10);d.dailyReports=m||[]}return l.permissions.tm_tickets&&(d.tmTickets=await this.getTMTickets(i)),d},async createInjuryReport(n){if(!v){const o=ne();o.injuryReports||(o.injuryReports=[]);const d={id:crypto.randomUUID(),...n,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return o.injuryReports.push(d),ke(o),d}const{data:l,error:i}=await y.from("injury_reports").insert(n).select().single();if(i)throw console.error("Error creating injury report:",i),i;return l},async getInjuryReports(n){if(!v){const o=ne();return o.injuryReports?o.injuryReports.filter(d=>d.project_id===n).sort((d,m)=>new Date(m.incident_date)-new Date(d.incident_date)):[]}const{data:l,error:i}=await y.from("injury_reports").select("*").eq("project_id",n).order("incident_date",{ascending:!1});return i?(console.error("Error fetching injury reports:",i),[]):l||[]},async getCompanyInjuryReports(n,l=null){if(!v){const m=ne();if(!m.injuryReports)return[];let h=m.injuryReports.filter(g=>g.company_id===n);return l&&(h=h.filter(g=>g.status===l)),h.sort((g,b)=>new Date(b.incident_date)-new Date(g.incident_date))}let i=y.from("injury_reports").select("*, projects(name)").eq("company_id",n).order("incident_date",{ascending:!1});l&&(i=i.eq("status",l));const{data:o,error:d}=await i;return d?(console.error("Error fetching company injury reports:",d),[]):o||[]},async getInjuryReport(n){if(!v){const o=ne();return o.injuryReports?o.injuryReports.find(d=>d.id===n):null}const{data:l,error:i}=await y.from("injury_reports").select("*, projects(name, pin), users(name, email)").eq("id",n).single();return i?(console.error("Error fetching injury report:",i),null):l},async updateInjuryReport(n,l){if(!v){const d=ne();if(!d.injuryReports)return null;const m=d.injuryReports.findIndex(h=>h.id===n);return m===-1?null:(d.injuryReports[m]={...d.injuryReports[m],...l,updated_at:new Date().toISOString()},ke(d),d.injuryReports[m])}const{data:i,error:o}=await y.from("injury_reports").update(l).eq("id",n).select().single();if(o)throw console.error("Error updating injury report:",o),o;return i},async closeInjuryReport(n,l){return this.updateInjuryReport(n,{status:"closed",closed_at:new Date().toISOString(),closed_by:l})},async deleteInjuryReport(n){if(!v){const i=ne();if(!i.injuryReports)return;i.injuryReports=i.injuryReports.filter(o=>o.id!==n),ke(i);return}const{error:l}=await y.from("injury_reports").delete().eq("id",n);if(l)throw console.error("Error deleting injury report:",l),l},async getInjuryStatistics(n,l=null,i=null){if(!v){const m=ne();if(!m.injuryReports)return{total_incidents:0,minor_injuries:0,serious_injuries:0,critical_injuries:0,near_misses:0,osha_recordable:0,total_days_away:0,total_restricted_days:0};let h=m.injuryReports.filter(g=>g.company_id===n);return l&&(h=h.filter(g=>new Date(g.incident_date)>=new Date(l))),i&&(h=h.filter(g=>new Date(g.incident_date)<=new Date(i))),{total_incidents:h.length,minor_injuries:h.filter(g=>g.injury_type==="minor").length,serious_injuries:h.filter(g=>g.injury_type==="serious").length,critical_injuries:h.filter(g=>g.injury_type==="critical").length,near_misses:h.filter(g=>g.injury_type==="near_miss").length,osha_recordable:h.filter(g=>g.osha_recordable).length,total_days_away:h.reduce((g,b)=>g+(b.days_away_from_work||0),0),total_restricted_days:h.reduce((g,b)=>g+(b.restricted_work_days||0),0)}}const{data:o,error:d}=await y.rpc("get_injury_statistics",{comp_id:n,start_date:l,end_date:i});return d?(console.error("Error fetching injury statistics:",d),null):o[0]||null},async addWitness(n,l){if(!v){const d=ne();if(!d.injuryReports)return null;const m=d.injuryReports.findIndex(b=>b.id===n);if(m===-1)return null;const h=d.injuryReports[m],g=h.witnesses||[];return g.push(l),d.injuryReports[m]={...h,witnesses:g,updated_at:new Date().toISOString()},ke(d),d.injuryReports[m]}const i=await this.getInjuryReport(n);if(!i)return null;const o=i.witnesses||[];return o.push(l),this.updateInjuryReport(n,{witnesses:o})},async removeWitness(n,l){if(!v){const d=ne();if(!d.injuryReports)return null;const m=d.injuryReports.findIndex(b=>b.id===n);if(m===-1)return null;const h=d.injuryReports[m],g=h.witnesses||[];return g.splice(l,1),d.injuryReports[m]={...h,witnesses:g,updated_at:new Date().toISOString()},ke(d),d.injuryReports[m]}const i=await this.getInjuryReport(n);if(!i)return null;const o=i.witnesses||[];return o.splice(l,1),this.updateInjuryReport(n,{witnesses:o})},async getCompanyUsers(n){if(v){const{data:l,error:i}=await y.from("user_companies").select(`
          user_id,
          role,
          users (
            id,
            name,
            email
          )
        `).eq("company_id",n);return i?(console.error("Error fetching company users:",i),[]):l?.map(o=>({id:o.user_id,name:o.users?.name||o.users?.email,email:o.users?.email,role:o.role}))||[]}return[]},async getProjectNotificationPreferences(n){if(v){const{data:i,error:o}=await y.from("notification_preferences").select(`
          *,
          users (
            id,
            name,
            email
          )
        `).eq("project_id",n);return o?(console.error("Error fetching notification preferences:",o),[]):i||[]}const l=ne();return l.notificationPreferences?l.notificationPreferences.filter(i=>i.project_id===n):[]},async getUserNotificationPreferences(n){if(v){const{data:i,error:o}=await y.from("notification_preferences").select(`
          *,
          projects (
            id,
            name
          )
        `).eq("user_id",n);return o?(console.error("Error fetching user notification preferences:",o),[]):i||[]}const l=ne();return l.notificationPreferences?l.notificationPreferences.filter(i=>i.user_id===n):[]},async setNotificationPreference(n,l,i){if(v){const{data:h,error:g}=await y.from("notification_preferences").upsert({project_id:n,user_id:l,notification_types:i,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id"}).select().single();if(g)throw console.error("Error setting notification preference:",g),g;return h}const o=ne();o.notificationPreferences||(o.notificationPreferences=[]);const d=o.notificationPreferences.findIndex(h=>h.project_id===n&&h.user_id===l),m={id:d>=0?o.notificationPreferences[d].id:crypto.randomUUID(),project_id:n,user_id:l,notification_types:i,created_at:d>=0?o.notificationPreferences[d].created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return d>=0?o.notificationPreferences[d]=m:o.notificationPreferences.push(m),ke(o),m},async removeNotificationPreference(n,l){if(v){const{error:o}=await y.from("notification_preferences").delete().eq("project_id",n).eq("user_id",l);if(o)throw console.error("Error removing notification preference:",o),o;return!0}const i=ne();return i.notificationPreferences&&(i.notificationPreferences=i.notificationPreferences.filter(o=>!(o.project_id===n&&o.user_id===l)),ke(i)),!0},async setProjectNotificationPreferences(n,l){const i=[];for(const o of l)if(o.notificationTypes&&o.notificationTypes.length>0){const d=await this.setNotificationPreference(n,o.userId,o.notificationTypes);i.push(d)}else await this.removeNotificationPreference(n,o.userId);return i},async getNotificationPresets(n){if(v){const{data:i,error:o}=await y.from("notification_presets").select("*").eq("company_id",n).order("name");return o?(console.error("Error fetching notification presets:",o),[]):i||[]}const l=ne();return l.notificationPresets?l.notificationPresets.filter(i=>i.company_id===n):[{id:"preset-1",name:"Project Manager",notification_types:["message","material_request","injury_report","tm_ticket"],company_id:n},{id:"preset-2",name:"Safety Officer",notification_types:["injury_report"],company_id:n},{id:"preset-3",name:"Purchasing",notification_types:["material_request"],company_id:n},{id:"preset-4",name:"Accounting",notification_types:["tm_ticket"],company_id:n}]},async createNotificationPreset(n,l,i){if(v){const{data:m,error:h}=await y.from("notification_presets").insert({company_id:n,name:l,notification_types:i}).select().single();if(h)throw console.error("Error creating notification preset:",h),h;return m}const o=ne();o.notificationPresets||(o.notificationPresets=[]);const d={id:crypto.randomUUID(),company_id:n,name:l,notification_types:i,created_at:new Date().toISOString()};return o.notificationPresets.push(d),ke(o),d},async updateNotificationPreset(n,l,i){if(v){const{data:m,error:h}=await y.from("notification_presets").update({name:l,notification_types:i,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(h)throw console.error("Error updating notification preset:",h),h;return m}const o=ne();if(!o.notificationPresets)return null;const d=o.notificationPresets.findIndex(m=>m.id===n);return d===-1?null:(o.notificationPresets[d]={...o.notificationPresets[d],name:l,notification_types:i,updated_at:new Date().toISOString()},ke(o),o.notificationPresets[d])},async deleteNotificationPreset(n){if(v){const{error:i}=await y.from("notification_presets").delete().eq("id",n);if(i)throw console.error("Error deleting notification preset:",i),i;return!0}const l=ne();return l.notificationPresets&&(l.notificationPresets=l.notificationPresets.filter(i=>i.id!==n),ke(l)),!0},async getDumpSites(n){if(v){const{data:i,error:o}=await y.from("dump_sites").select(`
          *,
          dump_site_rates (*)
        `).eq("company_id",n).eq("active",!0).order("name");return o?(console.error("Error fetching dump sites:",o),[]):i||[]}return(ne().dumpSites||[]).filter(i=>i.company_id===n&&i.active)},async createDumpSite(n,l,i="",o=""){if(v){const{data:h,error:g}=await y.from("dump_sites").insert({company_id:n,name:l,address:i,notes:o,active:!0}).select().single();if(g)throw console.error("Error creating dump site:",g),g;return h}const d=ne();d.dumpSites||(d.dumpSites=[]);const m={id:crypto.randomUUID(),company_id:n,name:l,address:i,notes:o,active:!0,created_at:new Date().toISOString(),dump_site_rates:[]};return d.dumpSites.push(m),ke(d),m},async updateDumpSite(n,l){if(v){const{data:d,error:m}=await y.from("dump_sites").update({...l,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(m)throw console.error("Error updating dump site:",m),m;return d}const i=ne();if(!i.dumpSites)return null;const o=i.dumpSites.findIndex(d=>d.id===n);return o===-1?null:(i.dumpSites[o]={...i.dumpSites[o],...l},ke(i),i.dumpSites[o])},async deleteDumpSite(n){return this.updateDumpSite(n,{active:!1})},async setDumpSiteRate(n,l,i,o="load"){if(v){const{data:g}=await y.from("dump_site_rates").select("id").eq("dump_site_id",n).eq("waste_type",l).maybeSingle();if(g){const{data:b,error:O}=await y.from("dump_site_rates").update({estimated_cost_per_load:i,unit:o}).eq("id",g.id).select().single();if(O)throw console.error("Error updating dump site rate:",O),O;return b}else{const{data:b,error:O}=await y.from("dump_site_rates").insert({dump_site_id:n,waste_type:l,estimated_cost_per_load:i,unit:o}).select().single();if(O)throw console.error("Error inserting dump site rate:",O),O;return b}}const d=ne();d.dumpSiteRates||(d.dumpSiteRates=[]);const m=d.dumpSiteRates.findIndex(g=>g.dump_site_id===n&&g.waste_type===l),h={id:m>=0?d.dumpSiteRates[m].id:crypto.randomUUID(),dump_site_id:n,waste_type:l,estimated_cost_per_load:i,unit:o,created_at:new Date().toISOString()};return m>=0?d.dumpSiteRates[m]=h:d.dumpSiteRates.push(h),ke(d),h},async getDumpSiteRates(n){if(v){const{data:i,error:o}=await y.from("dump_site_rates").select("*").eq("dump_site_id",n);return o?(console.error("Error fetching dump site rates:",o),[]):i||[]}return(ne().dumpSiteRates||[]).filter(i=>i.dump_site_id===n)},async getHaulOffs(n){if(v){const{data:i,error:o}=await y.from("haul_offs").select(`
          *,
          dump_sites (name)
        `).eq("project_id",n).order("work_date",{ascending:!1});return o?(console.error("Error fetching haul-offs:",o),[]):i||[]}return(ne().haulOffs||[]).filter(i=>i.project_id===n).sort((i,o)=>new Date(o.work_date)-new Date(i.work_date))},async createHaulOff(n,l){const i={project_id:n,dump_site_id:l.dumpSiteId,waste_type:l.wasteType,loads:l.loads,hauling_company:l.haulingCompany||"",work_date:l.workDate,notes:l.notes||"",estimated_cost:l.estimatedCost||0,created_by:l.createdBy||""};if(v){const{data:m,error:h}=await y.from("haul_offs").insert(i).select().single();if(h)throw console.error("Error creating haul-off:",h),h;return m}const o=ne();o.haulOffs||(o.haulOffs=[]);const d={...i,id:crypto.randomUUID(),created_at:new Date().toISOString()};return o.haulOffs.push(d),ke(o),d},async calculateHaulOffCosts(n){const l=await this.getHaulOffs(n);let i=0,o=0;const d={},m=[],h={};l.forEach(b=>{const O=parseFloat(b.estimated_cost)||0,H=parseInt(b.loads)||0;i+=O,o+=H,d[b.waste_type]||(d[b.waste_type]={loads:0,cost:0}),d[b.waste_type].loads+=H,d[b.waste_type].cost+=O,h[b.work_date]||(h[b.work_date]={date:b.work_date,loads:0,cost:0}),h[b.work_date].loads+=H,h[b.work_date].cost+=O}),Object.values(h).sort((b,O)=>new Date(O.date)-new Date(b.date)).forEach(b=>m.push(b));const g=m.length;return{totalCost:i,totalLoads:o,byWasteType:d,byDate:m,daysWithHaulOff:g,avgDailyHaulOffCost:g>0?i/g:0}},subscribeToHaulOffs(n,l){return v?y.channel(`haul_offs:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"haul_offs",filter:`project_id=eq.${n}`},l).subscribe():null},async createCOR(n,l=0){if(v){let i=n.cor_number;l>0&&(i=await this.getNextCORNumber(n.project_id));const{data:o,error:d}=await y.from("change_orders").insert({company_id:n.company_id,project_id:n.project_id,area_id:n.area_id||null,cor_number:i,title:n.title,description:n.description||"",scope_of_work:n.scope_of_work,period_start:n.period_start,period_end:n.period_end,status:"draft",labor_markup_percent:n.labor_markup_percent??1500,materials_markup_percent:n.materials_markup_percent??1500,equipment_markup_percent:n.equipment_markup_percent??1500,subcontractors_markup_percent:n.subcontractors_markup_percent??500,liability_insurance_percent:n.liability_insurance_percent??144,bond_percent:n.bond_percent??100,license_fee_percent:n.license_fee_percent??10,created_by:n.created_by||null}).select().single();if((d?.code==="23505"||d?.code==="PGRST116"||d?.status===409||d?.message?.includes("duplicate")||d?.message?.includes("unique_cor_number"))&&l<3)return console.warn(`COR number conflict, retrying with fresh number (attempt ${l+1})`),this.createCOR(n,l+1);if(d)throw d;return o}return null},async updateCOR(n,l){if(v){const{data:i,error:o}=await y.from("change_orders").update({...l,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(o)throw o;return i}return null},async deleteCOR(n){if(v){const{error:l}=await y.from("change_orders").delete().eq("id",n);if(l)throw l}},async bulkUpdateCORGroup(n,l){if(v){const{error:i}=await y.from("change_orders").update({group_name:l,updated_at:new Date().toISOString()}).in("id",n);if(i)throw i.message?.includes("group_name")||i.code==="PGRST204"?new Error("COR grouping requires a database migration. Please run database/migration_cor_enhancements.sql in Supabase SQL Editor."):i}},async getCORs(n,l={}){if(v){let i=y.from("change_orders").select(`
          *,
          areas (id, name),
          labor_count:change_order_labor(count),
          materials_count:change_order_materials(count),
          equipment_count:change_order_equipment(count),
          subcontractors_count:change_order_subcontractors(count),
          tickets_count:change_order_ticket_associations(count)
        `).eq("project_id",n);l.status&&(i=i.eq("status",l.status)),l.area_id&&(i=i.eq("area_id",l.area_id)),l.date_start&&(i=i.gte("period_start",l.date_start)),l.date_end&&(i=i.lte("period_end",l.date_end)),i=i.order("created_at",{ascending:!1});const{data:o,error:d}=await i;if(d)throw d;return o}return[]},async getCORById(n){if(v){const{data:l,error:i}=await y.from("change_orders").select(`
          *,
          areas (id, name),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*),
          change_order_ticket_associations (
            *,
            t_and_m_tickets (
              *,
              t_and_m_workers (*),
              t_and_m_items (
                *,
                materials_equipment (name, unit, cost_per_unit, category)
              )
            )
          )
        `).eq("id",n).single();if(i)throw i;return l}return null},async getCORsByArea(n,l){if(v){const{data:i,error:o}=await y.from("change_orders").select("*").eq("project_id",n).eq("area_id",l).order("created_at",{ascending:!1});if(o)throw o;return i}return[]},async getAssignableCORs(n){if(v){const l=ce();if(!l)return[];const{data:i,error:o}=await l.from("change_orders").select("id, cor_number, title, status, cor_total").eq("project_id",n).in("status",["draft","pending_approval","approved"]).order("cor_number",{ascending:!0});if(o)throw o;return i||[]}return[]},async getNextCORNumber(n){if(v){const{data:l,error:i}=await y.from("change_orders").select("cor_number").eq("project_id",n);if(i)throw i;if(l&&l.length>0){let o=0;for(const d of l){const m=d.cor_number?.match(/COR #(\d+)/);if(m){const h=parseInt(m[1]);h>o&&(o=h)}}return`COR #${o+1}`}return"COR #1"}return"COR #1"},async addCORLaborItem(n,l){if(v){const i=Math.round(l.regular_hours*l.regular_rate),o=Math.round(l.overtime_hours*l.overtime_rate),d=i+o,{data:m,error:h}=await y.from("change_order_labor").insert({change_order_id:n,labor_class:l.labor_class,wage_type:l.wage_type||"standard",regular_hours:l.regular_hours||0,overtime_hours:l.overtime_hours||0,regular_rate:l.regular_rate||0,overtime_rate:l.overtime_rate||0,regular_total:i,overtime_total:o,total:d,sort_order:l.sort_order||0,source_ticket_id:l.source_ticket_id||null}).select().single();if(h)throw h;return m}return null},async updateCORLaborItem(n,l){if(v){let i={...l};if(l.regular_hours!==void 0||l.regular_rate!==void 0||l.overtime_hours!==void 0||l.overtime_rate!==void 0){const{data:m}=await y.from("change_order_labor").select("regular_hours, overtime_hours, regular_rate, overtime_rate").eq("id",n).single(),h=l.regular_hours??m?.regular_hours??0,g=l.overtime_hours??m?.overtime_hours??0,b=l.regular_rate??m?.regular_rate??0,O=l.overtime_rate??m?.overtime_rate??0;i.regular_total=Math.round(h*b),i.overtime_total=Math.round(g*O),i.total=i.regular_total+i.overtime_total}const{data:o,error:d}=await y.from("change_order_labor").update(i).eq("id",n).select().single();if(d)throw d;return o}return null},async deleteCORLaborItem(n){if(v){const{error:l}=await y.from("change_order_labor").delete().eq("id",n);if(l)throw l}},async addCORMaterialItem(n,l){if(v){const o=["backup_sheet","invoice","mobilization","custom","field_ticket","rental"].includes(l.source_type)?l.source_type:"custom",d=Math.round(Number(l.unit_cost)||0),m=Number(l.quantity)||1,h=Math.round(m*d),{data:g,error:b}=await y.from("change_order_materials").insert({change_order_id:n,description:l.description||"",quantity:m,unit:l.unit||"each",unit_cost:d,total:h,source_type:o,source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(b)throw b;return g}return null},async updateCORMaterialItem(n,l){if(v){let i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:m}=await y.from("change_order_materials").select("quantity, unit_cost").eq("id",n).single(),h=l.quantity??m?.quantity??1,g=l.unit_cost??m?.unit_cost??0;i.total=Math.round(h*g)}const{data:o,error:d}=await y.from("change_order_materials").update(i).eq("id",n).select().single();if(d)throw d;return o}return null},async deleteCORMaterialItem(n){if(v){const{error:l}=await y.from("change_order_materials").delete().eq("id",n);if(l)throw l}},async addCOREquipmentItem(n,l){if(v){const o=["backup_sheet","invoice","custom","field_ticket","rental"].includes(l.source_type)?l.source_type:"custom",d=Math.round(Number(l.unit_cost)||0),m=Number(l.quantity)||1,h=Math.round(m*d),{data:g,error:b}=await y.from("change_order_equipment").insert({change_order_id:n,description:l.description||"",quantity:m,unit:l.unit||"day",unit_cost:d,total:h,source_type:o,source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(b)throw b;return g}return null},async updateCOREquipmentItem(n,l){if(v){let i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:m}=await y.from("change_order_equipment").select("quantity, unit_cost").eq("id",n).single(),h=l.quantity??m?.quantity??1,g=l.unit_cost??m?.unit_cost??0;i.total=Math.round(h*g)}const{data:o,error:d}=await y.from("change_order_equipment").update(i).eq("id",n).select().single();if(d)throw d;return o}return null},async deleteCOREquipmentItem(n){if(v){const{error:l}=await y.from("change_order_equipment").delete().eq("id",n);if(l)throw l}},async addCORSubcontractorItem(n,l){if(v){const i=Math.round(l.quantity*l.unit_cost),{data:o,error:d}=await y.from("change_order_subcontractors").insert({change_order_id:n,description:l.description,quantity:l.quantity||1,unit:l.unit||"lump sum",unit_cost:l.unit_cost||0,total:i,source_type:l.source_type||"custom",source_reference:l.source_reference||null,sort_order:l.sort_order||0}).select().single();if(d)throw d;return o}return null},async updateCORSubcontractorItem(n,l){if(v){let i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:m}=await y.from("change_order_subcontractors").select("quantity, unit_cost").eq("id",n).single(),h=l.quantity??m?.quantity??1,g=l.unit_cost??m?.unit_cost??0;i.total=Math.round(h*g)}const{data:o,error:d}=await y.from("change_order_subcontractors").update(i).eq("id",n).select().single();if(d)throw d;return o}return null},async deleteCORSubcontractorItem(n){if(v){const{error:l}=await y.from("change_order_subcontractors").delete().eq("id",n);if(l)throw l}},async addBulkLaborItems(n,l){if(v&&l.length>0){const i=ce();if(!i)throw new Error("Database client not available");const o=l.map((h,g)=>{const b=Math.round(h.regular_hours*h.regular_rate),O=Math.round(h.overtime_hours*h.overtime_rate);return{change_order_id:n,labor_class:h.labor_class,wage_type:h.wage_type||"standard",regular_hours:h.regular_hours||0,overtime_hours:h.overtime_hours||0,regular_rate:h.regular_rate||0,overtime_rate:h.overtime_rate||0,regular_total:b,overtime_total:O,total:b+O,sort_order:h.sort_order??g,source_ticket_id:h.source_ticket_id||null}}),{data:d,error:m}=await i.from("change_order_labor").insert(o).select();if(m)throw m;return d}return[]},async addBulkMaterialItems(n,l){if(v&&l.length>0){const i=ce();if(!i)throw new Error("Database client not available");const o=["backup_sheet","invoice","mobilization","custom","field_ticket","rental"],d=l.map((g,b)=>{const O=o.includes(g.source_type)?g.source_type:"custom",H=Math.round(Number(g.unit_cost)||0),x=Number(g.quantity)||1;return{change_order_id:n,description:g.description||"",quantity:x,unit:g.unit||"each",unit_cost:H,total:Math.round(x*H),source_type:O,source_reference:g.source_reference||null,source_ticket_id:g.source_ticket_id||null,sort_order:g.sort_order??b}}),{data:m,error:h}=await i.from("change_order_materials").insert(d).select();if(h)throw h;return m}return[]},async addBulkEquipmentItems(n,l){if(v&&l.length>0){const i=ce();if(!i)throw new Error("Database client not available");const o=["backup_sheet","invoice","custom","field_ticket","rental"],d=l.map((g,b)=>{const O=o.includes(g.source_type)?g.source_type:"custom",H=Math.round(Number(g.unit_cost)||0),x=Number(g.quantity)||1;return{change_order_id:n,description:g.description||"",quantity:x,unit:g.unit||"day",unit_cost:H,total:Math.round(x*H),source_type:O,source_reference:g.source_reference||null,source_ticket_id:g.source_ticket_id||null,sort_order:g.sort_order??b}}),{data:m,error:h}=await i.from("change_order_equipment").insert(d).select();if(h)throw h;return m}return[]},async addBulkSubcontractorItems(n,l){if(v&&l.length>0){const i=ce();if(!i)throw new Error("Database client not available");const o=l.map((h,g)=>({change_order_id:n,company_name:h.company_name||"",description:h.description||"",quantity:h.quantity||1,unit:h.unit||"lump sum",unit_cost:h.unit_cost||h.total||h.amount||0,total:h.total||h.amount||0,source_type:h.source_type||"invoice",source_reference:h.source_reference||null,sort_order:h.sort_order??g})),{data:d,error:m}=await i.from("change_order_subcontractors").insert(o).select();if(m)throw m;return d}return[]},async clearCORLineItems(n){if(!v)return;const l=ce();if(!l)throw new Error("Database client not available");try{const i=await Promise.all([l.from("change_order_labor").delete().eq("change_order_id",n),l.from("change_order_materials").delete().eq("change_order_id",n),l.from("change_order_equipment").delete().eq("change_order_id",n),l.from("change_order_subcontractors").delete().eq("change_order_id",n)]);for(const o of i)if(o.error)throw o.error}catch(i){throw console.error("Error clearing COR line items:",i),i}},async saveCORLineItems(n,{laborItems:l,materialItems:i,equipmentItems:o,subcontractorItems:d}){if(v){await this.clearCORLineItems(n);const m=await Promise.all([l?.length>0?this.addBulkLaborItems(n,l):[],i?.length>0?this.addBulkMaterialItems(n,i):[],o?.length>0?this.addBulkEquipmentItems(n,o):[],d?.length>0?this.addBulkSubcontractorItems(n,d):[]]);return{labor:m[0],materials:m[1],equipment:m[2],subcontractors:m[3]}}return null},async assignTicketToCOR(n,l){if(v){const{error:i}=await y.rpc("assign_ticket_to_cor",{p_ticket_id:n,p_cor_id:l});if(i)throw De.error("database",{message:i.message,operation:"assignTicketToCOR",extra:{ticketId:n,corId:l}}),i;return{ticket_id:n,change_order_id:l}}return null},async unassignTicketFromCOR(n,l){if(v){const{error:i}=await y.rpc("unassign_ticket_from_cor",{p_ticket_id:n,p_cor_id:l});if(i)throw De.error("database",{message:i.message,operation:"unassignTicketFromCOR",extra:{ticketId:n,corId:l}}),i}},async checkTicketCORIntegrity(){if(v){const{data:n,error:l}=await y.rpc("check_ticket_cor_integrity");if(l)throw l;return n||[]}return[]},async fixTicketCORIntegrity(){if(v){const{data:n,error:l}=await y.rpc("fix_ticket_cor_integrity");if(l)throw l;return n}return 0},async getTicketsForCOR(n){if(v){const{data:l,error:i}=await y.from("change_order_ticket_associations").select(`
          *,
          t_and_m_tickets (
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          )
        `).eq("change_order_id",n);if(i)throw i;return l}return[]},async getUnassignedTickets(n){if(v){const{data:l,error:i}=await y.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",n).is("assigned_cor_id",null).order("work_date",{ascending:!1});if(i)throw i;return l}return[]},async importTicketDataToCOR(n,l,i,o,d){if(v){const m=ce();if(!m)throw new Error("Database client not available");const{data:h,error:g}=await m.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("id",n).single();if(g)throw g;const{data:b,error:O}=await m.from("labor_rates").select("*").eq("company_id",i).eq("work_type",o||"demolition").eq("job_type",d||"standard");if(O)throw O;const H={};b?.forEach(M=>{H[M.role.toLowerCase()]=M});const x={};h.t_and_m_workers?.forEach(M=>{const K=(M.role||"laborer").toLowerCase();x[K]||(x[K]={regular_hours:0,overtime_hours:0}),x[K].regular_hours+=parseFloat(M.hours)||0,x[K].overtime_hours+=parseFloat(M.overtime_hours)||0});const X=Object.entries(x).map(([M,K])=>{const se=H[M]||{regular_rate:0,overtime_rate:0},le=Math.round((parseFloat(se.regular_rate)||0)*100),ue=Math.round((parseFloat(se.overtime_rate)||0)*100);return{labor_class:M.charAt(0).toUpperCase()+M.slice(1),wage_type:d||"standard",regular_hours:K.regular_hours,overtime_hours:K.overtime_hours,regular_rate:le,overtime_rate:ue,source_ticket_id:n}});X.length>0&&await this.addBulkLaborItems(l,X);const re=[],F=[];h.t_and_m_items?.forEach(M=>{const K=M.custom_name||M.materials_equipment?.name||"Unknown Item",se=M.custom_category||M.materials_equipment?.category||"Other",le=M.materials_equipment?.unit||"each",ue=Math.round((parseFloat(M.materials_equipment?.cost_per_unit)||0)*100),we={description:K,quantity:M.quantity||1,unit:le,unit_cost:ue,source_type:"backup_sheet",source_ticket_id:n};se==="Equipment"?F.push(we):re.push(we)}),re.length>0&&await this.addBulkMaterialItems(l,re),F.length>0&&await this.addBulkEquipmentItems(l,F);const{error:$}=await m.from("change_order_ticket_associations").update({data_imported:!0,imported_at:new Date().toISOString(),import_status:"completed",import_failed_at:null,import_error:null}).eq("change_order_id",l).eq("ticket_id",n);if($)throw $;return De.activity("cor_import_success",{ticket_id:n,cor_id:l,labor_count:X.length,material_count:re.length,equipment_count:F.length}),{laborItems:X,materialItems:re,equipmentItems:F}}return null},async reimportTicketDataToCOR(n,l,i,o,d){if(v){const m=ce();if(!m)throw new Error("Database client not available");return await m.from("change_order_labor").delete().eq("change_order_id",l).eq("source_ticket_id",n),await m.from("change_order_materials").delete().eq("change_order_id",l).eq("source_ticket_id",n),await m.from("change_order_equipment").delete().eq("change_order_id",l).eq("source_ticket_id",n),this.importTicketDataToCOR(n,l,i,o,d)}return null},async markImportFailed(n,l,i="Import failed"){if(v){const o=ce();if(!o)throw new Error("Database client not available");const{error:d}=await o.from("change_order_ticket_associations").update({import_status:"failed",import_failed_at:new Date().toISOString(),import_error:i}).eq("change_order_id",l).eq("ticket_id",n);if(d)throw De.error("database",{message:d.message,operation:"markImportFailed",extra:{ticketId:n,corId:l}}),d;De.error("cor_import_failed",{ticket_id:n,cor_id:l,error:i})}},async getTicketsNeedingImport(n){if(v){const{data:l,error:i}=await y.from("t_and_m_tickets").select(`
          id,
          work_date,
          ce_pco_number,
          assigned_cor_id,
          change_order_ticket_associations!inner (
            change_order_id,
            import_status,
            import_failed_at,
            import_error
          )
        `).eq("project_id",n).eq("change_order_ticket_associations.import_status","failed");if(i)throw i;return l||[]}return[]},async getTicketImportStatus(n,l){if(v){const{data:i,error:o}=await y.from("change_order_ticket_associations").select("import_status, import_failed_at, import_error, data_imported").eq("ticket_id",n).eq("change_order_id",l).single();if(o&&o.code!=="PGRST116")throw o;return i}return null},async recalculateCOR(n){if(v){const{error:l}=await y.rpc("recalculate_cor_totals",{cor_id:n});if(l)throw l;return this.getCORById(n)}return null},async updateCORMarkupPercentages(n,l){if(v){const i={};l.labor!==void 0&&(i.labor_markup_percent=l.labor),l.materials!==void 0&&(i.materials_markup_percent=l.materials),l.equipment!==void 0&&(i.equipment_markup_percent=l.equipment),l.subcontractors!==void 0&&(i.subcontractors_markup_percent=l.subcontractors);const{data:o,error:d}=await y.from("change_orders").update(i).eq("id",n).select().single();if(d)throw d;return o}return null},async updateCORFeePercentages(n,l){if(v){const i={};l.liabilityInsurance!==void 0&&(i.liability_insurance_percent=l.liabilityInsurance),l.bond!==void 0&&(i.bond_percent=l.bond),l.licenseFee!==void 0&&(i.license_fee_percent=l.licenseFee);const{data:o,error:d}=await y.from("change_orders").update(i).eq("id",n).select().single();if(d)throw d;return o}return null},async submitCORForApproval(n){if(v){const{data:l,error:i}=await y.from("change_orders").update({status:"pending_approval",submitted_at:new Date().toISOString()}).eq("id",n).select().single();if(i)throw i;return l}return null},async approveCOR(n,l){if(v){const{data:i,error:o}=await y.from("change_orders").update({status:"approved",approved_by:l,approved_at:new Date().toISOString()}).eq("id",n).select().single();if(o)throw o;return i}return null},async rejectCOR(n,l=null){if(v){const{data:i,error:o}=await y.from("change_orders").update({status:"rejected",rejection_reason:l}).eq("id",n).select().single();if(o)throw o;return i}return null},async markCORAsBilled(n){if(v){const{data:l,error:i}=await y.from("change_orders").update({status:"billed"}).eq("id",n).select().single();if(i)throw i;return l}return null},async closeCOR(n){if(v){const{data:l,error:i}=await y.from("change_orders").update({status:"closed"}).eq("id",n).select().single();if(i)throw i;return l}return null},async saveCORSignature(n,l,i){if(v){const{data:o,error:d}=await y.from("change_orders").update({gc_signature_data:l,gc_signature_name:i,gc_signature_date:new Date().toISOString(),status:"approved"}).eq("id",n).select().single();if(d)throw d;return o}return null},async getCORStats(n){if(v){const{data:l,error:i}=await y.from("change_orders").select("status, cor_total").eq("project_id",n);if(i)throw i;const o={total_cors:l.length,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0};return l.forEach(d=>{switch(d.status){case"draft":o.draft_count++;break;case"pending_approval":o.pending_count++,o.total_pending_value+=d.cor_total||0;break;case"approved":o.approved_count++,o.total_approved_value+=d.cor_total||0;break;case"rejected":o.rejected_count++;break;case"billed":case"closed":o.billed_count++,o.total_billed_value+=d.cor_total||0;break}}),o}return{total_cors:0,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0}},subscribeToCORs(n,l){return v?y.channel(`change_orders:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${n}`},l).subscribe():null},subscribeToCorTickets(n,l){return v?y.channel(`cor-tickets:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"change_order_ticket_associations",filter:`change_order_id=eq.${n}`},l).subscribe():null},async getCORLog(n){if(v){const{data:l,error:i}=await y.from("cor_log_entries").select(`
          id,
          log_number,
          date_sent_to_client,
          ce_number,
          comments,
          created_at,
          updated_at,
          change_order:change_orders (
            id,
            cor_number,
            title,
            cor_total,
            status,
            created_at,
            approved_at,
            approved_by
          )
        `).eq("project_id",n).order("log_number",{ascending:!0});if(i)throw console.error("Error fetching COR log:",i),i;return(l||[]).map(o=>({id:o.id,logNumber:o.log_number,dateSentToClient:o.date_sent_to_client,ceNumber:o.ce_number,comments:o.comments,createdAt:o.created_at,updatedAt:o.updated_at,changeOrder:{id:o.change_order?.id,corNumber:o.change_order?.cor_number,title:o.change_order?.title,corTotal:o.change_order?.cor_total,status:o.change_order?.status,createdAt:o.change_order?.created_at,approvedAt:o.change_order?.approved_at,approvedBy:o.change_order?.approved_by}}))}return[]},async updateCORLogEntry(n,l){if(v){const i={updated_at:new Date().toISOString()};l.dateSentToClient!==void 0&&(i.date_sent_to_client=l.dateSentToClient||null),l.ceNumber!==void 0&&(i.ce_number=l.ceNumber||null),l.comments!==void 0&&(i.comments=l.comments||null);const{data:o,error:d}=await y.from("cor_log_entries").update(i).eq("id",n).select().single();if(d)throw console.error("Error updating COR log entry:",d),d;return o}return null},async updateChangeOrderStatus(n,l){if(v){const{data:i,error:o}=await y.from("change_orders").update({status:l,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(o)throw console.error("Error updating change order status:",o),o;return i}return null},subscribeToCORLog(n,l){return v?y.channel(`cor-log:${n}`).on("postgres_changes",{event:"*",schema:"public",table:"cor_log_entries",filter:`project_id=eq.${n}`},l).subscribe():null},async createSignatureRequest(n,l,i,o,d=null,m=null){if(v){const h=ce();if(!h)throw new Error("Database client not available");const{data:g,error:b}=await h.rpc("generate_signature_token");if(b)throw b;const{data:O,error:H}=await h.from("signature_requests").insert({document_type:n,document_id:l,company_id:i,project_id:o,signature_token:g,expires_at:m,created_by:d}).select().single();if(H)throw H;return O}return null},async getSignatureRequestByToken(n){if(v){const l=ce();if(!l)throw new Error("Database client not available");await l.rpc("increment_signature_view_count",{token:n});const{data:i,error:o}=await l.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("signature_token",n).single();if(o)throw o;return i}return null},async getSignatureRequestsForDocument(n,l){if(v){const i=ce();if(!i)throw new Error("Database client not available");const{data:o,error:d}=await i.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("document_type",n).eq("document_id",l).order("created_at",{ascending:!1});if(d)throw d;return o||[]}return[]},async addSignature(n,l,i){if(v){const o=ce();if(!o)throw new Error("Database client not available");const{data:d,error:m}=await o.from("signatures").insert({signature_request_id:n,signature_slot:l,signature_image:i.signature,signer_name:i.signerName,signer_title:i.signerTitle||null,signer_company:i.signerCompany||null,signed_at:i.signedAt||new Date().toISOString(),ip_address:i.ipAddress||null,user_agent:i.userAgent||null}).select().single();if(m)throw m;return d}return null},async syncSignatureToDocument(n,l){if(!v)return null;const i=ce();if(!i)throw new Error("Database client not available");const{document_type:o,document_id:d}=l,m=n.signature_slot,h={};m===1?(h.gc_signature_data=n.signature_image,h.gc_signature_name=n.signer_name,h.gc_signature_title=n.signer_title,h.gc_signature_company=n.signer_company,h.gc_signature_date=n.signed_at,h.gc_signature_ip=n.ip_address):m===2&&(h.client_signature_data=n.signature_image,h.client_signature_name=n.signer_name,h.client_signature_title=n.signer_title,h.client_signature_company=n.signer_company,h.client_signature_date=n.signed_at,h.client_signature_ip=n.ip_address);const g=o==="cor"?"change_orders":"t_and_m_tickets",{data:b,error:O}=await i.from(g).update(h).eq("id",d).select().single();if(O)throw O;return b},async revokeSignatureRequest(n){if(v){const l=ce();if(!l)throw new Error("Database client not available");const{data:i,error:o}=await l.from("signature_requests").update({status:"revoked"}).eq("id",n).select().single();if(o)throw o;return i}return null},async getDocumentForSigning(n,l){if(!v)return null;const i=ce();if(!i)throw new Error("Database client not available");if(n==="cor"){const{data:o,error:d}=await i.from("change_orders").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*)
        `).eq("id",l).single();if(d)throw d;return o}else if(n==="tm_ticket"){const{data:o,error:d}=await i.from("t_and_m_tickets").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (
              id,
              name,
              unit,
              cost_per_unit,
              category
            )
          )
        `).eq("id",l).single();if(d)throw d;return o}return null},async getProjectCosts(n){if(v){const{data:i,error:o}=await y.from("project_costs").select("*").eq("project_id",n).order("cost_date",{ascending:!1});return o?(console.error("Error fetching project costs:",o),[]):i||[]}return(ne().projectCosts||[]).filter(i=>i.project_id===n).sort((i,o)=>new Date(o.cost_date)-new Date(i.cost_date))},async addProjectCost(n,l,i){const o={project_id:n,company_id:l,category:i.category,description:i.description,amount:parseFloat(i.amount),cost_date:i.cost_date||new Date().toISOString().split("T")[0],notes:i.notes||null,created_by:i.created_by||null};if(v){const{data:h,error:g}=await y.from("project_costs").insert(o).select().single();if(g)throw console.error("Error adding project cost:",g),g;return h}const d=ne();d.projectCosts||(d.projectCosts=[]);const m={...o,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return d.projectCosts.push(m),ke(d),m},async updateProjectCost(n,l){const i={category:l.category,description:l.description,amount:parseFloat(l.amount),cost_date:l.cost_date,notes:l.notes||null,updated_at:new Date().toISOString()};if(v){const{data:m,error:h}=await y.from("project_costs").update(i).eq("id",n).select().single();if(h)throw console.error("Error updating project cost:",h),h;return m}const o=ne();if(!o.projectCosts)return null;const d=o.projectCosts.findIndex(m=>m.id===n);return d===-1?null:(o.projectCosts[d]={...o.projectCosts[d],...i},ke(o),o.projectCosts[d])},async deleteProjectCost(n){if(v){const{error:i}=await y.from("project_costs").delete().eq("id",n);if(i)throw console.error("Error deleting project cost:",i),i;return!0}const l=ne();return l.projectCosts&&(l.projectCosts=l.projectCosts.filter(i=>i.id!==n),ke(l)),!0},async getProjectCostsSummary(n){const l=await this.getProjectCosts(n),i={};let o=0;return l.forEach(d=>{const m=parseFloat(d.amount)||0;o+=m,i[d.category]||(i[d.category]={category:d.category,total:0,count:0,items:[]}),i[d.category].total+=m,i[d.category].count++,i[d.category].items.push(d)}),Object.values(i).forEach(d=>{d.percentage=o>0?d.total/o*100:0}),{totalCost:o,byCategory:i,itemCount:l.length}},async getNextInvoiceNumber(n){if(v){const{data:l,error:i}=await y.rpc("get_next_invoice_number",{p_company_id:n});return i?(console.error("Error getting next invoice number:",i),this._generateLocalInvoiceNumber(n)):l}return this._generateLocalInvoiceNumber(n)},async _generateLocalInvoiceNumber(n){const i=(await this.getCompanyInvoices(n)).reduce((o,d)=>{const m=d.invoice_number?.match(/^INV-(\d+)$/);if(m){const h=parseInt(m[1],10);return h>o?h:o}return o},0);return`INV-${String(i+1).padStart(4,"0")}`},async getBillableItems(n){if(v){const{data:l,error:i}=await y.from("change_orders").select("id, cor_number, title, cor_total, status, approved_at").eq("project_id",n).eq("status","approved").order("cor_number",{ascending:!0});i&&console.error("Error fetching billable CORs:",i);const{data:o,error:d}=await y.from("t_and_m_tickets").select("id, work_date, ce_pco_number, change_order_value, status, client_signature_date").eq("project_id",n).eq("status","approved").not("client_signature_data","is",null).order("work_date",{ascending:!0});return d&&console.error("Error fetching billable T&M tickets:",d),{cors:l||[],tickets:o||[]}}return{cors:[],tickets:[]}},async getProjectInvoices(n){if(v){const{data:i,error:o}=await y.from("invoices").select(`
          *,
          invoice_items (*)
        `).eq("project_id",n).order("invoice_date",{ascending:!1});if(o)throw console.error("Error fetching project invoices:",o),o;return i||[]}return(ne().invoices||[]).filter(i=>i.project_id===n)},async getCompanyInvoices(n){if(v){const{data:i,error:o}=await y.from("invoices").select("*").eq("company_id",n).order("invoice_date",{ascending:!1});if(o)throw console.error("Error fetching company invoices:",o),o;return i||[]}return(ne().invoices||[]).filter(i=>i.company_id===n)},async createInvoice(n,l){if(v){const{data:d,error:m}=await y.from("invoices").insert({project_id:n.project_id,company_id:n.company_id,invoice_number:n.invoice_number,invoice_date:n.invoice_date,due_date:n.due_date,status:n.status||"draft",retention_percent:n.retention_percent||0,bill_to_name:n.bill_to_name,bill_to_address:n.bill_to_address,bill_to_contact:n.bill_to_contact,notes:n.notes,terms:n.terms||"Net 30",created_by:n.created_by}).select().single();if(m)throw console.error("Error creating invoice:",m),m;if(l&&l.length>0){const h=l.map((b,O)=>({invoice_id:d.id,item_type:b.item_type,reference_id:b.reference_id,reference_number:b.reference_number,description:b.description,amount:b.amount,sort_order:O})),{error:g}=await y.from("invoice_items").insert(h);if(g)throw console.error("Error creating invoice items:",g),await y.from("invoices").delete().eq("id",d.id),g}return this.getInvoice(d.id)}const i=ne();i.invoices||(i.invoices=[]);const o={...n,id:Jt(),created_at:new Date().toISOString(),invoice_items:l||[]};return i.invoices.push(o),ke(i),o},async getInvoice(n){if(v){const{data:i,error:o}=await y.from("invoices").select(`
          *,
          invoice_items (*)
        `).eq("id",n).single();if(o)throw console.error("Error fetching invoice:",o),o;return i}return(ne().invoices||[]).find(i=>i.id===n)},async updateInvoice(n,l){if(v){const{data:d,error:m}=await y.from("invoices").update(l).eq("id",n).select().single();if(m)throw console.error("Error updating invoice:",m),m;return d}const i=ne(),o=(i.invoices||[]).findIndex(d=>d.id===n);return o>=0?(i.invoices[o]={...i.invoices[o],...l},ke(i),i.invoices[o]):null},async markInvoiceSent(n){return this.updateInvoice(n,{status:"sent",sent_at:new Date().toISOString()})},async recordInvoicePayment(n,l){const i=await this.getInvoice(n);if(!i)throw new Error("Invoice not found");const o=(i.amount_paid||0)+l,d=o>=i.total;return this.updateInvoice(n,{amount_paid:o,status:d?"paid":"partial",paid_at:d?new Date().toISOString():null})},async deleteInvoice(n){if(v){const{error:i}=await y.from("invoices").delete().eq("id",n).eq("status","draft");if(i)throw console.error("Error deleting invoice:",i),i;return!0}const l=ne();return l.invoices=(l.invoices||[]).filter(i=>i.id!==n),ke(l),!0},async markItemsBilled(n=[],l=[]){if(v){if(n.length>0){const{error:i}=await y.from("change_orders").update({status:"billed"}).in("id",n);i&&console.error("Error marking CORs as billed:",i)}if(l.length>0){const{error:i}=await y.from("t_and_m_tickets").update({status:"billed"}).in("id",l);i&&console.error("Error marking T&M tickets as billed:",i)}}},async createFolder(n,l,i){const o=ce(),{data:d,error:m}=await o.from("document_folders").insert({company_id:n,project_id:l,name:i.name,description:i.description||null,icon:i.icon||"folder",color:i.color||"blue",sort_order:i.sort_order||0,created_by:(await o.auth.getUser()).data.user?.id}).select().single();if(m)throw m;return d},async getProjectFolders(n){const l=ce(),{data:i,error:o}=await l.from("document_folders").select("*").eq("project_id",n).order("sort_order",{ascending:!0}).order("name",{ascending:!0});if(o)throw o;const d=i.map(m=>m.id);if(d.length>0){const{data:m,error:h}=await l.from("documents").select("folder_id").in("folder_id",d).is("archived_at",null);if(!h&&m){const g={};m.forEach(b=>{g[b.folder_id]=(g[b.folder_id]||0)+1}),i.forEach(b=>{b.document_count=g[b.id]||0})}}return i},async updateFolder(n,l){const i=ce(),{data:o,error:d}=await i.from("document_folders").update({...l,updated_at:new Date().toISOString()}).eq("id",n).select().single();if(d)throw d;return o},async deleteFolder(n){const l=ce();await l.from("documents").update({folder_id:null}).eq("folder_id",n);const{error:i}=await l.from("document_folders").delete().eq("id",n);if(i)throw i;return!0},async reorderFolders(n,l){const i=ce(),o=l.map(({id:d,sort_order:m})=>i.from("document_folders").update({sort_order:m,updated_at:new Date().toISOString()}).eq("id",d).eq("project_id",n));return await Promise.all(o),!0},async getFolderDocuments(n,l={}){const i=ce(),{page:o=0,limit:d=25}=l;let m=i.from("documents").select("*",{count:"exact"}).eq("folder_id",n).is("archived_at",null).eq("is_current",!0).order("uploaded_at",{ascending:!1}).range(o*d,(o+1)*d-1);const{data:h,error:g,count:b}=await m;if(g)throw g;return{documents:h||[],totalCount:b||0,hasMore:(b||0)>(o+1)*d}},async moveDocumentToFolder(n,l){const i=ce(),{data:o,error:d}=await i.from("documents").update({folder_id:l}).eq("id",n).select().single();if(d)throw d;return o},async getUnfiledDocuments(n,l={}){const i=ce(),{page:o=0,limit:d=25}=l,{data:m,error:h,count:g}=await i.from("documents").select("*",{count:"exact"}).eq("project_id",n).is("folder_id",null).is("archived_at",null).eq("is_current",!0).order("uploaded_at",{ascending:!1}).range(o*d,(o+1)*d-1);if(h)throw h;return{documents:m||[],totalCount:g||0,hasMore:(g||0)>(o+1)*d}},async uploadDocument(n,l,i,o={}){const d=ce(),m=Date.now(),h=250*1024*1024,{data:g}=await d.from("documents").select("file_size_bytes").eq("project_id",l).is("archived_at",null),b=g?.reduce(($,M)=>$+(M.file_size_bytes||0),0)||0;if(b+i.size>h){const $=Math.round(b/1024/1024),M=Math.round(h/1024/1024);throw new Error(`Project storage limit reached (${$}/${M} MB). Contact support to upgrade.`)}const O=Date.now(),H=new Uint8Array(6);crypto.getRandomValues(H);const x=Array.from(H,$=>$.toString(36)).join(""),X=i.name.split(".").pop()?.toLowerCase()||"bin",re=`${O}-${x}.${X}`,F=`${n}/${l}/documents/${re}`;try{const{data:$,error:M}=await d.storage.from("project-documents").upload(F,i,{cacheControl:"3600",upsert:!1});if(M)throw M;const{data:K}=d.storage.from("project-documents").getPublicUrl(F),se=K.publicUrl,le=o.category==="contracts"?"pending":"approved",{data:ue,error:we}=await d.from("documents").insert({company_id:n,project_id:l,name:o.name||i.name.replace(/\.[^/.]+$/,""),description:o.description||null,file_name:i.name,file_size_bytes:i.size,mime_type:i.type,storage_path:F,folder_id:o.folderId||null,category:o.category||"general",tags:o.tags||[],visibility:o.visibility||"all",approval_status:le,resource_type:o.resourceType||null,resource_id:o.resourceId||null,uploaded_by:(await d.auth.getUser()).data?.user?.id}).select().single();if(we)throw we;const xe=Date.now()-m;return De.storage("document_upload",{company_id:n,project_id:l,file_size:i.size,mime_type:i.type,duration:xe,success:!0}),{...ue,url:se}}catch($){throw De.error("storage",{message:$.message,operation:"uploadDocument",company_id:n,project_id:l}),$}},async getProjectDocuments(n,{category:l=null,page:i=0,limit:o=25,includeArchived:d=!1}={}){let h=ce().from("documents").select("*",{count:"exact"}).eq("project_id",n).eq("is_current",!0).order("uploaded_at",{ascending:!1}).range(i*o,(i+1)*o-1);d||(h=h.is("archived_at",null)),l&&l!=="all"&&(h=h.eq("category",l));const{data:g,error:b,count:O}=await h;if(b)throw b;return{documents:g||[],totalCount:O||0,hasMore:(i+1)*o<(O||0),page:i,limit:o}},async getDocument(n){const l=ce(),{data:i,error:o}=await l.from("documents").select("*").eq("id",n).single();if(o)throw o;return i},async getDocumentVersions(n){const l=ce(),{data:i,error:o}=await l.from("documents").select("id, parent_document_id").eq("id",n).single();if(o)throw o;const d=i.parent_document_id||n,{data:m,error:h}=await l.from("documents").select("*").or(`id.eq.${d},parent_document_id.eq.${d}`).order("version",{ascending:!1});if(h)throw h;return m||[]},async uploadDocumentVersion(n,l,i,o,d={}){const m=ce(),{data:h,error:g}=await m.from("documents").select("*").eq("id",n).single();if(g)throw g;const{data:b}=await m.from("documents").select("version").or(`id.eq.${n},parent_document_id.eq.${n}`).order("version",{ascending:!1}).limit(1),O=(b?.[0]?.version||1)+1;await m.from("documents").update({is_current:!1}).or(`id.eq.${n},parent_document_id.eq.${n}`);const H=await this.uploadDocument(l,i,o,{name:d.name||h.name,description:d.description||h.description,category:h.category,visibility:h.visibility,tags:h.tags,resourceType:h.resource_type,resourceId:h.resource_id}),{data:x,error:X}=await m.from("documents").update({version:O,is_current:!0,parent_document_id:n}).eq("id",H.id).select().single();if(X)throw X;return await m.from("document_audit_log").insert({document_id:H.id,project_id:i,company_id:l,operation:"version_created",details:{version:O,parent_id:n},triggered_by:"user",user_id:(await m.auth.getUser()).data?.user?.id}),{...H,...x}},async updateDocument(n,l){const i=ce(),{data:o,error:d}=await i.from("documents").update({name:l.name,description:l.description,category:l.category,visibility:l.visibility,tags:l.tags}).eq("id",n).select().single();if(d)throw d;return o},async archiveDocument(n){const l=ce(),i=(await l.auth.getUser()).data?.user?.id,{data:o,error:d}=await l.from("documents").update({archived_at:new Date().toISOString(),archived_by:i}).eq("id",n).select().single();if(d)throw d;return await l.from("document_audit_log").insert({document_id:n,project_id:o.project_id,company_id:o.company_id,operation:"deleted",triggered_by:"user",user_id:i}),o},async restoreDocument(n){const l=ce(),i=(await l.auth.getUser()).data?.user?.id,{data:o,error:d}=await l.from("documents").update({archived_at:null,archived_by:null}).eq("id",n).select().single();if(d)throw d;return await l.from("document_audit_log").insert({document_id:n,project_id:o.project_id,company_id:o.company_id,operation:"restored",triggered_by:"user",user_id:i}),o},async deleteDocumentPermanently(n){const l=ce(),{data:i,error:o}=await l.from("documents").select("storage_path, company_id, project_id").eq("id",n).single();if(o)throw o;i.storage_path&&await l.storage.from("project-documents").remove([i.storage_path]);const{error:d}=await l.from("documents").delete().eq("id",n);if(d)throw d;return!0},async linkDocumentToResource(n,l,i){const o=ce(),{data:d,error:m}=await o.from("documents").update({resource_type:l,resource_id:i}).eq("id",n).select().single();if(m)throw m;return await o.from("document_audit_log").insert({document_id:n,project_id:d.project_id,company_id:d.company_id,operation:"linked",details:{resource_type:l,resource_id:i},triggered_by:"user",user_id:(await o.auth.getUser()).data?.user?.id}),d},async unlinkDocumentFromResource(n){const l=ce(),{data:i}=await l.from("documents").select("resource_type, resource_id, project_id, company_id").eq("id",n).single(),{data:o,error:d}=await l.from("documents").update({resource_type:null,resource_id:null}).eq("id",n).select().single();if(d)throw d;return await l.from("document_audit_log").insert({document_id:n,project_id:i.project_id,company_id:i.company_id,operation:"unlinked",details:{resource_type:i.resource_type,resource_id:i.resource_id},triggered_by:"user",user_id:(await l.auth.getUser()).data?.user?.id}),o},async getResourceDocuments(n,l){const i=ce(),{data:o,error:d}=await i.from("documents").select("*").eq("resource_type",n).eq("resource_id",l).is("archived_at",null).order("uploaded_at",{ascending:!1});if(d)throw d;return o||[]},async approveDocument(n){const l=ce(),{data:i,error:o}=await l.rpc("approve_document",{p_document_id:n});if(o)throw o;return i},async rejectDocument(n,l){const i=ce(),{data:o,error:d}=await i.rpc("reject_document",{p_document_id:n,p_reason:l});if(d)throw d;return o},async getPendingDocuments(n){const l=ce(),{data:i,error:o}=await l.from("documents").select("*, project:projects(name)").eq("company_id",n).eq("approval_status","pending").is("archived_at",null).order("uploaded_at",{ascending:!1});if(o)throw o;return i||[]},async searchDocuments(n,l){const i=ce(),{data:o,error:d}=await i.from("documents").select("*").eq("project_id",n).eq("is_current",!0).is("archived_at",null).or(`name.ilike.%${l}%,description.ilike.%${l}%`).order("uploaded_at",{ascending:!1}).limit(20);if(d)throw d;return o||[]},async logDocumentAccess(n,l="downloaded"){const i=ce(),{data:o}=await i.from("documents").select("project_id, company_id").eq("id",n).single();o&&await i.from("document_audit_log").insert({document_id:n,project_id:o.project_id,company_id:o.company_id,operation:l,triggered_by:"user",user_id:(await i.auth.getUser()).data?.user?.id})}},y_={async getCompanyEquipment(n,l=!0){if(!v)return console.warn("Supabase not configured"),[];let i=y.from("equipment").select("*").eq("company_id",n).order("name");l&&(i=i.eq("is_active",!0));const{data:o,error:d}=await i;return d?(console.error("Error fetching company equipment:",d),[]):o||[]},async createEquipment(n){if(!v)return console.warn("Supabase not configured"),null;const{data:l,error:i}=await y.from("equipment").insert(n).select().single();if(i)throw console.error("Error creating equipment:",i),i;return l},async updateEquipment(n,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:o}=await y.from("equipment").update(l).eq("id",n).select().single();if(o)throw console.error("Error updating equipment:",o),o;return i},async deactivateEquipment(n){return this.updateEquipment(n,{is_active:!1})},async getProjectEquipment(n){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await y.from("project_equipment").select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).eq("project_id",n).order("start_date",{ascending:!1});return i?(console.error("Error fetching project equipment:",i),[]):l||[]},async getActiveProjectEquipment(n){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await y.from("project_equipment").select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).eq("project_id",n).is("end_date",null).order("start_date",{ascending:!1});return i?(console.error("Error fetching active project equipment:",i),[]):l||[]},async addEquipmentToProject(n){if(!v)return console.warn("Supabase not configured"),null;const{data:l,error:i}=await y.from("project_equipment").insert(n).select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).single();if(i)throw console.error("Error adding equipment to project:",i),i;return l},async updateProjectEquipment(n,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:o}=await y.from("project_equipment").update(l).eq("id",n).select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).single();if(o)throw console.error("Error updating project equipment:",o),o;return i},async markEquipmentReturned(n,l=null){return this.updateProjectEquipment(n,{end_date:l||new Date().toISOString().split("T")[0]})},async removeEquipmentFromProject(n){if(!v)return console.warn("Supabase not configured"),!1;const{error:l}=await y.from("project_equipment").delete().eq("id",n);if(l)throw console.error("Error removing project equipment:",l),l;return!0},calculateProjectEquipmentCost(n){const l=new Date;return l.setHours(0,0,0,0),n.reduce((i,o)=>{const d=new Date(o.start_date);d.setHours(0,0,0,0);let m;o.end_date?(m=new Date(o.end_date),m.setHours(0,0,0,0)):m=l;const h=Math.max(1,Math.floor((m-d)/(1e3*60*60*24))+1);return i+o.daily_rate*h},0)},calculateDaysOnSite(n,l=null){const i=new Date(n);i.setHours(0,0,0,0);let o;return l?o=new Date(l):o=new Date,o.setHours(0,0,0,0),Math.max(1,Math.floor((o-i)/(1e3*60*60*24))+1)}},v_={async getNextDrawNumber(n){if(!v)return console.warn("Supabase not configured"),1;const{data:l,error:i}=await y.from("draw_requests").select("draw_number").eq("project_id",n).order("draw_number",{ascending:!1}).limit(1).single();return i&&i.code!=="PGRST116"&&console.error("Error getting next draw number:",i),(l?.draw_number||0)+1},async getPreviousBillingTotals(n){if(!v)return console.warn("Supabase not configured"),{totalBilled:0,totalRetention:0};const{data:l,error:i}=await y.from("draw_requests").select("current_billing, retention_held").eq("project_id",n).in("status",["submitted","approved","paid"]);if(i)return console.error("Error getting previous billing totals:",i),{totalBilled:0,totalRetention:0};const o=(l||[]).reduce((m,h)=>m+(h.current_billing||0),0),d=l?.length>0?Math.max(...l.map(m=>m.retention_held||0)):0;return{totalBilled:o,totalRetention:d}},async getProjectDrawRequests(n){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await y.from("draw_requests").select("*").eq("project_id",n).order("draw_number",{ascending:!1});return i?(console.error("Error fetching draw requests:",i),[]):l||[]},async getDrawRequest(n){if(!v)return console.warn("Supabase not configured"),null;const{data:l,error:i}=await y.from("draw_requests").select(`
        *,
        draw_request_items (
          *
        )
      `).eq("id",n).single();return i?(console.error("Error fetching draw request:",i),null):l},async createDrawRequest(n,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:o}=await y.from("draw_requests").insert(n).select().single();if(o)throw console.error("Error creating draw request:",o),o;if(l&&l.length>0){const d=l.map((h,g)=>({...h,draw_request_id:i.id,sort_order:g})),{error:m}=await y.from("draw_request_items").insert(d);m&&console.error("Error creating draw request items:",m)}return this.getDrawRequest(i.id)},async updateDrawRequest(n,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:o}=await y.from("draw_requests").update(l).eq("id",n).select().single();if(o)throw console.error("Error updating draw request:",o),o;return i},async updateDrawRequestStatus(n,l){const i={status:l};return l==="submitted"?i.submitted_at=new Date().toISOString():l==="approved"?i.approved_at=new Date().toISOString():l==="paid"&&(i.paid_at=new Date().toISOString()),this.updateDrawRequest(n,i)},async updateDrawRequestItems(n,l){if(!v)return console.warn("Supabase not configured"),!1;const{error:i}=await y.from("draw_request_items").delete().eq("draw_request_id",n);if(i)throw console.error("Error deleting old draw request items:",i),i;if(l&&l.length>0){const o=l.map((m,h)=>({...m,draw_request_id:n,sort_order:h})),{error:d}=await y.from("draw_request_items").insert(o);if(d)throw console.error("Error inserting draw request items:",d),d}return!0},async deleteDrawRequest(n){if(!v)return console.warn("Supabase not configured"),!1;const{error:l}=await y.from("draw_requests").delete().eq("id",n);if(l)throw console.error("Error deleting draw request:",l),l;return!0},async getScheduleOfValues(n){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await y.from("areas").select("id, name, square_footage, price_per_sqft").eq("project_id",n).order("created_at");return i?(console.error("Error fetching schedule of values:",i),[]):(l||[]).map((o,d)=>({area_id:o.id,item_number:String(d+1),description:o.name,scheduled_value:Math.round((o.square_footage||0)*(o.price_per_sqft||0)*100)}))},async getPreviousDrawItems(n){if(!v)return console.warn("Supabase not configured"),{};const{data:l,error:i}=await y.from("draw_requests").select("id").eq("project_id",n).in("status",["submitted","approved","paid"]).order("draw_number",{ascending:!1}).limit(1).single();if(i&&i.code!=="PGRST116")return console.error("Error fetching latest draw:",i),{};if(!l)return{};const{data:o,error:d}=await y.from("draw_request_items").select("area_id, total_percent, total_amount").eq("draw_request_id",l.id);return d?(console.error("Error fetching previous draw items:",d),{}):(o||[]).reduce((m,h)=>(h.area_id&&(m[h.area_id]={previous_percent:h.total_percent||0,previous_amount:h.total_amount||0}),m),{})},calculatePercentFromAmount(n,l){return!l||l===0?0:Math.round(n/l*1e4)},calculateAmountFromPercent(n,l){return Math.round(n/1e4*l)}};iu(async n=>{if(n&&v)try{await _h(he)}catch(l){console.error("Error syncing pending actions:",l)}});const W_=Object.freeze(Object.defineProperty({__proto__:null,auth:nu,clearFieldSession:tu,db:he,drawRequestOps:v_,equipmentOps:y_,getConnectionStatus:ja,getPendingActionCount:Ni,isFieldMode:au,isSupabaseConfigured:v,onConnectionChange:iu,supabase:y,syncPendingActions:_h},Symbol.toStringTag,{value:"Module"})),bh=N.createContext(),la={logo_url:null,favicon_url:null,login_background_url:null,primary_color:"#3B82F6",secondary_color:"#1E40AF",custom_app_name:"FieldSync",hide_fieldsync_branding:!1,email_from_name:"FieldSync",email_from_address:null,custom_domain:null,domain_verified:!1};function fn({children:n,companyId:l}){const[i,o]=N.useState(la),[d,m]=N.useState(!0);N.useEffect(()=>{l?h(l):g()},[l]),N.useEffect(()=>{H(i)},[i]);const h=async F=>{try{if(m(!0),!v){o(la),m(!1);return}const{data:$,error:M}=await y.from("company_branding").select("*").eq("company_id",F).single();M?(M.code==="PGRST116"?await b(F):console.error("Error loading branding:",M),o(la)):o({...la,...$})}catch($){console.error("Error in loadBranding:",$),o(la)}finally{m(!1)}},g=async()=>{try{m(!0);const F=window.location.hostname;if(F==="localhost"||F==="127.0.0.1"){o(la),m(!1);return}if(!v){o(la),m(!1);return}const{data:$,error:M}=await y.rpc("get_branding_by_domain",{domain_name:F});M||!$||$.length===0?o(la):o({...la,...$[0]})}catch(F){console.error("Error loading branding by domain:",F),o(la)}finally{m(!1)}},b=async F=>{try{const{data:$,error:M}=await y.from("company_branding").insert({company_id:F,...la}).select().single();M&&console.error("Error creating default branding:",M)}catch($){console.error("Error in createDefaultBranding:",$)}},O=N.useCallback(async F=>{try{if(!v)return o(we=>({...we,...F})),{success:!0};if(!l)return{success:!1,error:"No company ID"};const $={},M=["logo_url","favicon_url","login_background_url","primary_color","secondary_color","custom_app_name","hide_fieldsync_branding","email_from_name","email_from_address","custom_domain","domain_verified"];for(const we of M)F[we]!==void 0&&($[we]=F[we]);const{data:K,error:se}=await y.from("company_branding").select("id").eq("company_id",l).single();if(se&&se.code==="PGRST116"){const{data:we,error:xe}=await y.from("company_branding").insert({company_id:l,...$}).select().single();return xe?(console.error("Error creating branding:",xe),{success:!1,error:xe.message}):(o({...la,...we}),{success:!0,data:we})}const{data:le,error:ue}=await y.from("company_branding").update($).eq("company_id",l).select().single();return ue?(console.error("Error updating branding:",ue),{success:!1,error:ue.message}):(o({...la,...le}),{success:!0,data:le})}catch($){return console.error("Error in updateBranding:",$),{success:!1,error:$.message}}},[l]),H=F=>{const $=document.documentElement;if($.style.setProperty("--primary-color",F.primary_color),$.style.setProperty("--secondary-color",F.secondary_color),F.favicon_url){let M=document.querySelector("link[rel*='icon']");M||(M=document.createElement("link"),M.rel="icon",document.head.appendChild(M)),M.href=F.favicon_url}document.title=F.custom_app_name||"FieldSync"},x=N.useCallback(async(F,$)=>{try{if(!v)return{success:!0,url:URL.createObjectURL(F)};const M=F.name.split(".").pop(),se=`branding/${`${l}/${$}-${Date.now()}.${M}`}`,{data:le,error:ue}=await y.storage.from("public").upload(se,F,{cacheControl:"3600",upsert:!0});if(ue)return console.error("Error uploading image:",ue),{success:!1,error:ue.message};const{data:{publicUrl:we}}=y.storage.from("public").getPublicUrl(se);return{success:!0,url:we}}catch(M){return console.error("Error in uploadBrandingImage:",M),{success:!1,error:M.message}}},[l]),X=N.useCallback(()=>{l?h(l):g()},[l]),re=N.useMemo(()=>({branding:i,loading:d,updateBranding:O,uploadBrandingImage:x,refreshBranding:X}),[i,d,O,x,X]);return s.jsx(bh.Provider,{value:re,children:n})}function b_(){const n=N.useContext(bh);if(!n)throw new Error("useBranding must be used within a BrandingProvider");return n}const jh=N.createContext();function hn({children:n}){const[l,i]=N.useState(()=>{const m=localStorage.getItem("fieldsync-theme");return m==="light"||m==="dark"?m:window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"});N.useEffect(()=>{document.documentElement.setAttribute("data-theme",l),localStorage.setItem("fieldsync-theme",l)},[l]),N.useEffect(()=>{const m=window.matchMedia("(prefers-color-scheme: light)"),h=g=>{localStorage.getItem("fieldsync-theme")||i(g.matches?"light":"dark")};return m.addEventListener("change",h),()=>m.removeEventListener("change",h)},[]);const o=N.useCallback(()=>{i(m=>m==="dark"?"light":"dark")},[]),d=N.useMemo(()=>({theme:l,setTheme:i,toggleTheme:o}),[l,o]);return s.jsx(jh.Provider,{value:d,children:n})}function j_(){const n=N.useContext(jh);if(!n)throw new Error("useTheme must be used within a ThemeProvider");return n}function wa({className:n="",showPoweredBy:l=!1}){const{branding:i}=b_();return s.jsxs("div",{className:`app-logo ${n}`,children:[i.logo_url?s.jsx("img",{src:i.logo_url,alt:i.custom_app_name||"Logo",className:"custom-logo"}):s.jsxs("div",{className:"logo",children:[i.custom_app_name||"Field",s.jsx("span",{children:"Sync"})]}),l&&!i.hide_fieldsync_branding&&s.jsx("div",{className:"powered-by",children:"Powered by FieldSync"})]})}function w_({onForemanAccess:n,onOfficeLogin:l,onShowToast:i}){const[o,d]=N.useState(null),[m,h]=N.useState(""),[g,b]=N.useState(null),[O,H]=N.useState(""),[x,X]=N.useState(!1),[re,F]=N.useState(""),$=N.useRef(null),M=N.useRef(null);N.useEffect(()=>()=>{$.current&&clearTimeout($.current),M.current&&clearTimeout(M.current)},[]);const[K,se]=N.useState(""),[le,ue]=N.useState(""),[we,xe]=N.useState(1),[Le,Qe]=N.useState(null),[Me,Ie]=N.useState(""),[Ke,W]=N.useState(""),[ye,Ae]=N.useState(""),[ve,D]=N.useState(""),Q=J=>{const ee=J.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,20);h(ee)},te=async()=>{if(m.length<2){i("Enter company code","error");return}X(!0);try{const J=await he.getCompanyByCode(m);J?b(J):(i("Invalid company code","error"),h(""))}catch{i("Error checking code","error")}finally{X(!1)}},G=async J=>{if(J.length===4){X(!0),F("");try{const ee=await he.getProjectByPinSecure(J,g.code);if(ee.rateLimited){F("error"),i("Too many attempts. Please wait 15 minutes.","error"),$.current&&clearTimeout($.current),$.current=setTimeout(()=>{H(""),F("")},800);return}if(ee.success&&ee.project){n(ee.project);return}if(ee.error){const je=await he.getProjectByPinAndCompany(J,g.id);if(je){n(je);return}}i("Invalid PIN","error"),H("")}catch{try{const je=await he.getProjectByPinAndCompany(J,g.id);if(je){n(je);return}}catch{}i("Error checking PIN","error"),H("")}finally{X(!1)}}},R=J=>{if(O.length<4&&!x){const ee=O+J;H(ee),F(""),ee.length===4&&(M.current&&clearTimeout(M.current),M.current=setTimeout(()=>G(ee),150))}},ie=()=>{x||(H(J=>J.slice(0,-1)),F(""))},P=()=>{b(null),H(""),F("")},_e=()=>{if(!K.trim()||!le.trim()){i("Enter email and password","error");return}l(K,le)},Ne=async()=>{if(m.length<2){i("Enter company code","error");return}X(!0);try{const J=await he.getCompanyByCode(m);J?(Qe(J),xe(2)):(i("Invalid company code","error"),h(""))}catch{i("Error checking code","error")}finally{X(!1)}},et=async()=>{if(!Me.trim()){i("Enter office code","error");return}X(!0);try{const{data:J,error:ee}=await y.rpc("verify_office_code",{company_id:Le.id,code:Me.trim()});if(ee)throw ee;J===!0?xe(3):(i("Invalid office code","error"),Ie(""))}catch{i("Error verifying code","error")}finally{X(!1)}},qe=async()=>{if(!Ke.trim()){i("Enter your name","error");return}if(!ye.trim()||!ye.includes("@")){i("Enter valid email","error");return}if(ve.length<6){i("Password must be 6+ characters","error");return}X(!0);try{const J=ye.toLowerCase().trim(),{data:ee,error:je}=await y.auth.signUp({email:J,password:ve});let Te;if(je?.message?.includes("already registered")||ee?.user&&ee.user.identities?.length===0){const{data:We,error:lt}=await y.auth.signInWithPassword({email:J,password:ve});if(lt){i("Account exists with different password. Use your existing password.","error"),X(!1);return}Te=We.user.id;const{data:it}=await y.from("user_companies").select("id, status").eq("user_id",Te).eq("company_id",Le.id).maybeSingle();if(it){it.status==="active"?(i("You already belong to this company. Logging you in...","success"),setTimeout(()=>window.location.reload(),1e3)):it.status==="pending"?(i("Your request is still pending approval.","error"),await y.auth.signOut()):(i("Your membership was removed. Contact the company admin.","error"),await y.auth.signOut());return}const{error:Ht}=await y.from("user_companies").insert({user_id:Te,company_id:Le.id,role:"member",status:"pending"});if(Ht)throw console.error("Error adding to user_companies:",Ht),await y.auth.signOut(),new Error("Failed to submit join request");await y.auth.signOut(),i("Request to join submitted! Awaiting admin approval.","success")}else{if(je)throw je;{if(Te=ee.user?.id,!Te)throw new Error("Failed to create user");const{error:We}=await y.from("users").insert({id:Te,email:J,password_hash:"managed_by_supabase_auth",name:Ke.trim(),company_id:Le.id,role:"member",is_active:!0});if(We)throw We;const{error:lt}=await y.from("user_companies").insert({user_id:Te,company_id:Le.id,role:"member",status:"pending"});if(lt)throw console.error("Error adding to user_companies:",lt),new Error("Failed to submit join request");await y.auth.signOut(),i("Account created! Awaiting admin approval.","success")}}}catch(J){console.error("Join error:",J),i(J.message||"Error creating account","error")}finally{X(!1)}};if(o===null)return s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx(wa,{className:"entry-logo",showPoweredBy:!1}),s.jsxs("div",{className:"entry-buttons",children:[s.jsxs("button",{className:"entry-mode-btn foreman",onClick:()=>d("foreman"),children:[s.jsx("span",{className:"entry-mode-icon",children:s.jsx(_n,{size:32})}),s.jsx("span",{className:"entry-mode-title",children:"Foreman"}),s.jsx("span",{className:"entry-mode-desc",children:"Enter project PIN"})]}),s.jsxs("button",{className:"entry-mode-btn office",onClick:()=>d("office"),children:[s.jsx("span",{className:"entry-mode-icon",children:s.jsx(Sg,{size:32})}),s.jsx("span",{className:"entry-mode-title",children:"Office"}),s.jsx("span",{className:"entry-mode-desc",children:"Sign in to dashboard"})]})]})]})});if(o==="foreman")return g?s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:P,children:""}),s.jsx(wa,{className:"entry-logo",showPoweredBy:!1}),s.jsx("div",{className:"entry-company-badge",children:g.name}),s.jsx("p",{className:"entry-subtitle",children:"Enter project PIN"}),s.jsx("div",{className:`pin-display ${re==="error"?"shake":""}`,children:[0,1,2,3].map(J=>s.jsx("div",{className:`pin-dot ${O.length>J?"filled":""} ${re}`,children:O.length>J?"":""},J))}),s.jsxs("div",{className:"number-pad",children:[[1,2,3,4,5,6,7,8,9].map(J=>s.jsx("button",{className:"num-btn",onClick:()=>R(J.toString()),disabled:x,children:J},J)),s.jsx("button",{className:"num-btn empty",disabled:!0}),s.jsx("button",{className:"num-btn",onClick:()=>R("0"),disabled:x,children:"0"}),s.jsx("button",{className:"num-btn backspace",onClick:ie,disabled:x||O.length===0,children:""})]}),x&&s.jsx("div",{className:"entry-loading",children:s.jsx("div",{className:"spinner"})})]})}):s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>d(null),children:""}),s.jsx(wa,{className:"entry-logo",showPoweredBy:!1}),s.jsx("p",{className:"entry-subtitle",children:"Enter company code"}),s.jsxs("div",{className:"entry-input-group",children:[s.jsx("input",{type:"text",value:m,onChange:J=>Q(J.target.value),placeholder:"Company Code",disabled:x,autoFocus:!0,onKeyDown:J=>{J.key==="Enter"&&te()}}),s.jsx("button",{className:"entry-submit-btn",onClick:te,disabled:x||m.length<2,children:x?"...":""})]})]})});if(o==="office")return s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>d(null),children:""}),s.jsx(wa,{className:"entry-logo",showPoweredBy:!1}),s.jsx("p",{className:"entry-subtitle",children:"Sign in to your account"}),s.jsxs("div",{className:"entry-form",children:[s.jsx("input",{type:"email",value:K,onChange:J=>se(J.target.value),placeholder:"Email",autoFocus:!0,onKeyDown:J=>{J.key==="Enter"&&_e()}}),s.jsx("input",{type:"password",value:le,onChange:J=>ue(J.target.value),placeholder:"Password",onKeyDown:J=>{J.key==="Enter"&&_e()}}),s.jsx("button",{className:"entry-login-btn",onClick:_e,children:"Sign In"})]}),s.jsxs("div",{className:"entry-signup-hint",children:[s.jsx("p",{children:"New employee?"}),s.jsx("button",{className:"entry-join-link",onClick:()=>d("join"),children:"Join your company"})]})]})});if(o==="join")return we===1?s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>d("office"),children:""}),s.jsx(wa,{className:"entry-logo",showPoweredBy:!1}),s.jsx("p",{className:"entry-subtitle",children:"Enter your company code"}),s.jsx("p",{className:"entry-hint",children:"Ask your manager or admin for the code"}),s.jsxs("div",{className:"entry-input-group",children:[s.jsx("input",{type:"text",value:m,onChange:J=>Q(J.target.value),placeholder:"Company Code",disabled:x,autoFocus:!0,onKeyDown:J=>{J.key==="Enter"&&Ne()}}),s.jsx("button",{className:"entry-submit-btn",onClick:Ne,disabled:x||m.length<2,children:x?"...":""})]})]})}):we===2?s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>{xe(1),Qe(null),Ie("")},children:""}),s.jsx(wa,{className:"entry-logo",showPoweredBy:!1}),s.jsx("div",{className:"entry-company-badge",children:Le?.name}),s.jsx("p",{className:"entry-subtitle",children:"Enter office code"}),s.jsx("p",{className:"entry-hint",children:"This code is only for office staff"}),s.jsxs("div",{className:"entry-input-group",children:[s.jsx("input",{type:"password",value:Me,onChange:J=>Ie(J.target.value),placeholder:"Office Code",disabled:x,autoFocus:!0,onKeyDown:J=>{J.key==="Enter"&&et()}}),s.jsx("button",{className:"entry-submit-btn",onClick:et,disabled:x||!Me.trim(),children:x?"...":""})]})]})}):s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>{xe(2),Ie("")},children:""}),s.jsx(wa,{className:"entry-logo",showPoweredBy:!1}),s.jsx("div",{className:"entry-company-badge",children:Le?.name}),s.jsx("p",{className:"entry-subtitle",children:"Create your account"}),s.jsxs("div",{className:"entry-form",children:[s.jsx("input",{type:"text",value:Ke,onChange:J=>W(J.target.value),placeholder:"Your Name",autoFocus:!0}),s.jsx("input",{type:"email",value:ye,onChange:J=>Ae(J.target.value),placeholder:"Email"}),s.jsx("input",{type:"password",value:ve,onChange:J=>D(J.target.value),placeholder:"Password (6+ characters)",onKeyDown:J=>{J.key==="Enter"&&qe()}}),s.jsx("button",{className:"entry-login-btn",onClick:qe,disabled:x,children:x?"Creating...":"Join Company"})]}),s.jsx("p",{className:"entry-join-note",children:"You'll join as a team member. Your admin can update your role."})]})})}function pn({message:n,type:l="",onClose:i}){return N.useEffect(()=>{const o=setTimeout(i,3e3);return()=>clearTimeout(o)},[i]),s.jsx("div",{className:"toast-container",children:s.jsx("div",{className:`toast ${l}`,children:n})})}function ah({compact:n=!1}){const{theme:l,toggleTheme:i}=j_();return s.jsx("button",{className:`theme-toggle ${n?"theme-toggle-compact":""}`,onClick:i,title:`Switch to ${l==="dark"?"light":"dark"} mode`,"aria-label":`Switch to ${l==="dark"?"light":"dark"} mode`,children:l==="dark"?s.jsxs(s.Fragment,{children:[s.jsx(ih,{size:n?18:16}),!n&&s.jsx("span",{children:"Light"})]}):s.jsxs(s.Fragment,{children:[s.jsx(oh,{size:n?18:16}),!n&&s.jsx("span",{children:"Dark"})]})})}class ts extends N.Component{constructor(l){super(l),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(l){return{hasError:!0}}componentDidCatch(l,i){this.setState({error:l,errorInfo:i}),console.error("ErrorBoundary caught an error:",l,i),(l?.message?.includes("Failed to fetch dynamically imported module")||l?.message?.includes("Loading chunk")||l?.message?.includes("Loading CSS chunk"))&&(console.warn("[ErrorBoundary] Chunk load failure detected, clearing cache and reloading..."),"caches"in window?caches.keys().then(d=>{Promise.all(d.map(m=>caches.delete(m))).then(()=>{window.location.reload()})}).catch(d=>{console.warn("[ErrorBoundary] Cache clear failed, reloading anyway:",d.message),window.location.reload()}):window.location.reload())}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleReload=()=>{window.location.reload()};render(){return this.state.hasError?s.jsx("div",{className:"error-boundary",children:s.jsxs("div",{className:"error-boundary-content",children:[s.jsx("div",{className:"error-icon",children:s.jsx(Di,{size:48})}),s.jsx("h2",{children:"Something went wrong"}),s.jsx("p",{children:"We're sorry, but something unexpected happened. Please try again."}),s.jsxs("div",{className:"error-actions",children:[s.jsx("button",{className:"btn btn-primary",onClick:this.handleRetry,children:"Try Again"}),s.jsx("button",{className:"btn btn-secondary",onClick:this.handleReload,children:"Reload Page"})]}),!1]})}):this.props.children}}function rh(){const[n,l]=N.useState(ja()),[i,o]=N.useState(0),[d,m]=N.useState(!1),h=N.useRef(!1),g=N.useRef(null);return N.useEffect(()=>{const b=iu(async H=>{l(H),H&&h.current&&(m(!0),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>m(!1),3e3),h.current=!1),H||(h.current=!0);const x=await Ni();o(x)});Ni().then(o);const O=setInterval(async()=>{if(!ja()){const H=await Ni();o(H)}},5e3);return()=>{b(),clearInterval(O),g.current&&clearTimeout(g.current)}},[]),n&&i===0&&!d?null:s.jsxs("div",{className:`offline-indicator ${n?"online":"offline"} ${d?"synced":""}`,children:[s.jsx("div",{className:"offline-indicator-content",children:n?d?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"online-icon",children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})})}),s.jsx("span",{className:"offline-text",children:"Changes synced!"})]}):i>0?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"syncing-icon",children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("polyline",{points:"23 4 23 10 17 10"}),s.jsx("polyline",{points:"1 20 1 14 7 14"}),s.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),s.jsxs("span",{className:"offline-text",children:["Syncing ",i,"..."]})]}):null:s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"offline-icon",children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),s.jsx("path",{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}),s.jsx("path",{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}),s.jsx("path",{d:"M10.71 5.05A16 16 0 0 1 22.58 9"}),s.jsx("path",{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"}),s.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),s.jsx("line",{x1:"12",y1:"20",x2:"12.01",y2:"20"})]})}),s.jsxs("span",{className:"offline-text",children:["Offline",i>0&&s.jsxs("span",{className:"pending-badge",children:[i," pending"]})]})]})}),s.jsx("style",{children:`
        .offline-indicator {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 9999;
          padding: 10px 16px;
          border-radius: 24px;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
          from {
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
          }
        }

        .offline-indicator.offline {
          background: #1f2937;
          color: #fbbf24;
        }

        .offline-indicator.online {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator.synced {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .offline-icon,
        .online-icon,
        .syncing-icon {
          display: flex;
          align-items: center;
        }

        .syncing-icon svg {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        .offline-text {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .pending-badge {
          background: rgba(251, 191, 36, 0.2);
          padding: 2px 8px;
          border-radius: 12px;
          font-size: 12px;
        }

        @media (max-width: 480px) {
          .offline-indicator {
            bottom: 70px; /* Above mobile nav */
            left: 16px;
            right: 16px;
            transform: none;
          }
        }
      `})]})}function P_(n){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(n)}function x_(n){if(!n||n.length===0)return 0;let l=0;return n.forEach(i=>{i.status==="done"&&(l+=i.weight||0)}),Math.round(l)}function I_(n){if(!n||n.length===0)return{progress:0,earnedValue:0,totalValue:0,isValueBased:!1};if(n.some(o=>o.scheduled_value>0)){const o=n.reduce((h,g)=>h+(g.scheduled_value||0),0),d=n.filter(h=>h.status==="done").reduce((h,g)=>h+(g.scheduled_value||0),0);return{progress:o>0?Math.round(d/o*100):0,earnedValue:d,totalValue:o,isValueBased:!0}}const i=n.filter(o=>o.status==="done").reduce((o,d)=>o+(d.weight||0),0);return{progress:Math.round(i),earnedValue:0,totalValue:0,isValueBased:!1}}function S_(n){if(!n||n.length===0)return"not_started";const l=n.some(d=>d.status==="working"),i=n.some(d=>d.status==="done");return n.every(d=>d.status==="done")?"done":l||i?"working":"not_started"}function ey(n){const l=S_(n);return l==="done"?"Complete":l==="working"?"In Progress":"Not Started"}function ty(n,l=0){const i=new Date;i.setHours(0,0,0,0);const o={scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1};if(n.start_date&&n.end_date){const d=new Date(n.start_date),m=new Date(n.end_date);d.setHours(0,0,0,0),m.setHours(0,0,0,0);const h=Math.max(1,Math.ceil((m-d)/(1e3*60*60*24))),g=Math.max(0,Math.ceil((i-d)/(1e3*60*60*24))),b=Math.min(100,g/h*100),H=(n.progress||0)-b;o.scheduleVariance=Math.round(H),o.hasScheduleData=!0,H>5?(o.scheduleStatus="ahead",o.scheduleLabel=`Ahead of Schedule (+${o.scheduleVariance}%)`):H<-5?(o.scheduleStatus="behind",o.scheduleLabel=`Behind Schedule (${o.scheduleVariance}%)`):(o.scheduleStatus="on_track",o.scheduleLabel="On Track")}if(n.planned_man_days&&n.planned_man_days>0){const m=(n.progress||0)/100*n.planned_man_days;if(m>0&&l>0){const h=(l-m)/m*100;o.laborVariance=Math.round(h),o.hasLaborData=!0,h>10?(o.laborStatus="over",o.laborLabel=`Over Planned (+${o.laborVariance}% man-days)`):h<-10?(o.laborStatus="under",o.laborLabel=`Under Planned (${o.laborVariance}% man-days)`):(o.laborStatus="on_track",o.laborLabel="Labor On Track")}else l>0&&(o.hasLaborData=!0,o.laborLabel=`${l} man-days used`)}return o}function ay(n,l=30){if(n.status==="archived"||n.progress<100)return!1;const i=n.areas||[];if(i.length===0||!i.every(h=>h.status==="done"))return!1;const d=i.reduce((h,g)=>{const b=new Date(g.updated_at);return b>h?b:h},new Date(0));return d.getTime()===0?!1:Math.floor((Date.now()-d.getTime())/(1e3*60*60*24))>=l}const ry=n=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[59,130,246]},N_=(n,l=5e3,i=.85)=>new Promise(o=>{if(!n){o(null);return}const d=new Image;d.crossOrigin="anonymous";const m=setTimeout(()=>{d.src="",o(null)},l);d.onload=()=>{clearTimeout(m);try{const h=document.createElement("canvas");h.width=d.width,h.height=d.height,h.getContext("2d").drawImage(d,0,0);const b=h.toDataURL("image/jpeg",i);o(b)}catch{o(null)}},d.onerror=()=>{clearTimeout(m),o(null)},d.src=n}),ny=async(n,l=5e3,i=.85)=>!n||n.length===0?[]:await Promise.all(n.map(d=>N_(d,l,i)));async function nh(n,l=1920,i=.8){return!n.type.startsWith("image/")||n.size<500*1024?n:new Promise(o=>{const d=document.createElement("canvas"),m=d.getContext("2d"),h=new Image;h.onload=()=>{let{width:g,height:b}=h;g>l&&(b=Math.round(b*l/g),g=l);const O=1920;b>O&&(g=Math.round(g*O/b),b=O),d.width=g,d.height=b,m.imageSmoothingEnabled=!0,m.imageSmoothingQuality="high",m.drawImage(h,0,0,g,b),d.toBlob(H=>{if(H){const x=n.name.replace(/\.[^/.]+$/,""),X=new File([H],`${x}.jpg`,{type:"image/jpeg",lastModified:Date.now()});o(X)}else console.warn("Image compression failed, using original"),o(n)},"image/jpeg",i),URL.revokeObjectURL(h.src)},h.onerror=()=>{console.warn("Failed to load image for compression, using original"),URL.revokeObjectURL(h.src),o(n)},h.src=URL.createObjectURL(n)})}const E_=N.lazy(()=>sr(()=>import("./SignatureLinkGenerator-I5rscaL1.js"),__vite__mapDeps([0,1,2,3,4]))),C_=N.lazy(()=>sr(()=>import("./TMClientSignature-DYw0qox2.js"),__vite__mapDeps([5,1,2,3,4]))),sh=()=>{const n=new Uint8Array(6);return crypto.getRandomValues(n),Array.from(n,l=>l.toString(36)).join("")},Jc=["Containment","PPE","Disposal","Equipment"],q_={en:{workInfo:"Work Details",crewHours:"Crew & Hours",materialsEquipment:"Materials",evidence:"Evidence",review:"Review",quickActions:"Quick Actions",sameAsYesterday:"Same as Yesterday",setCrewHours:"Set Crew Hours",loading:"Loading...",supervision:"Supervision",operators:"Operators",laborers:"Laborers",addSupervision:"+ Add Supervision",addOperator:"+ Add Operator",addLaborer:"+ Add Laborer",foreman:"Foreman",superintendent:"Superintendent",firstLastName:"First & Last Name",start:"Start",end:"End",regHrs:"Reg Hrs",otHrs:"OT Hrs",selectCategory:"Select a category:",addCustomItem:"+ Add Custom Item",customItem:"Custom Item",itemName:"Item Name",category:"Category",quantity:"Quantity",addItem:"Add Item",cancel:"Cancel",noItemsCategory:"No items in this category yet",workDate:"Work Date",ceNumber:"CE/PCO #",optional:"optional",linkedCOR:"Link to Change Order",selectCOR:"Select COR (optional)",noCORs:"No pending CORs",laborSummary:"Labor Summary",worker:"worker",workers_plural:"workers",totalHours:"Total Hours",regular:"Regular",overtime:"Overtime",materials:"Materials",item:"item",items_plural:"items",noMaterials:"No materials added",notes:"Notes",addNotes:"Add notes about the work performed...",photos:"Photos",addPhotos:"Add Photos",maxPhotos:"max",noPhotos:"No photos added",certification:"Certification",certifyStatement:"I certify that this T&M ticket accurately reflects the work performed.",foremanSignature:"Foreman's Name (Signature)",yourName:"Your name",describeWork:"Describe the work performed",descriptionRequired:"Description is required",whatWorkPerformed:"What work was performed today?",searchMaterials:"Search materials & equipment...",noSearchResults:"No items found",orBrowse:"Or browse by category:",back:"Back",next:"Next",nextCrew:"Next: Crew",nextMaterials:"Next: Materials",reviewItems:"Review",skipNoMaterials:"Skip (no materials)",submitTM:"Submit T&M",submitting:"Submitting...",applySameHours:"Apply Same Hours",batchDescription:"Set start/end time and hours for all workers with names entered.",timeStarted:"Time Started",timeEnded:"Time Ended",regularHours:"Regular Hours",overtimeHours:"Overtime Hours",willApplyTo:"Will apply to",applyToAll:"Apply to All",preset8hr:"8hr Day",preset10hr:"10hr Day",preset4hr:"4hr Day",loadedWorkers:"Loaded {count} workers from {date}",noPreviousCrew:"No previous crew found for this project",appliedHours:"Applied hours to {count} worker(s)",assignedToCOR:"Assigned to COR"},es:{workInfo:"Info del Trabajo",crewHours:"Cuadrilla y Horas",materialsEquipment:"Materiales",evidence:"Evidencia",review:"Revisar",quickActions:"Acciones Rapidas",sameAsYesterday:"Igual que Ayer",setCrewHours:"Poner Horas",loading:"Cargando...",supervision:"Supervision",operators:"Operadores",laborers:"Trabajadores",addSupervision:"+ Agregar Supervision",addOperator:"+ Agregar Operador",addLaborer:"+ Agregar Trabajador",foreman:"Capataz",superintendent:"Superintendente",firstLastName:"Nombre y Apellido",start:"Inicio",end:"Fin",regHrs:"Hrs Reg",otHrs:"Hrs Extra",selectCategory:"Seleccione una categoria:",addCustomItem:"+ Agregar Articulo",customItem:"Articulo Personalizado",itemName:"Nombre del Articulo",category:"Categoria",quantity:"Cantidad",addItem:"Agregar",cancel:"Cancelar",noItemsCategory:"No hay articulos en esta categoria",workDate:"Fecha de Trabajo",ceNumber:"CE/PCO #",optional:"opcional",linkedCOR:"Vincular a Orden de Cambio",selectCOR:"Seleccionar COR (opcional)",noCORs:"No hay CORs pendientes",laborSummary:"Resumen de Mano de Obra",worker:"trabajador",workers_plural:"trabajadores",totalHours:"Horas Totales",regular:"Regular",overtime:"Extra",materials:"Materiales",item:"articulo",items_plural:"articulos",noMaterials:"No se agregaron materiales",notes:"Notas",addNotes:"Agregar notas sobre el trabajo realizado...",photos:"Fotos",addPhotos:"Agregar Fotos",maxPhotos:"max",noPhotos:"No se agregaron fotos",certification:"Certificacion",certifyStatement:"Certifico que este ticket T&M refleja con precision el trabajo realizado.",foremanSignature:"Nombre del Capataz (Firma)",yourName:"Su nombre",describeWork:"Describir el trabajo realizado",descriptionRequired:"Descripcion es requerida",whatWorkPerformed:"Que trabajo se realizo hoy?",searchMaterials:"Buscar materiales y equipo...",noSearchResults:"No se encontraron articulos",orBrowse:"O navegar por categoria:",back:"Atras",next:"Siguiente",nextCrew:"Siguiente: Cuadrilla",nextMaterials:"Siguiente: Materiales",reviewItems:"Revisar",skipNoMaterials:"Saltar (sin materiales)",submitTM:"Enviar T&M",submitting:"Enviando...",applySameHours:"Aplicar Mismas Horas",batchDescription:"Establezca hora de inicio/fin y horas para todos los trabajadores.",timeStarted:"Hora de Inicio",timeEnded:"Hora de Fin",regularHours:"Horas Regulares",overtimeHours:"Horas Extra",willApplyTo:"Se aplicara a",applyToAll:"Aplicar a Todos",preset8hr:"Dia 8hr",preset10hr:"Dia 10hr",preset4hr:"Dia 4hr",loadedWorkers:"Se cargaron {count} trabajadores del {date}",noPreviousCrew:"No se encontro equipo anterior para este proyecto",appliedHours:"Horas aplicadas a {count} trabajador(es)",assignedToCOR:"Asignado a COR"}};function D_({project:n,companyId:l,maxPhotos:i=10,onSubmit:o,onCancel:d,onShowToast:m}){const[h,g]=N.useState(1),[b,O]=N.useState(new Date().toISOString().split("T")[0]),[H,x]=N.useState(null),[X,re]=N.useState(!1),[F,$]=N.useState(!1),[M,K]=N.useState(!1),[se,le]=N.useState(""),[ue,we]=N.useState(""),[xe,Le]=N.useState(""),[Qe,Me]=N.useState([]),[Ie,Ke]=N.useState(!1),[W,ye]=N.useState(!1),[Ae,ve]=N.useState({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),[D,Q]=N.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}]),[te,G]=N.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[R,ie]=N.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[P,_e]=N.useState([]),[Ne,et]=N.useState(""),[qe,J]=N.useState([]),[ee,je]=N.useState(!1),[Te,tt]=N.useState(""),[We,lt]=N.useState([]),[it,Ht]=N.useState(!1),[dt,St]=N.useState(null),[vn,ir]=N.useState([]),[Yr,Ra]=N.useState(!1),[or,cr]=N.useState(""),[vt,Ua]=N.useState([]),[Gr,Qr]=N.useState([]),[ia,Ha]=N.useState(!1),[bt,La]=N.useState({name:"",category:"",quantity:""}),Xr=N.useRef(null),oa=N.useRef(null),[Nt,Lt]=N.useState(!1),[I,bn]=N.useState("en"),ae=p=>q_[I][p]||p,[Vr,ur]=N.useState([]),[Mt,dr]=N.useState([]),[ot,Et]=N.useState({}),[Ft,jn]=N.useState(!0),[V,Bt]=N.useState(new Set),at=Mt.length>0,mr=(p,w)=>{if(!p||!w)return null;const[C,q]=p.split(":").map(Number),[U,Z]=w.split(":").map(Number);let me=U*60+Z-(C*60+q);me<0&&(me+=1440);const pe=me/60,fe=Math.min(pe,8),Ee=Math.max(0,pe-8);return{hours:fe.toFixed(1),overtimeHours:Ee>0?Ee.toFixed(1):""}},fr=p=>{if(!p)return"empty";const w=p.name&&p.name.trim()!=="",C=parseFloat(p.hours)>0||parseFloat(p.overtimeHours)>0;return w?C?"complete":"incomplete":"empty"},wn=p=>{let w,C,q,U;switch(p){case"full":w="07:00",C="15:30",q="8",U="";break;case"10hr":w="06:00",C="16:30",q="8",U="2";break;case"half":w="07:00",C="11:00",q="4",U="";break;default:return}ve({timeStarted:w,timeEnded:C,hours:q,overtimeHours:U})};N.useEffect(()=>{ll(),sl()},[n.id]),N.useEffect(()=>{(async()=>{if(!l){jn(!1);return}try{const w=await he.getLaborClassesForField(l);ur(w.categories||[]),dr(w.classes||[])}catch(w){console.error("Error loading labor classes:",w)}finally{jn(!1)}})()},[l]),N.useEffect(()=>{if(Ft||Mt.length===0)return;const p=new Set;We.forEach(q=>{q.labor_class_id&&p.add(q.labor_class_id)});const w={},C=new Set;p.forEach(q=>{Mt.some(U=>U.id===q)&&(w[q]=[{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}],C.add(q))}),Et(q=>Object.keys(q).length===0?w:q),Bt(q=>q.size===0?C:q)},[Mt,We,Ft]);const sl=async()=>{Ke(!0);try{const p=await he.getAssignableCORs(n.id);Me(p||[])}catch(p){console.error("Error loading assignable CORs:",p)}finally{Ke(!1)}},ns=()=>{const{timeStarted:p,timeEnded:w,hours:C,overtimeHours:q}=Ae;let U=0;if(at){const Z={};Object.entries(ot).forEach(([me,pe])=>{Z[me]=pe.map(fe=>fe&&fe.name&&fe.name.trim()?(U++,{...fe,timeStarted:p,timeEnded:w,hours:C,overtimeHours:q}):fe)}),Et(Z)}else Q(D.map(Z=>Z&&Z.name&&Z.name.trim()?(U++,{...Z,timeStarted:p,timeEnded:w,hours:C,overtimeHours:q}):Z)),G(te.map(Z=>Z&&Z.name&&Z.name.trim()?(U++,{...Z,timeStarted:p,timeEnded:w,hours:C,overtimeHours:q}):Z)),ie(R.map(Z=>Z&&Z.name&&Z.name.trim()?(U++,{...Z,timeStarted:p,timeEnded:w,hours:C,overtimeHours:q}):Z));ye(!1),ve({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),U>0?m(ae("appliedHours").replace("{count}",U),"success"):m(I==="en"?"Add workers first":"Agregue trabajadores primero","info")},Zr=p=>{let w,C,q,U;switch(p){case"8hr":w="07:00",C="15:30",q="8",U="";break;case"10hr":w="06:00",C="16:30",q="8",U="2";break;case"4hr":w="07:00",C="11:00",q="4",U="";break;default:return}let Z=0;if(at){const me={};Object.entries(ot).forEach(([pe,fe])=>{me[pe]=fe.map(Ee=>Ee&&Ee.name&&Ee.name.trim()?(Z++,{...Ee,timeStarted:w,timeEnded:C,hours:q,overtimeHours:U}):Ee)}),Et(me)}else Q(me=>me.map(pe=>pe&&pe.name&&pe.name.trim()?(Z++,{...pe,timeStarted:w,timeEnded:C,hours:q,overtimeHours:U}):pe)),G(me=>me.map(pe=>pe&&pe.name&&pe.name.trim()?(Z++,{...pe,timeStarted:w,timeEnded:C,hours:q,overtimeHours:U}):pe)),ie(me=>me.map(pe=>pe&&pe.name&&pe.name.trim()?(Z++,{...pe,timeStarted:w,timeEnded:C,hours:q,overtimeHours:U}):pe));Z>0?m(ae("appliedHours").replace("{count}",Z),"success"):m(I==="en"?"Add workers first":"Agregue trabajadores primero","info")},ll=async()=>{try{const p=await he.getCrewCheckin(n.id);p?.workers&&lt(p.workers)}catch(p){console.error("Error loading crew:",p)}};N.useEffect(()=>{dt&&l&&il(dt)},[dt,l]),N.useEffect(()=>(h===3&&Xr.current&&!dt&&(oa.current=setTimeout(()=>{Xr.current?.focus()},100)),()=>{oa.current&&clearTimeout(oa.current)}),[h,dt]);const il=async p=>{Ra(!0);try{const w=await he.getMaterialsEquipmentByCategory(l,p);ir(w)}catch(w){console.error("Error loading items:",w),m("Error loading items","error")}finally{Ra(!1)}},qa=async()=>{if(!(Gr.length>0))try{const p=[];for(const w of Jc){const C=await he.getMaterialsEquipmentByCategory(l,w);p.push(...C.map(q=>({...q,category:w})))}Qr(p)}catch(p){console.error("Error loading all materials:",p)}},jt=p=>{if(cr(p),!p.trim()){Ua([]);return}const w=p.toLowerCase(),C=Gr.filter(q=>q.name.toLowerCase().includes(w)||q.category.toLowerCase().includes(w));Ua(C.slice(0,10))},Rt=async()=>{Lt(!0);try{const p=await he.getPreviousTicketCrew(n.id,b);if(!p||p.totalWorkers===0){m(ae("noPreviousCrew"),"info");return}at&&p.dynamicWorkers?Et(p.dynamicWorkers):(p.supervision&&Q(p.supervision),p.operators&&G(p.operators),p.laborers&&ie(p.laborers));const w=new Date(p.workDate).toLocaleDateString();m(ae("loadedWorkers").replace("{count}",p.totalWorkers).replace("{date}",w),"success")}catch(p){console.error("Error loading previous crew:",p),m(I==="en"?"Error loading previous crew":"Error cargando equipo anterior","error")}finally{Lt(!1)}},hr=()=>{Q([...D,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},ca=(p,w,C)=>{Q(D.map((q,U)=>{if(U!==p)return q;const Z={...q,[w]:C};if(w==="timeStarted"||w==="timeEnded"){const me=w==="timeStarted"?C:q.timeStarted,pe=w==="timeEnded"?C:q.timeEnded,fe=mr(me,pe);fe&&(Z.hours=fe.hours,Z.overtimeHours=fe.overtimeHours)}return Z}))},Ai=p=>{D.length>1?Q(D.filter((w,C)=>C!==p)):Q([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},ki=()=>{ie([...R,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Ba=(p,w,C)=>{ie(R.map((q,U)=>{if(U!==p)return q;const Z={...q,[w]:C};if(w==="timeStarted"||w==="timeEnded"){const me=w==="timeStarted"?C:q.timeStarted,pe=w==="timeEnded"?C:q.timeEnded,fe=mr(me,pe);fe&&(Z.hours=fe.hours,Z.overtimeHours=fe.overtimeHours)}return Z}))},Kr=p=>{R.length>1?ie(R.filter((w,C)=>C!==p)):ie([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},ss=()=>{G([...te,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},$t=(p,w,C)=>{G(te.map((q,U)=>{if(U!==p)return q;const Z={...q,[w]:C};if(w==="timeStarted"||w==="timeEnded"){const me=w==="timeStarted"?C:q.timeStarted,pe=w==="timeEnded"?C:q.timeEnded,fe=mr(me,pe);fe&&(Z.hours=fe.hours,Z.overtimeHours=fe.overtimeHours)}return Z}))},pr=p=>{te.length>1?G(te.filter((w,C)=>C!==p)):G([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},gr=p=>{Et(w=>({...w,[p]:[...w[p]||[],{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]}))},Dt=(p,w,C,q)=>{Et(U=>({...U,[p]:(U[p]||[]).map((Z,me)=>{if(me!==w)return Z;const pe={...Z,[C]:q};if(C==="timeStarted"||C==="timeEnded"){const fe=C==="timeStarted"?q:Z.timeStarted,Ee=C==="timeEnded"?q:Z.timeEnded,Tt=mr(fe,Ee);Tt&&(pe.hours=Tt.hours,pe.overtimeHours=Tt.overtimeHours)}return pe})}))},mt=(p,w)=>{Et(C=>{const q=C[p]||[];return q.length>1?{...C,[p]:q.filter((U,Z)=>Z!==w)}:{...C,[p]:[{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]}})},ol=p=>{p&&(Bt(w=>new Set([...w,p])),Et(w=>!w[p]||w[p].length===0?{...w,[p]:[{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]}:w))},ls=p=>{Bt(w=>{const C=new Set(w);return C.delete(p),C}),Et(w=>{const C={...w};return delete C[p],C})},ua=()=>Mt.filter(p=>!V.has(p.id)),Da=()=>{if(!ot||typeof ot!="object")return[];const p=[];return Object.entries(ot).forEach(([w,C])=>{if(!Array.isArray(C))return;const q=Mt.find(U=>U.id===w);C.forEach(U=>{U&&U.name&&U.name.trim()&&(parseFloat(U.hours)>0||parseFloat(U.overtimeHours)>0)&&p.push({name:U.name.trim(),hours:parseFloat(U.hours)||0,overtime_hours:parseFloat(U.overtimeHours)||0,time_started:U.timeStarted||null,time_ended:U.timeEnded||null,role:q?.name||"Worker",labor_class_id:w})})}),p},Oi=p=>{const w=P.findIndex(C=>C.material_equipment_id===p.id);w>=0?_e(P.map((C,q)=>q===w?{...C,quantity:C.quantity+1}:C)):_e([...P,{material_equipment_id:p.id,name:p.name,unit:p.unit,category:p.category,quantity:1,isCustom:!1}]),m(`Added ${p.name}`,"success")},cl=()=>{if(!bt.name||!bt.category||!bt.quantity){m("Fill in all fields","error");return}_e([...P,{material_equipment_id:null,custom_name:bt.name,custom_category:bt.category,name:bt.name,category:bt.category,quantity:parseFloat(bt.quantity),unit:"each",isCustom:!0}]),La({name:"",category:"",quantity:""}),Ha(!1),St(null),m("Custom item added","success")},xn=(p,w)=>{const C=parseFloat(w)||0;C<=0?zi(p):_e(P.map((q,U)=>U===p?{...q,quantity:C}:q))},zi=p=>{_e(P.filter((w,C)=>C!==p))},Sn=p=>{const w=Array.from(p.target.files);if(w.length===0)return;const C=i===-1?1/0:i-qe.length;if(C<=0){m(`Photo limit reached (${i} max)`,"error"),p.target.value="";return}const q=w.slice(0,C);q.length<w.length&&m(`Only ${q.length} photo(s) added (${i} max)`,"error");const U=10*1024*1024;q.forEach(Z=>{if(!Z.type.startsWith("image/")){m("Please select an image file","error");return}if(Z.size>U){m(`Photo too large: ${Z.name} (max 10MB)`,"error");return}const me=URL.createObjectURL(Z),pe=`photo-${Date.now()}-${sh()}`;J(fe=>[...fe,{id:`${Date.now()}-${sh()}`,tempId:pe,file:Z,previewUrl:me,name:Z.name,status:"pending",attempts:0,error:null,uploadedUrl:null}])}),p.target.value=""},Wt=(p,w)=>{J(C=>C.map(q=>q.id===p?{...q,...w}:q))},da=async(p,w)=>{const C=qe.find(q=>q.id===p);if(!(!C||C.status!=="failed")){Wt(p,{status:"compressing",error:null});try{let q=C.file;try{q=await nh(C.file)}catch(Z){console.warn("Compression failed, using original:",Z)}Wt(p,{status:"uploading"});const U=await he.uploadPhoto(l,n.id,w,q);Wt(p,{status:"confirmed",uploadedUrl:U,attempts:C.attempts+1}),await he.updateTMTicketPhotos(w,[...qe.filter(Z=>Z.uploadedUrl).map(Z=>Z.uploadedUrl),U]),m("Photo uploaded successfully","success")}catch(q){console.error("Retry failed:",q),Wt(p,{status:"failed",error:q.message||"Upload failed",attempts:C.attempts+1}),m("Photo retry failed","error")}}},Yt=p=>{const w=qe.find(C=>C.id===p);w?.previewUrl&&URL.revokeObjectURL(w.previewUrl),J(qe.filter(C=>C.id!==p))},is=()=>{if(h===1)return Ne.trim().length>0;if(h===2){if(at)return Da().length>0;{const p=D.some(q=>q&&q.name&&q.name.trim()&&(parseFloat(q.hours)>0||parseFloat(q.overtimeHours)>0)),w=te.some(q=>q&&q.name&&q.name.trim()&&(parseFloat(q.hours)>0||parseFloat(q.overtimeHours)>0)),C=R.some(q=>q&&q.name&&q.name.trim()&&(parseFloat(q.hours)>0||parseFloat(q.overtimeHours)>0));return p||w||C}}return!0},_r=D.filter(p=>p&&p.name&&p.name.trim()&&(parseFloat(p.hours)>0||parseFloat(p.overtimeHours)>0)),Ta=te.filter(p=>p&&p.name&&p.name.trim()&&(parseFloat(p.hours)>0||parseFloat(p.overtimeHours)>0)),Ya=R.filter(p=>p&&p.name&&p.name.trim()&&(parseFloat(p.hours)>0||parseFloat(p.overtimeHours)>0)),Aa=Da(),Jr=at?Aa.length:_r.length+Ta.length+Ya.length,Ct=at?Aa.reduce((p,w)=>p+(w.hours||0),0):[..._r,...Ta,...Ya].reduce((p,w)=>p+parseFloat(w.hours||0),0),Ga=at?Aa.reduce((p,w)=>p+(w.overtime_hours||0),0):[..._r,...Ta,...Ya].reduce((p,w)=>p+parseFloat(w.overtimeHours||0),0);P.reduce((p,w)=>p+w.quantity,0);const Fr=at?Object.values(ot||{}).flat().filter(p=>p&&p.name&&p.name.trim()):[...D.filter(p=>p&&p.name&&p.name.trim()),...te.filter(p=>p&&p.name&&p.name.trim()),...R.filter(p=>p&&p.name&&p.name.trim())],os=Jr,ma=Fr.length-os,cs=(()=>{const p=[];return h===1&&(Ne.trim()||p.push(I==="en"?"Description recommended":"Descripcin recomendada")),h===2&&ma>0&&p.push(I==="en"?`${ma} worker(s) have no hours entered`:`${ma} trabajador(es) sin horas`),h===4&&(ue.trim()||p.push(I==="en"?"Name required to submit":"Nombre requerido")),p})(),xa=()=>{h<4&&g(h+1)},ul=()=>{dt?(St(null),Ha(!1)):ia?Ha(!1):h>1?g(h-1):d()},dl=async()=>{if(!ue.trim()){m("Enter your name to submit","error");return}let p=[];if(at){if(p=Da(),p.length===0){m("Add at least one worker","error");return}}else{const w=D.filter(U=>U&&U.name&&U.name.trim()&&(parseFloat(U.hours)>0||parseFloat(U.overtimeHours)>0)),C=te.filter(U=>U&&U.name&&U.name.trim()&&(parseFloat(U.hours)>0||parseFloat(U.overtimeHours)>0)),q=R.filter(U=>U&&U.name&&U.name.trim()&&(parseFloat(U.hours)>0||parseFloat(U.overtimeHours)>0));if(w.length===0&&C.length===0&&q.length===0){m("Add at least one worker","error");return}p=[...w.map(U=>({name:U.name.trim(),hours:parseFloat(U.hours)||0,overtime_hours:parseFloat(U.overtimeHours)||0,time_started:U.timeStarted||null,time_ended:U.timeEnded||null,role:U.role})),...C.map(U=>({name:U.name.trim(),hours:parseFloat(U.hours)||0,overtime_hours:parseFloat(U.overtimeHours)||0,time_started:U.timeStarted||null,time_ended:U.timeEnded||null,role:"Operator"})),...q.map(U=>({name:U.name.trim(),hours:parseFloat(U.hours)||0,overtime_hours:parseFloat(U.overtimeHours)||0,time_started:U.timeStarted||null,time_ended:U.timeEnded||null,role:"Laborer"}))]}je(!0),tt("Creating ticket...");try{const w=await he.createTMTicket({project_id:n.id,work_date:b,ce_pco_number:se.trim()||null,assigned_cor_id:xe||null,notes:Ne.trim()||null,photos:[],created_by_name:ue.trim()});if(!w||!w.id)throw new Error("Failed to create ticket - no ticket ID returned");let C=[];const q=qe.filter(U=>U.status==="pending");if(q.length>0){tt(`Compressing ${q.length} photo${q.length>1?"s":""}...`),q.forEach(Ee=>Wt(Ee.id,{status:"compressing"}));const U=await Promise.all(q.map(async Ee=>{try{const Tt=await nh(Ee.file);return{...Ee,file:Tt}}catch(Tt){return console.warn(`Failed to compress photo ${Ee.name}, using original:`,Tt),Ee}}));tt(`Uploading ${q.length} photo${q.length>1?"s":""}...`),q.forEach(Ee=>Wt(Ee.id,{status:"uploading"}));let Z=0,me=0;const pe=U.map(async Ee=>{try{const Tt=await he.uploadPhoto(l,n.id,w.id,Ee.file);return Z++,tt(`Uploading ${Z}/${q.length} photos...`),Wt(Ee.id,{status:"confirmed",uploadedUrl:Tt,attempts:(Ee.attempts||0)+1}),{id:Ee.id,url:Tt}}catch(Tt){return console.error(`Photo ${Ee.name} upload failed:`,Tt),me++,Wt(Ee.id,{status:"failed",error:Tt.message||"Upload failed",attempts:(Ee.attempts||0)+1}),{id:Ee.id,url:null,error:Tt.message}}});C=(await Promise.all(pe)).filter(Ee=>Ee.url!==null).map(Ee=>Ee.url),me>0&&C.length>0?m(`${C.length}/${q.length} photos uploaded. ${me} failed - can retry later.`,"warning"):me>0&&C.length===0&&m(`All ${me} photos failed to upload - can retry after submission.`,"error")}if(C.length>0&&(tt("Saving photos..."),await he.updateTMTicketPhotos(w.id,C)),tt("Saving workers..."),await he.addTMWorkers(w.id,p),P.length>0&&(tt("Saving materials..."),await he.addTMItems(w.id,P.map(U=>({material_equipment_id:U.material_equipment_id,custom_name:U.custom_name||null,custom_category:U.custom_category||null,quantity:U.quantity})))),xe){tt("Importing to COR...");try{await he.importTicketDataToCOR(w.id,xe,l,n.work_type||"demolition",n.job_type||"standard")}catch(U){console.error("Error importing to COR:",U);try{await he.markImportFailed(w.id,xe,U?.message||"Import failed")}catch(Z){console.error("Error marking import failed:",Z)}m("T&M saved. COR data sync failed - retry from ticket list.","warning")}}qe.forEach(U=>{U.previewUrl&&URL.revokeObjectURL(U.previewUrl)}),x(w),m("T&M submitted!","success"),g(5)}catch(w){console.error("Error submitting T&M:",w),m("Error submitting T&M","error")}finally{je(!1),tt("")}};return h===3&&(dt||ia)?s.jsxs("div",{className:"tm-wizard",children:[s.jsxs("div",{className:"tm-wizard-header",children:[s.jsx("button",{className:"tm-back-btn",onClick:ul,children:""}),s.jsx("h2",{children:ia?"Add Custom Item":dt}),s.jsxs("div",{className:"tm-item-count",children:[P.length," items"]})]}),ia?s.jsxs("div",{className:"tm-custom-form",children:[s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:"Item Name"}),s.jsx("input",{type:"text",placeholder:"What did you use?",value:bt.name,onChange:p=>La({...bt,name:p.target.value}),autoFocus:!0})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:"Category"}),s.jsx("div",{className:"tm-category-select",children:Jc.map(p=>s.jsx("button",{className:`tm-cat-chip ${bt.category===p?"active":""}`,onClick:()=>La({...bt,category:p}),children:p},p))})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:"Quantity"}),s.jsx("input",{type:"number",placeholder:"How many?",value:bt.quantity,onChange:p=>La({...bt,quantity:p.target.value})})]}),s.jsx("button",{className:"tm-big-btn primary",onClick:cl,children:"Add Custom Item"})]}):s.jsx("div",{className:"tm-item-grid",children:Yr?s.jsx("div",{className:"tm-loading",children:"Loading..."}):s.jsxs(s.Fragment,{children:[vn.map(p=>{const w=P.find(C=>C.material_equipment_id===p.id);return s.jsxs("button",{className:`tm-item-card ${w?"added":""}`,onClick:()=>Oi(p),children:[s.jsx("span",{className:"tm-item-name",children:p.name}),s.jsx("span",{className:"tm-item-unit",children:p.unit}),w&&s.jsx("span",{className:"tm-item-badge",children:w.quantity})]},p.id)}),s.jsxs("button",{className:"tm-item-card custom",onClick:()=>Ha(!0),children:[s.jsx("span",{className:"tm-item-name",children:"+ Add Other"}),s.jsx("span",{className:"tm-item-unit",children:"Not on list"})]})]})}),!ia&&P.length>0&&s.jsx("div",{className:"tm-wizard-footer",children:s.jsxs("button",{className:"tm-big-btn primary",onClick:()=>St(null),children:["Done Adding (",P.length," items)"]})})]}):s.jsxs("div",{className:"tm-wizard",children:[s.jsxs("div",{className:"tm-wizard-header",children:[h<5?s.jsx("button",{className:"tm-back-btn",onClick:ul,children:""}):s.jsx("div",{className:"tm-success-check",children:s.jsx(al,{size:24})}),s.jsxs("h2",{children:[h===1&&ae("workInfo"),h===2&&ae("crewHours"),h===3&&ae("materialsEquipment"),h===4&&ae("review"),h===5&&(I==="en"?"Submitted":"Enviado")]}),s.jsxs("div",{className:"tm-header-right",children:[h<4&&s.jsxs("button",{className:"tm-lang-toggle",onClick:()=>bn(I==="en"?"es":"en"),title:I==="en"?"Cambiar a Espaol":"Switch to English",children:[s.jsx(Ng,{size:16}),I==="en"?"ES":"EN"]}),h<5&&s.jsxs("div",{className:"tm-step-dots",children:[s.jsx("span",{className:`tm-dot ${h>=1?"active":""}`}),s.jsx("span",{className:`tm-dot ${h>=2?"active":""}`}),s.jsx("span",{className:`tm-dot ${h>=3?"active":""}`}),s.jsx("span",{className:`tm-dot ${h>=4?"active":""}`})]})]})]}),h===1&&s.jsxs("div",{className:"tm-step-content",children:[s.jsxs("div",{className:"tm-project-info",children:[n.job_number&&s.jsxs("div",{className:"tm-project-detail",children:[s.jsx("span",{className:"tm-project-label",children:"Job #"}),s.jsx("span",{className:"tm-project-value",children:n.job_number})]}),s.jsxs("div",{className:"tm-project-detail",children:[s.jsx("span",{className:"tm-project-label",children:"Project"}),s.jsx("span",{className:"tm-project-value",children:n.name})]}),n.address&&s.jsxs("div",{className:"tm-project-detail",children:[s.jsx("span",{className:"tm-project-label",children:"Address"}),s.jsx("span",{className:"tm-project-value",children:n.address})]}),n.general_contractor&&s.jsxs("div",{className:"tm-project-detail",children:[s.jsx("span",{className:"tm-project-label",children:"GC"}),s.jsx("span",{className:"tm-project-value",children:n.general_contractor})]})]}),s.jsxs("div",{className:"tm-field-row",children:[s.jsxs("div",{className:"tm-field tm-field-half",children:[s.jsx("label",{children:"Date"}),s.jsx("input",{type:"date",value:b,onChange:p=>O(p.target.value),className:"tm-date"})]}),s.jsxs("div",{className:"tm-field tm-field-half",children:[s.jsx("label",{children:"CE / PCO #"}),s.jsx("input",{type:"text",placeholder:"Change Event / PCO",value:se,onChange:p=>le(p.target.value),className:"tm-input"})]})]}),s.jsxs("div",{className:"tm-field tm-description-field",children:[s.jsxs("label",{children:[s.jsx(rs,{size:16,className:"inline-icon"}),ae("describeWork")," ",s.jsx("span",{className:"tm-required",children:"*"})]}),s.jsx("textarea",{placeholder:ae("whatWorkPerformed"),value:Ne,onChange:p=>et(p.target.value),rows:4,className:`tm-description ${Ne.trim()?"":"tm-field-required"}`})]})]}),h===2&&s.jsxs("div",{className:"tm-step-content",children:[s.jsxs("div",{className:"tm-crew-summary-bar",children:[s.jsxs("div",{className:"tm-summary-left",children:[s.jsx("span",{className:"tm-summary-count",children:Fr.length}),s.jsx("span",{className:"tm-summary-label",children:Fr.length===1?ae("worker"):ae("workers_plural")})]}),s.jsxs("div",{className:"tm-summary-middle",children:[s.jsxs("span",{className:"tm-summary-hours",children:[Ct+Ga,"h"]}),s.jsx("span",{className:"tm-summary-label",children:"total"})]}),ma>0&&s.jsxs("div",{className:"tm-summary-warning",children:[s.jsx(Hc,{size:14}),s.jsxs("span",{children:[ma," ",I==="en"?"need hours":"sin horas"]})]})]}),s.jsxs("div",{className:"tm-quick-actions-row",children:[s.jsxs("button",{className:"tm-quick-action",onClick:Rt,disabled:Nt,children:[s.jsx(Eg,{size:16}),s.jsx("span",{children:Nt?I==="en"?"Loading...":"Cargando...":ae("sameAsYesterday")})]}),Fr.length>0&&s.jsxs("div",{className:"tm-time-presets-inline",children:[s.jsx("button",{className:"tm-preset-chip",onClick:()=>Zr("8hr"),children:"8h"}),s.jsx("button",{className:"tm-preset-chip",onClick:()=>Zr("10hr"),children:"10h"}),s.jsx("button",{className:"tm-preset-chip",onClick:()=>Zr("4hr"),children:"4h"}),s.jsx("button",{className:"tm-preset-chip more",onClick:()=>ye(!0),title:I==="en"?"Custom hours":"Horas personalizadas",children:s.jsx(Ci,{size:14})})]})]}),We.length>0&&s.jsxs("div",{className:"tm-crew-select-section",children:[s.jsxs("div",{className:"tm-section-header",children:[s.jsxs("h4",{children:[s.jsx(_n,{size:16})," ",I==="en"?"Select T&M Workers":"Seleccionar Trabajadores T&M"]}),s.jsx("span",{className:"tm-section-hint",children:I==="en"?"Tap to add":"Toca para agregar"})]}),s.jsx("div",{className:"tm-crew-grid",children:We.map((p,w)=>{const C=D.some(Z=>Z.name.toLowerCase()===p.name.toLowerCase())||te.some(Z=>Z.name.toLowerCase()===p.name.toLowerCase())||R.some(Z=>Z.name.toLowerCase()===p.name.toLowerCase()),q=Object.values(ot).some(Z=>Z.some(me=>me.name.toLowerCase()===p.name.toLowerCase())),U=C||q;return s.jsxs("button",{className:`tm-crew-item ${U?"added":""}`,onClick:()=>{if(U)return;if(p.labor_class_id&&at&&Mt.some(me=>me.id===p.labor_class_id)){V.has(p.labor_class_id)||Bt(fe=>new Set([...fe,p.labor_class_id]));const me=ot[p.labor_class_id]||[],pe=me.findIndex(fe=>!fe||!fe.name||!fe.name.trim());if(pe>=0){const fe=[...me];fe[pe]={...fe[pe],name:p.name},Et(Ee=>({...Ee,[p.labor_class_id]:fe}))}else Et(fe=>({...fe,[p.labor_class_id]:[...fe[p.labor_class_id]||[],{name:p.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]}))}else{const me=(p.role||"").toLowerCase();if(me.includes("foreman")||me.includes("supervisor")||me.includes("superintendent")){const pe=D.findIndex(fe=>!fe||!fe.name||!fe.name.trim());pe>=0?(ca(pe,"name",p.name),ca(pe,"role",me.includes("superintendent")?"Superintendent":"Foreman")):Q([...D,{name:p.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:me.includes("superintendent")?"Superintendent":"Foreman"}])}else if(me.includes("operator")){const pe=te.findIndex(fe=>!fe||!fe.name||!fe.name.trim());pe>=0?$t(pe,"name",p.name):G([...te,{name:p.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}else{const pe=R.findIndex(fe=>!fe||!fe.name||!fe.name.trim());pe>=0?Ba(pe,"name",p.name):ie([...R,{name:p.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}}m(`Added ${p.name}`,"success")},disabled:U,children:[s.jsx("span",{className:"tm-crew-item-name",children:p.name}),s.jsx("span",{className:`tm-crew-item-role ${(p.role||"laborer").toLowerCase()}`,children:p.role||"Laborer"}),U&&s.jsx("span",{className:"tm-crew-item-check",children:""})]},w)})})]}),at&&!Ft&&s.jsxs(s.Fragment,{children:[Vr.map(p=>{const w=Mt.filter(C=>C.category_id===p.id&&V.has(C.id));return w.length===0?null:s.jsxs("div",{className:"tm-labor-category-section",children:[s.jsx("div",{className:"tm-category-header",children:p.name}),w.map(C=>s.jsxs("div",{className:"tm-field",children:[s.jsxs("div",{className:"tm-field-header",children:[s.jsx("label",{children:C.name}),s.jsx("button",{type:"button",className:"tm-remove-class-btn",onClick:()=>ls(C.id),title:I==="en"?"Remove this labor class":"Eliminar esta clase",children:""})]}),s.jsx("div",{className:"tm-workers-list",children:(ot[C.id]||[]).map((q,U)=>{const Z=fr(q);return s.jsxs("div",{className:`tm-worker-card-expanded ${Z!=="empty"?`worker-${Z}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[Z==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(Ca,{size:14})}),s.jsx("input",{type:"text",placeholder:ae("firstLastName"),value:q.name,onChange:me=>Dt(C.id,U,"name",me.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>mt(C.id,U),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("start")}),s.jsx("input",{type:"time",value:q.timeStarted,onChange:me=>Dt(C.id,U,"timeStarted",me.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("end")}),s.jsx("input",{type:"time",value:q.timeEnded,onChange:me=>Dt(C.id,U,"timeEnded",me.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:q.hours,onChange:me=>Dt(C.id,U,"hours",me.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:q.overtimeHours,onChange:me=>Dt(C.id,U,"overtimeHours",me.target.value)})]})]})]},U)})}),s.jsxs("button",{className:"tm-add-btn",onClick:()=>gr(C.id),children:["+ ",I==="en"?"Add":"Agregar"," ",C.name]})]},C.id))]},p.id)}),Mt.filter(p=>!p.category_id&&V.has(p.id)).map(p=>s.jsxs("div",{className:"tm-field",children:[s.jsxs("div",{className:"tm-field-header",children:[s.jsx("label",{children:p.name}),s.jsx("button",{type:"button",className:"tm-remove-class-btn",onClick:()=>ls(p.id),title:I==="en"?"Remove this labor class":"Eliminar esta clase",children:""})]}),s.jsx("div",{className:"tm-workers-list",children:(ot[p.id]||[]).map((w,C)=>{const q=fr(w);return s.jsxs("div",{className:`tm-worker-card-expanded ${q!=="empty"?`worker-${q}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[q==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(Ca,{size:14})}),s.jsx("input",{type:"text",placeholder:ae("firstLastName"),value:w.name,onChange:U=>Dt(p.id,C,"name",U.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>mt(p.id,C),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("start")}),s.jsx("input",{type:"time",value:w.timeStarted,onChange:U=>Dt(p.id,C,"timeStarted",U.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("end")}),s.jsx("input",{type:"time",value:w.timeEnded,onChange:U=>Dt(p.id,C,"timeEnded",U.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:w.hours,onChange:U=>Dt(p.id,C,"hours",U.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:w.overtimeHours,onChange:U=>Dt(p.id,C,"overtimeHours",U.target.value)})]})]})]},C)})}),s.jsxs("button",{className:"tm-add-btn",onClick:()=>gr(p.id),children:["+ ",I==="en"?"Add":"Agregar"," ",p.name]})]},p.id)),ua().length>0&&s.jsx("div",{className:"tm-add-labor-class-section",children:s.jsxs("select",{className:"tm-add-labor-class-select",value:"",onChange:p=>{p.target.value&&ol(p.target.value)},children:[s.jsxs("option",{value:"",children:["+ ",I==="en"?"Add Labor Class...":"Agregar Clase de Trabajo..."]}),Vr.map(p=>{const w=ua().filter(C=>C.category_id===p.id);return w.length===0?null:s.jsx("optgroup",{label:p.name,children:w.map(C=>s.jsx("option",{value:C.id,children:C.name},C.id))},p.id)}),ua().filter(p=>!p.category_id).length>0&&s.jsx("optgroup",{label:I==="en"?"Other":"Otros",children:ua().filter(p=>!p.category_id).map(p=>s.jsx("option",{value:p.id,children:p.name},p.id))})]})}),V.size===0&&s.jsx("div",{className:"tm-no-labor-classes",children:s.jsx("p",{children:I==="en"?"No labor classes added yet. Select from crew check-in above or add manually:":"No hay clases de trabajo agregadas. Seleccione del check-in o agregue manualmente:"})})]}),Ft&&s.jsxs("div",{className:"tm-loading-labor-classes",children:[s.jsx(rl,{size:20,className:"tm-spinner"}),s.jsx("span",{children:I==="en"?"Loading labor classes...":"Cargando clases de trabajo..."})]}),!at&&!Ft&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:ae("supervision")}),s.jsx("div",{className:"tm-workers-list",children:D.map((p,w)=>{const C=fr(p);return s.jsxs("div",{className:`tm-worker-card-expanded ${C!=="empty"?`worker-${C}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[C==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(Ca,{size:14})}),s.jsx("div",{className:"tm-role-select",children:s.jsxs("select",{value:p.role,onChange:q=>ca(w,"role",q.target.value),children:[s.jsx("option",{value:"Foreman",children:ae("foreman")}),s.jsx("option",{value:"Superintendent",children:ae("superintendent")})]})}),s.jsx("input",{type:"text",placeholder:ae("firstLastName"),value:p.name,onChange:q=>ca(w,"name",q.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>Ai(w),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("start")}),s.jsx("input",{type:"time",value:p.timeStarted,onChange:q=>ca(w,"timeStarted",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("end")}),s.jsx("input",{type:"time",value:p.timeEnded,onChange:q=>ca(w,"timeEnded",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:p.hours,onChange:q=>ca(w,"hours",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:p.overtimeHours,onChange:q=>ca(w,"overtimeHours",q.target.value)})]})]})]},w)})}),s.jsx("button",{className:"tm-add-btn",onClick:hr,children:ae("addSupervision")})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:ae("operators")}),s.jsx("div",{className:"tm-workers-list",children:te.map((p,w)=>{const C=fr(p);return s.jsxs("div",{className:`tm-worker-card-expanded ${C!=="empty"?`worker-${C}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[C==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(Ca,{size:14})}),s.jsx("input",{type:"text",placeholder:ae("firstLastName"),value:p.name,onChange:q=>$t(w,"name",q.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>pr(w),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("start")}),s.jsx("input",{type:"time",value:p.timeStarted,onChange:q=>$t(w,"timeStarted",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("end")}),s.jsx("input",{type:"time",value:p.timeEnded,onChange:q=>$t(w,"timeEnded",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:p.hours,onChange:q=>$t(w,"hours",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:p.overtimeHours,onChange:q=>$t(w,"overtimeHours",q.target.value)})]})]})]},w)})}),s.jsx("button",{className:"tm-add-btn",onClick:ss,children:ae("addOperator")})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:ae("laborers")}),s.jsx("div",{className:"tm-workers-list",children:R.map((p,w)=>{const C=fr(p);return s.jsxs("div",{className:`tm-worker-card-expanded ${C!=="empty"?`worker-${C}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[C==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(Ca,{size:14})}),s.jsx("input",{type:"text",placeholder:ae("firstLastName"),value:p.name,onChange:q=>Ba(w,"name",q.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>Kr(w),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("start")}),s.jsx("input",{type:"time",value:p.timeStarted,onChange:q=>Ba(w,"timeStarted",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("end")}),s.jsx("input",{type:"time",value:p.timeEnded,onChange:q=>Ba(w,"timeEnded",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:p.hours,onChange:q=>Ba(w,"hours",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:ae("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:p.overtimeHours,onChange:q=>Ba(w,"overtimeHours",q.target.value)})]})]})]},w)})}),s.jsx("button",{className:"tm-add-btn",onClick:ki,children:ae("addLaborer")})]})]})]}),h===3&&!dt&&s.jsxs("div",{className:"tm-step-content",children:[s.jsxs("div",{className:"tm-field tm-search-field",children:[s.jsxs("div",{className:"tm-search-input-wrapper",children:[s.jsx(Cg,{size:18,className:"tm-search-icon"}),s.jsx("input",{ref:Xr,type:"text",placeholder:ae("searchMaterials"),value:or,onChange:p=>jt(p.target.value),onFocus:()=>qa(),className:"tm-search-input"}),or&&s.jsx("button",{className:"tm-search-clear",onClick:()=>{cr(""),Ua([])},children:""})]}),or&&vt.length>0&&s.jsx("div",{className:"tm-search-results",children:vt.map((p,w)=>{const C=P.find(q=>q.id===p.id);return s.jsxs("button",{className:`tm-search-result-item ${C?"added":""}`,onClick:()=>{C?xn(P.indexOf(C),C.quantity+1):_e([...P,{...p,quantity:1,isCustom:!1}]),cr(""),Ua([])},children:[s.jsx("span",{className:"tm-search-result-name",children:p.name}),s.jsx("span",{className:"tm-search-result-category",children:p.category}),C&&s.jsxs("span",{className:"tm-search-result-qty",children:["",C.quantity]})]},w)})}),or&&vt.length===0&&s.jsx("div",{className:"tm-search-no-results",children:ae("noSearchResults")})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:ae("orBrowse")}),s.jsx("div",{className:"tm-category-grid",children:Jc.map(p=>{const w=P.filter(C=>C.category===p);return s.jsxs("button",{className:"tm-category-card",onClick:()=>St(p),children:[s.jsx("span",{className:"tm-cat-name",children:p}),w.length>0&&s.jsx("span",{className:"tm-cat-count",children:w.length})]},p)})})]}),P.length>0&&s.jsxs("div",{className:"tm-field",children:[s.jsxs("label",{children:["Added Items (",P.length,")"]}),s.jsx("div",{className:"tm-added-list",children:P.map((p,w)=>s.jsxs("div",{className:"tm-added-item",children:[s.jsxs("div",{className:"tm-added-info",children:[p.isCustom&&s.jsx("span",{className:"tm-custom-badge",children:"Custom"}),s.jsx("span",{className:"tm-added-name",children:p.name})]}),s.jsxs("div",{className:"tm-added-qty",children:[s.jsx("button",{onClick:()=>xn(w,p.quantity-1),children:""}),s.jsx("span",{children:p.quantity}),s.jsx("button",{onClick:()=>xn(w,p.quantity+1),children:"+"})]})]},w))})]})]}),h===4&&s.jsxs("div",{className:"tm-step-content",children:[s.jsxs("div",{className:`tm-action-card-prominent ${qe.length>0?"has-content":"needs-action"}`,children:[s.jsxs("div",{className:"tm-action-card-header",children:[s.jsx("div",{className:"tm-action-card-icon",children:s.jsx($c,{size:24})}),s.jsxs("div",{className:"tm-action-card-title",children:[s.jsx("h4",{children:I==="en"?"Photo Evidence":"Evidencia Fotogrfica"}),s.jsx("span",{className:"tm-action-card-status",children:qe.length>0?`${qe.length} ${I==="en"?"photo(s) added":"foto(s) agregada(s)"}`:I==="en"?"Recommended for billing":"Recomendado para facturacin"})]})]}),qe.length>0&&s.jsx("div",{className:"tm-photo-preview-row",children:qe.map(p=>s.jsxs("div",{className:"tm-photo-preview-thumb",children:[s.jsx("img",{src:p.previewUrl,alt:p.name}),s.jsx("button",{className:"tm-photo-remove-x",onClick:()=>Yt(p.id),children:""})]},p.id))}),s.jsxs("label",{className:`tm-action-card-btn ${qe.length===0?"primary":""}`,children:[s.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:Sn,style:{display:"none"}}),s.jsx($c,{size:18}),s.jsx("span",{children:qe.length>0?I==="en"?"Add More Photos":"Agregar Ms Fotos":I==="en"?"Add Photos":"Agregar Fotos"})]})]}),s.jsxs("div",{className:`tm-action-card-prominent ${xe?"has-content":""}`,children:[s.jsxs("div",{className:"tm-action-card-header",children:[s.jsx("div",{className:"tm-action-card-icon cor",children:s.jsx(qg,{size:24})}),s.jsxs("div",{className:"tm-action-card-title",children:[s.jsx("h4",{children:I==="en"?"Link to Change Order":"Vincular a Orden de Cambio"}),s.jsx("span",{className:"tm-action-card-status",children:xe?`${I==="en"?"Linked to":"Vinculado a"}: ${Qe.find(p=>p.id===xe)?.cor_number||""}`:I==="en"?"Optional - Link this T&M to a COR":"Opcional - Vincular este T&M a un COR"})]})]}),s.jsxs("select",{value:xe,onChange:p=>Le(p.target.value),className:"tm-cor-select-prominent",children:[s.jsx("option",{value:"",children:I==="en"?"-- Select a COR (optional) --":"-- Seleccionar COR (opcional) --"}),Qe.map(p=>s.jsxs("option",{value:p.id,children:[p.cor_number,": ",p.title||"Untitled"," (",p.status,")"]},p.id))]}),Qe.length===0&&s.jsx("p",{className:"tm-cor-hint",children:I==="en"?"No active CORs available for this project":"No hay CORs activos para este proyecto"})]}),s.jsx("div",{className:"tm-review-divider",children:s.jsx("span",{children:I==="en"?"Ticket Summary":"Resumen del Ticket"})}),s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[" ",ae("workDate")]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>g(1),children:I==="en"?"Edit":"Editar"})]}),s.jsxs("div",{className:"tm-review-row",children:[s.jsx("span",{children:new Date(b).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),se&&s.jsxs("span",{children:["CE/PCO: ",se]})]})]}),Ne&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(rs,{size:16,className:"inline-icon"})," ",ae("notes")]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>g(1),children:I==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-notes",children:Ne})]}),at&&Aa.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(_n,{size:16,className:"inline-icon"})," ",I==="en"?"Workers":"Trabajadores"," (",Ct+Ga," hrs)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>g(2),children:I==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:Aa.map((p,w)=>s.jsxs("div",{className:"tm-review-row-detailed",children:[s.jsxs("div",{className:"tm-review-worker-name",children:[s.jsx("span",{className:"tm-role-badge",children:p.role})," ",p.name]}),s.jsxs("div",{className:"tm-review-worker-details",children:[p.time_started&&p.time_ended&&s.jsxs("span",{className:"tm-review-time",children:[p.time_started," - ",p.time_ended]}),s.jsxs("span",{className:"tm-review-hours",children:[p.hours||0," reg",p.overtime_hours>0?` + ${p.overtime_hours} OT`:""]})]})]},w))})]}),!at&&_r.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(Dg,{size:16,className:"inline-icon"})," Supervision (",_r.reduce((p,w)=>p+parseFloat(w.hours||0)+parseFloat(w.overtimeHours||0),0)," hrs)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>g(2),children:I==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:_r.map((p,w)=>s.jsxs("div",{className:"tm-review-row-detailed",children:[s.jsxs("div",{className:"tm-review-worker-name",children:[s.jsx("span",{className:"tm-role-badge",children:p.role})," ",p.name]}),s.jsxs("div",{className:"tm-review-worker-details",children:[p.timeStarted&&p.timeEnded&&s.jsxs("span",{className:"tm-review-time",children:[p.timeStarted," - ",p.timeEnded]}),s.jsxs("span",{className:"tm-review-hours",children:[p.hours||0," reg",parseFloat(p.overtimeHours)>0?` + ${p.overtimeHours} OT`:""]})]})]},w))})]}),!at&&Ta.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[" Operators (",Ta.reduce((p,w)=>p+parseFloat(w.hours||0)+parseFloat(w.overtimeHours||0),0)," hrs)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>g(2),children:I==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:Ta.map((p,w)=>s.jsxs("div",{className:"tm-review-row-detailed",children:[s.jsx("div",{className:"tm-review-worker-name",children:p.name}),s.jsxs("div",{className:"tm-review-worker-details",children:[p.timeStarted&&p.timeEnded&&s.jsxs("span",{className:"tm-review-time",children:[p.timeStarted," - ",p.timeEnded]}),s.jsxs("span",{className:"tm-review-hours",children:[p.hours||0," reg",parseFloat(p.overtimeHours)>0?` + ${p.overtimeHours} OT`:""]})]})]},w))})]}),!at&&Ya.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(_n,{size:16,className:"inline-icon"})," Laborers (",Ya.reduce((p,w)=>p+parseFloat(w.hours||0)+parseFloat(w.overtimeHours||0),0)," hrs)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>g(2),children:I==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:Ya.map((p,w)=>s.jsxs("div",{className:"tm-review-row-detailed",children:[s.jsx("div",{className:"tm-review-worker-name",children:p.name}),s.jsxs("div",{className:"tm-review-worker-details",children:[p.timeStarted&&p.timeEnded&&s.jsxs("span",{className:"tm-review-time",children:[p.timeStarted," - ",p.timeEnded]}),s.jsxs("span",{className:"tm-review-hours",children:[p.hours||0," reg",parseFloat(p.overtimeHours)>0?` + ${p.overtimeHours} OT`:""]})]})]},w))})]}),P.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(Tg,{size:16,className:"inline-icon"})," Materials & Equipment (",P.length," items)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>g(3),children:I==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:P.map((p,w)=>s.jsxs("div",{className:"tm-review-row",children:[s.jsxs("span",{children:[p.isCustom&&s.jsxs(s.Fragment,{children:[s.jsx(Ag,{size:14,className:"inline-icon"})," "]}),p.name]}),s.jsxs("span",{children:[p.quantity," ",p.unit]})]},w))})]}),s.jsxs("div",{className:"tm-review-section tm-certification",children:[s.jsx("div",{className:"tm-review-header",children:s.jsxs("span",{children:[s.jsx(Lc,{size:16,className:"inline-icon"})," Submitted By"]})}),s.jsx("input",{type:"text",className:"tm-certification-input",placeholder:"Enter your name",value:ue,onChange:p=>we(p.target.value)}),s.jsx("p",{className:"tm-certification-note",children:"By submitting, you certify this T&M is accurate."})]})]}),h===5&&H&&s.jsxs("div",{className:"tm-step-content tm-success-step",children:[s.jsxs("div",{className:"tm-success-header",children:[s.jsx("div",{className:"tm-success-icon",children:s.jsx(al,{size:48})}),s.jsx("h2",{children:I==="en"?"T&M Ticket Submitted!":"Ticket T&M Enviado!"}),s.jsx("p",{className:"tm-success-subtitle",children:I==="en"?"Your ticket has been saved and is ready for client signature.":"Su ticket ha sido guardado y est listo para la firma del cliente."})]}),s.jsxs("div",{className:"tm-success-summary",children:[s.jsxs("div",{className:"tm-success-stat",children:[s.jsx("span",{className:"tm-success-stat-value",children:Jr}),s.jsx("span",{className:"tm-success-stat-label",children:I==="en"?"Workers":"Trabajadores"})]}),s.jsxs("div",{className:"tm-success-stat",children:[s.jsx("span",{className:"tm-success-stat-value",children:Ct+Ga}),s.jsx("span",{className:"tm-success-stat-label",children:I==="en"?"Total Hours":"Horas Total"})]}),s.jsxs("div",{className:"tm-success-stat",children:[s.jsx("span",{className:"tm-success-stat-value",children:new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),s.jsx("span",{className:"tm-success-stat-label",children:I==="en"?"Work Date":"Fecha"})]})]}),qe.some(p=>p.status==="failed")&&s.jsxs("div",{className:"tm-failed-photos-section",children:[s.jsxs("div",{className:"tm-failed-photos-header",children:[s.jsx(Hc,{size:18}),s.jsx("span",{children:I==="en"?`${qe.filter(p=>p.status==="failed").length} photo(s) failed to upload`:`${qe.filter(p=>p.status==="failed").length} foto(s) no se subieron`})]}),s.jsx("div",{className:"tm-failed-photos-grid",children:qe.filter(p=>p.status==="failed").map(p=>s.jsxs("div",{className:"tm-failed-photo-item",children:[s.jsx("img",{src:p.previewUrl,alt:p.name}),s.jsx("div",{className:"tm-failed-photo-overlay",children:s.jsx("button",{className:"tm-retry-photo-btn",onClick:()=>da(p.id,H.id),disabled:p.status==="uploading"||p.status==="compressing",children:p.status==="uploading"||p.status==="compressing"?s.jsx(rl,{size:16,className:"tm-spinner"}):s.jsxs(s.Fragment,{children:[s.jsx(Yf,{size:16}),s.jsx("span",{children:I==="en"?"Retry":"Reintentar"})]})})}),p.error&&s.jsxs("div",{className:"tm-failed-photo-error",title:p.error,children:[p.error.substring(0,20),p.error.length>20?"...":""]})]},p.id))}),s.jsxs("button",{className:"tm-retry-all-btn",onClick:async()=>{const p=qe.filter(w=>w.status==="failed");for(const w of p)await da(w.id,H.id)},children:[s.jsx(Yf,{size:16}),I==="en"?"Retry All Failed Photos":"Reintentar Todas las Fotos"]})]}),qe.length>0&&qe.every(p=>p.status==="confirmed")&&s.jsxs("div",{className:"tm-photos-success",children:[s.jsx(Ca,{size:16}),s.jsx("span",{children:I==="en"?`All ${qe.length} photo(s) uploaded successfully`:`${qe.length} foto(s) subidas exitosamente`})]}),s.jsxs("div",{className:"tm-signature-options",children:[s.jsx("h3",{children:I==="en"?"Get Client Signature":"Obtener Firma del Cliente"}),s.jsx("p",{className:"tm-signature-description",children:I==="en"?"Have the client sign this T&M ticket to verify the work performed.":"Haga que el cliente firme este ticket T&M para verificar el trabajo realizado."}),M?s.jsxs("div",{className:"tm-signed-confirmation",children:[s.jsx(al,{size:32,className:"tm-signed-icon"}),s.jsx("span",{children:I==="en"?"Client signature collected!":"Firma del cliente recopilada!"})]}):s.jsxs("div",{className:"tm-signature-buttons",children:[s.jsxs("button",{className:"tm-signature-option-btn primary",onClick:()=>$(!0),children:[s.jsx("div",{className:"tm-signature-option-icon",children:s.jsx(Lc,{size:24})}),s.jsxs("div",{className:"tm-signature-option-text",children:[s.jsx("span",{className:"tm-signature-option-title",children:I==="en"?"Sign Now (On-Site)":"Firmar Ahora"}),s.jsx("span",{className:"tm-signature-option-desc",children:I==="en"?"Client signs on this device":"Cliente firma en este dispositivo"})]})]}),s.jsxs("button",{className:"tm-signature-option-btn",onClick:()=>re(!0),children:[s.jsx("div",{className:"tm-signature-option-icon",children:s.jsx(ch,{size:24})}),s.jsxs("div",{className:"tm-signature-option-text",children:[s.jsx("span",{className:"tm-signature-option-title",children:I==="en"?"Send Signature Link":"Enviar Enlace"}),s.jsx("span",{className:"tm-signature-option-desc",children:I==="en"?"Client signs later via link":"Cliente firma despus va enlace"})]})]})]})]})]}),X&&H&&s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"loading",children:"Loading..."}),children:s.jsx(E_,{documentType:"tm_ticket",documentId:H.id,companyId:l,projectId:n.id,documentTitle:`T&M - ${new Date(b).toLocaleDateString()}`,onClose:()=>re(!1),onShowToast:m})}),F&&H&&s.jsx(N.Suspense,{fallback:s.jsx("div",{className:"loading",children:"Loading..."}),children:s.jsx(C_,{ticketId:H.id,ticketSummary:{workDate:b,workerCount:Jr,totalHours:Ct+Ga},lang:I,onSave:()=>{$(!1),K(!0)},onClose:()=>$(!1),onShowToast:m})}),h<5&&s.jsxs("div",{className:"tm-wizard-footer",children:[cs.length>0&&s.jsxs("div",{className:"tm-validation-summary",children:[s.jsx(Hc,{size:16}),s.jsx("span",{children:cs[0]})]}),h===1&&s.jsx("button",{className:"tm-big-btn primary",onClick:xa,disabled:!is(),children:ae("nextCrew")}),h===2&&s.jsx(s.Fragment,{children:s.jsxs("button",{className:"tm-big-btn primary",onClick:xa,disabled:!is(),children:[ae("nextMaterials")," (",Jr," ",ae(Jr===1?"worker":"workers_plural"),", ",Ct+Ga," hrs)"]})}),h===3&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{className:"tm-big-btn primary",onClick:xa,children:[I==="en"?"Review & Submit":"Revisar y Enviar"," (",P.length," ",P.length===1?ae("item"):ae("items_plural"),")"]}),s.jsx("button",{className:"tm-skip-btn",onClick:xa,children:ae("skipNoMaterials")})]}),h===4&&s.jsx("button",{className:`tm-big-btn submit ${ee?"submitting":""} ${ue.trim()?"ready":"needs-name"}`,onClick:dl,disabled:ee||!ue.trim(),children:ee?s.jsxs(s.Fragment,{children:[s.jsx(rl,{size:20,className:"tm-spinner"}),s.jsx("span",{className:"tm-submit-text",children:Te||ae("submitting")})]}):ue.trim()?s.jsxs(s.Fragment,{children:[s.jsx(Ca,{size:20}),s.jsx("span",{children:ae("submitTM")})]}):s.jsxs(s.Fragment,{children:[s.jsx(Lc,{size:18}),s.jsx("span",{children:I==="en"?"Enter name to submit":"Ingrese nombre"})]})})]}),h===5&&s.jsxs("div",{className:"tm-wizard-footer",children:[s.jsxs("button",{className:"tm-big-btn primary",onClick:o,children:[s.jsx(Ca,{size:20}),s.jsx("span",{children:I==="en"?"Done":"Listo"})]}),s.jsx("button",{className:"tm-skip-btn",onClick:o,children:I==="en"?"Skip signature for now":"Saltar firma por ahora"})]}),W&&s.jsx("div",{className:"tm-modal-overlay",onClick:()=>ye(!1),children:s.jsxs("div",{className:"tm-batch-modal",onClick:p=>p.stopPropagation(),children:[s.jsxs("h3",{children:[s.jsx(Ci,{size:18})," ",ae("applySameHours")]}),s.jsx("p",{className:"tm-batch-description",children:ae("batchDescription")}),s.jsxs("div",{className:"tm-time-presets",children:[s.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>wn("full"),children:ae("preset8hr")}),s.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>wn("10hr"),children:ae("preset10hr")}),s.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>wn("half"),children:ae("preset4hr")})]}),s.jsxs("div",{className:"tm-batch-form",children:[s.jsxs("div",{className:"tm-batch-row",children:[s.jsxs("div",{className:"tm-batch-field",children:[s.jsx("label",{children:ae("timeStarted")}),s.jsx("input",{type:"time",value:Ae.timeStarted,onChange:p=>{const w=p.target.value,C=mr(w,Ae.timeEnded);ve({...Ae,timeStarted:w,...C||{}})}})]}),s.jsxs("div",{className:"tm-batch-field",children:[s.jsx("label",{children:ae("timeEnded")}),s.jsx("input",{type:"time",value:Ae.timeEnded,onChange:p=>{const w=p.target.value,C=mr(Ae.timeStarted,w);ve({...Ae,timeEnded:w,...C||{}})}})]})]}),s.jsxs("div",{className:"tm-batch-row",children:[s.jsxs("div",{className:"tm-batch-field",children:[s.jsx("label",{children:ae("regularHours")}),s.jsx("input",{type:"number",placeholder:"8",value:Ae.hours,onChange:p=>ve({...Ae,hours:p.target.value})})]}),s.jsxs("div",{className:"tm-batch-field",children:[s.jsx("label",{children:ae("overtimeHours")}),s.jsx("input",{type:"number",placeholder:"0",value:Ae.overtimeHours,onChange:p=>ve({...Ae,overtimeHours:p.target.value})})]})]})]}),s.jsxs("div",{className:"tm-batch-preview",children:[s.jsxs("strong",{children:[ae("willApplyTo"),":"]}),s.jsxs("span",{children:[at?Object.values(ot||{}).flat().filter(p=>p&&p.name&&p.name.trim()).length:[...D.filter(p=>p&&p.name&&p.name.trim()),...te.filter(p=>p&&p.name&&p.name.trim()),...R.filter(p=>p&&p.name&&p.name.trim())].length," ",ae("workers_plural")]})]}),s.jsxs("div",{className:"tm-batch-actions",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>ye(!1),children:ae("cancel")}),s.jsx("button",{type:"button",className:"btn btn-primary",onClick:ns,disabled:!Ae.hours&&!Ae.overtimeHours,children:ae("applyToAll")})]})]})})]})}function T_({project:n,companyId:l,onShowToast:i}){const[o,d]=N.useState([]),[m,h]=N.useState(!0),[g,b]=N.useState(!1),[O,H]=N.useState(!1),[x,X]=N.useState({name:"",role:"",labor_class_id:null}),[re,F]=N.useState([]),[$,M]=N.useState(!0),[K,se]=N.useState([]),[le,ue]=N.useState([]),[we,xe]=N.useState(!0),Le=["Foreman","Laborer","Supervisor","Operator"],Qe=N.useCallback(async()=>{try{const G=await he.getCrewCheckin(n.id);G?.workers&&d(G.workers)}catch(G){console.error("Error loading crew:",G)}finally{h(!1)}},[n?.id]),Me=N.useCallback(async()=>{try{const G=await he.getRecentWorkers(n.id,30);F(G)}catch(G){console.error("Error loading recent workers:",G)}finally{M(!1)}},[n?.id]),Ie=N.useCallback(async()=>{try{const G=await he.getLaborClassesForField(l);se(G.categories||[]),ue(G.classes||[]),G.classes&&G.classes.length>0&&X(R=>({...R,role:G.classes[0].name,labor_class_id:G.classes[0].id}))}catch(G){console.error("Error loading labor classes:",G),i?.("Using default roles - custom labor classes unavailable","info")}finally{xe(!1)}},[l,i]);N.useEffect(()=>{n?.id&&(Qe(),Me(),l?Ie():xe(!1))},[n?.id,l,Qe,Me,Ie]);const Ke=G=>{const R=le.find(ie=>ie.id===G);X(R?{...x,role:R.name,labor_class_id:R.id}:{...x,role:G,labor_class_id:null})},W=async()=>{if(!x.name.trim()){i("Enter worker name","error");return}if(!x.role){i("Select a role","error");return}if(o.find(G=>G.name.toLowerCase()===x.name.trim().toLowerCase())){i("Worker already added","error");return}b(!0);try{const G=[...o,{name:x.name.trim(),role:x.role,labor_class_id:x.labor_class_id}];await he.saveCrewCheckin(n.id,G),d(G),X({...x,name:""}),H(!1),i("Crew member added","success")}catch(G){console.error("Error adding worker:",G),i("Error adding crew member","error")}finally{b(!1)}},ye=async G=>{b(!0);try{const R=o.filter(ie=>ie.name.toLowerCase()!==G.toLowerCase());await he.saveCrewCheckin(n.id,R),d(R),i("Crew member removed","success")}catch(R){console.error("Error removing worker:",R),i("Error removing crew member","error")}finally{b(!1)}},Ae=async G=>{if(o.find(R=>R.name.toLowerCase()===G.name.toLowerCase())){i("Already checked in","info");return}b(!0);try{const R=[...o,{name:G.name,role:G.role,labor_class_id:G.labor_class_id}];await he.saveCrewCheckin(n.id,R),d(R),i(`${G.name} checked in`,"success")}catch(R){console.error("Error adding worker:",R),i("Error adding crew member","error")}finally{b(!1)}},ve=re.filter(G=>!o.find(R=>R.name.toLowerCase()===G.name.toLowerCase())),D=new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"}),Q=()=>{const G={};K.forEach(ie=>{G[ie.id]={name:ie.name,classes:le.filter(P=>P.category_id===ie.id)}});const R=le.filter(ie=>!ie.category_id);return R.length>0&&(G.uncategorized={name:"Other",classes:R}),G},te=le.length>0;return m||we?s.jsxs("div",{className:"crew-checkin",children:[s.jsxs("div",{className:"crew-header",children:[s.jsxs("h3",{children:[s.jsx(_n,{size:18,className:"inline-icon"})," Today's Crew"]}),s.jsx("span",{className:"crew-date",children:D})]}),s.jsx("div",{className:"crew-loading",children:"Loading..."})]}):s.jsxs("div",{className:"crew-checkin",children:[s.jsxs("div",{className:"crew-header",children:[s.jsxs("h3",{children:[s.jsx(_n,{size:18,className:"inline-icon"})," Today's Crew"]}),s.jsx("span",{className:"crew-date",children:D})]}),o.length===0?s.jsxs("div",{className:"crew-empty",children:[s.jsx("p",{children:"No crew checked in yet"}),s.jsx("p",{className:"crew-empty-hint",children:"Add your crew for the day"})]}):s.jsx("div",{className:"crew-list",children:o.map(G=>s.jsxs("div",{className:"crew-member",children:[s.jsxs("div",{className:"crew-member-info",children:[s.jsx("span",{className:"crew-member-name",children:G.name}),s.jsx("span",{className:`crew-member-role ${(G.role||"laborer").toLowerCase().replace(/\s+/g,"-")}`,children:G.role})]}),s.jsx("button",{className:"crew-remove-btn",onClick:()=>ye(G.name),disabled:g,children:""})]},G.name))}),!$&&ve.length>0&&s.jsxs("div",{className:"crew-quick-add",children:[s.jsx("div",{className:"crew-quick-add-header",children:s.jsx("span",{children:"Tap to add"})}),s.jsx("div",{className:"crew-quick-add-grid",children:ve.map(G=>s.jsxs("button",{className:"crew-quick-add-btn",onClick:()=>Ae(G),disabled:g,children:[s.jsx("span",{className:"crew-quick-add-name",children:G.name}),s.jsx("span",{className:"crew-quick-add-role",children:G.role})]},G.name))})]}),O?s.jsxs("div",{className:"crew-add-form",children:[s.jsx("input",{type:"text",value:x.name,onChange:G=>X({...x,name:G.target.value}),placeholder:"Name",autoFocus:!0}),s.jsx("select",{value:x.labor_class_id||x.role,onChange:G=>Ke(G.target.value),children:te?Object.entries(Q()).map(([G,R])=>s.jsx("optgroup",{label:R.name,children:R.classes.map(ie=>s.jsx("option",{value:ie.id,children:ie.name},ie.id))},G)):Le.map(G=>s.jsx("option",{value:G,children:G},G))}),s.jsxs("div",{className:"crew-add-buttons",children:[s.jsx("button",{className:"crew-add-confirm",onClick:W,disabled:g,children:g?"...":"Add"}),s.jsx("button",{className:"crew-add-cancel",onClick:()=>{H(!1),X({name:"",role:le[0]?.name||"Laborer",labor_class_id:le[0]?.id||null})},children:"Cancel"})]})]}):s.jsxs("button",{className:"crew-add-btn",onClick:()=>H(!0),children:[s.jsx(kg,{size:18}),s.jsx("span",{children:"Add New Person"})]}),s.jsxs("div",{className:"crew-count",children:[o.length," ",o.length===1?"person":"people"," on site"]})]})}function A_({project:n,onShowToast:l,onClose:i}){const[o,d]=N.useState(!0),[m,h]=N.useState(!1),[g,b]=N.useState(null),[O,H]=N.useState(""),[x,X]=N.useState("");N.useEffect(()=>{n?.id&&re()},[n?.id]);const re=async()=>{try{const K=await he.getDailyReport(n.id);if(K)b(K),H(K.field_notes||""),X(K.issues||"");else{const se=await he.compileDailyReport(n.id);b({...se,status:"draft"})}}catch(K){console.error("Error loading report:",K),l("Error loading report","error")}finally{d(!1)}},F=async()=>{if(!v){l("Demo Mode: Report saved locally only - won't reach office","info"),i();return}h(!0);try{await he.saveDailyReport(n.id,{field_notes:O,issues:x}),await he.submitDailyReport(n.id,"Field")?(l("Daily report submitted!","success"),i()):l("Report not sent - check connection","error")}catch(K){console.error("Error submitting report:",K),l("Error submitting report","error")}finally{h(!1)}},$=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"});if(o)return s.jsxs("div",{className:"daily-report",children:[s.jsxs("div",{className:"daily-report-header",children:[s.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),s.jsx("h2",{children:"Daily Report"})]}),s.jsx("div",{className:"daily-report-loading",children:"Compiling report..."})]});if(!g)return s.jsxs("div",{className:"daily-report",children:[s.jsxs("div",{className:"daily-report-header",children:[s.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),s.jsx("h2",{children:"Daily Report"})]}),s.jsxs("div",{className:"daily-report-error",children:[s.jsx("p",{children:"Unable to load report data."}),s.jsx("button",{className:"btn btn-secondary",onClick:re,children:"Retry"})]})]});const M=g.status==="submitted";return s.jsxs("div",{className:"daily-report",children:[s.jsxs("div",{className:"daily-report-header",children:[s.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),s.jsxs("div",{children:[s.jsx("h2",{children:"Daily Report"}),s.jsx("p",{className:"daily-report-date",children:$})]})]}),M&&s.jsxs("div",{className:"daily-report-submitted-banner",children:[" Submitted ",new Date(g.submitted_at).toLocaleTimeString()]}),s.jsxs("div",{className:"daily-report-content",children:[s.jsxs("div",{className:"daily-report-summary",children:[s.jsxs("div",{className:"daily-report-card",children:[s.jsx("div",{className:"daily-report-card-value",children:g.crew_count||0}),s.jsx("div",{className:"daily-report-card-label",children:"Crew on Site"})]}),s.jsxs("div",{className:"daily-report-card",children:[s.jsx("div",{className:"daily-report-card-value",children:g.tasks_completed||0}),s.jsx("div",{className:"daily-report-card-label",children:"Tasks Done"})]}),s.jsxs("div",{className:"daily-report-card",children:[s.jsx("div",{className:"daily-report-card-value",children:g.tm_tickets_count||0}),s.jsx("div",{className:"daily-report-card-label",children:"T&M Tickets"})]}),s.jsxs("div",{className:"daily-report-card",children:[s.jsx("div",{className:"daily-report-card-value",children:g.photos_count||0}),s.jsx("div",{className:"daily-report-card-label",children:"Photos"})]})]}),g.crew_list?.length>0&&s.jsxs("div",{className:"daily-report-section",children:[s.jsxs("h3",{children:[s.jsx(_n,{size:18,className:"inline-icon"})," Crew"]}),s.jsx("div",{className:"daily-report-crew",children:g.crew_list.map((K,se)=>s.jsxs("div",{className:"daily-report-crew-item",children:[s.jsx("span",{children:K.name}),s.jsx("span",{className:"daily-report-crew-role",children:K.role})]},se))})]}),g.completed_tasks?.length>0&&s.jsxs("div",{className:"daily-report-section",children:[s.jsxs("h3",{children:[s.jsx(Og,{size:18,className:"inline-icon"})," Completed Today"]}),s.jsx("ul",{className:"daily-report-tasks",children:g.completed_tasks.map((K,se)=>s.jsxs("li",{children:[K.name,K.group&&s.jsx("span",{className:"daily-report-task-group",children:K.group})]},se))})]}),s.jsxs("div",{className:"daily-report-section",children:[s.jsxs("h3",{children:[s.jsx(rs,{size:18,className:"inline-icon"})," Notes"]}),s.jsx("textarea",{value:O,onChange:K=>H(K.target.value),placeholder:"Any notes about today's work...",rows:3,disabled:M})]}),s.jsxs("div",{className:"daily-report-section",children:[s.jsxs("h3",{children:[s.jsx(Di,{size:18,className:"inline-icon"})," Issues / Concerns"]}),s.jsx("textarea",{value:x,onChange:K=>X(K.target.value),placeholder:"Any problems, delays, or concerns...",rows:3,disabled:M})]})]}),!M&&s.jsxs("div",{className:"daily-report-footer",children:[s.jsx("button",{className:"btn btn-primary daily-report-submit",onClick:F,disabled:m,children:m?"Submitting...":s.jsxs(s.Fragment,{children:[s.jsx(zg,{size:16,className:"inline-icon"})," Submit Report"]})}),s.jsx("p",{className:"daily-report-hint",children:"This will be sent to the office"})]})]})}function k_({project:n,companyId:l,user:i,onClose:o,onReportCreated:d}){const[m,h]=N.useState(!1),[g,b]=N.useState(null),[O,H]=N.useState(1),[x,X]=N.useState(new Date().toISOString().split("T")[0]),[re,F]=N.useState(new Date().toTimeString().split(" ")[0].substring(0,5)),[$,M]=N.useState(""),[K,se]=N.useState(""),[le,ue]=N.useState("minor"),[we,xe]=N.useState(""),[Le,Qe]=N.useState(""),[Me,Ie]=N.useState(""),[Ke,W]=N.useState(""),[ye,Ae]=N.useState(""),[ve,D]=N.useState(""),[Q,te]=N.useState(""),[G,R]=N.useState(i?.name||""),[ie,P]=N.useState(""),[_e,Ne]=N.useState(""),[et,qe]=N.useState(i?.email||""),[J,ee]=N.useState([]),[je,Te]=N.useState(""),[tt,We]=N.useState(""),[lt,it]=N.useState(""),[Ht,dt]=N.useState(""),[St,vn]=N.useState(!1),[ir,Yr]=N.useState(""),[Ra,or]=N.useState(""),[cr,vt]=N.useState(!1),[Ua,Gr]=N.useState(""),[Qr,ia]=N.useState(""),[Ha,bt]=N.useState(""),[La,Xr]=N.useState(""),[oa,Nt]=N.useState(!1),[Lt,I]=N.useState(!1),[bn,ae]=N.useState(0),[Vr,ur]=N.useState(0),Mt=()=>{if(!je.trim()){b({type:"error",message:"Please enter witness name"});return}const V={name:je,phone:tt,email:lt,testimony:Ht};ee([...J,V]),Te(""),We(""),it(""),dt(""),b({type:"success",message:"Witness added"})},dr=V=>{ee(J.filter((Bt,at)=>at!==V))},ot=V=>{switch(V){case 1:if(!$.trim()||!K.trim())return b({type:"error",message:"Please fill in all incident details"}),!1;break;case 2:if(!Le.trim()||!ve.trim())return b({type:"error",message:"Please fill in employee name and job title"}),!1;break;case 3:if(!G.trim()||!ie.trim())return b({type:"error",message:"Please fill in supervisor name and title"}),!1;break}return!0},Et=()=>{ot(O)&&H(O+1)},Ft=()=>{H(O-1)},jn=async()=>{if(ot(O)){if(!v){b({type:"info",message:"Demo Mode: Report saved locally only - won't reach office"}),setTimeout(()=>{o()},1500);return}h(!0);try{const V={project_id:n.id,company_id:l,incident_date:x,incident_time:re,incident_location:$,incident_description:K,injury_type:le,body_part_affected:we||null,employee_name:Le,employee_phone:Me||null,employee_email:Ke||null,employee_address:ye||null,employee_job_title:ve,employee_hire_date:Q||null,medical_treatment_required:St,medical_facility_name:ir||null,medical_facility_address:Ra||null,hospitalized:cr,reported_by_name:G,reported_by_title:ie,reported_by_phone:_e||null,reported_by_email:et||null,witnesses:J,immediate_actions_taken:Ua||null,corrective_actions_planned:Qr||null,safety_equipment_used:Ha||null,safety_equipment_failed:La||null,osha_recordable:oa,workers_comp_claim:Lt,days_away_from_work:parseInt(bn)||0,restricted_work_days:parseInt(Vr)||0,status:"reported",created_by:i?.id},Bt=await he.createInjuryReport(V);b({type:"success",message:"Injury report submitted successfully"}),d&&d(Bt),setTimeout(()=>{o()},1500)}catch(V){console.error("Error submitting injury report:",V),b({type:"error",message:"Failed to submit injury report"})}finally{h(!1)}}};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"modal-overlay",onClick:o,children:s.jsxs("div",{className:"modal-content injury-report-modal",onClick:V=>V.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h2",{children:"Workplace Injury/Incident Report"}),s.jsx("button",{className:"close-btn",onClick:o,children:""})]}),s.jsxs("div",{className:"progress-steps",children:[s.jsx("div",{className:`step ${O>=1?"active":""}`,children:"1. Incident"}),s.jsx("div",{className:`step ${O>=2?"active":""}`,children:"2. Employee"}),s.jsx("div",{className:`step ${O>=3?"active":""}`,children:"3. Supervisor"}),s.jsx("div",{className:`step ${O>=4?"active":""}`,children:"4. Witnesses"}),s.jsx("div",{className:`step ${O>=5?"active":""}`,children:"5. Medical & Safety"})]}),s.jsxs("div",{className:"modal-body",children:[O===1&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Incident Details"}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Date of Incident *"}),s.jsx("input",{type:"date",value:x,onChange:V=>X(V.target.value),max:new Date().toISOString().split("T")[0]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Time of Incident *"}),s.jsx("input",{type:"time",value:re,onChange:V=>F(V.target.value)})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Location on Site *"}),s.jsx("input",{type:"text",value:$,onChange:V=>M(V.target.value),placeholder:"e.g., Floor 2, near elevator shaft"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Incident Description *"}),s.jsx("textarea",{value:K,onChange:V=>se(V.target.value),rows:4,placeholder:"Describe what happened in detail..."})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Injury Type *"}),s.jsxs("select",{value:le,onChange:V=>ue(V.target.value),children:[s.jsx("option",{value:"minor",children:"Minor Injury"}),s.jsx("option",{value:"serious",children:"Serious Injury"}),s.jsx("option",{value:"critical",children:"Critical Injury"}),s.jsx("option",{value:"near_miss",children:"Near Miss (No Injury)"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Body Part Affected"}),s.jsx("input",{type:"text",value:we,onChange:V=>xe(V.target.value),placeholder:"e.g., Left hand, lower back"})]})]})]}),O===2&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Injured Employee Information"}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Full Name *"}),s.jsx("input",{type:"text",value:Le,onChange:V=>Qe(V.target.value),placeholder:"First and last name"})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Phone Number"}),s.jsx("input",{type:"tel",value:Me,onChange:V=>Ie(V.target.value),placeholder:"(555) 123-4567"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Email Address"}),s.jsx("input",{type:"email",value:Ke,onChange:V=>W(V.target.value),placeholder:"email@example.com"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Home Address"}),s.jsx("input",{type:"text",value:ye,onChange:V=>Ae(V.target.value),placeholder:"Street address, city, state, zip"})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Job Title *"}),s.jsx("input",{type:"text",value:ve,onChange:V=>D(V.target.value),placeholder:"e.g., Carpenter, Electrician"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Hire Date"}),s.jsx("input",{type:"date",value:Q,onChange:V=>te(V.target.value)})]})]})]}),O===3&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Foreman/Supervisor Making Report"}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Your Name *"}),s.jsx("input",{type:"text",value:G,onChange:V=>R(V.target.value),placeholder:"Full name"})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Your Title *"}),s.jsx("input",{type:"text",value:ie,onChange:V=>P(V.target.value),placeholder:"e.g., Site Foreman, Project Manager"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Your Phone Number"}),s.jsx("input",{type:"tel",value:_e,onChange:V=>Ne(V.target.value),placeholder:"(555) 123-4567"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Your Email Address"}),s.jsx("input",{type:"email",value:et,onChange:V=>qe(V.target.value),placeholder:"email@example.com"})]})]}),O===4&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Witness Testimonies (Optional)"}),J.length>0&&s.jsx("div",{className:"witnesses-list",children:J.map((V,Bt)=>s.jsxs("div",{className:"witness-item",children:[s.jsxs("div",{className:"witness-info",children:[s.jsx("strong",{children:V.name}),V.phone&&s.jsxs("span",{children:["  ",V.phone]}),V.testimony&&s.jsxs("p",{className:"witness-testimony",children:['"',V.testimony,'"']})]}),s.jsx("button",{className:"btn-danger btn-small",onClick:()=>dr(Bt),children:"Remove"})]},Bt))}),s.jsxs("div",{className:"add-witness-form",children:[s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Witness Name"}),s.jsx("input",{type:"text",value:je,onChange:V=>Te(V.target.value),placeholder:"Full name"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Phone Number"}),s.jsx("input",{type:"tel",value:tt,onChange:V=>We(V.target.value),placeholder:"(555) 123-4567"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Email Address"}),s.jsx("input",{type:"email",value:lt,onChange:V=>it(V.target.value),placeholder:"email@example.com"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Witness Testimony"}),s.jsx("textarea",{value:Ht,onChange:V=>dt(V.target.value),rows:3,placeholder:"What did the witness see or hear?"})]}),s.jsx("button",{className:"btn-secondary",onClick:Mt,children:"+ Add Witness"})]})]}),O===5&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Medical Treatment & Safety"}),s.jsx("div",{className:"form-group checkbox-group",children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:St,onChange:V=>vn(V.target.checked)}),"Medical treatment required"]})}),St&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Medical Facility Name"}),s.jsx("input",{type:"text",value:ir,onChange:V=>Yr(V.target.value),placeholder:"Hospital or clinic name"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Medical Facility Address"}),s.jsx("input",{type:"text",value:Ra,onChange:V=>or(V.target.value),placeholder:"Street address"})]}),s.jsx("div",{className:"form-group checkbox-group",children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:cr,onChange:V=>vt(V.target.checked)}),"Employee was hospitalized"]})})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Immediate Actions Taken"}),s.jsx("textarea",{value:Ua,onChange:V=>Gr(V.target.value),rows:2,placeholder:"What was done immediately after the incident?"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Corrective Actions Planned"}),s.jsx("textarea",{value:Qr,onChange:V=>ia(V.target.value),rows:2,placeholder:"What will be done to prevent this in the future?"})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Safety Equipment Used"}),s.jsx("input",{type:"text",value:Ha,onChange:V=>bt(V.target.value),placeholder:"e.g., Hard hat, gloves, harness"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Safety Equipment Failed"}),s.jsx("input",{type:"text",value:La,onChange:V=>Xr(V.target.value),placeholder:"Equipment that failed, if any"})]})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Days Away From Work"}),s.jsx("input",{type:"number",min:"0",value:bn,onChange:V=>ae(V.target.value)})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Restricted Work Days"}),s.jsx("input",{type:"number",min:"0",value:Vr,onChange:V=>ur(V.target.value)})]})]}),s.jsx("div",{className:"form-group checkbox-group",children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:oa,onChange:V=>Nt(V.target.checked)}),"OSHA Recordable Incident"]})}),s.jsx("div",{className:"form-group checkbox-group",children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:Lt,onChange:V=>I(V.target.checked)}),"Workers' Compensation Claim Filed"]})})]})]}),s.jsx("div",{className:"modal-footer",children:s.jsxs("div",{className:"form-actions",children:[O>1&&s.jsx("button",{className:"btn-secondary",onClick:Ft,children:" Back"}),s.jsx("button",{className:"btn-secondary",onClick:o,children:"Cancel"}),O<5?s.jsx("button",{className:"btn-primary",onClick:Et,children:"Next "}):s.jsx("button",{className:"btn-primary",onClick:jn,disabled:m,children:m?"Submitting...":"Submit Report"})]})})]})}),g&&s.jsx(pn,{message:g.message,type:g.type,onClose:()=>b(null)}),s.jsx("style",{children:`
        .injury-report-modal {
          max-width: 800px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .progress-steps {
          display: flex;
          justify-content: space-between;
          padding: 1rem 1.5rem;
          border-bottom: 1px solid var(--border-color);
          background-color: var(--bg-elevated);
          overflow-x: auto;
        }

        .progress-steps .step {
          font-size: 0.875rem;
          color: var(--text-muted);
          font-weight: 500;
          white-space: nowrap;
          padding: 0.5rem;
        }

        .progress-steps .step.active {
          color: var(--accent-primary);
          font-weight: 600;
        }

        .form-step h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          color: var(--text-primary);
          font-size: 1.25rem;
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1rem;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .form-group label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 500;
          color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          width: 100%;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 1rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-group textarea {
          resize: vertical;
        }

        .checkbox-group label {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: normal;
          cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
          width: auto;
          margin: 0;
        }

        .witnesses-list {
          margin-bottom: 1.5rem;
        }

        .witness-item {
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
        }

        .witness-info {
          flex: 1;
          color: var(--text-primary);
        }

        .witness-testimony {
          margin-top: 0.5rem;
          color: var(--text-secondary);
          font-style: italic;
          font-size: 0.875rem;
        }

        .add-witness-form {
          border: 2px dashed var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          background-color: var(--bg-elevated);
        }

        .modal-footer {
          border-top: 1px solid var(--border-color);
          padding: 1rem 1.5rem;
        }

        .form-actions {
          display: flex;
          justify-content: space-between;
          gap: 0.5rem;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
        }

        @media (max-width: 768px) {
          .injury-report-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }

          .form-row {
            grid-template-columns: 1fr;
          }

          .progress-steps .step {
            font-size: 0.75rem;
            padding: 0.25rem;
          }
        }
      `})]})}const Ei=[{value:"concrete",label:"Concrete",icon:""},{value:"trash",label:"Trash",icon:""},{value:"metals",label:"Metals",icon:""},{value:"hazardous_waste",label:"Hazardous",icon:""}],O_=n=>Ei.find(l=>l.value===n)||{label:n,icon:""};function z_({project:n,user:l=null,date:i,onShowToast:o}){const[d,m]=N.useState([]),[h,g]=N.useState([]),[b,O]=N.useState(!0),[H,x]=N.useState(!1),[X,re]=N.useState(!1),[F,$]=N.useState(!1),[M,K]=N.useState({type:"concrete",count:1}),se=new Date(i).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});N.useEffect(()=>{le(),ue()},[n.id,i]);const le=async()=>{try{O(!0);const W=await he.getDisposalLoads(n.id,i);m(W||[])}catch(W){console.error("Error loading disposal loads:",W)}finally{O(!1)}},ue=async()=>{try{const ye=(await he.getDisposalLoadsHistory(n.id,14)||[]).filter(ve=>ve.load_date!==i).reduce((ve,D)=>(ve[D.load_date]||(ve[D.load_date]=[]),ve[D.load_date].push(D),ve),{}),Ae=Object.entries(ye).map(([ve,D])=>({date:ve,loads:D,totalLoads:D.reduce((Q,te)=>Q+te.load_count,0)})).sort((ve,D)=>new Date(D.date)-new Date(ve.date));g(Ae)}catch(W){console.error("Error loading disposal history:",W)}},we=async()=>{if(!(M.count<1)){x(!0);try{await he.addDisposalLoad(n.id,l?.id||null,i,M.type,M.count),await le(),K({type:"concrete",count:1}),re(!1),o?.("Disposal load added","success")}catch(W){console.error("Error adding disposal load:",W),o?.("Error adding load","error")}finally{x(!1)}}},xe=async W=>{x(!0);try{await he.deleteDisposalLoad(W),await le(),o?.("Load removed","success")}catch(ye){console.error("Error deleting disposal load:",ye),o?.("Error removing load","error")}finally{x(!1)}},Le=async W=>{x(!0);try{await he.addDisposalLoad(n.id,l?.id||null,i,W,1),await le(),o?.("Load added","success")}catch(ye){console.error("Error adding disposal load:",ye),o?.("Error adding load","error")}finally{x(!1)}},Qe=async W=>{x(!0);try{await he.updateDisposalLoad(W.id,W.load_type,W.load_count+1),await le()}catch(ye){console.error("Error updating load:",ye),o?.("Error updating load","error")}finally{x(!1)}},Me=async W=>{if(W.load_count<=1){await xe(W.id);return}x(!0);try{await he.updateDisposalLoad(W.id,W.load_type,W.load_count-1),await le()}catch(ye){console.error("Error updating load:",ye),o?.("Error updating load","error")}finally{x(!1)}},Ie=d.reduce((W,ye)=>(W[ye.load_type]||(W[ye.load_type]={items:[],total:0}),W[ye.load_type].items.push(ye),W[ye.load_type].total+=ye.load_count,W),{}),Ke=d.reduce((W,ye)=>W+ye.load_count,0);return b?s.jsxs("div",{className:"disposal-load-input",children:[s.jsxs("div",{className:"disposal-header",children:[s.jsx(Wc,{size:20}),s.jsx("span",{children:"Disposal Loads"})]}),s.jsx("div",{className:"disposal-loading",children:"Loading..."})]}):s.jsxs("div",{className:"disposal-load-input",children:[s.jsxs("div",{className:"disposal-header",children:[s.jsxs("div",{className:"disposal-title",children:[s.jsx(Wc,{size:20}),s.jsx("span",{children:"Disposal Loads"}),Ke>0&&s.jsx("span",{className:"disposal-badge",children:Ke})]}),s.jsx("span",{className:"disposal-date",children:se})]}),s.jsx("div",{className:"disposal-quick-add",children:Ei.map(W=>s.jsxs("button",{className:"quick-add-btn",onClick:()=>Le(W.value),disabled:H,children:[s.jsx("span",{className:"quick-add-icon",children:W.icon}),s.jsxs("span",{className:"quick-add-label",children:["+ ",W.label]})]},W.value))}),Object.keys(Ie).length>0?s.jsx("div",{className:"disposal-loads-list",children:Ei.map(W=>{const ye=Ie[W.value];return ye?s.jsxs("div",{className:"disposal-load-row",children:[s.jsxs("div",{className:"load-info",children:[s.jsx("span",{className:"load-icon",children:W.icon}),s.jsx("span",{className:"load-label",children:W.label})]}),s.jsxs("div",{className:"load-controls",children:[s.jsx("button",{className:"load-btn decrement",onClick:()=>Me(ye.items[0]),disabled:H,children:s.jsx(Gf,{size:16})}),s.jsx("span",{className:"load-count",children:ye.total}),s.jsx("button",{className:"load-btn increment",onClick:()=>Qe(ye.items[0]),disabled:H,children:s.jsx(Bc,{size:16})})]})]},W.value):null})}):s.jsxs("div",{className:"disposal-empty",children:[s.jsxs("p",{children:["No disposal loads recorded for ",se]}),s.jsx("p",{className:"disposal-hint",children:"Tap a button above to add loads"})]}),X&&s.jsxs("div",{className:"disposal-add-form",children:[s.jsxs("div",{className:"add-form-row",children:[s.jsx("select",{value:M.type,onChange:W=>K({...M,type:W.target.value}),className:"load-type-select",children:Ei.map(W=>s.jsxs("option",{value:W.value,children:[W.icon," ",W.label]},W.value))}),s.jsxs("div",{className:"count-input-group",children:[s.jsx("button",{className:"count-btn",onClick:()=>K({...M,count:Math.max(1,M.count-1)}),children:s.jsx(Gf,{size:16})}),s.jsx("input",{type:"number",min:"1",value:M.count,onChange:W=>K({...M,count:parseInt(W.target.value)||1}),className:"count-input"}),s.jsx("button",{className:"count-btn",onClick:()=>K({...M,count:M.count+1}),children:s.jsx(Bc,{size:16})})]})]}),s.jsxs("div",{className:"add-form-actions",children:[s.jsxs("button",{className:"btn btn-secondary btn-small",onClick:()=>re(!1),children:[s.jsx(Mg,{size:16})," Cancel"]}),s.jsxs("button",{className:"btn btn-primary btn-small",onClick:we,disabled:H,children:[s.jsx(Ca,{size:16})," Add"]})]})]}),!X&&s.jsxs("button",{className:"disposal-add-custom",onClick:()=>re(!0),children:[s.jsx(Bc,{size:16}),"Add multiple loads"]}),Ke>0&&s.jsxs("div",{className:"disposal-summary",children:[s.jsx("strong",{children:Ke})," total load",Ke!==1?"s":""," today"]}),h.length>0&&s.jsxs("div",{className:"disposal-history-section",children:[s.jsxs("button",{className:"disposal-history-toggle",onClick:()=>$(!F),children:[s.jsx(Rg,{size:16}),s.jsxs("span",{children:["View History (",h.length," days)"]}),F?s.jsx(Ug,{size:16}):s.jsx(uh,{size:16})]}),F&&s.jsx("div",{className:"disposal-history-list",children:h.map(W=>{const ye=new Date(W.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),Ae=W.loads.reduce((ve,D)=>(ve[D.load_type]||(ve[D.load_type]=0),ve[D.load_type]+=D.load_count,ve),{});return s.jsxs("div",{className:"disposal-history-day",children:[s.jsxs("div",{className:"disposal-history-header",children:[s.jsx("span",{className:"disposal-history-date",children:ye}),s.jsxs("span",{className:"disposal-history-total",children:[W.totalLoads," load",W.totalLoads!==1?"s":""]})]}),s.jsx("div",{className:"disposal-history-types",children:Object.entries(Ae).map(([ve,D])=>{const Q=O_(ve);return s.jsxs("span",{className:"disposal-history-type",children:[Q.icon," ",D," ",Q.label]},ve)})})]},W.date)})})]})]})}const lh={folder:el,plans:Yg,specs:rs,permits:Bg,contracts:Lg,submittals:ch,rfis:Hg,photos:$c,reports:dh,safety:Di},Si={blue:"#3b82f6",green:"#10b981",yellow:"#f59e0b",red:"#ef4444",purple:"#8b5cf6",pink:"#ec4899",gray:"#6b7280",orange:"#f97316"},M_=n=>n?.startsWith("image/")?Qg:n?.includes("spreadsheet")||n?.includes("excel")?Xg:n?.includes("pdf")?rs:Vg,R_=n=>{if(!n)return"0 B";const l=["B","KB","MB","GB"];let i=n,o=0;for(;i>=1024&&o<l.length-1;)i/=1024,o++;return`${i.toFixed(i<10?1:0)} ${l[o]}`};function U_({projectId:n,onShowToast:l}){const[i,o]=N.useState([]),[d,m]=N.useState(!0),[h,g]=N.useState(null),[b,O]=N.useState([]),[H,x]=N.useState(!1);N.useEffect(()=>{X()},[n]);const X=async()=>{m(!0);try{const M=await he.getProjectFolders(n);o(M)}catch(M){console.error("Error loading folders:",M),l?.("Failed to load folders","error")}finally{m(!1)}},re=async M=>{g(M),x(!0);try{const K=await he.getFolderDocuments(M.id);O(K.documents)}catch(K){console.error("Error loading documents:",K),l?.("Failed to load documents","error")}finally{x(!1)}},F=async M=>{try{await he.logDocumentAccess(M.id,"downloaded");const K=M.url||`https://cegifnrcwdilromcyouq.supabase.co/storage/v1/object/public/project-documents/${M.storage_path}`;window.open(K,"_blank")}catch(K){console.error("Download error:",K)}},$=()=>{g(null),O([])};if(d)return s.jsx("div",{className:"field-docs",children:s.jsxs("div",{className:"field-docs-loading",children:[s.jsx(rl,{size:24,className:"spinner"}),s.jsx("span",{children:"Loading..."})]})});if(h){const M=lh[h.icon]||el,K=Si[h.color]||Si.blue;return s.jsxs("div",{className:"field-docs",children:[s.jsxs("div",{className:"field-docs-header",children:[s.jsx("button",{className:"field-docs-back",onClick:$,children:s.jsx(as,{size:20})}),s.jsxs("div",{className:"field-docs-title",children:[s.jsx("div",{className:"field-docs-title-icon",style:{backgroundColor:`${K}15`},children:s.jsx(M,{size:20,style:{color:K}})}),s.jsxs("div",{className:"field-docs-title-text",children:[s.jsx("h2",{children:h.name}),s.jsxs("span",{children:[b.length," files"]})]})]})]}),s.jsx("div",{className:"field-docs-list",children:H?s.jsxs("div",{className:"field-docs-loading",children:[s.jsx(rl,{size:24,className:"spinner"}),s.jsx("span",{children:"Loading..."})]}):b.length===0?s.jsxs("div",{className:"field-docs-empty",children:[s.jsx(el,{size:48,style:{color:K,opacity:.3}}),s.jsx("p",{children:"No documents yet"})]}):b.map(se=>{const le=M_(se.mime_type);return s.jsxs("button",{className:"field-doc-item",onClick:()=>F(se),children:[s.jsx("div",{className:"field-doc-icon",children:s.jsx(le,{size:22})}),s.jsxs("div",{className:"field-doc-info",children:[s.jsx("span",{className:"field-doc-name",children:se.name}),s.jsx("span",{className:"field-doc-size",children:R_(se.file_size_bytes)})]}),s.jsx(Gg,{size:20,className:"field-doc-download"})]},se.id)})})]})}return s.jsx("div",{className:"field-docs",children:s.jsx("div",{className:"field-docs-grid",children:i.length===0?s.jsxs("div",{className:"field-docs-empty",children:[s.jsx(el,{size:56}),s.jsx("h3",{children:"No documents"}),s.jsx("p",{children:"Documents will appear here when added"})]}):i.map(M=>{const K=lh[M.icon]||el,se=Si[M.color]||Si.blue,le=M.document_count||0;return s.jsxs("button",{className:"field-folder-card",onClick:()=>re(M),children:[s.jsx("div",{className:"field-folder-icon",style:{backgroundColor:`${se}12`},children:s.jsx(K,{size:28,style:{color:se}})}),s.jsxs("div",{className:"field-folder-info",children:[s.jsx("span",{className:"field-folder-name",children:M.name}),s.jsxs("span",{className:"field-folder-count",children:[le," ",le===1?"file":"files"]})]}),s.jsx(mh,{size:20,className:"field-folder-arrow"})]},M.id)})})})}function H_({project:n,companyId:l,onShowToast:i,onExit:o}){const[d,m]=N.useState([]),[h,g]=N.useState(!0),[b,O]=N.useState(null),[H,x]=N.useState({}),[X,re]=N.useState("home"),[F,$]=N.useState(!1),[M,K]=N.useState({crewCheckedIn:!1,crewCount:0,tmTicketsToday:0,dailyReportDone:!1,disposalLoadsToday:0}),[se,le]=N.useState(()=>typeof window<"u"?document.documentElement.getAttribute("data-theme")==="dark":!1),ue=new Date().getHours(),we=ue>=5&&ue<12,xe=ue>=12&&ue<17,Le=ue>=17||ue<5;N.useEffect(()=>{n?.id&&(Me(),Qe())},[n?.id]);const Qe=async()=>{try{const R=new Date().toISOString().split("T")[0],ie=await he.getCrewCheckin(n.id,R),P=ie&&ie.length>0,Ne=(await he.getTMTickets?.(n.id)||[]).filter(qe=>qe.work_date===R),et=await he.getDisposalLoads?.(n.id,R)||[];K({crewCheckedIn:P,crewCount:ie?.length||0,tmTicketsToday:Ne.length,dailyReportDone:!1,disposalLoadsToday:et.length})}catch(R){console.error("Error loading today status:",R)}},Me=async()=>{try{const R=await he.getAreas(n.id);m(R);const ie=[...new Set(R.map(_e=>_e.group_name||"General"))],P={};ie.forEach(_e=>P[_e]=!1),x(P)}catch(R){console.error("Error loading areas:",R),i?.("Error loading areas","error")}finally{g(!1)}},Ie=async(R,ie)=>{const P=d.find(Ne=>Ne.id===R);if(!P)return;const _e=P.status===ie?"not_started":ie;O(R);try{await he.updateAreaStatus(R,_e),m(Ne=>Ne.map(et=>et.id===R?{...et,status:_e}:et))}catch(Ne){console.error("Error updating status:",Ne),i?.("Error updating","error")}finally{O(null)}},Ke=R=>{x(ie=>({...ie,[R]:!ie[R]}))},W=()=>{const R=se?"light":"dark";document.documentElement.setAttribute("data-theme",R),localStorage.setItem("theme",R),le(!se)},ye=x_(d),Ae=d.filter(R=>R.status==="done").length,ve=d.filter(R=>R.status==="working").length,D=d.length-Ae,Q=d.reduce((R,ie)=>{const P=ie.group_name||"General";return R[P]||(R[P]=[]),R[P].push(ie),R},{}),te=Object.keys(Q).length>1||Object.keys(Q).length===1&&!Q.General,G=R=>`${R.filter(P=>P.status==="done").length}/${R.length}`;return X==="tm"?s.jsx("div",{className:"fm-view",children:s.jsx(D_,{project:n,companyId:l,onSubmit:()=>re("home"),onCancel:()=>re("home"),onShowToast:i})}):X==="report"?s.jsx(A_,{project:n,onShowToast:i,onClose:()=>re("home")}):X==="injury"?s.jsx("div",{className:"fm-view",children:s.jsx(k_,{project:n,companyId:l,onClose:()=>re("home"),onReportCreated:()=>{re("home"),i?.("Injury report submitted","success")}})}):X==="crew"?s.jsxs("div",{className:"fm-view",children:[s.jsxs("div",{className:"fm-subheader",children:[s.jsx("button",{className:"fm-back",onClick:()=>re("home"),children:s.jsx(as,{size:20})}),s.jsx("h2",{children:"Crew Check-in"})]}),s.jsx(T_,{project:n,companyId:l,onShowToast:i})]}):X==="disposal"?s.jsxs("div",{className:"fm-view",children:[s.jsxs("div",{className:"fm-subheader",children:[s.jsx("button",{className:"fm-back",onClick:()=>re("home"),children:s.jsx(as,{size:20})}),s.jsx("h2",{children:"Disposal Loads"})]}),s.jsx(z_,{project:n,date:new Date().toISOString().split("T")[0],onShowToast:i})]}):X==="docs"?s.jsxs("div",{className:"fm-view",children:[s.jsxs("div",{className:"fm-subheader",children:[s.jsx("button",{className:"fm-back",onClick:()=>re("home"),children:s.jsx(as,{size:20})}),s.jsx("h2",{children:"Documents"})]}),s.jsx(U_,{projectId:n.id,onShowToast:i})]}):X==="progress"?s.jsxs("div",{className:"fm-view",children:[s.jsxs("div",{className:"fm-subheader",children:[s.jsx("button",{className:"fm-back",onClick:()=>re("home"),children:s.jsx(as,{size:20})}),s.jsx("h2",{children:"Progress"}),s.jsxs("span",{className:"fm-subheader-badge",children:[ye,"%"]})]}),s.jsx("div",{className:"fm-progress-content",children:h?s.jsxs("div",{className:"fm-loading",children:[s.jsx("div",{className:"spinner"}),s.jsx("span",{children:"Loading..."})]}):d.length===0?s.jsxs("div",{className:"fm-empty",children:[s.jsx(Qf,{size:48}),s.jsx("h3",{children:"No tasks yet"}),s.jsx("p",{children:"Office will add tasks to this project"})]}):te?Object.entries(Q).map(([R,ie])=>s.jsxs("div",{className:"fm-group",children:[s.jsxs("button",{className:"fm-group-header",onClick:()=>Ke(R),children:[s.jsxs("div",{className:"fm-group-left",children:[H[R]?s.jsx(uh,{size:18}):s.jsx(mh,{size:18}),s.jsx("span",{children:R})]}),s.jsx("span",{className:"fm-group-count",children:G(ie)})]}),H[R]&&s.jsx("div",{className:"fm-group-items",children:ie.map(P=>s.jsxs("div",{className:`fm-task ${P.status}`,children:[s.jsx("span",{className:"fm-task-name",children:P.name}),s.jsxs("div",{className:"fm-task-btns",children:[s.jsx("button",{className:`fm-status-btn working ${P.status==="working"?"active":""}`,onClick:()=>Ie(P.id,"working"),disabled:b===P.id,children:s.jsx(Ci,{size:14})}),s.jsx("button",{className:`fm-status-btn done ${P.status==="done"?"active":""}`,onClick:()=>Ie(P.id,"done"),disabled:b===P.id,children:s.jsx(al,{size:14})})]})]},P.id))})]},R)):s.jsx("div",{className:"fm-task-list",children:d.map(R=>s.jsxs("div",{className:`fm-task ${R.status}`,children:[s.jsx("span",{className:"fm-task-name",children:R.name}),s.jsxs("div",{className:"fm-task-btns",children:[s.jsx("button",{className:`fm-status-btn working ${R.status==="working"?"active":""}`,onClick:()=>Ie(R.id,"working"),disabled:b===R.id,children:s.jsx(Ci,{size:14})}),s.jsx("button",{className:`fm-status-btn done ${R.status==="done"?"active":""}`,onClick:()=>Ie(R.id,"done"),disabled:b===R.id,children:s.jsx(al,{size:14})})]})]},R.id))})})]}):s.jsxs("div",{className:"fm-view",children:[s.jsxs("div",{className:"fm-header",children:[s.jsx("button",{className:"fm-exit",onClick:o,children:s.jsx(as,{size:20})}),s.jsxs("div",{className:"fm-header-center",children:[s.jsx("h1",{className:"fm-project-name",children:n.name}),s.jsx("button",{className:"fm-info-toggle",onClick:()=>$(!F),children:s.jsx(Zg,{size:16})})]}),s.jsx("button",{className:"fm-theme",onClick:W,children:se?s.jsx(ih,{size:20}):s.jsx(oh,{size:20})})]}),F&&s.jsxs("div",{className:"fm-project-info",children:[n.job_number&&s.jsxs("div",{className:"fm-info-item",children:[s.jsx("span",{children:"Job #"}),s.jsx("span",{children:n.job_number})]}),n.address&&s.jsxs("div",{className:"fm-info-item",children:[s.jsx("span",{children:"Address"}),s.jsx("span",{children:n.address})]}),n.general_contractor&&s.jsxs("div",{className:"fm-info-item",children:[s.jsx("span",{children:"GC"}),s.jsx("span",{children:n.general_contractor})]}),n.client_phone&&s.jsxs("div",{className:"fm-info-item",children:[s.jsx("span",{children:"Phone"}),s.jsx("a",{href:`tel:${n.client_phone}`,children:n.client_phone})]})]}),s.jsxs("div",{className:"fm-progress-bar",children:[s.jsx("div",{className:"fm-progress-fill",style:{width:`${ye}%`}}),s.jsxs("span",{className:"fm-progress-text",children:[ye,"% Complete"]})]}),s.jsxs("div",{className:"fm-stats",children:[s.jsxs("div",{className:"fm-stat",children:[s.jsx("span",{className:"fm-stat-num working",children:ve}),s.jsx("span",{className:"fm-stat-label",children:"Working"})]}),s.jsxs("div",{className:"fm-stat",children:[s.jsx("span",{className:"fm-stat-num done",children:Ae}),s.jsx("span",{className:"fm-stat-label",children:"Done"})]}),s.jsxs("div",{className:"fm-stat",children:[s.jsx("span",{className:"fm-stat-num",children:D}),s.jsx("span",{className:"fm-stat-label",children:"Left"})]})]}),s.jsxs("div",{className:"fm-section",children:[s.jsx("h3",{className:"fm-section-title",children:we?"Good Morning":xe?"Good Afternoon":"Good Evening"}),s.jsxs("div",{className:"fm-smart-cards",children:[s.jsxs("button",{className:`fm-smart-card ${M.crewCheckedIn?"completed":we?"priority":""}`,onClick:()=>re("crew"),children:[s.jsx("div",{className:"fm-smart-card-icon",children:s.jsx(Kg,{size:24})}),s.jsxs("div",{className:"fm-smart-card-content",children:[s.jsx("span",{className:"fm-smart-card-title",children:"Crew Check-in"}),s.jsx("span",{className:"fm-smart-card-status",children:M.crewCheckedIn?`${M.crewCount} checked in`:"Not done yet"})]}),M.crewCheckedIn&&s.jsx("div",{className:"fm-smart-card-check",children:s.jsx(Ca,{size:20})})]}),s.jsxs("button",{className:`fm-smart-card ${M.tmTicketsToday>0?"has-activity":""}`,onClick:()=>re("tm"),children:[s.jsx("div",{className:"fm-smart-card-icon",children:s.jsx(rs,{size:24})}),s.jsxs("div",{className:"fm-smart-card-content",children:[s.jsx("span",{className:"fm-smart-card-title",children:"T&M Ticket"}),s.jsx("span",{className:"fm-smart-card-status",children:M.tmTicketsToday>0?`${M.tmTicketsToday} today`:"Create new"})]}),M.tmTicketsToday>0&&s.jsx("div",{className:"fm-smart-card-badge",children:M.tmTicketsToday})]}),s.jsxs("button",{className:`fm-smart-card ${M.dailyReportDone?"completed":Le?"priority":""}`,onClick:()=>re("report"),children:[s.jsx("div",{className:"fm-smart-card-icon",children:s.jsx(dh,{size:24})}),s.jsxs("div",{className:"fm-smart-card-content",children:[s.jsx("span",{className:"fm-smart-card-title",children:"Daily Report"}),s.jsx("span",{className:"fm-smart-card-status",children:M.dailyReportDone?"Submitted":Le?"Ready to submit":"End of day"})]}),M.dailyReportDone&&s.jsx("div",{className:"fm-smart-card-check",children:s.jsx(Ca,{size:20})})]})]})]}),s.jsxs("div",{className:"fm-section",children:[s.jsx("h3",{className:"fm-section-title",children:"More Actions"}),s.jsxs("div",{className:"fm-secondary-actions",children:[s.jsxs("button",{className:"fm-action-row",onClick:()=>re("progress"),children:[s.jsx(Qf,{size:20}),s.jsx("span",{children:"Update Progress"}),s.jsxs("span",{className:"fm-action-badge",children:[D," left"]})]}),s.jsxs("button",{className:"fm-action-row",onClick:()=>re("disposal"),children:[s.jsx(Wc,{size:20}),s.jsx("span",{children:"Disposal Loads"}),M.disposalLoadsToday>0&&s.jsxs("span",{className:"fm-action-badge",children:[M.disposalLoadsToday," today"]})]}),s.jsxs("button",{className:"fm-action-row",onClick:()=>re("docs"),children:[s.jsx(Jg,{size:20}),s.jsx("span",{children:"Documents"})]})]})]}),s.jsx("div",{className:"fm-section",children:s.jsxs("button",{className:"fm-action-row danger",onClick:()=>re("injury"),children:[s.jsx(Di,{size:20}),s.jsx("span",{children:"Report Injury"})]})})]})}const L_=N.lazy(()=>sr(()=>import("./Dashboard-CI_COe-0.js").then(n=>n.ao),__vite__mapDeps([6,3,1,2,7]))),B_=N.lazy(()=>sr(()=>import("./Setup-Cqwt7kNa.js"),__vite__mapDeps([8,3,1,2,4]))),Y_=N.lazy(()=>sr(()=>import("./BrandingSettings-D7uCxP-R.js"),__vite__mapDeps([9,1,2,3,4]))),G_=N.lazy(()=>sr(()=>import("./PricingManager-CboiK1Nm.js"),__vite__mapDeps([10,1,2,3,4]))),Q_=N.lazy(()=>sr(()=>import("./PublicView-CClRK6vh.js"),__vite__mapDeps([11,1,2,3,4]))),X_=N.lazy(()=>sr(()=>import("./SignaturePage-xBem7Os3.js"),__vite__mapDeps([12,1,2,7,3,4]))),V_=N.lazy(()=>sr(()=>import("./MembershipManager-DJ_mJtBS.js"),__vite__mapDeps([13,1,2,3,4])));function Fc(){return s.jsxs("div",{className:"page-loader",children:[s.jsx(wa,{className:"loading-logo"}),s.jsx("div",{className:"spinner"})]})}function Z_(){const[n,l]=N.useState("entry"),[i,o]=N.useState(null),[d,m]=N.useState(null),[h,g]=N.useState([]),[b,O]=N.useState([]),[H,x]=N.useState(null),[X,re]=N.useState(null),[F,$]=N.useState(null),[M,K]=N.useState(!0),[se,le]=N.useState("dashboard"),[ue,we]=N.useState(null),[xe,Le]=N.useState(!1),[Qe,Me]=N.useState(!1),[Ie,Ke]=N.useState(null),[W,ye]=N.useState(0),Ae=N.useCallback(async()=>{try{if(!v){K(!1);return}const{data:{user:ee}}=await y.auth.getUser();if(!ee){K(!1);return}const{data:je}=await y.from("users").select("*").eq("id",ee.id).single();if(je){o(je);let Te=await he.getUserCompanies(ee.id);if(Te.length===0&&je.company_id&&await he.repairLegacyUser(ee.id,je.company_id,je.role||"member")&&(Te=await he.getUserCompanies(ee.id)),g(Te),Te.length===0){if(await he.getUserPendingMemberships(ee.id)>0){l("pending");return}we({message:"No company access. Join a company to continue.",type:"error"}),await nu.signOut();return}const tt=localStorage.getItem("selectedCompanyId");let We=null;if(tt&&Te.find(lt=>lt.id===tt)?We=Te.find(lt=>lt.id===tt):Te.length>0&&(We=Te[0]),We){const{data:lt}=await y.from("companies").select("*").eq("id",We.id).single();m(lt),l("office")}}}catch(ee){console.error("Auth check error:",ee)}finally{K(!1)}},[]);N.useEffect(()=>{const ee=window.location.pathname,je=ee.match(/^\/view\/([a-zA-Z0-9_-]+)$/),Te=ee.match(/^\/sign\/([a-zA-Z0-9_-]+)$/);je?(re(je[1]),l("public"),K(!1)):Te?($(Te[1]),l("signature"),K(!1)):Ae()},[Ae]),N.useEffect(()=>{if(!v)return;const{data:{subscription:ee}}=y.auth.onAuthStateChange(async(je,Te)=>{je==="SIGNED_OUT"||je==="USER_DELETED"?(o(null),m(null),g([]),l("entry")):je==="TOKEN_REFRESHED"||je==="SIGNED_IN"&&!i&&Ae()});return()=>{ee?.unsubscribe()}},[i,Ae]);const ve=ee=>{x(ee),l("foreman")},D=async(ee,je)=>{try{await tu();const{data:Te,error:tt}=await y.auth.signInWithPassword({email:ee,password:je});if(tt){R(tt.message||"Invalid credentials","error");return}const{data:We,error:lt}=await y.from("users").select("*").eq("id",Te.user.id).single();if(lt){console.error("User fetch error:",lt),R("Error loading profile","error");return}if(We){o(We);let it=await he.getUserCompanies(Te.user.id);it.length===0&&We.company_id&&await he.repairLegacyUser(Te.user.id,We.company_id,We.role||"member")&&(it=await he.getUserCompanies(Te.user.id)),g(it);const Ht=localStorage.getItem("selectedCompanyId");let dt=null;if(Ht&&it.find(St=>St.id===Ht)?dt=it.find(St=>St.id===Ht):it.length>0&&(dt=it[0]),dt){const{data:St}=await y.from("companies").select("*").eq("id",dt.id).single();m(St),l("office")}else await he.getUserPendingMemberships(Te.user.id)>0?l("pending"):R("No company access. Please contact admin.","error")}else R("Profile not found. Please contact admin.","error")}catch(Te){console.error("Login error:",Te),R("Login failed","error")}},Q=async ee=>{try{const{data:je}=await y.from("companies").select("*").eq("id",ee).single();je&&(m(je),localStorage.setItem("selectedCompanyId",ee),Le(!1),le("dashboard"),R(`Switched to ${je.name}`,"success"))}catch(je){console.error("Switch company error:",je),R("Error switching company","error")}},te=async()=>{try{await nu.signOut(),o(null),m(null),g([]),l("entry"),le("dashboard"),localStorage.removeItem("selectedCompanyId")}catch(ee){console.error("Logout error:",ee),R("Error signing out","error")}},G=async()=>{await tu(),x(null),l("entry")},R=N.useCallback((ee,je="")=>{we({message:ee,type:je})},[]),ie=()=>{le("dashboard"),d?.id&&P()},P=async()=>{if(d?.id)try{const ee=await he.getProjects(d.id);O(ee)}catch(ee){console.error("Error loading projects:",ee)}};N.useEffect(()=>{d?.id&&n==="office"&&(P(),_e())},[d?.id,n]);const _e=async()=>{if(d?.id)try{const je=(await he.getCompanyMemberships(d.id)).filter(Te=>Te.status==="pending").length;ye(je)}catch(ee){console.error("Error loading pending count:",ee)}},Ne=N.useCallback(()=>{Ke(null)},[]);if(M)return s.jsx(hn,{children:s.jsx(fn,{companyId:d?.id,children:s.jsxs("div",{className:"loading-screen",children:[s.jsx(wa,{className:"loading-logo"}),s.jsx("div",{className:"spinner"})]})})});if(n==="entry")return s.jsx(hn,{children:s.jsxs(fn,{children:[s.jsx(ts,{children:s.jsx(w_,{onForemanAccess:ve,onOfficeLogin:D,onShowToast:R})}),ue&&s.jsx(pn,{message:ue.message,type:ue.type,onClose:()=>we(null)})]})});if(n==="public"&&X)return s.jsx(hn,{children:s.jsxs(fn,{children:[s.jsx(ts,{children:s.jsx(N.Suspense,{fallback:s.jsx(Fc,{}),children:s.jsx(Q_,{shareToken:X})})}),ue&&s.jsx(pn,{message:ue.message,type:ue.type,onClose:()=>we(null)})]})});if(n==="signature"&&F)return s.jsx(hn,{children:s.jsxs(fn,{children:[s.jsx(ts,{children:s.jsx(N.Suspense,{fallback:s.jsx(Fc,{}),children:s.jsx(X_,{signatureToken:F})})}),ue&&s.jsx(pn,{message:ue.message,type:ue.type,onClose:()=>we(null)})]})});if(n==="pending")return s.jsx(hn,{children:s.jsxs(fn,{children:[s.jsx(ts,{children:s.jsxs("div",{className:"pending-approval-screen",children:[s.jsx(wa,{className:"pending-logo"}),s.jsx("h2",{children:"Awaiting Approval"}),s.jsx("p",{children:"Your membership request has been submitted."}),s.jsx("p",{children:"A company admin will review your request."}),s.jsxs("div",{className:"pending-actions",children:[s.jsx("button",{className:"btn btn-secondary",onClick:te,children:"Sign Out"}),s.jsx("button",{className:"btn btn-primary",onClick:Ae,children:"Check Status"})]})]})}),ue&&s.jsx(pn,{message:ue.message,type:ue.type,onClose:()=>we(null)})]})});if(n==="foreman"&&H)return s.jsx(hn,{children:s.jsxs(fn,{companyId:H.company_id,children:[s.jsx(ts,{children:s.jsx(H_,{project:H,companyId:H.company_id,onShowToast:R,onExit:G})}),s.jsx(rh,{}),ue&&s.jsx(pn,{message:ue.message,type:ue.type,onClose:()=>we(null)})]})});const J=h.find(ee=>ee.id===d?.id)?.access_level==="administrator"||d?.owner_user_id===i?.id;return s.jsx(hn,{children:s.jsx(fn,{companyId:d?.id,children:s.jsxs("div",{children:[!v&&s.jsx("div",{className:"demo-banner",children:"Demo Mode - Data saved locally in your browser"}),s.jsx("nav",{className:"nav",children:s.jsxs("div",{className:"nav-content",children:[s.jsx(wa,{}),s.jsxs("div",{className:"nav-tabs nav-tabs-desktop",children:[s.jsx("button",{className:`nav-tab ${se==="dashboard"?"active":""}`,onClick:()=>le("dashboard"),children:"Dashboard"}),s.jsx("button",{className:`nav-tab ${se==="setup"?"active":""}`,onClick:()=>le("setup"),children:"+ New Project"}),s.jsx("button",{className:`nav-tab ${se==="pricing"?"active":""}`,onClick:()=>le("pricing"),children:"Pricing"}),J&&s.jsx("button",{className:`nav-tab ${se==="branding"?"active":""}`,onClick:()=>le("branding"),children:"Branding"}),J&&s.jsxs("button",{className:`nav-tab ${se==="team"?"active":""}`,onClick:()=>le("team"),children:["Team",W>0&&s.jsx("span",{className:"nav-tab-badge",children:W})]})]}),s.jsxs("div",{className:"nav-user nav-user-desktop",children:[s.jsx(ah,{compact:!0}),s.jsxs("div",{className:"mobile-menu",children:[s.jsx("button",{className:"mobile-menu-btn",onClick:()=>Me(!Qe),"aria-label":"User menu",children:""}),Qe&&s.jsxs("div",{className:"mobile-menu-dropdown",children:[s.jsxs("div",{className:"mobile-menu-info",children:[s.jsx("div",{className:"mobile-menu-user",children:i?.name||i?.email}),d&&s.jsx("div",{className:"mobile-menu-company",children:d.name})]}),s.jsx("button",{className:"mobile-menu-logout",onClick:()=>{Me(!1),te()},children:"Sign Out"})]})]}),h.length>1&&s.jsxs("div",{className:"company-switcher",children:[s.jsxs("button",{className:"company-switcher-btn",onClick:()=>Le(!xe),children:[d?.name||"Select Company",s.jsx("span",{className:"switcher-arrow",children:""})]}),xe&&s.jsx("div",{className:"company-dropdown",children:h.map(ee=>s.jsxs("button",{className:`company-option ${ee.id===d?.id?"active":""}`,onClick:()=>Q(ee.id),children:[ee.name,ee.id===d?.id&&s.jsx("span",{className:"check",children:""})]},ee.id))})]}),h.length<=1&&d&&s.jsx("span",{className:"nav-company-name",children:d.name}),s.jsx("span",{className:"nav-user-name",children:i?.name||i?.email}),s.jsx("button",{className:"nav-logout",onClick:te,children:"Sign Out"})]}),s.jsx("button",{className:"mobile-menu-btn",onClick:()=>Me(!0),"aria-label":"Open menu",children:s.jsxs("span",{className:"hamburger-icon",children:[s.jsx("span",{}),s.jsx("span",{}),s.jsx("span",{})]})})]})}),Qe&&s.jsx("div",{className:"mobile-drawer-overlay",onClick:()=>Me(!1),children:s.jsxs("div",{className:"mobile-drawer",onClick:ee=>ee.stopPropagation(),children:[s.jsxs("div",{className:"mobile-drawer-header",children:[s.jsx(wa,{}),s.jsx("button",{className:"mobile-drawer-close",onClick:()=>Me(!1),"aria-label":"Close menu",children:""})]}),s.jsxs("div",{className:"mobile-drawer-user",children:[s.jsx("div",{className:"mobile-user-avatar",children:(i?.name||i?.email||"U")[0].toUpperCase()}),s.jsxs("div",{className:"mobile-user-info",children:[s.jsx("span",{className:"mobile-user-name",children:i?.name||i?.email}),s.jsx("span",{className:"mobile-user-company",children:d?.name})]})]}),h.length>1&&s.jsxs("div",{className:"mobile-drawer-section",children:[s.jsx("div",{className:"mobile-section-title",children:"Switch Company"}),s.jsx("div",{className:"mobile-company-list",children:h.map(ee=>s.jsxs("button",{className:`mobile-company-option ${ee.id===d?.id?"active":""}`,onClick:()=>{Q(ee.id),Me(!1)},children:[s.jsx("span",{className:"mobile-company-name",children:ee.name}),ee.id===d?.id&&s.jsx("span",{className:"mobile-company-check",children:""})]},ee.id))})]}),s.jsxs("div",{className:"mobile-drawer-section",children:[s.jsx("div",{className:"mobile-section-title",children:"Navigation"}),s.jsxs("div",{className:"mobile-nav-list",children:[s.jsx("button",{className:`mobile-nav-item ${se==="dashboard"?"active":""}`,onClick:()=>{le("dashboard"),Me(!1)},children:"Dashboard"}),s.jsx("button",{className:`mobile-nav-item ${se==="setup"?"active":""}`,onClick:()=>{le("setup"),Me(!1)},children:"+ New Project"}),s.jsx("button",{className:`mobile-nav-item ${se==="pricing"?"active":""}`,onClick:()=>{le("pricing"),Me(!1)},children:"Pricing"}),J&&s.jsx("button",{className:`mobile-nav-item ${se==="branding"?"active":""}`,onClick:()=>{le("branding"),Me(!1)},children:"Branding"}),J&&s.jsxs("button",{className:`mobile-nav-item ${se==="team"?"active":""}`,onClick:()=>{le("team"),Me(!1)},children:["Team",W>0&&s.jsx("span",{className:"mobile-nav-badge",children:W})]})]})]}),s.jsxs("div",{className:"mobile-drawer-section",children:[s.jsx("div",{className:"mobile-section-title",children:"Appearance"}),s.jsx("div",{className:"mobile-theme-toggle",children:s.jsx(ah,{})})]}),s.jsx("div",{className:"mobile-drawer-footer",children:s.jsx("button",{className:"mobile-logout-btn",onClick:()=>{te(),Me(!1)},children:"Sign Out"})})]})}),s.jsx(ts,{children:s.jsx(N.Suspense,{fallback:s.jsx(Fc,{}),children:s.jsxs("div",{className:"container",children:[se==="dashboard"&&s.jsx(L_,{company:d,user:i,isAdmin:J,onShowToast:R,navigateToProjectId:Ie,onProjectNavigated:Ne}),se==="setup"&&s.jsx(B_,{company:d,user:i,onProjectCreated:ie,onShowToast:R}),se==="pricing"&&s.jsx(G_,{company:d,onShowToast:R}),se==="branding"&&s.jsx(Y_,{company:d,onShowToast:R}),se==="team"&&J&&s.jsx(V_,{company:d,user:i,onShowToast:R})]},d?.id)})}),s.jsx(rh,{}),ue&&s.jsx(pn,{message:ue.message,type:ue.type,onClose:()=>we(null)})]})})})}l_.createRoot(document.getElementById("root")).render(s.jsx(Fg.StrictMode,{children:s.jsx(Z_,{})}));"serviceWorker"in navigator&&(window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(n=>{setInterval(()=>{n.update().catch(l=>console.debug("[SW] Update check failed:",l.message))},3e5)}).catch(n=>{console.debug("[SW] Registration failed:",n.message)})}),navigator.serviceWorker.addEventListener("message",n=>{n.data?.type==="SW_UPDATED"&&(console.log("[App] Service worker updated, reloading for fresh assets..."),window.location.reload()),n.data?.type==="ASSET_NOT_FOUND"&&(console.warn("[App] Asset not found:",n.data.url,"- reloading..."),"caches"in window?caches.keys().then(l=>{l.forEach(i=>caches.delete(i))}).finally(()=>{window.location.reload()}):window.location.reload())}));export{U_ as F,k_ as I,wa as L,pn as T,v_ as a,ey as b,I_ as c,he as d,y_ as e,P_ as f,S_ as g,ty as h,y as i,s as j,ry as k,N_ as l,ny as m,W_ as n,De as o,ay as s,b_ as u};
//# sourceMappingURL=index-uZP3HUvR.js.map
