import{as as e,ar as $}from"./index-Dq4629GT.js";import{r as n,X as I,F as X,H as Y,W as _,i as O,ab as A,B as G,aG as L,as as J,R as Q,b as K}from"./icons-BDU0tZd_.js";import"./react-DXGY7bZi.js";import"./pdf-Dbgi5wV4.js";import"./supabase-VuevzHjS.js";const E=d=>{if(!d)return"";const[l,i]=d.split(":"),g=parseInt(l),j=g>=12?"pm":"am";return`${g%12||12}:${i}${j}`};function te({ticketId:d,ticketSummary:l,ticketDetails:i,lang:g="en",onSave:j,onClose:h,onShowToast:u}){const c=n.useRef(null),[o,k]=n.useState(""),[p,H]=n.useState(""),[v,R]=n.useState(""),[x,y]=n.useState(!1),[q,C]=n.useState(!1),[N,w]=n.useState(!1),S={en:{title:"Client Signature",subtitle:"Sign to verify the work performed",signerName:"Your Name",signerNamePlaceholder:"Full name",signerTitle:"Title",signerTitlePlaceholder:"e.g. Project Manager",signerCompany:"Company",signerCompanyPlaceholder:"Company name",signBelow:"Sign below",signHere:"Sign here",clear:"Clear",cancel:"Cancel",saveSignature:"Submit Signature",saving:"Saving...",workDate:"Work Date",workers:"Workers",hours:"Total Hours",project:"Project",description:"Description",workerDetails:"Worker Details",name:"Name",role:"Role",time:"Time",regHrs:"Reg Hrs",ot:"OT",materialsEquipment:"Materials & Equipment",item:"Item",qty:"Qty",unit:"Unit",photos:"Photos",ticketDetails:"Ticket Details",showDetails:"Show Full Details",hideDetails:"Hide Details",certification:"By signing, I acknowledge that the work described in this Time & Material ticket was performed as documented.",nameRequired:"Please enter your name",signatureRequired:"Please sign above",signatureSaved:"Signature saved successfully",signatureError:"Error saving signature"},es:{title:"Firma del Cliente",subtitle:"Firme para verificar el trabajo realizado",signerName:"Su Nombre",signerNamePlaceholder:"Nombre completo",signerTitle:"Titulo",signerTitlePlaceholder:"ej. Gerente de Proyecto",signerCompany:"Empresa",signerCompanyPlaceholder:"Nombre de la empresa",signBelow:"Firme abajo",signHere:"Firme aqui",clear:"Borrar",cancel:"Cancelar",saveSignature:"Enviar Firma",saving:"Guardando...",workDate:"Fecha",workers:"Trabajadores",hours:"Horas Total",project:"Proyecto",description:"Descripcion",workerDetails:"Detalle de Trabajadores",name:"Nombre",role:"Rol",time:"Hora",regHrs:"Hrs Reg",ot:"HE",materialsEquipment:"Materiales y Equipo",item:"Articulo",qty:"Cant",unit:"Unidad",photos:"Fotos",ticketDetails:"Detalles del Ticket",showDetails:"Mostrar Detalles Completos",hideDetails:"Ocultar Detalles",certification:"Al firmar, reconozco que el trabajo descrito en este ticket de Tiempo y Material fue realizado como se documenta.",nameRequired:"Por favor ingrese su nombre",signatureRequired:"Por favor firme arriba",signatureSaved:"Firma guardada exitosamente",signatureError:"Error al guardar la firma"}},a=S[g]||S.en,b=()=>{const s=c.current;return s?s.getContext("2d"):null},T=s=>{const t=c.current;if(!t)return{x:0,y:0};const r=t.getBoundingClientRect(),m=t.width/r.width,B=t.height/r.height,U=s.touches?.length?s.touches[0].clientX:s.clientX,W=s.touches?.length?s.touches[0].clientY:s.clientY;return{x:(U-r.left)*m,y:(W-r.top)*B}},P=s=>{s.preventDefault();const t=b();if(!t)return;const{x:r,y:m}=T(s);t.beginPath(),t.moveTo(r,m),C(!0),y(!0)},D=s=>{if(!q)return;s.preventDefault();const t=b();if(!t)return;const{x:r,y:m}=T(s);t.lineTo(r,m),t.stroke()},f=()=>{C(!1)},z=()=>{const s=c.current,t=b();!s||!t||(t.clearRect(0,0,s.width,s.height),y(!1))},M=s=>{if(!s)return;c.current=s;const t=s.getContext("2d");t.strokeStyle="#1e293b",t.lineWidth=2,t.lineCap="round",t.lineJoin="round"},F=async()=>{if(!o.trim()){u?.(a.nameRequired,"error");return}if(!x){u?.(a.signatureRequired,"error");return}const s=c.current;if(s){w(!0);try{const t=s.toDataURL("image/png");await $.saveTMClientSignature(d,{signature:t,signerName:o.trim(),signerTitle:p.trim()||null,signerCompany:v.trim()||null,signedAt:new Date().toISOString()}),u?.(a.signatureSaved,"success"),j?.({signerName:o.trim(),signerTitle:p.trim(),signerCompany:v.trim()})}catch(t){console.error("Error saving signature:",t),u?.(a.signatureError,"error")}finally{w(!1)}}};return e.jsx("div",{className:"tm-modal-overlay",onClick:h,children:e.jsxs("div",{className:"tm-client-signature-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"tm-sig-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:a.title}),e.jsx("p",{className:"tm-sig-subtitle",children:a.subtitle})]}),e.jsx("button",{className:"tm-sig-close",onClick:h,children:e.jsx(I,{size:20})})]}),e.jsxs("div",{className:"tm-sig-body",children:[l&&e.jsxs("div",{className:"tm-sig-summary",children:[e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:a.workDate}),e.jsx("span",{className:"tm-sig-summary-value",children:new Date(l.workDate).toLocaleDateString()})]}),e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:a.workers}),e.jsx("span",{className:"tm-sig-summary-value",children:l.workerCount})]}),e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:a.hours}),e.jsx("span",{className:"tm-sig-summary-value",children:l.totalHours})]})]}),i&&e.jsxs("div",{className:"tm-sig-details",children:[i.projectName&&e.jsxs("div",{className:"tm-sig-detail-row",children:[e.jsx("span",{className:"tm-sig-detail-label",children:a.project}),e.jsx("span",{className:"tm-sig-detail-value",children:i.projectName})]}),i.cePcoNumber&&e.jsxs("div",{className:"tm-sig-detail-row",children:[e.jsx("span",{className:"tm-sig-detail-label",children:"CE/PCO"}),e.jsx("span",{className:"tm-sig-detail-value",children:i.cePcoNumber})]}),i.notes&&e.jsxs("div",{className:"tm-sig-detail-row tm-sig-detail-full",children:[e.jsxs("span",{className:"tm-sig-detail-label",children:[e.jsx(X,{size:14})," ",a.description]}),e.jsx("span",{className:"tm-sig-detail-value tm-sig-notes",children:i.notes})]}),i.workers?.length>0&&e.jsxs("div",{className:"tm-sig-detail-section",children:[e.jsxs("h4",{className:"tm-sig-section-title",children:[e.jsx(Y,{size:15})," ",a.workerDetails]}),e.jsxs("table",{className:"tm-sig-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a.name}),e.jsx("th",{children:a.role}),e.jsx("th",{children:a.time}),e.jsx("th",{children:a.regHrs}),e.jsx("th",{children:a.ot})]})}),e.jsx("tbody",{children:i.workers.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),e.jsx("td",{children:s.role||"-"}),e.jsx("td",{children:s.time_started&&s.time_ended?`${E(s.time_started)}-${E(s.time_ended)}`:"-"}),e.jsx("td",{children:s.hours||0}),e.jsx("td",{children:s.overtime_hours||"-"})]},t))})]})]}),i.items?.length>0&&e.jsxs("div",{className:"tm-sig-detail-section",children:[e.jsxs("h4",{className:"tm-sig-section-title",children:[e.jsx(_,{size:15})," ",a.materialsEquipment]}),e.jsxs("table",{className:"tm-sig-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:a.item}),e.jsx("th",{children:a.qty}),e.jsx("th",{children:a.unit})]})}),e.jsx("tbody",{children:i.items.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),e.jsx("td",{children:s.quantity}),e.jsx("td",{children:s.unit})]},t))})]})]}),i.photos?.length>0&&e.jsxs("div",{className:"tm-sig-detail-section",children:[e.jsxs("h4",{className:"tm-sig-section-title",children:[e.jsx(O,{size:15})," ",a.photos," (",i.photos.length,")"]}),e.jsx("div",{className:"tm-sig-photo-grid",children:i.photos.map((s,t)=>e.jsx("div",{className:"tm-sig-photo-thumb",children:e.jsx("img",{src:typeof s=="string"?s:s.previewUrl||s.url,alt:`Photo ${t+1}`,onError:r=>{r.target.style.display="none"}})},t))})]})]}),e.jsxs("div",{className:"tm-sig-fields",children:[e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(A,{size:14}),a.signerName," *"]}),e.jsx("input",{type:"text",value:o,onChange:s=>k(s.target.value),placeholder:a.signerNamePlaceholder})]}),e.jsxs("div",{className:"tm-sig-field-row",children:[e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(G,{size:14}),a.signerTitle]}),e.jsx("input",{type:"text",value:p,onChange:s=>H(s.target.value),placeholder:a.signerTitlePlaceholder})]}),e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(L,{size:14}),a.signerCompany]}),e.jsx("input",{type:"text",value:v,onChange:s=>R(s.target.value),placeholder:a.signerCompanyPlaceholder})]})]})]}),e.jsxs("div",{className:"tm-sig-area",children:[e.jsxs("div",{className:"tm-sig-label",children:[e.jsx(J,{size:14}),e.jsx("span",{children:a.signBelow})]}),e.jsxs("div",{className:"tm-sig-canvas-container",children:[e.jsx("canvas",{ref:M,width:500,height:180,className:"tm-sig-canvas",onMouseDown:P,onMouseMove:D,onMouseUp:f,onMouseLeave:f,onTouchStart:P,onTouchMove:D,onTouchEnd:f}),!x&&e.jsx("div",{className:"tm-sig-placeholder",children:a.signHere})]}),e.jsxs("button",{className:"tm-sig-clear",onClick:z,disabled:!x,children:[e.jsx(Q,{size:14})," ",a.clear]})]}),e.jsx("p",{className:"tm-sig-certification",children:a.certification})]}),e.jsxs("div",{className:"tm-sig-footer",children:[e.jsx("button",{className:"tm-sig-btn secondary",onClick:h,disabled:N,children:a.cancel}),e.jsx("button",{className:"tm-sig-btn primary",onClick:F,disabled:!x||!o.trim()||N,children:N?a.saving:e.jsxs(e.Fragment,{children:[e.jsx(K,{size:16})," ",a.saveSignature]})})]})]})})}export{te as default};
//# sourceMappingURL=TMClientSignature-Ctqb8RcC.js.map
