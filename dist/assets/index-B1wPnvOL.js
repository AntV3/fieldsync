const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/corPdfGenerator-BJpfHtgs.js","assets/pdf-CMoXWuLx.js","assets/react-DXGY7bZi.js","assets/supabase-VuevzHjS.js","assets/xlsx-BTp1RmNK.js"])))=>i.map(i=>d[i]);
import{r as lf,a as cf,b as Ux}from"./react-DXGY7bZi.js";import{c as Hx}from"./supabase-VuevzHjS.js";import{u as fn,w as Bx,r as $x}from"./xlsx-BTp1RmNK.js";import{E as Sl,a as vs,_ as ld}from"./pdf-CMoXWuLx.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))i(d);new MutationObserver(d=>{for(const h of d)if(h.type==="childList")for(const g of h.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function c(d){const h={};return d.integrity&&(h.integrity=d.integrity),d.referrerPolicy&&(h.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?h.credentials="include":d.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(d){if(d.ep)return;d.ep=!0;const h=c(d);fetch(d.href,h)}})();var id={exports:{}},vl={};var Ep;function Px(){if(Ep)return vl;Ep=1;var r=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function c(i,d,h){var g=null;if(h!==void 0&&(g=""+h),d.key!==void 0&&(g=""+d.key),"key"in d){h={};for(var p in d)p!=="key"&&(h[p]=d[p])}else h=d;return d=h.ref,{$$typeof:r,type:i,key:g,ref:d!==void 0?d:null,props:h}}return vl.Fragment=l,vl.jsx=c,vl.jsxs=c,vl}var Dp;function Vx(){return Dp||(Dp=1,id.exports=Px()),id.exports}var e=Vx(),x=lf();const Gx=cf(x);var cd={exports:{}},yl={},od={exports:{}},dd={};var Tp;function Yx(){return Tp||(Tp=1,(function(r){function l(T,ee){var k=T.length;T.push(ee);e:for(;0<k;){var pe=k-1>>>1,D=T[pe];if(0<d(D,ee))T[pe]=ee,T[k]=D,k=pe;else break e}}function c(T){return T.length===0?null:T[0]}function i(T){if(T.length===0)return null;var ee=T[0],k=T.pop();if(k!==ee){T[0]=k;e:for(var pe=0,D=T.length,z=D>>>1;pe<z;){var se=2*(pe+1)-1,Z=T[se],ne=se+1,F=T[ne];if(0>d(Z,k))ne<D&&0>d(F,Z)?(T[pe]=F,T[ne]=k,pe=ne):(T[pe]=Z,T[se]=k,pe=se);else if(ne<D&&0>d(F,k))T[pe]=F,T[ne]=k,pe=ne;else break e}}return ee}function d(T,ee){var k=T.sortIndex-ee.sortIndex;return k!==0?k:T.id-ee.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var h=performance;r.unstable_now=function(){return h.now()}}else{var g=Date,p=g.now();r.unstable_now=function(){return g.now()-p}}var y=[],m=[],v=1,A=null,_=3,j=!1,$=!1,C=!1,U=!1,X=typeof setTimeout=="function"?setTimeout:null,V=typeof clearTimeout=="function"?clearTimeout:null,q=typeof setImmediate<"u"?setImmediate:null;function E(T){for(var ee=c(m);ee!==null;){if(ee.callback===null)i(m);else if(ee.startTime<=T)i(m),ee.sortIndex=ee.expirationTime,l(y,ee);else break;ee=c(m)}}function W(T){if(C=!1,E(T),!$)if(c(y)!==null)$=!0,ue||(ue=!0,b());else{var ee=c(m);ee!==null&&me(W,ee.startTime-T)}}var ue=!1,ae=-1,Y=5,P=-1;function ce(){return U?!0:!(r.unstable_now()-P<Y)}function M(){if(U=!1,ue){var T=r.unstable_now();P=T;var ee=!0;try{e:{$=!1,C&&(C=!1,V(ae),ae=-1),j=!0;var k=_;try{t:{for(E(T),A=c(y);A!==null&&!(A.expirationTime>T&&ce());){var pe=A.callback;if(typeof pe=="function"){A.callback=null,_=A.priorityLevel;var D=pe(A.expirationTime<=T);if(T=r.unstable_now(),typeof D=="function"){A.callback=D,E(T),ee=!0;break t}A===c(y)&&i(y),E(T)}else i(y);A=c(y)}if(A!==null)ee=!0;else{var z=c(m);z!==null&&me(W,z.startTime-T),ee=!1}}break e}finally{A=null,_=k,j=!1}ee=void 0}}finally{ee?b():ue=!1}}}var b;if(typeof q=="function")b=function(){q(M)};else if(typeof MessageChannel<"u"){var R=new MessageChannel,B=R.port2;R.port1.onmessage=M,b=function(){B.postMessage(null)}}else b=function(){X(M,0)};function me(T,ee){ae=X(function(){T(r.unstable_now())},ee)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(T){T.callback=null},r.unstable_forceFrameRate=function(T){0>T||125<T?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Y=0<T?Math.floor(1e3/T):5},r.unstable_getCurrentPriorityLevel=function(){return _},r.unstable_next=function(T){switch(_){case 1:case 2:case 3:var ee=3;break;default:ee=_}var k=_;_=ee;try{return T()}finally{_=k}},r.unstable_requestPaint=function(){U=!0},r.unstable_runWithPriority=function(T,ee){switch(T){case 1:case 2:case 3:case 4:case 5:break;default:T=3}var k=_;_=T;try{return ee()}finally{_=k}},r.unstable_scheduleCallback=function(T,ee,k){var pe=r.unstable_now();switch(typeof k=="object"&&k!==null?(k=k.delay,k=typeof k=="number"&&0<k?pe+k:pe):k=pe,T){case 1:var D=-1;break;case 2:D=250;break;case 5:D=1073741823;break;case 4:D=1e4;break;default:D=5e3}return D=k+D,T={id:v++,callback:ee,priorityLevel:T,startTime:k,expirationTime:D,sortIndex:-1},k>pe?(T.sortIndex=k,l(m,T),c(y)===null&&T===c(m)&&(C?(V(ae),ae=-1):C=!0,me(W,k-pe))):(T.sortIndex=D,l(y,T),$||j||($=!0,ue||(ue=!0,b()))),T},r.unstable_shouldYield=ce,r.unstable_wrapCallback=function(T){var ee=_;return function(){var k=_;_=ee;try{return T.apply(this,arguments)}finally{_=k}}}})(dd)),dd}var Mp;function Ix(){return Mp||(Mp=1,od.exports=Yx()),od.exports}var zp;function Qx(){if(zp)return yl;zp=1;var r=Ix(),l=lf(),c=Ux();function i(t){var a="https://react.dev/errors/"+t;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)a+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+t+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function d(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function h(t){var a=t,s=t;if(t.alternate)for(;a.return;)a=a.return;else{t=a;do a=t,(a.flags&4098)!==0&&(s=a.return),t=a.return;while(t)}return a.tag===3?s:null}function g(t){if(t.tag===13){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function p(t){if(t.tag===31){var a=t.memoizedState;if(a===null&&(t=t.alternate,t!==null&&(a=t.memoizedState)),a!==null)return a.dehydrated}return null}function y(t){if(h(t)!==t)throw Error(i(188))}function m(t){var a=t.alternate;if(!a){if(a=h(t),a===null)throw Error(i(188));return a!==t?null:t}for(var s=t,n=a;;){var o=s.return;if(o===null)break;var u=o.alternate;if(u===null){if(n=o.return,n!==null){s=n;continue}break}if(o.child===u.child){for(u=o.child;u;){if(u===s)return y(o),t;if(u===n)return y(o),a;u=u.sibling}throw Error(i(188))}if(s.return!==n.return)s=o,n=u;else{for(var f=!1,N=o.child;N;){if(N===s){f=!0,s=o,n=u;break}if(N===n){f=!0,n=o,s=u;break}N=N.sibling}if(!f){for(N=u.child;N;){if(N===s){f=!0,s=u,n=o;break}if(N===n){f=!0,n=u,s=o;break}N=N.sibling}if(!f)throw Error(i(189))}}if(s.alternate!==n)throw Error(i(190))}if(s.tag!==3)throw Error(i(188));return s.stateNode.current===s?t:a}function v(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t;for(t=t.child;t!==null;){if(a=v(t),a!==null)return a;t=t.sibling}return null}var A=Object.assign,_=Symbol.for("react.element"),j=Symbol.for("react.transitional.element"),$=Symbol.for("react.portal"),C=Symbol.for("react.fragment"),U=Symbol.for("react.strict_mode"),X=Symbol.for("react.profiler"),V=Symbol.for("react.consumer"),q=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),ue=Symbol.for("react.suspense_list"),ae=Symbol.for("react.memo"),Y=Symbol.for("react.lazy"),P=Symbol.for("react.activity"),ce=Symbol.for("react.memo_cache_sentinel"),M=Symbol.iterator;function b(t){return t===null||typeof t!="object"?null:(t=M&&t[M]||t["@@iterator"],typeof t=="function"?t:null)}var R=Symbol.for("react.client.reference");function B(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===R?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case C:return"Fragment";case X:return"Profiler";case U:return"StrictMode";case W:return"Suspense";case ue:return"SuspenseList";case P:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case $:return"Portal";case q:return t.displayName||"Context";case V:return(t._context.displayName||"Context")+".Consumer";case E:var a=t.render;return t=t.displayName,t||(t=a.displayName||a.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case ae:return a=t.displayName||null,a!==null?a:B(t.type)||"Memo";case Y:a=t._payload,t=t._init;try{return B(t(a))}catch{}}return null}var me=Array.isArray,T=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee=c.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,k={pending:!1,data:null,method:null,action:null},pe=[],D=-1;function z(t){return{current:t}}function se(t){0>D||(t.current=pe[D],pe[D]=null,D--)}function Z(t,a){D++,pe[D]=t.current,t.current=a}var ne=z(null),F=z(null),fe=z(null),de=z(null);function ye(t,a){switch(Z(fe,a),Z(F,t),Z(ne,null),a.nodeType){case 9:case 11:t=(t=a.documentElement)&&(t=t.namespaceURI)?Jh(t):0;break;default:if(t=a.tagName,a=a.namespaceURI)a=Jh(a),t=Wh(a,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}se(ne),Z(ne,t)}function Fe(){se(ne),se(F),se(fe)}function ze(t){t.memoizedState!==null&&Z(de,t);var a=ne.current,s=Wh(a,t.type);a!==s&&(Z(F,t),Z(ne,s))}function Me(t){F.current===t&&(se(ne),se(F)),de.current===t&&(se(de),fl._currentValue=k)}var nt,qe;function J(t){if(nt===void 0)try{throw Error()}catch(s){var a=s.stack.trim().match(/\n( *(at )?)/);nt=a&&a[1]||"",qe=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+nt+t+qe}var Oe=!1;function Ie(t,a){if(!t||Oe)return"";Oe=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(a){var Se=function(){throw Error()};if(Object.defineProperty(Se.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Se,[])}catch(ge){var he=ge}Reflect.construct(t,[],Se)}else{try{Se.call()}catch(ge){he=ge}t.call(Se.prototype)}}else{try{throw Error()}catch(ge){he=ge}(Se=t())&&typeof Se.catch=="function"&&Se.catch(function(){})}}catch(ge){if(ge&&he&&typeof ge.stack=="string")return[ge.stack,he.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var o=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");o&&o.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var u=n.DetermineComponentFrameRoot(),f=u[0],N=u[1];if(f&&N){var G=f.split(`
`),oe=N.split(`
`);for(o=n=0;n<G.length&&!G[n].includes("DetermineComponentFrameRoot");)n++;for(;o<oe.length&&!oe[o].includes("DetermineComponentFrameRoot");)o++;if(n===G.length||o===oe.length)for(n=G.length-1,o=oe.length-1;1<=n&&0<=o&&G[n]!==oe[o];)o--;for(;1<=n&&0<=o;n--,o--)if(G[n]!==oe[o]){if(n!==1||o!==1)do if(n--,o--,0>o||G[n]!==oe[o]){var ve=`
`+G[n].replace(" at new "," at ");return t.displayName&&ve.includes("<anonymous>")&&(ve=ve.replace("<anonymous>",t.displayName)),ve}while(1<=n&&0<=o);break}}}finally{Oe=!1,Error.prepareStackTrace=s}return(s=t?t.displayName||t.name:"")?J(s):""}function ft(t,a){switch(t.tag){case 26:case 27:case 5:return J(t.type);case 16:return J("Lazy");case 13:return t.child!==a&&a!==null?J("Suspense Fallback"):J("Suspense");case 19:return J("SuspenseList");case 0:case 15:return Ie(t.type,!1);case 11:return Ie(t.type.render,!1);case 1:return Ie(t.type,!0);case 31:return J("Activity");default:return""}}function ja(t){try{var a="",s=null;do a+=ft(t,s),s=t,t=t.return;while(t);return a}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var ke=Object.prototype.hasOwnProperty,Le=r.unstable_scheduleCallback,$e=r.unstable_cancelCallback,Je=r.unstable_shouldYield,et=r.unstable_requestPaint,tt=r.unstable_now,Ae=r.unstable_getCurrentPriorityLevel,bt=r.unstable_ImmediatePriority,kt=r.unstable_UserBlockingPriority,Mt=r.unstable_NormalPriority,Gt=r.unstable_LowPriority,Dt=r.unstable_IdlePriority,aa=r.log,da=r.unstable_setDisableYieldValue,St=null,We=null;function Ft(t){if(typeof aa=="function"&&da(t),We&&typeof We.setStrictMode=="function")try{We.setStrictMode(St,t)}catch{}}var De=Math.clz32?Math.clz32:we,I=Math.log,L=Math.LN2;function we(t){return t>>>=0,t===0?32:31-(I(t)/L|0)|0}var it=256,Te=262144,be=4194304;function st(t){var a=t&42;if(a!==0)return a;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function dt(t,a,s){var n=t.pendingLanes;if(n===0)return 0;var o=0,u=t.suspendedLanes,f=t.pingedLanes;t=t.warmLanes;var N=n&134217727;return N!==0?(n=N&~u,n!==0?o=st(n):(f&=N,f!==0?o=st(f):s||(s=N&~t,s!==0&&(o=st(s))))):(N=n&~u,N!==0?o=st(N):f!==0?o=st(f):s||(s=n&~t,s!==0&&(o=st(s)))),o===0?0:a!==0&&a!==o&&(a&u)===0&&(u=o&-o,s=a&-a,u>=s||u===32&&(s&4194048)!==0)?a:o}function It(t,a){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&a)===0}function sa(t,a){switch(t){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ce(){var t=be;return be<<=1,(be&62914560)===0&&(be=4194304),t}function xt(t){for(var a=[],s=0;31>s;s++)a.push(t);return a}function ut(t,a){t.pendingLanes|=a,a!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function qa(t,a,s,n,o,u){var f=t.pendingLanes;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=s,t.entangledLanes&=s,t.errorRecoveryDisabledLanes&=s,t.shellSuspendCounter=0;var N=t.entanglements,G=t.expirationTimes,oe=t.hiddenUpdates;for(s=f&~s;0<s;){var ve=31-De(s),Se=1<<ve;N[ve]=0,G[ve]=-1;var he=oe[ve];if(he!==null)for(oe[ve]=null,ve=0;ve<he.length;ve++){var ge=he[ve];ge!==null&&(ge.lane&=-536870913)}s&=~Se}n!==0&&Ee(t,n,0),u!==0&&o===0&&t.tag!==0&&(t.suspendedLanes|=u&~(f&~a))}function Ee(t,a,s){t.pendingLanes|=a,t.suspendedLanes&=~a;var n=31-De(a);t.entangledLanes|=a,t.entanglements[n]=t.entanglements[n]|1073741824|s&261930}function O(t,a){var s=t.entangledLanes|=a;for(t=t.entanglements;s;){var n=31-De(s),o=1<<n;o&a|t[n]&a&&(t[n]|=a),s&=~o}}function je(t,a){var s=a&-a;return s=(s&42)!==0?1:xe(s),(s&(t.suspendedLanes|a))!==0?0:s}function xe(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Re(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function jt(){var t=ee.p;return t!==0?t:(t=window.event,t===void 0?32:bp(t.type))}function ct(t,a){var s=ee.p;try{return ee.p=t,a()}finally{ee.p=s}}var Tt=Math.random().toString(36).slice(2),ot="__reactFiber$"+Tt,ht="__reactProps$"+Tt,va="__reactContainer$"+Tt,Qt="__reactEvents$"+Tt,Sa="__reactListeners$"+Tt,Pe="__reactHandles$"+Tt,rt="__reactResources$"+Tt,Xt="__reactMarker$"+Tt;function ya(t){delete t[ot],delete t[ht],delete t[Qt],delete t[Sa],delete t[Pe]}function Pa(t){var a=t[ot];if(a)return a;for(var s=t.parentNode;s;){if(a=s[va]||s[ot]){if(s=a.alternate,a.child!==null||s!==null&&s.child!==null)for(t=rp(t);t!==null;){if(s=t[ot])return s;t=rp(t)}return a}t=s,s=t.parentNode}return null}function ba(t){if(t=t[ot]||t[va]){var a=t.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return t}return null}function Zt(t){var a=t.tag;if(a===5||a===26||a===27||a===6)return t.stateNode;throw Error(i(33))}function ga(t){var a=t[rt];return a||(a=t[rt]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function zt(t){t[Xt]=!0}var Va=new Set,Ve={};function at(t,a){At(t,a),At(t+"Capture",a)}function At(t,a){for(Ve[t]=a,t=0;t<a.length;t++)Va.add(a[t])}var Pt=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),S={},re={};function Ne(t){return ke.call(re,t)?!0:ke.call(S,t)?!1:Pt.test(t)?re[t]=!0:(S[t]=!0,!1)}function le(t,a,s){if(Ne(a))if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":t.removeAttribute(a);return;case"boolean":var n=a.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){t.removeAttribute(a);return}}t.setAttribute(a,""+s)}}function Ge(t,a,s){if(s===null)t.removeAttribute(a);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(a);return}t.setAttribute(a,""+s)}}function He(t,a,s,n){if(n===null)t.removeAttribute(s);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttributeNS(a,s,""+n)}}function gt(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Qe(t){var a=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function ua(t,a,s){var n=Object.getOwnPropertyDescriptor(t.constructor.prototype,a);if(!t.hasOwnProperty(a)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,u=n.set;return Object.defineProperty(t,a,{configurable:!0,get:function(){return o.call(this)},set:function(f){s=""+f,u.call(this,f)}}),Object.defineProperty(t,a,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(f){s=""+f},stopTracking:function(){t._valueTracker=null,delete t[a]}}}}function Ka(t){if(!t._valueTracker){var a=Qe(t)?"checked":"value";t._valueTracker=ua(t,a,""+t[a])}}function kl(t){if(!t)return!1;var a=t._valueTracker;if(!a)return!0;var s=a.getValue(),n="";return t&&(n=Qe(t)?t.checked?"true":"false":t.value),t=n,t!==s?(a.setValue(t),!0):!1}function Mr(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var Kt=/[\n"\\]/g;function ea(t){return t.replace(Kt,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Ki(t,a,s,n,o,u,f,N){t.name="",f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"?t.type=f:t.removeAttribute("type"),a!=null?f==="number"?(a===0&&t.value===""||t.value!=a)&&(t.value=""+gt(a)):t.value!==""+gt(a)&&(t.value=""+gt(a)):f!=="submit"&&f!=="reset"||t.removeAttribute("value"),a!=null?ec(t,f,gt(a)):s!=null?ec(t,f,gt(s)):n!=null&&t.removeAttribute("value"),o==null&&u!=null&&(t.defaultChecked=!!u),o!=null&&(t.checked=o&&typeof o!="function"&&typeof o!="symbol"),N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?t.name=""+gt(N):t.removeAttribute("name")}function Gd(t,a,s,n,o,u,f,N){if(u!=null&&typeof u!="function"&&typeof u!="symbol"&&typeof u!="boolean"&&(t.type=u),a!=null||s!=null){if(!(u!=="submit"&&u!=="reset"||a!=null)){Ka(t);return}s=s!=null?""+gt(s):"",a=a!=null?""+gt(a):s,N||a===t.value||(t.value=a),t.defaultValue=a}n=n??o,n=typeof n!="function"&&typeof n!="symbol"&&!!n,t.checked=N?t.checked:!!n,t.defaultChecked=!!n,f!=null&&typeof f!="function"&&typeof f!="symbol"&&typeof f!="boolean"&&(t.name=f),Ka(t)}function ec(t,a,s){a==="number"&&Mr(t.ownerDocument)===t||t.defaultValue===""+s||(t.defaultValue=""+s)}function Yn(t,a,s,n){if(t=t.options,a){a={};for(var o=0;o<s.length;o++)a["$"+s[o]]=!0;for(s=0;s<t.length;s++)o=a.hasOwnProperty("$"+t[s].value),t[s].selected!==o&&(t[s].selected=o),o&&n&&(t[s].defaultSelected=!0)}else{for(s=""+gt(s),a=null,o=0;o<t.length;o++){if(t[o].value===s){t[o].selected=!0,n&&(t[o].defaultSelected=!0);return}a!==null||t[o].disabled||(a=t[o])}a!==null&&(a.selected=!0)}}function Yd(t,a,s){if(a!=null&&(a=""+gt(a),a!==t.value&&(t.value=a),s==null)){t.defaultValue!==a&&(t.defaultValue=a);return}t.defaultValue=s!=null?""+gt(s):""}function Id(t,a,s,n){if(a==null){if(n!=null){if(s!=null)throw Error(i(92));if(me(n)){if(1<n.length)throw Error(i(93));n=n[0]}s=n}s==null&&(s=""),a=s}s=gt(a),t.defaultValue=s,n=t.textContent,n===s&&n!==""&&n!==null&&(t.value=n),Ka(t)}function In(t,a){if(a){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=a;return}}t.textContent=a}var Of=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Qd(t,a,s){var n=a.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?n?t.setProperty(a,""):a==="float"?t.cssFloat="":t[a]="":n?t.setProperty(a,s):typeof s!="number"||s===0||Of.has(a)?a==="float"?t.cssFloat=s:t[a]=(""+s).trim():t[a]=s+"px"}function Xd(t,a,s){if(a!=null&&typeof a!="object")throw Error(i(62));if(t=t.style,s!=null){for(var n in s)!s.hasOwnProperty(n)||a!=null&&a.hasOwnProperty(n)||(n.indexOf("--")===0?t.setProperty(n,""):n==="float"?t.cssFloat="":t[n]="");for(var o in a)n=a[o],a.hasOwnProperty(o)&&s[o]!==n&&Qd(t,o,n)}else for(var u in a)a.hasOwnProperty(u)&&Qd(t,u,a[u])}function tc(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Rf=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),qf=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function El(t){return qf.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function bs(){}var ac=null;function sc(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Qn=null,Xn=null;function Zd(t){var a=ba(t);if(a&&(t=a.stateNode)){var s=t[ht]||null;e:switch(t=a.stateNode,a.type){case"input":if(Ki(t,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),a=s.name,s.type==="radio"&&a!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+ea(""+a)+'"][type="radio"]'),a=0;a<s.length;a++){var n=s[a];if(n!==t&&n.form===t.form){var o=n[ht]||null;if(!o)throw Error(i(90));Ki(n,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name)}}for(a=0;a<s.length;a++)n=s[a],n.form===t.form&&kl(n)}break e;case"textarea":Yd(t,s.value,s.defaultValue);break e;case"select":a=s.value,a!=null&&Yn(t,!!s.multiple,a,!1)}}}var nc=!1;function Jd(t,a,s){if(nc)return t(a,s);nc=!0;try{var n=t(a);return n}finally{if(nc=!1,(Qn!==null||Xn!==null)&&(fi(),Qn&&(a=Qn,t=Xn,Xn=Qn=null,Zd(a),t)))for(a=0;a<t.length;a++)Zd(t[a])}}function zr(t,a){var s=t.stateNode;if(s===null)return null;var n=s[ht]||null;if(n===null)return null;s=n[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(i(231,a,typeof s));return s}var _s=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),rc=!1;if(_s)try{var Ar={};Object.defineProperty(Ar,"passive",{get:function(){rc=!0}}),window.addEventListener("test",Ar,Ar),window.removeEventListener("test",Ar,Ar)}catch{rc=!1}var Vs=null,lc=null,Dl=null;function Wd(){if(Dl)return Dl;var t,a=lc,s=a.length,n,o="value"in Vs?Vs.value:Vs.textContent,u=o.length;for(t=0;t<s&&a[t]===o[t];t++);var f=s-t;for(n=1;n<=f&&a[s-n]===o[u-n];n++);return Dl=o.slice(t,1<n?1-n:void 0)}function Tl(t){var a=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&a===13&&(t=13)):t=a,t===10&&(t=13),32<=t||t===13?t:0}function Ml(){return!0}function Kd(){return!1}function Fa(t){function a(s,n,o,u,f){this._reactName=s,this._targetInst=o,this.type=n,this.nativeEvent=u,this.target=f,this.currentTarget=null;for(var N in t)t.hasOwnProperty(N)&&(s=t[N],this[N]=s?s(u):u[N]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?Ml:Kd,this.isPropagationStopped=Kd,this}return A(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Ml)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Ml)},persist:function(){},isPersistent:Ml}),a}var yn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zl=Fa(yn),Or=A({},yn,{view:0,detail:0}),Ff=Fa(Or),ic,cc,Rr,Al=A({},Or,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dc,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Rr&&(Rr&&t.type==="mousemove"?(ic=t.screenX-Rr.screenX,cc=t.screenY-Rr.screenY):cc=ic=0,Rr=t),ic)},movementY:function(t){return"movementY"in t?t.movementY:cc}}),eu=Fa(Al),Lf=A({},Al,{dataTransfer:0}),Uf=Fa(Lf),Hf=A({},Or,{relatedTarget:0}),oc=Fa(Hf),Bf=A({},yn,{animationName:0,elapsedTime:0,pseudoElement:0}),$f=Fa(Bf),Pf=A({},yn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Vf=Fa(Pf),Gf=A({},yn,{data:0}),tu=Fa(Gf),Yf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},If={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Qf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Xf(t){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(t):(t=Qf[t])?!!a[t]:!1}function dc(){return Xf}var Zf=A({},Or,{key:function(t){if(t.key){var a=Yf[t.key]||t.key;if(a!=="Unidentified")return a}return t.type==="keypress"?(t=Tl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?If[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dc,charCode:function(t){return t.type==="keypress"?Tl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Tl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Jf=Fa(Zf),Wf=A({},Al,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),au=Fa(Wf),Kf=A({},Or,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dc}),eg=Fa(Kf),tg=A({},yn,{propertyName:0,elapsedTime:0,pseudoElement:0}),ag=Fa(tg),sg=A({},Al,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),ng=Fa(sg),rg=A({},yn,{newState:0,oldState:0}),lg=Fa(rg),ig=[9,13,27,32],uc=_s&&"CompositionEvent"in window,qr=null;_s&&"documentMode"in document&&(qr=document.documentMode);var cg=_s&&"TextEvent"in window&&!qr,su=_s&&(!uc||qr&&8<qr&&11>=qr),nu=" ",ru=!1;function lu(t,a){switch(t){case"keyup":return ig.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function iu(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Zn=!1;function og(t,a){switch(t){case"compositionend":return iu(a);case"keypress":return a.which!==32?null:(ru=!0,nu);case"textInput":return t=a.data,t===nu&&ru?null:t;default:return null}}function dg(t,a){if(Zn)return t==="compositionend"||!uc&&lu(t,a)?(t=Wd(),Dl=lc=Vs=null,Zn=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return su&&a.locale!=="ko"?null:a.data;default:return null}}var ug={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cu(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a==="input"?!!ug[t.type]:a==="textarea"}function ou(t,a,s,n){Qn?Xn?Xn.push(n):Xn=[n]:Qn=n,a=_i(a,"onChange"),0<a.length&&(s=new zl("onChange","change",null,s,n),t.push({event:s,listeners:a}))}var Fr=null,Lr=null;function mg(t){Gh(t,0)}function Ol(t){var a=Zt(t);if(kl(a))return t}function du(t,a){if(t==="change")return a}var uu=!1;if(_s){var mc;if(_s){var hc="oninput"in document;if(!hc){var mu=document.createElement("div");mu.setAttribute("oninput","return;"),hc=typeof mu.oninput=="function"}mc=hc}else mc=!1;uu=mc&&(!document.documentMode||9<document.documentMode)}function hu(){Fr&&(Fr.detachEvent("onpropertychange",pu),Lr=Fr=null)}function pu(t){if(t.propertyName==="value"&&Ol(Lr)){var a=[];ou(a,Lr,t,sc(t)),Jd(mg,a)}}function hg(t,a,s){t==="focusin"?(hu(),Fr=a,Lr=s,Fr.attachEvent("onpropertychange",pu)):t==="focusout"&&hu()}function pg(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ol(Lr)}function fg(t,a){if(t==="click")return Ol(a)}function gg(t,a){if(t==="input"||t==="change")return Ol(a)}function xg(t,a){return t===a&&(t!==0||1/t===1/a)||t!==t&&a!==a}var Ga=typeof Object.is=="function"?Object.is:xg;function Ur(t,a){if(Ga(t,a))return!0;if(typeof t!="object"||t===null||typeof a!="object"||a===null)return!1;var s=Object.keys(t),n=Object.keys(a);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var o=s[n];if(!ke.call(a,o)||!Ga(t[o],a[o]))return!1}return!0}function fu(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function gu(t,a){var s=fu(t);t=0;for(var n;s;){if(s.nodeType===3){if(n=t+s.textContent.length,t<=a&&n>=a)return{node:s,offset:a-t};t=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=fu(s)}}function xu(t,a){return t&&a?t===a?!0:t&&t.nodeType===3?!1:a&&a.nodeType===3?xu(t,a.parentNode):"contains"in t?t.contains(a):t.compareDocumentPosition?!!(t.compareDocumentPosition(a)&16):!1:!1}function ju(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var a=Mr(t.document);a instanceof t.HTMLIFrameElement;){try{var s=typeof a.contentWindow.location.href=="string"}catch{s=!1}if(s)t=a.contentWindow;else break;a=Mr(t.document)}return a}function pc(t){var a=t&&t.nodeName&&t.nodeName.toLowerCase();return a&&(a==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||a==="textarea"||t.contentEditable==="true")}var jg=_s&&"documentMode"in document&&11>=document.documentMode,Jn=null,fc=null,Hr=null,gc=!1;function vu(t,a,s){var n=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;gc||Jn==null||Jn!==Mr(n)||(n=Jn,"selectionStart"in n&&pc(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Hr&&Ur(Hr,n)||(Hr=n,n=_i(fc,"onSelect"),0<n.length&&(a=new zl("onSelect","select",null,a,s),t.push({event:a,listeners:n}),a.target=Jn)))}function bn(t,a){var s={};return s[t.toLowerCase()]=a.toLowerCase(),s["Webkit"+t]="webkit"+a,s["Moz"+t]="moz"+a,s}var Wn={animationend:bn("Animation","AnimationEnd"),animationiteration:bn("Animation","AnimationIteration"),animationstart:bn("Animation","AnimationStart"),transitionrun:bn("Transition","TransitionRun"),transitionstart:bn("Transition","TransitionStart"),transitioncancel:bn("Transition","TransitionCancel"),transitionend:bn("Transition","TransitionEnd")},xc={},yu={};_s&&(yu=document.createElement("div").style,"AnimationEvent"in window||(delete Wn.animationend.animation,delete Wn.animationiteration.animation,delete Wn.animationstart.animation),"TransitionEvent"in window||delete Wn.transitionend.transition);function _n(t){if(xc[t])return xc[t];if(!Wn[t])return t;var a=Wn[t],s;for(s in a)if(a.hasOwnProperty(s)&&s in yu)return xc[t]=a[s];return t}var bu=_n("animationend"),_u=_n("animationiteration"),Nu=_n("animationstart"),vg=_n("transitionrun"),yg=_n("transitionstart"),bg=_n("transitioncancel"),Su=_n("transitionend"),Cu=new Map,jc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");jc.push("scrollEnd");function us(t,a){Cu.set(t,a),at(a,[t])}var Rl=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},es=[],Kn=0,vc=0;function ql(){for(var t=Kn,a=vc=Kn=0;a<t;){var s=es[a];es[a++]=null;var n=es[a];es[a++]=null;var o=es[a];es[a++]=null;var u=es[a];if(es[a++]=null,n!==null&&o!==null){var f=n.pending;f===null?o.next=o:(o.next=f.next,f.next=o),n.pending=o}u!==0&&wu(s,o,u)}}function Fl(t,a,s,n){es[Kn++]=t,es[Kn++]=a,es[Kn++]=s,es[Kn++]=n,vc|=n,t.lanes|=n,t=t.alternate,t!==null&&(t.lanes|=n)}function yc(t,a,s,n){return Fl(t,a,s,n),Ll(t)}function Nn(t,a){return Fl(t,null,null,a),Ll(t)}function wu(t,a,s){t.lanes|=s;var n=t.alternate;n!==null&&(n.lanes|=s);for(var o=!1,u=t.return;u!==null;)u.childLanes|=s,n=u.alternate,n!==null&&(n.childLanes|=s),u.tag===22&&(t=u.stateNode,t===null||t._visibility&1||(o=!0)),t=u,u=u.return;return t.tag===3?(u=t.stateNode,o&&a!==null&&(o=31-De(s),t=u.hiddenUpdates,n=t[o],n===null?t[o]=[a]:n.push(a),a.lane=s|536870912),u):null}function Ll(t){if(50<cl)throw cl=0,To=null,Error(i(185));for(var a=t.return;a!==null;)t=a,a=t.return;return t.tag===3?t.stateNode:null}var er={};function _g(t,a,s,n){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ya(t,a,s,n){return new _g(t,a,s,n)}function bc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Ns(t,a){var s=t.alternate;return s===null?(s=Ya(t.tag,a,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=a,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&65011712,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,a=t.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s.refCleanup=t.refCleanup,s}function ku(t,a){t.flags&=65011714;var s=t.alternate;return s===null?(t.childLanes=0,t.lanes=a,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,t.type=s.type,a=s.dependencies,t.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),t}function Ul(t,a,s,n,o,u){var f=0;if(n=t,typeof t=="function")bc(t)&&(f=1);else if(typeof t=="string")f=kx(t,s,ne.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case P:return t=Ya(31,s,a,o),t.elementType=P,t.lanes=u,t;case C:return Sn(s.children,o,u,a);case U:f=8,o|=24;break;case X:return t=Ya(12,s,a,o|2),t.elementType=X,t.lanes=u,t;case W:return t=Ya(13,s,a,o),t.elementType=W,t.lanes=u,t;case ue:return t=Ya(19,s,a,o),t.elementType=ue,t.lanes=u,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case q:f=10;break e;case V:f=9;break e;case E:f=11;break e;case ae:f=14;break e;case Y:f=16,n=null;break e}f=29,s=Error(i(130,t===null?"null":typeof t,"")),n=null}return a=Ya(f,s,a,o),a.elementType=t,a.type=n,a.lanes=u,a}function Sn(t,a,s,n){return t=Ya(7,t,n,a),t.lanes=s,t}function _c(t,a,s){return t=Ya(6,t,null,a),t.lanes=s,t}function Eu(t){var a=Ya(18,null,null,0);return a.stateNode=t,a}function Nc(t,a,s){return a=Ya(4,t.children!==null?t.children:[],t.key,a),a.lanes=s,a.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},a}var Du=new WeakMap;function ts(t,a){if(typeof t=="object"&&t!==null){var s=Du.get(t);return s!==void 0?s:(a={value:t,source:a,stack:ja(a)},Du.set(t,a),a)}return{value:t,source:a,stack:ja(a)}}var tr=[],ar=0,Hl=null,Br=0,as=[],ss=0,Gs=null,fs=1,gs="";function Ss(t,a){tr[ar++]=Br,tr[ar++]=Hl,Hl=t,Br=a}function Tu(t,a,s){as[ss++]=fs,as[ss++]=gs,as[ss++]=Gs,Gs=t;var n=fs;t=gs;var o=32-De(n)-1;n&=~(1<<o),s+=1;var u=32-De(a)+o;if(30<u){var f=o-o%5;u=(n&(1<<f)-1).toString(32),n>>=f,o-=f,fs=1<<32-De(a)+o|s<<o|n,gs=u+t}else fs=1<<u|s<<o|n,gs=t}function Sc(t){t.return!==null&&(Ss(t,1),Tu(t,1,0))}function Cc(t){for(;t===Hl;)Hl=tr[--ar],tr[ar]=null,Br=tr[--ar],tr[ar]=null;for(;t===Gs;)Gs=as[--ss],as[ss]=null,gs=as[--ss],as[ss]=null,fs=as[--ss],as[ss]=null}function Mu(t,a){as[ss++]=fs,as[ss++]=gs,as[ss++]=Gs,fs=a.id,gs=a.overflow,Gs=t}var Ca=null,Jt=null,Ct=!1,Ys=null,ns=!1,wc=Error(i(519));function Is(t){var a=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw $r(ts(a,t)),wc}function zu(t){var a=t.stateNode,s=t.type,n=t.memoizedProps;switch(a[ot]=t,a[ht]=n,s){case"dialog":yt("cancel",a),yt("close",a);break;case"iframe":case"object":case"embed":yt("load",a);break;case"video":case"audio":for(s=0;s<dl.length;s++)yt(dl[s],a);break;case"source":yt("error",a);break;case"img":case"image":case"link":yt("error",a),yt("load",a);break;case"details":yt("toggle",a);break;case"input":yt("invalid",a),Gd(a,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":yt("invalid",a);break;case"textarea":yt("invalid",a),Id(a,n.value,n.defaultValue,n.children)}s=n.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||a.textContent===""+s||n.suppressHydrationWarning===!0||Xh(a.textContent,s)?(n.popover!=null&&(yt("beforetoggle",a),yt("toggle",a)),n.onScroll!=null&&yt("scroll",a),n.onScrollEnd!=null&&yt("scrollend",a),n.onClick!=null&&(a.onclick=bs),a=!0):a=!1,a||Is(t,!0)}function Au(t){for(Ca=t.return;Ca;)switch(Ca.tag){case 5:case 31:case 13:ns=!1;return;case 27:case 3:ns=!0;return;default:Ca=Ca.return}}function sr(t){if(t!==Ca)return!1;if(!Ct)return Au(t),Ct=!0,!1;var a=t.tag,s;if((s=a!==3&&a!==27)&&((s=a===5)&&(s=t.type,s=!(s!=="form"&&s!=="button")||Go(t.type,t.memoizedProps)),s=!s),s&&Jt&&Is(t),Au(t),a===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(i(317));Jt=np(t)}else if(a===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(i(317));Jt=np(t)}else a===27?(a=Jt,cn(t.type)?(t=Zo,Zo=null,Jt=t):Jt=a):Jt=Ca?ls(t.stateNode.nextSibling):null;return!0}function Cn(){Jt=Ca=null,Ct=!1}function kc(){var t=Ys;return t!==null&&(Ba===null?Ba=t:Ba.push.apply(Ba,t),Ys=null),t}function $r(t){Ys===null?Ys=[t]:Ys.push(t)}var Ec=z(null),wn=null,Cs=null;function Qs(t,a,s){Z(Ec,a._currentValue),a._currentValue=s}function ws(t){t._currentValue=Ec.current,se(Ec)}function Dc(t,a,s){for(;t!==null;){var n=t.alternate;if((t.childLanes&a)!==a?(t.childLanes|=a,n!==null&&(n.childLanes|=a)):n!==null&&(n.childLanes&a)!==a&&(n.childLanes|=a),t===s)break;t=t.return}}function Tc(t,a,s,n){var o=t.child;for(o!==null&&(o.return=t);o!==null;){var u=o.dependencies;if(u!==null){var f=o.child;u=u.firstContext;e:for(;u!==null;){var N=u;u=o;for(var G=0;G<a.length;G++)if(N.context===a[G]){u.lanes|=s,N=u.alternate,N!==null&&(N.lanes|=s),Dc(u.return,s,t),n||(f=null);break e}u=N.next}}else if(o.tag===18){if(f=o.return,f===null)throw Error(i(341));f.lanes|=s,u=f.alternate,u!==null&&(u.lanes|=s),Dc(f,s,t),f=null}else f=o.child;if(f!==null)f.return=o;else for(f=o;f!==null;){if(f===t){f=null;break}if(o=f.sibling,o!==null){o.return=f.return,f=o;break}f=f.return}o=f}}function nr(t,a,s,n){t=null;for(var o=a,u=!1;o!==null;){if(!u){if((o.flags&524288)!==0)u=!0;else if((o.flags&262144)!==0)break}if(o.tag===10){var f=o.alternate;if(f===null)throw Error(i(387));if(f=f.memoizedProps,f!==null){var N=o.type;Ga(o.pendingProps.value,f.value)||(t!==null?t.push(N):t=[N])}}else if(o===de.current){if(f=o.alternate,f===null)throw Error(i(387));f.memoizedState.memoizedState!==o.memoizedState.memoizedState&&(t!==null?t.push(fl):t=[fl])}o=o.return}t!==null&&Tc(a,t,s,n),a.flags|=262144}function Bl(t){for(t=t.firstContext;t!==null;){if(!Ga(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function kn(t){wn=t,Cs=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function wa(t){return Ou(wn,t)}function $l(t,a){return wn===null&&kn(t),Ou(t,a)}function Ou(t,a){var s=a._currentValue;if(a={context:a,memoizedValue:s,next:null},Cs===null){if(t===null)throw Error(i(308));Cs=a,t.dependencies={lanes:0,firstContext:a},t.flags|=524288}else Cs=Cs.next=a;return s}var Ng=typeof AbortController<"u"?AbortController:function(){var t=[],a=this.signal={aborted:!1,addEventListener:function(s,n){t.push(n)}};this.abort=function(){a.aborted=!0,t.forEach(function(s){return s()})}},Sg=r.unstable_scheduleCallback,Cg=r.unstable_NormalPriority,ma={$$typeof:q,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Mc(){return{controller:new Ng,data:new Map,refCount:0}}function Pr(t){t.refCount--,t.refCount===0&&Sg(Cg,function(){t.controller.abort()})}var Vr=null,zc=0,rr=0,lr=null;function wg(t,a){if(Vr===null){var s=Vr=[];zc=0,rr=qo(),lr={status:"pending",value:void 0,then:function(n){s.push(n)}}}return zc++,a.then(Ru,Ru),a}function Ru(){if(--zc===0&&Vr!==null){lr!==null&&(lr.status="fulfilled");var t=Vr;Vr=null,rr=0,lr=null;for(var a=0;a<t.length;a++)(0,t[a])()}}function kg(t,a){var s=[],n={status:"pending",value:null,reason:null,then:function(o){s.push(o)}};return t.then(function(){n.status="fulfilled",n.value=a;for(var o=0;o<s.length;o++)(0,s[o])(a)},function(o){for(n.status="rejected",n.reason=o,o=0;o<s.length;o++)(0,s[o])(void 0)}),n}var qu=T.S;T.S=function(t,a){vh=tt(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&wg(t,a),qu!==null&&qu(t,a)};var En=z(null);function Ac(){var t=En.current;return t!==null?t:Vt.pooledCache}function Pl(t,a){a===null?Z(En,En.current):Z(En,a.pool)}function Fu(){var t=Ac();return t===null?null:{parent:ma._currentValue,pool:t}}var ir=Error(i(460)),Oc=Error(i(474)),Vl=Error(i(542)),Gl={then:function(){}};function Lu(t){return t=t.status,t==="fulfilled"||t==="rejected"}function Uu(t,a,s){switch(s=t[s],s===void 0?t.push(a):s!==a&&(a.then(bs,bs),a=s),a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,Bu(t),t;default:if(typeof a.status=="string")a.then(bs,bs);else{if(t=Vt,t!==null&&100<t.shellSuspendCounter)throw Error(i(482));t=a,t.status="pending",t.then(function(n){if(a.status==="pending"){var o=a;o.status="fulfilled",o.value=n}},function(n){if(a.status==="pending"){var o=a;o.status="rejected",o.reason=n}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw t=a.reason,Bu(t),t}throw Tn=a,ir}}function Dn(t){try{var a=t._init;return a(t._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(Tn=s,ir):s}}var Tn=null;function Hu(){if(Tn===null)throw Error(i(459));var t=Tn;return Tn=null,t}function Bu(t){if(t===ir||t===Vl)throw Error(i(483))}var cr=null,Gr=0;function Yl(t){var a=Gr;return Gr+=1,cr===null&&(cr=[]),Uu(cr,t,a)}function Yr(t,a){a=a.props.ref,t.ref=a!==void 0?a:null}function Il(t,a){throw a.$$typeof===_?Error(i(525)):(t=Object.prototype.toString.call(a),Error(i(31,t==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":t)))}function $u(t){function a(te,Q){if(t){var ie=te.deletions;ie===null?(te.deletions=[Q],te.flags|=16):ie.push(Q)}}function s(te,Q){if(!t)return null;for(;Q!==null;)a(te,Q),Q=Q.sibling;return null}function n(te){for(var Q=new Map;te!==null;)te.key!==null?Q.set(te.key,te):Q.set(te.index,te),te=te.sibling;return Q}function o(te,Q){return te=Ns(te,Q),te.index=0,te.sibling=null,te}function u(te,Q,ie){return te.index=ie,t?(ie=te.alternate,ie!==null?(ie=ie.index,ie<Q?(te.flags|=67108866,Q):ie):(te.flags|=67108866,Q)):(te.flags|=1048576,Q)}function f(te){return t&&te.alternate===null&&(te.flags|=67108866),te}function N(te,Q,ie,_e){return Q===null||Q.tag!==6?(Q=_c(ie,te.mode,_e),Q.return=te,Q):(Q=o(Q,ie),Q.return=te,Q)}function G(te,Q,ie,_e){var Ke=ie.type;return Ke===C?ve(te,Q,ie.props.children,_e,ie.key):Q!==null&&(Q.elementType===Ke||typeof Ke=="object"&&Ke!==null&&Ke.$$typeof===Y&&Dn(Ke)===Q.type)?(Q=o(Q,ie.props),Yr(Q,ie),Q.return=te,Q):(Q=Ul(ie.type,ie.key,ie.props,null,te.mode,_e),Yr(Q,ie),Q.return=te,Q)}function oe(te,Q,ie,_e){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==ie.containerInfo||Q.stateNode.implementation!==ie.implementation?(Q=Nc(ie,te.mode,_e),Q.return=te,Q):(Q=o(Q,ie.children||[]),Q.return=te,Q)}function ve(te,Q,ie,_e,Ke){return Q===null||Q.tag!==7?(Q=Sn(ie,te.mode,_e,Ke),Q.return=te,Q):(Q=o(Q,ie),Q.return=te,Q)}function Se(te,Q,ie){if(typeof Q=="string"&&Q!==""||typeof Q=="number"||typeof Q=="bigint")return Q=_c(""+Q,te.mode,ie),Q.return=te,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case j:return ie=Ul(Q.type,Q.key,Q.props,null,te.mode,ie),Yr(ie,Q),ie.return=te,ie;case $:return Q=Nc(Q,te.mode,ie),Q.return=te,Q;case Y:return Q=Dn(Q),Se(te,Q,ie)}if(me(Q)||b(Q))return Q=Sn(Q,te.mode,ie,null),Q.return=te,Q;if(typeof Q.then=="function")return Se(te,Yl(Q),ie);if(Q.$$typeof===q)return Se(te,$l(te,Q),ie);Il(te,Q)}return null}function he(te,Q,ie,_e){var Ke=Q!==null?Q.key:null;if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return Ke!==null?null:N(te,Q,""+ie,_e);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case j:return ie.key===Ke?G(te,Q,ie,_e):null;case $:return ie.key===Ke?oe(te,Q,ie,_e):null;case Y:return ie=Dn(ie),he(te,Q,ie,_e)}if(me(ie)||b(ie))return Ke!==null?null:ve(te,Q,ie,_e,null);if(typeof ie.then=="function")return he(te,Q,Yl(ie),_e);if(ie.$$typeof===q)return he(te,Q,$l(te,ie),_e);Il(te,ie)}return null}function ge(te,Q,ie,_e,Ke){if(typeof _e=="string"&&_e!==""||typeof _e=="number"||typeof _e=="bigint")return te=te.get(ie)||null,N(Q,te,""+_e,Ke);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case j:return te=te.get(_e.key===null?ie:_e.key)||null,G(Q,te,_e,Ke);case $:return te=te.get(_e.key===null?ie:_e.key)||null,oe(Q,te,_e,Ke);case Y:return _e=Dn(_e),ge(te,Q,ie,_e,Ke)}if(me(_e)||b(_e))return te=te.get(ie)||null,ve(Q,te,_e,Ke,null);if(typeof _e.then=="function")return ge(te,Q,ie,Yl(_e),Ke);if(_e.$$typeof===q)return ge(te,Q,ie,$l(Q,_e),Ke);Il(Q,_e)}return null}function Ye(te,Q,ie,_e){for(var Ke=null,Ot=null,Xe=Q,pt=Q=0,Nt=null;Xe!==null&&pt<ie.length;pt++){Xe.index>pt?(Nt=Xe,Xe=null):Nt=Xe.sibling;var Rt=he(te,Xe,ie[pt],_e);if(Rt===null){Xe===null&&(Xe=Nt);break}t&&Xe&&Rt.alternate===null&&a(te,Xe),Q=u(Rt,Q,pt),Ot===null?Ke=Rt:Ot.sibling=Rt,Ot=Rt,Xe=Nt}if(pt===ie.length)return s(te,Xe),Ct&&Ss(te,pt),Ke;if(Xe===null){for(;pt<ie.length;pt++)Xe=Se(te,ie[pt],_e),Xe!==null&&(Q=u(Xe,Q,pt),Ot===null?Ke=Xe:Ot.sibling=Xe,Ot=Xe);return Ct&&Ss(te,pt),Ke}for(Xe=n(Xe);pt<ie.length;pt++)Nt=ge(Xe,te,pt,ie[pt],_e),Nt!==null&&(t&&Nt.alternate!==null&&Xe.delete(Nt.key===null?pt:Nt.key),Q=u(Nt,Q,pt),Ot===null?Ke=Nt:Ot.sibling=Nt,Ot=Nt);return t&&Xe.forEach(function(hn){return a(te,hn)}),Ct&&Ss(te,pt),Ke}function lt(te,Q,ie,_e){if(ie==null)throw Error(i(151));for(var Ke=null,Ot=null,Xe=Q,pt=Q=0,Nt=null,Rt=ie.next();Xe!==null&&!Rt.done;pt++,Rt=ie.next()){Xe.index>pt?(Nt=Xe,Xe=null):Nt=Xe.sibling;var hn=he(te,Xe,Rt.value,_e);if(hn===null){Xe===null&&(Xe=Nt);break}t&&Xe&&hn.alternate===null&&a(te,Xe),Q=u(hn,Q,pt),Ot===null?Ke=hn:Ot.sibling=hn,Ot=hn,Xe=Nt}if(Rt.done)return s(te,Xe),Ct&&Ss(te,pt),Ke;if(Xe===null){for(;!Rt.done;pt++,Rt=ie.next())Rt=Se(te,Rt.value,_e),Rt!==null&&(Q=u(Rt,Q,pt),Ot===null?Ke=Rt:Ot.sibling=Rt,Ot=Rt);return Ct&&Ss(te,pt),Ke}for(Xe=n(Xe);!Rt.done;pt++,Rt=ie.next())Rt=ge(Xe,te,pt,Rt.value,_e),Rt!==null&&(t&&Rt.alternate!==null&&Xe.delete(Rt.key===null?pt:Rt.key),Q=u(Rt,Q,pt),Ot===null?Ke=Rt:Ot.sibling=Rt,Ot=Rt);return t&&Xe.forEach(function(Lx){return a(te,Lx)}),Ct&&Ss(te,pt),Ke}function $t(te,Q,ie,_e){if(typeof ie=="object"&&ie!==null&&ie.type===C&&ie.key===null&&(ie=ie.props.children),typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case j:e:{for(var Ke=ie.key;Q!==null;){if(Q.key===Ke){if(Ke=ie.type,Ke===C){if(Q.tag===7){s(te,Q.sibling),_e=o(Q,ie.props.children),_e.return=te,te=_e;break e}}else if(Q.elementType===Ke||typeof Ke=="object"&&Ke!==null&&Ke.$$typeof===Y&&Dn(Ke)===Q.type){s(te,Q.sibling),_e=o(Q,ie.props),Yr(_e,ie),_e.return=te,te=_e;break e}s(te,Q);break}else a(te,Q);Q=Q.sibling}ie.type===C?(_e=Sn(ie.props.children,te.mode,_e,ie.key),_e.return=te,te=_e):(_e=Ul(ie.type,ie.key,ie.props,null,te.mode,_e),Yr(_e,ie),_e.return=te,te=_e)}return f(te);case $:e:{for(Ke=ie.key;Q!==null;){if(Q.key===Ke)if(Q.tag===4&&Q.stateNode.containerInfo===ie.containerInfo&&Q.stateNode.implementation===ie.implementation){s(te,Q.sibling),_e=o(Q,ie.children||[]),_e.return=te,te=_e;break e}else{s(te,Q);break}else a(te,Q);Q=Q.sibling}_e=Nc(ie,te.mode,_e),_e.return=te,te=_e}return f(te);case Y:return ie=Dn(ie),$t(te,Q,ie,_e)}if(me(ie))return Ye(te,Q,ie,_e);if(b(ie)){if(Ke=b(ie),typeof Ke!="function")throw Error(i(150));return ie=Ke.call(ie),lt(te,Q,ie,_e)}if(typeof ie.then=="function")return $t(te,Q,Yl(ie),_e);if(ie.$$typeof===q)return $t(te,Q,$l(te,ie),_e);Il(te,ie)}return typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint"?(ie=""+ie,Q!==null&&Q.tag===6?(s(te,Q.sibling),_e=o(Q,ie),_e.return=te,te=_e):(s(te,Q),_e=_c(ie,te.mode,_e),_e.return=te,te=_e),f(te)):s(te,Q)}return function(te,Q,ie,_e){try{Gr=0;var Ke=$t(te,Q,ie,_e);return cr=null,Ke}catch(Xe){if(Xe===ir||Xe===Vl)throw Xe;var Ot=Ya(29,Xe,null,te.mode);return Ot.lanes=_e,Ot.return=te,Ot}finally{}}}var Mn=$u(!0),Pu=$u(!1),Xs=!1;function Rc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function qc(t,a){t=t.updateQueue,a.updateQueue===t&&(a.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function Zs(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Js(t,a,s){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,(qt&2)!==0){var o=n.pending;return o===null?a.next=a:(a.next=o.next,o.next=a),n.pending=a,a=Ll(t),wu(t,null,s),a}return Fl(t,n,a,s),Ll(t)}function Ir(t,a,s){if(a=a.updateQueue,a!==null&&(a=a.shared,(s&4194048)!==0)){var n=a.lanes;n&=t.pendingLanes,s|=n,a.lanes=s,O(t,s)}}function Fc(t,a){var s=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,s===n)){var o=null,u=null;if(s=s.firstBaseUpdate,s!==null){do{var f={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};u===null?o=u=f:u=u.next=f,s=s.next}while(s!==null);u===null?o=u=a:u=u.next=a}else o=u=a;s={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:u,shared:n.shared,callbacks:n.callbacks},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=a:t.next=a,s.lastBaseUpdate=a}var Lc=!1;function Qr(){if(Lc){var t=lr;if(t!==null)throw t}}function Xr(t,a,s,n){Lc=!1;var o=t.updateQueue;Xs=!1;var u=o.firstBaseUpdate,f=o.lastBaseUpdate,N=o.shared.pending;if(N!==null){o.shared.pending=null;var G=N,oe=G.next;G.next=null,f===null?u=oe:f.next=oe,f=G;var ve=t.alternate;ve!==null&&(ve=ve.updateQueue,N=ve.lastBaseUpdate,N!==f&&(N===null?ve.firstBaseUpdate=oe:N.next=oe,ve.lastBaseUpdate=G))}if(u!==null){var Se=o.baseState;f=0,ve=oe=G=null,N=u;do{var he=N.lane&-536870913,ge=he!==N.lane;if(ge?(_t&he)===he:(n&he)===he){he!==0&&he===rr&&(Lc=!0),ve!==null&&(ve=ve.next={lane:0,tag:N.tag,payload:N.payload,callback:null,next:null});e:{var Ye=t,lt=N;he=a;var $t=s;switch(lt.tag){case 1:if(Ye=lt.payload,typeof Ye=="function"){Se=Ye.call($t,Se,he);break e}Se=Ye;break e;case 3:Ye.flags=Ye.flags&-65537|128;case 0:if(Ye=lt.payload,he=typeof Ye=="function"?Ye.call($t,Se,he):Ye,he==null)break e;Se=A({},Se,he);break e;case 2:Xs=!0}}he=N.callback,he!==null&&(t.flags|=64,ge&&(t.flags|=8192),ge=o.callbacks,ge===null?o.callbacks=[he]:ge.push(he))}else ge={lane:he,tag:N.tag,payload:N.payload,callback:N.callback,next:null},ve===null?(oe=ve=ge,G=Se):ve=ve.next=ge,f|=he;if(N=N.next,N===null){if(N=o.shared.pending,N===null)break;ge=N,N=ge.next,ge.next=null,o.lastBaseUpdate=ge,o.shared.pending=null}}while(!0);ve===null&&(G=Se),o.baseState=G,o.firstBaseUpdate=oe,o.lastBaseUpdate=ve,u===null&&(o.shared.lanes=0),an|=f,t.lanes=f,t.memoizedState=Se}}function Vu(t,a){if(typeof t!="function")throw Error(i(191,t));t.call(a)}function Gu(t,a){var s=t.callbacks;if(s!==null)for(t.callbacks=null,t=0;t<s.length;t++)Vu(s[t],a)}var or=z(null),Ql=z(0);function Yu(t,a){t=Rs,Z(Ql,t),Z(or,a),Rs=t|a.baseLanes}function Uc(){Z(Ql,Rs),Z(or,or.current)}function Hc(){Rs=Ql.current,se(or),se(Ql)}var Ia=z(null),rs=null;function Ws(t){var a=t.alternate;Z(la,la.current&1),Z(Ia,t),rs===null&&(a===null||or.current!==null||a.memoizedState!==null)&&(rs=t)}function Bc(t){Z(la,la.current),Z(Ia,t),rs===null&&(rs=t)}function Iu(t){t.tag===22?(Z(la,la.current),Z(Ia,t),rs===null&&(rs=t)):Ks()}function Ks(){Z(la,la.current),Z(Ia,Ia.current)}function Qa(t){se(Ia),rs===t&&(rs=null),se(la)}var la=z(0);function Xl(t){for(var a=t;a!==null;){if(a.tag===13){var s=a.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||Qo(s)||Xo(s)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var ks=0,mt=null,Ht=null,ha=null,Zl=!1,dr=!1,zn=!1,Jl=0,Zr=0,ur=null,Eg=0;function na(){throw Error(i(321))}function $c(t,a){if(a===null)return!1;for(var s=0;s<a.length&&s<t.length;s++)if(!Ga(t[s],a[s]))return!1;return!0}function Pc(t,a,s,n,o,u){return ks=u,mt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,T.H=t===null||t.memoizedState===null?Tm:no,zn=!1,u=s(n,o),zn=!1,dr&&(u=Xu(a,s,n,o)),Qu(t),u}function Qu(t){T.H=Kr;var a=Ht!==null&&Ht.next!==null;if(ks=0,ha=Ht=mt=null,Zl=!1,Zr=0,ur=null,a)throw Error(i(300));t===null||pa||(t=t.dependencies,t!==null&&Bl(t)&&(pa=!0))}function Xu(t,a,s,n){mt=t;var o=0;do{if(dr&&(ur=null),Zr=0,dr=!1,25<=o)throw Error(i(301));if(o+=1,ha=Ht=null,t.updateQueue!=null){var u=t.updateQueue;u.lastEffect=null,u.events=null,u.stores=null,u.memoCache!=null&&(u.memoCache.index=0)}T.H=Mm,u=a(s,n)}while(dr);return u}function Dg(){var t=T.H,a=t.useState()[0];return a=typeof a.then=="function"?Jr(a):a,t=t.useState()[0],(Ht!==null?Ht.memoizedState:null)!==t&&(mt.flags|=1024),a}function Vc(){var t=Jl!==0;return Jl=0,t}function Gc(t,a,s){a.updateQueue=t.updateQueue,a.flags&=-2053,t.lanes&=~s}function Yc(t){if(Zl){for(t=t.memoizedState;t!==null;){var a=t.queue;a!==null&&(a.pending=null),t=t.next}Zl=!1}ks=0,ha=Ht=mt=null,dr=!1,Zr=Jl=0,ur=null}function za(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ha===null?mt.memoizedState=ha=t:ha=ha.next=t,ha}function ia(){if(Ht===null){var t=mt.alternate;t=t!==null?t.memoizedState:null}else t=Ht.next;var a=ha===null?mt.memoizedState:ha.next;if(a!==null)ha=a,Ht=t;else{if(t===null)throw mt.alternate===null?Error(i(467)):Error(i(310));Ht=t,t={memoizedState:Ht.memoizedState,baseState:Ht.baseState,baseQueue:Ht.baseQueue,queue:Ht.queue,next:null},ha===null?mt.memoizedState=ha=t:ha=ha.next=t}return ha}function Wl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Jr(t){var a=Zr;return Zr+=1,ur===null&&(ur=[]),t=Uu(ur,t,a),a=mt,(ha===null?a.memoizedState:ha.next)===null&&(a=a.alternate,T.H=a===null||a.memoizedState===null?Tm:no),t}function Kl(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Jr(t);if(t.$$typeof===q)return wa(t)}throw Error(i(438,String(t)))}function Ic(t){var a=null,s=mt.updateQueue;if(s!==null&&(a=s.memoCache),a==null){var n=mt.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(a={data:n.data.map(function(o){return o.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),s===null&&(s=Wl(),mt.updateQueue=s),s.memoCache=a,s=a.data[a.index],s===void 0)for(s=a.data[a.index]=Array(t),n=0;n<t;n++)s[n]=ce;return a.index++,s}function Es(t,a){return typeof a=="function"?a(t):a}function ei(t){var a=ia();return Qc(a,Ht,t)}function Qc(t,a,s){var n=t.queue;if(n===null)throw Error(i(311));n.lastRenderedReducer=s;var o=t.baseQueue,u=n.pending;if(u!==null){if(o!==null){var f=o.next;o.next=u.next,u.next=f}a.baseQueue=o=u,n.pending=null}if(u=t.baseState,o===null)t.memoizedState=u;else{a=o.next;var N=f=null,G=null,oe=a,ve=!1;do{var Se=oe.lane&-536870913;if(Se!==oe.lane?(_t&Se)===Se:(ks&Se)===Se){var he=oe.revertLane;if(he===0)G!==null&&(G=G.next={lane:0,revertLane:0,gesture:null,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null}),Se===rr&&(ve=!0);else if((ks&he)===he){oe=oe.next,he===rr&&(ve=!0);continue}else Se={lane:0,revertLane:oe.revertLane,gesture:null,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null},G===null?(N=G=Se,f=u):G=G.next=Se,mt.lanes|=he,an|=he;Se=oe.action,zn&&s(u,Se),u=oe.hasEagerState?oe.eagerState:s(u,Se)}else he={lane:Se,revertLane:oe.revertLane,gesture:oe.gesture,action:oe.action,hasEagerState:oe.hasEagerState,eagerState:oe.eagerState,next:null},G===null?(N=G=he,f=u):G=G.next=he,mt.lanes|=Se,an|=Se;oe=oe.next}while(oe!==null&&oe!==a);if(G===null?f=u:G.next=N,!Ga(u,t.memoizedState)&&(pa=!0,ve&&(s=lr,s!==null)))throw s;t.memoizedState=u,t.baseState=f,t.baseQueue=G,n.lastRenderedState=u}return o===null&&(n.lanes=0),[t.memoizedState,n.dispatch]}function Xc(t){var a=ia(),s=a.queue;if(s===null)throw Error(i(311));s.lastRenderedReducer=t;var n=s.dispatch,o=s.pending,u=a.memoizedState;if(o!==null){s.pending=null;var f=o=o.next;do u=t(u,f.action),f=f.next;while(f!==o);Ga(u,a.memoizedState)||(pa=!0),a.memoizedState=u,a.baseQueue===null&&(a.baseState=u),s.lastRenderedState=u}return[u,n]}function Zu(t,a,s){var n=mt,o=ia(),u=Ct;if(u){if(s===void 0)throw Error(i(407));s=s()}else s=a();var f=!Ga((Ht||o).memoizedState,s);if(f&&(o.memoizedState=s,pa=!0),o=o.queue,Wc(Ku.bind(null,n,o,t),[t]),o.getSnapshot!==a||f||ha!==null&&ha.memoizedState.tag&1){if(n.flags|=2048,mr(9,{destroy:void 0},Wu.bind(null,n,o,s,a),null),Vt===null)throw Error(i(349));u||(ks&127)!==0||Ju(n,a,s)}return s}function Ju(t,a,s){t.flags|=16384,t={getSnapshot:a,value:s},a=mt.updateQueue,a===null?(a=Wl(),mt.updateQueue=a,a.stores=[t]):(s=a.stores,s===null?a.stores=[t]:s.push(t))}function Wu(t,a,s,n){a.value=s,a.getSnapshot=n,em(a)&&tm(t)}function Ku(t,a,s){return s(function(){em(a)&&tm(t)})}function em(t){var a=t.getSnapshot;t=t.value;try{var s=a();return!Ga(t,s)}catch{return!0}}function tm(t){var a=Nn(t,2);a!==null&&$a(a,t,2)}function Zc(t){var a=za();if(typeof t=="function"){var s=t;if(t=s(),zn){Ft(!0);try{s()}finally{Ft(!1)}}}return a.memoizedState=a.baseState=t,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Es,lastRenderedState:t},a}function am(t,a,s,n){return t.baseState=s,Qc(t,Ht,typeof n=="function"?n:Es)}function Tg(t,a,s,n,o){if(si(t))throw Error(i(485));if(t=a.action,t!==null){var u={payload:o,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(f){u.listeners.push(f)}};T.T!==null?s(!0):u.isTransition=!1,n(u),s=a.pending,s===null?(u.next=a.pending=u,sm(a,u)):(u.next=s.next,a.pending=s.next=u)}}function sm(t,a){var s=a.action,n=a.payload,o=t.state;if(a.isTransition){var u=T.T,f={};T.T=f;try{var N=s(o,n),G=T.S;G!==null&&G(f,N),nm(t,a,N)}catch(oe){Jc(t,a,oe)}finally{u!==null&&f.types!==null&&(u.types=f.types),T.T=u}}else try{u=s(o,n),nm(t,a,u)}catch(oe){Jc(t,a,oe)}}function nm(t,a,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(n){rm(t,a,n)},function(n){return Jc(t,a,n)}):rm(t,a,s)}function rm(t,a,s){a.status="fulfilled",a.value=s,lm(a),t.state=s,a=t.pending,a!==null&&(s=a.next,s===a?t.pending=null:(s=s.next,a.next=s,sm(t,s)))}function Jc(t,a,s){var n=t.pending;if(t.pending=null,n!==null){n=n.next;do a.status="rejected",a.reason=s,lm(a),a=a.next;while(a!==n)}t.action=null}function lm(t){t=t.listeners;for(var a=0;a<t.length;a++)(0,t[a])()}function im(t,a){return a}function cm(t,a){if(Ct){var s=Vt.formState;if(s!==null){e:{var n=mt;if(Ct){if(Jt){t:{for(var o=Jt,u=ns;o.nodeType!==8;){if(!u){o=null;break t}if(o=ls(o.nextSibling),o===null){o=null;break t}}u=o.data,o=u==="F!"||u==="F"?o:null}if(o){Jt=ls(o.nextSibling),n=o.data==="F!";break e}}Is(n)}n=!1}n&&(a=s[0])}}return s=za(),s.memoizedState=s.baseState=a,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:im,lastRenderedState:a},s.queue=n,s=km.bind(null,mt,n),n.dispatch=s,n=Zc(!1),u=so.bind(null,mt,!1,n.queue),n=za(),o={state:a,dispatch:null,action:t,pending:null},n.queue=o,s=Tg.bind(null,mt,o,u,s),o.dispatch=s,n.memoizedState=t,[a,s,!1]}function om(t){var a=ia();return dm(a,Ht,t)}function dm(t,a,s){if(a=Qc(t,a,im)[0],t=ei(Es)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var n=Jr(a)}catch(f){throw f===ir?Vl:f}else n=a;a=ia();var o=a.queue,u=o.dispatch;return s!==a.memoizedState&&(mt.flags|=2048,mr(9,{destroy:void 0},Mg.bind(null,o,s),null)),[n,u,t]}function Mg(t,a){t.action=a}function um(t){var a=ia(),s=Ht;if(s!==null)return dm(a,s,t);ia(),a=a.memoizedState,s=ia();var n=s.queue.dispatch;return s.memoizedState=t,[a,n,!1]}function mr(t,a,s,n){return t={tag:t,create:s,deps:n,inst:a,next:null},a=mt.updateQueue,a===null&&(a=Wl(),mt.updateQueue=a),s=a.lastEffect,s===null?a.lastEffect=t.next=t:(n=s.next,s.next=t,t.next=n,a.lastEffect=t),t}function mm(){return ia().memoizedState}function ti(t,a,s,n){var o=za();mt.flags|=t,o.memoizedState=mr(1|a,{destroy:void 0},s,n===void 0?null:n)}function ai(t,a,s,n){var o=ia();n=n===void 0?null:n;var u=o.memoizedState.inst;Ht!==null&&n!==null&&$c(n,Ht.memoizedState.deps)?o.memoizedState=mr(a,u,s,n):(mt.flags|=t,o.memoizedState=mr(1|a,u,s,n))}function hm(t,a){ti(8390656,8,t,a)}function Wc(t,a){ai(2048,8,t,a)}function zg(t){mt.flags|=4;var a=mt.updateQueue;if(a===null)a=Wl(),mt.updateQueue=a,a.events=[t];else{var s=a.events;s===null?a.events=[t]:s.push(t)}}function pm(t){var a=ia().memoizedState;return zg({ref:a,nextImpl:t}),function(){if((qt&2)!==0)throw Error(i(440));return a.impl.apply(void 0,arguments)}}function fm(t,a){return ai(4,2,t,a)}function gm(t,a){return ai(4,4,t,a)}function xm(t,a){if(typeof a=="function"){t=t();var s=a(t);return function(){typeof s=="function"?s():a(null)}}if(a!=null)return t=t(),a.current=t,function(){a.current=null}}function jm(t,a,s){s=s!=null?s.concat([t]):null,ai(4,4,xm.bind(null,a,t),s)}function Kc(){}function vm(t,a){var s=ia();a=a===void 0?null:a;var n=s.memoizedState;return a!==null&&$c(a,n[1])?n[0]:(s.memoizedState=[t,a],t)}function ym(t,a){var s=ia();a=a===void 0?null:a;var n=s.memoizedState;if(a!==null&&$c(a,n[1]))return n[0];if(n=t(),zn){Ft(!0);try{t()}finally{Ft(!1)}}return s.memoizedState=[n,a],n}function eo(t,a,s){return s===void 0||(ks&1073741824)!==0&&(_t&261930)===0?t.memoizedState=a:(t.memoizedState=s,t=bh(),mt.lanes|=t,an|=t,s)}function bm(t,a,s,n){return Ga(s,a)?s:or.current!==null?(t=eo(t,s,n),Ga(t,a)||(pa=!0),t):(ks&42)===0||(ks&1073741824)!==0&&(_t&261930)===0?(pa=!0,t.memoizedState=s):(t=bh(),mt.lanes|=t,an|=t,a)}function _m(t,a,s,n,o){var u=ee.p;ee.p=u!==0&&8>u?u:8;var f=T.T,N={};T.T=N,so(t,!1,a,s);try{var G=o(),oe=T.S;if(oe!==null&&oe(N,G),G!==null&&typeof G=="object"&&typeof G.then=="function"){var ve=kg(G,n);Wr(t,a,ve,Ja(t))}else Wr(t,a,n,Ja(t))}catch(Se){Wr(t,a,{then:function(){},status:"rejected",reason:Se},Ja())}finally{ee.p=u,f!==null&&N.types!==null&&(f.types=N.types),T.T=f}}function Ag(){}function to(t,a,s,n){if(t.tag!==5)throw Error(i(476));var o=Nm(t).queue;_m(t,o,a,k,s===null?Ag:function(){return Sm(t),s(n)})}function Nm(t){var a=t.memoizedState;if(a!==null)return a;a={memoizedState:k,baseState:k,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Es,lastRenderedState:k},next:null};var s={};return a.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Es,lastRenderedState:s},next:null},t.memoizedState=a,t=t.alternate,t!==null&&(t.memoizedState=a),a}function Sm(t){var a=Nm(t);a.next===null&&(a=t.alternate.memoizedState),Wr(t,a.next.queue,{},Ja())}function ao(){return wa(fl)}function Cm(){return ia().memoizedState}function wm(){return ia().memoizedState}function Og(t){for(var a=t.return;a!==null;){switch(a.tag){case 24:case 3:var s=Ja();t=Zs(s);var n=Js(a,t,s);n!==null&&($a(n,a,s),Ir(n,a,s)),a={cache:Mc()},t.payload=a;return}a=a.return}}function Rg(t,a,s){var n=Ja();s={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},si(t)?Em(a,s):(s=yc(t,a,s,n),s!==null&&($a(s,t,n),Dm(s,a,n)))}function km(t,a,s){var n=Ja();Wr(t,a,s,n)}function Wr(t,a,s,n){var o={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(si(t))Em(a,o);else{var u=t.alternate;if(t.lanes===0&&(u===null||u.lanes===0)&&(u=a.lastRenderedReducer,u!==null))try{var f=a.lastRenderedState,N=u(f,s);if(o.hasEagerState=!0,o.eagerState=N,Ga(N,f))return Fl(t,a,o,0),Vt===null&&ql(),!1}catch{}finally{}if(s=yc(t,a,o,n),s!==null)return $a(s,t,n),Dm(s,a,n),!0}return!1}function so(t,a,s,n){if(n={lane:2,revertLane:qo(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},si(t)){if(a)throw Error(i(479))}else a=yc(t,s,n,2),a!==null&&$a(a,t,2)}function si(t){var a=t.alternate;return t===mt||a!==null&&a===mt}function Em(t,a){dr=Zl=!0;var s=t.pending;s===null?a.next=a:(a.next=s.next,s.next=a),t.pending=a}function Dm(t,a,s){if((s&4194048)!==0){var n=a.lanes;n&=t.pendingLanes,s|=n,a.lanes=s,O(t,s)}}var Kr={readContext:wa,use:Kl,useCallback:na,useContext:na,useEffect:na,useImperativeHandle:na,useLayoutEffect:na,useInsertionEffect:na,useMemo:na,useReducer:na,useRef:na,useState:na,useDebugValue:na,useDeferredValue:na,useTransition:na,useSyncExternalStore:na,useId:na,useHostTransitionStatus:na,useFormState:na,useActionState:na,useOptimistic:na,useMemoCache:na,useCacheRefresh:na};Kr.useEffectEvent=na;var Tm={readContext:wa,use:Kl,useCallback:function(t,a){return za().memoizedState=[t,a===void 0?null:a],t},useContext:wa,useEffect:hm,useImperativeHandle:function(t,a,s){s=s!=null?s.concat([t]):null,ti(4194308,4,xm.bind(null,a,t),s)},useLayoutEffect:function(t,a){return ti(4194308,4,t,a)},useInsertionEffect:function(t,a){ti(4,2,t,a)},useMemo:function(t,a){var s=za();a=a===void 0?null:a;var n=t();if(zn){Ft(!0);try{t()}finally{Ft(!1)}}return s.memoizedState=[n,a],n},useReducer:function(t,a,s){var n=za();if(s!==void 0){var o=s(a);if(zn){Ft(!0);try{s(a)}finally{Ft(!1)}}}else o=a;return n.memoizedState=n.baseState=o,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:o},n.queue=t,t=t.dispatch=Rg.bind(null,mt,t),[n.memoizedState,t]},useRef:function(t){var a=za();return t={current:t},a.memoizedState=t},useState:function(t){t=Zc(t);var a=t.queue,s=km.bind(null,mt,a);return a.dispatch=s,[t.memoizedState,s]},useDebugValue:Kc,useDeferredValue:function(t,a){var s=za();return eo(s,t,a)},useTransition:function(){var t=Zc(!1);return t=_m.bind(null,mt,t.queue,!0,!1),za().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,a,s){var n=mt,o=za();if(Ct){if(s===void 0)throw Error(i(407));s=s()}else{if(s=a(),Vt===null)throw Error(i(349));(_t&127)!==0||Ju(n,a,s)}o.memoizedState=s;var u={value:s,getSnapshot:a};return o.queue=u,hm(Ku.bind(null,n,u,t),[t]),n.flags|=2048,mr(9,{destroy:void 0},Wu.bind(null,n,u,s,a),null),s},useId:function(){var t=za(),a=Vt.identifierPrefix;if(Ct){var s=gs,n=fs;s=(n&~(1<<32-De(n)-1)).toString(32)+s,a="_"+a+"R_"+s,s=Jl++,0<s&&(a+="H"+s.toString(32)),a+="_"}else s=Eg++,a="_"+a+"r_"+s.toString(32)+"_";return t.memoizedState=a},useHostTransitionStatus:ao,useFormState:cm,useActionState:cm,useOptimistic:function(t){var a=za();a.memoizedState=a.baseState=t;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=s,a=so.bind(null,mt,!0,s),s.dispatch=a,[t,a]},useMemoCache:Ic,useCacheRefresh:function(){return za().memoizedState=Og.bind(null,mt)},useEffectEvent:function(t){var a=za(),s={impl:t};return a.memoizedState=s,function(){if((qt&2)!==0)throw Error(i(440));return s.impl.apply(void 0,arguments)}}},no={readContext:wa,use:Kl,useCallback:vm,useContext:wa,useEffect:Wc,useImperativeHandle:jm,useInsertionEffect:fm,useLayoutEffect:gm,useMemo:ym,useReducer:ei,useRef:mm,useState:function(){return ei(Es)},useDebugValue:Kc,useDeferredValue:function(t,a){var s=ia();return bm(s,Ht.memoizedState,t,a)},useTransition:function(){var t=ei(Es)[0],a=ia().memoizedState;return[typeof t=="boolean"?t:Jr(t),a]},useSyncExternalStore:Zu,useId:Cm,useHostTransitionStatus:ao,useFormState:om,useActionState:om,useOptimistic:function(t,a){var s=ia();return am(s,Ht,t,a)},useMemoCache:Ic,useCacheRefresh:wm};no.useEffectEvent=pm;var Mm={readContext:wa,use:Kl,useCallback:vm,useContext:wa,useEffect:Wc,useImperativeHandle:jm,useInsertionEffect:fm,useLayoutEffect:gm,useMemo:ym,useReducer:Xc,useRef:mm,useState:function(){return Xc(Es)},useDebugValue:Kc,useDeferredValue:function(t,a){var s=ia();return Ht===null?eo(s,t,a):bm(s,Ht.memoizedState,t,a)},useTransition:function(){var t=Xc(Es)[0],a=ia().memoizedState;return[typeof t=="boolean"?t:Jr(t),a]},useSyncExternalStore:Zu,useId:Cm,useHostTransitionStatus:ao,useFormState:um,useActionState:um,useOptimistic:function(t,a){var s=ia();return Ht!==null?am(s,Ht,t,a):(s.baseState=t,[t,s.queue.dispatch])},useMemoCache:Ic,useCacheRefresh:wm};Mm.useEffectEvent=pm;function ro(t,a,s,n){a=t.memoizedState,s=s(n,a),s=s==null?a:A({},a,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var lo={enqueueSetState:function(t,a,s){t=t._reactInternals;var n=Ja(),o=Zs(n);o.payload=a,s!=null&&(o.callback=s),a=Js(t,o,n),a!==null&&($a(a,t,n),Ir(a,t,n))},enqueueReplaceState:function(t,a,s){t=t._reactInternals;var n=Ja(),o=Zs(n);o.tag=1,o.payload=a,s!=null&&(o.callback=s),a=Js(t,o,n),a!==null&&($a(a,t,n),Ir(a,t,n))},enqueueForceUpdate:function(t,a){t=t._reactInternals;var s=Ja(),n=Zs(s);n.tag=2,a!=null&&(n.callback=a),a=Js(t,n,s),a!==null&&($a(a,t,s),Ir(a,t,s))}};function zm(t,a,s,n,o,u,f){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,u,f):a.prototype&&a.prototype.isPureReactComponent?!Ur(s,n)||!Ur(o,u):!0}function Am(t,a,s,n){t=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(s,n),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(s,n),a.state!==t&&lo.enqueueReplaceState(a,a.state,null)}function An(t,a){var s=a;if("ref"in a){s={};for(var n in a)n!=="ref"&&(s[n]=a[n])}if(t=t.defaultProps){s===a&&(s=A({},s));for(var o in t)s[o]===void 0&&(s[o]=t[o])}return s}function Om(t){Rl(t)}function Rm(t){console.error(t)}function qm(t){Rl(t)}function ni(t,a){try{var s=t.onUncaughtError;s(a.value,{componentStack:a.stack})}catch(n){setTimeout(function(){throw n})}}function Fm(t,a,s){try{var n=t.onCaughtError;n(s.value,{componentStack:s.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(o){setTimeout(function(){throw o})}}function io(t,a,s){return s=Zs(s),s.tag=3,s.payload={element:null},s.callback=function(){ni(t,a)},s}function Lm(t){return t=Zs(t),t.tag=3,t}function Um(t,a,s,n){var o=s.type.getDerivedStateFromError;if(typeof o=="function"){var u=n.value;t.payload=function(){return o(u)},t.callback=function(){Fm(a,s,n)}}var f=s.stateNode;f!==null&&typeof f.componentDidCatch=="function"&&(t.callback=function(){Fm(a,s,n),typeof o!="function"&&(sn===null?sn=new Set([this]):sn.add(this));var N=n.stack;this.componentDidCatch(n.value,{componentStack:N!==null?N:""})})}function qg(t,a,s,n,o){if(s.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(a=s.alternate,a!==null&&nr(a,s,o,!0),s=Ia.current,s!==null){switch(s.tag){case 31:case 13:return rs===null?gi():s.alternate===null&&ra===0&&(ra=3),s.flags&=-257,s.flags|=65536,s.lanes=o,n===Gl?s.flags|=16384:(a=s.updateQueue,a===null?s.updateQueue=new Set([n]):a.add(n),Ao(t,n,o)),!1;case 22:return s.flags|=65536,n===Gl?s.flags|=16384:(a=s.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([n])},s.updateQueue=a):(s=a.retryQueue,s===null?a.retryQueue=new Set([n]):s.add(n)),Ao(t,n,o)),!1}throw Error(i(435,s.tag))}return Ao(t,n,o),gi(),!1}if(Ct)return a=Ia.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=o,n!==wc&&(t=Error(i(422),{cause:n}),$r(ts(t,s)))):(n!==wc&&(a=Error(i(423),{cause:n}),$r(ts(a,s))),t=t.current.alternate,t.flags|=65536,o&=-o,t.lanes|=o,n=ts(n,s),o=io(t.stateNode,n,o),Fc(t,o),ra!==4&&(ra=2)),!1;var u=Error(i(520),{cause:n});if(u=ts(u,s),il===null?il=[u]:il.push(u),ra!==4&&(ra=2),a===null)return!0;n=ts(n,s),s=a;do{switch(s.tag){case 3:return s.flags|=65536,t=o&-o,s.lanes|=t,t=io(s.stateNode,n,t),Fc(s,t),!1;case 1:if(a=s.type,u=s.stateNode,(s.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||u!==null&&typeof u.componentDidCatch=="function"&&(sn===null||!sn.has(u))))return s.flags|=65536,o&=-o,s.lanes|=o,o=Lm(o),Um(o,t,s,n),Fc(s,o),!1}s=s.return}while(s!==null);return!1}var co=Error(i(461)),pa=!1;function ka(t,a,s,n){a.child=t===null?Pu(a,null,s,n):Mn(a,t.child,s,n)}function Hm(t,a,s,n,o){s=s.render;var u=a.ref;if("ref"in n){var f={};for(var N in n)N!=="ref"&&(f[N]=n[N])}else f=n;return kn(a),n=Pc(t,a,s,f,u,o),N=Vc(),t!==null&&!pa?(Gc(t,a,o),Ds(t,a,o)):(Ct&&N&&Sc(a),a.flags|=1,ka(t,a,n,o),a.child)}function Bm(t,a,s,n,o){if(t===null){var u=s.type;return typeof u=="function"&&!bc(u)&&u.defaultProps===void 0&&s.compare===null?(a.tag=15,a.type=u,$m(t,a,u,n,o)):(t=Ul(s.type,null,n,a,a.mode,o),t.ref=a.ref,t.return=a,a.child=t)}if(u=t.child,!xo(t,o)){var f=u.memoizedProps;if(s=s.compare,s=s!==null?s:Ur,s(f,n)&&t.ref===a.ref)return Ds(t,a,o)}return a.flags|=1,t=Ns(u,n),t.ref=a.ref,t.return=a,a.child=t}function $m(t,a,s,n,o){if(t!==null){var u=t.memoizedProps;if(Ur(u,n)&&t.ref===a.ref)if(pa=!1,a.pendingProps=n=u,xo(t,o))(t.flags&131072)!==0&&(pa=!0);else return a.lanes=t.lanes,Ds(t,a,o)}return oo(t,a,s,n,o)}function Pm(t,a,s,n){var o=n.children,u=t!==null?t.memoizedState:null;if(t===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if((a.flags&128)!==0){if(u=u!==null?u.baseLanes|s:s,t!==null){for(n=a.child=t.child,o=0;n!==null;)o=o|n.lanes|n.childLanes,n=n.sibling;n=o&~u}else n=0,a.child=null;return Vm(t,a,u,s,n)}if((s&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},t!==null&&Pl(a,u!==null?u.cachePool:null),u!==null?Yu(a,u):Uc(),Iu(a);else return n=a.lanes=536870912,Vm(t,a,u!==null?u.baseLanes|s:s,s,n)}else u!==null?(Pl(a,u.cachePool),Yu(a,u),Ks(),a.memoizedState=null):(t!==null&&Pl(a,null),Uc(),Ks());return ka(t,a,o,s),a.child}function el(t,a){return t!==null&&t.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function Vm(t,a,s,n,o){var u=Ac();return u=u===null?null:{parent:ma._currentValue,pool:u},a.memoizedState={baseLanes:s,cachePool:u},t!==null&&Pl(a,null),Uc(),Iu(a),t!==null&&nr(t,a,n,!0),a.childLanes=o,null}function ri(t,a){return a=ii({mode:a.mode,children:a.children},t.mode),a.ref=t.ref,t.child=a,a.return=t,a}function Gm(t,a,s){return Mn(a,t.child,null,s),t=ri(a,a.pendingProps),t.flags|=2,Qa(a),a.memoizedState=null,t}function Fg(t,a,s){var n=a.pendingProps,o=(a.flags&128)!==0;if(a.flags&=-129,t===null){if(Ct){if(n.mode==="hidden")return t=ri(a,n),a.lanes=536870912,el(null,t);if(Bc(a),(t=Jt)?(t=sp(t,ns),t=t!==null&&t.data==="&"?t:null,t!==null&&(a.memoizedState={dehydrated:t,treeContext:Gs!==null?{id:fs,overflow:gs}:null,retryLane:536870912,hydrationErrors:null},s=Eu(t),s.return=a,a.child=s,Ca=a,Jt=null)):t=null,t===null)throw Is(a);return a.lanes=536870912,null}return ri(a,n)}var u=t.memoizedState;if(u!==null){var f=u.dehydrated;if(Bc(a),o)if(a.flags&256)a.flags&=-257,a=Gm(t,a,s);else if(a.memoizedState!==null)a.child=t.child,a.flags|=128,a=null;else throw Error(i(558));else if(pa||nr(t,a,s,!1),o=(s&t.childLanes)!==0,pa||o){if(n=Vt,n!==null&&(f=je(n,s),f!==0&&f!==u.retryLane))throw u.retryLane=f,Nn(t,f),$a(n,t,f),co;gi(),a=Gm(t,a,s)}else t=u.treeContext,Jt=ls(f.nextSibling),Ca=a,Ct=!0,Ys=null,ns=!1,t!==null&&Mu(a,t),a=ri(a,n),a.flags|=4096;return a}return t=Ns(t.child,{mode:n.mode,children:n.children}),t.ref=a.ref,a.child=t,t.return=a,t}function li(t,a){var s=a.ref;if(s===null)t!==null&&t.ref!==null&&(a.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(i(284));(t===null||t.ref!==s)&&(a.flags|=4194816)}}function oo(t,a,s,n,o){return kn(a),s=Pc(t,a,s,n,void 0,o),n=Vc(),t!==null&&!pa?(Gc(t,a,o),Ds(t,a,o)):(Ct&&n&&Sc(a),a.flags|=1,ka(t,a,s,o),a.child)}function Ym(t,a,s,n,o,u){return kn(a),a.updateQueue=null,s=Xu(a,n,s,o),Qu(t),n=Vc(),t!==null&&!pa?(Gc(t,a,u),Ds(t,a,u)):(Ct&&n&&Sc(a),a.flags|=1,ka(t,a,s,u),a.child)}function Im(t,a,s,n,o){if(kn(a),a.stateNode===null){var u=er,f=s.contextType;typeof f=="object"&&f!==null&&(u=wa(f)),u=new s(n,u),a.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,u.updater=lo,a.stateNode=u,u._reactInternals=a,u=a.stateNode,u.props=n,u.state=a.memoizedState,u.refs={},Rc(a),f=s.contextType,u.context=typeof f=="object"&&f!==null?wa(f):er,u.state=a.memoizedState,f=s.getDerivedStateFromProps,typeof f=="function"&&(ro(a,s,f,n),u.state=a.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(f=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),f!==u.state&&lo.enqueueReplaceState(u,u.state,null),Xr(a,n,u,o),Qr(),u.state=a.memoizedState),typeof u.componentDidMount=="function"&&(a.flags|=4194308),n=!0}else if(t===null){u=a.stateNode;var N=a.memoizedProps,G=An(s,N);u.props=G;var oe=u.context,ve=s.contextType;f=er,typeof ve=="object"&&ve!==null&&(f=wa(ve));var Se=s.getDerivedStateFromProps;ve=typeof Se=="function"||typeof u.getSnapshotBeforeUpdate=="function",N=a.pendingProps!==N,ve||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(N||oe!==f)&&Am(a,u,n,f),Xs=!1;var he=a.memoizedState;u.state=he,Xr(a,n,u,o),Qr(),oe=a.memoizedState,N||he!==oe||Xs?(typeof Se=="function"&&(ro(a,s,Se,n),oe=a.memoizedState),(G=Xs||zm(a,s,G,n,he,oe,f))?(ve||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount()),typeof u.componentDidMount=="function"&&(a.flags|=4194308)):(typeof u.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=n,a.memoizedState=oe),u.props=n,u.state=oe,u.context=f,n=G):(typeof u.componentDidMount=="function"&&(a.flags|=4194308),n=!1)}else{u=a.stateNode,qc(t,a),f=a.memoizedProps,ve=An(s,f),u.props=ve,Se=a.pendingProps,he=u.context,oe=s.contextType,G=er,typeof oe=="object"&&oe!==null&&(G=wa(oe)),N=s.getDerivedStateFromProps,(oe=typeof N=="function"||typeof u.getSnapshotBeforeUpdate=="function")||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(f!==Se||he!==G)&&Am(a,u,n,G),Xs=!1,he=a.memoizedState,u.state=he,Xr(a,n,u,o),Qr();var ge=a.memoizedState;f!==Se||he!==ge||Xs||t!==null&&t.dependencies!==null&&Bl(t.dependencies)?(typeof N=="function"&&(ro(a,s,N,n),ge=a.memoizedState),(ve=Xs||zm(a,s,ve,n,he,ge,G)||t!==null&&t.dependencies!==null&&Bl(t.dependencies))?(oe||typeof u.UNSAFE_componentWillUpdate!="function"&&typeof u.componentWillUpdate!="function"||(typeof u.componentWillUpdate=="function"&&u.componentWillUpdate(n,ge,G),typeof u.UNSAFE_componentWillUpdate=="function"&&u.UNSAFE_componentWillUpdate(n,ge,G)),typeof u.componentDidUpdate=="function"&&(a.flags|=4),typeof u.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof u.componentDidUpdate!="function"||f===t.memoizedProps&&he===t.memoizedState||(a.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||f===t.memoizedProps&&he===t.memoizedState||(a.flags|=1024),a.memoizedProps=n,a.memoizedState=ge),u.props=n,u.state=ge,u.context=G,n=ve):(typeof u.componentDidUpdate!="function"||f===t.memoizedProps&&he===t.memoizedState||(a.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||f===t.memoizedProps&&he===t.memoizedState||(a.flags|=1024),n=!1)}return u=n,li(t,a),n=(a.flags&128)!==0,u||n?(u=a.stateNode,s=n&&typeof s.getDerivedStateFromError!="function"?null:u.render(),a.flags|=1,t!==null&&n?(a.child=Mn(a,t.child,null,o),a.child=Mn(a,null,s,o)):ka(t,a,s,o),a.memoizedState=u.state,t=a.child):t=Ds(t,a,o),t}function Qm(t,a,s,n){return Cn(),a.flags|=256,ka(t,a,s,n),a.child}var uo={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function mo(t){return{baseLanes:t,cachePool:Fu()}}function ho(t,a,s){return t=t!==null?t.childLanes&~s:0,a&&(t|=Za),t}function Xm(t,a,s){var n=a.pendingProps,o=!1,u=(a.flags&128)!==0,f;if((f=u)||(f=t!==null&&t.memoizedState===null?!1:(la.current&2)!==0),f&&(o=!0,a.flags&=-129),f=(a.flags&32)!==0,a.flags&=-33,t===null){if(Ct){if(o?Ws(a):Ks(),(t=Jt)?(t=sp(t,ns),t=t!==null&&t.data!=="&"?t:null,t!==null&&(a.memoizedState={dehydrated:t,treeContext:Gs!==null?{id:fs,overflow:gs}:null,retryLane:536870912,hydrationErrors:null},s=Eu(t),s.return=a,a.child=s,Ca=a,Jt=null)):t=null,t===null)throw Is(a);return Xo(t)?a.lanes=32:a.lanes=536870912,null}var N=n.children;return n=n.fallback,o?(Ks(),o=a.mode,N=ii({mode:"hidden",children:N},o),n=Sn(n,o,s,null),N.return=a,n.return=a,N.sibling=n,a.child=N,n=a.child,n.memoizedState=mo(s),n.childLanes=ho(t,f,s),a.memoizedState=uo,el(null,n)):(Ws(a),po(a,N))}var G=t.memoizedState;if(G!==null&&(N=G.dehydrated,N!==null)){if(u)a.flags&256?(Ws(a),a.flags&=-257,a=fo(t,a,s)):a.memoizedState!==null?(Ks(),a.child=t.child,a.flags|=128,a=null):(Ks(),N=n.fallback,o=a.mode,n=ii({mode:"visible",children:n.children},o),N=Sn(N,o,s,null),N.flags|=2,n.return=a,N.return=a,n.sibling=N,a.child=n,Mn(a,t.child,null,s),n=a.child,n.memoizedState=mo(s),n.childLanes=ho(t,f,s),a.memoizedState=uo,a=el(null,n));else if(Ws(a),Xo(N)){if(f=N.nextSibling&&N.nextSibling.dataset,f)var oe=f.dgst;f=oe,n=Error(i(419)),n.stack="",n.digest=f,$r({value:n,source:null,stack:null}),a=fo(t,a,s)}else if(pa||nr(t,a,s,!1),f=(s&t.childLanes)!==0,pa||f){if(f=Vt,f!==null&&(n=je(f,s),n!==0&&n!==G.retryLane))throw G.retryLane=n,Nn(t,n),$a(f,t,n),co;Qo(N)||gi(),a=fo(t,a,s)}else Qo(N)?(a.flags|=192,a.child=t.child,a=null):(t=G.treeContext,Jt=ls(N.nextSibling),Ca=a,Ct=!0,Ys=null,ns=!1,t!==null&&Mu(a,t),a=po(a,n.children),a.flags|=4096);return a}return o?(Ks(),N=n.fallback,o=a.mode,G=t.child,oe=G.sibling,n=Ns(G,{mode:"hidden",children:n.children}),n.subtreeFlags=G.subtreeFlags&65011712,oe!==null?N=Ns(oe,N):(N=Sn(N,o,s,null),N.flags|=2),N.return=a,n.return=a,n.sibling=N,a.child=n,el(null,n),n=a.child,N=t.child.memoizedState,N===null?N=mo(s):(o=N.cachePool,o!==null?(G=ma._currentValue,o=o.parent!==G?{parent:G,pool:G}:o):o=Fu(),N={baseLanes:N.baseLanes|s,cachePool:o}),n.memoizedState=N,n.childLanes=ho(t,f,s),a.memoizedState=uo,el(t.child,n)):(Ws(a),s=t.child,t=s.sibling,s=Ns(s,{mode:"visible",children:n.children}),s.return=a,s.sibling=null,t!==null&&(f=a.deletions,f===null?(a.deletions=[t],a.flags|=16):f.push(t)),a.child=s,a.memoizedState=null,s)}function po(t,a){return a=ii({mode:"visible",children:a},t.mode),a.return=t,t.child=a}function ii(t,a){return t=Ya(22,t,null,a),t.lanes=0,t}function fo(t,a,s){return Mn(a,t.child,null,s),t=po(a,a.pendingProps.children),t.flags|=2,a.memoizedState=null,t}function Zm(t,a,s){t.lanes|=a;var n=t.alternate;n!==null&&(n.lanes|=a),Dc(t.return,a,s)}function go(t,a,s,n,o,u){var f=t.memoizedState;f===null?t.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:o,treeForkCount:u}:(f.isBackwards=a,f.rendering=null,f.renderingStartTime=0,f.last=n,f.tail=s,f.tailMode=o,f.treeForkCount=u)}function Jm(t,a,s){var n=a.pendingProps,o=n.revealOrder,u=n.tail;n=n.children;var f=la.current,N=(f&2)!==0;if(N?(f=f&1|2,a.flags|=128):f&=1,Z(la,f),ka(t,a,n,s),n=Ct?Br:0,!N&&t!==null&&(t.flags&128)!==0)e:for(t=a.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Zm(t,s,a);else if(t.tag===19)Zm(t,s,a);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===a)break e;for(;t.sibling===null;){if(t.return===null||t.return===a)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(o){case"forwards":for(s=a.child,o=null;s!==null;)t=s.alternate,t!==null&&Xl(t)===null&&(o=s),s=s.sibling;s=o,s===null?(o=a.child,a.child=null):(o=s.sibling,s.sibling=null),go(a,!1,o,s,u,n);break;case"backwards":case"unstable_legacy-backwards":for(s=null,o=a.child,a.child=null;o!==null;){if(t=o.alternate,t!==null&&Xl(t)===null){a.child=o;break}t=o.sibling,o.sibling=s,s=o,o=t}go(a,!0,s,null,u,n);break;case"together":go(a,!1,null,null,void 0,n);break;default:a.memoizedState=null}return a.child}function Ds(t,a,s){if(t!==null&&(a.dependencies=t.dependencies),an|=a.lanes,(s&a.childLanes)===0)if(t!==null){if(nr(t,a,s,!1),(s&a.childLanes)===0)return null}else return null;if(t!==null&&a.child!==t.child)throw Error(i(153));if(a.child!==null){for(t=a.child,s=Ns(t,t.pendingProps),a.child=s,s.return=a;t.sibling!==null;)t=t.sibling,s=s.sibling=Ns(t,t.pendingProps),s.return=a;s.sibling=null}return a.child}function xo(t,a){return(t.lanes&a)!==0?!0:(t=t.dependencies,!!(t!==null&&Bl(t)))}function Lg(t,a,s){switch(a.tag){case 3:ye(a,a.stateNode.containerInfo),Qs(a,ma,t.memoizedState.cache),Cn();break;case 27:case 5:ze(a);break;case 4:ye(a,a.stateNode.containerInfo);break;case 10:Qs(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,Bc(a),null;break;case 13:var n=a.memoizedState;if(n!==null)return n.dehydrated!==null?(Ws(a),a.flags|=128,null):(s&a.child.childLanes)!==0?Xm(t,a,s):(Ws(a),t=Ds(t,a,s),t!==null?t.sibling:null);Ws(a);break;case 19:var o=(t.flags&128)!==0;if(n=(s&a.childLanes)!==0,n||(nr(t,a,s,!1),n=(s&a.childLanes)!==0),o){if(n)return Jm(t,a,s);a.flags|=128}if(o=a.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),Z(la,la.current),n)break;return null;case 22:return a.lanes=0,Pm(t,a,s,a.pendingProps);case 24:Qs(a,ma,t.memoizedState.cache)}return Ds(t,a,s)}function Wm(t,a,s){if(t!==null)if(t.memoizedProps!==a.pendingProps)pa=!0;else{if(!xo(t,s)&&(a.flags&128)===0)return pa=!1,Lg(t,a,s);pa=(t.flags&131072)!==0}else pa=!1,Ct&&(a.flags&1048576)!==0&&Tu(a,Br,a.index);switch(a.lanes=0,a.tag){case 16:e:{var n=a.pendingProps;if(t=Dn(a.elementType),a.type=t,typeof t=="function")bc(t)?(n=An(t,n),a.tag=1,a=Im(null,a,t,n,s)):(a.tag=0,a=oo(null,a,t,n,s));else{if(t!=null){var o=t.$$typeof;if(o===E){a.tag=11,a=Hm(null,a,t,n,s);break e}else if(o===ae){a.tag=14,a=Bm(null,a,t,n,s);break e}}throw a=B(t)||t,Error(i(306,a,""))}}return a;case 0:return oo(t,a,a.type,a.pendingProps,s);case 1:return n=a.type,o=An(n,a.pendingProps),Im(t,a,n,o,s);case 3:e:{if(ye(a,a.stateNode.containerInfo),t===null)throw Error(i(387));n=a.pendingProps;var u=a.memoizedState;o=u.element,qc(t,a),Xr(a,n,null,s);var f=a.memoizedState;if(n=f.cache,Qs(a,ma,n),n!==u.cache&&Tc(a,[ma],s,!0),Qr(),n=f.element,u.isDehydrated)if(u={element:n,isDehydrated:!1,cache:f.cache},a.updateQueue.baseState=u,a.memoizedState=u,a.flags&256){a=Qm(t,a,n,s);break e}else if(n!==o){o=ts(Error(i(424)),a),$r(o),a=Qm(t,a,n,s);break e}else{switch(t=a.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Jt=ls(t.firstChild),Ca=a,Ct=!0,Ys=null,ns=!0,s=Pu(a,null,n,s),a.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling}else{if(Cn(),n===o){a=Ds(t,a,s);break e}ka(t,a,n,s)}a=a.child}return a;case 26:return li(t,a),t===null?(s=op(a.type,null,a.pendingProps,null))?a.memoizedState=s:Ct||(s=a.type,t=a.pendingProps,n=Ni(fe.current).createElement(s),n[ot]=a,n[ht]=t,Ea(n,s,t),zt(n),a.stateNode=n):a.memoizedState=op(a.type,t.memoizedProps,a.pendingProps,t.memoizedState),null;case 27:return ze(a),t===null&&Ct&&(n=a.stateNode=lp(a.type,a.pendingProps,fe.current),Ca=a,ns=!0,o=Jt,cn(a.type)?(Zo=o,Jt=ls(n.firstChild)):Jt=o),ka(t,a,a.pendingProps.children,s),li(t,a),t===null&&(a.flags|=4194304),a.child;case 5:return t===null&&Ct&&((o=n=Jt)&&(n=px(n,a.type,a.pendingProps,ns),n!==null?(a.stateNode=n,Ca=a,Jt=ls(n.firstChild),ns=!1,o=!0):o=!1),o||Is(a)),ze(a),o=a.type,u=a.pendingProps,f=t!==null?t.memoizedProps:null,n=u.children,Go(o,u)?n=null:f!==null&&Go(o,f)&&(a.flags|=32),a.memoizedState!==null&&(o=Pc(t,a,Dg,null,null,s),fl._currentValue=o),li(t,a),ka(t,a,n,s),a.child;case 6:return t===null&&Ct&&((t=s=Jt)&&(s=fx(s,a.pendingProps,ns),s!==null?(a.stateNode=s,Ca=a,Jt=null,t=!0):t=!1),t||Is(a)),null;case 13:return Xm(t,a,s);case 4:return ye(a,a.stateNode.containerInfo),n=a.pendingProps,t===null?a.child=Mn(a,null,n,s):ka(t,a,n,s),a.child;case 11:return Hm(t,a,a.type,a.pendingProps,s);case 7:return ka(t,a,a.pendingProps,s),a.child;case 8:return ka(t,a,a.pendingProps.children,s),a.child;case 12:return ka(t,a,a.pendingProps.children,s),a.child;case 10:return n=a.pendingProps,Qs(a,a.type,n.value),ka(t,a,n.children,s),a.child;case 9:return o=a.type._context,n=a.pendingProps.children,kn(a),o=wa(o),n=n(o),a.flags|=1,ka(t,a,n,s),a.child;case 14:return Bm(t,a,a.type,a.pendingProps,s);case 15:return $m(t,a,a.type,a.pendingProps,s);case 19:return Jm(t,a,s);case 31:return Fg(t,a,s);case 22:return Pm(t,a,s,a.pendingProps);case 24:return kn(a),n=wa(ma),t===null?(o=Ac(),o===null&&(o=Vt,u=Mc(),o.pooledCache=u,u.refCount++,u!==null&&(o.pooledCacheLanes|=s),o=u),a.memoizedState={parent:n,cache:o},Rc(a),Qs(a,ma,o)):((t.lanes&s)!==0&&(qc(t,a),Xr(a,null,null,s),Qr()),o=t.memoizedState,u=a.memoizedState,o.parent!==n?(o={parent:n,cache:n},a.memoizedState=o,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=o),Qs(a,ma,n)):(n=u.cache,Qs(a,ma,n),n!==o.cache&&Tc(a,[ma],s,!0))),ka(t,a,a.pendingProps.children,s),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function Ts(t){t.flags|=4}function jo(t,a,s,n,o){if((a=(t.mode&32)!==0)&&(a=!1),a){if(t.flags|=16777216,(o&335544128)===o)if(t.stateNode.complete)t.flags|=8192;else if(Ch())t.flags|=8192;else throw Tn=Gl,Oc}else t.flags&=-16777217}function Km(t,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!pp(a))if(Ch())t.flags|=8192;else throw Tn=Gl,Oc}function ci(t,a){a!==null&&(t.flags|=4),t.flags&16384&&(a=t.tag!==22?Ce():536870912,t.lanes|=a,gr|=a)}function tl(t,a){if(!Ct)switch(t.tailMode){case"hidden":a=t.tail;for(var s=null;a!==null;)a.alternate!==null&&(s=a),a=a.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?a||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function Wt(t){var a=t.alternate!==null&&t.alternate.child===t.child,s=0,n=0;if(a)for(var o=t.child;o!==null;)s|=o.lanes|o.childLanes,n|=o.subtreeFlags&65011712,n|=o.flags&65011712,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)s|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=n,t.childLanes=s,a}function Ug(t,a,s){var n=a.pendingProps;switch(Cc(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wt(a),null;case 1:return Wt(a),null;case 3:return s=a.stateNode,n=null,t!==null&&(n=t.memoizedState.cache),a.memoizedState.cache!==n&&(a.flags|=2048),ws(ma),Fe(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(sr(a)?Ts(a):t===null||t.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,kc())),Wt(a),null;case 26:var o=a.type,u=a.memoizedState;return t===null?(Ts(a),u!==null?(Wt(a),Km(a,u)):(Wt(a),jo(a,o,null,n,s))):u?u!==t.memoizedState?(Ts(a),Wt(a),Km(a,u)):(Wt(a),a.flags&=-16777217):(t=t.memoizedProps,t!==n&&Ts(a),Wt(a),jo(a,o,t,n,s)),null;case 27:if(Me(a),s=fe.current,o=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==n&&Ts(a);else{if(!n){if(a.stateNode===null)throw Error(i(166));return Wt(a),null}t=ne.current,sr(a)?zu(a):(t=lp(o,n,s),a.stateNode=t,Ts(a))}return Wt(a),null;case 5:if(Me(a),o=a.type,t!==null&&a.stateNode!=null)t.memoizedProps!==n&&Ts(a);else{if(!n){if(a.stateNode===null)throw Error(i(166));return Wt(a),null}if(u=ne.current,sr(a))zu(a);else{var f=Ni(fe.current);switch(u){case 1:u=f.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:u=f.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":u=f.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":u=f.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":u=f.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild);break;case"select":u=typeof n.is=="string"?f.createElement("select",{is:n.is}):f.createElement("select"),n.multiple?u.multiple=!0:n.size&&(u.size=n.size);break;default:u=typeof n.is=="string"?f.createElement(o,{is:n.is}):f.createElement(o)}}u[ot]=a,u[ht]=n;e:for(f=a.child;f!==null;){if(f.tag===5||f.tag===6)u.appendChild(f.stateNode);else if(f.tag!==4&&f.tag!==27&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===a)break e;for(;f.sibling===null;){if(f.return===null||f.return===a)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}a.stateNode=u;e:switch(Ea(u,o,n),o){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&Ts(a)}}return Wt(a),jo(a,a.type,t===null?null:t.memoizedProps,a.pendingProps,s),null;case 6:if(t&&a.stateNode!=null)t.memoizedProps!==n&&Ts(a);else{if(typeof n!="string"&&a.stateNode===null)throw Error(i(166));if(t=fe.current,sr(a)){if(t=a.stateNode,s=a.memoizedProps,n=null,o=Ca,o!==null)switch(o.tag){case 27:case 5:n=o.memoizedProps}t[ot]=a,t=!!(t.nodeValue===s||n!==null&&n.suppressHydrationWarning===!0||Xh(t.nodeValue,s)),t||Is(a,!0)}else t=Ni(t).createTextNode(n),t[ot]=a,a.stateNode=t}return Wt(a),null;case 31:if(s=a.memoizedState,t===null||t.memoizedState!==null){if(n=sr(a),s!==null){if(t===null){if(!n)throw Error(i(318));if(t=a.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(i(557));t[ot]=a}else Cn(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Wt(a),t=!1}else s=kc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=s),t=!0;if(!t)return a.flags&256?(Qa(a),a):(Qa(a),null);if((a.flags&128)!==0)throw Error(i(558))}return Wt(a),null;case 13:if(n=a.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(o=sr(a),n!==null&&n.dehydrated!==null){if(t===null){if(!o)throw Error(i(318));if(o=a.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(i(317));o[ot]=a}else Cn(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Wt(a),o=!1}else o=kc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=o),o=!0;if(!o)return a.flags&256?(Qa(a),a):(Qa(a),null)}return Qa(a),(a.flags&128)!==0?(a.lanes=s,a):(s=n!==null,t=t!==null&&t.memoizedState!==null,s&&(n=a.child,o=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(o=n.alternate.memoizedState.cachePool.pool),u=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(u=n.memoizedState.cachePool.pool),u!==o&&(n.flags|=2048)),s!==t&&s&&(a.child.flags|=8192),ci(a,a.updateQueue),Wt(a),null);case 4:return Fe(),t===null&&Ho(a.stateNode.containerInfo),Wt(a),null;case 10:return ws(a.type),Wt(a),null;case 19:if(se(la),n=a.memoizedState,n===null)return Wt(a),null;if(o=(a.flags&128)!==0,u=n.rendering,u===null)if(o)tl(n,!1);else{if(ra!==0||t!==null&&(t.flags&128)!==0)for(t=a.child;t!==null;){if(u=Xl(t),u!==null){for(a.flags|=128,tl(n,!1),t=u.updateQueue,a.updateQueue=t,ci(a,t),a.subtreeFlags=0,t=s,s=a.child;s!==null;)ku(s,t),s=s.sibling;return Z(la,la.current&1|2),Ct&&Ss(a,n.treeForkCount),a.child}t=t.sibling}n.tail!==null&&tt()>hi&&(a.flags|=128,o=!0,tl(n,!1),a.lanes=4194304)}else{if(!o)if(t=Xl(u),t!==null){if(a.flags|=128,o=!0,t=t.updateQueue,a.updateQueue=t,ci(a,t),tl(n,!0),n.tail===null&&n.tailMode==="hidden"&&!u.alternate&&!Ct)return Wt(a),null}else 2*tt()-n.renderingStartTime>hi&&s!==536870912&&(a.flags|=128,o=!0,tl(n,!1),a.lanes=4194304);n.isBackwards?(u.sibling=a.child,a.child=u):(t=n.last,t!==null?t.sibling=u:a.child=u,n.last=u)}return n.tail!==null?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=tt(),t.sibling=null,s=la.current,Z(la,o?s&1|2:s&1),Ct&&Ss(a,n.treeForkCount),t):(Wt(a),null);case 22:case 23:return Qa(a),Hc(),n=a.memoizedState!==null,t!==null?t.memoizedState!==null!==n&&(a.flags|=8192):n&&(a.flags|=8192),n?(s&536870912)!==0&&(a.flags&128)===0&&(Wt(a),a.subtreeFlags&6&&(a.flags|=8192)):Wt(a),s=a.updateQueue,s!==null&&ci(a,s.retryQueue),s=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),n=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(n=a.memoizedState.cachePool.pool),n!==s&&(a.flags|=2048),t!==null&&se(En),null;case 24:return s=null,t!==null&&(s=t.memoizedState.cache),a.memoizedState.cache!==s&&(a.flags|=2048),ws(ma),Wt(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function Hg(t,a){switch(Cc(a),a.tag){case 1:return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 3:return ws(ma),Fe(),t=a.flags,(t&65536)!==0&&(t&128)===0?(a.flags=t&-65537|128,a):null;case 26:case 27:case 5:return Me(a),null;case 31:if(a.memoizedState!==null){if(Qa(a),a.alternate===null)throw Error(i(340));Cn()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 13:if(Qa(a),t=a.memoizedState,t!==null&&t.dehydrated!==null){if(a.alternate===null)throw Error(i(340));Cn()}return t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 19:return se(la),null;case 4:return Fe(),null;case 10:return ws(a.type),null;case 22:case 23:return Qa(a),Hc(),t!==null&&se(En),t=a.flags,t&65536?(a.flags=t&-65537|128,a):null;case 24:return ws(ma),null;case 25:return null;default:return null}}function eh(t,a){switch(Cc(a),a.tag){case 3:ws(ma),Fe();break;case 26:case 27:case 5:Me(a);break;case 4:Fe();break;case 31:a.memoizedState!==null&&Qa(a);break;case 13:Qa(a);break;case 19:se(la);break;case 10:ws(a.type);break;case 22:case 23:Qa(a),Hc(),t!==null&&se(En);break;case 24:ws(ma)}}function al(t,a){try{var s=a.updateQueue,n=s!==null?s.lastEffect:null;if(n!==null){var o=n.next;s=o;do{if((s.tag&t)===t){n=void 0;var u=s.create,f=s.inst;n=u(),f.destroy=n}s=s.next}while(s!==o)}}catch(N){Ut(a,a.return,N)}}function en(t,a,s){try{var n=a.updateQueue,o=n!==null?n.lastEffect:null;if(o!==null){var u=o.next;n=u;do{if((n.tag&t)===t){var f=n.inst,N=f.destroy;if(N!==void 0){f.destroy=void 0,o=a;var G=s,oe=N;try{oe()}catch(ve){Ut(o,G,ve)}}}n=n.next}while(n!==u)}}catch(ve){Ut(a,a.return,ve)}}function th(t){var a=t.updateQueue;if(a!==null){var s=t.stateNode;try{Gu(a,s)}catch(n){Ut(t,t.return,n)}}}function ah(t,a,s){s.props=An(t.type,t.memoizedProps),s.state=t.memoizedState;try{s.componentWillUnmount()}catch(n){Ut(t,a,n)}}function sl(t,a){try{var s=t.ref;if(s!==null){switch(t.tag){case 26:case 27:case 5:var n=t.stateNode;break;case 30:n=t.stateNode;break;default:n=t.stateNode}typeof s=="function"?t.refCleanup=s(n):s.current=n}}catch(o){Ut(t,a,o)}}function xs(t,a){var s=t.ref,n=t.refCleanup;if(s!==null)if(typeof n=="function")try{n()}catch(o){Ut(t,a,o)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(o){Ut(t,a,o)}else s.current=null}function sh(t){var a=t.type,s=t.memoizedProps,n=t.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":s.autoFocus&&n.focus();break e;case"img":s.src?n.src=s.src:s.srcSet&&(n.srcset=s.srcSet)}}catch(o){Ut(t,t.return,o)}}function vo(t,a,s){try{var n=t.stateNode;cx(n,t.type,s,a),n[ht]=a}catch(o){Ut(t,t.return,o)}}function nh(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&cn(t.type)||t.tag===4}function yo(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||nh(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&cn(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function bo(t,a,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,a?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(t,a):(a=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,a.appendChild(t),s=s._reactRootContainer,s!=null||a.onclick!==null||(a.onclick=bs));else if(n!==4&&(n===27&&cn(t.type)&&(s=t.stateNode,a=null),t=t.child,t!==null))for(bo(t,a,s),t=t.sibling;t!==null;)bo(t,a,s),t=t.sibling}function oi(t,a,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,a?s.insertBefore(t,a):s.appendChild(t);else if(n!==4&&(n===27&&cn(t.type)&&(s=t.stateNode),t=t.child,t!==null))for(oi(t,a,s),t=t.sibling;t!==null;)oi(t,a,s),t=t.sibling}function rh(t){var a=t.stateNode,s=t.memoizedProps;try{for(var n=t.type,o=a.attributes;o.length;)a.removeAttributeNode(o[0]);Ea(a,n,s),a[ot]=t,a[ht]=s}catch(u){Ut(t,t.return,u)}}var Ms=!1,fa=!1,_o=!1,lh=typeof WeakSet=="function"?WeakSet:Set,_a=null;function Bg(t,a){if(t=t.containerInfo,Po=Ti,t=ju(t),pc(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var n=s.getSelection&&s.getSelection();if(n&&n.rangeCount!==0){s=n.anchorNode;var o=n.anchorOffset,u=n.focusNode;n=n.focusOffset;try{s.nodeType,u.nodeType}catch{s=null;break e}var f=0,N=-1,G=-1,oe=0,ve=0,Se=t,he=null;t:for(;;){for(var ge;Se!==s||o!==0&&Se.nodeType!==3||(N=f+o),Se!==u||n!==0&&Se.nodeType!==3||(G=f+n),Se.nodeType===3&&(f+=Se.nodeValue.length),(ge=Se.firstChild)!==null;)he=Se,Se=ge;for(;;){if(Se===t)break t;if(he===s&&++oe===o&&(N=f),he===u&&++ve===n&&(G=f),(ge=Se.nextSibling)!==null)break;Se=he,he=Se.parentNode}Se=ge}s=N===-1||G===-1?null:{start:N,end:G}}else s=null}s=s||{start:0,end:0}}else s=null;for(Vo={focusedElem:t,selectionRange:s},Ti=!1,_a=a;_a!==null;)if(a=_a,t=a.child,(a.subtreeFlags&1028)!==0&&t!==null)t.return=a,_a=t;else for(;_a!==null;){switch(a=_a,u=a.alternate,t=a.flags,a.tag){case 0:if((t&4)!==0&&(t=a.updateQueue,t=t!==null?t.events:null,t!==null))for(s=0;s<t.length;s++)o=t[s],o.ref.impl=o.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&u!==null){t=void 0,s=a,o=u.memoizedProps,u=u.memoizedState,n=s.stateNode;try{var Ye=An(s.type,o);t=n.getSnapshotBeforeUpdate(Ye,u),n.__reactInternalSnapshotBeforeUpdate=t}catch(lt){Ut(s,s.return,lt)}}break;case 3:if((t&1024)!==0){if(t=a.stateNode.containerInfo,s=t.nodeType,s===9)Io(t);else if(s===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Io(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(i(163))}if(t=a.sibling,t!==null){t.return=a.return,_a=t;break}_a=a.return}}function ih(t,a,s){var n=s.flags;switch(s.tag){case 0:case 11:case 15:As(t,s),n&4&&al(5,s);break;case 1:if(As(t,s),n&4)if(t=s.stateNode,a===null)try{t.componentDidMount()}catch(f){Ut(s,s.return,f)}else{var o=An(s.type,a.memoizedProps);a=a.memoizedState;try{t.componentDidUpdate(o,a,t.__reactInternalSnapshotBeforeUpdate)}catch(f){Ut(s,s.return,f)}}n&64&&th(s),n&512&&sl(s,s.return);break;case 3:if(As(t,s),n&64&&(t=s.updateQueue,t!==null)){if(a=null,s.child!==null)switch(s.child.tag){case 27:case 5:a=s.child.stateNode;break;case 1:a=s.child.stateNode}try{Gu(t,a)}catch(f){Ut(s,s.return,f)}}break;case 27:a===null&&n&4&&rh(s);case 26:case 5:As(t,s),a===null&&n&4&&sh(s),n&512&&sl(s,s.return);break;case 12:As(t,s);break;case 31:As(t,s),n&4&&dh(t,s);break;case 13:As(t,s),n&4&&uh(t,s),n&64&&(t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(s=Zg.bind(null,s),gx(t,s))));break;case 22:if(n=s.memoizedState!==null||Ms,!n){a=a!==null&&a.memoizedState!==null||fa,o=Ms;var u=fa;Ms=n,(fa=a)&&!u?Os(t,s,(s.subtreeFlags&8772)!==0):As(t,s),Ms=o,fa=u}break;case 30:break;default:As(t,s)}}function ch(t){var a=t.alternate;a!==null&&(t.alternate=null,ch(a)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(a=t.stateNode,a!==null&&ya(a)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var ta=null,La=!1;function zs(t,a,s){for(s=s.child;s!==null;)oh(t,a,s),s=s.sibling}function oh(t,a,s){if(We&&typeof We.onCommitFiberUnmount=="function")try{We.onCommitFiberUnmount(St,s)}catch{}switch(s.tag){case 26:fa||xs(s,a),zs(t,a,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:fa||xs(s,a);var n=ta,o=La;cn(s.type)&&(ta=s.stateNode,La=!1),zs(t,a,s),ml(s.stateNode),ta=n,La=o;break;case 5:fa||xs(s,a);case 6:if(n=ta,o=La,ta=null,zs(t,a,s),ta=n,La=o,ta!==null)if(La)try{(ta.nodeType===9?ta.body:ta.nodeName==="HTML"?ta.ownerDocument.body:ta).removeChild(s.stateNode)}catch(u){Ut(s,a,u)}else try{ta.removeChild(s.stateNode)}catch(u){Ut(s,a,u)}break;case 18:ta!==null&&(La?(t=ta,tp(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,s.stateNode),Sr(t)):tp(ta,s.stateNode));break;case 4:n=ta,o=La,ta=s.stateNode.containerInfo,La=!0,zs(t,a,s),ta=n,La=o;break;case 0:case 11:case 14:case 15:en(2,s,a),fa||en(4,s,a),zs(t,a,s);break;case 1:fa||(xs(s,a),n=s.stateNode,typeof n.componentWillUnmount=="function"&&ah(s,a,n)),zs(t,a,s);break;case 21:zs(t,a,s);break;case 22:fa=(n=fa)||s.memoizedState!==null,zs(t,a,s),fa=n;break;default:zs(t,a,s)}}function dh(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{Sr(t)}catch(s){Ut(a,a.return,s)}}}function uh(t,a){if(a.memoizedState===null&&(t=a.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{Sr(t)}catch(s){Ut(a,a.return,s)}}function $g(t){switch(t.tag){case 31:case 13:case 19:var a=t.stateNode;return a===null&&(a=t.stateNode=new lh),a;case 22:return t=t.stateNode,a=t._retryCache,a===null&&(a=t._retryCache=new lh),a;default:throw Error(i(435,t.tag))}}function di(t,a){var s=$g(t);a.forEach(function(n){if(!s.has(n)){s.add(n);var o=Jg.bind(null,t,n);n.then(o,o)}})}function Ua(t,a){var s=a.deletions;if(s!==null)for(var n=0;n<s.length;n++){var o=s[n],u=t,f=a,N=f;e:for(;N!==null;){switch(N.tag){case 27:if(cn(N.type)){ta=N.stateNode,La=!1;break e}break;case 5:ta=N.stateNode,La=!1;break e;case 3:case 4:ta=N.stateNode.containerInfo,La=!0;break e}N=N.return}if(ta===null)throw Error(i(160));oh(u,f,o),ta=null,La=!1,u=o.alternate,u!==null&&(u.return=null),o.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)mh(a,t),a=a.sibling}var ms=null;function mh(t,a){var s=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Ua(a,t),Ha(t),n&4&&(en(3,t,t.return),al(3,t),en(5,t,t.return));break;case 1:Ua(a,t),Ha(t),n&512&&(fa||s===null||xs(s,s.return)),n&64&&Ms&&(t=t.updateQueue,t!==null&&(n=t.callbacks,n!==null&&(s=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=s===null?n:s.concat(n))));break;case 26:var o=ms;if(Ua(a,t),Ha(t),n&512&&(fa||s===null||xs(s,s.return)),n&4){var u=s!==null?s.memoizedState:null;if(n=t.memoizedState,s===null)if(n===null)if(t.stateNode===null){e:{n=t.type,s=t.memoizedProps,o=o.ownerDocument||o;t:switch(n){case"title":u=o.getElementsByTagName("title")[0],(!u||u[Xt]||u[ot]||u.namespaceURI==="http://www.w3.org/2000/svg"||u.hasAttribute("itemprop"))&&(u=o.createElement(n),o.head.insertBefore(u,o.querySelector("head > title"))),Ea(u,n,s),u[ot]=t,zt(u),n=u;break e;case"link":var f=mp("link","href",o).get(n+(s.href||""));if(f){for(var N=0;N<f.length;N++)if(u=f[N],u.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&u.getAttribute("rel")===(s.rel==null?null:s.rel)&&u.getAttribute("title")===(s.title==null?null:s.title)&&u.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){f.splice(N,1);break t}}u=o.createElement(n),Ea(u,n,s),o.head.appendChild(u);break;case"meta":if(f=mp("meta","content",o).get(n+(s.content||""))){for(N=0;N<f.length;N++)if(u=f[N],u.getAttribute("content")===(s.content==null?null:""+s.content)&&u.getAttribute("name")===(s.name==null?null:s.name)&&u.getAttribute("property")===(s.property==null?null:s.property)&&u.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&u.getAttribute("charset")===(s.charSet==null?null:s.charSet)){f.splice(N,1);break t}}u=o.createElement(n),Ea(u,n,s),o.head.appendChild(u);break;default:throw Error(i(468,n))}u[ot]=t,zt(u),n=u}t.stateNode=n}else hp(o,t.type,t.stateNode);else t.stateNode=up(o,n,t.memoizedProps);else u!==n?(u===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):u.count--,n===null?hp(o,t.type,t.stateNode):up(o,n,t.memoizedProps)):n===null&&t.stateNode!==null&&vo(t,t.memoizedProps,s.memoizedProps)}break;case 27:Ua(a,t),Ha(t),n&512&&(fa||s===null||xs(s,s.return)),s!==null&&n&4&&vo(t,t.memoizedProps,s.memoizedProps);break;case 5:if(Ua(a,t),Ha(t),n&512&&(fa||s===null||xs(s,s.return)),t.flags&32){o=t.stateNode;try{In(o,"")}catch(Ye){Ut(t,t.return,Ye)}}n&4&&t.stateNode!=null&&(o=t.memoizedProps,vo(t,o,s!==null?s.memoizedProps:o)),n&1024&&(_o=!0);break;case 6:if(Ua(a,t),Ha(t),n&4){if(t.stateNode===null)throw Error(i(162));n=t.memoizedProps,s=t.stateNode;try{s.nodeValue=n}catch(Ye){Ut(t,t.return,Ye)}}break;case 3:if(wi=null,o=ms,ms=Si(a.containerInfo),Ua(a,t),ms=o,Ha(t),n&4&&s!==null&&s.memoizedState.isDehydrated)try{Sr(a.containerInfo)}catch(Ye){Ut(t,t.return,Ye)}_o&&(_o=!1,hh(t));break;case 4:n=ms,ms=Si(t.stateNode.containerInfo),Ua(a,t),Ha(t),ms=n;break;case 12:Ua(a,t),Ha(t);break;case 31:Ua(a,t),Ha(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,di(t,n)));break;case 13:Ua(a,t),Ha(t),t.child.flags&8192&&t.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(mi=tt()),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,di(t,n)));break;case 22:o=t.memoizedState!==null;var G=s!==null&&s.memoizedState!==null,oe=Ms,ve=fa;if(Ms=oe||o,fa=ve||G,Ua(a,t),fa=ve,Ms=oe,Ha(t),n&8192)e:for(a=t.stateNode,a._visibility=o?a._visibility&-2:a._visibility|1,o&&(s===null||G||Ms||fa||On(t)),s=null,a=t;;){if(a.tag===5||a.tag===26){if(s===null){G=s=a;try{if(u=G.stateNode,o)f=u.style,typeof f.setProperty=="function"?f.setProperty("display","none","important"):f.display="none";else{N=G.stateNode;var Se=G.memoizedProps.style,he=Se!=null&&Se.hasOwnProperty("display")?Se.display:null;N.style.display=he==null||typeof he=="boolean"?"":(""+he).trim()}}catch(Ye){Ut(G,G.return,Ye)}}}else if(a.tag===6){if(s===null){G=a;try{G.stateNode.nodeValue=o?"":G.memoizedProps}catch(Ye){Ut(G,G.return,Ye)}}}else if(a.tag===18){if(s===null){G=a;try{var ge=G.stateNode;o?ap(ge,!0):ap(G.stateNode,!1)}catch(Ye){Ut(G,G.return,Ye)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===t)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break e;for(;a.sibling===null;){if(a.return===null||a.return===t)break e;s===a&&(s=null),a=a.return}s===a&&(s=null),a.sibling.return=a.return,a=a.sibling}n&4&&(n=t.updateQueue,n!==null&&(s=n.retryQueue,s!==null&&(n.retryQueue=null,di(t,s))));break;case 19:Ua(a,t),Ha(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,di(t,n)));break;case 30:break;case 21:break;default:Ua(a,t),Ha(t)}}function Ha(t){var a=t.flags;if(a&2){try{for(var s,n=t.return;n!==null;){if(nh(n)){s=n;break}n=n.return}if(s==null)throw Error(i(160));switch(s.tag){case 27:var o=s.stateNode,u=yo(t);oi(t,u,o);break;case 5:var f=s.stateNode;s.flags&32&&(In(f,""),s.flags&=-33);var N=yo(t);oi(t,N,f);break;case 3:case 4:var G=s.stateNode.containerInfo,oe=yo(t);bo(t,oe,G);break;default:throw Error(i(161))}}catch(ve){Ut(t,t.return,ve)}t.flags&=-3}a&4096&&(t.flags&=-4097)}function hh(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var a=t;hh(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),t=t.sibling}}function As(t,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)ih(t,a.alternate,a),a=a.sibling}function On(t){for(t=t.child;t!==null;){var a=t;switch(a.tag){case 0:case 11:case 14:case 15:en(4,a,a.return),On(a);break;case 1:xs(a,a.return);var s=a.stateNode;typeof s.componentWillUnmount=="function"&&ah(a,a.return,s),On(a);break;case 27:ml(a.stateNode);case 26:case 5:xs(a,a.return),On(a);break;case 22:a.memoizedState===null&&On(a);break;case 30:On(a);break;default:On(a)}t=t.sibling}}function Os(t,a,s){for(s=s&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var n=a.alternate,o=t,u=a,f=u.flags;switch(u.tag){case 0:case 11:case 15:Os(o,u,s),al(4,u);break;case 1:if(Os(o,u,s),n=u,o=n.stateNode,typeof o.componentDidMount=="function")try{o.componentDidMount()}catch(oe){Ut(n,n.return,oe)}if(n=u,o=n.updateQueue,o!==null){var N=n.stateNode;try{var G=o.shared.hiddenCallbacks;if(G!==null)for(o.shared.hiddenCallbacks=null,o=0;o<G.length;o++)Vu(G[o],N)}catch(oe){Ut(n,n.return,oe)}}s&&f&64&&th(u),sl(u,u.return);break;case 27:rh(u);case 26:case 5:Os(o,u,s),s&&n===null&&f&4&&sh(u),sl(u,u.return);break;case 12:Os(o,u,s);break;case 31:Os(o,u,s),s&&f&4&&dh(o,u);break;case 13:Os(o,u,s),s&&f&4&&uh(o,u);break;case 22:u.memoizedState===null&&Os(o,u,s),sl(u,u.return);break;case 30:break;default:Os(o,u,s)}a=a.sibling}}function No(t,a){var s=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),t=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(t=a.memoizedState.cachePool.pool),t!==s&&(t!=null&&t.refCount++,s!=null&&Pr(s))}function So(t,a){t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&Pr(t))}function hs(t,a,s,n){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)ph(t,a,s,n),a=a.sibling}function ph(t,a,s,n){var o=a.flags;switch(a.tag){case 0:case 11:case 15:hs(t,a,s,n),o&2048&&al(9,a);break;case 1:hs(t,a,s,n);break;case 3:hs(t,a,s,n),o&2048&&(t=null,a.alternate!==null&&(t=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==t&&(a.refCount++,t!=null&&Pr(t)));break;case 12:if(o&2048){hs(t,a,s,n),t=a.stateNode;try{var u=a.memoizedProps,f=u.id,N=u.onPostCommit;typeof N=="function"&&N(f,a.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(G){Ut(a,a.return,G)}}else hs(t,a,s,n);break;case 31:hs(t,a,s,n);break;case 13:hs(t,a,s,n);break;case 23:break;case 22:u=a.stateNode,f=a.alternate,a.memoizedState!==null?u._visibility&2?hs(t,a,s,n):nl(t,a):u._visibility&2?hs(t,a,s,n):(u._visibility|=2,hr(t,a,s,n,(a.subtreeFlags&10256)!==0||!1)),o&2048&&No(f,a);break;case 24:hs(t,a,s,n),o&2048&&So(a.alternate,a);break;default:hs(t,a,s,n)}}function hr(t,a,s,n,o){for(o=o&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var u=t,f=a,N=s,G=n,oe=f.flags;switch(f.tag){case 0:case 11:case 15:hr(u,f,N,G,o),al(8,f);break;case 23:break;case 22:var ve=f.stateNode;f.memoizedState!==null?ve._visibility&2?hr(u,f,N,G,o):nl(u,f):(ve._visibility|=2,hr(u,f,N,G,o)),o&&oe&2048&&No(f.alternate,f);break;case 24:hr(u,f,N,G,o),o&&oe&2048&&So(f.alternate,f);break;default:hr(u,f,N,G,o)}a=a.sibling}}function nl(t,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var s=t,n=a,o=n.flags;switch(n.tag){case 22:nl(s,n),o&2048&&No(n.alternate,n);break;case 24:nl(s,n),o&2048&&So(n.alternate,n);break;default:nl(s,n)}a=a.sibling}}var rl=8192;function pr(t,a,s){if(t.subtreeFlags&rl)for(t=t.child;t!==null;)fh(t,a,s),t=t.sibling}function fh(t,a,s){switch(t.tag){case 26:pr(t,a,s),t.flags&rl&&t.memoizedState!==null&&Ex(s,ms,t.memoizedState,t.memoizedProps);break;case 5:pr(t,a,s);break;case 3:case 4:var n=ms;ms=Si(t.stateNode.containerInfo),pr(t,a,s),ms=n;break;case 22:t.memoizedState===null&&(n=t.alternate,n!==null&&n.memoizedState!==null?(n=rl,rl=16777216,pr(t,a,s),rl=n):pr(t,a,s));break;default:pr(t,a,s)}}function gh(t){var a=t.alternate;if(a!==null&&(t=a.child,t!==null)){a.child=null;do a=t.sibling,t.sibling=null,t=a;while(t!==null)}}function ll(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];_a=n,jh(n,t)}gh(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)xh(t),t=t.sibling}function xh(t){switch(t.tag){case 0:case 11:case 15:ll(t),t.flags&2048&&en(9,t,t.return);break;case 3:ll(t);break;case 12:ll(t);break;case 22:var a=t.stateNode;t.memoizedState!==null&&a._visibility&2&&(t.return===null||t.return.tag!==13)?(a._visibility&=-3,ui(t)):ll(t);break;default:ll(t)}}function ui(t){var a=t.deletions;if((t.flags&16)!==0){if(a!==null)for(var s=0;s<a.length;s++){var n=a[s];_a=n,jh(n,t)}gh(t)}for(t=t.child;t!==null;){switch(a=t,a.tag){case 0:case 11:case 15:en(8,a,a.return),ui(a);break;case 22:s=a.stateNode,s._visibility&2&&(s._visibility&=-3,ui(a));break;default:ui(a)}t=t.sibling}}function jh(t,a){for(;_a!==null;){var s=_a;switch(s.tag){case 0:case 11:case 15:en(8,s,a);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var n=s.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:Pr(s.memoizedState.cache)}if(n=s.child,n!==null)n.return=s,_a=n;else e:for(s=t;_a!==null;){n=_a;var o=n.sibling,u=n.return;if(ch(n),n===s){_a=null;break e}if(o!==null){o.return=u,_a=o;break e}_a=u}}}var Pg={getCacheForType:function(t){var a=wa(ma),s=a.data.get(t);return s===void 0&&(s=t(),a.data.set(t,s)),s},cacheSignal:function(){return wa(ma).controller.signal}},Vg=typeof WeakMap=="function"?WeakMap:Map,qt=0,Vt=null,vt=null,_t=0,Lt=0,Xa=null,tn=!1,fr=!1,Co=!1,Rs=0,ra=0,an=0,Rn=0,wo=0,Za=0,gr=0,il=null,Ba=null,ko=!1,mi=0,vh=0,hi=1/0,pi=null,sn=null,xa=0,nn=null,xr=null,qs=0,Eo=0,Do=null,yh=null,cl=0,To=null;function Ja(){return(qt&2)!==0&&_t!==0?_t&-_t:T.T!==null?qo():jt()}function bh(){if(Za===0)if((_t&536870912)===0||Ct){var t=Te;Te<<=1,(Te&3932160)===0&&(Te=262144),Za=t}else Za=536870912;return t=Ia.current,t!==null&&(t.flags|=32),Za}function $a(t,a,s){(t===Vt&&(Lt===2||Lt===9)||t.cancelPendingCommit!==null)&&(jr(t,0),rn(t,_t,Za,!1)),ut(t,s),((qt&2)===0||t!==Vt)&&(t===Vt&&((qt&2)===0&&(Rn|=s),ra===4&&rn(t,_t,Za,!1)),js(t))}function _h(t,a,s){if((qt&6)!==0)throw Error(i(327));var n=!s&&(a&127)===0&&(a&t.expiredLanes)===0||It(t,a),o=n?Ig(t,a):zo(t,a,!0),u=n;do{if(o===0){fr&&!n&&rn(t,a,0,!1);break}else{if(s=t.current.alternate,u&&!Gg(s)){o=zo(t,a,!1),u=!1;continue}if(o===2){if(u=a,t.errorRecoveryDisabledLanes&u)var f=0;else f=t.pendingLanes&-536870913,f=f!==0?f:f&536870912?536870912:0;if(f!==0){a=f;e:{var N=t;o=il;var G=N.current.memoizedState.isDehydrated;if(G&&(jr(N,f).flags|=256),f=zo(N,f,!1),f!==2){if(Co&&!G){N.errorRecoveryDisabledLanes|=u,Rn|=u,o=4;break e}u=Ba,Ba=o,u!==null&&(Ba===null?Ba=u:Ba.push.apply(Ba,u))}o=f}if(u=!1,o!==2)continue}}if(o===1){jr(t,0),rn(t,a,0,!0);break}e:{switch(n=t,u=o,u){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:rn(n,a,Za,!tn);break e;case 2:Ba=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(o=mi+300-tt(),10<o)){if(rn(n,a,Za,!tn),dt(n,0,!0)!==0)break e;qs=a,n.timeoutHandle=Kh(Nh.bind(null,n,s,Ba,pi,ko,a,Za,Rn,gr,tn,u,"Throttled",-0,0),o);break e}Nh(n,s,Ba,pi,ko,a,Za,Rn,gr,tn,u,null,-0,0)}}break}while(!0);js(t)}function Nh(t,a,s,n,o,u,f,N,G,oe,ve,Se,he,ge){if(t.timeoutHandle=-1,Se=a.subtreeFlags,Se&8192||(Se&16785408)===16785408){Se={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:bs},fh(a,u,Se);var Ye=(u&62914560)===u?mi-tt():(u&4194048)===u?vh-tt():0;if(Ye=Dx(Se,Ye),Ye!==null){qs=u,t.cancelPendingCommit=Ye(Mh.bind(null,t,a,u,s,n,o,f,N,G,ve,Se,null,he,ge)),rn(t,u,f,!oe);return}}Mh(t,a,u,s,n,o,f,N,G)}function Gg(t){for(var a=t;;){var s=a.tag;if((s===0||s===11||s===15)&&a.flags&16384&&(s=a.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var n=0;n<s.length;n++){var o=s[n],u=o.getSnapshot;o=o.value;try{if(!Ga(u(),o))return!1}catch{return!1}}if(s=a.child,a.subtreeFlags&16384&&s!==null)s.return=a,a=s;else{if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function rn(t,a,s,n){a&=~wo,a&=~Rn,t.suspendedLanes|=a,t.pingedLanes&=~a,n&&(t.warmLanes|=a),n=t.expirationTimes;for(var o=a;0<o;){var u=31-De(o),f=1<<u;n[u]=-1,o&=~f}s!==0&&Ee(t,s,a)}function fi(){return(qt&6)===0?(ol(0),!1):!0}function Mo(){if(vt!==null){if(Lt===0)var t=vt.return;else t=vt,Cs=wn=null,Yc(t),cr=null,Gr=0,t=vt;for(;t!==null;)eh(t.alternate,t),t=t.return;vt=null}}function jr(t,a){var s=t.timeoutHandle;s!==-1&&(t.timeoutHandle=-1,ux(s)),s=t.cancelPendingCommit,s!==null&&(t.cancelPendingCommit=null,s()),qs=0,Mo(),Vt=t,vt=s=Ns(t.current,null),_t=a,Lt=0,Xa=null,tn=!1,fr=It(t,a),Co=!1,gr=Za=wo=Rn=an=ra=0,Ba=il=null,ko=!1,(a&8)!==0&&(a|=a&32);var n=t.entangledLanes;if(n!==0)for(t=t.entanglements,n&=a;0<n;){var o=31-De(n),u=1<<o;a|=t[o],n&=~u}return Rs=a,ql(),s}function Sh(t,a){mt=null,T.H=Kr,a===ir||a===Vl?(a=Hu(),Lt=3):a===Oc?(a=Hu(),Lt=4):Lt=a===co?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Xa=a,vt===null&&(ra=1,ni(t,ts(a,t.current)))}function Ch(){var t=Ia.current;return t===null?!0:(_t&4194048)===_t?rs===null:(_t&62914560)===_t||(_t&536870912)!==0?t===rs:!1}function wh(){var t=T.H;return T.H=Kr,t===null?Kr:t}function kh(){var t=T.A;return T.A=Pg,t}function gi(){ra=4,tn||(_t&4194048)!==_t&&Ia.current!==null||(fr=!0),(an&134217727)===0&&(Rn&134217727)===0||Vt===null||rn(Vt,_t,Za,!1)}function zo(t,a,s){var n=qt;qt|=2;var o=wh(),u=kh();(Vt!==t||_t!==a)&&(pi=null,jr(t,a)),a=!1;var f=ra;e:do try{if(Lt!==0&&vt!==null){var N=vt,G=Xa;switch(Lt){case 8:Mo(),f=6;break e;case 3:case 2:case 9:case 6:Ia.current===null&&(a=!0);var oe=Lt;if(Lt=0,Xa=null,vr(t,N,G,oe),s&&fr){f=0;break e}break;default:oe=Lt,Lt=0,Xa=null,vr(t,N,G,oe)}}Yg(),f=ra;break}catch(ve){Sh(t,ve)}while(!0);return a&&t.shellSuspendCounter++,Cs=wn=null,qt=n,T.H=o,T.A=u,vt===null&&(Vt=null,_t=0,ql()),f}function Yg(){for(;vt!==null;)Eh(vt)}function Ig(t,a){var s=qt;qt|=2;var n=wh(),o=kh();Vt!==t||_t!==a?(pi=null,hi=tt()+500,jr(t,a)):fr=It(t,a);e:do try{if(Lt!==0&&vt!==null){a=vt;var u=Xa;t:switch(Lt){case 1:Lt=0,Xa=null,vr(t,a,u,1);break;case 2:case 9:if(Lu(u)){Lt=0,Xa=null,Dh(a);break}a=function(){Lt!==2&&Lt!==9||Vt!==t||(Lt=7),js(t)},u.then(a,a);break e;case 3:Lt=7;break e;case 4:Lt=5;break e;case 7:Lu(u)?(Lt=0,Xa=null,Dh(a)):(Lt=0,Xa=null,vr(t,a,u,7));break;case 5:var f=null;switch(vt.tag){case 26:f=vt.memoizedState;case 5:case 27:var N=vt;if(f?pp(f):N.stateNode.complete){Lt=0,Xa=null;var G=N.sibling;if(G!==null)vt=G;else{var oe=N.return;oe!==null?(vt=oe,xi(oe)):vt=null}break t}}Lt=0,Xa=null,vr(t,a,u,5);break;case 6:Lt=0,Xa=null,vr(t,a,u,6);break;case 8:Mo(),ra=6;break e;default:throw Error(i(462))}}Qg();break}catch(ve){Sh(t,ve)}while(!0);return Cs=wn=null,T.H=n,T.A=o,qt=s,vt!==null?0:(Vt=null,_t=0,ql(),ra)}function Qg(){for(;vt!==null&&!Je();)Eh(vt)}function Eh(t){var a=Wm(t.alternate,t,Rs);t.memoizedProps=t.pendingProps,a===null?xi(t):vt=a}function Dh(t){var a=t,s=a.alternate;switch(a.tag){case 15:case 0:a=Ym(s,a,a.pendingProps,a.type,void 0,_t);break;case 11:a=Ym(s,a,a.pendingProps,a.type.render,a.ref,_t);break;case 5:Yc(a);default:eh(s,a),a=vt=ku(a,Rs),a=Wm(s,a,Rs)}t.memoizedProps=t.pendingProps,a===null?xi(t):vt=a}function vr(t,a,s,n){Cs=wn=null,Yc(a),cr=null,Gr=0;var o=a.return;try{if(qg(t,o,a,s,_t)){ra=1,ni(t,ts(s,t.current)),vt=null;return}}catch(u){if(o!==null)throw vt=o,u;ra=1,ni(t,ts(s,t.current)),vt=null;return}a.flags&32768?(Ct||n===1?t=!0:fr||(_t&536870912)!==0?t=!1:(tn=t=!0,(n===2||n===9||n===3||n===6)&&(n=Ia.current,n!==null&&n.tag===13&&(n.flags|=16384))),Th(a,t)):xi(a)}function xi(t){var a=t;do{if((a.flags&32768)!==0){Th(a,tn);return}t=a.return;var s=Ug(a.alternate,a,Rs);if(s!==null){vt=s;return}if(a=a.sibling,a!==null){vt=a;return}vt=a=t}while(a!==null);ra===0&&(ra=5)}function Th(t,a){do{var s=Hg(t.alternate,t);if(s!==null){s.flags&=32767,vt=s;return}if(s=t.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!a&&(t=t.sibling,t!==null)){vt=t;return}vt=t=s}while(t!==null);ra=6,vt=null}function Mh(t,a,s,n,o,u,f,N,G){t.cancelPendingCommit=null;do ji();while(xa!==0);if((qt&6)!==0)throw Error(i(327));if(a!==null){if(a===t.current)throw Error(i(177));if(u=a.lanes|a.childLanes,u|=vc,qa(t,s,u,f,N,G),t===Vt&&(vt=Vt=null,_t=0),xr=a,nn=t,qs=s,Eo=u,Do=o,yh=n,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,Wg(Mt,function(){return qh(),null})):(t.callbackNode=null,t.callbackPriority=0),n=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||n){n=T.T,T.T=null,o=ee.p,ee.p=2,f=qt,qt|=4;try{Bg(t,a,s)}finally{qt=f,ee.p=o,T.T=n}}xa=1,zh(),Ah(),Oh()}}function zh(){if(xa===1){xa=0;var t=nn,a=xr,s=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||s){s=T.T,T.T=null;var n=ee.p;ee.p=2;var o=qt;qt|=4;try{mh(a,t);var u=Vo,f=ju(t.containerInfo),N=u.focusedElem,G=u.selectionRange;if(f!==N&&N&&N.ownerDocument&&xu(N.ownerDocument.documentElement,N)){if(G!==null&&pc(N)){var oe=G.start,ve=G.end;if(ve===void 0&&(ve=oe),"selectionStart"in N)N.selectionStart=oe,N.selectionEnd=Math.min(ve,N.value.length);else{var Se=N.ownerDocument||document,he=Se&&Se.defaultView||window;if(he.getSelection){var ge=he.getSelection(),Ye=N.textContent.length,lt=Math.min(G.start,Ye),$t=G.end===void 0?lt:Math.min(G.end,Ye);!ge.extend&&lt>$t&&(f=$t,$t=lt,lt=f);var te=gu(N,lt),Q=gu(N,$t);if(te&&Q&&(ge.rangeCount!==1||ge.anchorNode!==te.node||ge.anchorOffset!==te.offset||ge.focusNode!==Q.node||ge.focusOffset!==Q.offset)){var ie=Se.createRange();ie.setStart(te.node,te.offset),ge.removeAllRanges(),lt>$t?(ge.addRange(ie),ge.extend(Q.node,Q.offset)):(ie.setEnd(Q.node,Q.offset),ge.addRange(ie))}}}}for(Se=[],ge=N;ge=ge.parentNode;)ge.nodeType===1&&Se.push({element:ge,left:ge.scrollLeft,top:ge.scrollTop});for(typeof N.focus=="function"&&N.focus(),N=0;N<Se.length;N++){var _e=Se[N];_e.element.scrollLeft=_e.left,_e.element.scrollTop=_e.top}}Ti=!!Po,Vo=Po=null}finally{qt=o,ee.p=n,T.T=s}}t.current=a,xa=2}}function Ah(){if(xa===2){xa=0;var t=nn,a=xr,s=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||s){s=T.T,T.T=null;var n=ee.p;ee.p=2;var o=qt;qt|=4;try{ih(t,a.alternate,a)}finally{qt=o,ee.p=n,T.T=s}}xa=3}}function Oh(){if(xa===4||xa===3){xa=0,et();var t=nn,a=xr,s=qs,n=yh;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?xa=5:(xa=0,xr=nn=null,Rh(t,t.pendingLanes));var o=t.pendingLanes;if(o===0&&(sn=null),Re(s),a=a.stateNode,We&&typeof We.onCommitFiberRoot=="function")try{We.onCommitFiberRoot(St,a,void 0,(a.current.flags&128)===128)}catch{}if(n!==null){a=T.T,o=ee.p,ee.p=2,T.T=null;try{for(var u=t.onRecoverableError,f=0;f<n.length;f++){var N=n[f];u(N.value,{componentStack:N.stack})}}finally{T.T=a,ee.p=o}}(qs&3)!==0&&ji(),js(t),o=t.pendingLanes,(s&261930)!==0&&(o&42)!==0?t===To?cl++:(cl=0,To=t):cl=0,ol(0)}}function Rh(t,a){(t.pooledCacheLanes&=a)===0&&(a=t.pooledCache,a!=null&&(t.pooledCache=null,Pr(a)))}function ji(){return zh(),Ah(),Oh(),qh()}function qh(){if(xa!==5)return!1;var t=nn,a=Eo;Eo=0;var s=Re(qs),n=T.T,o=ee.p;try{ee.p=32>s?32:s,T.T=null,s=Do,Do=null;var u=nn,f=qs;if(xa=0,xr=nn=null,qs=0,(qt&6)!==0)throw Error(i(331));var N=qt;if(qt|=4,xh(u.current),ph(u,u.current,f,s),qt=N,ol(0,!1),We&&typeof We.onPostCommitFiberRoot=="function")try{We.onPostCommitFiberRoot(St,u)}catch{}return!0}finally{ee.p=o,T.T=n,Rh(t,a)}}function Fh(t,a,s){a=ts(s,a),a=io(t.stateNode,a,2),t=Js(t,a,2),t!==null&&(ut(t,2),js(t))}function Ut(t,a,s){if(t.tag===3)Fh(t,t,s);else for(;a!==null;){if(a.tag===3){Fh(a,t,s);break}else if(a.tag===1){var n=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(sn===null||!sn.has(n))){t=ts(s,t),s=Lm(2),n=Js(a,s,2),n!==null&&(Um(s,n,a,t),ut(n,2),js(n));break}}a=a.return}}function Ao(t,a,s){var n=t.pingCache;if(n===null){n=t.pingCache=new Vg;var o=new Set;n.set(a,o)}else o=n.get(a),o===void 0&&(o=new Set,n.set(a,o));o.has(s)||(Co=!0,o.add(s),t=Xg.bind(null,t,a,s),a.then(t,t))}function Xg(t,a,s){var n=t.pingCache;n!==null&&n.delete(a),t.pingedLanes|=t.suspendedLanes&s,t.warmLanes&=~s,Vt===t&&(_t&s)===s&&(ra===4||ra===3&&(_t&62914560)===_t&&300>tt()-mi?(qt&2)===0&&jr(t,0):wo|=s,gr===_t&&(gr=0)),js(t)}function Lh(t,a){a===0&&(a=Ce()),t=Nn(t,a),t!==null&&(ut(t,a),js(t))}function Zg(t){var a=t.memoizedState,s=0;a!==null&&(s=a.retryLane),Lh(t,s)}function Jg(t,a){var s=0;switch(t.tag){case 31:case 13:var n=t.stateNode,o=t.memoizedState;o!==null&&(s=o.retryLane);break;case 19:n=t.stateNode;break;case 22:n=t.stateNode._retryCache;break;default:throw Error(i(314))}n!==null&&n.delete(a),Lh(t,s)}function Wg(t,a){return Le(t,a)}var vi=null,yr=null,Oo=!1,yi=!1,Ro=!1,ln=0;function js(t){t!==yr&&t.next===null&&(yr===null?vi=yr=t:yr=yr.next=t),yi=!0,Oo||(Oo=!0,ex())}function ol(t,a){if(!Ro&&yi){Ro=!0;do for(var s=!1,n=vi;n!==null;){if(t!==0){var o=n.pendingLanes;if(o===0)var u=0;else{var f=n.suspendedLanes,N=n.pingedLanes;u=(1<<31-De(42|t)+1)-1,u&=o&~(f&~N),u=u&201326741?u&201326741|1:u?u|2:0}u!==0&&(s=!0,$h(n,u))}else u=_t,u=dt(n,n===Vt?u:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(u&3)===0||It(n,u)||(s=!0,$h(n,u));n=n.next}while(s);Ro=!1}}function Kg(){Uh()}function Uh(){yi=Oo=!1;var t=0;ln!==0&&dx()&&(t=ln);for(var a=tt(),s=null,n=vi;n!==null;){var o=n.next,u=Hh(n,a);u===0?(n.next=null,s===null?vi=o:s.next=o,o===null&&(yr=s)):(s=n,(t!==0||(u&3)!==0)&&(yi=!0)),n=o}xa!==0&&xa!==5||ol(t),ln!==0&&(ln=0)}function Hh(t,a){for(var s=t.suspendedLanes,n=t.pingedLanes,o=t.expirationTimes,u=t.pendingLanes&-62914561;0<u;){var f=31-De(u),N=1<<f,G=o[f];G===-1?((N&s)===0||(N&n)!==0)&&(o[f]=sa(N,a)):G<=a&&(t.expiredLanes|=N),u&=~N}if(a=Vt,s=_t,s=dt(t,t===a?s:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n=t.callbackNode,s===0||t===a&&(Lt===2||Lt===9)||t.cancelPendingCommit!==null)return n!==null&&n!==null&&$e(n),t.callbackNode=null,t.callbackPriority=0;if((s&3)===0||It(t,s)){if(a=s&-s,a===t.callbackPriority)return a;switch(n!==null&&$e(n),Re(s)){case 2:case 8:s=kt;break;case 32:s=Mt;break;case 268435456:s=Dt;break;default:s=Mt}return n=Bh.bind(null,t),s=Le(s,n),t.callbackPriority=a,t.callbackNode=s,a}return n!==null&&n!==null&&$e(n),t.callbackPriority=2,t.callbackNode=null,2}function Bh(t,a){if(xa!==0&&xa!==5)return t.callbackNode=null,t.callbackPriority=0,null;var s=t.callbackNode;if(ji()&&t.callbackNode!==s)return null;var n=_t;return n=dt(t,t===Vt?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n===0?null:(_h(t,n,a),Hh(t,tt()),t.callbackNode!=null&&t.callbackNode===s?Bh.bind(null,t):null)}function $h(t,a){if(ji())return null;_h(t,a,!0)}function ex(){mx(function(){(qt&6)!==0?Le(bt,Kg):Uh()})}function qo(){if(ln===0){var t=rr;t===0&&(t=it,it<<=1,(it&261888)===0&&(it=256)),ln=t}return ln}function Ph(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:El(""+t)}function Vh(t,a){var s=a.ownerDocument.createElement("input");return s.name=a.name,s.value=a.value,t.id&&s.setAttribute("form",t.id),a.parentNode.insertBefore(s,a),t=new FormData(t),s.parentNode.removeChild(s),t}function tx(t,a,s,n,o){if(a==="submit"&&s&&s.stateNode===o){var u=Ph((o[ht]||null).action),f=n.submitter;f&&(a=(a=f[ht]||null)?Ph(a.formAction):f.getAttribute("formAction"),a!==null&&(u=a,f=null));var N=new zl("action","action",null,n,o);t.push({event:N,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(ln!==0){var G=f?Vh(o,f):new FormData(o);to(s,{pending:!0,data:G,method:o.method,action:u},null,G)}}else typeof u=="function"&&(N.preventDefault(),G=f?Vh(o,f):new FormData(o),to(s,{pending:!0,data:G,method:o.method,action:u},u,G))},currentTarget:o}]})}}for(var Fo=0;Fo<jc.length;Fo++){var Lo=jc[Fo],ax=Lo.toLowerCase(),sx=Lo[0].toUpperCase()+Lo.slice(1);us(ax,"on"+sx)}us(bu,"onAnimationEnd"),us(_u,"onAnimationIteration"),us(Nu,"onAnimationStart"),us("dblclick","onDoubleClick"),us("focusin","onFocus"),us("focusout","onBlur"),us(vg,"onTransitionRun"),us(yg,"onTransitionStart"),us(bg,"onTransitionCancel"),us(Su,"onTransitionEnd"),At("onMouseEnter",["mouseout","mouseover"]),At("onMouseLeave",["mouseout","mouseover"]),At("onPointerEnter",["pointerout","pointerover"]),At("onPointerLeave",["pointerout","pointerover"]),at("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),at("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),at("onBeforeInput",["compositionend","keypress","textInput","paste"]),at("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),at("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),at("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var dl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nx=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(dl));function Gh(t,a){a=(a&4)!==0;for(var s=0;s<t.length;s++){var n=t[s],o=n.event;n=n.listeners;e:{var u=void 0;if(a)for(var f=n.length-1;0<=f;f--){var N=n[f],G=N.instance,oe=N.currentTarget;if(N=N.listener,G!==u&&o.isPropagationStopped())break e;u=N,o.currentTarget=oe;try{u(o)}catch(ve){Rl(ve)}o.currentTarget=null,u=G}else for(f=0;f<n.length;f++){if(N=n[f],G=N.instance,oe=N.currentTarget,N=N.listener,G!==u&&o.isPropagationStopped())break e;u=N,o.currentTarget=oe;try{u(o)}catch(ve){Rl(ve)}o.currentTarget=null,u=G}}}}function yt(t,a){var s=a[Qt];s===void 0&&(s=a[Qt]=new Set);var n=t+"__bubble";s.has(n)||(Yh(a,t,2,!1),s.add(n))}function Uo(t,a,s){var n=0;a&&(n|=4),Yh(s,t,n,a)}var bi="_reactListening"+Math.random().toString(36).slice(2);function Ho(t){if(!t[bi]){t[bi]=!0,Va.forEach(function(s){s!=="selectionchange"&&(nx.has(s)||Uo(s,!1,t),Uo(s,!0,t))});var a=t.nodeType===9?t:t.ownerDocument;a===null||a[bi]||(a[bi]=!0,Uo("selectionchange",!1,a))}}function Yh(t,a,s,n){switch(bp(a)){case 2:var o=zx;break;case 8:o=Ax;break;default:o=td}s=o.bind(null,a,s,t),o=void 0,!rc||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(o=!0),n?o!==void 0?t.addEventListener(a,s,{capture:!0,passive:o}):t.addEventListener(a,s,!0):o!==void 0?t.addEventListener(a,s,{passive:o}):t.addEventListener(a,s,!1)}function Bo(t,a,s,n,o){var u=n;if((a&1)===0&&(a&2)===0&&n!==null)e:for(;;){if(n===null)return;var f=n.tag;if(f===3||f===4){var N=n.stateNode.containerInfo;if(N===o)break;if(f===4)for(f=n.return;f!==null;){var G=f.tag;if((G===3||G===4)&&f.stateNode.containerInfo===o)return;f=f.return}for(;N!==null;){if(f=Pa(N),f===null)return;if(G=f.tag,G===5||G===6||G===26||G===27){n=u=f;continue e}N=N.parentNode}}n=n.return}Jd(function(){var oe=u,ve=sc(s),Se=[];e:{var he=Cu.get(t);if(he!==void 0){var ge=zl,Ye=t;switch(t){case"keypress":if(Tl(s)===0)break e;case"keydown":case"keyup":ge=Jf;break;case"focusin":Ye="focus",ge=oc;break;case"focusout":Ye="blur",ge=oc;break;case"beforeblur":case"afterblur":ge=oc;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ge=eu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ge=Uf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ge=eg;break;case bu:case _u:case Nu:ge=$f;break;case Su:ge=ag;break;case"scroll":case"scrollend":ge=Ff;break;case"wheel":ge=ng;break;case"copy":case"cut":case"paste":ge=Vf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ge=au;break;case"toggle":case"beforetoggle":ge=lg}var lt=(a&4)!==0,$t=!lt&&(t==="scroll"||t==="scrollend"),te=lt?he!==null?he+"Capture":null:he;lt=[];for(var Q=oe,ie;Q!==null;){var _e=Q;if(ie=_e.stateNode,_e=_e.tag,_e!==5&&_e!==26&&_e!==27||ie===null||te===null||(_e=zr(Q,te),_e!=null&&lt.push(ul(Q,_e,ie))),$t)break;Q=Q.return}0<lt.length&&(he=new ge(he,Ye,null,s,ve),Se.push({event:he,listeners:lt}))}}if((a&7)===0){e:{if(he=t==="mouseover"||t==="pointerover",ge=t==="mouseout"||t==="pointerout",he&&s!==ac&&(Ye=s.relatedTarget||s.fromElement)&&(Pa(Ye)||Ye[va]))break e;if((ge||he)&&(he=ve.window===ve?ve:(he=ve.ownerDocument)?he.defaultView||he.parentWindow:window,ge?(Ye=s.relatedTarget||s.toElement,ge=oe,Ye=Ye?Pa(Ye):null,Ye!==null&&($t=h(Ye),lt=Ye.tag,Ye!==$t||lt!==5&&lt!==27&&lt!==6)&&(Ye=null)):(ge=null,Ye=oe),ge!==Ye)){if(lt=eu,_e="onMouseLeave",te="onMouseEnter",Q="mouse",(t==="pointerout"||t==="pointerover")&&(lt=au,_e="onPointerLeave",te="onPointerEnter",Q="pointer"),$t=ge==null?he:Zt(ge),ie=Ye==null?he:Zt(Ye),he=new lt(_e,Q+"leave",ge,s,ve),he.target=$t,he.relatedTarget=ie,_e=null,Pa(ve)===oe&&(lt=new lt(te,Q+"enter",Ye,s,ve),lt.target=ie,lt.relatedTarget=$t,_e=lt),$t=_e,ge&&Ye)t:{for(lt=rx,te=ge,Q=Ye,ie=0,_e=te;_e;_e=lt(_e))ie++;_e=0;for(var Ke=Q;Ke;Ke=lt(Ke))_e++;for(;0<ie-_e;)te=lt(te),ie--;for(;0<_e-ie;)Q=lt(Q),_e--;for(;ie--;){if(te===Q||Q!==null&&te===Q.alternate){lt=te;break t}te=lt(te),Q=lt(Q)}lt=null}else lt=null;ge!==null&&Ih(Se,he,ge,lt,!1),Ye!==null&&$t!==null&&Ih(Se,$t,Ye,lt,!0)}}e:{if(he=oe?Zt(oe):window,ge=he.nodeName&&he.nodeName.toLowerCase(),ge==="select"||ge==="input"&&he.type==="file")var Ot=du;else if(cu(he))if(uu)Ot=gg;else{Ot=pg;var Xe=hg}else ge=he.nodeName,!ge||ge.toLowerCase()!=="input"||he.type!=="checkbox"&&he.type!=="radio"?oe&&tc(oe.elementType)&&(Ot=du):Ot=fg;if(Ot&&(Ot=Ot(t,oe))){ou(Se,Ot,s,ve);break e}Xe&&Xe(t,he,oe),t==="focusout"&&oe&&he.type==="number"&&oe.memoizedProps.value!=null&&ec(he,"number",he.value)}switch(Xe=oe?Zt(oe):window,t){case"focusin":(cu(Xe)||Xe.contentEditable==="true")&&(Jn=Xe,fc=oe,Hr=null);break;case"focusout":Hr=fc=Jn=null;break;case"mousedown":gc=!0;break;case"contextmenu":case"mouseup":case"dragend":gc=!1,vu(Se,s,ve);break;case"selectionchange":if(jg)break;case"keydown":case"keyup":vu(Se,s,ve)}var pt;if(uc)e:{switch(t){case"compositionstart":var Nt="onCompositionStart";break e;case"compositionend":Nt="onCompositionEnd";break e;case"compositionupdate":Nt="onCompositionUpdate";break e}Nt=void 0}else Zn?lu(t,s)&&(Nt="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(Nt="onCompositionStart");Nt&&(su&&s.locale!=="ko"&&(Zn||Nt!=="onCompositionStart"?Nt==="onCompositionEnd"&&Zn&&(pt=Wd()):(Vs=ve,lc="value"in Vs?Vs.value:Vs.textContent,Zn=!0)),Xe=_i(oe,Nt),0<Xe.length&&(Nt=new tu(Nt,t,null,s,ve),Se.push({event:Nt,listeners:Xe}),pt?Nt.data=pt:(pt=iu(s),pt!==null&&(Nt.data=pt)))),(pt=cg?og(t,s):dg(t,s))&&(Nt=_i(oe,"onBeforeInput"),0<Nt.length&&(Xe=new tu("onBeforeInput","beforeinput",null,s,ve),Se.push({event:Xe,listeners:Nt}),Xe.data=pt)),tx(Se,t,oe,s,ve)}Gh(Se,a)})}function ul(t,a,s){return{instance:t,listener:a,currentTarget:s}}function _i(t,a){for(var s=a+"Capture",n=[];t!==null;){var o=t,u=o.stateNode;if(o=o.tag,o!==5&&o!==26&&o!==27||u===null||(o=zr(t,s),o!=null&&n.unshift(ul(t,o,u)),o=zr(t,a),o!=null&&n.push(ul(t,o,u))),t.tag===3)return n;t=t.return}return[]}function rx(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function Ih(t,a,s,n,o){for(var u=a._reactName,f=[];s!==null&&s!==n;){var N=s,G=N.alternate,oe=N.stateNode;if(N=N.tag,G!==null&&G===n)break;N!==5&&N!==26&&N!==27||oe===null||(G=oe,o?(oe=zr(s,u),oe!=null&&f.unshift(ul(s,oe,G))):o||(oe=zr(s,u),oe!=null&&f.push(ul(s,oe,G)))),s=s.return}f.length!==0&&t.push({event:a,listeners:f})}var lx=/\r\n?/g,ix=/\u0000|\uFFFD/g;function Qh(t){return(typeof t=="string"?t:""+t).replace(lx,`
`).replace(ix,"")}function Xh(t,a){return a=Qh(a),Qh(t)===a}function Bt(t,a,s,n,o,u){switch(s){case"children":typeof n=="string"?a==="body"||a==="textarea"&&n===""||In(t,n):(typeof n=="number"||typeof n=="bigint")&&a!=="body"&&In(t,""+n);break;case"className":Ge(t,"class",n);break;case"tabIndex":Ge(t,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":Ge(t,s,n);break;case"style":Xd(t,n,u);break;case"data":if(a!=="object"){Ge(t,"data",n);break}case"src":case"href":if(n===""&&(a!=="a"||s!=="href")){t.removeAttribute(s);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=El(""+n),t.setAttribute(s,n);break;case"action":case"formAction":if(typeof n=="function"){t.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof u=="function"&&(s==="formAction"?(a!=="input"&&Bt(t,a,"name",o.name,o,null),Bt(t,a,"formEncType",o.formEncType,o,null),Bt(t,a,"formMethod",o.formMethod,o,null),Bt(t,a,"formTarget",o.formTarget,o,null)):(Bt(t,a,"encType",o.encType,o,null),Bt(t,a,"method",o.method,o,null),Bt(t,a,"target",o.target,o,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=El(""+n),t.setAttribute(s,n);break;case"onClick":n!=null&&(t.onclick=bs);break;case"onScroll":n!=null&&yt("scroll",t);break;case"onScrollEnd":n!=null&&yt("scrollend",t);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(i(61));if(s=n.__html,s!=null){if(o.children!=null)throw Error(i(60));t.innerHTML=s}}break;case"multiple":t.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":t.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){t.removeAttribute("xlink:href");break}s=El(""+n),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""+n):t.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""):t.removeAttribute(s);break;case"capture":case"download":n===!0?t.setAttribute(s,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,n):t.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?t.setAttribute(s,n):t.removeAttribute(s);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?t.removeAttribute(s):t.setAttribute(s,n);break;case"popover":yt("beforetoggle",t),yt("toggle",t),le(t,"popover",n);break;case"xlinkActuate":He(t,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":He(t,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":He(t,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":He(t,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":He(t,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":He(t,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":He(t,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":He(t,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":He(t,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":le(t,"is",n);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=Rf.get(s)||s,le(t,s,n))}}function $o(t,a,s,n,o,u){switch(s){case"style":Xd(t,n,u);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(i(61));if(s=n.__html,s!=null){if(o.children!=null)throw Error(i(60));t.innerHTML=s}}break;case"children":typeof n=="string"?In(t,n):(typeof n=="number"||typeof n=="bigint")&&In(t,""+n);break;case"onScroll":n!=null&&yt("scroll",t);break;case"onScrollEnd":n!=null&&yt("scrollend",t);break;case"onClick":n!=null&&(t.onclick=bs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ve.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(o=s.endsWith("Capture"),a=s.slice(2,o?s.length-7:void 0),u=t[ht]||null,u=u!=null?u[s]:null,typeof u=="function"&&t.removeEventListener(a,u,o),typeof n=="function")){typeof u!="function"&&u!==null&&(s in t?t[s]=null:t.hasAttribute(s)&&t.removeAttribute(s)),t.addEventListener(a,n,o);break e}s in t?t[s]=n:n===!0?t.setAttribute(s,""):le(t,s,n)}}}function Ea(t,a,s){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":yt("error",t),yt("load",t);var n=!1,o=!1,u;for(u in s)if(s.hasOwnProperty(u)){var f=s[u];if(f!=null)switch(u){case"src":n=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:Bt(t,a,u,f,s,null)}}o&&Bt(t,a,"srcSet",s.srcSet,s,null),n&&Bt(t,a,"src",s.src,s,null);return;case"input":yt("invalid",t);var N=u=f=o=null,G=null,oe=null;for(n in s)if(s.hasOwnProperty(n)){var ve=s[n];if(ve!=null)switch(n){case"name":o=ve;break;case"type":f=ve;break;case"checked":G=ve;break;case"defaultChecked":oe=ve;break;case"value":u=ve;break;case"defaultValue":N=ve;break;case"children":case"dangerouslySetInnerHTML":if(ve!=null)throw Error(i(137,a));break;default:Bt(t,a,n,ve,s,null)}}Gd(t,u,N,G,oe,f,o,!1);return;case"select":yt("invalid",t),n=f=u=null;for(o in s)if(s.hasOwnProperty(o)&&(N=s[o],N!=null))switch(o){case"value":u=N;break;case"defaultValue":f=N;break;case"multiple":n=N;default:Bt(t,a,o,N,s,null)}a=u,s=f,t.multiple=!!n,a!=null?Yn(t,!!n,a,!1):s!=null&&Yn(t,!!n,s,!0);return;case"textarea":yt("invalid",t),u=o=n=null;for(f in s)if(s.hasOwnProperty(f)&&(N=s[f],N!=null))switch(f){case"value":n=N;break;case"defaultValue":o=N;break;case"children":u=N;break;case"dangerouslySetInnerHTML":if(N!=null)throw Error(i(91));break;default:Bt(t,a,f,N,s,null)}Id(t,n,o,u);return;case"option":for(G in s)if(s.hasOwnProperty(G)&&(n=s[G],n!=null))switch(G){case"selected":t.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:Bt(t,a,G,n,s,null)}return;case"dialog":yt("beforetoggle",t),yt("toggle",t),yt("cancel",t),yt("close",t);break;case"iframe":case"object":yt("load",t);break;case"video":case"audio":for(n=0;n<dl.length;n++)yt(dl[n],t);break;case"image":yt("error",t),yt("load",t);break;case"details":yt("toggle",t);break;case"embed":case"source":case"link":yt("error",t),yt("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(oe in s)if(s.hasOwnProperty(oe)&&(n=s[oe],n!=null))switch(oe){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:Bt(t,a,oe,n,s,null)}return;default:if(tc(a)){for(ve in s)s.hasOwnProperty(ve)&&(n=s[ve],n!==void 0&&$o(t,a,ve,n,s,void 0));return}}for(N in s)s.hasOwnProperty(N)&&(n=s[N],n!=null&&Bt(t,a,N,n,s,null))}function cx(t,a,s,n){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var o=null,u=null,f=null,N=null,G=null,oe=null,ve=null;for(ge in s){var Se=s[ge];if(s.hasOwnProperty(ge)&&Se!=null)switch(ge){case"checked":break;case"value":break;case"defaultValue":G=Se;default:n.hasOwnProperty(ge)||Bt(t,a,ge,null,n,Se)}}for(var he in n){var ge=n[he];if(Se=s[he],n.hasOwnProperty(he)&&(ge!=null||Se!=null))switch(he){case"type":u=ge;break;case"name":o=ge;break;case"checked":oe=ge;break;case"defaultChecked":ve=ge;break;case"value":f=ge;break;case"defaultValue":N=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(i(137,a));break;default:ge!==Se&&Bt(t,a,he,ge,n,Se)}}Ki(t,f,N,G,oe,ve,u,o);return;case"select":ge=f=N=he=null;for(u in s)if(G=s[u],s.hasOwnProperty(u)&&G!=null)switch(u){case"value":break;case"multiple":ge=G;default:n.hasOwnProperty(u)||Bt(t,a,u,null,n,G)}for(o in n)if(u=n[o],G=s[o],n.hasOwnProperty(o)&&(u!=null||G!=null))switch(o){case"value":he=u;break;case"defaultValue":N=u;break;case"multiple":f=u;default:u!==G&&Bt(t,a,o,u,n,G)}a=N,s=f,n=ge,he!=null?Yn(t,!!s,he,!1):!!n!=!!s&&(a!=null?Yn(t,!!s,a,!0):Yn(t,!!s,s?[]:"",!1));return;case"textarea":ge=he=null;for(N in s)if(o=s[N],s.hasOwnProperty(N)&&o!=null&&!n.hasOwnProperty(N))switch(N){case"value":break;case"children":break;default:Bt(t,a,N,null,n,o)}for(f in n)if(o=n[f],u=s[f],n.hasOwnProperty(f)&&(o!=null||u!=null))switch(f){case"value":he=o;break;case"defaultValue":ge=o;break;case"children":break;case"dangerouslySetInnerHTML":if(o!=null)throw Error(i(91));break;default:o!==u&&Bt(t,a,f,o,n,u)}Yd(t,he,ge);return;case"option":for(var Ye in s)if(he=s[Ye],s.hasOwnProperty(Ye)&&he!=null&&!n.hasOwnProperty(Ye))switch(Ye){case"selected":t.selected=!1;break;default:Bt(t,a,Ye,null,n,he)}for(G in n)if(he=n[G],ge=s[G],n.hasOwnProperty(G)&&he!==ge&&(he!=null||ge!=null))switch(G){case"selected":t.selected=he&&typeof he!="function"&&typeof he!="symbol";break;default:Bt(t,a,G,he,n,ge)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var lt in s)he=s[lt],s.hasOwnProperty(lt)&&he!=null&&!n.hasOwnProperty(lt)&&Bt(t,a,lt,null,n,he);for(oe in n)if(he=n[oe],ge=s[oe],n.hasOwnProperty(oe)&&he!==ge&&(he!=null||ge!=null))switch(oe){case"children":case"dangerouslySetInnerHTML":if(he!=null)throw Error(i(137,a));break;default:Bt(t,a,oe,he,n,ge)}return;default:if(tc(a)){for(var $t in s)he=s[$t],s.hasOwnProperty($t)&&he!==void 0&&!n.hasOwnProperty($t)&&$o(t,a,$t,void 0,n,he);for(ve in n)he=n[ve],ge=s[ve],!n.hasOwnProperty(ve)||he===ge||he===void 0&&ge===void 0||$o(t,a,ve,he,n,ge);return}}for(var te in s)he=s[te],s.hasOwnProperty(te)&&he!=null&&!n.hasOwnProperty(te)&&Bt(t,a,te,null,n,he);for(Se in n)he=n[Se],ge=s[Se],!n.hasOwnProperty(Se)||he===ge||he==null&&ge==null||Bt(t,a,Se,he,n,ge)}function Zh(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ox(){if(typeof performance.getEntriesByType=="function"){for(var t=0,a=0,s=performance.getEntriesByType("resource"),n=0;n<s.length;n++){var o=s[n],u=o.transferSize,f=o.initiatorType,N=o.duration;if(u&&N&&Zh(f)){for(f=0,N=o.responseEnd,n+=1;n<s.length;n++){var G=s[n],oe=G.startTime;if(oe>N)break;var ve=G.transferSize,Se=G.initiatorType;ve&&Zh(Se)&&(G=G.responseEnd,f+=ve*(G<N?1:(N-oe)/(G-oe)))}if(--n,a+=8*(u+f)/(o.duration/1e3),t++,10<t)break}}if(0<t)return a/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var Po=null,Vo=null;function Ni(t){return t.nodeType===9?t:t.ownerDocument}function Jh(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Wh(t,a){if(t===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&a==="foreignObject"?0:t}function Go(t,a){return t==="textarea"||t==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Yo=null;function dx(){var t=window.event;return t&&t.type==="popstate"?t===Yo?!1:(Yo=t,!0):(Yo=null,!1)}var Kh=typeof setTimeout=="function"?setTimeout:void 0,ux=typeof clearTimeout=="function"?clearTimeout:void 0,ep=typeof Promise=="function"?Promise:void 0,mx=typeof queueMicrotask=="function"?queueMicrotask:typeof ep<"u"?function(t){return ep.resolve(null).then(t).catch(hx)}:Kh;function hx(t){setTimeout(function(){throw t})}function cn(t){return t==="head"}function tp(t,a){var s=a,n=0;do{var o=s.nextSibling;if(t.removeChild(s),o&&o.nodeType===8)if(s=o.data,s==="/$"||s==="/&"){if(n===0){t.removeChild(o),Sr(a);return}n--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")n++;else if(s==="html")ml(t.ownerDocument.documentElement);else if(s==="head"){s=t.ownerDocument.head,ml(s);for(var u=s.firstChild;u;){var f=u.nextSibling,N=u.nodeName;u[Xt]||N==="SCRIPT"||N==="STYLE"||N==="LINK"&&u.rel.toLowerCase()==="stylesheet"||s.removeChild(u),u=f}}else s==="body"&&ml(t.ownerDocument.body);s=o}while(s);Sr(a)}function ap(t,a){var s=t;t=0;do{var n=s.nextSibling;if(s.nodeType===1?a?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(a?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),n&&n.nodeType===8)if(s=n.data,s==="/$"){if(t===0)break;t--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||t++;s=n}while(s)}function Io(t){var a=t.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var s=a;switch(a=a.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":Io(s),ya(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}t.removeChild(s)}}function px(t,a,s,n){for(;t.nodeType===1;){var o=s;if(t.nodeName.toLowerCase()!==a.toLowerCase()){if(!n&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(n){if(!t[Xt])switch(a){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(u=t.getAttribute("rel"),u==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(u!==o.rel||t.getAttribute("href")!==(o.href==null||o.href===""?null:o.href)||t.getAttribute("crossorigin")!==(o.crossOrigin==null?null:o.crossOrigin)||t.getAttribute("title")!==(o.title==null?null:o.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(u=t.getAttribute("src"),(u!==(o.src==null?null:o.src)||t.getAttribute("type")!==(o.type==null?null:o.type)||t.getAttribute("crossorigin")!==(o.crossOrigin==null?null:o.crossOrigin))&&u&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(a==="input"&&t.type==="hidden"){var u=o.name==null?null:""+o.name;if(o.type==="hidden"&&t.getAttribute("name")===u)return t}else return t;if(t=ls(t.nextSibling),t===null)break}return null}function fx(t,a,s){if(a==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!s||(t=ls(t.nextSibling),t===null))return null;return t}function sp(t,a){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!a||(t=ls(t.nextSibling),t===null))return null;return t}function Qo(t){return t.data==="$?"||t.data==="$~"}function Xo(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function gx(t,a){var s=t.ownerDocument;if(t.data==="$~")t._reactRetry=a;else if(t.data!=="$?"||s.readyState!=="loading")a();else{var n=function(){a(),s.removeEventListener("DOMContentLoaded",n)};s.addEventListener("DOMContentLoaded",n),t._reactRetry=n}}function ls(t){for(;t!=null;t=t.nextSibling){var a=t.nodeType;if(a===1||a===3)break;if(a===8){if(a=t.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return t}var Zo=null;function np(t){t=t.nextSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"||s==="/&"){if(a===0)return ls(t.nextSibling);a--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||a++}t=t.nextSibling}return null}function rp(t){t=t.previousSibling;for(var a=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(a===0)return t;a--}else s!=="/$"&&s!=="/&"||a++}t=t.previousSibling}return null}function lp(t,a,s){switch(a=Ni(s),t){case"html":if(t=a.documentElement,!t)throw Error(i(452));return t;case"head":if(t=a.head,!t)throw Error(i(453));return t;case"body":if(t=a.body,!t)throw Error(i(454));return t;default:throw Error(i(451))}}function ml(t){for(var a=t.attributes;a.length;)t.removeAttributeNode(a[0]);ya(t)}var is=new Map,ip=new Set;function Si(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var Fs=ee.d;ee.d={f:xx,r:jx,D:vx,C:yx,L:bx,m:_x,X:Sx,S:Nx,M:Cx};function xx(){var t=Fs.f(),a=fi();return t||a}function jx(t){var a=ba(t);a!==null&&a.tag===5&&a.type==="form"?Sm(a):Fs.r(t)}var br=typeof document>"u"?null:document;function cp(t,a,s){var n=br;if(n&&typeof a=="string"&&a){var o=ea(a);o='link[rel="'+t+'"][href="'+o+'"]',typeof s=="string"&&(o+='[crossorigin="'+s+'"]'),ip.has(o)||(ip.add(o),t={rel:t,crossOrigin:s,href:a},n.querySelector(o)===null&&(a=n.createElement("link"),Ea(a,"link",t),zt(a),n.head.appendChild(a)))}}function vx(t){Fs.D(t),cp("dns-prefetch",t,null)}function yx(t,a){Fs.C(t,a),cp("preconnect",t,a)}function bx(t,a,s){Fs.L(t,a,s);var n=br;if(n&&t&&a){var o='link[rel="preload"][as="'+ea(a)+'"]';a==="image"&&s&&s.imageSrcSet?(o+='[imagesrcset="'+ea(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(o+='[imagesizes="'+ea(s.imageSizes)+'"]')):o+='[href="'+ea(t)+'"]';var u=o;switch(a){case"style":u=_r(t);break;case"script":u=Nr(t)}is.has(u)||(t=A({rel:"preload",href:a==="image"&&s&&s.imageSrcSet?void 0:t,as:a},s),is.set(u,t),n.querySelector(o)!==null||a==="style"&&n.querySelector(hl(u))||a==="script"&&n.querySelector(pl(u))||(a=n.createElement("link"),Ea(a,"link",t),zt(a),n.head.appendChild(a)))}}function _x(t,a){Fs.m(t,a);var s=br;if(s&&t){var n=a&&typeof a.as=="string"?a.as:"script",o='link[rel="modulepreload"][as="'+ea(n)+'"][href="'+ea(t)+'"]',u=o;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":u=Nr(t)}if(!is.has(u)&&(t=A({rel:"modulepreload",href:t},a),is.set(u,t),s.querySelector(o)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(pl(u)))return}n=s.createElement("link"),Ea(n,"link",t),zt(n),s.head.appendChild(n)}}}function Nx(t,a,s){Fs.S(t,a,s);var n=br;if(n&&t){var o=ga(n).hoistableStyles,u=_r(t);a=a||"default";var f=o.get(u);if(!f){var N={loading:0,preload:null};if(f=n.querySelector(hl(u)))N.loading=5;else{t=A({rel:"stylesheet",href:t,"data-precedence":a},s),(s=is.get(u))&&Jo(t,s);var G=f=n.createElement("link");zt(G),Ea(G,"link",t),G._p=new Promise(function(oe,ve){G.onload=oe,G.onerror=ve}),G.addEventListener("load",function(){N.loading|=1}),G.addEventListener("error",function(){N.loading|=2}),N.loading|=4,Ci(f,a,n)}f={type:"stylesheet",instance:f,count:1,state:N},o.set(u,f)}}}function Sx(t,a){Fs.X(t,a);var s=br;if(s&&t){var n=ga(s).hoistableScripts,o=Nr(t),u=n.get(o);u||(u=s.querySelector(pl(o)),u||(t=A({src:t,async:!0},a),(a=is.get(o))&&Wo(t,a),u=s.createElement("script"),zt(u),Ea(u,"link",t),s.head.appendChild(u)),u={type:"script",instance:u,count:1,state:null},n.set(o,u))}}function Cx(t,a){Fs.M(t,a);var s=br;if(s&&t){var n=ga(s).hoistableScripts,o=Nr(t),u=n.get(o);u||(u=s.querySelector(pl(o)),u||(t=A({src:t,async:!0,type:"module"},a),(a=is.get(o))&&Wo(t,a),u=s.createElement("script"),zt(u),Ea(u,"link",t),s.head.appendChild(u)),u={type:"script",instance:u,count:1,state:null},n.set(o,u))}}function op(t,a,s,n){var o=(o=fe.current)?Si(o):null;if(!o)throw Error(i(446));switch(t){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(a=_r(s.href),s=ga(o).hoistableStyles,n=s.get(a),n||(n={type:"style",instance:null,count:0,state:null},s.set(a,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){t=_r(s.href);var u=ga(o).hoistableStyles,f=u.get(t);if(f||(o=o.ownerDocument||o,f={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(t,f),(u=o.querySelector(hl(t)))&&!u._p&&(f.instance=u,f.state.loading=5),is.has(t)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},is.set(t,s),u||wx(o,t,s,f.state))),a&&n===null)throw Error(i(528,""));return f}if(a&&n!==null)throw Error(i(529,""));return null;case"script":return a=s.async,s=s.src,typeof s=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Nr(s),s=ga(o).hoistableScripts,n=s.get(a),n||(n={type:"script",instance:null,count:0,state:null},s.set(a,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,t))}}function _r(t){return'href="'+ea(t)+'"'}function hl(t){return'link[rel="stylesheet"]['+t+"]"}function dp(t){return A({},t,{"data-precedence":t.precedence,precedence:null})}function wx(t,a,s,n){t.querySelector('link[rel="preload"][as="style"]['+a+"]")?n.loading=1:(a=t.createElement("link"),n.preload=a,a.addEventListener("load",function(){return n.loading|=1}),a.addEventListener("error",function(){return n.loading|=2}),Ea(a,"link",s),zt(a),t.head.appendChild(a))}function Nr(t){return'[src="'+ea(t)+'"]'}function pl(t){return"script[async]"+t}function up(t,a,s){if(a.count++,a.instance===null)switch(a.type){case"style":var n=t.querySelector('style[data-href~="'+ea(s.href)+'"]');if(n)return a.instance=n,zt(n),n;var o=A({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return n=(t.ownerDocument||t).createElement("style"),zt(n),Ea(n,"style",o),Ci(n,s.precedence,t),a.instance=n;case"stylesheet":o=_r(s.href);var u=t.querySelector(hl(o));if(u)return a.state.loading|=4,a.instance=u,zt(u),u;n=dp(s),(o=is.get(o))&&Jo(n,o),u=(t.ownerDocument||t).createElement("link"),zt(u);var f=u;return f._p=new Promise(function(N,G){f.onload=N,f.onerror=G}),Ea(u,"link",n),a.state.loading|=4,Ci(u,s.precedence,t),a.instance=u;case"script":return u=Nr(s.src),(o=t.querySelector(pl(u)))?(a.instance=o,zt(o),o):(n=s,(o=is.get(u))&&(n=A({},s),Wo(n,o)),t=t.ownerDocument||t,o=t.createElement("script"),zt(o),Ea(o,"link",n),t.head.appendChild(o),a.instance=o);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(n=a.instance,a.state.loading|=4,Ci(n,s.precedence,t));return a.instance}function Ci(t,a,s){for(var n=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),o=n.length?n[n.length-1]:null,u=o,f=0;f<n.length;f++){var N=n[f];if(N.dataset.precedence===a)u=N;else if(u!==o)break}u?u.parentNode.insertBefore(t,u.nextSibling):(a=s.nodeType===9?s.head:s,a.insertBefore(t,a.firstChild))}function Jo(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.title==null&&(t.title=a.title)}function Wo(t,a){t.crossOrigin==null&&(t.crossOrigin=a.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=a.referrerPolicy),t.integrity==null&&(t.integrity=a.integrity)}var wi=null;function mp(t,a,s){if(wi===null){var n=new Map,o=wi=new Map;o.set(s,n)}else o=wi,n=o.get(s),n||(n=new Map,o.set(s,n));if(n.has(t))return n;for(n.set(t,null),s=s.getElementsByTagName(t),o=0;o<s.length;o++){var u=s[o];if(!(u[Xt]||u[ot]||t==="link"&&u.getAttribute("rel")==="stylesheet")&&u.namespaceURI!=="http://www.w3.org/2000/svg"){var f=u.getAttribute(a)||"";f=t+f;var N=n.get(f);N?N.push(u):n.set(f,[u])}}return n}function hp(t,a,s){t=t.ownerDocument||t,t.head.insertBefore(s,a==="title"?t.querySelector("head > title"):null)}function kx(t,a,s){if(s===1||a.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return t=a.disabled,typeof a.precedence=="string"&&t==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function pp(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function Ex(t,a,s,n){if(s.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var o=_r(n.href),u=a.querySelector(hl(o));if(u){a=u._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(t.count++,t=ki.bind(t),a.then(t,t)),s.state.loading|=4,s.instance=u,zt(u);return}u=a.ownerDocument||a,n=dp(n),(o=is.get(o))&&Jo(n,o),u=u.createElement("link"),zt(u);var f=u;f._p=new Promise(function(N,G){f.onload=N,f.onerror=G}),Ea(u,"link",n),s.instance=u}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(s,a),(a=s.state.preload)&&(s.state.loading&3)===0&&(t.count++,s=ki.bind(t),a.addEventListener("load",s),a.addEventListener("error",s))}}var Ko=0;function Dx(t,a){return t.stylesheets&&t.count===0&&Di(t,t.stylesheets),0<t.count||0<t.imgCount?function(s){var n=setTimeout(function(){if(t.stylesheets&&Di(t,t.stylesheets),t.unsuspend){var u=t.unsuspend;t.unsuspend=null,u()}},6e4+a);0<t.imgBytes&&Ko===0&&(Ko=62500*ox());var o=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&Di(t,t.stylesheets),t.unsuspend)){var u=t.unsuspend;t.unsuspend=null,u()}},(t.imgBytes>Ko?50:800)+a);return t.unsuspend=s,function(){t.unsuspend=null,clearTimeout(n),clearTimeout(o)}}:null}function ki(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Di(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Ei=null;function Di(t,a){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Ei=new Map,a.forEach(Tx,t),Ei=null,ki.call(t))}function Tx(t,a){if(!(a.state.loading&4)){var s=Ei.get(t);if(s)var n=s.get(null);else{s=new Map,Ei.set(t,s);for(var o=t.querySelectorAll("link[data-precedence],style[data-precedence]"),u=0;u<o.length;u++){var f=o[u];(f.nodeName==="LINK"||f.getAttribute("media")!=="not all")&&(s.set(f.dataset.precedence,f),n=f)}n&&s.set(null,n)}o=a.instance,f=o.getAttribute("data-precedence"),u=s.get(f)||n,u===n&&s.set(null,o),s.set(f,o),this.count++,n=ki.bind(this),o.addEventListener("load",n),o.addEventListener("error",n),u?u.parentNode.insertBefore(o,u.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(o,t.firstChild)),a.state.loading|=4}}var fl={$$typeof:q,Provider:null,Consumer:null,_currentValue:k,_currentValue2:k,_threadCount:0};function Mx(t,a,s,n,o,u,f,N,G){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=xt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xt(0),this.hiddenUpdates=xt(null),this.identifierPrefix=n,this.onUncaughtError=o,this.onCaughtError=u,this.onRecoverableError=f,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=G,this.incompleteTransitions=new Map}function fp(t,a,s,n,o,u,f,N,G,oe,ve,Se){return t=new Mx(t,a,s,f,G,oe,ve,Se,N),a=1,u===!0&&(a|=24),u=Ya(3,null,null,a),t.current=u,u.stateNode=t,a=Mc(),a.refCount++,t.pooledCache=a,a.refCount++,u.memoizedState={element:n,isDehydrated:s,cache:a},Rc(u),t}function gp(t){return t?(t=er,t):er}function xp(t,a,s,n,o,u){o=gp(o),n.context===null?n.context=o:n.pendingContext=o,n=Zs(a),n.payload={element:s},u=u===void 0?null:u,u!==null&&(n.callback=u),s=Js(t,n,a),s!==null&&($a(s,t,a),Ir(s,t,a))}function jp(t,a){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<a?s:a}}function ed(t,a){jp(t,a),(t=t.alternate)&&jp(t,a)}function vp(t){if(t.tag===13||t.tag===31){var a=Nn(t,67108864);a!==null&&$a(a,t,67108864),ed(t,67108864)}}function yp(t){if(t.tag===13||t.tag===31){var a=Ja();a=xe(a);var s=Nn(t,a);s!==null&&$a(s,t,a),ed(t,a)}}var Ti=!0;function zx(t,a,s,n){var o=T.T;T.T=null;var u=ee.p;try{ee.p=2,td(t,a,s,n)}finally{ee.p=u,T.T=o}}function Ax(t,a,s,n){var o=T.T;T.T=null;var u=ee.p;try{ee.p=8,td(t,a,s,n)}finally{ee.p=u,T.T=o}}function td(t,a,s,n){if(Ti){var o=ad(n);if(o===null)Bo(t,a,n,Mi,s),_p(t,n);else if(Rx(o,t,a,s,n))n.stopPropagation();else if(_p(t,n),a&4&&-1<Ox.indexOf(t)){for(;o!==null;){var u=ba(o);if(u!==null)switch(u.tag){case 3:if(u=u.stateNode,u.current.memoizedState.isDehydrated){var f=st(u.pendingLanes);if(f!==0){var N=u;for(N.pendingLanes|=2,N.entangledLanes|=2;f;){var G=1<<31-De(f);N.entanglements[1]|=G,f&=~G}js(u),(qt&6)===0&&(hi=tt()+500,ol(0))}}break;case 31:case 13:N=Nn(u,2),N!==null&&$a(N,u,2),fi(),ed(u,2)}if(u=ad(n),u===null&&Bo(t,a,n,Mi,s),u===o)break;o=u}o!==null&&n.stopPropagation()}else Bo(t,a,n,null,s)}}function ad(t){return t=sc(t),sd(t)}var Mi=null;function sd(t){if(Mi=null,t=Pa(t),t!==null){var a=h(t);if(a===null)t=null;else{var s=a.tag;if(s===13){if(t=g(a),t!==null)return t;t=null}else if(s===31){if(t=p(a),t!==null)return t;t=null}else if(s===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;t=null}else a!==t&&(t=null)}}return Mi=t,null}function bp(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ae()){case bt:return 2;case kt:return 8;case Mt:case Gt:return 32;case Dt:return 268435456;default:return 32}default:return 32}}var nd=!1,on=null,dn=null,un=null,gl=new Map,xl=new Map,mn=[],Ox="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function _p(t,a){switch(t){case"focusin":case"focusout":on=null;break;case"dragenter":case"dragleave":dn=null;break;case"mouseover":case"mouseout":un=null;break;case"pointerover":case"pointerout":gl.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":xl.delete(a.pointerId)}}function jl(t,a,s,n,o,u){return t===null||t.nativeEvent!==u?(t={blockedOn:a,domEventName:s,eventSystemFlags:n,nativeEvent:u,targetContainers:[o]},a!==null&&(a=ba(a),a!==null&&vp(a)),t):(t.eventSystemFlags|=n,a=t.targetContainers,o!==null&&a.indexOf(o)===-1&&a.push(o),t)}function Rx(t,a,s,n,o){switch(a){case"focusin":return on=jl(on,t,a,s,n,o),!0;case"dragenter":return dn=jl(dn,t,a,s,n,o),!0;case"mouseover":return un=jl(un,t,a,s,n,o),!0;case"pointerover":var u=o.pointerId;return gl.set(u,jl(gl.get(u)||null,t,a,s,n,o)),!0;case"gotpointercapture":return u=o.pointerId,xl.set(u,jl(xl.get(u)||null,t,a,s,n,o)),!0}return!1}function Np(t){var a=Pa(t.target);if(a!==null){var s=h(a);if(s!==null){if(a=s.tag,a===13){if(a=g(s),a!==null){t.blockedOn=a,ct(t.priority,function(){yp(s)});return}}else if(a===31){if(a=p(s),a!==null){t.blockedOn=a,ct(t.priority,function(){yp(s)});return}}else if(a===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function zi(t){if(t.blockedOn!==null)return!1;for(var a=t.targetContainers;0<a.length;){var s=ad(t.nativeEvent);if(s===null){s=t.nativeEvent;var n=new s.constructor(s.type,s);ac=n,s.target.dispatchEvent(n),ac=null}else return a=ba(s),a!==null&&vp(a),t.blockedOn=s,!1;a.shift()}return!0}function Sp(t,a,s){zi(t)&&s.delete(a)}function qx(){nd=!1,on!==null&&zi(on)&&(on=null),dn!==null&&zi(dn)&&(dn=null),un!==null&&zi(un)&&(un=null),gl.forEach(Sp),xl.forEach(Sp)}function Ai(t,a){t.blockedOn===a&&(t.blockedOn=null,nd||(nd=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,qx)))}var Oi=null;function Cp(t){Oi!==t&&(Oi=t,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Oi===t&&(Oi=null);for(var a=0;a<t.length;a+=3){var s=t[a],n=t[a+1],o=t[a+2];if(typeof n!="function"){if(sd(n||s)===null)continue;break}var u=ba(s);u!==null&&(t.splice(a,3),a-=3,to(u,{pending:!0,data:o,method:s.method,action:n},n,o))}}))}function Sr(t){function a(G){return Ai(G,t)}on!==null&&Ai(on,t),dn!==null&&Ai(dn,t),un!==null&&Ai(un,t),gl.forEach(a),xl.forEach(a);for(var s=0;s<mn.length;s++){var n=mn[s];n.blockedOn===t&&(n.blockedOn=null)}for(;0<mn.length&&(s=mn[0],s.blockedOn===null);)Np(s),s.blockedOn===null&&mn.shift();if(s=(t.ownerDocument||t).$$reactFormReplay,s!=null)for(n=0;n<s.length;n+=3){var o=s[n],u=s[n+1],f=o[ht]||null;if(typeof u=="function")f||Cp(s);else if(f){var N=null;if(u&&u.hasAttribute("formAction")){if(o=u,f=u[ht]||null)N=f.formAction;else if(sd(o)!==null)continue}else N=f.action;typeof N=="function"?s[n+1]=N:(s.splice(n,3),n-=3),Cp(s)}}}function wp(){function t(u){u.canIntercept&&u.info==="react-transition"&&u.intercept({handler:function(){return new Promise(function(f){return o=f})},focusReset:"manual",scroll:"manual"})}function a(){o!==null&&(o(),o=null),n||setTimeout(s,20)}function s(){if(!n&&!navigation.transition){var u=navigation.currentEntry;u&&u.url!=null&&navigation.navigate(u.url,{state:u.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,o=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(s,100),function(){n=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),o!==null&&(o(),o=null)}}}function rd(t){this._internalRoot=t}Ri.prototype.render=rd.prototype.render=function(t){var a=this._internalRoot;if(a===null)throw Error(i(409));var s=a.current,n=Ja();xp(s,n,t,a,null,null)},Ri.prototype.unmount=rd.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var a=t.containerInfo;xp(t.current,2,null,t,null,null),fi(),a[va]=null}};function Ri(t){this._internalRoot=t}Ri.prototype.unstable_scheduleHydration=function(t){if(t){var a=jt();t={blockedOn:null,target:t,priority:a};for(var s=0;s<mn.length&&a!==0&&a<mn[s].priority;s++);mn.splice(s,0,t),s===0&&Np(t)}};var kp=l.version;if(kp!=="19.2.0")throw Error(i(527,kp,"19.2.0"));ee.findDOMNode=function(t){var a=t._reactInternals;if(a===void 0)throw typeof t.render=="function"?Error(i(188)):(t=Object.keys(t).join(","),Error(i(268,t)));return t=m(a),t=t!==null?v(t):null,t=t===null?null:t.stateNode,t};var Fx={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:T,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var qi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!qi.isDisabled&&qi.supportsFiber)try{St=qi.inject(Fx),We=qi}catch{}}return yl.createRoot=function(t,a){if(!d(t))throw Error(i(299));var s=!1,n="",o=Om,u=Rm,f=qm;return a!=null&&(a.unstable_strictMode===!0&&(s=!0),a.identifierPrefix!==void 0&&(n=a.identifierPrefix),a.onUncaughtError!==void 0&&(o=a.onUncaughtError),a.onCaughtError!==void 0&&(u=a.onCaughtError),a.onRecoverableError!==void 0&&(f=a.onRecoverableError)),a=fp(t,1,!1,null,null,s,n,null,o,u,f,wp),t[va]=a.current,Ho(t),new rd(a)},yl.hydrateRoot=function(t,a,s){if(!d(t))throw Error(i(299));var n=!1,o="",u=Om,f=Rm,N=qm,G=null;return s!=null&&(s.unstable_strictMode===!0&&(n=!0),s.identifierPrefix!==void 0&&(o=s.identifierPrefix),s.onUncaughtError!==void 0&&(u=s.onUncaughtError),s.onCaughtError!==void 0&&(f=s.onCaughtError),s.onRecoverableError!==void 0&&(N=s.onRecoverableError),s.formState!==void 0&&(G=s.formState)),a=fp(t,1,!0,a,s??null,n,o,G,u,f,N,wp),a.context=gp(null),s=a.current,n=Ja(),n=xe(n),o=Zs(n),o.callback=null,Js(s,o,n),s=n,a.current.lanes=s,ut(a,s),js(a),t[va]=a.current,Ho(t),new Ri(a)},yl.version="19.2.0",yl}var Ap;function Xx(){if(Ap)return cd.exports;Ap=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(l){console.error(l)}}return r(),cd.exports=Qx(),cd.exports}var Zx=Xx();const Jx=cf(Zx),Wx="fieldsync-offline",Kx=1,ca={PROJECTS:"projects",AREAS:"areas",CREW_CHECKINS:"crew_checkins",PENDING_ACTIONS:"pending_actions",CACHED_DATA:"cached_data"};let $n=null;const Ps=()=>new Promise((r,l)=>{if($n){r($n);return}const c=indexedDB.open(Wx,Kx);c.onerror=()=>{console.error("Failed to open offline database"),l(c.error)},c.onsuccess=()=>{$n=c.result,console.log("Offline database initialized"),r($n)},c.onupgradeneeded=i=>{const d=i.target.result;if(d.objectStoreNames.contains(ca.PROJECTS)||d.createObjectStore(ca.PROJECTS,{keyPath:"id"}).createIndex("company_id","company_id",{unique:!1}),d.objectStoreNames.contains(ca.AREAS)||d.createObjectStore(ca.AREAS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(ca.CREW_CHECKINS)||d.createObjectStore(ca.CREW_CHECKINS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),!d.objectStoreNames.contains(ca.PENDING_ACTIONS)){const h=d.createObjectStore(ca.PENDING_ACTIONS,{keyPath:"id",autoIncrement:!0});h.createIndex("type","type",{unique:!1}),h.createIndex("created_at","created_at",{unique:!1})}d.objectStoreNames.contains(ca.CACHED_DATA)||d.createObjectStore(ca.CACHED_DATA,{keyPath:"key"})}}),Vn=(r,l="readonly")=>{if(!$n)throw new Error("Database not initialized");return $n.transaction(r,l).objectStore(r)},ej=async(r,l)=>(await Ps(),new Promise((c,i)=>{const h=Vn(r,"readwrite").put(l);h.onsuccess=()=>c(h.result),h.onerror=()=>i(h.error)})),of=async(r,l)=>(await Ps(),new Promise((c,i)=>{const d=$n.transaction(r,"readwrite"),h=d.objectStore(r);l.forEach(g=>h.put(g)),d.oncomplete=()=>c(),d.onerror=()=>i(d.error)})),tj=async(r,l)=>(await Ps(),new Promise((c,i)=>{const h=Vn(r).get(l);h.onsuccess=()=>c(h.result),h.onerror=()=>i(h.error)})),df=async r=>(await Ps(),new Promise((l,c)=>{const d=Vn(r).getAll();d.onsuccess=()=>l(d.result||[]),d.onerror=()=>c(d.error)})),uf=async(r,l,c)=>(await Ps(),new Promise((i,d)=>{const p=Vn(r).index(l).getAll(c);p.onsuccess=()=>i(p.result||[]),p.onerror=()=>d(p.error)})),aj=async(r,l)=>(await Ps(),new Promise((c,i)=>{const h=Vn(r,"readwrite").delete(l);h.onsuccess=()=>c(),h.onerror=()=>i(h.error)})),xn={UPDATE_AREA_STATUS:"UPDATE_AREA_STATUS",CREATE_TM_TICKET:"CREATE_TM_TICKET",SAVE_CREW_CHECKIN:"SAVE_CREW_CHECKIN",SUBMIT_DAILY_REPORT:"SUBMIT_DAILY_REPORT",SEND_MESSAGE:"SEND_MESSAGE",CREATE_MATERIAL_REQUEST:"CREATE_MATERIAL_REQUEST"},Op=async(r,l,c={})=>{await Ps();const i={type:r,payload:l,metadata:c,created_at:new Date().toISOString(),attempts:0,last_error:null};return new Promise((d,h)=>{const p=Vn(ca.PENDING_ACTIONS,"readwrite").add(i);p.onsuccess=()=>{console.log(`Queued offline action: ${r}`),d(p.result)},p.onerror=()=>h(p.error)})},mf=async()=>df(ca.PENDING_ACTIONS),Yi=async()=>(await mf()).length,sj=async r=>aj(ca.PENDING_ACTIONS,r),nj=async(r,l)=>(await Ps(),new Promise((c,i)=>{const d=Vn(ca.PENDING_ACTIONS,"readwrite"),h=d.get(r);h.onsuccess=()=>{const g=h.result;if(g){const p={...g,...l},y=d.put(p);y.onsuccess=()=>c(p),y.onerror=()=>i(y.error)}else i(new Error("Action not found"))},h.onerror=()=>i(h.error)})),rj=async r=>of(ca.PROJECTS,r),Rp=async r=>r?uf(ca.PROJECTS,"company_id",r):df(ca.PROJECTS),lj=async r=>of(ca.AREAS,r),qp=async r=>uf(ca.AREAS,"project_id",r),ud=async(r,l)=>{const c=await tj(ca.AREAS,r);return c&&(c.status=l,c.updated_at=new Date().toISOString(),await ej(ca.AREAS,c)),c};let Fd=navigator.onLine;const Dd=new Set,Ld=r=>(Dd.add(r),()=>Dd.delete(r)),kr=()=>Fd,Fp=r=>{Fd=r,Dd.forEach(l=>l(r))};typeof window<"u"&&(window.addEventListener("online",()=>{console.log("Connection restored"),Fp(!0)}),window.addEventListener("offline",()=>{console.log("Connection lost"),Fp(!1)}));let md=!1;const hf=async r=>{if(md||!Fd)return{synced:0,failed:0};md=!0;const l={synced:0,failed:0};try{const c=await mf();console.log(`Syncing ${c.length} pending actions...`);for(const i of c)try{await ij(i,r),await sj(i.id),l.synced++,console.log(`Synced action: ${i.type}`)}catch(d){console.error(`Failed to sync action ${i.type}:`,d),l.failed++,await nj(i.id,{attempts:(i.attempts||0)+1,last_error:d.message,last_attempt:new Date().toISOString()})}}finally{md=!1}return l},ij=async(r,l)=>{const{type:c,payload:i}=r;switch(c){case xn.UPDATE_AREA_STATUS:return l.updateAreaStatus(i.areaId,i.status);case xn.CREATE_TM_TICKET:const d=await l.createTMTicket(i.ticket);return i.workers?.length>0&&await l.addTMWorkers(d.id,i.workers),i.items?.length>0&&await l.addTMItems(d.id,i.items),d;case xn.SAVE_CREW_CHECKIN:return l.saveCrewCheckin(i.projectId,i.workers,i.checkInDate);case xn.SUBMIT_DAILY_REPORT:return await l.saveDailyReport(i.projectId,i.reportData),l.submitDailyReport(i.projectId,i.submittedBy);case xn.SEND_MESSAGE:return l.sendMessage(i.projectId,i.senderType,i.senderName,i.content);case xn.CREATE_MATERIAL_REQUEST:return l.createMaterialRequest(i.projectId,i.items,i.requestedBy,i.neededBy,i.priority,i.notes);default:throw new Error(`Unknown action type: ${c}`)}},cj={slowQueryThreshold:200},Et={query(r,l){const c={type:"query",operation:r,duration_ms:l.duration,rows_returned:l.rows,company_id:l.company_id||null,project_id:l.project_id||null,user_id:l.user_id||null,timestamp:new Date().toISOString()};l.duration>=cj.slowQueryThreshold&&hd("query",c)},error(r,l){const c={type:"error",category:r,severity:l.severity||"error",error_code:l.code||null,message:l.message,company_id:l.company_id||null,user_id:l.user_id||null,project_id:l.project_id||null,operation:l.operation||null,context:l.extra||{},timestamp:new Date().toISOString()};hd("error",c)},storage(r,l){const c={type:"storage",operation:r,company_id:l.company_id||null,project_id:l.project_id||null,file_size_bytes:l.size||0,duration_ms:l.duration||0,success:l.success!==!1,error_message:l.error||null,timestamp:new Date().toISOString()};(!c.success||c.duration_ms>5e3)&&hd("storage",c)},activity(r,l){}};async function hd(r,l){try{r==="error"?await w.rpc("log_error",{p_severity:l.severity,p_category:l.category,p_message:l.message,p_company_id:l.company_id,p_user_id:l.user_id,p_project_id:l.project_id,p_operation:l.operation,p_error_code:l.error_code,p_context:l.context||{}}):r==="query"&&await w.rpc("log_query_metric",{p_operation:l.operation,p_duration_ms:l.duration_ms,p_rows_returned:l.rows_returned,p_company_id:l.company_id,p_project_id:l.project_id,p_user_id:l.user_id,p_context:{}})}catch{}}Et.wrapQuery=function(r,l){return async function(...c){const i=performance.now();try{const d=await l.apply(this,c),g={duration:Math.round(performance.now()-i),rows:Array.isArray(d)?d.length:void 0};return Et.query(r,g),d}catch(d){const h=Math.round(performance.now()-i);throw Et.error("database",{message:d.message,operation:r,severity:"error",extra:{duration:h}}),d}}};Et.time=async function(r,l){const c=performance.now();try{const i=await l(),d=Math.round(performance.now()-c);return Et.query(r,{duration:d}),i}catch(i){throw Et.error("general",{message:i.message,operation:r}),i}};const oj="https://cegifnrcwdilromcyouq.supabase.co",pf="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlZ2lmbnJjd2RpbHJvbWN5b3VxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NTQ5OTAsImV4cCI6MjA4MDIzMDk5MH0.qAiBG5XaB0C1E0U2tQbQkrhpm1iUhM6A2MXngEHhX4A",H=!!pf;Ps().catch(r=>console.error("Failed to init offline DB:",r));const w=H?Hx(oj,pf):null,ff="fieldsync_data",Td="fieldsync_user",Ze=()=>{const r=localStorage.getItem(ff);return r?JSON.parse(r):{projects:[],areas:[],users:[],assignments:[]}},wt=r=>{localStorage.setItem(ff,JSON.stringify(r))},Fi=()=>{const r=localStorage.getItem(Td);return r?JSON.parse(r):null},Li=r=>{r?localStorage.setItem(Td,JSON.stringify(r)):localStorage.removeItem(Td)},Md={async signUp(r,l,c,i){if(H){const{data:d,error:h}=await w.auth.signUp({email:r,password:l,options:{data:{name:c,role:i}}});if(h)throw h;return d}else{const d=Ze(),h={id:crypto.randomUUID(),email:r,name:c,role:i,created_at:new Date().toISOString()};return d.users.push(h),wt(d),Li(h),{user:h}}},async signIn(r,l){if(H){const{data:c,error:i}=await w.auth.signInWithPassword({email:r,password:l});if(i)throw i;return c}else{const i=Ze().users.find(d=>d.email===r);if(!i)throw new Error("User not found");return Li(i),{user:i}}},async signOut(){if(H){const{error:r}=await w.auth.signOut();if(r)throw r}else Li(null)},async getUser(){if(H){const{data:{user:r}}=await w.auth.getUser();return r}else return Fi()},async getProfile(){if(H){const{data:{user:r}}=await w.auth.getUser();if(!r)return null;const{data:l,error:c}=await w.from("users").select("*").eq("id",r.id).single();return c?{id:r.id,email:r.email,name:r.user_metadata?.name||"",role:r.user_metadata?.role||"foreman"}:l}else return Fi()},async updateRole(r,l){if(H){const{data:c,error:i}=await w.from("users").update({role:l}).eq("id",r).select().single();if(i)throw i;return c}else{const c=Ze(),i=c.users.find(d=>d.id===r);return i&&(i.role=l,wt(c),Fi()?.id===r&&Li(i)),i}},onAuthStateChange(r){if(H)return w.auth.onAuthStateChange(r);{const l=Fi();return r(l?"SIGNED_IN":"SIGNED_OUT",{user:l}),{data:{subscription:{unsubscribe:()=>{}}}}}}},K={async getProjects(r=null,l=!1){if(H){if(!kr()){console.log("Offline: returning cached projects");const i=await Rp(r);return l?i:i.filter(d=>d.status!=="archived")}const c=performance.now();try{let i=w.from("projects").select("*").order("created_at",{ascending:!1});r&&(i=i.eq("company_id",r)),l||(i=i.eq("status","active"));const{data:d,error:h}=await i,g=Math.round(performance.now()-c);if(Et.query("getProjects",{duration:g,rows:d?.length,company_id:r}),h){Et.error("database",{message:h.message,operation:"getProjects",company_id:r}),console.log("Error fetching projects, trying cache:",h.message);const p=await Rp(r);if(p.length>0)return p;throw h}return d?.length>0&&rj(d).catch(p=>console.error("Failed to cache projects:",p)),d}catch(i){throw Et.error("database",{message:i.message,operation:"getProjects",company_id:r}),i}}else{const c=Ze().projects;return l?c:c.filter(i=>i.status!=="archived")}},async getArchivedProjects(r){if(H){const{data:l,error:c}=await w.from("projects").select("*").eq("company_id",r).eq("status","archived").order("archived_at",{ascending:!1});if(c)throw c;return l}else return Ze().projects.filter(l=>l.status==="archived")},async getProjectCount(r){if(H){const{count:l,error:c}=await w.from("projects").select("*",{count:"exact",head:!0}).eq("company_id",r).in("status",["active","archived"]);if(c)throw c;return l||0}else return Ze().projects.filter(c=>c.company_id===r&&c.status!=="deleted").length},async archiveProject(r){if(H){const{data:l,error:c}=await w.from("projects").update({status:"archived",archived_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw c;return l}else{const l=Ze(),c=l.projects.find(i=>i.id===r);return c&&(c.status="archived",c.archived_at=new Date().toISOString(),wt(l)),c}},async getProjectStorageStats(r){if(!H)return{photoCount:0,estimatedMB:0};const{data:l,error:c}=await w.from("t_and_m_tickets").select("photos").eq("project_id",r);if(c)throw c;let i=0;const d=[];l?.forEach(g=>{g.photos&&Array.isArray(g.photos)&&(i+=g.photos.length,d.push(...g.photos))});const h=i*1.5;return{photoCount:i,estimatedMB:h,photoUrls:d}},async archiveProjectDeep(r,l){if(!H)return null;const{photoUrls:c}=await this.getProjectStorageStats(r);if(c.length>0){const h=c.map(g=>{try{const y=new URL(g).pathname.match(/\/tm-photos\/(.+)$/);return y?y[1]:null}catch{return null}}).filter(Boolean);if(h.length>0)for(let g=0;g<h.length;g+=100){const p=h.slice(g,g+100);await w.storage.from("tm-photos").remove(p)}}await w.from("t_and_m_tickets").update({photos:[]}).eq("project_id",r);const{data:i,error:d}=await w.from("projects").update({status:"archived",archived_at:new Date().toISOString(),photos:[],storage_cleaned:!0}).eq("id",r).select().single();if(d)throw d;return{...i,photosDeleted:c.length}},async restoreProject(r){if(H){const{data:l,error:c}=await w.from("projects").update({status:"active",archived_at:null}).eq("id",r).select().single();if(c)throw c;return l}else{const l=Ze(),c=l.projects.find(i=>i.id===r);return c&&(c.status="active",c.archived_at=null,wt(l)),c}},async getProject(r){if(H){const{data:l,error:c}=await w.from("projects").select("*").eq("id",r).single();if(c)throw c;return l}else return Ze().projects.find(l=>l.id===r)},async createProject(r){if(H){console.log("Creating project with data:",r);const{data:l,error:c}=await w.from("projects").insert({...r,status:"active"}).select().single();if(c)throw console.error("Supabase createProject error:",c.message,c.details,c.hint),c;return l}else{const l=Ze(),c={...r,id:crypto.randomUUID(),status:"active",created_at:new Date().toISOString()};return l.projects.push(c),wt(l),c}},async getProjectByPin(r){if(H){const{data:l,error:c}=await w.from("projects").select("*").eq("pin",r).eq("status","active").single();return c?null:l}else return Ze().projects.find(c=>c.pin===r&&c.status==="active")||null},async getProjectByPinAndCompany(r,l){if(H){const{data:c,error:i}=await w.from("projects").select("*").eq("pin",r).eq("company_id",l).eq("status","active").single();return i?null:c}else return Ze().projects.find(i=>i.pin===r&&i.company_id===l&&i.status==="active")||null},async isPinAvailable(r,l=null){if(H){let c=w.from("projects").select("id").eq("pin",r);l&&(c=c.neq("id",l));const{data:i,error:d}=await c;if(d)throw d;return i.length===0}else return!Ze().projects.some(i=>i.pin===r&&i.id!==l)},async updateProjectPin(r,l){if(H){const{data:c,error:i}=await w.from("projects").update({pin:l}).eq("id",r).select().single();if(i)throw i;return c}else{const c=Ze(),i=c.projects.find(d=>d.id===r);return i&&(i.pin=l,wt(c)),i}},async updateProject(r,l){if(H){const{data:c,error:i}=await w.from("projects").update(l).eq("id",r).select().single();if(i)throw console.error("Error updating project:",i),i;return c}else{const c=Ze(),i=c.projects.find(d=>d.id===r);return i&&(Object.assign(i,l),wt(c)),i}},async deleteProject(r){if(H){const{error:l}=await w.from("projects").delete().eq("id",r);if(l)throw l}else{const l=Ze();l.projects=l.projects.filter(c=>c.id!==r),l.areas=l.areas.filter(c=>c.project_id!==r),wt(l)}},async getAreas(r){if(H){if(!kr())return console.log("Offline: returning cached areas"),qp(r);const{data:l,error:c}=await w.from("areas").select("*").eq("project_id",r).order("sort_order",{ascending:!0});if(c){console.log("Error fetching areas, trying cache:",c.message);const i=await qp(r);if(i.length>0)return i;throw c}return l?.length>0&&lj(l).catch(i=>console.error("Failed to cache areas:",i)),l}else return Ze().areas.filter(l=>l.project_id===r)},async createArea(r){if(H){const{data:l,error:c}=await w.from("areas").insert(r).select().single();if(c)throw c;return l}else{const l=Ze(),c={...r,id:crypto.randomUUID(),created_at:new Date().toISOString()};return l.areas.push(c),wt(l),c}},async updateAreaStatus(r,l){if(H){if(!kr()){console.log("Offline: queuing area status update");const d=await ud(r,l);return await Op(xn.UPDATE_AREA_STATUS,{areaId:r,status:l}),d}const{data:c,error:i}=await w.from("areas").update({status:l}).eq("id",r).select().single();if(i){if(i.message?.includes("fetch")||i.message?.includes("network")){console.log("Network error: queuing area status update");const d=await ud(r,l);return await Op(xn.UPDATE_AREA_STATUS,{areaId:r,status:l}),d}throw i}return c&&ud(r,l).catch(d=>console.error("Failed to update cached area:",d)),c}else{const c=Ze(),i=c.areas.find(d=>d.id===r);return i&&(i.status=l,i.updated_at=new Date().toISOString()),wt(c),i}},async updateArea(r,l){if(H){const{data:c,error:i}=await w.from("areas").update(l).eq("id",r).select().single();if(i)throw i;return c}else{const c=Ze(),i=c.areas.find(d=>d.id===r);return i&&(Object.assign(i,l),i.updated_at=new Date().toISOString()),wt(c),i}},async deleteArea(r){if(H){const{error:l}=await w.from("areas").delete().eq("id",r);if(l)throw l}else{const l=Ze();l.areas=l.areas.filter(c=>c.id!==r),wt(l)}},subscribeToAreas(r,l){return H?w.channel(`areas:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"areas",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMessages(r,l){return H?w.channel(`messages:${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMaterialRequests(r,l){return H?w.channel(`material_requests:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"material_requests",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToDailyReports(r,l){return H?w.channel(`daily_reports:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"daily_reports",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCrewCheckins(r,l){return H?w.channel(`crew_checkins:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"crew_checkins",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToInjuryReports(r,l){return H?w.channel(`injury_reports:${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${r}`},l).subscribe():null},subscribeToTMTickets(r,l){return H?w.channel(`tm_tickets:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCompanyActivity(r,l,c){if(!H||!l||l.length===0)return null;const i=w.channel(`company_activity:${r}`);return l.forEach(d=>{i.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${d}`},h=>c.onMessage?.(h)),i.on("postgres_changes",{event:"INSERT",schema:"public",table:"material_requests",filter:`project_id=eq.${d}`},h=>c.onMaterialRequest?.(h)),i.on("postgres_changes",{event:"INSERT",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${d}`},h=>c.onTMTicket?.(h))}),i.on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${r}`},d=>c.onInjuryReport?.(d)),i.subscribe()},unsubscribe(r){r&&H&&w.removeChannel(r)},async getAssignedProjects(r){if(H){const{data:l,error:c}=await w.from("project_assignments").select(`
          project_id,
          projects (*)
        `).eq("user_id",r);if(c)throw c;return l.map(i=>i.projects)}else{const l=Ze();return(l.assignments?.filter(i=>i.user_id===r)||[]).map(i=>l.projects.find(d=>d.id===i.project_id)).filter(Boolean)}},async assignUserToProject(r,l,c){if(H){const{data:i,error:d}=await w.from("project_assignments").insert({project_id:r,user_id:l,assigned_by:c}).select().single();if(d)throw d;return i}else{const i=Ze();i.assignments||(i.assignments=[]);const d={id:crypto.randomUUID(),project_id:r,user_id:l,assigned_by:c,assigned_at:new Date().toISOString()};return i.assignments.push(d),wt(i),d}},async removeUserFromProject(r,l){if(H){const{error:c}=await w.from("project_assignments").delete().eq("project_id",r).eq("user_id",l);if(c)throw c}else{const c=Ze();c.assignments=c.assignments?.filter(i=>!(i.project_id===r&&i.user_id===l))||[],wt(c)}},async getProjectAssignments(r){if(H){const{data:l,error:c}=await w.from("project_assignments").select(`
          user_id,
          users (id, email, name, role)
        `).eq("project_id",r);if(c)throw c;return l.map(i=>i.users)}else{const l=Ze();return(l.assignments?.filter(i=>i.project_id===r)||[]).map(i=>l.users.find(d=>d.id===i.user_id)).filter(Boolean)}},async getAllUsers(){if(H){const{data:r,error:l}=await w.from("users").select("*").order("name");if(l)throw l;return r}else return Ze().users||[]},async getForemen(){if(H){const{data:r,error:l}=await w.from("users").select("*").eq("role","foreman").order("name");if(l)throw l;return r}else return(Ze().users||[]).filter(r=>r.role==="foreman")},async logActivity(r,l,c,i,d,h){if(H){const{error:g}=await w.from("activity_log").insert({user_id:r,project_id:l,area_id:c,action:i,old_value:d,new_value:h});g&&console.error("Error logging activity:",g)}},async getProjectActivity(r,l=50){if(H){const{data:c,error:i}=await w.from("activity_log").select(`
          *,
          users (name, email),
          areas (name)
        `).eq("project_id",r).order("created_at",{ascending:!1}).limit(l);if(i)throw i;return c}return[]},async getMaterialsEquipment(r){if(H){const{data:l,error:c}=await w.from("materials_equipment").select("*").eq("company_id",r).eq("active",!0).order("category").order("name");if(c)throw c;return l}return[]},async getMaterialsEquipmentByCategory(r,l){if(H){const{data:c,error:i}=await w.from("materials_equipment").select("*").eq("company_id",r).eq("category",l).eq("active",!0).order("name");if(i)throw i;return c}return[]},async getAllMaterialsEquipment(r){if(H){const{data:l,error:c}=await w.from("materials_equipment").select("*").eq("company_id",r).order("category").order("name");if(c)throw c;return l}return[]},async createMaterialEquipment(r){if(H){const{data:l,error:c}=await w.from("materials_equipment").insert(r).select().single();if(c)throw c;return l}return null},async updateMaterialEquipment(r,l){if(H){const{data:c,error:i}=await w.from("materials_equipment").update(l).eq("id",r).select().single();if(i)throw i;return c}return null},async deleteMaterialEquipment(r){if(H){const{error:l}=await w.from("materials_equipment").update({active:!1}).eq("id",r);if(l)throw l}},async getTMTickets(r){if(H){const l=performance.now();try{const{data:c,error:i}=await w.from("t_and_m_tickets").select(`
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          `).eq("project_id",r).order("created_at",{ascending:!1}),d=Math.round(performance.now()-l);if(Et.query("getTMTickets",{duration:d,rows:c?.length,project_id:r}),i)throw i;return c}catch(c){throw Et.error("database",{message:c.message,operation:"getTMTickets",project_id:r}),c}}return[]},async getChangeOrderTotals(r){if(H){const{data:l,error:c}=await w.from("t_and_m_tickets").select("ce_pco_number, change_order_value, status").eq("project_id",r).not("ce_pco_number","is",null).neq("ce_pco_number","");if(c)throw c;const i={};let d=0,h=0;return l?.forEach(g=>{const p=g.ce_pco_number;if(i[p]||(i[p]={approved:0,pending:0,count:0}),i[p].count++,g.status==="approved"||g.status==="billed"){const y=parseFloat(g.change_order_value)||0;i[p].approved+=y,d+=y}else g.status==="pending"&&h++}),{changeOrders:i,totalApprovedValue:d,pendingCount:h}}return{changeOrders:{},totalApprovedValue:0,pendingCount:0}},async getTMTicketsByStatus(r,l){if(H){const{data:c,error:i}=await w.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).eq("status",l).order("created_at",{ascending:!1});if(i)throw i;return c}return[]},async getCORTickets(r){if(H){const{data:l,error:c}=await w.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("assigned_cor_id",r).order("work_date",{ascending:!0});if(c)throw c;return l||[]}return[]},async createTMTicket(r){if(H){const{data:l,error:c}=await w.from("t_and_m_tickets").insert({project_id:r.project_id,work_date:r.work_date,ce_pco_number:r.ce_pco_number||null,assigned_cor_id:r.assigned_cor_id||null,notes:r.notes,photos:r.photos||[],status:"pending",created_by_name:r.created_by_name||"Field User"}).select().single();if(c)throw c;return l}return null},async addTMWorkers(r,l){if(H){const c=l.map(d=>({ticket_id:r,name:d.name,hours:d.hours,overtime_hours:d.overtime_hours||0,time_started:d.time_started||null,time_ended:d.time_ended||null,role:d.role||"Laborer"})),{error:i}=await w.from("t_and_m_workers").insert(c);if(i)throw i}},async addTMItems(r,l){if(H){const c=l.map(d=>({ticket_id:r,material_equipment_id:d.material_equipment_id||null,custom_name:d.custom_name||null,custom_category:d.custom_category||null,quantity:d.quantity})),{error:i}=await w.from("t_and_m_items").insert(c);if(i)throw i}},async getPreviousTicketCrew(r,l){if(!H)return null;const{data:c,error:i}=await w.from("t_and_m_tickets").select(`
        id,
        work_date,
        t_and_m_workers (*)
      `).eq("project_id",r).lt("work_date",l).order("work_date",{ascending:!1}).limit(1).single();if(i||!c)return null;const d=c.t_and_m_workers||[],h=d.filter(y=>["Foreman","General Foreman","Superintendent"].includes(y.role)).map(y=>({name:y.name,hours:y.hours?.toString()||"",overtimeHours:y.overtime_hours?.toString()||"",timeStarted:y.time_started||"",timeEnded:y.time_ended||"",role:y.role})),g=d.filter(y=>y.role==="Operator").map(y=>({name:y.name,hours:y.hours?.toString()||"",overtimeHours:y.overtime_hours?.toString()||"",timeStarted:y.time_started||"",timeEnded:y.time_ended||""})),p=d.filter(y=>y.role==="Laborer").map(y=>({name:y.name,hours:y.hours?.toString()||"",overtimeHours:y.overtime_hours?.toString()||"",timeStarted:y.time_started||"",timeEnded:y.time_ended||""}));return{workDate:c.work_date,supervision:h.length>0?h:null,operators:g.length>0?g:null,laborers:p.length>0?p:null,totalWorkers:d.length}},async updateTMTicketStatus(r,l){if(H){const{data:c,error:i}=await w.from("t_and_m_tickets").update({status:l}).eq("id",r).select().single();if(i)throw i;return c}return null},async approveTMTicket(r,l,c,i=null){if(H){const d={status:"approved",approved_by_user_id:l,approved_by_name:c,approved_at:new Date().toISOString(),rejected_by_user_id:null,rejected_by_name:null,rejected_at:null,rejection_reason:null};i!==null&&(d.change_order_value=parseFloat(i)||0);const{data:h,error:g}=await w.from("t_and_m_tickets").update(d).eq("id",r).select().single();if(g)throw g;return h}return null},async rejectTMTicket(r,l,c,i=""){if(H){const{data:d,error:h}=await w.from("t_and_m_tickets").update({status:"rejected",rejected_by_user_id:l,rejected_by_name:c,rejected_at:new Date().toISOString(),rejection_reason:i,approved_by_user_id:null,approved_by_name:null,approved_at:null}).eq("id",r).select().single();if(h)throw h;return d}return null},canApproveTickets(r){return["owner","admin","manager"].includes(r)},async updateTMTicketPhotos(r,l){if(H){const{data:c,error:i}=await w.from("t_and_m_tickets").update({photos:l}).eq("id",r).select().single();if(i)throw i;return c}return null},async saveTMClientSignature(r,l){if(H){const{data:c,error:i}=await w.from("t_and_m_tickets").update({client_signature_data:l.signature,client_signature_name:l.signerName,client_signature_title:l.signerTitle,client_signature_company:l.signerCompany,client_signature_date:l.signedAt,client_signature_ip:null,status:"client_signed"}).eq("id",r).select().single();if(i)throw i;return c}return null},async deleteTMTicket(r){if(H){const{error:l}=await w.from("t_and_m_tickets").delete().eq("id",r);if(l)throw l}},async isTicketEditable(r){if(!r?.assigned_cor_id)return{editable:!0};if(H)try{const{data:l,error:c}=await w.from("change_orders").select("id, status, cor_number").eq("id",r.assigned_cor_id).single();if(c||!l)return{editable:!0};const d=["draft","pending_approval"].includes(l.status);return{editable:d,lockedBy:d?null:l,reason:d?null:`This ticket is linked to ${l.cor_number} which has been ${l.status==="approved"?"approved":l.status}`}}catch(l){return console.error("Error checking ticket editability:",l),{editable:!0}}return{editable:!0}},async getCompanyByCode(r){if(H){const{data:l,error:c}=await w.from("companies").select("*").eq("code",r).single();return c?null:l}return null},async getCompany(r){if(H){const{data:l,error:c}=await w.from("companies").select("*").eq("id",r).single();if(c)throw c;return l}return null},async getUserCompanies(r){if(H){const{data:l,error:c}=await w.from("user_companies").select(`
          id,
          access_level,
          company_id,
          status,
          companies (
            id,
            name,
            code
          )
        `).eq("user_id",r).eq("status","active").order("created_at",{ascending:!0});return c?(console.error("Error fetching user companies:",c),[]):l.map(i=>({id:i.companies.id,name:i.companies.name,code:i.companies.code,access_level:i.access_level}))}return[]},async getUserPendingMemberships(r){if(H){const{count:l,error:c}=await w.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",r).eq("status","pending");return c?(console.error("Error fetching pending memberships:",c),0):l||0}return 0},async getCompanyMemberships(r){if(H){const{data:l,error:c}=await w.from("user_companies").select(`
          id,
          access_level,
          company_role,
          status,
          created_at,
          approved_at,
          approved_by,
          removed_at,
          removed_by,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",r).order("created_at",{ascending:!1});return c?(console.error("Error fetching company memberships:",c),[]):l||[]}return[]},async approveMembership(r,l){if(H){const{error:c}=await w.from("user_companies").update({status:"active",approved_at:new Date().toISOString(),approved_by:l}).eq("id",r);if(c)throw c}},async approveMembershipWithRole(r,l,c="member"){if(H){const{error:i}=await w.rpc("approve_membership_with_role",{membership_id:r,approved_by_user:l,new_access_level:c});if(i)throw i}},async rejectMembership(r){if(H){const{error:l}=await w.from("user_companies").delete().eq("id",r);if(l)throw l}},async removeMember(r,l){if(H){const{error:c}=await w.from("user_companies").update({status:"removed",removed_at:new Date().toISOString(),removed_by:l}).eq("id",r);if(c)throw c}},async getProjectTeam(r){if(H){const{data:l,error:c}=await w.from("project_users").select(`
          id,
          project_role,
          assigned_at,
          notes,
          users!project_users_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("project_id",r).order("assigned_at",{ascending:!0});return c?(console.error("Error fetching project team:",c),[]):l||[]}return[]},async getCompanyMembers(r){if(H){const{data:l,error:c}=await w.from("user_companies").select(`
          id,
          access_level,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",r).eq("status","active").order("created_at",{ascending:!0});return c?(console.error("Error fetching company members:",c),[]):l||[]}return[]},async addProjectMember(r,l,c,i){if(H){const{data:d,error:h}=await w.from("project_users").insert({project_id:r,user_id:l,project_role:c,assigned_by:i}).select().single();if(h)throw h;return d}return null},async updateProjectMemberRole(r,l,c){if(H){const{error:i}=await w.from("project_users").update({project_role:c}).eq("project_id",r).eq("user_id",l);if(i)throw i}},async removeProjectMember(r,l){if(H){const{error:c}=await w.from("project_users").delete().eq("project_id",r).eq("user_id",l);if(c)throw c}},async updateMemberAccessLevel(r,l){if(H){const{error:c}=await w.from("user_companies").update({access_level:l}).eq("id",r);if(c)throw c}},async updateMemberCompanyRole(r,l){if(H){const{error:c}=await w.from("user_companies").update({company_role:l}).eq("id",r);if(c)throw c}},async repairLegacyUser(r,l,c="member"){if(!H||!r||!l)return!1;try{const{data:i,error:d}=await w.rpc("repair_legacy_user",{p_user_id:r,p_company_id:l,p_role:c});return d?(console.error("RPC repair_legacy_user failed:",d),!1):(console.log("Legacy user repaired via RPC:",i),i===!0)}catch(i){return console.error("Error repairing legacy user:",i),!1}},async isLegacyUser(r){if(!H)return!1;try{const{data:l}=await w.from("users").select("company_id, role").eq("id",r).single();if(!l?.company_id)return!1;const{count:c}=await w.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",r);return c===0}catch(l){return console.error("Error checking legacy user:",l),!1}},DISPOSAL_LOAD_TYPES:[{value:"concrete",label:"Concrete"},{value:"trash",label:"Trash"},{value:"metals",label:"Metals"},{value:"hazardous_waste",label:"Hazardous Waste"}],async getDisposalLoads(r,l){if(!H)return[];const c=performance.now();try{const{data:i,error:d}=await w.from("disposal_loads").select("*").eq("project_id",r).eq("work_date",l).order("created_at",{ascending:!1}),h=Math.round(performance.now()-c);if(Et.query("getDisposalLoads",{duration:h,rows:i?.length,project_id:r}),d)throw d;return i||[]}catch(i){throw Et.error("database",{message:i.message,operation:"getDisposalLoads",project_id:r}),i}},async addDisposalLoad(r,l,c,i,d,h=null){if(!H)return null;const{data:g,error:p}=await w.from("disposal_loads").insert({project_id:r,user_id:l,work_date:c,load_type:i,load_count:d,notes:h}).select().single();if(p)throw Et.error("database",{message:p.message,operation:"addDisposalLoad",project_id:r}),p;return g},async updateDisposalLoad(r,l,c,i=null){if(!H)return null;const{data:d,error:h}=await w.from("disposal_loads").update({load_type:l,load_count:c,notes:i}).eq("id",r).select().single();if(h)throw Et.error("database",{message:h.message,operation:"updateDisposalLoad"}),h;return d},async deleteDisposalLoad(r){if(!H)return!1;const{error:l}=await w.from("disposal_loads").delete().eq("id",r);if(l)throw Et.error("database",{message:l.message,operation:"deleteDisposalLoad"}),l;return!0},async getDisposalSummary(r,l=null,c=null){if(!H)return[];const i=performance.now();try{const{data:d,error:h}=await w.rpc("get_disposal_summary",{p_project_id:r,p_start_date:l,p_end_date:c}),g=Math.round(performance.now()-i);if(Et.query("getDisposalSummary",{duration:g,rows:d?.length,project_id:r}),h)throw h;return d||[]}catch(d){return Et.error("database",{message:d.message,operation:"getDisposalSummary",project_id:r}),this.getDisposalSummaryFallback(r,l,c)}},async getDisposalSummaryFallback(r,l,c){let i=w.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",r);l&&(i=i.gte("work_date",l)),c&&(i=i.lte("work_date",c));const{data:d,error:h}=await i;if(h)throw h;const g={};return d?.forEach(p=>{g[p.load_type]||(g[p.load_type]={load_type:p.load_type,total_loads:0,days:new Set}),g[p.load_type].total_loads+=p.load_count,g[p.load_type].days.add(p.work_date)}),Object.values(g).map(p=>({load_type:p.load_type,total_loads:p.total_loads,days_with_activity:p.days.size}))},async getWeeklyDisposalSummary(r,l=4){if(!H)return[];const c=new Date,i=new Date;i.setDate(i.getDate()-l*7);const{data:d,error:h}=await w.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",r).gte("work_date",i.toISOString().split("T")[0]).lte("work_date",c.toISOString().split("T")[0]).order("work_date",{ascending:!0});if(h)throw h;const g={};return d?.forEach(p=>{const y=new Date(p.work_date),m=new Date(y);m.setDate(y.getDate()-y.getDay());const v=m.toISOString().split("T")[0];g[v]||(g[v]={week:v,concrete:0,trash:0,metals:0,hazardous_waste:0}),g[v][p.load_type]+=p.load_count}),Object.values(g).sort((p,y)=>p.week.localeCompare(y.week))},async uploadPhoto(r,l,c,i){if(!H)return null;const d=performance.now(),h=i.size||0,g=Date.now(),p=Math.random().toString(36).substring(7),y=i.name?.split(".").pop()||"jpg",m=`${g}-${p}.${y}`,v=`${r}/${l}/${c}/${m}`;try{const{data:A,error:_}=await w.storage.from("tm-photos").upload(v,i,{cacheControl:"3600",upsert:!1}),j=Math.round(performance.now()-d);if(Et.storage("upload",{company_id:r,project_id:l,size:h,duration:j,success:!_}),_)throw _;const{data:$}=w.storage.from("tm-photos").getPublicUrl(v);return $.publicUrl}catch(A){throw Et.error("storage",{message:A.message,operation:"uploadPhoto",company_id:r,project_id:l}),A}},async uploadPhotoBase64(r,l,c,i,d="photo.jpg"){if(!H)return null;const g=await(await fetch(i)).blob(),p=Date.now(),y=Math.random().toString(36).substring(7),m=d.split(".").pop()||"jpg",v=`${p}-${y}.${m}`,A=`${r}/${l}/${c}/${v}`,{data:_,error:j}=await w.storage.from("tm-photos").upload(A,g,{cacheControl:"3600",upsert:!1,contentType:g.type});if(j)throw j;const{data:$}=w.storage.from("tm-photos").getPublicUrl(A);return $.publicUrl},async deletePhoto(r){if(!H)return;const c=new URL(r).pathname.match(/\/tm-photos\/(.+)$/);if(!c)return;const i=c[1],{error:d}=await w.storage.from("tm-photos").remove([i]);if(d)throw d},async verifyPhotoAccessible(r){if(!H||!r)return{accessible:!1,error:"Invalid URL"};try{const l=await fetch(r,{method:"HEAD"});return{accessible:l.ok,status:l.status,error:l.ok?null:`HTTP ${l.status}`}}catch(l){return{accessible:!1,error:l.message||"Network error"}}},async verifyTicketPhotos(r){if(!H)return{verified:!1,issues:[]};try{const{data:l,error:c}=await w.from("t_and_m_tickets").select("photos").eq("id",r).single();if(c)throw c;if(!l?.photos||l.photos.length===0)return await w.from("t_and_m_tickets").update({photos_verified_at:new Date().toISOString(),photos_verification_status:"empty",photos_issue_count:0}).eq("id",r),{verified:!0,status:"empty",issues:[]};const i=[];for(const h of l.photos){const g=await this.verifyPhotoAccessible(h);g.accessible||i.push({url:h,error:g.error})}const d=i.length===0?"verified":"issues";return await w.from("t_and_m_tickets").update({photos_verified_at:new Date().toISOString(),photos_verification_status:d,photos_issue_count:i.length}).eq("id",r),{verified:i.length===0,status:d,totalPhotos:l.photos.length,issues:i}}catch(l){return console.error("Error verifying ticket photos:",l),{verified:!1,error:l.message,issues:[]}}},async queuePhotoUpload(r,l,c,i){if(!H)return null;const{data:d,error:h}=await w.from("photo_upload_queue").insert({ticket_id:r,temp_id:l,file_name:c,file_size_bytes:i,status:"pending"}).select().single();return h?(console.error("Error queueing photo upload:",h),null):d},async confirmQueuedUpload(r,l,c){if(!H)return!1;const{data:i,error:d}=await w.rpc("confirm_photo_upload",{p_queue_id:r,p_uploaded_url:l,p_storage_path:c});return d?(console.error("Error confirming photo upload:",d),!1):i===!0},async markQueuedUploadFailed(r,l){if(!H)return!1;const{data:c,error:i}=await w.rpc("mark_photo_upload_failed",{p_queue_id:r,p_error:l});return i?(console.error("Error marking photo upload failed:",i),!1):c===!0},async getPendingPhotoUploads(r){if(!H)return[];const{data:l,error:c}=await w.rpc("get_pending_photo_uploads",{p_ticket_id:r});return c?(console.error("Error getting pending photo uploads:",c),[]):l||[]},async logPhotoOperation(r,l,c={}){if(H)try{await w.from("photo_audit_log").insert({ticket_id:r,cor_id:c.corId||null,operation:l,photo_url:c.photoUrl||null,storage_path:c.storagePath||null,details:c.metadata?c.metadata:null,error_message:c.error||null,triggered_by:c.triggeredBy||"system"})}catch(i){console.error("Error logging photo operation:",i)}},async saveExportSnapshot(r,l,c={}){if(!H)return null;const{exportType:i="pdf",exportReason:d=null,clientEmail:h=null,clientName:g=null}=c;try{const{data:p,error:y}=await w.from("cor_export_snapshots").insert({cor_id:r,export_type:i,export_reason:d,cor_data:l.cor_data,tickets_data:l.tickets_data,photos_manifest:l.photos_manifest,totals_snapshot:l.totals_snapshot,checksum:l.checksum,client_email:h,client_name:g}).select().single();if(y)throw y;return p}catch(p){return console.error("Error saving export snapshot:",p),null}},async getExportSnapshots(r){if(!H)return[];const{data:l,error:c}=await w.from("cor_export_snapshots").select("id, exported_at, export_type, export_reason, client_name, client_email, checksum").eq("cor_id",r).order("exported_at",{ascending:!1});return c?(console.error("Error fetching export snapshots:",c),[]):l||[]},async getExportSnapshot(r){if(!H)return null;const{data:l,error:c}=await w.from("cor_export_snapshots").select("*").eq("id",r).single();return c?(console.error("Error fetching export snapshot:",c),null):l},async requestCORExport(r,l,c={}){if(!H)return null;try{const i=await w.auth.getUser(),{data:d,error:h}=await w.rpc("request_cor_export",{p_cor_id:r,p_idempotency_key:l,p_options:c,p_requested_by:i?.data?.user?.id||null});if(h)throw h;return d?.[0]||null}catch(i){throw Et.error("database",{message:i.message,operation:"requestCORExport",extra:{corId:r}}),i}},async getExportJob(r){if(!H)return null;const{data:l,error:c}=await w.from("cor_export_jobs").select("*").eq("id",r).single();return c?(console.error("Error fetching export job:",c),null):l},async getExportJobs(r,l=10){if(!H)return[];const{data:c,error:i}=await w.from("cor_export_jobs").select("*").eq("cor_id",r).order("created_at",{ascending:!1}).limit(l);return i?(console.error("Error fetching export jobs:",i),[]):c||[]},async updateExportJobStatus(r,l,c={}){if(!H)return null;try{const{data:i,error:d}=await w.rpc("update_export_job_status",{p_job_id:r,p_status:l,p_snapshot_id:c.snapshotId||null,p_pdf_url:c.pdfUrl||null,p_error:c.error||null,p_error_details:c.errorDetails||null,p_metrics:c.metrics||null});if(d)throw d;return i}catch(i){throw Et.error("database",{message:i.message,operation:"updateExportJobStatus",extra:{jobId:r,status:l}}),i}},async getCurrentCORSnapshot(r){if(!H)return null;const{data:l}=await w.from("change_orders").select("version, last_snapshot_version").eq("id",r).single();if(!l||l.version!==l.last_snapshot_version)return null;const{data:c}=await w.from("cor_export_snapshots").select("*").eq("cor_id",r).eq("is_current",!0).single();return c||null},async saveCORSnapshot(r,l){if(!H)return null;try{await w.from("cor_export_snapshots").update({is_current:!1}).eq("cor_id",r.corId);const c=await w.auth.getUser(),{data:i,error:d}=await w.from("cor_export_snapshots").insert({id:r.snapshotId,cor_id:r.corId,job_id:l,cor_version:r.corVersion,cor_data:r.corData,tickets_data:r.ticketsData,photos_manifest:r.photoManifest,totals_snapshot:r.totals,checksum:r.checksum,is_current:!0,exported_by:c?.data?.user?.id||null}).select().single();if(d)throw d;return await w.from("change_orders").update({last_snapshot_version:r.corVersion}).eq("id",r.corId),i}catch(c){throw Et.error("database",{message:c.message,operation:"saveCORSnapshot",extra:{corId:r.corId}}),c}},async updateCORAggregatedStats(r){if(H)try{await w.rpc("update_cor_aggregated_stats",{p_cor_id:r})}catch(l){console.error("Error updating COR aggregated stats:",l)}},async getCrewCheckin(r,l=null){if(!H)return null;const c=l||new Date().toISOString().split("T")[0],{data:i,error:d}=await w.from("crew_checkins").select("*").eq("project_id",r).eq("check_in_date",c).single();return d&&d.code!=="PGRST116"&&console.error("Error fetching crew checkin:",d),i},async saveCrewCheckin(r,l,c=null,i=null){if(!H)return null;const d=i||new Date().toISOString().split("T")[0],{data:h,error:g}=await w.from("crew_checkins").upsert({project_id:r,check_in_date:d,workers:l,created_by:c,updated_at:new Date().toISOString()},{onConflict:"project_id,check_in_date"}).select().single();if(g)throw console.error("Error saving crew checkin:",g),g;return h},async addCrewMember(r,l,c=null){if(!H)return null;const i=await this.getCrewCheckin(r),d=i?.workers||[];return d.find(h=>h.name.toLowerCase()===l.name.toLowerCase())?i:(d.push(l),await this.saveCrewCheckin(r,d,c))},async removeCrewMember(r,l){if(!H)return null;const c=await this.getCrewCheckin(r);if(!c)return null;const i=c.workers.filter(d=>d.name.toLowerCase()!==l.toLowerCase());return await this.saveCrewCheckin(r,i,c.created_by)},async getCrewCheckinHistory(r,l=30){if(!H)return[];const{data:c,error:i}=await w.from("crew_checkins").select("*").eq("project_id",r).order("check_in_date",{ascending:!1}).limit(l);return i?(console.error("Error fetching crew history:",i),[]):c||[]},async getLaborRates(r,l=null,c=null){if(!H)return[];let i=w.from("labor_rates").select("*").eq("company_id",r);l&&(i=i.eq("work_type",l)),c&&(i=i.eq("job_type",c));const{data:d,error:h}=await i;return h?(console.error("Error fetching labor rates:",h),[]):d||[]},async calculateManDayCosts(r,l,c,i){if(!H)return{totalCost:0,totalManDays:0,breakdown:[]};const d=await this.getCrewCheckinHistory(r,365),h=await this.getLaborRates(l,c,i),g={};h.forEach(A=>{g[A.role.toLowerCase()]=parseFloat(A.regular_rate)||0});let p=0,y=0;const m={},v=[];return d.forEach(A=>{const _=A.workers||[];let j=0;const $={};_.forEach(C=>{const U=(C.role||"laborer").toLowerCase(),X=g[U]||0;$[U]||($[U]={count:0,cost:0}),$[U].count++,$[U].cost+=X,j+=X,m[U]||(m[U]={count:0,cost:0,rate:X}),m[U].count++,m[U].cost+=X}),p+=j,y+=_.length,v.push({date:A.check_in_date,workers:_.length,cost:j,breakdown:$})}),{totalCost:p,totalManDays:y,byRole:m,byDate:v,daysWorked:d.length}},async getDailyReport(r,l=null){if(!H)return null;const c=l||new Date().toISOString().split("T")[0],{data:i,error:d}=await w.from("daily_reports").select("*").eq("project_id",r).eq("report_date",c).single();return d&&d.code!=="PGRST116"&&console.error("Error fetching daily report:",d),i},async compileDailyReport(r,l=null){if(!H)return null;const c=l||new Date().toISOString().split("T")[0],i=await this.getCrewCheckin(r,c),{data:d}=await w.from("areas").select("*").eq("project_id",r),h=d?.filter(y=>y.status==="done"&&y.completed_at?.startsWith(c))||[],{data:g}=await w.from("t_and_m_tickets").select("*").eq("project_id",r).eq("work_date",c),p=g?.reduce((y,m)=>y+(m.photos?.length||0),0)||0;return{crew_count:i?.workers?.length||0,crew_list:i?.workers||[],tasks_completed:h.length,tasks_total:d?.length||0,completed_tasks:h.map(y=>({name:y.name,group:y.group_name})),tm_tickets_count:g?.length||0,photos_count:p}},async saveDailyReport(r,l,c=null){if(!H)return null;const i=c||new Date().toISOString().split("T")[0],{data:d,error:h}=await w.from("daily_reports").upsert({project_id:r,report_date:i,...l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(h)throw console.error("Error saving daily report:",h),h;return d},async submitDailyReport(r,l,c=null){if(!H)return null;const i=c||new Date().toISOString().split("T")[0],d=await this.compileDailyReport(r,i),{data:h,error:g}=await w.from("daily_reports").upsert({project_id:r,report_date:i,...d,status:"submitted",submitted_at:new Date().toISOString(),submitted_by:l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(g)throw console.error("Error submitting daily report:",g),g;return h},async getDailyReports(r,l=30){if(!H)return[];const{data:c,error:i}=await w.from("daily_reports").select("*").eq("project_id",r).order("report_date",{ascending:!1}).limit(l);return i?(console.error("Error fetching daily reports:",i),[]):c||[]},async sendMessage(r,l,c,i,d=null,h=null,g="general",p=null){if(!H)return null;const{data:y,error:m}=await w.from("messages").insert({project_id:r,sender_type:c,sender_name:i,sender_user_id:d,message:l,photo_url:h,message_type:g,parent_message_id:p}).select().single();if(m)throw console.error("Error sending message:",m),m;return y},async getMessages(r,l=50){if(!H)return[];const{data:c,error:i}=await w.from("messages").select("*").eq("project_id",r).order("created_at",{ascending:!1}).limit(l);return i?(console.error("Error fetching messages:",i),[]):c||[]},async getUnreadCount(r,l){if(!H)return 0;const c=l==="field"?"office":"field",{count:i,error:d}=await w.from("messages").select("*",{count:"exact",head:!0}).eq("project_id",r).eq("sender_type",c).eq("is_read",!1);return d?(console.error("Error getting unread count:",d),0):i||0},async markMessagesRead(r,l){if(!H)return;const c=l==="field"?"office":"field",{error:i}=await w.from("messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("project_id",r).eq("sender_type",c).eq("is_read",!1);i&&console.error("Error marking messages read:",i)},async createMaterialRequest(r,l,c,i=null,d="normal",h=null){if(!H)return null;const{data:g,error:p}=await w.from("material_requests").insert({project_id:r,items:l,requested_by:c,needed_by:i,priority:d,notes:h}).select().single();if(p)throw console.error("Error creating material request:",p),p;return g},async getMaterialRequests(r,l=null){if(!H)return[];let c=w.from("material_requests").select("*").eq("project_id",r).order("created_at",{ascending:!1});l&&(c=c.eq("status",l));const{data:i,error:d}=await c;return d?(console.error("Error fetching material requests:",d),[]):i||[]},async getPendingRequestsCount(r){if(!H)return 0;const{count:l,error:c}=await w.from("material_requests").select("*",{count:"exact",head:!0}).eq("project_id",r).eq("status","pending");return c?0:l||0},async updateMaterialRequest(r,l,c,i=null,d=null){if(!H)return null;const h={status:l,responded_by:c,responded_at:new Date().toISOString(),response_notes:i,updated_at:new Date().toISOString()};d&&(h.expected_delivery=d),l==="delivered"&&(h.delivered_at=new Date().toISOString());const{data:g,error:p}=await w.from("material_requests").update(h).eq("id",r).select().single();if(p)throw console.error("Error updating material request:",p),p;return g},generateShareToken(){const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let l="";for(let c=0;c<12;c++)l+=r.charAt(Math.floor(Math.random()*r.length));return l},async createProjectShare(r,l,c,i=null){if(!H){const y=Ze();y.projectShares||(y.projectShares=[]);const m={id:crypto.randomUUID(),project_id:r,share_token:this.generateShareToken(),created_by:l,expires_at:i,is_active:!0,permissions:c,view_count:0,last_viewed_at:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return y.projectShares.push(m),wt(y),m}const{data:d,error:h}=await w.rpc("generate_share_token");if(h)throw console.error("Error generating share token:",h),h;const{data:g,error:p}=await w.from("project_shares").insert({project_id:r,share_token:d,created_by:l,expires_at:i,permissions:c}).select().single();if(p)throw console.error("Error creating project share:",p),p;return g},async getShareByToken(r){if(!H){const i=Ze();if(!i.projectShares)return null;const d=i.projectShares.find(h=>h.share_token===r&&h.is_active&&(!h.expires_at||new Date(h.expires_at)>new Date));return d&&(d.view_count++,d.last_viewed_at=new Date().toISOString(),wt(i)),d}const{data:l,error:c}=await w.from("project_shares").select("*, projects(*)").eq("share_token",r).eq("is_active",!0).single();return c?(console.error("Error fetching share by token:",c),null):l.expires_at&&new Date(l.expires_at)<new Date?null:(await w.rpc("increment_share_view_count",{token:r}),l)},async getProjectShares(r){if(!H){const i=Ze();return i.projectShares?i.projectShares.filter(d=>d.project_id===r):[]}const{data:l,error:c}=await w.from("project_shares").select("*, users(name, email)").eq("project_id",r).order("created_at",{ascending:!1});return c?(console.error("Error fetching project shares:",c),[]):l||[]},async updateProjectShare(r,l){if(!H){const d=Ze();if(!d.projectShares)return null;const h=d.projectShares.findIndex(g=>g.id===r);return h===-1?null:(d.projectShares[h]={...d.projectShares[h],...l,updated_at:new Date().toISOString()},wt(d),d.projectShares[h])}const{data:c,error:i}=await w.from("project_shares").update(l).eq("id",r).select().single();if(i)throw console.error("Error updating project share:",i),i;return c},async revokeProjectShare(r){return this.updateProjectShare(r,{is_active:!1})},async deleteProjectShare(r){if(!H){const c=Ze();if(!c.projectShares)return;c.projectShares=c.projectShares.filter(i=>i.id!==r),wt(c);return}const{error:l}=await w.from("project_shares").delete().eq("id",r);if(l)throw console.error("Error deleting project share:",l),l},async getPublicProjectData(r){const l=await this.getShareByToken(r);if(!l)return null;const c=l.project_id||l.projects?.id;if(!H){const h=Ze(),g=h.projects.find(A=>A.id===c);if(!g)return null;const p=h.areas.filter(A=>A.project_id===c),y=p.reduce((A,_)=>A+parseFloat(_.weight||0),0),m=p.filter(A=>A.status==="done").reduce((A,_)=>A+parseFloat(_.weight||0),0),v=y>0?Math.round(m/y*100):0;return{share:l,project:g,progress:v,areas:l.permissions.progress?p:[],photos:[],dailyReports:[],tmTickets:[]}}const i=l.projects||await this.getProject(c);if(!i)return null;const d={share:l,project:i,areas:[],photos:[],dailyReports:[],tmTickets:[]};if(l.permissions.progress){d.areas=await this.getAreas(c);const h=d.areas.reduce((p,y)=>p+parseFloat(y.weight||0),0),g=d.areas.filter(p=>p.status==="done").reduce((p,y)=>p+parseFloat(y.weight||0),0);d.progress=h>0?Math.round(g/h*100):0}if(l.permissions.photos){const{data:h}=await w.from("t_and_m_tickets").select("photos, work_date").eq("project_id",c).not("photos","is",null).order("work_date",{ascending:!1}).limit(20);d.photos=h?.flatMap(g=>(g.photos||[]).map(p=>({url:p,date:g.work_date})))||[]}if(l.permissions.daily_reports){const{data:h}=await w.from("daily_reports").select("*").eq("project_id",c).order("report_date",{ascending:!1}).limit(10);d.dailyReports=h||[]}return l.permissions.tm_tickets&&(d.tmTickets=await this.getTMTickets(c)),d},async createInjuryReport(r){if(!H){const i=Ze();i.injuryReports||(i.injuryReports=[]);const d={id:crypto.randomUUID(),...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return i.injuryReports.push(d),wt(i),d}const{data:l,error:c}=await w.from("injury_reports").insert(r).select().single();if(c)throw console.error("Error creating injury report:",c),c;return l},async getInjuryReports(r){if(!H){const i=Ze();return i.injuryReports?i.injuryReports.filter(d=>d.project_id===r).sort((d,h)=>new Date(h.incident_date)-new Date(d.incident_date)):[]}const{data:l,error:c}=await w.from("injury_reports").select("*").eq("project_id",r).order("incident_date",{ascending:!1});return c?(console.error("Error fetching injury reports:",c),[]):l||[]},async getCompanyInjuryReports(r,l=null){if(!H){const h=Ze();if(!h.injuryReports)return[];let g=h.injuryReports.filter(p=>p.company_id===r);return l&&(g=g.filter(p=>p.status===l)),g.sort((p,y)=>new Date(y.incident_date)-new Date(p.incident_date))}let c=w.from("injury_reports").select("*, projects(name)").eq("company_id",r).order("incident_date",{ascending:!1});l&&(c=c.eq("status",l));const{data:i,error:d}=await c;return d?(console.error("Error fetching company injury reports:",d),[]):i||[]},async getInjuryReport(r){if(!H){const i=Ze();return i.injuryReports?i.injuryReports.find(d=>d.id===r):null}const{data:l,error:c}=await w.from("injury_reports").select("*, projects(name, pin), users(name, email)").eq("id",r).single();return c?(console.error("Error fetching injury report:",c),null):l},async updateInjuryReport(r,l){if(!H){const d=Ze();if(!d.injuryReports)return null;const h=d.injuryReports.findIndex(g=>g.id===r);return h===-1?null:(d.injuryReports[h]={...d.injuryReports[h],...l,updated_at:new Date().toISOString()},wt(d),d.injuryReports[h])}const{data:c,error:i}=await w.from("injury_reports").update(l).eq("id",r).select().single();if(i)throw console.error("Error updating injury report:",i),i;return c},async closeInjuryReport(r,l){return this.updateInjuryReport(r,{status:"closed",closed_at:new Date().toISOString(),closed_by:l})},async deleteInjuryReport(r){if(!H){const c=Ze();if(!c.injuryReports)return;c.injuryReports=c.injuryReports.filter(i=>i.id!==r),wt(c);return}const{error:l}=await w.from("injury_reports").delete().eq("id",r);if(l)throw console.error("Error deleting injury report:",l),l},async getInjuryStatistics(r,l=null,c=null){if(!H){const h=Ze();if(!h.injuryReports)return{total_incidents:0,minor_injuries:0,serious_injuries:0,critical_injuries:0,near_misses:0,osha_recordable:0,total_days_away:0,total_restricted_days:0};let g=h.injuryReports.filter(p=>p.company_id===r);return l&&(g=g.filter(p=>new Date(p.incident_date)>=new Date(l))),c&&(g=g.filter(p=>new Date(p.incident_date)<=new Date(c))),{total_incidents:g.length,minor_injuries:g.filter(p=>p.injury_type==="minor").length,serious_injuries:g.filter(p=>p.injury_type==="serious").length,critical_injuries:g.filter(p=>p.injury_type==="critical").length,near_misses:g.filter(p=>p.injury_type==="near_miss").length,osha_recordable:g.filter(p=>p.osha_recordable).length,total_days_away:g.reduce((p,y)=>p+(y.days_away_from_work||0),0),total_restricted_days:g.reduce((p,y)=>p+(y.restricted_work_days||0),0)}}const{data:i,error:d}=await w.rpc("get_injury_statistics",{comp_id:r,start_date:l,end_date:c});return d?(console.error("Error fetching injury statistics:",d),null):i[0]||null},async addWitness(r,l){if(!H){const d=Ze();if(!d.injuryReports)return null;const h=d.injuryReports.findIndex(y=>y.id===r);if(h===-1)return null;const g=d.injuryReports[h],p=g.witnesses||[];return p.push(l),d.injuryReports[h]={...g,witnesses:p,updated_at:new Date().toISOString()},wt(d),d.injuryReports[h]}const c=await this.getInjuryReport(r);if(!c)return null;const i=c.witnesses||[];return i.push(l),this.updateInjuryReport(r,{witnesses:i})},async removeWitness(r,l){if(!H){const d=Ze();if(!d.injuryReports)return null;const h=d.injuryReports.findIndex(y=>y.id===r);if(h===-1)return null;const g=d.injuryReports[h],p=g.witnesses||[];return p.splice(l,1),d.injuryReports[h]={...g,witnesses:p,updated_at:new Date().toISOString()},wt(d),d.injuryReports[h]}const c=await this.getInjuryReport(r);if(!c)return null;const i=c.witnesses||[];return i.splice(l,1),this.updateInjuryReport(r,{witnesses:i})},async getCompanyUsers(r){if(H){const{data:l,error:c}=await w.from("user_companies").select(`
          user_id,
          role,
          users (
            id,
            name,
            email
          )
        `).eq("company_id",r);return c?(console.error("Error fetching company users:",c),[]):l?.map(i=>({id:i.user_id,name:i.users?.name||i.users?.email,email:i.users?.email,role:i.role}))||[]}return[]},async getProjectNotificationPreferences(r){if(H){const{data:c,error:i}=await w.from("notification_preferences").select(`
          *,
          users (
            id,
            name,
            email
          )
        `).eq("project_id",r);return i?(console.error("Error fetching notification preferences:",i),[]):c||[]}const l=Ze();return l.notificationPreferences?l.notificationPreferences.filter(c=>c.project_id===r):[]},async getUserNotificationPreferences(r){if(H){const{data:c,error:i}=await w.from("notification_preferences").select(`
          *,
          projects (
            id,
            name
          )
        `).eq("user_id",r);return i?(console.error("Error fetching user notification preferences:",i),[]):c||[]}const l=Ze();return l.notificationPreferences?l.notificationPreferences.filter(c=>c.user_id===r):[]},async setNotificationPreference(r,l,c){if(H){const{data:g,error:p}=await w.from("notification_preferences").upsert({project_id:r,user_id:l,notification_types:c,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id"}).select().single();if(p)throw console.error("Error setting notification preference:",p),p;return g}const i=Ze();i.notificationPreferences||(i.notificationPreferences=[]);const d=i.notificationPreferences.findIndex(g=>g.project_id===r&&g.user_id===l),h={id:d>=0?i.notificationPreferences[d].id:crypto.randomUUID(),project_id:r,user_id:l,notification_types:c,created_at:d>=0?i.notificationPreferences[d].created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return d>=0?i.notificationPreferences[d]=h:i.notificationPreferences.push(h),wt(i),h},async removeNotificationPreference(r,l){if(H){const{error:i}=await w.from("notification_preferences").delete().eq("project_id",r).eq("user_id",l);if(i)throw console.error("Error removing notification preference:",i),i;return!0}const c=Ze();return c.notificationPreferences&&(c.notificationPreferences=c.notificationPreferences.filter(i=>!(i.project_id===r&&i.user_id===l)),wt(c)),!0},async setProjectNotificationPreferences(r,l){const c=[];for(const i of l)if(i.notificationTypes&&i.notificationTypes.length>0){const d=await this.setNotificationPreference(r,i.userId,i.notificationTypes);c.push(d)}else await this.removeNotificationPreference(r,i.userId);return c},async getNotificationPresets(r){if(H){const{data:c,error:i}=await w.from("notification_presets").select("*").eq("company_id",r).order("name");return i?(console.error("Error fetching notification presets:",i),[]):c||[]}const l=Ze();return l.notificationPresets?l.notificationPresets.filter(c=>c.company_id===r):[{id:"preset-1",name:"Project Manager",notification_types:["message","material_request","injury_report","tm_ticket"],company_id:r},{id:"preset-2",name:"Safety Officer",notification_types:["injury_report"],company_id:r},{id:"preset-3",name:"Purchasing",notification_types:["material_request"],company_id:r},{id:"preset-4",name:"Accounting",notification_types:["tm_ticket"],company_id:r}]},async createNotificationPreset(r,l,c){if(H){const{data:h,error:g}=await w.from("notification_presets").insert({company_id:r,name:l,notification_types:c}).select().single();if(g)throw console.error("Error creating notification preset:",g),g;return h}const i=Ze();i.notificationPresets||(i.notificationPresets=[]);const d={id:crypto.randomUUID(),company_id:r,name:l,notification_types:c,created_at:new Date().toISOString()};return i.notificationPresets.push(d),wt(i),d},async updateNotificationPreset(r,l,c){if(H){const{data:h,error:g}=await w.from("notification_presets").update({name:l,notification_types:c,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(g)throw console.error("Error updating notification preset:",g),g;return h}const i=Ze();if(!i.notificationPresets)return null;const d=i.notificationPresets.findIndex(h=>h.id===r);return d===-1?null:(i.notificationPresets[d]={...i.notificationPresets[d],name:l,notification_types:c,updated_at:new Date().toISOString()},wt(i),i.notificationPresets[d])},async deleteNotificationPreset(r){if(H){const{error:c}=await w.from("notification_presets").delete().eq("id",r);if(c)throw console.error("Error deleting notification preset:",c),c;return!0}const l=Ze();return l.notificationPresets&&(l.notificationPresets=l.notificationPresets.filter(c=>c.id!==r),wt(l)),!0},async getDumpSites(r){if(H){const{data:c,error:i}=await w.from("dump_sites").select(`
          *,
          dump_site_rates (*)
        `).eq("company_id",r).eq("active",!0).order("name");return i?(console.error("Error fetching dump sites:",i),[]):c||[]}return(Ze().dumpSites||[]).filter(c=>c.company_id===r&&c.active)},async createDumpSite(r,l,c="",i=""){if(H){const{data:g,error:p}=await w.from("dump_sites").insert({company_id:r,name:l,address:c,notes:i,active:!0}).select().single();if(p)throw console.error("Error creating dump site:",p),p;return g}const d=Ze();d.dumpSites||(d.dumpSites=[]);const h={id:crypto.randomUUID(),company_id:r,name:l,address:c,notes:i,active:!0,created_at:new Date().toISOString(),dump_site_rates:[]};return d.dumpSites.push(h),wt(d),h},async updateDumpSite(r,l){if(H){const{data:d,error:h}=await w.from("dump_sites").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(h)throw console.error("Error updating dump site:",h),h;return d}const c=Ze();if(!c.dumpSites)return null;const i=c.dumpSites.findIndex(d=>d.id===r);return i===-1?null:(c.dumpSites[i]={...c.dumpSites[i],...l},wt(c),c.dumpSites[i])},async deleteDumpSite(r){return this.updateDumpSite(r,{active:!1})},async setDumpSiteRate(r,l,c,i="load"){if(H){const{data:p}=await w.from("dump_site_rates").select("id").eq("dump_site_id",r).eq("waste_type",l).maybeSingle();if(p){const{data:y,error:m}=await w.from("dump_site_rates").update({estimated_cost_per_load:c,unit:i}).eq("id",p.id).select().single();if(m)throw console.error("Error updating dump site rate:",m),m;return y}else{const{data:y,error:m}=await w.from("dump_site_rates").insert({dump_site_id:r,waste_type:l,estimated_cost_per_load:c,unit:i}).select().single();if(m)throw console.error("Error inserting dump site rate:",m),m;return y}}const d=Ze();d.dumpSiteRates||(d.dumpSiteRates=[]);const h=d.dumpSiteRates.findIndex(p=>p.dump_site_id===r&&p.waste_type===l),g={id:h>=0?d.dumpSiteRates[h].id:crypto.randomUUID(),dump_site_id:r,waste_type:l,estimated_cost_per_load:c,unit:i,created_at:new Date().toISOString()};return h>=0?d.dumpSiteRates[h]=g:d.dumpSiteRates.push(g),wt(d),g},async getDumpSiteRates(r){if(H){const{data:c,error:i}=await w.from("dump_site_rates").select("*").eq("dump_site_id",r);return i?(console.error("Error fetching dump site rates:",i),[]):c||[]}return(Ze().dumpSiteRates||[]).filter(c=>c.dump_site_id===r)},async getHaulOffs(r){if(H){const{data:c,error:i}=await w.from("haul_offs").select(`
          *,
          dump_sites (name)
        `).eq("project_id",r).order("work_date",{ascending:!1});return i?(console.error("Error fetching haul-offs:",i),[]):c||[]}return(Ze().haulOffs||[]).filter(c=>c.project_id===r).sort((c,i)=>new Date(i.work_date)-new Date(c.work_date))},async createHaulOff(r,l){const c={project_id:r,dump_site_id:l.dumpSiteId,waste_type:l.wasteType,loads:l.loads,hauling_company:l.haulingCompany||"",work_date:l.workDate,notes:l.notes||"",estimated_cost:l.estimatedCost||0,created_by:l.createdBy||""};if(H){const{data:h,error:g}=await w.from("haul_offs").insert(c).select().single();if(g)throw console.error("Error creating haul-off:",g),g;return h}const i=Ze();i.haulOffs||(i.haulOffs=[]);const d={...c,id:crypto.randomUUID(),created_at:new Date().toISOString()};return i.haulOffs.push(d),wt(i),d},async calculateHaulOffCosts(r){const l=await this.getHaulOffs(r);let c=0,i=0;const d={},h=[],g={};l.forEach(y=>{const m=parseFloat(y.estimated_cost)||0,v=parseInt(y.loads)||0;c+=m,i+=v,d[y.waste_type]||(d[y.waste_type]={loads:0,cost:0}),d[y.waste_type].loads+=v,d[y.waste_type].cost+=m,g[y.work_date]||(g[y.work_date]={date:y.work_date,loads:0,cost:0}),g[y.work_date].loads+=v,g[y.work_date].cost+=m}),Object.values(g).sort((y,m)=>new Date(m.date)-new Date(y.date)).forEach(y=>h.push(y));const p=h.length;return{totalCost:c,totalLoads:i,byWasteType:d,byDate:h,daysWithHaulOff:p,avgDailyHaulOffCost:p>0?c/p:0}},subscribeToHaulOffs(r,l){return H?w.channel(`haul_offs:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"haul_offs",filter:`project_id=eq.${r}`},l).subscribe():null},async createCOR(r,l=0){if(H){let c=r.cor_number;l>0&&(c=await this.getNextCORNumber(r.project_id));const{data:i,error:d}=await w.from("change_orders").insert({company_id:r.company_id,project_id:r.project_id,area_id:r.area_id||null,cor_number:c,title:r.title,description:r.description||"",scope_of_work:r.scope_of_work,period_start:r.period_start,period_end:r.period_end,status:"draft",labor_markup_percent:r.labor_markup_percent??1500,materials_markup_percent:r.materials_markup_percent??1500,equipment_markup_percent:r.equipment_markup_percent??1500,subcontractors_markup_percent:r.subcontractors_markup_percent??500,liability_insurance_percent:r.liability_insurance_percent??144,bond_percent:r.bond_percent??100,license_fee_percent:r.license_fee_percent??10,created_by:r.created_by||null}).select().single();if((d?.code==="23505"||d?.code==="PGRST116"||d?.status===409||d?.message?.includes("duplicate")||d?.message?.includes("unique_cor_number"))&&l<3)return console.warn(`COR number conflict, retrying with fresh number (attempt ${l+1})`),this.createCOR(r,l+1);if(d)throw d;return i}return null},async updateCOR(r,l){if(H){const{data:c,error:i}=await w.from("change_orders").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(i)throw i;return c}return null},async deleteCOR(r){if(H){const{error:l}=await w.from("change_orders").delete().eq("id",r);if(l)throw l}},async bulkUpdateCORGroup(r,l){if(H){const{error:c}=await w.from("change_orders").update({group_name:l,updated_at:new Date().toISOString()}).in("id",r);if(c)throw c.message?.includes("group_name")||c.code==="PGRST204"?new Error("COR grouping requires a database migration. Please run database/migration_cor_enhancements.sql in Supabase SQL Editor."):c}},async getCORs(r,l={}){if(H){let c=w.from("change_orders").select(`
          *,
          areas (id, name),
          labor_count:change_order_labor(count),
          materials_count:change_order_materials(count),
          equipment_count:change_order_equipment(count),
          subcontractors_count:change_order_subcontractors(count),
          tickets_count:change_order_ticket_associations(count)
        `).eq("project_id",r);l.status&&(c=c.eq("status",l.status)),l.area_id&&(c=c.eq("area_id",l.area_id)),l.date_start&&(c=c.gte("period_start",l.date_start)),l.date_end&&(c=c.lte("period_end",l.date_end)),c=c.order("created_at",{ascending:!1});const{data:i,error:d}=await c;if(d)throw d;return i}return[]},async getCORById(r){if(H){const{data:l,error:c}=await w.from("change_orders").select(`
          *,
          areas (id, name),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*),
          change_order_ticket_associations (
            *,
            t_and_m_tickets (
              *,
              t_and_m_workers (*),
              t_and_m_items (
                *,
                materials_equipment (name, unit, cost_per_unit, category)
              )
            )
          )
        `).eq("id",r).single();if(c)throw c;return l}return null},async getCORsByArea(r,l){if(H){const{data:c,error:i}=await w.from("change_orders").select("*").eq("project_id",r).eq("area_id",l).order("created_at",{ascending:!1});if(i)throw i;return c}return[]},async getAssignableCORs(r){if(H){const{data:l,error:c}=await w.from("change_orders").select("id, cor_number, title, status, cor_total").eq("project_id",r).in("status",["draft","pending_approval","approved"]).order("cor_number",{ascending:!0});if(c)throw c;return l||[]}return[]},async getNextCORNumber(r){if(H){const{data:l,error:c}=await w.from("change_orders").select("cor_number").eq("project_id",r);if(c)throw c;if(l&&l.length>0){let i=0;for(const d of l){const h=d.cor_number?.match(/COR #(\d+)/);if(h){const g=parseInt(h[1]);g>i&&(i=g)}}return`COR #${i+1}`}return"COR #1"}return"COR #1"},async addCORLaborItem(r,l){if(H){const c=Math.round(l.regular_hours*l.regular_rate),i=Math.round(l.overtime_hours*l.overtime_rate),d=c+i,{data:h,error:g}=await w.from("change_order_labor").insert({change_order_id:r,labor_class:l.labor_class,wage_type:l.wage_type||"standard",regular_hours:l.regular_hours||0,overtime_hours:l.overtime_hours||0,regular_rate:l.regular_rate||0,overtime_rate:l.overtime_rate||0,regular_total:c,overtime_total:i,total:d,sort_order:l.sort_order||0,source_ticket_id:l.source_ticket_id||null}).select().single();if(g)throw g;return h}return null},async updateCORLaborItem(r,l){if(H){let c={...l};if(l.regular_hours!==void 0||l.regular_rate!==void 0||l.overtime_hours!==void 0||l.overtime_rate!==void 0){const{data:h}=await w.from("change_order_labor").select("regular_hours, overtime_hours, regular_rate, overtime_rate").eq("id",r).single(),g=l.regular_hours??h?.regular_hours??0,p=l.overtime_hours??h?.overtime_hours??0,y=l.regular_rate??h?.regular_rate??0,m=l.overtime_rate??h?.overtime_rate??0;c.regular_total=Math.round(g*y),c.overtime_total=Math.round(p*m),c.total=c.regular_total+c.overtime_total}const{data:i,error:d}=await w.from("change_order_labor").update(c).eq("id",r).select().single();if(d)throw d;return i}return null},async deleteCORLaborItem(r){if(H){const{error:l}=await w.from("change_order_labor").delete().eq("id",r);if(l)throw l}},async addCORMaterialItem(r,l){if(H){const i=["backup_sheet","invoice","mobilization","custom","field_ticket","rental"].includes(l.source_type)?l.source_type:"custom",d=Math.round(Number(l.unit_cost)||0),h=Number(l.quantity)||1,g=Math.round(h*d),{data:p,error:y}=await w.from("change_order_materials").insert({change_order_id:r,description:l.description||"",quantity:h,unit:l.unit||"each",unit_cost:d,total:g,source_type:i,source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(y)throw y;return p}return null},async updateCORMaterialItem(r,l){if(H){let c={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:h}=await w.from("change_order_materials").select("quantity, unit_cost").eq("id",r).single(),g=l.quantity??h?.quantity??1,p=l.unit_cost??h?.unit_cost??0;c.total=Math.round(g*p)}const{data:i,error:d}=await w.from("change_order_materials").update(c).eq("id",r).select().single();if(d)throw d;return i}return null},async deleteCORMaterialItem(r){if(H){const{error:l}=await w.from("change_order_materials").delete().eq("id",r);if(l)throw l}},async addCOREquipmentItem(r,l){if(H){const i=["backup_sheet","invoice","custom","field_ticket","rental"].includes(l.source_type)?l.source_type:"custom",d=Math.round(Number(l.unit_cost)||0),h=Number(l.quantity)||1,g=Math.round(h*d),{data:p,error:y}=await w.from("change_order_equipment").insert({change_order_id:r,description:l.description||"",quantity:h,unit:l.unit||"day",unit_cost:d,total:g,source_type:i,source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(y)throw y;return p}return null},async updateCOREquipmentItem(r,l){if(H){let c={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:h}=await w.from("change_order_equipment").select("quantity, unit_cost").eq("id",r).single(),g=l.quantity??h?.quantity??1,p=l.unit_cost??h?.unit_cost??0;c.total=Math.round(g*p)}const{data:i,error:d}=await w.from("change_order_equipment").update(c).eq("id",r).select().single();if(d)throw d;return i}return null},async deleteCOREquipmentItem(r){if(H){const{error:l}=await w.from("change_order_equipment").delete().eq("id",r);if(l)throw l}},async addCORSubcontractorItem(r,l){if(H){const c=Math.round(l.quantity*l.unit_cost),{data:i,error:d}=await w.from("change_order_subcontractors").insert({change_order_id:r,description:l.description,quantity:l.quantity||1,unit:l.unit||"lump sum",unit_cost:l.unit_cost||0,total:c,source_type:l.source_type||"custom",source_reference:l.source_reference||null,sort_order:l.sort_order||0}).select().single();if(d)throw d;return i}return null},async updateCORSubcontractorItem(r,l){if(H){let c={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:h}=await w.from("change_order_subcontractors").select("quantity, unit_cost").eq("id",r).single(),g=l.quantity??h?.quantity??1,p=l.unit_cost??h?.unit_cost??0;c.total=Math.round(g*p)}const{data:i,error:d}=await w.from("change_order_subcontractors").update(c).eq("id",r).select().single();if(d)throw d;return i}return null},async deleteCORSubcontractorItem(r){if(H){const{error:l}=await w.from("change_order_subcontractors").delete().eq("id",r);if(l)throw l}},async addBulkLaborItems(r,l){if(H&&l.length>0){const c=l.map((h,g)=>{const p=Math.round(h.regular_hours*h.regular_rate),y=Math.round(h.overtime_hours*h.overtime_rate);return{change_order_id:r,labor_class:h.labor_class,wage_type:h.wage_type||"standard",regular_hours:h.regular_hours||0,overtime_hours:h.overtime_hours||0,regular_rate:h.regular_rate||0,overtime_rate:h.overtime_rate||0,regular_total:p,overtime_total:y,total:p+y,sort_order:h.sort_order??g,source_ticket_id:h.source_ticket_id||null}}),{data:i,error:d}=await w.from("change_order_labor").insert(c).select();if(d)throw d;return i}return[]},async addBulkMaterialItems(r,l){if(H&&l.length>0){const c=["backup_sheet","invoice","mobilization","custom","field_ticket","rental"],i=l.map((g,p)=>{const y=c.includes(g.source_type)?g.source_type:"custom",m=Math.round(Number(g.unit_cost)||0),v=Number(g.quantity)||1;return{change_order_id:r,description:g.description||"",quantity:v,unit:g.unit||"each",unit_cost:m,total:Math.round(v*m),source_type:y,source_reference:g.source_reference||null,source_ticket_id:g.source_ticket_id||null,sort_order:g.sort_order??p}}),{data:d,error:h}=await w.from("change_order_materials").insert(i).select();if(h)throw h;return d}return[]},async addBulkEquipmentItems(r,l){if(H&&l.length>0){const c=["backup_sheet","invoice","custom","field_ticket","rental"],i=l.map((g,p)=>{const y=c.includes(g.source_type)?g.source_type:"custom",m=Math.round(Number(g.unit_cost)||0),v=Number(g.quantity)||1;return{change_order_id:r,description:g.description||"",quantity:v,unit:g.unit||"day",unit_cost:m,total:Math.round(v*m),source_type:y,source_reference:g.source_reference||null,source_ticket_id:g.source_ticket_id||null,sort_order:g.sort_order??p}}),{data:d,error:h}=await w.from("change_order_equipment").insert(i).select();if(h)throw h;return d}return[]},async addBulkSubcontractorItems(r,l){if(H&&l.length>0){const c=l.map((h,g)=>({change_order_id:r,company_name:h.company_name||"",description:h.description||"",quantity:h.quantity||1,unit:h.unit||"lump sum",unit_cost:h.unit_cost||h.total||h.amount||0,total:h.total||h.amount||0,source_type:h.source_type||"invoice",source_reference:h.source_reference||null,sort_order:h.sort_order??g})),{data:i,error:d}=await w.from("change_order_subcontractors").insert(c).select();if(d)throw d;return i}return[]},async clearCORLineItems(r){H&&(await w.from("change_order_labor").delete().eq("change_order_id",r),await w.from("change_order_materials").delete().eq("change_order_id",r),await w.from("change_order_equipment").delete().eq("change_order_id",r),await w.from("change_order_subcontractors").delete().eq("change_order_id",r))},async saveCORLineItems(r,{laborItems:l,materialItems:c,equipmentItems:i,subcontractorItems:d}){if(H){await this.clearCORLineItems(r);const h=await Promise.all([l?.length>0?this.addBulkLaborItems(r,l):[],c?.length>0?this.addBulkMaterialItems(r,c):[],i?.length>0?this.addBulkEquipmentItems(r,i):[],d?.length>0?this.addBulkSubcontractorItems(r,d):[]]);return{labor:h[0],materials:h[1],equipment:h[2],subcontractors:h[3]}}return null},async assignTicketToCOR(r,l){if(H){const{error:c}=await w.rpc("assign_ticket_to_cor",{p_ticket_id:r,p_cor_id:l});if(c)throw Et.error("database",{message:c.message,operation:"assignTicketToCOR",extra:{ticketId:r,corId:l}}),c;return{ticket_id:r,change_order_id:l}}return null},async unassignTicketFromCOR(r,l){if(H){const{error:c}=await w.rpc("unassign_ticket_from_cor",{p_ticket_id:r,p_cor_id:l});if(c)throw Et.error("database",{message:c.message,operation:"unassignTicketFromCOR",extra:{ticketId:r,corId:l}}),c}},async checkTicketCORIntegrity(){if(H){const{data:r,error:l}=await w.rpc("check_ticket_cor_integrity");if(l)throw l;return r||[]}return[]},async fixTicketCORIntegrity(){if(H){const{data:r,error:l}=await w.rpc("fix_ticket_cor_integrity");if(l)throw l;return r}return 0},async getTicketsForCOR(r){if(H){const{data:l,error:c}=await w.from("change_order_ticket_associations").select(`
          *,
          t_and_m_tickets (
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          )
        `).eq("change_order_id",r);if(c)throw c;return l}return[]},async getUnassignedTickets(r){if(H){const{data:l,error:c}=await w.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).is("assigned_cor_id",null).order("work_date",{ascending:!1});if(c)throw c;return l}return[]},async importTicketDataToCOR(r,l,c,i,d){if(H){const{data:h,error:g}=await w.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("id",r).single();if(g)throw g;const{data:p,error:y}=await w.from("labor_rates").select("*").eq("company_id",c).eq("work_type",i||"demolition").eq("job_type",d||"standard");if(y)throw y;const m={};p?.forEach(C=>{m[C.role.toLowerCase()]=C});const v={};h.t_and_m_workers?.forEach(C=>{const U=(C.role||"laborer").toLowerCase();v[U]||(v[U]={regular_hours:0,overtime_hours:0}),v[U].regular_hours+=parseFloat(C.hours)||0,v[U].overtime_hours+=parseFloat(C.overtime_hours)||0});const A=Object.entries(v).map(([C,U])=>{const X=m[C]||{regular_rate:0,overtime_rate:0},V=Math.round((parseFloat(X.regular_rate)||0)*100),q=Math.round((parseFloat(X.overtime_rate)||0)*100);return{labor_class:C.charAt(0).toUpperCase()+C.slice(1),wage_type:d||"standard",regular_hours:U.regular_hours,overtime_hours:U.overtime_hours,regular_rate:V,overtime_rate:q,source_ticket_id:r}});A.length>0&&await this.addBulkLaborItems(l,A);const _=[],j=[];h.t_and_m_items?.forEach(C=>{const U=C.custom_name||C.materials_equipment?.name||"Unknown Item",X=C.custom_category||C.materials_equipment?.category||"Other",V=C.materials_equipment?.unit||"each",q=Math.round((parseFloat(C.materials_equipment?.cost_per_unit)||0)*100),E={description:U,quantity:C.quantity||1,unit:V,unit_cost:q,source_type:"backup_sheet",source_ticket_id:r};X==="Equipment"?j.push(E):_.push(E)}),_.length>0&&await this.addBulkMaterialItems(l,_),j.length>0&&await this.addBulkEquipmentItems(l,j);const{error:$}=await w.from("change_order_ticket_associations").update({data_imported:!0,imported_at:new Date().toISOString(),import_status:"completed",import_failed_at:null,import_error:null}).eq("change_order_id",l).eq("ticket_id",r);if($)throw $;return Et.activity("cor_import_success",{ticket_id:r,cor_id:l,labor_count:A.length,material_count:_.length,equipment_count:j.length}),{laborItems:A,materialItems:_,equipmentItems:j}}return null},async reimportTicketDataToCOR(r,l,c,i,d){return H?(await w.from("change_order_labor").delete().eq("change_order_id",l).eq("source_ticket_id",r),await w.from("change_order_materials").delete().eq("change_order_id",l).eq("source_ticket_id",r),await w.from("change_order_equipment").delete().eq("change_order_id",l).eq("source_ticket_id",r),this.importTicketDataToCOR(r,l,c,i,d)):null},async markImportFailed(r,l,c="Import failed"){if(H){const{error:i}=await w.from("change_order_ticket_associations").update({import_status:"failed",import_failed_at:new Date().toISOString(),import_error:c}).eq("change_order_id",l).eq("ticket_id",r);if(i)throw Et.error("database",{message:i.message,operation:"markImportFailed",extra:{ticketId:r,corId:l}}),i;Et.error("cor_import_failed",{ticket_id:r,cor_id:l,error:c})}},async getTicketsNeedingImport(r){if(H){const{data:l,error:c}=await w.from("t_and_m_tickets").select(`
          id,
          work_date,
          ce_pco_number,
          assigned_cor_id,
          change_order_ticket_associations!inner (
            change_order_id,
            import_status,
            import_failed_at,
            import_error
          )
        `).eq("project_id",r).eq("change_order_ticket_associations.import_status","failed");if(c)throw c;return l||[]}return[]},async getTicketImportStatus(r,l){if(H){const{data:c,error:i}=await w.from("change_order_ticket_associations").select("import_status, import_failed_at, import_error, data_imported").eq("ticket_id",r).eq("change_order_id",l).single();if(i&&i.code!=="PGRST116")throw i;return c}return null},async recalculateCOR(r){if(H){const{error:l}=await w.rpc("recalculate_cor_totals",{cor_id:r});if(l)throw l;return this.getCORById(r)}return null},async updateCORMarkupPercentages(r,l){if(H){const c={};l.labor!==void 0&&(c.labor_markup_percent=l.labor),l.materials!==void 0&&(c.materials_markup_percent=l.materials),l.equipment!==void 0&&(c.equipment_markup_percent=l.equipment),l.subcontractors!==void 0&&(c.subcontractors_markup_percent=l.subcontractors);const{data:i,error:d}=await w.from("change_orders").update(c).eq("id",r).select().single();if(d)throw d;return i}return null},async updateCORFeePercentages(r,l){if(H){const c={};l.liabilityInsurance!==void 0&&(c.liability_insurance_percent=l.liabilityInsurance),l.bond!==void 0&&(c.bond_percent=l.bond),l.licenseFee!==void 0&&(c.license_fee_percent=l.licenseFee);const{data:i,error:d}=await w.from("change_orders").update(c).eq("id",r).select().single();if(d)throw d;return i}return null},async submitCORForApproval(r){if(H){const{data:l,error:c}=await w.from("change_orders").update({status:"pending_approval",submitted_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw c;return l}return null},async approveCOR(r,l){if(H){const{data:c,error:i}=await w.from("change_orders").update({status:"approved",approved_by:l,approved_at:new Date().toISOString()}).eq("id",r).select().single();if(i)throw i;return c}return null},async rejectCOR(r,l=null){if(H){const{data:c,error:i}=await w.from("change_orders").update({status:"rejected",rejection_reason:l}).eq("id",r).select().single();if(i)throw i;return c}return null},async markCORAsBilled(r){if(H){const{data:l,error:c}=await w.from("change_orders").update({status:"billed"}).eq("id",r).select().single();if(c)throw c;return l}return null},async closeCOR(r){if(H){const{data:l,error:c}=await w.from("change_orders").update({status:"closed"}).eq("id",r).select().single();if(c)throw c;return l}return null},async saveCORSignature(r,l,c){if(H){const{data:i,error:d}=await w.from("change_orders").update({gc_signature_data:l,gc_signature_name:c,gc_signature_date:new Date().toISOString(),status:"approved"}).eq("id",r).select().single();if(d)throw d;return i}return null},async getCORStats(r){if(H){const{data:l,error:c}=await w.from("change_orders").select("status, cor_total").eq("project_id",r);if(c)throw c;const i={total_cors:l.length,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0};return l.forEach(d=>{switch(d.status){case"draft":i.draft_count++;break;case"pending_approval":i.pending_count++,i.total_pending_value+=d.cor_total||0;break;case"approved":i.approved_count++,i.total_approved_value+=d.cor_total||0;break;case"rejected":i.rejected_count++;break;case"billed":case"closed":i.billed_count++,i.total_billed_value+=d.cor_total||0;break}}),i}return{total_cors:0,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0}},subscribeToCORs(r,l){return H?w.channel(`change_orders:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCorTickets(r,l){return H?w.channel(`cor-tickets:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"change_order_ticket_associations",filter:`change_order_id=eq.${r}`},l).subscribe():null},async createSignatureRequest(r,l,c,i,d=null,h=null){if(H){const{data:g,error:p}=await w.rpc("generate_signature_token");if(p)throw p;const{data:y,error:m}=await w.from("signature_requests").insert({document_type:r,document_id:l,company_id:c,project_id:i,signature_token:g,expires_at:h,created_by:d}).select().single();if(m)throw m;return y}return null},async getSignatureRequestByToken(r){if(H){await w.rpc("increment_signature_view_count",{token:r});const{data:l,error:c}=await w.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("signature_token",r).single();if(c)throw c;return l}return null},async getSignatureRequestsForDocument(r,l){if(H){const{data:c,error:i}=await w.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("document_type",r).eq("document_id",l).order("created_at",{ascending:!1});if(i)throw i;return c||[]}return[]},async addSignature(r,l,c){if(H){const{data:i,error:d}=await w.from("signatures").insert({signature_request_id:r,signature_slot:l,signature_image:c.signature,signer_name:c.signerName,signer_title:c.signerTitle||null,signer_company:c.signerCompany||null,signed_at:c.signedAt||new Date().toISOString(),ip_address:c.ipAddress||null,user_agent:c.userAgent||null}).select().single();if(d)throw d;return i}return null},async syncSignatureToDocument(r,l){if(!H)return null;const{document_type:c,document_id:i}=l,d=r.signature_slot,h={};d===1?(h.gc_signature_data=r.signature_image,h.gc_signature_name=r.signer_name,h.gc_signature_title=r.signer_title,h.gc_signature_company=r.signer_company,h.gc_signature_date=r.signed_at,h.gc_signature_ip=r.ip_address):d===2&&(h.client_signature_data=r.signature_image,h.client_signature_name=r.signer_name,h.client_signature_title=r.signer_title,h.client_signature_company=r.signer_company,h.client_signature_date=r.signed_at,h.client_signature_ip=r.ip_address);const g=c==="cor"?"change_orders":"t_and_m_tickets",{data:p,error:y}=await w.from(g).update(h).eq("id",i).select().single();if(y)throw y;return p},async revokeSignatureRequest(r){if(H){const{data:l,error:c}=await w.from("signature_requests").update({status:"revoked"}).eq("id",r).select().single();if(c)throw c;return l}return null},async getDocumentForSigning(r,l){if(!H)return null;if(r==="cor"){const{data:c,error:i}=await w.from("change_orders").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*)
        `).eq("id",l).single();if(i)throw i;return c}else if(r==="tm_ticket"){const{data:c,error:i}=await w.from("t_and_m_tickets").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          t_and_m_workers (*),
          t_and_m_items (*)
        `).eq("id",l).single();if(i)throw i;return c}return null},async getProjectCosts(r){if(H){const{data:c,error:i}=await w.from("project_costs").select("*").eq("project_id",r).order("cost_date",{ascending:!1});return i?(console.error("Error fetching project costs:",i),[]):c||[]}return(Ze().projectCosts||[]).filter(c=>c.project_id===r).sort((c,i)=>new Date(i.cost_date)-new Date(c.cost_date))},async addProjectCost(r,l,c){const i={project_id:r,company_id:l,category:c.category,description:c.description,amount:parseFloat(c.amount),cost_date:c.cost_date||new Date().toISOString().split("T")[0],notes:c.notes||null,created_by:c.created_by||null};if(H){const{data:g,error:p}=await w.from("project_costs").insert(i).select().single();if(p)throw console.error("Error adding project cost:",p),p;return g}const d=Ze();d.projectCosts||(d.projectCosts=[]);const h={...i,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return d.projectCosts.push(h),wt(d),h},async updateProjectCost(r,l){const c={category:l.category,description:l.description,amount:parseFloat(l.amount),cost_date:l.cost_date,notes:l.notes||null,updated_at:new Date().toISOString()};if(H){const{data:h,error:g}=await w.from("project_costs").update(c).eq("id",r).select().single();if(g)throw console.error("Error updating project cost:",g),g;return h}const i=Ze();if(!i.projectCosts)return null;const d=i.projectCosts.findIndex(h=>h.id===r);return d===-1?null:(i.projectCosts[d]={...i.projectCosts[d],...c},wt(i),i.projectCosts[d])},async deleteProjectCost(r){if(H){const{error:c}=await w.from("project_costs").delete().eq("id",r);if(c)throw console.error("Error deleting project cost:",c),c;return!0}const l=Ze();return l.projectCosts&&(l.projectCosts=l.projectCosts.filter(c=>c.id!==r),wt(l)),!0},async getProjectCostsSummary(r){const l=await this.getProjectCosts(r),c={};let i=0;return l.forEach(d=>{const h=parseFloat(d.amount)||0;i+=h,c[d.category]||(c[d.category]={category:d.category,total:0,count:0,items:[]}),c[d.category].total+=h,c[d.category].count++,c[d.category].items.push(d)}),Object.values(c).forEach(d=>{d.percentage=i>0?d.total/i*100:0}),{totalCost:i,byCategory:c,itemCount:l.length}}};Ld(async r=>{if(r&&H){console.log("Back online - syncing pending actions...");try{const l=await hf(K);l.synced>0&&console.log(`Synced ${l.synced} pending actions`),l.failed>0&&console.warn(`Failed to sync ${l.failed} actions`)}catch(l){console.error("Error syncing pending actions:",l)}}});const Lp=Object.freeze(Object.defineProperty({__proto__:null,auth:Md,db:K,getConnectionStatus:kr,getPendingActionCount:Yi,isSupabaseConfigured:H,onConnectionChange:Ld,supabase:w,syncPendingActions:hf},Symbol.toStringTag,{value:"Module"})),gf=x.createContext(),Wa={logo_url:null,favicon_url:null,login_background_url:null,primary_color:"#3B82F6",secondary_color:"#1E40AF",custom_app_name:"FieldSync",hide_fieldsync_branding:!1,email_from_name:"FieldSync",email_from_address:null,custom_domain:null,domain_verified:!1};function qn({children:r,companyId:l}){const[c,i]=x.useState(Wa),[d,h]=x.useState(!0);x.useEffect(()=>{l?g(l):p()},[l]),x.useEffect(()=>{v(c)},[c]);const g=async j=>{try{if(h(!0),!H){i(Wa),h(!1);return}const{data:$,error:C}=await w.from("company_branding").select("*").eq("company_id",j).single();C?(C.code==="PGRST116"?await y(j):console.error("Error loading branding:",C),i(Wa)):i({...Wa,...$})}catch($){console.error("Error in loadBranding:",$),i(Wa)}finally{h(!1)}},p=async()=>{try{h(!0);const j=window.location.hostname;if(j==="localhost"||j==="127.0.0.1"){i(Wa),h(!1);return}if(!H){i(Wa),h(!1);return}const{data:$,error:C}=await w.rpc("get_branding_by_domain",{domain_name:j});C||!$||$.length===0?i(Wa):i({...Wa,...$[0]})}catch(j){console.error("Error loading branding by domain:",j),i(Wa)}finally{h(!1)}},y=async j=>{try{const{data:$,error:C}=await w.from("company_branding").insert({company_id:j,...Wa}).select().single();C&&console.error("Error creating default branding:",C)}catch($){console.error("Error in createDefaultBranding:",$)}},m=async j=>{try{if(!H)return i(E=>({...E,...j})),{success:!0};if(!l)return{success:!1,error:"No company ID"};const $={},C=["logo_url","favicon_url","login_background_url","primary_color","secondary_color","custom_app_name","hide_fieldsync_branding","email_from_name","email_from_address","custom_domain","domain_verified"];for(const E of C)j[E]!==void 0&&($[E]=j[E]);const{data:U,error:X}=await w.from("company_branding").select("id").eq("company_id",l).single();if(X&&X.code==="PGRST116"){const{data:E,error:W}=await w.from("company_branding").insert({company_id:l,...$}).select().single();return W?(console.error("Error creating branding:",W),{success:!1,error:W.message}):(i({...Wa,...E}),{success:!0,data:E})}const{data:V,error:q}=await w.from("company_branding").update($).eq("company_id",l).select().single();return q?(console.error("Error updating branding:",q),{success:!1,error:q.message}):(i({...Wa,...V}),{success:!0,data:V})}catch($){return console.error("Error in updateBranding:",$),{success:!1,error:$.message}}},v=j=>{const $=document.documentElement;if($.style.setProperty("--primary-color",j.primary_color),$.style.setProperty("--secondary-color",j.secondary_color),j.favicon_url){let C=document.querySelector("link[rel*='icon']");C||(C=document.createElement("link"),C.rel="icon",document.head.appendChild(C)),C.href=j.favicon_url}document.title=j.custom_app_name||"FieldSync"},_={branding:c,loading:d,updateBranding:m,uploadBrandingImage:async(j,$)=>{try{if(!H)return{success:!0,url:URL.createObjectURL(j)};const C=j.name.split(".").pop(),X=`branding/${`${l}/${$}-${Date.now()}.${C}`}`,{data:V,error:q}=await w.storage.from("public").upload(X,j,{cacheControl:"3600",upsert:!0});if(q)return console.error("Error uploading image:",q),{success:!1,error:q.message};const{data:{publicUrl:E}}=w.storage.from("public").getPublicUrl(X);return{success:!0,url:E}}catch(C){return console.error("Error in uploadBrandingImage:",C),{success:!1,error:C.message}}},refreshBranding:()=>l?g(l):p()};return e.jsx(gf.Provider,{value:_,children:r})}function Dr(){const r=x.useContext(gf);if(!r)throw new Error("useBranding must be used within a BrandingProvider");return r}const xf=x.createContext();function Fn({children:r}){const[l,c]=x.useState(()=>{const d=localStorage.getItem("fieldsync-theme");return d==="light"||d==="dark"?d:window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"});x.useEffect(()=>{document.documentElement.setAttribute("data-theme",l),localStorage.setItem("fieldsync-theme",l)},[l]),x.useEffect(()=>{const d=window.matchMedia("(prefers-color-scheme: light)"),h=g=>{localStorage.getItem("fieldsync-theme")||c(g.matches?"light":"dark")};return d.addEventListener("change",h),()=>d.removeEventListener("change",h)},[]);const i=()=>{c(d=>d==="dark"?"light":"dark")};return e.jsx(xf.Provider,{value:{theme:l,setTheme:c,toggleTheme:i},children:r})}function dj(){const r=x.useContext(xf);if(!r)throw new Error("useTheme must be used within a ThemeProvider");return r}const uj=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),mj=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(l,c,i)=>i?i.toUpperCase():c.toLowerCase()),Up=r=>{const l=mj(r);return l.charAt(0).toUpperCase()+l.slice(1)},jf=(...r)=>r.filter((l,c,i)=>!!l&&l.trim()!==""&&i.indexOf(l)===c).join(" ").trim(),hj=r=>{for(const l in r)if(l.startsWith("aria-")||l==="role"||l==="title")return!0};var pj={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const fj=x.forwardRef(({color:r="currentColor",size:l=24,strokeWidth:c=2,absoluteStrokeWidth:i,className:d="",children:h,iconNode:g,...p},y)=>x.createElement("svg",{ref:y,...pj,width:l,height:l,stroke:r,strokeWidth:i?Number(c)*24/Number(l):c,className:jf("lucide",d),...!h&&!hj(p)&&{"aria-hidden":"true"},...p},[...g.map(([m,v])=>x.createElement(m,v)),...Array.isArray(h)?h:[h]]));const Be=(r,l)=>{const c=x.forwardRef(({className:i,...d},h)=>x.createElement(fj,{ref:h,iconNode:l,className:jf(`lucide-${uj(Up(r))}`,`lucide-${r}`,i),...d}));return c.displayName=Up(r),c};const gj=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],xj=Be("bell",gj);const jj=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],Cl=Be("briefcase",jj);const vj=[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]],Qi=Be("building-2",vj);const yj=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],bj=Be("building",yj);const _j=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Gn=Be("calendar",_j);const Nj=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Pn=Be("camera",Nj);const Sj=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Aa=Be("check",Sj);const Cj=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Ma=Be("chevron-down",Cj);const wj=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Bs=Be("chevron-right",wj);const kj=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],vf=Be("chevron-up",kj);const Ej=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],vn=Be("circle-alert",Ej);const Dj=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ta=Be("circle-check-big",Dj);const Tj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],pd=Be("circle-check",Tj);const Mj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Hp=Be("circle-x",Mj);const zj=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],cs=Be("clipboard-list",zj);const Aj=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],jn=Be("clock",Aj);const Oj=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],zd=Be("copy",Oj);const Rj=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],Er=Be("dollar-sign",Rj);const qj=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Ii=Be("download",qj);const Fj=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],yf=Be("ellipsis",Fj);const Lj=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Bp=Be("external-link",Lj);const Uj=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Hj=Be("eye",Uj);const Bj=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Oa=Be("file-text",Bj);const $j=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],Pj=Be("flame",$j);const Vj=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],Gj=Be("folder-plus",Vj);const Yj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Ij=Be("globe",Yj);const Qj=[["path",{d:"M10 10V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v5",key:"1p9q5i"}],["path",{d:"M14 6a6 6 0 0 1 6 6v3",key:"1hnv84"}],["path",{d:"M4 15v-3a6 6 0 0 1 6-6",key:"9ciidu"}],["rect",{x:"2",y:"15",width:"20",height:"4",rx:"1",key:"g3x8cw"}]],Da=Be("hard-hat",Qj);const Xj=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Zj=Be("image",Xj);const Jj=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Ad=Be("info",Jj);const Wj=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],$p=Be("layout-grid",Wj);const Kj=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],ev=Be("link-2",Kj);const tv=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Ud=Be("link",tv);const av=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Ui=Be("loader-circle",av);const sv=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Pp=Be("lock",sv);const nv=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],rv=Be("map-pin",nv);const lv=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],bf=Be("message-square",lv);const iv=[["path",{d:"M5 12h14",key:"1ays0h"}]],Od=Be("minus",iv);const cv=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],ov=Be("moon",cv);const dv=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Hs=Be("package",dv);const uv=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],bl=Be("pen-line",uv);const mv=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],fd=Be("pen-tool",mv);const hv=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Hd=Be("pen",hv);const pv=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],Bd=Be("pencil",pv);const fv=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],gv=Be("percent",fv);const xv=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],jv=Be("phone",xv);const vv=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ys=Be("plus",vv);const yv=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],_f=Be("refresh-cw",yv);const bv=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],_l=Be("rotate-ccw",bv);const _v=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Nv=Be("save",_v);const Sv=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Xi=Be("search",Sv);const Cv=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],$d=Be("send",Cv);const wv=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Zi=Be("shield",wv);const kv=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Rd=Be("square-check-big",kv);const Ev=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],Dv=Be("square",Ev);const Tv=[["path",{d:"M14 13V8.5C14 7 15 7 15 5a3 3 0 0 0-6 0c0 2 1 2 1 3.5V13",key:"i9gjdv"}],["path",{d:"M20 15.5a2.5 2.5 0 0 0-2.5-2.5h-11A2.5 2.5 0 0 0 4 15.5V17a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1z",key:"1vzg3v"}],["path",{d:"M5 22h14",key:"ehvnwv"}]],Mv=Be("stamp",Tv);const zv=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],Av=Be("sun",zv);const Ov=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],Us=Be("trash-2",Ov);const Rv=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],Nf=Be("trending-down",Rv);const qv=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Sf=Be("trending-up",qv);const Fv=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Tr=Be("triangle-alert",Fv);const Lv=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],ds=Be("truck",Lv);const Uv=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Hv=Be("upload",Uv);const Bv=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Cf=Be("user-check",Bv);const $v=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],wf=Be("user-minus",$v);const Pv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Vv=Be("user-plus",Pv);const Gv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Yv=Be("user-x",Gv);const Iv=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Pd=Be("user",Iv);const Qv=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],$s=Be("users",Qv);const Xv=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],wl=Be("wrench",Xv);const Zv=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ra=Be("x",Zv);const Jv=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],qd=Be("zap",Jv);function ps({className:r="",showPoweredBy:l=!1}){const{branding:c}=Dr();return e.jsxs("div",{className:`app-logo ${r}`,children:[c.logo_url?e.jsx("img",{src:c.logo_url,alt:c.custom_app_name||"Logo",className:"custom-logo"}):e.jsxs("div",{className:"logo",children:[c.custom_app_name||"Field",e.jsx("span",{children:"Sync"})]}),l&&!c.hide_fieldsync_branding&&e.jsx("div",{className:"powered-by",children:"Powered by FieldSync"})]})}function Wv({onForemanAccess:r,onOfficeLogin:l,onShowToast:c}){const[i,d]=x.useState(null),[h,g]=x.useState(""),[p,y]=x.useState(null),[m,v]=x.useState(""),[A,_]=x.useState(!1),[j,$]=x.useState(""),[C,U]=x.useState(""),[X,V]=x.useState(1),[q,E]=x.useState(null),[W,ue]=x.useState(""),[ae,Y]=x.useState(""),[P,ce]=x.useState(""),[M,b]=x.useState(""),R=Z=>{const ne=Z.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,20);g(ne)},B=async()=>{if(h.length<2){c("Enter company code","error");return}_(!0);try{const Z=await K.getCompanyByCode(h);Z?y(Z):(c("Invalid company code","error"),g(""))}catch{c("Error checking code","error")}finally{_(!1)}},me=async Z=>{if(Z.length===4){_(!0);try{const ne=await K.getProjectByPinAndCompany(Z,p.id);ne?r(ne):(c("Invalid PIN","error"),v(""))}catch{c("Error checking PIN","error")}finally{_(!1)}}},T=Z=>{if(m.length<4){const ne=m+Z;v(ne),ne.length===4&&setTimeout(()=>me(ne),200)}},ee=()=>{v(Z=>Z.slice(0,-1))},k=()=>{y(null),v("")},pe=()=>{if(!j.trim()||!C.trim()){c("Enter email and password","error");return}l(j,C)},D=async()=>{if(h.length<2){c("Enter company code","error");return}_(!0);try{const Z=await K.getCompanyByCode(h);Z?(E(Z),V(2)):(c("Invalid company code","error"),g(""))}catch{c("Error checking code","error")}finally{_(!1)}},z=async()=>{if(!W.trim()){c("Enter office code","error");return}_(!0);try{const{data:Z,error:ne}=await w.rpc("verify_office_code",{company_id:q.id,code:W.trim()});if(ne)throw ne;Z===!0?V(3):(c("Invalid office code","error"),ue(""))}catch{c("Error verifying code","error")}finally{_(!1)}},se=async()=>{if(!ae.trim()){c("Enter your name","error");return}if(!P.trim()||!P.includes("@")){c("Enter valid email","error");return}if(M.length<6){c("Password must be 6+ characters","error");return}_(!0);try{const Z=P.toLowerCase().trim(),{data:ne,error:F}=await w.auth.signUp({email:Z,password:M});let fe;if(F?.message?.includes("already registered")||ne?.user&&ne.user.identities?.length===0){const{data:ye,error:Fe}=await w.auth.signInWithPassword({email:Z,password:M});if(Fe){c("Account exists with different password. Use your existing password.","error"),_(!1);return}fe=ye.user.id;const{data:ze}=await w.from("user_companies").select("id, status").eq("user_id",fe).eq("company_id",q.id).maybeSingle();if(ze){ze.status==="active"?(c("You already belong to this company. Logging you in...","success"),setTimeout(()=>window.location.reload(),1e3)):ze.status==="pending"?(c("Your request is still pending approval.","error"),await w.auth.signOut()):(c("Your membership was removed. Contact the company admin.","error"),await w.auth.signOut());return}const{error:Me}=await w.from("user_companies").insert({user_id:fe,company_id:q.id,role:"member",status:"pending"});if(Me)throw console.error("Error adding to user_companies:",Me),await w.auth.signOut(),new Error("Failed to submit join request");await w.auth.signOut(),c("Request to join submitted! Awaiting admin approval.","success")}else{if(F)throw F;{if(fe=ne.user?.id,!fe)throw new Error("Failed to create user");const{error:ye}=await w.from("users").insert({id:fe,email:Z,password_hash:"managed_by_supabase_auth",name:ae.trim(),company_id:q.id,role:"member",is_active:!0});if(ye)throw ye;const{error:Fe}=await w.from("user_companies").insert({user_id:fe,company_id:q.id,role:"member",status:"pending"});if(Fe)throw console.error("Error adding to user_companies:",Fe),new Error("Failed to submit join request");await w.auth.signOut(),c("Account created! Awaiting admin approval.","success")}}}catch(Z){console.error("Join error:",Z),c(Z.message||"Error creating account","error")}finally{_(!1)}};if(i===null)return e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx(ps,{className:"entry-logo",showPoweredBy:!1}),e.jsxs("div",{className:"entry-buttons",children:[e.jsxs("button",{className:"entry-mode-btn foreman",onClick:()=>d("foreman"),children:[e.jsx("span",{className:"entry-mode-icon",children:e.jsx(Da,{size:32})}),e.jsx("span",{className:"entry-mode-title",children:"Foreman"}),e.jsx("span",{className:"entry-mode-desc",children:"Enter project PIN"})]}),e.jsxs("button",{className:"entry-mode-btn office",onClick:()=>d("office"),children:[e.jsx("span",{className:"entry-mode-icon",children:e.jsx(Cl,{size:32})}),e.jsx("span",{className:"entry-mode-title",children:"Office"}),e.jsx("span",{className:"entry-mode-desc",children:"Sign in to dashboard"})]})]})]})});if(i==="foreman")return p?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:k,children:""}),e.jsx(ps,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:p.name}),e.jsx("p",{className:"entry-subtitle",children:"Enter project PIN"}),e.jsx("div",{className:"pin-display",children:[0,1,2,3].map(Z=>e.jsx("div",{className:`pin-dot ${m.length>Z?"filled":""}`,children:m.length>Z?"":""},Z))}),e.jsxs("div",{className:"number-pad",children:[[1,2,3,4,5,6,7,8,9].map(Z=>e.jsx("button",{className:"num-btn",onClick:()=>T(Z.toString()),disabled:A,children:Z},Z)),e.jsx("button",{className:"num-btn empty",disabled:!0}),e.jsx("button",{className:"num-btn",onClick:()=>T("0"),disabled:A,children:"0"}),e.jsx("button",{className:"num-btn backspace",onClick:ee,disabled:A||m.length===0,children:""})]}),A&&e.jsx("div",{className:"entry-loading",children:e.jsx("div",{className:"spinner"})})]})}):e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>d(null),children:""}),e.jsx(ps,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Enter company code"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"text",value:h,onChange:Z=>R(Z.target.value),placeholder:"Company Code",disabled:A,autoFocus:!0,onKeyDown:Z=>{Z.key==="Enter"&&B()}}),e.jsx("button",{className:"entry-submit-btn",onClick:B,disabled:A||h.length<2,children:A?"...":""})]})]})});if(i==="office")return e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>d(null),children:""}),e.jsx(ps,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Sign in to your account"}),e.jsxs("div",{className:"entry-form",children:[e.jsx("input",{type:"email",value:j,onChange:Z=>$(Z.target.value),placeholder:"Email",autoFocus:!0,onKeyDown:Z=>{Z.key==="Enter"&&pe()}}),e.jsx("input",{type:"password",value:C,onChange:Z=>U(Z.target.value),placeholder:"Password",onKeyDown:Z=>{Z.key==="Enter"&&pe()}}),e.jsx("button",{className:"entry-login-btn",onClick:pe,children:"Sign In"})]}),e.jsxs("div",{className:"entry-signup-hint",children:[e.jsx("p",{children:"New employee?"}),e.jsx("button",{className:"entry-join-link",onClick:()=>d("join"),children:"Join your company"})]})]})});if(i==="join")return X===1?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>d("office"),children:""}),e.jsx(ps,{className:"entry-logo",showPoweredBy:!1}),e.jsx("p",{className:"entry-subtitle",children:"Enter your company code"}),e.jsx("p",{className:"entry-hint",children:"Ask your manager or admin for the code"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"text",value:h,onChange:Z=>R(Z.target.value),placeholder:"Company Code",disabled:A,autoFocus:!0,onKeyDown:Z=>{Z.key==="Enter"&&D()}}),e.jsx("button",{className:"entry-submit-btn",onClick:D,disabled:A||h.length<2,children:A?"...":""})]})]})}):X===2?e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>{V(1),E(null),ue("")},children:""}),e.jsx(ps,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:q?.name}),e.jsx("p",{className:"entry-subtitle",children:"Enter office code"}),e.jsx("p",{className:"entry-hint",children:"This code is only for office staff"}),e.jsxs("div",{className:"entry-input-group",children:[e.jsx("input",{type:"password",value:W,onChange:Z=>ue(Z.target.value),placeholder:"Office Code",disabled:A,autoFocus:!0,onKeyDown:Z=>{Z.key==="Enter"&&z()}}),e.jsx("button",{className:"entry-submit-btn",onClick:z,disabled:A||!W.trim(),children:A?"...":""})]})]})}):e.jsx("div",{className:"entry-container",children:e.jsxs("div",{className:"entry-card",children:[e.jsx("button",{className:"entry-back",onClick:()=>{V(2),ue("")},children:""}),e.jsx(ps,{className:"entry-logo",showPoweredBy:!1}),e.jsx("div",{className:"entry-company-badge",children:q?.name}),e.jsx("p",{className:"entry-subtitle",children:"Create your account"}),e.jsxs("div",{className:"entry-form",children:[e.jsx("input",{type:"text",value:ae,onChange:Z=>Y(Z.target.value),placeholder:"Your Name",autoFocus:!0}),e.jsx("input",{type:"email",value:P,onChange:Z=>ce(Z.target.value),placeholder:"Email"}),e.jsx("input",{type:"password",value:M,onChange:Z=>b(Z.target.value),placeholder:"Password (6+ characters)",onKeyDown:Z=>{Z.key==="Enter"&&se()}}),e.jsx("button",{className:"entry-login-btn",onClick:se,disabled:A,children:A?"Creating...":"Join Company"})]}),e.jsx("p",{className:"entry-join-note",children:"You'll join as a team member. Your admin can update your role."})]})})}function Yt(r){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r)}function Kv(r){if(!r||r.length===0)return 0;let l=0;return r.forEach(c=>{c.status==="done"&&(l+=c.weight)}),Math.round(l)}function Vp(r){if(!r||r.length===0)return{progress:0,earnedValue:0,totalValue:0,isValueBased:!1};if(r.some(i=>i.scheduled_value>0)){const i=r.reduce((g,p)=>g+(p.scheduled_value||0),0),d=r.filter(g=>g.status==="done").reduce((g,p)=>g+(p.scheduled_value||0),0);return{progress:i>0?Math.round(d/i*100):0,earnedValue:d,totalValue:i,isValueBased:!0}}const c=r.filter(i=>i.status==="done").reduce((i,d)=>i+(d.weight||0),0);return{progress:Math.round(c),earnedValue:0,totalValue:0,isValueBased:!1}}function kf(r){if(!r||r.length===0)return"not_started";const l=r.some(d=>d.status==="working"),c=r.some(d=>d.status==="done");return r.every(d=>d.status==="done")?"done":l||c?"working":"not_started"}function ey(r){const l=kf(r);return l==="done"?"Complete":l==="working"?"In Progress":"Not Started"}function ty(r,l=0){const c=new Date;c.setHours(0,0,0,0);const i={scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1};if(r.start_date&&r.end_date){const d=new Date(r.start_date),h=new Date(r.end_date);d.setHours(0,0,0,0),h.setHours(0,0,0,0);const g=Math.max(1,Math.ceil((h-d)/(1e3*60*60*24))),p=Math.max(0,Math.ceil((c-d)/(1e3*60*60*24))),y=Math.min(100,p/g*100),v=(r.progress||0)-y;i.scheduleVariance=Math.round(v),i.hasScheduleData=!0,v>5?(i.scheduleStatus="ahead",i.scheduleLabel=`Ahead of Schedule (+${i.scheduleVariance}%)`):v<-5?(i.scheduleStatus="behind",i.scheduleLabel=`Behind Schedule (${i.scheduleVariance}%)`):(i.scheduleStatus="on_track",i.scheduleLabel="On Track")}if(r.planned_man_days&&r.planned_man_days>0){const h=(r.progress||0)/100*r.planned_man_days;if(h>0&&l>0){const g=(l-h)/h*100;i.laborVariance=Math.round(g),i.hasLaborData=!0,g>10?(i.laborStatus="over",i.laborLabel=`Over Planned (+${i.laborVariance}% man-days)`):g<-10?(i.laborStatus="under",i.laborLabel=`Under Planned (${i.laborVariance}% man-days)`):(i.laborStatus="on_track",i.laborLabel="Labor On Track")}else l>0&&(i.hasLaborData=!0,i.laborLabel=`${l} man-days used`)}return i}function ay(r,l=30){if(r.status==="archived"||r.progress<100)return!1;const c=r.areas||[];if(c.length===0||!c.every(g=>g.status==="done"))return!1;const d=c.reduce((g,p)=>{const y=new Date(p.updated_at);return y>g?y:g},new Date(0));return d.getTime()===0?!1:Math.floor((Date.now()-d.getTime())/(1e3*60*60*24))>=l}async function Gp(r,l=1920,c=.8){return!r.type.startsWith("image/")||r.size<500*1024?r:new Promise(i=>{const d=document.createElement("canvas"),h=d.getContext("2d"),g=new Image;g.onload=()=>{let{width:p,height:y}=g;p>l&&(y=Math.round(y*l/p),p=l);const m=1920;y>m&&(p=Math.round(p*m/y),y=m),d.width=p,d.height=y,h.imageSmoothingEnabled=!0,h.imageSmoothingQuality="high",h.drawImage(g,0,0,p,y),d.toBlob(v=>{if(v){const A=r.name.replace(/\.[^/.]+$/,""),_=new File([v],`${A}.jpg`,{type:"image/jpeg",lastModified:Date.now()}),j=((1-v.size/r.size)*100).toFixed(1);console.log(`Image compressed: ${r.name} - ${(r.size/1024).toFixed(0)}KB  ${(v.size/1024).toFixed(0)}KB (${j}% smaller)`),i(_)}else console.warn("Image compression failed, using original"),i(r)},"image/jpeg",c),URL.revokeObjectURL(g.src)},g.onerror=()=>{console.warn("Failed to load image for compression, using original"),URL.revokeObjectURL(g.src),i(r)},g.src=URL.createObjectURL(r)})}const Yp=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never";function Vd({documentType:r,documentId:l,companyId:c,projectId:i,documentTitle:d="",onClose:h,onShowToast:g}){const[p,y]=x.useState(!0),[m,v]=x.useState(!1),[A,_]=x.useState([]),[j,$]=x.useState(null),[C,U]=x.useState(!1),[X,V]=x.useState("never");x.useEffect(()=>{q()},[r,l]);const q=async()=>{try{y(!0);const P=await K.getSignatureRequestsForDocument(r,l);_(P||[])}catch(P){console.error("Error loading signature requests:",P)}finally{y(!1)}},E=async()=>{try{v(!0);let P=null;if(X!=="never"){const M=parseInt(X);P=new Date,P.setDate(P.getDate()+M),P=P.toISOString()}const ce=await K.createSignatureRequest(r,l,c,i,null,P);if(ce){const M=`${window.location.origin}/sign/${ce.signature_token}`;$(M),await q(),g?.("Signature link created","success")}}catch(P){console.error("Error generating signature link:",P),g?.("Failed to create signature link","error")}finally{v(!1)}},W=async P=>{try{await navigator.clipboard.writeText(P),U(!0),g?.("Link copied to clipboard","success"),setTimeout(()=>U(!1),2e3)}catch(ce){console.error("Error copying to clipboard:",ce)}},ue=async P=>{if(confirm("Are you sure you want to revoke this signature link? It will no longer be usable."))try{await K.revokeSignatureRequest(P),await q(),g?.("Signature link revoked","success")}catch(ce){console.error("Error revoking signature request:",ce),g?.("Failed to revoke link","error")}},ae=P=>{switch(P){case"pending":return{label:"Awaiting Signatures",color:"#f59e0b",bg:"#fef3c7"};case"partially_signed":return{label:"1 of 2 Signed",color:"#3b82f6",bg:"#dbeafe"};case"completed":return{label:"Fully Signed",color:"#10b981",bg:"#d1fae5"};case"revoked":return{label:"Revoked",color:"#ef4444",bg:"#fee2e2"};case"expired":return{label:"Expired",color:"#6b7280",bg:"#f3f4f6"};default:return{label:P,color:"#6b7280",bg:"#f3f4f6"}}},Y=r==="cor"?"Change Order":"T&M Ticket";return e.jsx("div",{className:"modal-overlay",onClick:h,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content signature-link-modal",onClick:P=>P.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Get Signature Link"}),d&&e.jsx("span",{className:"modal-subtitle",children:d})]}),e.jsx("button",{className:"close-btn",onClick:h,"aria-label":"Close",children:e.jsx(Ra,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(Ud,{size:16}),"Create New Signature Link"]}),e.jsxs("p",{className:"section-description",children:["Generate a secure link that allows GC/Client to sign this ",Y," without logging in."]}),e.jsxs("div",{className:"link-options",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Link Expiration"}),e.jsxs("select",{value:X,onChange:P=>V(P.target.value),disabled:m,children:[e.jsx("option",{value:"never",children:"Never expires"}),e.jsx("option",{value:"7",children:"7 days"}),e.jsx("option",{value:"30",children:"30 days"}),e.jsx("option",{value:"90",children:"90 days"})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:E,disabled:m,children:m?"Generating...":"Generate Link"})]}),j&&e.jsxs("div",{className:"new-link-box",children:[e.jsxs("div",{className:"link-display",children:[e.jsx("input",{type:"text",value:j,readOnly:!0,className:"link-input"}),e.jsxs("button",{className:"btn btn-secondary copy-btn",onClick:()=>W(j),children:[C?e.jsx(Aa,{size:16}):e.jsx(zd,{size:16}),C?"Copied!":"Copy"]})]}),e.jsxs("a",{href:j,target:"_blank",rel:"noopener noreferrer",className:"preview-link",children:[e.jsx(Bp,{size:14}),"Preview link"]})]})]}),e.jsxs("div",{className:"signature-link-section",children:[e.jsxs("h3",{children:[e.jsx(jn,{size:16}),"Existing Signature Links"]}),p?e.jsx("div",{className:"loading-inline",children:"Loading..."}):A.length===0?e.jsxs("p",{className:"empty-state",children:["No signature links have been created for this ",Y,"."]}):e.jsx("div",{className:"existing-links-list",children:A.map(P=>{const ce=ae(P.status),M=`${window.location.origin}/sign/${P.signature_token}`,b=P.signatures?.length||0;return e.jsxs("div",{className:"existing-link-card",children:[e.jsxs("div",{className:"link-card-header",children:[e.jsx("span",{className:"status-badge",style:{color:ce.color,backgroundColor:ce.bg},children:ce.label}),e.jsxs("span",{className:"link-created",children:["Created ",Yp(P.created_at)]})]}),e.jsxs("div",{className:"link-card-body",children:[e.jsxs("div",{className:"link-info",children:[e.jsxs("span",{className:"link-token",children:["...",P.signature_token.slice(-8)]}),P.expires_at&&e.jsxs("span",{className:"link-expires",children:["Expires ",Yp(P.expires_at)]}),e.jsxs("span",{className:"link-views",children:[P.view_count," view",P.view_count!==1?"s":""]})]}),b>0&&e.jsx("div",{className:"signatures-summary",children:P.signatures.map(R=>e.jsxs("div",{className:"sig-item",children:[e.jsx(Aa,{size:12}),e.jsxs("span",{children:["Slot ",R.signature_slot,": ",R.signer_name,R.signer_company&&` (${R.signer_company})`]})]},R.id))})]}),e.jsxs("div",{className:"link-card-actions",children:[P.status!=="revoked"&&P.status!=="expired"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>W(M),children:[e.jsx(zd,{size:14})," Copy"]}),e.jsxs("a",{href:M,target:"_blank",rel:"noopener noreferrer",className:"btn btn-ghost btn-small",children:[e.jsx(Bp,{size:14})," Open"]})]}),P.status!=="completed"&&P.status!=="revoked"&&e.jsxs("button",{className:"btn btn-ghost btn-small btn-danger",onClick:()=>ue(P.id),children:[e.jsx(Us,{size:14})," Revoke"]})]})]},P.id)})})]}),e.jsxs("div",{className:"signature-info-box",children:[e.jsx(vn,{size:16}),e.jsxs("div",{children:[e.jsx("strong",{children:"How it works:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Share the link with your GC or Client"}),e.jsx("li",{children:"They can view the document and sign without logging in"}),e.jsx("li",{children:"Supports 2 signatures (GC + Client)"}),e.jsx("li",{children:"Signatures are recorded with name, title, company, date, and IP"})]})]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-secondary",onClick:h,children:"Close"})})]})})}function sy({ticketId:r,ticketSummary:l,lang:c="en",onSave:i,onClose:d,onShowToast:h}){const g=x.useRef(null),[p,y]=x.useState(""),[m,v]=x.useState(""),[A,_]=x.useState(""),[j,$]=x.useState(!1),[C,U]=x.useState(!1),[X,V]=x.useState(!1),q={en:{title:"Client Signature",subtitle:"Sign to verify the work performed",signerName:"Your Name",signerNamePlaceholder:"Full name",signerTitle:"Title",signerTitlePlaceholder:"e.g. Project Manager",signerCompany:"Company",signerCompanyPlaceholder:"Company name",signBelow:"Sign below",signHere:"Sign here",clear:"Clear",cancel:"Cancel",saveSignature:"Submit Signature",saving:"Saving...",workDate:"Work Date",workers:"Workers",hours:"Total Hours",certification:"By signing, I acknowledge that the work described in this T&M ticket was performed as documented.",nameRequired:"Please enter your name",signatureRequired:"Please sign above",signatureSaved:"Signature saved successfully",signatureError:"Error saving signature"},es:{title:"Firma del Cliente",subtitle:"Firme para verificar el trabajo realizado",signerName:"Su Nombre",signerNamePlaceholder:"Nombre completo",signerTitle:"Titulo",signerTitlePlaceholder:"ej. Gerente de Proyecto",signerCompany:"Empresa",signerCompanyPlaceholder:"Nombre de la empresa",signBelow:"Firme abajo",signHere:"Firme aqui",clear:"Borrar",cancel:"Cancelar",saveSignature:"Enviar Firma",saving:"Guardando...",workDate:"Fecha",workers:"Trabajadores",hours:"Horas Total",certification:"Al firmar, reconozco que el trabajo descrito en este ticket T&M fue realizado como se documenta.",nameRequired:"Por favor ingrese su nombre",signatureRequired:"Por favor firme arriba",signatureSaved:"Firma guardada exitosamente",signatureError:"Error al guardar la firma"}},E=q[c]||q.en,W=()=>{const R=g.current;return R?R.getContext("2d"):null},ue=R=>{const B=g.current;if(!B)return{x:0,y:0};const me=B.getBoundingClientRect(),T=B.width/me.width,ee=B.height/me.height,k=R.touches?R.touches[0].clientX:R.clientX,pe=R.touches?R.touches[0].clientY:R.clientY;return{x:(k-me.left)*T,y:(pe-me.top)*ee}},ae=R=>{R.preventDefault();const B=W();if(!B)return;const{x:me,y:T}=ue(R);B.beginPath(),B.moveTo(me,T),U(!0),$(!0)},Y=R=>{if(!C)return;R.preventDefault();const B=W();if(!B)return;const{x:me,y:T}=ue(R);B.lineTo(me,T),B.stroke()},P=()=>{U(!1)},ce=()=>{const R=g.current,B=W();!R||!B||(B.clearRect(0,0,R.width,R.height),$(!1))},M=R=>{if(!R)return;g.current=R;const B=R.getContext("2d");B.strokeStyle="#1e293b",B.lineWidth=2,B.lineCap="round",B.lineJoin="round"},b=async()=>{if(!p.trim()){h?.(E.nameRequired,"error");return}if(!j){h?.(E.signatureRequired,"error");return}const R=g.current;if(R){V(!0);try{const B=R.toDataURL("image/png");await K.saveTMClientSignature(r,{signature:B,signerName:p.trim(),signerTitle:m.trim()||null,signerCompany:A.trim()||null,signedAt:new Date().toISOString()}),h?.(E.signatureSaved,"success"),i?.({signerName:p.trim(),signerTitle:m.trim(),signerCompany:A.trim()})}catch(B){console.error("Error saving signature:",B),h?.(E.signatureError,"error")}finally{V(!1)}}};return e.jsx("div",{className:"tm-modal-overlay",onClick:d,children:e.jsxs("div",{className:"tm-client-signature-modal",onClick:R=>R.stopPropagation(),children:[e.jsxs("div",{className:"tm-sig-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:E.title}),e.jsx("p",{className:"tm-sig-subtitle",children:E.subtitle})]}),e.jsx("button",{className:"tm-sig-close",onClick:d,children:e.jsx(Ra,{size:20})})]}),e.jsxs("div",{className:"tm-sig-body",children:[l&&e.jsxs("div",{className:"tm-sig-summary",children:[e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:E.workDate}),e.jsx("span",{className:"tm-sig-summary-value",children:new Date(l.workDate).toLocaleDateString()})]}),e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:E.workers}),e.jsx("span",{className:"tm-sig-summary-value",children:l.workerCount})]}),e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:E.hours}),e.jsx("span",{className:"tm-sig-summary-value",children:l.totalHours})]})]}),e.jsxs("div",{className:"tm-sig-fields",children:[e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(Pd,{size:14}),E.signerName," *"]}),e.jsx("input",{type:"text",value:p,onChange:R=>y(R.target.value),placeholder:E.signerNamePlaceholder})]}),e.jsxs("div",{className:"tm-sig-field-row",children:[e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(Cl,{size:14}),E.signerTitle]}),e.jsx("input",{type:"text",value:m,onChange:R=>v(R.target.value),placeholder:E.signerTitlePlaceholder})]}),e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(bj,{size:14}),E.signerCompany]}),e.jsx("input",{type:"text",value:A,onChange:R=>_(R.target.value),placeholder:E.signerCompanyPlaceholder})]})]})]}),e.jsxs("div",{className:"tm-sig-area",children:[e.jsxs("div",{className:"tm-sig-label",children:[e.jsx(Hd,{size:14}),e.jsx("span",{children:E.signBelow})]}),e.jsxs("div",{className:"tm-sig-canvas-container",children:[e.jsx("canvas",{ref:M,width:500,height:180,className:"tm-sig-canvas",onMouseDown:ae,onMouseMove:Y,onMouseUp:P,onMouseLeave:P,onTouchStart:ae,onTouchMove:Y,onTouchEnd:P}),!j&&e.jsx("div",{className:"tm-sig-placeholder",children:E.signHere})]}),e.jsxs("button",{className:"tm-sig-clear",onClick:ce,disabled:!j,children:[e.jsx(_l,{size:14})," ",E.clear]})]}),e.jsx("p",{className:"tm-sig-certification",children:E.certification})]}),e.jsxs("div",{className:"tm-sig-footer",children:[e.jsx("button",{className:"tm-sig-btn secondary",onClick:d,disabled:X,children:E.cancel}),e.jsx("button",{className:"tm-sig-btn primary",onClick:b,disabled:!j||!p.trim()||X,children:X?E.saving:e.jsxs(e.Fragment,{children:[e.jsx(Aa,{size:16})," ",E.saveSignature]})})]})]})})}const gd=["Containment","PPE","Disposal","Equipment"],ny={en:{workInfo:"Work Info",crewHours:"Crew & Hours",materialsEquipment:"Materials",review:"Review",quickActions:"Quick Actions",sameAsYesterday:"Same as Yesterday",setCrewHours:"Set Crew Hours",loading:"Loading...",supervision:"Supervision",operators:"Operators",laborers:"Laborers",addSupervision:"+ Add Supervision",addOperator:"+ Add Operator",addLaborer:"+ Add Laborer",foreman:"Foreman",superintendent:"Superintendent",firstLastName:"First & Last Name",start:"Start",end:"End",regHrs:"Reg Hrs",otHrs:"OT Hrs",selectCategory:"Select a category:",addCustomItem:"+ Add Custom Item",customItem:"Custom Item",itemName:"Item Name",category:"Category",quantity:"Quantity",addItem:"Add Item",cancel:"Cancel",noItemsCategory:"No items in this category yet",workDate:"Work Date",ceNumber:"CE/PCO #",optional:"optional",linkedCOR:"Link to Change Order",selectCOR:"Select COR (optional)",noCORs:"No pending CORs",laborSummary:"Labor Summary",worker:"worker",workers_plural:"workers",totalHours:"Total Hours",regular:"Regular",overtime:"Overtime",materials:"Materials",item:"item",items_plural:"items",noMaterials:"No materials added",notes:"Notes",addNotes:"Add notes about the work performed...",photos:"Photos",addPhotos:"Add Photos",maxPhotos:"max",noPhotos:"No photos added",certification:"Certification",certifyStatement:"I certify that this T&M ticket accurately reflects the work performed.",foremanSignature:"Foreman's Name (Signature)",yourName:"Your name",describeWork:"Describe the work performed",descriptionRequired:"Description is required",whatWorkPerformed:"What work was performed today?",searchMaterials:"Search materials & equipment...",noSearchResults:"No items found",orBrowse:"Or browse by category:",back:"Back",next:"Next",nextCrew:"Next: Crew",nextMaterials:"Next: Materials",reviewItems:"Review",skipNoMaterials:"Skip (no materials)",submitTM:"Submit T&M",submitting:"Submitting...",applySameHours:"Apply Same Hours",batchDescription:"Set start/end time and hours for all workers with names entered.",timeStarted:"Time Started",timeEnded:"Time Ended",regularHours:"Regular Hours",overtimeHours:"Overtime Hours",willApplyTo:"Will apply to",applyToAll:"Apply to All",preset8hr:"8hr Day",preset10hr:"10hr Day",preset4hr:"4hr Day",loadedWorkers:"Loaded {count} workers from {date}",noPreviousCrew:"No previous crew found for this project",appliedHours:"Applied hours to {count} worker(s)",assignedToCOR:"Assigned to COR"},es:{workInfo:"Info del Trabajo",crewHours:"Cuadrilla y Horas",materialsEquipment:"Materiales",review:"Revisar",quickActions:"Acciones Rapidas",sameAsYesterday:"Igual que Ayer",setCrewHours:"Poner Horas",loading:"Cargando...",supervision:"Supervision",operators:"Operadores",laborers:"Trabajadores",addSupervision:"+ Agregar Supervision",addOperator:"+ Agregar Operador",addLaborer:"+ Agregar Trabajador",foreman:"Capataz",superintendent:"Superintendente",firstLastName:"Nombre y Apellido",start:"Inicio",end:"Fin",regHrs:"Hrs Reg",otHrs:"Hrs Extra",selectCategory:"Seleccione una categoria:",addCustomItem:"+ Agregar Articulo",customItem:"Articulo Personalizado",itemName:"Nombre del Articulo",category:"Categoria",quantity:"Cantidad",addItem:"Agregar",cancel:"Cancelar",noItemsCategory:"No hay articulos en esta categoria",workDate:"Fecha de Trabajo",ceNumber:"CE/PCO #",optional:"opcional",linkedCOR:"Vincular a Orden de Cambio",selectCOR:"Seleccionar COR (opcional)",noCORs:"No hay CORs pendientes",laborSummary:"Resumen de Mano de Obra",worker:"trabajador",workers_plural:"trabajadores",totalHours:"Horas Totales",regular:"Regular",overtime:"Extra",materials:"Materiales",item:"articulo",items_plural:"articulos",noMaterials:"No se agregaron materiales",notes:"Notas",addNotes:"Agregar notas sobre el trabajo realizado...",photos:"Fotos",addPhotos:"Agregar Fotos",maxPhotos:"max",noPhotos:"No se agregaron fotos",certification:"Certificacion",certifyStatement:"Certifico que este ticket T&M refleja con precision el trabajo realizado.",foremanSignature:"Nombre del Capataz (Firma)",yourName:"Su nombre",describeWork:"Describir el trabajo realizado",descriptionRequired:"Descripcion es requerida",whatWorkPerformed:"Que trabajo se realizo hoy?",searchMaterials:"Buscar materiales y equipo...",noSearchResults:"No se encontraron articulos",orBrowse:"O navegar por categoria:",back:"Atras",next:"Siguiente",nextCrew:"Siguiente: Cuadrilla",nextMaterials:"Siguiente: Materiales",reviewItems:"Revisar",skipNoMaterials:"Saltar (sin materiales)",submitTM:"Enviar T&M",submitting:"Enviando...",applySameHours:"Aplicar Mismas Horas",batchDescription:"Establezca hora de inicio/fin y horas para todos los trabajadores.",timeStarted:"Hora de Inicio",timeEnded:"Hora de Fin",regularHours:"Horas Regulares",overtimeHours:"Horas Extra",willApplyTo:"Se aplicara a",applyToAll:"Aplicar a Todos",preset8hr:"Dia 8hr",preset10hr:"Dia 10hr",preset4hr:"Dia 4hr",loadedWorkers:"Se cargaron {count} trabajadores del {date}",noPreviousCrew:"No se encontro equipo anterior para este proyecto",appliedHours:"Horas aplicadas a {count} trabajador(es)",assignedToCOR:"Asignado a COR"}};function ry({project:r,companyId:l,maxPhotos:c=10,onSubmit:i,onCancel:d,onShowToast:h}){const[g,p]=x.useState(1),[y,m]=x.useState(new Date().toISOString().split("T")[0]),[v,A]=x.useState(null),[_,j]=x.useState(!1),[$,C]=x.useState(!1),[U,X]=x.useState(!1),[V,q]=x.useState(""),[E,W]=x.useState(""),[ue,ae]=x.useState(""),[Y,P]=x.useState([]),[ce,M]=x.useState(!1),[b,R]=x.useState(!1),[B,me]=x.useState({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),[T,ee]=x.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}]),[k,pe]=x.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[D,z]=x.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[se,Z]=x.useState([]),[ne,F]=x.useState(""),[fe,de]=x.useState([]),[ye,Fe]=x.useState(!1),[ze,Me]=x.useState(""),[nt,qe]=x.useState([]),[J,Oe]=x.useState(!1),[Ie,ft]=x.useState(null),[ja,ke]=x.useState([]),[Le,$e]=x.useState(!1),[Je,et]=x.useState(""),[tt,Ae]=x.useState([]),[bt,kt]=x.useState([]),[Mt,Gt]=x.useState(!1),[Dt,aa]=x.useState({name:"",category:"",quantity:""}),[da,St]=x.useState(!1),[We,Ft]=x.useState("en"),De=S=>ny[We][S]||S,I=(S,re)=>{if(!S||!re)return null;const[Ne,le]=S.split(":").map(Number),[Ge,He]=re.split(":").map(Number);let gt=Ge*60+He-(Ne*60+le);gt<0&&(gt+=1440);const Qe=gt/60,ua=Math.min(Qe,8),Ka=Math.max(0,Qe-8);return{hours:ua.toFixed(1),overtimeHours:Ka>0?Ka.toFixed(1):""}},L=S=>{const re=S.name.trim()!=="",Ne=parseFloat(S.hours)>0||parseFloat(S.overtimeHours)>0;return re?Ne?"complete":"incomplete":"empty"},we=S=>{let re,Ne,le,Ge;switch(S){case"full":re="07:00",Ne="15:30",le="8",Ge="";break;case"10hr":re="06:00",Ne="16:30",le="8",Ge="2";break;case"half":re="07:00",Ne="11:00",le="4",Ge="";break;default:return}me({timeStarted:re,timeEnded:Ne,hours:le,overtimeHours:Ge})};x.useEffect(()=>{st(),it()},[r.id]);const it=async()=>{M(!0);try{const S=await K.getAssignableCORs(r.id);P(S||[])}catch(S){console.error("Error loading assignable CORs:",S)}finally{M(!1)}},Te=()=>{const{timeStarted:S,timeEnded:re,hours:Ne,overtimeHours:le}=B;ee(T.map(He=>He.name.trim()?{...He,timeStarted:S,timeEnded:re,hours:Ne,overtimeHours:le}:He)),pe(k.map(He=>He.name.trim()?{...He,timeStarted:S,timeEnded:re,hours:Ne,overtimeHours:le}:He)),z(D.map(He=>He.name.trim()?{...He,timeStarted:S,timeEnded:re,hours:Ne,overtimeHours:le}:He));const Ge=[...T.filter(He=>He.name.trim()),...k.filter(He=>He.name.trim()),...D.filter(He=>He.name.trim())].length;R(!1),me({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),h(`Applied hours to ${Ge} worker${Ge!==1?"s":""}`,"success")},be=S=>{let re,Ne,le,Ge;switch(S){case"8hr":re="07:00",Ne="15:30",le="8",Ge="";break;case"10hr":re="06:00",Ne="16:30",le="8",Ge="2";break;case"4hr":re="07:00",Ne="11:00",le="4",Ge="";break;default:return}ee(gt=>gt.map(Qe=>Qe.name.trim()?{...Qe,timeStarted:re,timeEnded:Ne,hours:le,overtimeHours:Ge}:Qe)),pe(gt=>gt.map(Qe=>Qe.name.trim()?{...Qe,timeStarted:re,timeEnded:Ne,hours:le,overtimeHours:Ge}:Qe)),z(gt=>gt.map(Qe=>Qe.name.trim()?{...Qe,timeStarted:re,timeEnded:Ne,hours:le,overtimeHours:Ge}:Qe));const He=[...T.filter(gt=>gt.name.trim()),...k.filter(gt=>gt.name.trim()),...D.filter(gt=>gt.name.trim())].length;He>0?h(De("appliedHours").replace("{count}",He),"success"):h(We==="en"?"Add workers first":"Agregue trabajadores primero","info")},st=async()=>{try{const S=await K.getCrewCheckin(r.id);S?.workers&&qe(S.workers)}catch(S){console.error("Error loading crew:",S)}};x.useEffect(()=>{Ie&&l&&dt(Ie)},[Ie,l]);const dt=async S=>{$e(!0);try{const re=await K.getMaterialsEquipmentByCategory(l,S);ke(re)}catch(re){console.error("Error loading items:",re),h("Error loading items","error")}finally{$e(!1)}},It=async()=>{if(!(bt.length>0))try{const S=[];for(const re of gd){const Ne=await K.getMaterialsEquipmentByCategory(l,re);S.push(...Ne.map(le=>({...le,category:re})))}kt(S)}catch(S){console.error("Error loading all materials:",S)}},sa=S=>{if(et(S),!S.trim()){Ae([]);return}const re=S.toLowerCase(),Ne=bt.filter(le=>le.name.toLowerCase().includes(re)||le.category.toLowerCase().includes(re));Ae(Ne.slice(0,10))},Ce=async()=>{St(!0);try{const S=await K.getPreviousTicketCrew(r.id,y);if(!S||S.totalWorkers===0){h("No previous crew found for this project","info");return}S.supervision&&ee(S.supervision),S.operators&&pe(S.operators),S.laborers&&z(S.laborers);const re=new Date(S.workDate).toLocaleDateString();h(`Loaded ${S.totalWorkers} workers from ${re}`,"success")}catch(S){console.error("Error loading previous crew:",S),h("Error loading previous crew","error")}finally{St(!1)}},xt=()=>{ee([...T,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},ut=(S,re,Ne)=>{ee(T.map((le,Ge)=>{if(Ge!==S)return le;const He={...le,[re]:Ne};if(re==="timeStarted"||re==="timeEnded"){const gt=re==="timeStarted"?Ne:le.timeStarted,Qe=re==="timeEnded"?Ne:le.timeEnded,ua=I(gt,Qe);ua&&(He.hours=ua.hours,He.overtimeHours=ua.overtimeHours)}return He}))},qa=S=>{T.length>1?ee(T.filter((re,Ne)=>Ne!==S)):ee([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},Ee=()=>{z([...D,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},O=(S,re,Ne)=>{z(D.map((le,Ge)=>{if(Ge!==S)return le;const He={...le,[re]:Ne};if(re==="timeStarted"||re==="timeEnded"){const gt=re==="timeStarted"?Ne:le.timeStarted,Qe=re==="timeEnded"?Ne:le.timeEnded,ua=I(gt,Qe);ua&&(He.hours=ua.hours,He.overtimeHours=ua.overtimeHours)}return He}))},je=S=>{D.length>1?z(D.filter((re,Ne)=>Ne!==S)):z([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},xe=()=>{pe([...k,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Re=(S,re,Ne)=>{pe(k.map((le,Ge)=>{if(Ge!==S)return le;const He={...le,[re]:Ne};if(re==="timeStarted"||re==="timeEnded"){const gt=re==="timeStarted"?Ne:le.timeStarted,Qe=re==="timeEnded"?Ne:le.timeEnded,ua=I(gt,Qe);ua&&(He.hours=ua.hours,He.overtimeHours=ua.overtimeHours)}return He}))},jt=S=>{k.length>1?pe(k.filter((re,Ne)=>Ne!==S)):pe([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},ct=S=>{const re=se.findIndex(Ne=>Ne.material_equipment_id===S.id);re>=0?Z(se.map((Ne,le)=>le===re?{...Ne,quantity:Ne.quantity+1}:Ne)):Z([...se,{material_equipment_id:S.id,name:S.name,unit:S.unit,category:S.category,quantity:1,isCustom:!1}]),h(`Added ${S.name}`,"success")},Tt=()=>{if(!Dt.name||!Dt.category||!Dt.quantity){h("Fill in all fields","error");return}Z([...se,{material_equipment_id:null,custom_name:Dt.name,custom_category:Dt.category,name:Dt.name,category:Dt.category,quantity:parseFloat(Dt.quantity),unit:"each",isCustom:!0}]),aa({name:"",category:"",quantity:""}),Gt(!1),ft(null),h("Custom item added","success")},ot=(S,re)=>{const Ne=parseFloat(re)||0;Ne<=0?ht(S):Z(se.map((le,Ge)=>Ge===S?{...le,quantity:Ne}:le))},ht=S=>{Z(se.filter((re,Ne)=>Ne!==S))},va=S=>{const re=Array.from(S.target.files);if(re.length===0)return;const Ne=c===-1?1/0:c-fe.length;if(Ne<=0){h(`Photo limit reached (${c} max)`,"error"),S.target.value="";return}const le=re.slice(0,Ne);le.length<re.length&&h(`Only ${le.length} photo(s) added (${c} max)`,"error"),le.forEach(Ge=>{if(!Ge.type.startsWith("image/")){h("Please select an image file","error");return}const He=URL.createObjectURL(Ge),gt=`photo-${Date.now()}-${Math.random().toString(36).substring(7)}`;de(Qe=>[...Qe,{id:Date.now()+Math.random(),tempId:gt,file:Ge,previewUrl:He,name:Ge.name,status:"pending",attempts:0,error:null,uploadedUrl:null}])}),S.target.value=""},Qt=(S,re)=>{de(Ne=>Ne.map(le=>le.id===S?{...le,...re}:le))},Sa=async(S,re)=>{const Ne=fe.find(le=>le.id===S);if(!(!Ne||Ne.status!=="failed")){Qt(S,{status:"compressing",error:null});try{let le=Ne.file;try{le=await Gp(Ne.file)}catch(He){console.warn("Compression failed, using original:",He)}Qt(S,{status:"uploading"});const Ge=await K.uploadPhoto(l,r.id,re,le);Qt(S,{status:"confirmed",uploadedUrl:Ge,attempts:Ne.attempts+1}),await K.updateTMTicketPhotos(re,[...fe.filter(He=>He.uploadedUrl).map(He=>He.uploadedUrl),Ge]),h("Photo uploaded successfully","success")}catch(le){console.error("Retry failed:",le),Qt(S,{status:"failed",error:le.message||"Upload failed",attempts:Ne.attempts+1}),h("Photo retry failed","error")}}},Pe=S=>{const re=fe.find(Ne=>Ne.id===S);re?.previewUrl&&URL.revokeObjectURL(re.previewUrl),de(fe.filter(Ne=>Ne.id!==S))},rt=()=>{if(g===1)return ne.trim().length>0;if(g===2){const S=T.some(le=>le.name.trim()&&(parseFloat(le.hours)>0||parseFloat(le.overtimeHours)>0)),re=k.some(le=>le.name.trim()&&(parseFloat(le.hours)>0||parseFloat(le.overtimeHours)>0)),Ne=D.some(le=>le.name.trim()&&(parseFloat(le.hours)>0||parseFloat(le.overtimeHours)>0));return S||re||Ne}return!0},Xt=()=>{g<4&&p(g+1)},ya=()=>{Ie?(ft(null),Gt(!1)):Mt?Gt(!1):g>1?p(g-1):d()},Pa=async()=>{if(!E.trim()){h("Enter your name to submit","error");return}const S=T.filter(le=>le.name.trim()&&(parseFloat(le.hours)>0||parseFloat(le.overtimeHours)>0)),re=k.filter(le=>le.name.trim()&&(parseFloat(le.hours)>0||parseFloat(le.overtimeHours)>0)),Ne=D.filter(le=>le.name.trim()&&(parseFloat(le.hours)>0||parseFloat(le.overtimeHours)>0));if(S.length===0&&re.length===0&&Ne.length===0){h("Add at least one worker","error");return}Fe(!0),Me("Creating ticket...");try{const le=await K.createTMTicket({project_id:r.id,work_date:y,ce_pco_number:V.trim()||null,assigned_cor_id:ue||null,notes:ne.trim()||null,photos:[],created_by_name:E.trim()});let Ge=[];const He=fe.filter(Qe=>Qe.status==="pending");if(He.length>0){Me(`Compressing ${He.length} photo${He.length>1?"s":""}...`),He.forEach(Kt=>Qt(Kt.id,{status:"compressing"}));const Qe=await Promise.all(He.map(async Kt=>{try{const ea=await Gp(Kt.file);return{...Kt,file:ea}}catch(ea){return console.warn(`Failed to compress photo ${Kt.name}, using original:`,ea),Kt}}));Me(`Uploading ${He.length} photo${He.length>1?"s":""}...`),He.forEach(Kt=>Qt(Kt.id,{status:"uploading"}));let ua=0,Ka=0;const kl=Qe.map(async Kt=>{try{const ea=await K.uploadPhoto(l,r.id,le.id,Kt.file);return ua++,Me(`Uploading ${ua}/${He.length} photos...`),console.log(`Photo ${Kt.name} uploaded successfully:`,ea),Qt(Kt.id,{status:"confirmed",uploadedUrl:ea,attempts:(Kt.attempts||0)+1}),{id:Kt.id,url:ea}}catch(ea){return console.error(`Photo ${Kt.name} upload failed:`,ea),Ka++,Qt(Kt.id,{status:"failed",error:ea.message||"Upload failed",attempts:(Kt.attempts||0)+1}),{id:Kt.id,url:null,error:ea.message}}});Ge=(await Promise.all(kl)).filter(Kt=>Kt.url!==null).map(Kt=>Kt.url),Ka>0&&Ge.length>0?h(`${Ge.length}/${He.length} photos uploaded. ${Ka} failed - can retry later.`,"warning"):Ka>0&&Ge.length===0&&h(`All ${Ka} photos failed to upload - can retry after submission.`,"error")}Ge.length>0&&(Me("Saving photos..."),await K.updateTMTicketPhotos(le.id,Ge));const gt=[...S.map(Qe=>({name:Qe.name.trim(),hours:parseFloat(Qe.hours)||0,overtime_hours:parseFloat(Qe.overtimeHours)||0,time_started:Qe.timeStarted||null,time_ended:Qe.timeEnded||null,role:Qe.role})),...re.map(Qe=>({name:Qe.name.trim(),hours:parseFloat(Qe.hours)||0,overtime_hours:parseFloat(Qe.overtimeHours)||0,time_started:Qe.timeStarted||null,time_ended:Qe.timeEnded||null,role:"Operator"})),...Ne.map(Qe=>({name:Qe.name.trim(),hours:parseFloat(Qe.hours)||0,overtime_hours:parseFloat(Qe.overtimeHours)||0,time_started:Qe.timeStarted||null,time_ended:Qe.timeEnded||null,role:"Laborer"}))];if(Me("Saving workers..."),await K.addTMWorkers(le.id,gt),se.length>0&&(Me("Saving materials..."),await K.addTMItems(le.id,se.map(Qe=>({material_equipment_id:Qe.material_equipment_id,custom_name:Qe.custom_name||null,custom_category:Qe.custom_category||null,quantity:Qe.quantity})))),ue){Me("Importing to COR...");try{await K.importTicketDataToCOR(le.id,ue,l,r.work_type||"demolition",r.job_type||"standard")}catch(Qe){console.error("Error importing to COR:",Qe);try{await K.markImportFailed(le.id,ue,Qe?.message||"Import failed")}catch(ua){console.error("Error marking import failed:",ua)}h("T&M saved. COR data sync failed - retry from ticket list.","warning")}}fe.forEach(Qe=>{Qe.previewUrl&&URL.revokeObjectURL(Qe.previewUrl)}),A(le),h("T&M submitted!","success"),p(5)}catch(le){console.error("Error submitting T&M:",le),h("Error submitting T&M","error")}finally{Fe(!1),Me("")}},ba=T.filter(S=>S.name.trim()&&(parseFloat(S.hours)>0||parseFloat(S.overtimeHours)>0)),Zt=k.filter(S=>S.name.trim()&&(parseFloat(S.hours)>0||parseFloat(S.overtimeHours)>0)),ga=D.filter(S=>S.name.trim()&&(parseFloat(S.hours)>0||parseFloat(S.overtimeHours)>0)),zt=ba.length+Zt.length+ga.length,Va=[...ba,...Zt,...ga].reduce((S,re)=>S+parseFloat(re.hours||0),0),Ve=[...ba,...Zt,...ga].reduce((S,re)=>S+parseFloat(re.overtimeHours||0),0);se.reduce((S,re)=>S+re.quantity,0);const at=[...T.filter(S=>S.name.trim()),...k.filter(S=>S.name.trim()),...D.filter(S=>S.name.trim())],At=zt,Pt=at.length-At;return g===3&&(Ie||Mt)?e.jsxs("div",{className:"tm-wizard",children:[e.jsxs("div",{className:"tm-wizard-header",children:[e.jsx("button",{className:"tm-back-btn",onClick:ya,children:""}),e.jsx("h2",{children:Mt?"Add Custom Item":Ie}),e.jsxs("div",{className:"tm-item-count",children:[se.length," items"]})]}),Mt?e.jsxs("div",{className:"tm-custom-form",children:[e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Item Name"}),e.jsx("input",{type:"text",placeholder:"What did you use?",value:Dt.name,onChange:S=>aa({...Dt,name:S.target.value}),autoFocus:!0})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Category"}),e.jsx("div",{className:"tm-category-select",children:gd.map(S=>e.jsx("button",{className:`tm-cat-chip ${Dt.category===S?"active":""}`,onClick:()=>aa({...Dt,category:S}),children:S},S))})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:"Quantity"}),e.jsx("input",{type:"number",placeholder:"How many?",value:Dt.quantity,onChange:S=>aa({...Dt,quantity:S.target.value})})]}),e.jsx("button",{className:"tm-big-btn primary",onClick:Tt,children:"Add Custom Item"})]}):e.jsx("div",{className:"tm-item-grid",children:Le?e.jsx("div",{className:"tm-loading",children:"Loading..."}):e.jsxs(e.Fragment,{children:[ja.map(S=>{const re=se.find(Ne=>Ne.material_equipment_id===S.id);return e.jsxs("button",{className:`tm-item-card ${re?"added":""}`,onClick:()=>ct(S),children:[e.jsx("span",{className:"tm-item-name",children:S.name}),e.jsx("span",{className:"tm-item-unit",children:S.unit}),re&&e.jsx("span",{className:"tm-item-badge",children:re.quantity})]},S.id)}),e.jsxs("button",{className:"tm-item-card custom",onClick:()=>Gt(!0),children:[e.jsx("span",{className:"tm-item-name",children:"+ Add Other"}),e.jsx("span",{className:"tm-item-unit",children:"Not on list"})]})]})}),!Mt&&se.length>0&&e.jsx("div",{className:"tm-wizard-footer",children:e.jsxs("button",{className:"tm-big-btn primary",onClick:()=>ft(null),children:["Done Adding (",se.length," items)"]})})]}):e.jsxs("div",{className:"tm-wizard",children:[e.jsxs("div",{className:"tm-wizard-header",children:[g<5?e.jsx("button",{className:"tm-back-btn",onClick:ya,children:""}):e.jsx("div",{className:"tm-success-check",children:e.jsx(pd,{size:24})}),e.jsxs("h2",{children:[g===1&&De("workInfo"),g===2&&De("crewHours"),g===3&&De("materialsEquipment"),g===4&&De("review"),g===5&&(We==="en"?"Submitted":"Enviado")]}),e.jsxs("div",{className:"tm-header-right",children:[g<5&&e.jsxs("button",{className:"tm-lang-toggle",onClick:()=>Ft(We==="en"?"es":"en"),title:We==="en"?"Cambiar a Espaol":"Switch to English",children:[e.jsx(Ij,{size:16}),We==="en"?"ES":"EN"]}),g<5&&e.jsxs("div",{className:"tm-step-dots",children:[e.jsx("span",{className:`tm-dot ${g>=1?"active":""}`}),e.jsx("span",{className:`tm-dot ${g>=2?"active":""}`}),e.jsx("span",{className:`tm-dot ${g>=3?"active":""}`}),e.jsx("span",{className:`tm-dot ${g>=4?"active":""}`})]})]})]}),g===1&&e.jsxs("div",{className:"tm-step-content",children:[e.jsxs("div",{className:"tm-project-info",children:[r.job_number&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Job #"}),e.jsx("span",{className:"tm-project-value",children:r.job_number})]}),e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Project"}),e.jsx("span",{className:"tm-project-value",children:r.name})]}),r.address&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"Address"}),e.jsx("span",{className:"tm-project-value",children:r.address})]}),r.general_contractor&&e.jsxs("div",{className:"tm-project-detail",children:[e.jsx("span",{className:"tm-project-label",children:"GC"}),e.jsx("span",{className:"tm-project-value",children:r.general_contractor})]})]}),e.jsxs("div",{className:"tm-field-row",children:[e.jsxs("div",{className:"tm-field tm-field-half",children:[e.jsx("label",{children:"Date"}),e.jsx("input",{type:"date",value:y,onChange:S=>m(S.target.value),className:"tm-date"})]}),e.jsxs("div",{className:"tm-field tm-field-half",children:[e.jsx("label",{children:"CE / PCO #"}),e.jsx("input",{type:"text",placeholder:"Change Event / PCO",value:V,onChange:S=>q(S.target.value),className:"tm-input"})]})]}),e.jsxs("div",{className:"tm-field tm-description-field",children:[e.jsxs("label",{children:[e.jsx(Oa,{size:16,className:"inline-icon"}),De("describeWork")," ",e.jsx("span",{className:"tm-required",children:"*"})]}),e.jsx("textarea",{placeholder:De("whatWorkPerformed"),value:ne,onChange:S=>F(S.target.value),rows:4,className:`tm-description ${ne.trim()?"":"tm-field-required"}`})]}),e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:[e.jsx(Pn,{size:16,className:"inline-icon"})," ",De("photos"),c!==-1&&e.jsxs("span",{className:"tm-photo-count",children:["(",fe.length,"/",c,")"]})]}),fe.length>0&&e.jsx("div",{className:"tm-photo-grid",children:fe.map(S=>e.jsxs("div",{className:`tm-photo-item ${S.status?`photo-${S.status}`:""}`,children:[e.jsx("img",{src:S.previewUrl,alt:S.name}),S.status==="compressing"&&e.jsxs("div",{className:"tm-photo-status compressing",children:[e.jsx(Ui,{size:20,className:"tm-spinner"}),e.jsx("span",{children:We==="en"?"Compressing":"Comprimiendo"})]}),S.status==="uploading"&&e.jsxs("div",{className:"tm-photo-status uploading",children:[e.jsx(Ui,{size:20,className:"tm-spinner"}),e.jsx("span",{children:We==="en"?"Uploading":"Subiendo"})]}),S.status==="confirmed"&&e.jsx("div",{className:"tm-photo-status confirmed",children:e.jsx(Aa,{size:20})}),S.status==="failed"&&e.jsxs("div",{className:"tm-photo-status failed",title:S.error||"Upload failed",children:[e.jsx(vn,{size:20}),e.jsx("span",{children:We==="en"?"Failed":"Error"})]}),(!S.status||S.status==="pending"||S.status==="failed")&&e.jsx("button",{className:"tm-photo-remove",onClick:()=>Pe(S.id),children:""})]},S.id))}),(c===-1||fe.length<c)&&e.jsxs("label",{className:"tm-photo-btn",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:va,style:{display:"none"}}),e.jsx(Pn,{size:16,className:"inline-icon"})," ",fe.length>0?We==="en"?"Add More Photos":"Ms Fotos":De("addPhotos")]})]}),e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:["Link to Change Order Request (",De("optional"),")"]}),e.jsxs("div",{className:"tm-cor-row",children:[e.jsxs("select",{value:ue,onChange:S=>ae(S.target.value),className:"tm-input tm-select",children:[e.jsx("option",{value:"",children:"-- No COR --"}),Y.map(S=>e.jsxs("option",{value:S.id,children:[S.cor_number,": ",S.title||"Untitled"," (",S.status,")"]},S.id))]}),e.jsx("button",{type:"button",className:"tm-refresh-btn",onClick:it,disabled:ce,title:"Refresh COR list",children:e.jsx(_f,{size:16,className:ce?"spinning":""})})]})]})]}),g===2&&e.jsxs("div",{className:"tm-step-content",children:[nt.length>0&&e.jsxs("div",{className:"tm-crew-picker",children:[e.jsxs("button",{className:"tm-crew-picker-btn",onClick:()=>Oe(!J),children:[e.jsx(Da,{size:16})," ",J?"Hide":"Select from"," Today's Crew (",nt.length,")"]}),J&&e.jsx("div",{className:"tm-crew-list",children:nt.map((S,re)=>{const Ne=T.some(le=>le.name.toLowerCase()===S.name.toLowerCase())||k.some(le=>le.name.toLowerCase()===S.name.toLowerCase())||D.some(le=>le.name.toLowerCase()===S.name.toLowerCase());return e.jsxs("button",{className:`tm-crew-item ${Ne?"added":""}`,onClick:()=>{if(!Ne){if(S.role==="Foreman"||S.role==="Supervisor"){const le=T.findIndex(Ge=>!Ge.name.trim());le>=0?ut(le,"name",S.name):ee([...T,{name:S.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:S.role==="Supervisor"?"Superintendent":"Foreman"}])}else if(S.role==="Operator"){const le=k.findIndex(Ge=>!Ge.name.trim());le>=0?Re(le,"name",S.name):pe([...k,{name:S.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}else{const le=D.findIndex(Ge=>!Ge.name.trim());le>=0?O(le,"name",S.name):z([...D,{name:S.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}h(`Added ${S.name}`,"success")}},disabled:Ne,children:[e.jsx("span",{className:"tm-crew-item-name",children:S.name}),e.jsx("span",{className:`tm-crew-item-role ${(S.role||"laborer").toLowerCase()}`,children:S.role||"Laborer"}),Ne&&e.jsx("span",{className:"tm-crew-item-check",children:""})]},re)})})]}),e.jsxs("div",{className:"tm-quick-actions-panel",children:[e.jsxs("div",{className:"tm-batch-hours-header",children:[e.jsx(qd,{size:18}),e.jsx("span",{children:De("quickActions")})]}),e.jsxs("div",{className:"tm-quick-actions-buttons",children:[e.jsxs("button",{type:"button",className:"tm-quick-action-btn primary",onClick:Ce,disabled:da,children:[e.jsx(zd,{size:16}),De(da?"loading":"sameAsYesterday")]}),e.jsxs("button",{type:"button",className:"tm-quick-action-btn",onClick:()=>R(!0),children:[e.jsx(jn,{size:16}),De("setCrewHours")]})]})]}),e.jsxs("div",{className:"tm-inline-presets",children:[e.jsx("span",{className:"tm-inline-presets-label",children:We==="en"?"Apply to all:":"Aplicar a todos:"}),e.jsxs("div",{className:"tm-inline-presets-buttons",children:[e.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>be("8hr"),children:De("preset8hr")}),e.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>be("10hr"),children:De("preset10hr")}),e.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>be("4hr"),children:De("preset4hr")})]})]}),e.jsxs("div",{className:`tm-running-total ${zt>0?"has-data":""}`,children:[e.jsxs("div",{className:"tm-running-total-workers",children:[e.jsx(Da,{size:18}),e.jsx("span",{className:"tm-running-total-count",children:at.length}),e.jsx("span",{className:"tm-running-total-label",children:at.length===1?De("worker"):De("workers_plural")}),Pt>0&&e.jsxs("span",{className:"tm-running-total-warning",children:["(",Pt," ",We==="en"?"need hours":"sin horas",")"]})]}),e.jsxs("div",{className:"tm-running-total-hours",children:[e.jsx(jn,{size:18}),e.jsx("span",{className:"tm-running-total-count",children:Va+Ve}),e.jsx("span",{className:"tm-running-total-label",children:We==="en"?"total hrs":"hrs total"}),Ve>0&&e.jsxs("span",{className:"tm-running-total-ot",children:["(",Ve," OT)"]})]})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:De("supervision")}),e.jsx("div",{className:"tm-workers-list",children:T.map((S,re)=>{const Ne=L(S);return e.jsxs("div",{className:`tm-worker-card-expanded ${Ne!=="empty"?`worker-${Ne}`:""}`,children:[e.jsxs("div",{className:"tm-worker-row-top",children:[Ne==="complete"&&e.jsx("span",{className:"tm-worker-check",children:e.jsx(Aa,{size:14})}),e.jsx("div",{className:"tm-role-select",children:e.jsxs("select",{value:S.role,onChange:le=>ut(re,"role",le.target.value),children:[e.jsx("option",{value:"Foreman",children:De("foreman")}),e.jsx("option",{value:"Superintendent",children:De("superintendent")})]})}),e.jsx("input",{type:"text",placeholder:De("firstLastName"),value:S.name,onChange:le=>ut(re,"name",le.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>qa(re),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("start")}),e.jsx("input",{type:"time",value:S.timeStarted,onChange:le=>ut(re,"timeStarted",le.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("end")}),e.jsx("input",{type:"time",value:S.timeEnded,onChange:le=>ut(re,"timeEnded",le.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:S.hours,onChange:le=>ut(re,"hours",le.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:S.overtimeHours,onChange:le=>ut(re,"overtimeHours",le.target.value)})]})]})]},re)})}),e.jsx("button",{className:"tm-add-btn",onClick:xt,children:De("addSupervision")})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:De("operators")}),e.jsx("div",{className:"tm-workers-list",children:k.map((S,re)=>{const Ne=L(S);return e.jsxs("div",{className:`tm-worker-card-expanded ${Ne!=="empty"?`worker-${Ne}`:""}`,children:[e.jsxs("div",{className:"tm-worker-row-top",children:[Ne==="complete"&&e.jsx("span",{className:"tm-worker-check",children:e.jsx(Aa,{size:14})}),e.jsx("input",{type:"text",placeholder:De("firstLastName"),value:S.name,onChange:le=>Re(re,"name",le.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>jt(re),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("start")}),e.jsx("input",{type:"time",value:S.timeStarted,onChange:le=>Re(re,"timeStarted",le.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("end")}),e.jsx("input",{type:"time",value:S.timeEnded,onChange:le=>Re(re,"timeEnded",le.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:S.hours,onChange:le=>Re(re,"hours",le.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:S.overtimeHours,onChange:le=>Re(re,"overtimeHours",le.target.value)})]})]})]},re)})}),e.jsx("button",{className:"tm-add-btn",onClick:xe,children:De("addOperator")})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:De("laborers")}),e.jsx("div",{className:"tm-workers-list",children:D.map((S,re)=>{const Ne=L(S);return e.jsxs("div",{className:`tm-worker-card-expanded ${Ne!=="empty"?`worker-${Ne}`:""}`,children:[e.jsxs("div",{className:"tm-worker-row-top",children:[Ne==="complete"&&e.jsx("span",{className:"tm-worker-check",children:e.jsx(Aa,{size:14})}),e.jsx("input",{type:"text",placeholder:De("firstLastName"),value:S.name,onChange:le=>O(re,"name",le.target.value),className:"tm-worker-input"}),e.jsx("button",{className:"tm-remove",onClick:()=>je(re),children:""})]}),e.jsxs("div",{className:"tm-worker-row-bottom",children:[e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("start")}),e.jsx("input",{type:"time",value:S.timeStarted,onChange:le=>O(re,"timeStarted",le.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("end")}),e.jsx("input",{type:"time",value:S.timeEnded,onChange:le=>O(re,"timeEnded",le.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("regHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:S.hours,onChange:le=>O(re,"hours",le.target.value)})]}),e.jsxs("div",{className:"tm-time-group",children:[e.jsx("label",{children:De("otHrs")}),e.jsx("input",{type:"number",placeholder:"0",value:S.overtimeHours,onChange:le=>O(re,"overtimeHours",le.target.value)})]})]})]},re)})}),e.jsx("button",{className:"tm-add-btn",onClick:Ee,children:De("addLaborer")})]})]}),g===3&&!Ie&&e.jsxs("div",{className:"tm-step-content",children:[e.jsxs("div",{className:"tm-field tm-search-field",children:[e.jsxs("div",{className:"tm-search-input-wrapper",children:[e.jsx(Xi,{size:18,className:"tm-search-icon"}),e.jsx("input",{type:"text",placeholder:De("searchMaterials"),value:Je,onChange:S=>sa(S.target.value),onFocus:()=>It(),className:"tm-search-input"}),Je&&e.jsx("button",{className:"tm-search-clear",onClick:()=>{et(""),Ae([])},children:""})]}),Je&&tt.length>0&&e.jsx("div",{className:"tm-search-results",children:tt.map((S,re)=>{const Ne=se.find(le=>le.id===S.id);return e.jsxs("button",{className:`tm-search-result-item ${Ne?"added":""}`,onClick:()=>{Ne?ot(se.indexOf(Ne),Ne.quantity+1):Z([...se,{...S,quantity:1,isCustom:!1}]),et(""),Ae([])},children:[e.jsx("span",{className:"tm-search-result-name",children:S.name}),e.jsx("span",{className:"tm-search-result-category",children:S.category}),Ne&&e.jsxs("span",{className:"tm-search-result-qty",children:["",Ne.quantity]})]},re)})}),Je&&tt.length===0&&e.jsx("div",{className:"tm-search-no-results",children:De("noSearchResults")})]}),e.jsxs("div",{className:"tm-field",children:[e.jsx("label",{children:De("orBrowse")}),e.jsx("div",{className:"tm-category-grid",children:gd.map(S=>{const re=se.filter(Ne=>Ne.category===S);return e.jsxs("button",{className:"tm-category-card",onClick:()=>ft(S),children:[e.jsx("span",{className:"tm-cat-name",children:S}),re.length>0&&e.jsx("span",{className:"tm-cat-count",children:re.length})]},S)})})]}),se.length>0&&e.jsxs("div",{className:"tm-field",children:[e.jsxs("label",{children:["Added Items (",se.length,")"]}),e.jsx("div",{className:"tm-added-list",children:se.map((S,re)=>e.jsxs("div",{className:"tm-added-item",children:[e.jsxs("div",{className:"tm-added-info",children:[S.isCustom&&e.jsx("span",{className:"tm-custom-badge",children:"Custom"}),e.jsx("span",{className:"tm-added-name",children:S.name})]}),e.jsxs("div",{className:"tm-added-qty",children:[e.jsx("button",{onClick:()=>ot(re,S.quantity-1),children:""}),e.jsx("span",{children:S.quantity}),e.jsx("button",{onClick:()=>ot(re,S.quantity+1),children:"+"})]})]},re))})]})]}),g===4&&e.jsxs("div",{className:"tm-step-content",children:[e.jsx("div",{className:"tm-review-section",children:e.jsxs("div",{className:"tm-review-header",children:[e.jsx("span",{children:" Date"}),e.jsx("span",{children:new Date(y).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})]})}),ne&&e.jsxs("div",{className:"tm-review-section",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[e.jsx(Oa,{size:16,className:"inline-icon"})," ",De("notes")]})}),e.jsx("div",{className:"tm-review-notes",children:ne})]}),fe.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(Pn,{size:16,className:"inline-icon"})," ",De("photos")]}),e.jsx("span",{children:fe.length})]}),e.jsx("div",{className:"tm-review-photos",children:fe.map(S=>e.jsx("img",{src:S.previewUrl,alt:S.name},S.id))})]}),ue&&e.jsxs("div",{className:"tm-review-section",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[" ",De("linkedCOR")]})}),e.jsxs("div",{className:"tm-review-cor",children:[Y.find(S=>S.id===ue)?.cor_number,": ",Y.find(S=>S.id===ue)?.title||"Untitled"]})]}),ba.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(Cf,{size:16,className:"inline-icon"})," Supervision"]}),e.jsxs("span",{children:[ba.reduce((S,re)=>S+parseFloat(re.hours||0)+parseFloat(re.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:ba.map((S,re)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsxs("div",{className:"tm-review-worker-name",children:[e.jsx("span",{className:"tm-role-badge",children:S.role})," ",S.name]}),e.jsxs("div",{className:"tm-review-worker-details",children:[S.timeStarted&&S.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[S.timeStarted," - ",S.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[S.hours||0," reg",parseFloat(S.overtimeHours)>0?` + ${S.overtimeHours} OT`:""]})]})]},re))})]}),Zt.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsx("span",{children:" Operators"}),e.jsxs("span",{children:[Zt.reduce((S,re)=>S+parseFloat(re.hours||0)+parseFloat(re.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:Zt.map((S,re)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsx("div",{className:"tm-review-worker-name",children:S.name}),e.jsxs("div",{className:"tm-review-worker-details",children:[S.timeStarted&&S.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[S.timeStarted," - ",S.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[S.hours||0," reg",parseFloat(S.overtimeHours)>0?` + ${S.overtimeHours} OT`:""]})]})]},re))})]}),ga.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(Da,{size:16,className:"inline-icon"})," Laborers"]}),e.jsxs("span",{children:[ga.reduce((S,re)=>S+parseFloat(re.hours||0)+parseFloat(re.overtimeHours||0),0)," hrs"]})]}),e.jsx("div",{className:"tm-review-list",children:ga.map((S,re)=>e.jsxs("div",{className:"tm-review-row-detailed",children:[e.jsx("div",{className:"tm-review-worker-name",children:S.name}),e.jsxs("div",{className:"tm-review-worker-details",children:[S.timeStarted&&S.timeEnded&&e.jsxs("span",{className:"tm-review-time",children:[S.timeStarted," - ",S.timeEnded]}),e.jsxs("span",{className:"tm-review-hours",children:[S.hours||0," reg",parseFloat(S.overtimeHours)>0?` + ${S.overtimeHours} OT`:""]})]})]},re))})]}),se.length>0&&e.jsxs("div",{className:"tm-review-section",children:[e.jsxs("div",{className:"tm-review-header",children:[e.jsxs("span",{children:[e.jsx(wl,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsxs("span",{children:[se.length," items"]})]}),e.jsx("div",{className:"tm-review-list",children:se.map((S,re)=>e.jsxs("div",{className:"tm-review-row",children:[e.jsxs("span",{children:[S.isCustom&&e.jsxs(e.Fragment,{children:[e.jsx(qd,{size:14,className:"inline-icon"})," "]}),S.name]}),e.jsxs("span",{children:[S.quantity," ",S.unit]})]},re))})]}),e.jsxs("div",{className:"tm-review-section tm-certification",children:[e.jsx("div",{className:"tm-review-header",children:e.jsxs("span",{children:[e.jsx(bl,{size:16,className:"inline-icon"})," Submitted By"]})}),e.jsx("input",{type:"text",className:"tm-certification-input",placeholder:"Enter your name",value:E,onChange:S=>W(S.target.value)}),e.jsx("p",{className:"tm-certification-note",children:"By submitting, you certify this T&M is accurate."})]})]}),g===5&&v&&e.jsxs("div",{className:"tm-step-content tm-success-step",children:[e.jsxs("div",{className:"tm-success-header",children:[e.jsx("div",{className:"tm-success-icon",children:e.jsx(pd,{size:48})}),e.jsx("h2",{children:We==="en"?"T&M Ticket Submitted!":"Ticket T&M Enviado!"}),e.jsx("p",{className:"tm-success-subtitle",children:We==="en"?"Your ticket has been saved and is ready for client signature.":"Su ticket ha sido guardado y est listo para la firma del cliente."})]}),e.jsxs("div",{className:"tm-success-summary",children:[e.jsxs("div",{className:"tm-success-stat",children:[e.jsx("span",{className:"tm-success-stat-value",children:zt}),e.jsx("span",{className:"tm-success-stat-label",children:We==="en"?"Workers":"Trabajadores"})]}),e.jsxs("div",{className:"tm-success-stat",children:[e.jsx("span",{className:"tm-success-stat-value",children:Va+Ve}),e.jsx("span",{className:"tm-success-stat-label",children:We==="en"?"Total Hours":"Horas Total"})]}),e.jsxs("div",{className:"tm-success-stat",children:[e.jsx("span",{className:"tm-success-stat-value",children:new Date(y).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsx("span",{className:"tm-success-stat-label",children:We==="en"?"Work Date":"Fecha"})]})]}),fe.some(S=>S.status==="failed")&&e.jsxs("div",{className:"tm-failed-photos-section",children:[e.jsxs("div",{className:"tm-failed-photos-header",children:[e.jsx(vn,{size:18}),e.jsx("span",{children:We==="en"?`${fe.filter(S=>S.status==="failed").length} photo(s) failed to upload`:`${fe.filter(S=>S.status==="failed").length} foto(s) no se subieron`})]}),e.jsx("div",{className:"tm-failed-photos-grid",children:fe.filter(S=>S.status==="failed").map(S=>e.jsxs("div",{className:"tm-failed-photo-item",children:[e.jsx("img",{src:S.previewUrl,alt:S.name}),e.jsx("div",{className:"tm-failed-photo-overlay",children:e.jsx("button",{className:"tm-retry-photo-btn",onClick:()=>Sa(S.id,v.id),disabled:S.status==="uploading"||S.status==="compressing",children:S.status==="uploading"||S.status==="compressing"?e.jsx(Ui,{size:16,className:"tm-spinner"}):e.jsxs(e.Fragment,{children:[e.jsx(_l,{size:16}),e.jsx("span",{children:We==="en"?"Retry":"Reintentar"})]})})}),S.error&&e.jsxs("div",{className:"tm-failed-photo-error",title:S.error,children:[S.error.substring(0,20),S.error.length>20?"...":""]})]},S.id))}),e.jsxs("button",{className:"tm-retry-all-btn",onClick:async()=>{const S=fe.filter(re=>re.status==="failed");for(const re of S)await Sa(re.id,v.id)},children:[e.jsx(_l,{size:16}),We==="en"?"Retry All Failed Photos":"Reintentar Todas las Fotos"]})]}),fe.length>0&&fe.every(S=>S.status==="confirmed")&&e.jsxs("div",{className:"tm-photos-success",children:[e.jsx(Aa,{size:16}),e.jsx("span",{children:We==="en"?`All ${fe.length} photo(s) uploaded successfully`:`${fe.length} foto(s) subidas exitosamente`})]}),e.jsxs("div",{className:"tm-signature-options",children:[e.jsx("h3",{children:We==="en"?"Get Client Signature":"Obtener Firma del Cliente"}),e.jsx("p",{className:"tm-signature-description",children:We==="en"?"Have the client sign this T&M ticket to verify the work performed.":"Haga que el cliente firme este ticket T&M para verificar el trabajo realizado."}),U?e.jsxs("div",{className:"tm-signed-confirmation",children:[e.jsx(pd,{size:32,className:"tm-signed-icon"}),e.jsx("span",{children:We==="en"?"Client signature collected!":"Firma del cliente recopilada!"})]}):e.jsxs("div",{className:"tm-signature-buttons",children:[e.jsxs("button",{className:"tm-signature-option-btn primary",onClick:()=>C(!0),children:[e.jsx("div",{className:"tm-signature-option-icon",children:e.jsx(bl,{size:24})}),e.jsxs("div",{className:"tm-signature-option-text",children:[e.jsx("span",{className:"tm-signature-option-title",children:We==="en"?"Sign Now (On-Site)":"Firmar Ahora"}),e.jsx("span",{className:"tm-signature-option-desc",children:We==="en"?"Client signs on this device":"Cliente firma en este dispositivo"})]})]}),e.jsxs("button",{className:"tm-signature-option-btn",onClick:()=>j(!0),children:[e.jsx("div",{className:"tm-signature-option-icon",children:e.jsx($d,{size:24})}),e.jsxs("div",{className:"tm-signature-option-text",children:[e.jsx("span",{className:"tm-signature-option-title",children:We==="en"?"Send Signature Link":"Enviar Enlace"}),e.jsx("span",{className:"tm-signature-option-desc",children:We==="en"?"Client signs later via link":"Cliente firma despus va enlace"})]})]})]})]})]}),_&&v&&e.jsx(Vd,{documentType:"tm_ticket",documentId:v.id,companyId:l,projectId:r.id,documentTitle:`T&M - ${new Date(y).toLocaleDateString()}`,onClose:()=>j(!1),onShowToast:h}),$&&v&&e.jsx(sy,{ticketId:v.id,ticketSummary:{workDate:y,workerCount:zt,totalHours:Va+Ve},lang:We,onSave:()=>{C(!1),X(!0)},onClose:()=>C(!1),onShowToast:h}),g<5&&e.jsxs("div",{className:"tm-wizard-footer",children:[g===1&&e.jsx("button",{className:"tm-big-btn primary",onClick:Xt,disabled:!rt(),children:De("nextCrew")}),g===2&&e.jsx(e.Fragment,{children:e.jsxs("button",{className:"tm-big-btn primary",onClick:Xt,disabled:!rt(),children:[De("nextMaterials")," (",zt," ",De(zt===1?"worker":"workers_plural"),", ",Va+Ve," hrs)"]})}),g===3&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"tm-big-btn primary",onClick:Xt,children:[De("reviewItems")," (",se.length," ",se.length===1?De("item"):De("items_plural"),")"]}),e.jsx("button",{className:"tm-skip-btn",onClick:Xt,children:De("skipNoMaterials")})]}),g===4&&e.jsx("button",{className:`tm-big-btn submit ${ye?"submitting":""} ${E.trim()?"ready":"needs-name"}`,onClick:Pa,disabled:ye||!E.trim(),children:ye?e.jsxs(e.Fragment,{children:[e.jsx(Ui,{size:20,className:"tm-spinner"}),e.jsx("span",{className:"tm-submit-text",children:ze||De("submitting")})]}):E.trim()?e.jsxs(e.Fragment,{children:[e.jsx(Aa,{size:20}),e.jsx("span",{children:De("submitTM")})]}):e.jsxs(e.Fragment,{children:[e.jsx(bl,{size:18}),e.jsx("span",{children:We==="en"?"Enter name to submit":"Ingrese nombre"})]})})]}),g===5&&e.jsxs("div",{className:"tm-wizard-footer",children:[e.jsxs("button",{className:"tm-big-btn primary",onClick:i,children:[e.jsx(Aa,{size:20}),e.jsx("span",{children:We==="en"?"Done":"Listo"})]}),e.jsx("button",{className:"tm-skip-btn",onClick:i,children:We==="en"?"Skip signature for now":"Saltar firma por ahora"})]}),b&&e.jsx("div",{className:"tm-modal-overlay",onClick:()=>R(!1),children:e.jsxs("div",{className:"tm-batch-modal",onClick:S=>S.stopPropagation(),children:[e.jsxs("h3",{children:[e.jsx(jn,{size:18})," ",De("applySameHours")]}),e.jsx("p",{className:"tm-batch-description",children:De("batchDescription")}),e.jsxs("div",{className:"tm-time-presets",children:[e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>we("full"),children:De("preset8hr")}),e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>we("10hr"),children:De("preset10hr")}),e.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>we("half"),children:De("preset4hr")})]}),e.jsxs("div",{className:"tm-batch-form",children:[e.jsxs("div",{className:"tm-batch-row",children:[e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:De("timeStarted")}),e.jsx("input",{type:"time",value:B.timeStarted,onChange:S=>{const re=S.target.value,Ne=I(re,B.timeEnded);me({...B,timeStarted:re,...Ne||{}})}})]}),e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:De("timeEnded")}),e.jsx("input",{type:"time",value:B.timeEnded,onChange:S=>{const re=S.target.value,Ne=I(B.timeStarted,re);me({...B,timeEnded:re,...Ne||{}})}})]})]}),e.jsxs("div",{className:"tm-batch-row",children:[e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:De("regularHours")}),e.jsx("input",{type:"number",placeholder:"8",value:B.hours,onChange:S=>me({...B,hours:S.target.value})})]}),e.jsxs("div",{className:"tm-batch-field",children:[e.jsx("label",{children:De("overtimeHours")}),e.jsx("input",{type:"number",placeholder:"0",value:B.overtimeHours,onChange:S=>me({...B,overtimeHours:S.target.value})})]})]})]}),e.jsxs("div",{className:"tm-batch-preview",children:[e.jsxs("strong",{children:[De("willApplyTo"),":"]}),e.jsxs("span",{children:[[...T.filter(S=>S.name.trim()),...k.filter(S=>S.name.trim()),...D.filter(S=>S.name.trim())].length," ",De("workers_plural")]})]}),e.jsxs("div",{className:"tm-batch-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>R(!1),children:De("cancel")}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:Te,disabled:!B.hours&&!B.overtimeHours,children:De("applyToAll")})]})]})})]})}function ly({project:r,onShowToast:l}){const[c,i]=x.useState([]),[d,h]=x.useState(!0),[g,p]=x.useState(!1),[y,m]=x.useState(!1),[v,A]=x.useState({name:"",role:"Laborer"});x.useEffect(()=>{_()},[r.id]);const _=async()=>{try{const U=await K.getCrewCheckin(r.id);U?.workers&&i(U.workers)}catch(U){console.error("Error loading crew:",U)}finally{h(!1)}},j=async()=>{if(!v.name.trim()){l("Enter worker name","error");return}if(c.find(U=>U.name.toLowerCase()===v.name.trim().toLowerCase())){l("Worker already added","error");return}p(!0);try{const U=[...c,{name:v.name.trim(),role:v.role}];await K.saveCrewCheckin(r.id,U),i(U),A({name:"",role:"Laborer"}),m(!1),l("Crew member added","success")}catch(U){console.error("Error adding worker:",U),l("Error adding crew member","error")}finally{p(!1)}},$=async U=>{p(!0);try{const X=c.filter(V=>V.name.toLowerCase()!==U.toLowerCase());await K.saveCrewCheckin(r.id,X),i(X),l("Crew member removed","success")}catch(X){console.error("Error removing worker:",X),l("Error removing crew member","error")}finally{p(!1)}},C=new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"});return d?e.jsxs("div",{className:"crew-checkin",children:[e.jsxs("div",{className:"crew-header",children:[e.jsxs("h3",{children:[e.jsx(Da,{size:18,className:"inline-icon"})," Today's Crew"]}),e.jsx("span",{className:"crew-date",children:C})]}),e.jsx("div",{className:"crew-loading",children:"Loading..."})]}):e.jsxs("div",{className:"crew-checkin",children:[e.jsxs("div",{className:"crew-header",children:[e.jsxs("h3",{children:[e.jsx(Da,{size:18,className:"inline-icon"})," Today's Crew"]}),e.jsx("span",{className:"crew-date",children:C})]}),c.length===0?e.jsxs("div",{className:"crew-empty",children:[e.jsx("p",{children:"No crew checked in yet"}),e.jsx("p",{className:"crew-empty-hint",children:"Add your crew for the day"})]}):e.jsx("div",{className:"crew-list",children:c.map(U=>e.jsxs("div",{className:"crew-member",children:[e.jsxs("div",{className:"crew-member-info",children:[e.jsx("span",{className:"crew-member-name",children:U.name}),e.jsx("span",{className:`crew-member-role ${U.role.toLowerCase()}`,children:U.role})]}),e.jsx("button",{className:"crew-remove-btn",onClick:()=>$(U.name),disabled:g,children:""})]},U.name))}),y?e.jsxs("div",{className:"crew-add-form",children:[e.jsx("input",{type:"text",value:v.name,onChange:U=>A({...v,name:U.target.value}),placeholder:"Name",autoFocus:!0}),e.jsxs("select",{value:v.role,onChange:U=>A({...v,role:U.target.value}),children:[e.jsx("option",{value:"Foreman",children:"Foreman"}),e.jsx("option",{value:"Laborer",children:"Laborer"}),e.jsx("option",{value:"Supervisor",children:"Supervisor"}),e.jsx("option",{value:"Operator",children:"Operator"})]}),e.jsxs("div",{className:"crew-add-buttons",children:[e.jsx("button",{className:"crew-add-confirm",onClick:j,disabled:g,children:g?"...":"Add"}),e.jsx("button",{className:"crew-add-cancel",onClick:()=>{m(!1),A({name:"",role:"Laborer"})},children:"Cancel"})]})]}):e.jsx("button",{className:"crew-add-btn",onClick:()=>m(!0),children:"+ Add Crew Member"}),e.jsxs("div",{className:"crew-count",children:[c.length," ",c.length===1?"person":"people"," on site"]})]})}function iy({project:r,onShowToast:l,onClose:c}){const[i,d]=x.useState(!0),[h,g]=x.useState(!1),[p,y]=x.useState(null),[m,v]=x.useState(""),[A,_]=x.useState("");x.useEffect(()=>{j()},[r.id]);const j=async()=>{try{const X=await K.getDailyReport(r.id);if(X)y(X),v(X.field_notes||""),_(X.issues||"");else{const V=await K.compileDailyReport(r.id);y({...V,status:"draft"})}}catch(X){console.error("Error loading report:",X),l("Error loading report","error")}finally{d(!1)}},$=async()=>{if(!H){l("Demo Mode: Report saved locally only - won't reach office","info"),c();return}g(!0);try{await K.saveDailyReport(r.id,{field_notes:m,issues:A}),await K.submitDailyReport(r.id,"Field")?(l("Daily report submitted!","success"),c()):l("Report not sent - check connection","error")}catch(X){console.error("Error submitting report:",X),l("Error submitting report","error")}finally{g(!1)}},C=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"});if(i)return e.jsxs("div",{className:"daily-report",children:[e.jsxs("div",{className:"daily-report-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:c,children:""}),e.jsx("h2",{children:"Daily Report"})]}),e.jsx("div",{className:"daily-report-loading",children:"Compiling report..."})]});const U=p?.status==="submitted";return e.jsxs("div",{className:"daily-report",children:[e.jsxs("div",{className:"daily-report-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:c,children:""}),e.jsxs("div",{children:[e.jsx("h2",{children:"Daily Report"}),e.jsx("p",{className:"daily-report-date",children:C})]})]}),U&&e.jsxs("div",{className:"daily-report-submitted-banner",children:[" Submitted ",new Date(p.submitted_at).toLocaleTimeString()]}),e.jsxs("div",{className:"daily-report-content",children:[e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:p.crew_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:p.tasks_completed||0}),e.jsx("div",{className:"daily-report-card-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:p.tm_tickets_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"daily-report-card",children:[e.jsx("div",{className:"daily-report-card-value",children:p.photos_count||0}),e.jsx("div",{className:"daily-report-card-label",children:"Photos"})]})]}),p.crew_list?.length>0&&e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Da,{size:18,className:"inline-icon"})," Crew"]}),e.jsx("div",{className:"daily-report-crew",children:p.crew_list.map((X,V)=>e.jsxs("div",{className:"daily-report-crew-item",children:[e.jsx("span",{children:X.name}),e.jsx("span",{className:"daily-report-crew-role",children:X.role})]},V))})]}),p.completed_tasks?.length>0&&e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Ta,{size:18,className:"inline-icon"})," Completed Today"]}),e.jsx("ul",{className:"daily-report-tasks",children:p.completed_tasks.map((X,V)=>e.jsxs("li",{children:[X.name,X.group&&e.jsx("span",{className:"daily-report-task-group",children:X.group})]},V))})]}),e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Oa,{size:18,className:"inline-icon"})," Notes"]}),e.jsx("textarea",{value:m,onChange:X=>v(X.target.value),placeholder:"Any notes about today's work...",rows:3,disabled:U})]}),e.jsxs("div",{className:"daily-report-section",children:[e.jsxs("h3",{children:[e.jsx(Tr,{size:18,className:"inline-icon"})," Issues / Concerns"]}),e.jsx("textarea",{value:A,onChange:X=>_(X.target.value),placeholder:"Any problems, delays, or concerns...",rows:3,disabled:U})]})]}),!U&&e.jsxs("div",{className:"daily-report-footer",children:[e.jsx("button",{className:"btn btn-primary daily-report-submit",onClick:$,disabled:h,children:h?"Submitting...":e.jsxs(e.Fragment,{children:[e.jsx(Hv,{size:16,className:"inline-icon"})," Submit Report"]})}),e.jsx("p",{className:"daily-report-hint",children:"This will be sent to the office"})]})]})}const cy=x.createContext({}),Ef=()=>x.useContext(cy);function Ls({message:r,type:l="",onClose:c}){return x.useEffect(()=>{const i=setTimeout(c,3e3);return()=>clearTimeout(i)},[c]),e.jsx("div",{className:"toast-container",children:e.jsx("div",{className:`toast ${l}`,children:r})})}function Df({project:r,companyId:l,onClose:c,onReportCreated:i}){const{user:d}=Ef(),[h,g]=x.useState(!1),[p,y]=x.useState(null),[m,v]=x.useState(1),[A,_]=x.useState(new Date().toISOString().split("T")[0]),[j,$]=x.useState(new Date().toTimeString().split(" ")[0].substring(0,5)),[C,U]=x.useState(""),[X,V]=x.useState(""),[q,E]=x.useState("minor"),[W,ue]=x.useState(""),[ae,Y]=x.useState(""),[P,ce]=x.useState(""),[M,b]=x.useState(""),[R,B]=x.useState(""),[me,T]=x.useState(""),[ee,k]=x.useState(""),[pe,D]=x.useState(d?.name||""),[z,se]=x.useState(""),[Z,ne]=x.useState(""),[F,fe]=x.useState(d?.email||""),[de,ye]=x.useState([]),[Fe,ze]=x.useState(""),[Me,nt]=x.useState(""),[qe,J]=x.useState(""),[Oe,Ie]=x.useState(""),[ft,ja]=x.useState(!1),[ke,Le]=x.useState(""),[$e,Je]=x.useState(""),[et,tt]=x.useState(!1),[Ae,bt]=x.useState(""),[kt,Mt]=x.useState(""),[Gt,Dt]=x.useState(""),[aa,da]=x.useState(""),[St,We]=x.useState(!1),[Ft,De]=x.useState(!1),[I,L]=x.useState(0),[we,it]=x.useState(0),Te=()=>{if(!Fe.trim()){y({type:"error",message:"Please enter witness name"});return}const Ce={name:Fe,phone:Me,email:qe,testimony:Oe};ye([...de,Ce]),ze(""),nt(""),J(""),Ie(""),y({type:"success",message:"Witness added"})},be=Ce=>{ye(de.filter((xt,ut)=>ut!==Ce))},st=Ce=>{switch(Ce){case 1:if(!C.trim()||!X.trim())return y({type:"error",message:"Please fill in all incident details"}),!1;break;case 2:if(!ae.trim()||!me.trim())return y({type:"error",message:"Please fill in employee name and job title"}),!1;break;case 3:if(!pe.trim()||!z.trim())return y({type:"error",message:"Please fill in supervisor name and title"}),!1;break}return!0},dt=()=>{st(m)&&v(m+1)},It=()=>{v(m-1)},sa=async()=>{if(st(m)){if(!H){y({type:"info",message:"Demo Mode: Report saved locally only - won't reach office"}),setTimeout(()=>{c()},1500);return}g(!0);try{const Ce={project_id:r.id,company_id:l,incident_date:A,incident_time:j,incident_location:C,incident_description:X,injury_type:q,body_part_affected:W||null,employee_name:ae,employee_phone:P||null,employee_email:M||null,employee_address:R||null,employee_job_title:me,employee_hire_date:ee||null,medical_treatment_required:ft,medical_facility_name:ke||null,medical_facility_address:$e||null,hospitalized:et,reported_by_name:pe,reported_by_title:z,reported_by_phone:Z||null,reported_by_email:F||null,witnesses:de,immediate_actions_taken:Ae||null,corrective_actions_planned:kt||null,safety_equipment_used:Gt||null,safety_equipment_failed:aa||null,osha_recordable:St,workers_comp_claim:Ft,days_away_from_work:parseInt(I)||0,restricted_work_days:parseInt(we)||0,status:"reported",created_by:d?.id},xt=await K.createInjuryReport(Ce);y({type:"success",message:"Injury report submitted successfully"}),i&&i(xt),setTimeout(()=>{c()},1500)}catch(Ce){console.error("Error submitting injury report:",Ce),y({type:"error",message:"Failed to submit injury report"})}finally{g(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:c,children:e.jsxs("div",{className:"modal-content injury-report-modal",onClick:Ce=>Ce.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Workplace Injury/Incident Report"}),e.jsx("button",{className:"close-btn",onClick:c,children:""})]}),e.jsxs("div",{className:"progress-steps",children:[e.jsx("div",{className:`step ${m>=1?"active":""}`,children:"1. Incident"}),e.jsx("div",{className:`step ${m>=2?"active":""}`,children:"2. Employee"}),e.jsx("div",{className:`step ${m>=3?"active":""}`,children:"3. Supervisor"}),e.jsx("div",{className:`step ${m>=4?"active":""}`,children:"4. Witnesses"}),e.jsx("div",{className:`step ${m>=5?"active":""}`,children:"5. Medical & Safety"})]}),e.jsxs("div",{className:"modal-body",children:[m===1&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Incident Details"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date of Incident *"}),e.jsx("input",{type:"date",value:A,onChange:Ce=>_(Ce.target.value),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Time of Incident *"}),e.jsx("input",{type:"time",value:j,onChange:Ce=>$(Ce.target.value)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Location on Site *"}),e.jsx("input",{type:"text",value:C,onChange:Ce=>U(Ce.target.value),placeholder:"e.g., Floor 2, near elevator shaft"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Incident Description *"}),e.jsx("textarea",{value:X,onChange:Ce=>V(Ce.target.value),rows:4,placeholder:"Describe what happened in detail..."})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Injury Type *"}),e.jsxs("select",{value:q,onChange:Ce=>E(Ce.target.value),children:[e.jsx("option",{value:"minor",children:"Minor Injury"}),e.jsx("option",{value:"serious",children:"Serious Injury"}),e.jsx("option",{value:"critical",children:"Critical Injury"}),e.jsx("option",{value:"near_miss",children:"Near Miss (No Injury)"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("input",{type:"text",value:W,onChange:Ce=>ue(Ce.target.value),placeholder:"e.g., Left hand, lower back"})]})]})]}),m===2&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Injured Employee Information"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Full Name *"}),e.jsx("input",{type:"text",value:ae,onChange:Ce=>Y(Ce.target.value),placeholder:"First and last name"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:P,onChange:Ce=>ce(Ce.target.value),placeholder:"(555) 123-4567"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:M,onChange:Ce=>b(Ce.target.value),placeholder:"email@example.com"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Home Address"}),e.jsx("input",{type:"text",value:R,onChange:Ce=>B(Ce.target.value),placeholder:"Street address, city, state, zip"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Title *"}),e.jsx("input",{type:"text",value:me,onChange:Ce=>T(Ce.target.value),placeholder:"e.g., Carpenter, Electrician"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Hire Date"}),e.jsx("input",{type:"date",value:ee,onChange:Ce=>k(Ce.target.value)})]})]})]}),m===3&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Foreman/Supervisor Making Report"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Name *"}),e.jsx("input",{type:"text",value:pe,onChange:Ce=>D(Ce.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Title *"}),e.jsx("input",{type:"text",value:z,onChange:Ce=>se(Ce.target.value),placeholder:"e.g., Site Foreman, Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Phone Number"}),e.jsx("input",{type:"tel",value:Z,onChange:Ce=>ne(Ce.target.value),placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Your Email Address"}),e.jsx("input",{type:"email",value:F,onChange:Ce=>fe(Ce.target.value),placeholder:"email@example.com"})]})]}),m===4&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Witness Testimonies (Optional)"}),de.length>0&&e.jsx("div",{className:"witnesses-list",children:de.map((Ce,xt)=>e.jsxs("div",{className:"witness-item",children:[e.jsxs("div",{className:"witness-info",children:[e.jsx("strong",{children:Ce.name}),Ce.phone&&e.jsxs("span",{children:["  ",Ce.phone]}),Ce.testimony&&e.jsxs("p",{className:"witness-testimony",children:['"',Ce.testimony,'"']})]}),e.jsx("button",{className:"btn-danger btn-small",onClick:()=>be(xt),children:"Remove"})]},xt))}),e.jsxs("div",{className:"add-witness-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Witness Name"}),e.jsx("input",{type:"text",value:Fe,onChange:Ce=>ze(Ce.target.value),placeholder:"Full name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Phone Number"}),e.jsx("input",{type:"tel",value:Me,onChange:Ce=>nt(Ce.target.value),placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{type:"email",value:qe,onChange:Ce=>J(Ce.target.value),placeholder:"email@example.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Witness Testimony"}),e.jsx("textarea",{value:Oe,onChange:Ce=>Ie(Ce.target.value),rows:3,placeholder:"What did the witness see or hear?"})]}),e.jsx("button",{className:"btn-secondary",onClick:Te,children:"+ Add Witness"})]})]}),m===5&&e.jsxs("div",{className:"form-step",children:[e.jsx("h3",{children:"Medical Treatment & Safety"}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:ft,onChange:Ce=>ja(Ce.target.checked)}),"Medical treatment required"]})}),ft&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medical Facility Name"}),e.jsx("input",{type:"text",value:ke,onChange:Ce=>Le(Ce.target.value),placeholder:"Hospital or clinic name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medical Facility Address"}),e.jsx("input",{type:"text",value:$e,onChange:Ce=>Je(Ce.target.value),placeholder:"Street address"})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:et,onChange:Ce=>tt(Ce.target.checked)}),"Employee was hospitalized"]})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("textarea",{value:Ae,onChange:Ce=>bt(Ce.target.value),rows:2,placeholder:"What was done immediately after the incident?"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("textarea",{value:kt,onChange:Ce=>Mt(Ce.target.value),rows:2,placeholder:"What will be done to prevent this in the future?"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("input",{type:"text",value:Gt,onChange:Ce=>Dt(Ce.target.value),placeholder:"e.g., Hard hat, gloves, harness"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("input",{type:"text",value:aa,onChange:Ce=>da(Ce.target.value),placeholder:"Equipment that failed, if any"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("input",{type:"number",min:"0",value:I,onChange:Ce=>L(Ce.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("input",{type:"number",min:"0",value:we,onChange:Ce=>it(Ce.target.value)})]})]}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:St,onChange:Ce=>We(Ce.target.checked)}),"OSHA Recordable Incident"]})}),e.jsx("div",{className:"form-group checkbox-group",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:Ft,onChange:Ce=>De(Ce.target.checked)}),"Workers' Compensation Claim Filed"]})})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsxs("div",{className:"form-actions",children:[m>1&&e.jsx("button",{className:"btn-secondary",onClick:It,children:" Back"}),e.jsx("button",{className:"btn-secondary",onClick:c,children:"Cancel"}),m<5?e.jsx("button",{className:"btn-primary",onClick:dt,children:"Next "}):e.jsx("button",{className:"btn-primary",onClick:sa,disabled:h,children:h?"Submitting...":"Submit Report"})]})})]})}),p&&e.jsx(Ls,{message:p.message,type:p.type,onClose:()=>y(null)}),e.jsx("style",{children:`
        .injury-report-modal {
          max-width: 800px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .progress-steps {
          display: flex;
          justify-content: space-between;
          padding: 1rem 1.5rem;
          border-bottom: 1px solid var(--border-color);
          background-color: var(--bg-elevated);
          overflow-x: auto;
        }

        .progress-steps .step {
          font-size: 0.875rem;
          color: var(--text-muted);
          font-weight: 500;
          white-space: nowrap;
          padding: 0.5rem;
        }

        .progress-steps .step.active {
          color: var(--accent-primary);
          font-weight: 600;
        }

        .form-step h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          color: var(--text-primary);
          font-size: 1.25rem;
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1rem;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .form-group label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 500;
          color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          width: 100%;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 1rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-group textarea {
          resize: vertical;
        }

        .checkbox-group label {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: normal;
          cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
          width: auto;
          margin: 0;
        }

        .witnesses-list {
          margin-bottom: 1.5rem;
        }

        .witness-item {
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
        }

        .witness-info {
          flex: 1;
          color: var(--text-primary);
        }

        .witness-testimony {
          margin-top: 0.5rem;
          color: var(--text-secondary);
          font-style: italic;
          font-size: 0.875rem;
        }

        .add-witness-form {
          border: 2px dashed var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          background-color: var(--bg-elevated);
        }

        .modal-footer {
          border-top: 1px solid var(--border-color);
          padding: 1rem 1.5rem;
        }

        .form-actions {
          display: flex;
          justify-content: space-between;
          gap: 0.5rem;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
        }

        @media (max-width: 768px) {
          .injury-report-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }

          .form-row {
            grid-template-columns: 1fr;
          }

          .progress-steps .step {
            font-size: 0.75rem;
            padding: 0.25rem;
          }
        }
      `})]})}function Tf({compact:r=!1}){const{theme:l,toggleTheme:c}=dj();return e.jsx("button",{className:`theme-toggle ${r?"theme-toggle-compact":""}`,onClick:c,title:`Switch to ${l==="dark"?"light":"dark"} mode`,"aria-label":`Switch to ${l==="dark"?"light":"dark"} mode`,children:l==="dark"?e.jsxs(e.Fragment,{children:[e.jsx(Av,{size:r?18:16}),!r&&e.jsx("span",{children:"Light"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ov,{size:r?18:16}),!r&&e.jsx("span",{children:"Dark"})]})})}const xd=[{value:"concrete",label:"Concrete",icon:""},{value:"trash",label:"Trash",icon:""},{value:"metals",label:"Metals",icon:""},{value:"hazardous_waste",label:"Hazardous",icon:""}];function oy({project:r,user:l=null,date:c,onShowToast:i}){const[d,h]=x.useState([]),[g,p]=x.useState(!0),[y,m]=x.useState(!1),[v,A]=x.useState(!1),[_,j]=x.useState({type:"concrete",count:1}),$=new Date(c).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});x.useEffect(()=>{C()},[r.id,c]);const C=async()=>{try{p(!0);const ae=await K.getDisposalLoads(r.id,c);h(ae||[])}catch(ae){console.error("Error loading disposal loads:",ae)}finally{p(!1)}},U=async()=>{if(!(_.count<1)){m(!0);try{await K.addDisposalLoad(r.id,l?.id||null,c,_.type,_.count),await C(),j({type:"concrete",count:1}),A(!1),i?.("Disposal load added","success")}catch(ae){console.error("Error adding disposal load:",ae),i?.("Error adding load","error")}finally{m(!1)}}},X=async ae=>{m(!0);try{await K.deleteDisposalLoad(ae),await C(),i?.("Load removed","success")}catch(Y){console.error("Error deleting disposal load:",Y),i?.("Error removing load","error")}finally{m(!1)}},V=async ae=>{m(!0);try{await K.addDisposalLoad(r.id,l?.id||null,c,ae,1),await C(),i?.("Load added","success")}catch(Y){console.error("Error adding disposal load:",Y),i?.("Error adding load","error")}finally{m(!1)}},q=async ae=>{m(!0);try{await K.updateDisposalLoad(ae.id,ae.load_type,ae.load_count+1),await C()}catch(Y){console.error("Error updating load:",Y),i?.("Error updating load","error")}finally{m(!1)}},E=async ae=>{if(ae.load_count<=1){await X(ae.id);return}m(!0);try{await K.updateDisposalLoad(ae.id,ae.load_type,ae.load_count-1),await C()}catch(Y){console.error("Error updating load:",Y),i?.("Error updating load","error")}finally{m(!1)}},W=d.reduce((ae,Y)=>(ae[Y.load_type]||(ae[Y.load_type]={items:[],total:0}),ae[Y.load_type].items.push(Y),ae[Y.load_type].total+=Y.load_count,ae),{}),ue=d.reduce((ae,Y)=>ae+Y.load_count,0);return g?e.jsxs("div",{className:"disposal-load-input",children:[e.jsxs("div",{className:"disposal-header",children:[e.jsx(ds,{size:20}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("div",{className:"disposal-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-load-input",children:[e.jsxs("div",{className:"disposal-header",children:[e.jsxs("div",{className:"disposal-title",children:[e.jsx(ds,{size:20}),e.jsx("span",{children:"Disposal Loads"}),ue>0&&e.jsx("span",{className:"disposal-badge",children:ue})]}),e.jsx("span",{className:"disposal-date",children:$})]}),e.jsx("div",{className:"disposal-quick-add",children:xd.map(ae=>e.jsxs("button",{className:"quick-add-btn",onClick:()=>V(ae.value),disabled:y,children:[e.jsx("span",{className:"quick-add-icon",children:ae.icon}),e.jsxs("span",{className:"quick-add-label",children:["+ ",ae.label]})]},ae.value))}),Object.keys(W).length>0?e.jsx("div",{className:"disposal-loads-list",children:xd.map(ae=>{const Y=W[ae.value];return Y?e.jsxs("div",{className:"disposal-load-row",children:[e.jsxs("div",{className:"load-info",children:[e.jsx("span",{className:"load-icon",children:ae.icon}),e.jsx("span",{className:"load-label",children:ae.label})]}),e.jsxs("div",{className:"load-controls",children:[e.jsx("button",{className:"load-btn decrement",onClick:()=>E(Y.items[0]),disabled:y,children:e.jsx(Od,{size:16})}),e.jsx("span",{className:"load-count",children:Y.total}),e.jsx("button",{className:"load-btn increment",onClick:()=>q(Y.items[0]),disabled:y,children:e.jsx(ys,{size:16})})]})]},ae.value):null})}):e.jsxs("div",{className:"disposal-empty",children:[e.jsxs("p",{children:["No disposal loads recorded for ",$]}),e.jsx("p",{className:"disposal-hint",children:"Tap a button above to add loads"})]}),v&&e.jsxs("div",{className:"disposal-add-form",children:[e.jsxs("div",{className:"add-form-row",children:[e.jsx("select",{value:_.type,onChange:ae=>j({..._,type:ae.target.value}),className:"load-type-select",children:xd.map(ae=>e.jsxs("option",{value:ae.value,children:[ae.icon," ",ae.label]},ae.value))}),e.jsxs("div",{className:"count-input-group",children:[e.jsx("button",{className:"count-btn",onClick:()=>j({..._,count:Math.max(1,_.count-1)}),children:e.jsx(Od,{size:16})}),e.jsx("input",{type:"number",min:"1",value:_.count,onChange:ae=>j({..._,count:parseInt(ae.target.value)||1}),className:"count-input"}),e.jsx("button",{className:"count-btn",onClick:()=>j({..._,count:_.count+1}),children:e.jsx(ys,{size:16})})]})]}),e.jsxs("div",{className:"add-form-actions",children:[e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:()=>A(!1),children:[e.jsx(Ra,{size:16})," Cancel"]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:U,disabled:y,children:[e.jsx(Aa,{size:16})," Add"]})]})]}),!v&&e.jsxs("button",{className:"disposal-add-custom",onClick:()=>A(!0),children:[e.jsx(ys,{size:16}),"Add multiple loads"]}),ue>0&&e.jsxs("div",{className:"disposal-summary",children:[e.jsx("strong",{children:ue})," total load",ue!==1?"s":""," today"]})]})}function dy({project:r,companyId:l,onShowToast:c,onExit:i}){const[d,h]=x.useState([]),[g,p]=x.useState(!0),[y,m]=x.useState(null),[v,A]=x.useState({}),[_,j]=x.useState(!1),[$,C]=x.useState(!1),[U,X]=x.useState(!1),[V,q]=x.useState(!1),[E,W]=x.useState(!1),[ue,ae]=x.useState(!1),[Y,P]=x.useState("actions");x.useEffect(()=>{ce()},[r.id]);const ce=async()=>{try{const D=await K.getAreas(r.id);h(D);const z=[...new Set(D.map(Z=>Z.group_name||"General"))],se={};z.forEach(Z=>se[Z]=!1),A(se)}catch(D){console.error("Error loading areas:",D),c("Error loading areas","error")}finally{p(!1)}},M=async(D,z)=>{const se=d.find(ne=>ne.id===D);if(!se)return;const Z=se.status===z?"not_started":z;m(D);try{await K.updateAreaStatus(D,Z),h(ne=>ne.map(F=>F.id===D?{...F,status:Z}:F)),c("Updated","success")}catch(ne){console.error("Error updating status:",ne),c("Error updating","error")}finally{m(null)}},b=D=>{A(z=>({...z,[D]:!z[D]}))};if(g)return e.jsx("div",{className:"foreman-container",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading..."]})});if(_)return e.jsx("div",{className:"foreman-container",children:e.jsx(ry,{project:r,companyId:l,onSubmit:()=>j(!1),onCancel:()=>j(!1),onShowToast:c})});if(V)return e.jsx(iy,{project:r,onShowToast:c,onClose:()=>q(!1)});if(E)return e.jsx("div",{className:"foreman-container",children:e.jsx(Df,{project:r,companyId:l,onClose:()=>W(!1),onReportCreated:()=>{W(!1),c("Injury report submitted","success")}})});if($)return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-view-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:()=>C(!1),children:""}),e.jsx("h2",{children:"Crew Check-in"})]}),e.jsx(ly,{project:r,onShowToast:c})]});if(U)return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-view-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:()=>X(!1),children:""}),e.jsx("h2",{children:"Disposal Loads"})]}),e.jsx(oy,{project:r,date:new Date().toISOString().split("T")[0],onShowToast:c})]});const R=Kv(d),B=d.reduce((D,z)=>{const se=z.group_name||"General";return D[se]||(D[se]=[]),D[se].push(z),D},{}),me=Object.keys(B).length>1||Object.keys(B).length===1&&!B.General,T=D=>`${D.filter(se=>se.status==="done").length}/${D.length}`,ee=d.filter(D=>D.status==="done").length,k=d.filter(D=>D.status==="working").length,pe=d.length-ee;return e.jsxs("div",{className:"foreman-container",children:[e.jsxs("div",{className:"foreman-header",children:[e.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),e.jsxs("div",{className:"foreman-header-info",children:[e.jsx("div",{className:"foreman-project-name",children:r.name}),e.jsxs("div",{className:"foreman-progress",children:[R,"% Complete"]})]}),e.jsxs("div",{className:"foreman-header-actions",children:[e.jsx(Tf,{compact:!0}),e.jsx("button",{className:"foreman-info-btn",onClick:()=>ae(!ue),children:e.jsx(Ad,{size:20})})]})]}),ue&&e.jsxs("div",{className:"foreman-project-info",children:[r.job_number&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Job #"}),e.jsx("span",{className:"foreman-info-value",children:r.job_number})]}),r.address&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Address"}),e.jsx("span",{className:"foreman-info-value",children:r.address})]}),r.general_contractor&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"GC / Client"}),e.jsx("span",{className:"foreman-info-value",children:r.general_contractor})]}),r.client_contact&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Contact"}),e.jsx("span",{className:"foreman-info-value",children:r.client_contact})]}),r.client_phone&&e.jsxs("div",{className:"foreman-info-row",children:[e.jsx("span",{className:"foreman-info-label",children:"Phone"}),e.jsx("a",{href:`tel:${r.client_phone}`,className:"foreman-info-value foreman-info-link",children:r.client_phone})]})]}),e.jsxs("div",{className:"foreman-stats",children:[e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value working",children:k}),e.jsx("div",{className:"foreman-stat-label",children:"Working"})]}),e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value done",children:ee}),e.jsx("div",{className:"foreman-stat-label",children:"Done"})]}),e.jsxs("div",{className:"foreman-stat",children:[e.jsx("div",{className:"foreman-stat-value remaining",children:pe}),e.jsx("div",{className:"foreman-stat-label",children:"Remaining"})]})]}),e.jsxs("div",{className:"foreman-tabs",children:[e.jsxs("button",{className:`foreman-tab ${Y==="actions"?"active":""}`,onClick:()=>P("actions"),children:[e.jsx(qd,{size:18}),"Actions"]}),e.jsxs("button",{className:`foreman-tab ${Y==="progress"?"active":""}`,onClick:()=>P("progress"),children:[e.jsx(Rd,{size:18}),"Progress"]})]}),Y==="actions"&&e.jsxs("div",{className:"field-actions",children:[e.jsxs("button",{className:"field-action-btn",onClick:()=>j(!0),children:[e.jsx(Oa,{size:22}),"T&M Ticket"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>C(!0),children:[e.jsx(Da,{size:22}),"Crew Check-in"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>X(!0),children:[e.jsx(ds,{size:22}),"Disposal Loads"]}),e.jsxs("button",{className:"field-action-btn",onClick:()=>q(!0),children:[e.jsx(cs,{size:22}),"Daily Report"]}),e.jsxs("button",{className:"field-action-btn danger",onClick:()=>W(!0),children:[e.jsx(Tr,{size:22}),"Report Injury"]})]}),Y==="progress"&&e.jsxs("div",{className:"foreman-areas",children:[me?Object.entries(B).map(([D,z])=>e.jsxs("div",{className:"foreman-group",children:[e.jsxs("div",{className:"foreman-group-header",onClick:()=>b(D),children:[e.jsxs("div",{className:"foreman-group-title",children:[e.jsx("span",{className:"foreman-group-arrow",children:v[D]?"":""}),e.jsx("span",{className:"foreman-group-name",children:D})]}),e.jsx("span",{className:"foreman-group-progress",children:T(z)})]}),v[D]&&e.jsx("div",{className:"foreman-group-tasks",children:z.map(se=>e.jsxs("div",{className:`foreman-area-card ${se.status}`,children:[e.jsx("div",{className:"foreman-area-name",children:se.name}),e.jsxs("div",{className:"foreman-area-buttons",children:[e.jsx("button",{className:`foreman-btn working ${se.status==="working"?"active":""}`,onClick:()=>M(se.id,"working"),disabled:y===se.id,children:y===se.id?"...":"Working"}),e.jsx("button",{className:`foreman-btn done ${se.status==="done"?"active":""}`,onClick:()=>M(se.id,"done"),disabled:y===se.id,children:y===se.id?"...":"Done"})]})]},se.id))})]},D)):d.map(D=>e.jsxs("div",{className:`foreman-area-card ${D.status}`,children:[e.jsx("div",{className:"foreman-area-name",children:D.name}),e.jsxs("div",{className:"foreman-area-buttons",children:[e.jsx("button",{className:`foreman-btn working ${D.status==="working"?"active":""}`,onClick:()=>M(D.id,"working"),disabled:y===D.id,children:y===D.id?"...":"Working"}),e.jsx("button",{className:`foreman-btn done ${D.status==="done"?"active":""}`,onClick:()=>M(D.id,"done"),disabled:y===D.id,children:y===D.id?"...":"Done"})]})]},D.id)),d.length===0&&e.jsxs("div",{className:"foreman-empty",children:[e.jsx(cs,{size:48,className:"foreman-empty-icon"}),e.jsx("div",{className:"foreman-empty-text",children:"No areas yet"}),e.jsx("div",{className:"foreman-empty-subtext",children:"Office needs to add areas to this project"})]})]})]})}const Ip=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},uy=r=>new Promise(l=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>{const i=document.createElement("canvas");i.width=c.width,i.height=c.height,i.getContext("2d").drawImage(c,0,0),l(i.toDataURL("image/png"))},c.onerror=()=>l(null),c.src=r});function my({project:r,company:l,onShowToast:c,compact:i=!1}){const{branding:d}=Dr(),[h,g]=x.useState([]),[p,y]=x.useState(!0),[m,v]=x.useState("all"),[A,_]=x.useState(null),[j,$]=x.useState(new Set),[C,U]=x.useState("recent"),[X,V]=x.useState(new Set),[q,E]=x.useState({start:"",end:""}),[W,ue]=x.useState(!1),[ae,Y]=x.useState(null),[P,ce]=x.useState(""),[M,b]=x.useState(!1),[R,B]=x.useState(null),[me,T]=x.useState(!1),[ee,k]=x.useState(null),[pe,D]=x.useState([]),[z,se]=x.useState(""),[Z,ne]=x.useState(!1),[F,fe]=x.useState({}),[de,ye]=x.useState({}),[Fe,ze]=x.useState(null);x.useEffect(()=>{Me();const I=K.subscribeToTMTickets?.(r.id,()=>{Me()});return()=>{I&&K.unsubscribe?.(I)}},[r.id]);const Me=async()=>{try{const I=await K.getTMTickets(r.id);g(I);const L=I.filter(we=>we.assigned_cor_id);if(L.length>0){const we={},it={};await Promise.all(L.map(async Te=>{const be=await K.isTicketEditable(Te);be.editable||(we[Te.id]=be);try{const st=await K.getTicketImportStatus(Te.id,Te.assigned_cor_id);st?.import_status==="failed"&&(it[Te.id]=st)}catch{}})),fe(we),ye(it)}}catch(I){console.error("Error loading tickets:",I),c("Error loading T&M tickets","error")}finally{y(!1)}},nt=async(I,L)=>{if(F[I]){c(F[I].reason||"This ticket is locked (COR approved)","error");return}try{await K.updateTMTicketStatus(I,L),g(h.map(we=>we.id===I?{...we,status:L}:we)),c(`Ticket ${L}`,"success")}catch(we){console.error("Error updating status:",we),c("Error updating status","error")}},qe=I=>{if(F[I.id]){c(F[I.id].reason||"This ticket is locked (COR approved)","error");return}nt(I.id,"approved")},J=async()=>{if(ae)try{const I=parseFloat(P)||0;await K.approveTMTicket(ae.id,null,null,I),g(h.map(L=>L.id===ae.id?{...L,status:"approved",change_order_value:I}:L)),c(`Ticket approved with $${I.toLocaleString()} change order`,"success"),ue(!1),Y(null),ce("")}catch(I){console.error("Error approving ticket:",I),c("Error approving ticket","error")}},Oe=async I=>{if(F[I]){c(F[I].reason||"This ticket is locked (COR approved)","error");return}if(confirm("Delete this T&M ticket?"))try{await K.deleteTMTicket(I),g(h.filter(L=>L.id!==I)),c("Ticket deleted","success")}catch(L){console.error("Error deleting ticket:",L),c("Error deleting ticket","error")}},Ie=async I=>{k(I),se(I.assigned_cor_id||""),T(!0),ne(!0);try{const L=await K.getAssignableCORs(r.id);D(L||[])}catch(L){console.error("Error loading CORs:",L),c("Error loading change orders","error")}finally{ne(!1)}},ft=async()=>{if(ee)try{if(z){await K.assignTicketToCOR(ee.id,z);const I=pe.find(L=>L.id===z);c(`Ticket linked to ${I?.cor_number||"COR"}`,"success")}else ee.assigned_cor_id&&(await K.unassignTicketFromCOR(ee.id,ee.assigned_cor_id),c("Ticket unlinked from COR","success"));Me(),T(!1),k(null),se("")}catch(I){console.error("Error updating COR association:",I),c("Error updating COR link","error")}},ja=async(I,L)=>{if(L?.stopPropagation(),!!I.assigned_cor_id){ze(I.id);try{await K.importTicketDataToCOR(I.id,I.assigned_cor_id,l.id,r.work_type||"demolition",r.job_type||"standard"),c("COR data import successful!","success"),ye(we=>{const it={...we};return delete it[I.id],it}),Me()}catch(we){console.error("Error retrying import:",we),c("Import retry failed. Please try again.","error")}finally{ze(null)}}},ke=I=>{let L=0;return I.t_and_m_items&&I.t_and_m_items.forEach(we=>{we.materials_equipment?.cost_per_unit&&(L+=we.quantity*we.materials_equipment.cost_per_unit)}),L},Le=I=>I.t_and_m_workers?I.t_and_m_workers.reduce((L,we)=>{const it=parseFloat(we.hours)||0,Te=parseFloat(we.overtime_hours)||0;return L+it+Te},0):0,$e=I=>new Date(I).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),Je=(I,L)=>{L.stopPropagation(),$(we=>{const it=new Set(we);return it.has(I)?it.delete(I):it.add(I),it})},et=()=>{const I=m==="all"?h:h.filter(we=>we.status===m),L=I.every(we=>j.has(we.id));$(L?new Set:new Set(I.map(we=>we.id)))},tt=()=>{$(new Set)},Ae=()=>{const I=m==="all"?h:h.filter(L=>L.status===m);return j.size>0?I.filter(L=>j.has(L.id)):I},bt=()=>{const I=Ae();if(I.length===0){c("No tickets to export","error");return}const L=[],we=[],it=[];I.forEach(dt=>{const It=$e(dt.work_date),sa=dt.status;dt.t_and_m_workers&&dt.t_and_m_workers.forEach(Ce=>{const xt=parseFloat(Ce.hours)||0,ut=parseFloat(Ce.overtime_hours)||0;L.push({Date:It,Status:sa,"Worker Name":Ce.name,Role:Ce.role||"Laborer","Regular Hours":xt,"OT Hours":ut,"Total Hours":xt+ut})}),dt.t_and_m_items&&dt.t_and_m_items.forEach(Ce=>{const xt=Ce.custom_name||Ce.materials_equipment?.name||"Unknown",ut=Ce.custom_category||Ce.materials_equipment?.category||"Unknown",qa=Ce.materials_equipment?.unit||"each",Ee=Ce.materials_equipment?.cost_per_unit||0,O=Ce.quantity*Ee;we.push({Date:It,Status:sa,Category:ut,Item:xt,Quantity:Ce.quantity,Unit:qa,"Cost/Unit":Ee,Total:O})}),it.push({Date:It,Status:sa,Workers:dt.t_and_m_workers?.length||0,"Total Hours":Le(dt),Items:dt.t_and_m_items?.length||0,"Materials Cost":ke(dt),Notes:dt.notes||""})});const Te=fn.book_new(),be=fn.json_to_sheet(it);if(fn.book_append_sheet(Te,be,"Summary"),L.length>0){const dt=fn.json_to_sheet(L);fn.book_append_sheet(Te,dt,"Workers")}if(we.length>0){const dt=fn.json_to_sheet(we);fn.book_append_sheet(Te,dt,"Materials & Equipment")}const st=`${r.name}_TM_${new Date().toISOString().split("T")[0]}.xlsx`;Bx(Te,st),c("Export downloaded!","success")},kt=async()=>{const I=Ae();if(I.length===0){c("No tickets to export","error");return}c("Generating PDF...","info");const L=new Sl,we=L.internal.pageSize.getWidth(),it=L.internal.pageSize.getHeight(),Te=20;let be=Te;const st=Ip(d?.primary_color||"#3B82F6"),dt=Ip(d?.secondary_color||"#1E40AF");L.setFillColor(...st),L.rect(0,0,we,45,"F"),L.setFillColor(...dt),L.rect(0,42,we,3,"F");let It=Te;if(d?.logo_url)try{const Ve=await uy(d.logo_url);Ve&&(L.addImage(Ve,"PNG",Te,7,30,30),It=Te+30+10)}catch(Ve){console.error("Error adding logo:",Ve)}L.setTextColor(255,255,255),L.setFontSize(22),L.setFont("helvetica","bold"),L.text(l?.name||"Company Name",It,20),L.setFontSize(10),L.setFont("helvetica","normal"),L.text("TIME & MATERIALS REPORT",It,30),L.setFontSize(9),L.text(`Report Date: ${new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`,we-Te,18,{align:"right"}),r.job_number&&L.text(`Job #: ${r.job_number}`,we-Te,26,{align:"right"}),L.text(`Status: ${m.charAt(0).toUpperCase()+m.slice(1)}`,we-Te,34,{align:"right"}),be=55,L.setFillColor(248,250,252),L.rect(Te,be-5,we-Te*2,30,"F"),L.setDrawColor(...st),L.setLineWidth(.5),L.rect(Te,be-5,we-Te*2,30,"S"),L.setTextColor(...st),L.setFontSize(14),L.setFont("helvetica","bold"),L.text(`Project: ${r.name}`,Te+5,be+7),L.setFontSize(10),L.setFont("helvetica","normal"),L.setTextColor(51,65,85);const sa=I.map(Ve=>new Date(Ve.work_date)).sort((Ve,at)=>Ve-at),Ce=sa[0]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),xt=sa[sa.length-1]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});L.text(`Date Range: ${Ce} - ${xt}`,Te+5,be+17),L.text(`Total Tickets: ${I.length}`,we-Te-5,be+7,{align:"right"}),be+=40;const ut=I.reduce((Ve,at)=>Ve+Le(at),0),qa=I.reduce((Ve,at)=>Ve+ke(at),0),Ee=new Set(I.flatMap(Ve=>Ve.t_and_m_workers?.map(at=>at.name)||[])).size;L.setTextColor(...st),L.setFontSize(12),L.setFont("helvetica","bold"),L.text("SUMMARY",Te,be),be+=8;const O=(we-Te*2-20)/3,je=[{label:"Total Labor Hours",value:ut.toFixed(1)},{label:"Unique Workers",value:Ee.toString()},{label:"Materials Cost",value:`$${qa.toFixed(2)}`}],xe=st.map(Ve=>Math.min(255,Ve+180));je.forEach((Ve,at)=>{const At=Te+at*(O+10);L.setFillColor(...xe),L.rect(At,be,O,25,"F"),L.setDrawColor(...st),L.setLineWidth(.5),L.rect(At,be,O,25,"S"),L.setTextColor(...st),L.setFontSize(16),L.setFont("helvetica","bold"),L.text(Ve.value,At+O/2,be+12,{align:"center"}),L.setTextColor(100,116,139),L.setFontSize(8),L.setFont("helvetica","normal"),L.text(Ve.label,At+O/2,be+20,{align:"center"})}),be+=35;const Re=[],jt=[],ct=[];let Tt=0,ot=0,ht=0,va=0,Qt=0,Sa=0;I.forEach(Ve=>{Ve.t_and_m_workers&&Ve.t_and_m_workers.forEach(at=>{const At=parseFloat(at.hours)||0,Pt=parseFloat(at.overtime_hours)||0,S=at.role||"Laborer",re=[$e(Ve.work_date),at.name,At.toString(),Pt>0?Pt.toString():"-",(At+Pt).toString()];S==="Foreman"||S==="Superintendent"?(Re.push(re),Tt+=At,ot+=Pt):S==="Operator"?(jt.push(re),ht+=At,va+=Pt):(ct.push(re),Qt+=At,Sa+=Pt)})});const Pe=(Ve,at,At,Pt)=>{at.length!==0&&(be>it-80&&(L.addPage(),be=Te),L.setTextColor(...st),L.setFontSize(11),L.setFont("helvetica","bold"),L.text(Ve,Te,be),be+=5,vs(L,{startY:be,head:[["Date","Name","Reg Hrs","OT Hrs","Total"]],body:at,margin:{left:Te,right:Te},headStyles:{fillColor:st,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{0:{cellWidth:30},2:{halign:"center",cellWidth:22},3:{halign:"center",cellWidth:22},4:{halign:"center",cellWidth:22}},foot:[["","SUBTOTAL:",At.toString(),Pt>0?Pt.toString():"-",(At+Pt).toString()]],footStyles:{fillColor:dt,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),be=L.lastAutoTable.finalY+10)};if(Re.length>0||jt.length>0||ct.length>0){L.setTextColor(...st),L.setFontSize(12),L.setFont("helvetica","bold"),L.text("LABOR",Te,be),be+=8,Pe("SUPERVISION",Re,Tt,ot),Pe("OPERATORS",jt,ht,va),Pe("LABORERS",ct,Qt,Sa);const Ve=Tt+ht+Qt,at=ot+va+Sa;L.setFillColor(...st),L.rect(Te,be,we-Te*2,12,"F"),L.setTextColor(255,255,255),L.setFontSize(10),L.setFont("helvetica","bold"),L.text("LABOR TOTAL:",Te+5,be+8),L.text(`${Ve} Reg + ${at} OT = ${Ve+at} Hours`,we-Te-5,be+8,{align:"right"}),be+=20}be>it-100&&(L.addPage(),be=Te);const rt={},Xt={},ya=["Containment","PPE","Disposal","Equipment","Other"];I.forEach(Ve=>{Ve.t_and_m_items&&Ve.t_and_m_items.forEach(at=>{const At=at.custom_name||at.materials_equipment?.name||"Unknown",Pt=at.custom_category||at.materials_equipment?.category||"Other",S=at.materials_equipment?.unit||"each",re=at.materials_equipment?.cost_per_unit||0,Ne=at.quantity*re;rt[Pt]||(rt[Pt]=[],Xt[Pt]=0),rt[Pt].push([$e(Ve.work_date),At,at.quantity.toString(),S,`$${re.toFixed(2)}`,`$${Ne.toFixed(2)}`]),Xt[Pt]+=Ne})});const Pa=(Ve,at,At)=>{!at||at.length===0||(be>it-80&&(L.addPage(),be=Te),L.setTextColor(...st),L.setFontSize(11),L.setFont("helvetica","bold"),L.text(Ve.toUpperCase(),Te,be),be+=5,vs(L,{startY:be,head:[["Date","Item","Qty","Unit","Rate","Total"]],body:at,margin:{left:Te,right:Te},headStyles:{fillColor:st,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{2:{halign:"center",cellWidth:20},3:{halign:"center",cellWidth:25},4:{halign:"right",cellWidth:25},5:{halign:"right",cellWidth:30}},foot:[["","","","","Subtotal:",`$${At.toFixed(2)}`]],footStyles:{fillColor:dt,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),be=L.lastAutoTable.finalY+10)};Object.keys(rt).length>0&&(L.setTextColor(...st),L.setFontSize(12),L.setFont("helvetica","bold"),L.text("MATERIALS & EQUIPMENT",Te,be),be+=8,ya.forEach(Ve=>{rt[Ve]&&Pa(Ve,rt[Ve],Xt[Ve])}),Object.keys(rt).forEach(Ve=>{ya.includes(Ve)||Pa(Ve,rt[Ve],Xt[Ve])}),L.setFillColor(...st),L.rect(Te,be,we-Te*2,12,"F"),L.setTextColor(255,255,255),L.setFontSize(10),L.setFont("helvetica","bold"),L.text("MATERIALS TOTAL:",Te+5,be+8),L.text(`$${qa.toFixed(2)}`,we-Te-5,be+8,{align:"right"}),be+=20),be>it-80&&(L.addPage(),be=Te),be+=10,L.setDrawColor(...st),L.setLineWidth(1),L.line(Te,be,we-Te,be),be+=15,L.setTextColor(...st),L.setFontSize(12),L.setFont("helvetica","bold"),L.text("AUTHORIZATION",Te,be),be+=10,L.setFontSize(10),L.setFont("helvetica","normal"),L.setTextColor(71,85,105),L.text("I hereby authorize the above time and materials charges as accurate and approved for billing.",Te,be),be+=20;const Zt=ticketsToExport[0]||{},ga=(Ve,at,At,Pt,S,re,Ne)=>{L.setFont("helvetica","bold"),L.setFontSize(8),L.setTextColor(...st),L.text(at,Te,Ve),L.setFont("helvetica","normal"),L.setFontSize(9),L.setTextColor(100,116,139);const le=Ve+18;if(L.setDrawColor(...dt),L.setLineWidth(.5),L.line(Te,le,Te+70,le),L.text("Signature",Te,le+8),L.line(Te+85,le,Te+145,le),L.text("Title / Company",Te+85,le+8),L.line(we-Te-40,le,we-Te,le),L.text("Date",we-Te-40,le+8),At)try{if(L.addImage(At,"PNG",Te,le-16,60,16),Pt&&(L.setFontSize(8),L.text(Pt,Te,le+15)),S||re){const Ge=[S,re].filter(Boolean).join(" - ");L.text(Ge,Te+85,le-5)}if(Ne){const Ge=new Date(Ne).toLocaleDateString();L.text(Ge,we-Te-40,le-5)}}catch(Ge){console.error("Error adding signature to PDF:",Ge)}return le+25};be=ga(be,"GC AUTHORIZATION",Zt.gc_signature_data,Zt.gc_signature_name,Zt.gc_signature_title,Zt.gc_signature_company,Zt.gc_signature_date),be+=8,be=ga(be,"CLIENT AUTHORIZATION",Zt.client_signature_data,Zt.client_signature_name,Zt.client_signature_title,Zt.client_signature_company,Zt.client_signature_date);const zt=L.internal.getNumberOfPages();for(let Ve=1;Ve<=zt;Ve++){L.setPage(Ve);const at=it-15;L.setFontSize(8),L.setTextColor(148,163,184),L.text(`${l?.name||"Company"} - T&M Report - ${r.name}`,Te,at),L.text(`Page ${Ve} of ${zt}`,we-Te,at,{align:"right"})}const Va=`${r.name}_TM_Report_${new Date().toISOString().split("T")[0]}.pdf`;L.save(Va),c("PDF exported!","success")},Mt=x.useMemo(()=>{let I=m==="all"?[...h]:h.filter(L=>L.status===m);if(q.start){const L=new Date(q.start);L.setHours(0,0,0,0),I=I.filter(we=>new Date(we.work_date)>=L)}if(q.end){const L=new Date(q.end);L.setHours(23,59,59,999),I=I.filter(we=>new Date(we.work_date)<=L)}if(C==="recent"){const L=new Date;L.setDate(L.getDate()-7),L.setHours(0,0,0,0),I=I.filter(we=>new Date(we.work_date)>=L)}return I},[h,m,C,q]),Gt=x.useMemo(()=>{if(C!=="all")return null;const I={};return Mt.forEach(L=>{const we=new Date(L.work_date),it=`${we.getFullYear()}-${String(we.getMonth()+1).padStart(2,"0")}`,Te=we.toLocaleDateString("en-US",{month:"long",year:"numeric"});I[it]||(I[it]={label:Te,tickets:[],hours:0,cost:0}),I[it].tickets.push(L),I[it].hours+=Le(L),I[it].cost+=ke(L)}),Object.entries(I).sort((L,we)=>we[0].localeCompare(L[0]))},[Mt,C]);x.useEffect(()=>{if(Gt&&Gt.length>0){const I=Gt[0][0];V(new Set([I]))}},[Gt]);const Dt=I=>{const L=new Set(X);L.has(I)?L.delete(I):L.add(I),V(L)},aa=Mt.reduce((I,L)=>I+Le(L),0),da=Mt.reduce((I,L)=>I+ke(L),0),St=m==="all"?h.length:h.filter(I=>I.status===m).length;if(p)return e.jsx("div",{className:"loading",children:"Loading T&M tickets..."});const We=Mt.length>0&&Mt.every(I=>j.has(I.id)),Ft=j.size>0,De=I=>{const L=!!F[I.id],we=F[I.id],it=!!de[I.id],Te=Fe===I.id;return e.jsxs("div",{className:`tm-ticket-card ${I.status} ${j.has(I.id)?"selected":""} ${L?"locked":""}`,children:[e.jsxs("div",{className:"tm-ticket-header",onClick:()=>_(A===I.id?null:I.id),children:[e.jsx("input",{type:"checkbox",checked:j.has(I.id),onChange:be=>Je(I.id,be),onClick:be=>be.stopPropagation(),className:"tm-checkbox"}),e.jsxs("div",{className:"tm-ticket-info",children:[e.jsx("span",{className:"tm-ticket-date",children:$e(I.work_date)}),I.ce_pco_number&&e.jsx("span",{className:"tm-ce-badge",children:I.ce_pco_number}),I.assigned_cor_id&&we?.lockedBy&&e.jsxs("span",{className:`tm-cor-badge ${L?"locked":""}`,title:we.reason,children:[L&&e.jsx(Pp,{size:10}),we.lockedBy.cor_number]}),I.photos?.length>0&&e.jsxs("span",{className:"tm-photo-badge",title:`${I.photos.length} photo${I.photos.length>1?"s":""}`,children:[e.jsx(Pn,{size:12})," ",I.photos.length]}),it&&e.jsxs("span",{className:"tm-import-failed-badge",title:"COR data import failed - retry needed",children:[e.jsx(Tr,{size:12})," Import Failed"]}),I.client_signature_data&&e.jsxs("span",{className:"tm-verified-badge",title:`Verified by ${I.client_signature_name||"client"}${I.client_signature_date?` on ${$e(I.client_signature_date)}`:""}`,children:[e.jsx(Ta,{size:12})," Verified"]}),e.jsx("span",{className:`tm-ticket-status ${I.status}`,children:I.status})]}),e.jsxs("div",{className:"tm-ticket-summary",children:[e.jsxs("span",{className:"tm-ticket-hours",children:[Le(I)," hrs"]}),e.jsxs("span",{className:"tm-ticket-total",children:["$",ke(I).toFixed(2)]}),e.jsx("span",{className:"tm-expand-arrow",children:A===I.id?"":""})]})]}),A===I.id&&e.jsxs("div",{className:"tm-ticket-details",children:[I.t_and_m_workers?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Da,{size:16,className:"inline-icon"})," Workers"]}),e.jsx("div",{className:"tm-detail-list",children:I.t_and_m_workers.map(be=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsxs("span",{children:[be.role&&be.role!=="Laborer"&&e.jsx("span",{className:"tm-role-badge",children:be.role}),be.name]}),e.jsxs("span",{children:[be.hours," hrs",parseFloat(be.overtime_hours)>0&&e.jsxs("span",{className:"tm-ot-badge",children:[" +",be.overtime_hours," OT"]})]})]},be.id))})]}),I.t_and_m_items?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(wl,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsx("div",{className:"tm-detail-list",children:I.t_and_m_items.map(be=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsx("span",{children:be.custom_name?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"tm-custom-badge",children:"Custom"})," ",be.custom_name]}):be.materials_equipment?.name}),e.jsxs("span",{className:"tm-detail-qty",children:[be.quantity," ",be.materials_equipment?.unit||"each",be.materials_equipment?.cost_per_unit>0&&e.jsxs("span",{className:"tm-item-cost",children:["$",(be.quantity*be.materials_equipment.cost_per_unit).toFixed(2)]})]})]},be.id))})]}),I.notes&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Oa,{size:16,className:"inline-icon"})," Description"]}),e.jsx("p",{className:"tm-notes-text",children:I.notes})]}),I.photos&&I.photos.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Pn,{size:16,className:"inline-icon"})," Photos (",I.photos.length,")"]}),e.jsx("div",{className:"tm-photos-grid",children:I.photos.map((be,st)=>e.jsx("a",{href:be,target:"_blank",rel:"noopener noreferrer",className:"tm-photo-thumb",children:e.jsx("img",{src:be,alt:`Photo ${st+1}`,onError:dt=>{dt.target.onerror=null,dt.target.classList.add("photo-error"),dt.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg==",console.error("Failed to load photo:",be)}})},st))})]}),I.ce_pco_number&&I.change_order_value>0&&e.jsxs("div",{className:"tm-change-order-value",children:[e.jsx("span",{className:"tm-co-label",children:"Change Order Value:"}),e.jsxs("span",{className:"tm-co-amount",children:["$",I.change_order_value.toLocaleString()]})]}),L&&e.jsxs("div",{className:"tm-lock-notice",children:[e.jsx(Pp,{size:14}),e.jsx("span",{children:we?.reason||"This ticket is locked (COR approved)"})]}),e.jsxs("div",{className:"tm-ticket-actions",children:[I.status==="pending"&&!L&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:be=>{be.stopPropagation(),qe(I)},children:"Approve"}),e.jsx("button",{className:"btn btn-warning btn-small",onClick:be=>{be.stopPropagation(),nt(I.id,"rejected")},children:"Reject"})]}),I.status==="approved"&&!L&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-primary btn-small",onClick:be=>{be.stopPropagation(),nt(I.id,"billed")},children:"Mark Billed"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:be=>{be.stopPropagation(),B(I),b(!0)},children:[e.jsx(Ud,{size:14})," Signature Link"]})]}),I.status==="rejected"&&!L&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:be=>{be.stopPropagation(),nt(I.id,"pending")},children:"Restore"}),!L&&e.jsxs("button",{className:`btn btn-small ${I.assigned_cor_id?"btn-ghost":"btn-secondary"}`,onClick:be=>{be.stopPropagation(),Ie(I)},title:I.assigned_cor_id?"Change COR link":"Link to Change Order",children:[e.jsx(ev,{size:14})," ",I.assigned_cor_id?"COR":"Link COR"]}),it&&!L&&e.jsxs("button",{className:"btn btn-warning btn-small",onClick:be=>ja(I,be),disabled:Te,title:"Retry syncing data to COR",children:[e.jsx(_f,{size:14,className:Te?"spin":""})," ",Te?"Syncing...":"Retry Sync"]}),!L&&e.jsx("button",{className:"btn btn-danger btn-small",onClick:be=>{be.stopPropagation(),Oe(I.id)},children:"Delete"})]})]})]},I.id)};return e.jsxs("div",{className:`tm-list ${i?"tm-list-compact":""}`,children:[!i&&e.jsxs("div",{className:"tm-list-header",children:[e.jsxs("div",{className:"tm-list-title",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("div",{className:"tm-export-buttons",children:[Ft&&e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:tt,children:["Clear (",j.size,")"]}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:bt,children:["Excel ",Ft?`(${j.size})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:kt,children:["PDF ",Ft?`(${j.size})`:""]})]})]}),e.jsx("div",{className:"tm-filter-tabs",children:["all","pending","approved","billed","rejected"].map(I=>e.jsxs("button",{className:`tm-filter-tab ${m===I?"active":""}`,onClick:()=>{v(I),tt()},children:[I.charAt(0).toUpperCase()+I.slice(1),e.jsx("span",{className:"tm-filter-count",children:I==="all"?h.length:h.filter(L=>L.status===I).length})]},I))}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${C==="recent"?"active":""}`,onClick:()=>{U("recent"),E({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${C==="all"?"active":""}`,onClick:()=>U("all"),children:["All (",St,")"]})]}),C==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Gn,{size:16}),e.jsx("input",{type:"date",value:q.start,onChange:I=>E(L=>({...L,start:I.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:q.end,onChange:I=>E(L=>({...L,end:I.target.value})),placeholder:"End date"}),(q.start||q.end)&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>E({start:"",end:""}),children:"Clear"})]})]})]}),!i&&Mt.length>0&&e.jsxs("div",{className:"tm-summary-bar",children:[e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Tickets"}),e.jsx("span",{className:"tm-summary-value",children:Mt.length})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Total Hours"}),e.jsx("span",{className:"tm-summary-value",children:aa.toFixed(1)})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Materials Cost"}),e.jsxs("span",{className:"tm-summary-value",children:["$",da.toFixed(2)]})]})]}),Mt.length===0?e.jsxs("div",{className:"tm-empty-state",children:[e.jsxs("p",{children:["No ",m==="all"?"":m," T&M tickets",C==="recent"?" in the last 7 days":""]}),C==="recent"&&St>0&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>U("all"),children:"View All Tickets"})]}):e.jsxs("div",{className:"tm-tickets",children:[e.jsx("div",{className:"tm-select-all-row",children:e.jsxs("label",{className:"tm-checkbox-label",onClick:et,children:[e.jsx("input",{type:"checkbox",checked:We,onChange:et,className:"tm-checkbox"}),e.jsxs("span",{children:["Select All (",Mt.length,")"]})]})}),C==="all"&&Gt?Gt.map(([I,L])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>Dt(I),children:[e.jsxs("div",{className:"month-header-left",children:[X.has(I)?e.jsx(Ma,{size:18}):e.jsx(Bs,{size:18}),e.jsx("span",{className:"month-label",children:L.label}),e.jsxs("span",{className:"month-count",children:[L.tickets.length," tickets"]})]}),e.jsxs("div",{className:"month-header-right",children:[e.jsxs("span",{className:"month-stat",children:[L.hours.toFixed(1)," hrs"]}),e.jsxs("span",{className:"month-stat",children:["$",L.cost.toFixed(2)]})]})]}),X.has(I)&&e.jsx("div",{className:"month-tickets",children:L.tickets.map(we=>De(we))})]},I)):Mt.map(I=>De(I))]}),W&&ae&&e.jsx("div",{className:"modal-overlay",onClick:()=>ue(!1),children:e.jsxs("div",{className:"modal change-order-modal",onClick:I=>I.stopPropagation(),children:[e.jsx("h3",{children:"Approve Change Order Work"}),e.jsxs("p",{className:"modal-subtitle",children:["This T&M ticket is associated with ",e.jsx("strong",{children:ae.ce_pco_number})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Change Order Value ($)"}),e.jsx("input",{type:"number",value:P,onChange:I=>ce(I.target.value),placeholder:"Enter the change order amount",autoFocus:!0}),e.jsx("p",{className:"form-help",children:"This amount will be added to the project's total contract value."})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>ue(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-success",onClick:J,children:["Approve with $",parseFloat(P||0).toLocaleString()]})]})]})}),M&&R&&e.jsx(Vd,{documentType:"tm_ticket",documentId:R.id,companyId:l?.id,projectId:r?.id,documentTitle:`T&M Ticket - ${new Date(R.work_date).toLocaleDateString()}${R.ce_pco_number?` (${R.ce_pco_number})`:""}`,onClose:()=>{b(!1),B(null)},onShowToast:c}),me&&ee&&e.jsx("div",{className:"modal-overlay",onClick:()=>T(!1),children:e.jsxs("div",{className:"modal cor-assign-modal",onClick:I=>I.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Link Ticket to Change Order"}),e.jsx("button",{className:"close-btn",onClick:()=>T(!1),children:e.jsx(Ra,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{className:"modal-subtitle",children:["Ticket: ",e.jsx("strong",{children:new Date(ee.work_date).toLocaleDateString()}),ee.ce_pco_number&&` (${ee.ce_pco_number})`]}),Z?e.jsx("div",{className:"loading",children:"Loading change orders..."}):pe.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No change orders found for this project."}),e.jsx("p",{className:"text-muted",children:"Create a COR first, then link tickets to it."})]}):e.jsxs("div",{className:"cor-select-wrapper",children:[e.jsx("label",{children:"Select Change Order:"}),e.jsxs("select",{value:z,onChange:I=>se(I.target.value),className:"cor-select",children:[e.jsx("option",{value:"",children:"-- No COR (unlink) --"}),pe.map(I=>e.jsxs("option",{value:I.id,children:[I.cor_number," - ",I.title||"Untitled"," (",I.status,")"]},I.id))]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>T(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:ft,disabled:Z||pe.length===0,children:ee.assigned_cor_id&&!z?"Unlink from COR":"Link to COR"})]})]})})]})}function hy({project:r,onClose:l,onShareCreated:c}){const{user:i}=Ef(),[d,h]=x.useState(!1),[g,p]=x.useState(null),[y,m]=x.useState([]),[v,A]=x.useState(!1),[_,j]=x.useState({progress:!0,photos:!0,daily_reports:!0,tm_tickets:!1,crew_info:!1}),[$,C]=x.useState("never"),[U,X]=x.useState("");x.useEffect(()=>{V()},[r.id]);const V=async()=>{try{const b=await K.getProjectShares(r.id);m(b)}catch(b){console.error("Error loading shares:",b)}},q=b=>{j(R=>({...R,[b]:!R[b]}))},E=()=>{if($==="never")return null;const b=new Date;if($==="30days")b.setDate(b.getDate()+30);else if($==="90days")b.setDate(b.getDate()+90);else if($==="custom"&&U)return new Date(U).toISOString();return b.toISOString()},W=async()=>{h(!0);try{const b=E(),R=await K.createProjectShare(r.id,i.id,_,b);p({type:"success",message:"Share link created!"}),A(!1),V(),c&&c(R)}catch(b){console.error("Error creating share:",b),p({type:"error",message:"Failed to create share link"})}finally{h(!1)}},ue=b=>{const R=`${window.location.origin}/view/${b}`;navigator.clipboard.writeText(R),p({type:"success",message:"Link copied to clipboard!"})},ae=async b=>{if(confirm("Are you sure you want to revoke this share link?"))try{await K.revokeProjectShare(b),p({type:"success",message:"Share link revoked"}),V()}catch(R){console.error("Error revoking share:",R),p({type:"error",message:"Failed to revoke share link"})}},Y=async b=>{if(confirm("Are you sure you want to permanently delete this share link?"))try{await K.deleteProjectShare(b),p({type:"success",message:"Share link deleted"}),V()}catch(R){console.error("Error deleting share:",R),p({type:"error",message:"Failed to delete share link"})}},P=b=>b?new Date(b).toLocaleDateString():"Never",ce=b=>b?new Date(b)<new Date:!1,M=b=>{const R=[];return b.progress&&R.push("Progress"),b.photos&&R.push("Photos"),b.daily_reports&&R.push("Reports"),b.tm_tickets&&R.push("T&M"),b.crew_info&&R.push("Crew"),R.join(", ")};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-overlay",onClick:l,children:e.jsxs("div",{className:"modal-content share-modal",onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Share Project: ",r.name]}),e.jsx("button",{className:"close-btn",onClick:l,children:""})]}),e.jsxs("div",{className:"modal-body",children:[y.length>0&&e.jsxs("div",{className:"existing-shares",children:[e.jsx("h3",{children:"Active Share Links"}),e.jsx("div",{className:"shares-list",children:y.map(b=>e.jsxs("div",{className:`share-item ${!b.is_active||ce(b.expires_at)?"inactive":""}`,children:[e.jsxs("div",{className:"share-info",children:[e.jsxs("div",{className:"share-token",children:[e.jsxs("code",{children:[window.location.origin,"/view/",b.share_token]}),e.jsx("button",{className:"btn-small",onClick:()=>ue(b.share_token),disabled:!b.is_active||ce(b.expires_at),children:"Copy"})]}),e.jsxs("div",{className:"share-meta",children:[e.jsx("span",{className:"permissions",children:M(b.permissions)}),e.jsxs("span",{className:"expiry",children:["Expires: ",P(b.expires_at)]}),e.jsxs("span",{className:"views",children:["Views: ",b.view_count||0,b.last_viewed_at&&` (Last: ${P(b.last_viewed_at)})`]})]}),!b.is_active&&e.jsx("div",{className:"status-badge revoked",children:"Revoked"}),ce(b.expires_at)&&b.is_active&&e.jsx("div",{className:"status-badge expired",children:"Expired"})]}),e.jsxs("div",{className:"share-actions",children:[b.is_active&&!ce(b.expires_at)&&e.jsx("button",{className:"btn-secondary",onClick:()=>ae(b.id),children:"Revoke"}),e.jsx("button",{className:"btn-danger",onClick:()=>Y(b.id),children:"Delete"})]})]},b.id))})]}),!v&&e.jsx("button",{className:"btn-primary",onClick:()=>A(!0),children:"+ Create New Share Link"}),v&&e.jsxs("div",{className:"new-share-form",children:[e.jsx("h3",{children:"Create New Share Link"}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Permissions"}),e.jsxs("div",{className:"checkbox-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:_.progress,onChange:()=>q("progress")}),"Progress/completion status"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:_.photos,onChange:()=>q("photos")}),"Photos feed"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:_.daily_reports,onChange:()=>q("daily_reports")}),"Daily reports"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:_.tm_tickets,onChange:()=>q("tm_tickets")}),"T&M tickets"]}),e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:_.crew_info,onChange:()=>q("crew_info")}),"Crew information"]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{children:"Link Expiration"}),e.jsxs("div",{className:"radio-group",children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"never",checked:$==="never",onChange:b=>C(b.target.value)}),"Never expires"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"30days",checked:$==="30days",onChange:b=>C(b.target.value)}),"30 days"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"90days",checked:$==="90days",onChange:b=>C(b.target.value)}),"90 days"]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",value:"custom",checked:$==="custom",onChange:b=>C(b.target.value)}),"Custom date"]})]}),$==="custom"&&e.jsx("input",{type:"date",value:U,onChange:b=>X(b.target.value),min:new Date().toISOString().split("T")[0],className:"date-input"})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:()=>A(!1),children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:W,disabled:d,children:d?"Generating...":"Generate Share Link"})]})]})]})]})}),g&&e.jsx(Ls,{message:g.message,type:g.type,onClose:()=>p(null)}),e.jsx("style",{children:`
        .share-modal {
          max-width: 700px;
          max-height: 80vh;
          overflow-y: auto;
        }

        .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1.5rem;
          border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .close-btn {
          background: none;
          border: none;
          font-size: 2rem;
          cursor: pointer;
          color: var(--text-secondary);
          padding: 0;
          width: 2rem;
          height: 2rem;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .close-btn:hover {
          color: var(--text-primary);
        }

        .modal-body {
          padding: 1.5rem;
        }

        .existing-shares {
          margin-bottom: 2rem;
        }

        .existing-shares h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.1rem;
          color: var(--text-primary);
        }

        .shares-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .share-item {
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          gap: 1rem;
          background: var(--bg-card);
        }

        .share-item.inactive {
          opacity: 0.6;
          background-color: var(--bg-elevated);
        }

        .share-info {
          flex: 1;
        }

        .share-token {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          margin-bottom: 0.5rem;
        }

        .share-token code {
          background-color: var(--bg-elevated);
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.875rem;
          flex: 1;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
          color: var(--text-primary);
        }

        .share-meta {
          display: flex;
          flex-wrap: wrap;
          gap: 1rem;
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .status-badge {
          display: inline-block;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 500;
          margin-top: 0.5rem;
        }

        .status-badge.revoked {
          background-color: #fee2e2;
          color: #991b1b;
        }

        .status-badge.expired {
          background-color: #fef3c7;
          color: #92400e;
        }

        .share-actions {
          display: flex;
          gap: 0.5rem;
          flex-shrink: 0;
        }

        .new-share-form {
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          background-color: var(--bg-elevated);
        }

        .new-share-form h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          font-size: 1.1rem;
          color: var(--text-primary);
        }

        .form-section {
          margin-bottom: 1.5rem;
        }

        .form-section label {
          display: block;
          font-weight: 500;
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .checkbox-group,
        .radio-group {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .checkbox-group label,
        .radio-group label {
          font-weight: normal;
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .checkbox-group input[type="checkbox"],
        .radio-group input[type="radio"] {
          margin: 0;
        }

        .date-input {
          margin-top: 0.5rem;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          width: 100%;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-actions {
          display: flex;
          justify-content: flex-end;
          gap: 0.5rem;
          margin-top: 1.5rem;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
          border: 1px solid var(--border-color);
          background-color: var(--bg-card);
          color: var(--text-primary);
          border-radius: 4px;
          cursor: pointer;
        }

        .btn-small:hover:not(:disabled) {
          background-color: var(--bg-elevated);
        }

        .btn-small:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }
      `})]})}const jd=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},py=r=>new Promise(l=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>{const i=document.createElement("canvas");i.width=c.width,i.height=c.height,i.getContext("2d").drawImage(c,0,0),l(i.toDataURL("image/png"))},c.onerror=()=>l(null),c.src=r});function fy({project:r,companyId:l,company:c,onShowToast:i}){const{branding:d}=Dr(),[h,g]=x.useState([]),[p,y]=x.useState(null),[m,v]=x.useState(!1),[A,_]=x.useState(!0),[j,$]=x.useState(null),[C,U]=x.useState("recent"),[X,V]=x.useState(new Set),[q,E]=x.useState({start:"",end:""});x.useEffect(()=>{W();const k=l||r?.company_id,pe=k?K.subscribeToInjuryReports?.(k,()=>{W()}):null;return()=>{pe&&K.unsubscribe?.(pe)}},[r?.id,l]);const W=async()=>{_(!0);try{const k=r?await K.getInjuryReports(r.id):await K.getCompanyInjuryReports(l);g(k)}catch(k){console.error("Error loading injury reports:",k),$({type:"error",message:"Failed to load injury reports"})}finally{_(!1)}},ue=()=>{W(),v(!1),$({type:"success",message:"Injury report created successfully"})},ae=k=>{y(k)},Y=()=>{y(null)},P=k=>k?new Date(k).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",ce=k=>k?new Date(`2000-01-01T${k}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",M=k=>({minor:"Minor Injury",serious:"Serious Injury",critical:"Critical Injury",near_miss:"Near Miss"})[k]||k,b=k=>({reported:"#fbbf24",under_investigation:"#3b82f6",closed:"#10b981"})[k]||"#9ca3af",R=k=>({minor:"#10b981",serious:"#f59e0b",critical:"#ef4444",near_miss:"#6b7280"})[k]||"#9ca3af",B=x.useMemo(()=>{let k=[...h];if(q.start){const pe=new Date(q.start);pe.setHours(0,0,0,0),k=k.filter(D=>new Date(D.incident_date)>=pe)}if(q.end){const pe=new Date(q.end);pe.setHours(23,59,59,999),k=k.filter(D=>new Date(D.incident_date)<=pe)}if(C==="recent"){const pe=new Date;pe.setDate(pe.getDate()-7),pe.setHours(0,0,0,0),k=k.filter(D=>new Date(D.incident_date)>=pe)}return k},[h,C,q]),me=x.useMemo(()=>{if(C!=="all")return null;const k={};return B.forEach(pe=>{const D=new Date(pe.incident_date),z=`${D.getFullYear()}-${String(D.getMonth()+1).padStart(2,"0")}`,se=D.toLocaleDateString("en-US",{month:"long",year:"numeric"});k[z]||(k[z]={label:se,reports:[]}),k[z].reports.push(pe)}),Object.entries(k).sort((pe,D)=>D[0].localeCompare(pe[0]))},[B,C]);x.useEffect(()=>{if(me&&me.length>0){const k=me[0][0];V(new Set([k]))}},[me]);const T=k=>{const pe=new Set(X);pe.has(k)?pe.delete(k):pe.add(k),V(pe)},ee=async()=>{if(h.length===0){$({type:"error",message:"No reports to export"});return}$({type:"info",message:"Generating PDF..."});const k=new Sl,pe=k.internal.pageSize.getWidth(),D=20;let z=D;const se=jd(d?.primary_color||"#3B82F6"),Z=jd(d?.secondary_color||"#1E40AF");k.setFillColor(...se),k.rect(0,0,pe,45,"F"),k.setFillColor(...Z),k.rect(0,42,pe,3,"F");let ne=D;if(d?.logo_url)try{const de=await py(d.logo_url);de&&(k.addImage(de,"PNG",D,7,30,30),ne=D+40)}catch(de){console.error("Error adding logo:",de)}k.setTextColor(255,255,255),k.setFontSize(22),k.setFont("helvetica","bold"),k.text(c?.name||"Company",ne,20),k.setFontSize(10),k.setFont("helvetica","normal"),k.text("INJURY & INCIDENT REPORTS",ne,30),k.setFontSize(9),k.text(`Generated: ${new Date().toLocaleDateString()}`,pe-D,20,{align:"right"}),k.text(`Total Reports: ${h.length}`,pe-D,28,{align:"right"}),z=55,r&&(k.setFillColor(248,250,252),k.rect(D,z-5,pe-D*2,15,"F"),k.setTextColor(...se),k.setFontSize(12),k.setFont("helvetica","bold"),k.text(`Project: ${r.name}`,D+5,z+5),z+=20),h.forEach(de=>{z>200&&(k.addPage(),z=D);const ye=jd(R(de.injury_type));k.setFillColor(...ye),k.rect(D,z,pe-D*2,12,"F"),k.setTextColor(255,255,255),k.setFontSize(11),k.setFont("helvetica","bold"),k.text(`${de.employee_name} - ${M(de.injury_type)}`,D+5,z+8),k.text(P(de.incident_date),pe-D-5,z+8,{align:"right"}),z+=17,k.setTextColor(50,50,50),k.setFontSize(9),k.setFont("helvetica","normal"),k.text(`Location: ${de.incident_location}`,D+5,z),de.incident_time&&k.text(`Time: ${ce(de.incident_time)}`,D+100,z),z+=6,k.setFont("helvetica","bold"),k.text("Description:",D+5,z),k.setFont("helvetica","normal"),z+=5;const Fe=k.splitTextToSize(de.incident_description,pe-D*2-10);k.text(Fe,D+5,z),z+=Fe.length*4+3;const ze=[];de.body_part_affected&&ze.push(`Body Part: ${de.body_part_affected}`),de.osha_recordable&&ze.push("OSHA Recordable"),de.workers_comp_claim&&ze.push("Workers' Comp Filed"),de.medical_treatment_required&&ze.push("Medical Treatment Required"),ze.length>0&&(k.setFontSize(8),k.setTextColor(100,100,100),k.text(ze.join("  |  "),D+5,z),z+=5),k.setFontSize(8),k.text(`Reported by: ${de.reported_by_name} (${de.reported_by_title})`,D+5,z),z+=12});const F=k.internal.getNumberOfPages();for(let de=1;de<=F;de++)k.setPage(de),k.setFontSize(8),k.setTextColor(150,150,150),k.text(`Page ${de} of ${F}`,pe/2,k.internal.pageSize.getHeight()-10,{align:"center"}),k.text("CONFIDENTIAL - Injury Report",D,k.internal.pageSize.getHeight()-10);const fe=`Injury_Reports_${new Date().toISOString().split("T")[0]}.pdf`;k.save(fe),$({type:"success",message:"PDF exported!"})};return A?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading injury reports..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"injury-reports-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Injury & Incident Reports"}),e.jsxs("div",{className:"section-header-actions",children:[h.length>0&&e.jsx("button",{className:"btn-secondary",onClick:ee,children:"PDF"}),e.jsx("button",{className:"btn-primary",onClick:()=>v(!0),children:"+ File Injury Report"})]})]}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${C==="recent"?"active":""}`,onClick:()=>{U("recent"),E({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${C==="all"?"active":""}`,onClick:()=>U("all"),children:["All (",h.length,")"]})]}),C==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Gn,{size:16}),e.jsx("input",{type:"date",value:q.start,onChange:k=>E(pe=>({...pe,start:k.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:q.end,onChange:k=>E(pe=>({...pe,end:k.target.value})),placeholder:"End date"}),(q.start||q.end)&&e.jsx("button",{className:"btn-ghost",onClick:()=>E({start:"",end:""}),children:"Clear"})]})]}),B.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:""}),e.jsxs("h4",{children:["No Injury Reports",C==="recent"?" in the last 7 days":""]}),e.jsx("p",{children:'Click "File Injury Report" to document a workplace incident'}),C==="recent"&&h.length>0&&e.jsx("button",{className:"btn-secondary",onClick:()=>U("all"),children:"View All Reports"})]}):e.jsx("div",{className:"reports-list",children:C==="all"&&me?me.map(([k,pe])=>e.jsxs("div",{className:"month-group",children:[e.jsx("div",{className:"month-header",onClick:()=>T(k),children:e.jsxs("div",{className:"month-header-left",children:[X.has(k)?e.jsx(Ma,{size:18}):e.jsx(Bs,{size:18}),e.jsx("span",{className:"month-label",children:pe.label}),e.jsxs("span",{className:"month-count",children:[pe.reports.length," reports"]})]})}),X.has(k)&&e.jsx("div",{className:"month-reports",children:pe.reports.map(D=>e.jsxs("div",{className:"report-card",onClick:()=>ae(D),children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[P(D.incident_date)," at ",ce(D.incident_time)]}),e.jsx("div",{className:"employee-name",children:D.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:R(D.injury_type)},children:M(D.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:b(D.status)},children:D.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",D.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",D.reported_by_name," (",D.reported_by_title,")"]}),D.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",D.body_part_affected]}),D.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[D.incident_description.substring(0,150),D.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]},D.id))})]},k)):B.map(k=>e.jsxs("div",{className:"report-card",onClick:()=>ae(k),children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[P(k.incident_date)," at ",ce(k.incident_time)]}),e.jsx("div",{className:"employee-name",children:k.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:R(k.injury_type)},children:M(k.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:b(k.status)},children:k.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",k.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",k.reported_by_name," (",k.reported_by_title,")"]}),k.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",k.body_part_affected]}),k.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[k.incident_description.substring(0,150),k.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]},k.id))}),p&&e.jsx("div",{className:"modal-overlay",onClick:Y,children:e.jsxs("div",{className:"modal-content report-details-modal",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Injury Report Details"}),e.jsx("button",{className:"close-btn",onClick:Y,children:""})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Incident Information"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Date & Time"}),e.jsxs("div",{children:[P(p.incident_date)," at ",ce(p.incident_time)]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Location"}),e.jsx("div",{children:p.incident_location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Injury Type"}),e.jsx("div",{children:e.jsx("span",{className:"badge",style:{backgroundColor:R(p.injury_type)},children:M(p.injury_type)})})]}),p.body_part_affected&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("div",{children:p.body_part_affected})]})]}),e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("div",{className:"description-box",children:p.incident_description})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Injured Employee"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:p.employee_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Job Title"}),e.jsx("div",{children:p.employee_job_title})]}),p.employee_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:p.employee_phone})]}),p.employee_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:p.employee_email})]}),p.employee_address&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:p.employee_address})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Reported By"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:p.reported_by_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Title"}),e.jsx("div",{children:p.reported_by_title})]}),p.reported_by_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:p.reported_by_phone})]}),p.reported_by_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:p.reported_by_email})]})]})]}),p.witnesses&&p.witnesses.length>0&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Witnesses"}),p.witnesses.map((k,pe)=>e.jsxs("div",{className:"witness-card",children:[e.jsxs("div",{className:"witness-header",children:[e.jsx("strong",{children:k.name}),k.phone&&e.jsxs("span",{children:["  ",k.phone]}),k.email&&e.jsxs("span",{children:["  ",k.email]})]}),k.testimony&&e.jsx("div",{className:"witness-testimony",children:e.jsxs("em",{children:['"',k.testimony,'"']})})]},pe))]}),p.medical_treatment_required&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Medical Treatment"}),e.jsxs("div",{className:"detail-grid",children:[p.medical_facility_name&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Facility"}),e.jsx("div",{children:p.medical_facility_name})]}),p.medical_facility_address&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:p.medical_facility_address})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Hospitalized"}),e.jsx("div",{children:p.hospitalized?"Yes":"No"})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Actions & Safety"}),p.immediate_actions_taken&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("div",{className:"description-box",children:p.immediate_actions_taken})]}),p.corrective_actions_planned&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("div",{className:"description-box",children:p.corrective_actions_planned})]}),e.jsxs("div",{className:"detail-grid",children:[p.safety_equipment_used&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("div",{children:p.safety_equipment_used})]}),p.safety_equipment_failed&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("div",{children:p.safety_equipment_failed})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Regulatory & Work Impact"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"OSHA Recordable"}),e.jsx("div",{children:p.osha_recordable?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Workers' Comp Claim"}),e.jsx("div",{children:p.workers_comp_claim?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("div",{children:p.days_away_from_work||0})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("div",{children:p.restricted_work_days||0})]})]})]}),e.jsxs("div",{className:"report-meta",children:["Filed on ",P(p.created_at)]})]})]})}),m&&e.jsx(Df,{project:r,companyId:l,onClose:()=>v(!1),onReportCreated:ue}),j&&e.jsx(Ls,{message:j.message,type:j.type,onClose:()=>$(null)})]}),e.jsx("style",{children:`
        .injury-reports-section {
          margin-top: 2rem;
        }

        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
        }

        .section-header h3 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .view-mode-bar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1rem;
          padding: 0.75rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          flex-wrap: wrap;
        }

        .view-mode-tabs {
          display: flex;
          gap: 0.5rem;
        }

        .view-mode-tab {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          cursor: pointer;
          background: transparent;
          color: var(--text-secondary);
          transition: all 0.2s;
        }

        .view-mode-tab:hover {
          background: var(--bg-tertiary);
        }

        .view-mode-tab.active {
          background: var(--primary-color, #3b82f6);
          color: white;
        }

        .date-filter {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: var(--text-secondary);
        }

        .date-filter input[type="date"] {
          padding: 0.4rem 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 0.875rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .btn-ghost {
          background: transparent;
          border: none;
          padding: 0.4rem 0.75rem;
          color: var(--text-secondary);
          cursor: pointer;
          border-radius: 4px;
          font-size: 0.875rem;
        }

        .btn-ghost:hover {
          background: var(--bg-tertiary);
        }

        .month-group {
          margin-bottom: 0.5rem;
        }

        .month-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 1rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }

        .month-header:hover {
          background: var(--bg-tertiary);
        }

        .month-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .month-label {
          font-weight: 600;
          color: var(--text-primary);
        }

        .month-count {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .month-reports {
          margin-top: 0.5rem;
          padding-left: 0.5rem;
        }

        .reports-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .report-card {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .report-card:hover {
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
          border-color: var(--accent-primary);
        }

        .report-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 1rem;
        }

        .report-date {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .employee-name {
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text-primary);
        }

        .report-badges {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
        }

        .badge {
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 500;
          color: white;
          text-transform: capitalize;
        }

        .osha-badge {
          background-color: #dc2626;
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 600;
        }

        .report-summary {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 0.75rem;
          margin-bottom: 1rem;
          padding: 1rem;
          background-color: var(--bg-elevated);
          border-radius: 6px;
        }

        .summary-item {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .summary-item strong {
          color: var(--text-primary);
        }

        .report-description {
          color: var(--text-secondary);
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .report-footer {
          text-align: right;
          font-size: 0.875rem;
          color: var(--primary-color, #3b82f6);
        }

        .report-details-modal {
          max-width: 900px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .details-section {
          margin-bottom: 2rem;
          padding-bottom: 2rem;
          border-bottom: 1px solid var(--border-color);
        }

        .details-section:last-child {
          border-bottom: none;
        }

        .details-section h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.125rem;
          color: var(--text-primary);
        }

        .detail-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }

        .detail-item label {
          display: block;
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .detail-item div {
          color: var(--text-primary);
        }

        .detail-item.full-width {
          grid-column: 1 / -1;
        }

        .description-box {
          background-color: var(--bg-elevated);
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          white-space: pre-wrap;
          line-height: 1.6;
          color: var(--text-primary);
        }

        .witness-card {
          background-color: var(--bg-elevated);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
        }

        .witness-header {
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .witness-testimony {
          color: var(--text-secondary);
          font-size: 0.875rem;
          padding-left: 1rem;
          border-left: 3px solid var(--border-color);
        }

        .report-meta {
          text-align: center;
          font-size: 0.875rem;
          color: var(--text-secondary);
          padding-top: 1rem;
          border-top: 1px solid var(--border-color);
        }

        .empty-state {
          text-align: center;
          padding: 3rem 1rem;
        }

        .empty-state-icon {
          font-size: 3rem;
          margin-bottom: 1rem;
        }

        .empty-state h4 {
          margin: 0 0 0.5rem 0;
          color: var(--text-primary);
        }

        .empty-state p {
          margin: 0;
          color: var(--text-secondary);
        }

        .section-header-actions {
          display: flex;
          gap: 0.5rem;
          align-items: center;
        }

        .btn-primary, .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-primary:hover, .btn-secondary:hover {
          opacity: 0.9;
        }

        .loading-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 3rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid var(--border-color);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .report-header {
            flex-direction: column;
            gap: 0.5rem;
          }

          .report-summary {
            grid-template-columns: 1fr;
          }

          .detail-grid {
            grid-template-columns: 1fr;
          }

          .report-details-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }
        }
      `})]})}const vd=[{id:"message",label:"Messages",Icon:bf,description:"Chat messages from field"},{id:"material_request",label:"Material Requests",Icon:Hs,description:"Equipment and material requests"},{id:"injury_report",label:"Safety Reports",Icon:vn,description:"Injury and safety incident reports"},{id:"tm_ticket",label:"T&M Tickets",Icon:cs,description:"Time and materials tickets"}];function gy({project:r,company:l,onShowToast:c,onClose:i}){const[d,h]=x.useState([]),[g,p]=x.useState({}),[y,m]=x.useState([]),[v,A]=x.useState(!0),[_,j]=x.useState(!1);x.useEffect(()=>{$()},[r?.id,l?.id]);const $=async()=>{if(!(!r?.id||!l?.id))try{A(!0);const q=await K.getCompanyUsers(l.id);h(q);const E=await K.getProjectNotificationPreferences(r.id),W={};E.forEach(ae=>{W[ae.user_id]={types:ae.notification_types||[],presetId:null}}),p(W);const ue=await K.getNotificationPresets(l.id);m(ue)}catch(q){console.error("Error loading notification settings:",q),c?.("Error loading notification settings","error")}finally{A(!1)}},C=(q,E)=>{p(W=>{const ue=W[q]||{types:[]},ae=ue.types.includes(E)?ue.types.filter(Y=>Y!==E):[...ue.types,E];return{...W,[q]:{types:ae,presetId:null}}})},U=(q,E)=>{const W=y.find(ue=>ue.id===E);W&&p(ue=>({...ue,[q]:{types:[...W.notification_types],presetId:E}}))},X=(q,E)=>{p(W=>({...W,[q]:{types:E?vd.map(ue=>ue.id):[],presetId:null}}))},V=async()=>{try{j(!0);const q=Object.entries(g).map(([E,W])=>({userId:E,notificationTypes:W.types}));await K.setProjectNotificationPreferences(r.id,q),c?.("Notification settings saved","success"),i?.()}catch(q){console.error("Error saving notification settings:",q),c?.("Error saving notification settings","error")}finally{j(!1)}};return v?e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsx("h3",{children:"Notification Settings"}),e.jsx("button",{className:"close-btn",onClick:i,children:""})]}),e.jsx("div",{className:"loading-message",children:"Loading..."})]}):e.jsxs("div",{className:"notification-settings",children:[e.jsxs("div",{className:"notification-settings-header",children:[e.jsxs("h3",{children:["Notification Settings for ",r?.name]}),e.jsx("button",{className:"close-btn",onClick:i,children:""})]}),e.jsx("p",{className:"settings-description",children:"Choose who receives notifications when field workers send messages, request materials, submit safety reports, or create T&M tickets for this project."}),d.length===0?e.jsxs("div",{className:"no-users-message",children:[e.jsx("p",{children:"No users found in this company."}),e.jsx("small",{children:"Users need to be added to the company to receive notifications."})]}):e.jsx("div",{className:"notification-users-list",children:d.map(q=>{const E=g[q.id]||{types:[],presetId:null},W=E.types.length===vd.length,ue=E.types.length>0&&!W;return e.jsxs("div",{className:"notification-user-row",children:[e.jsxs("div",{className:"user-info",children:[e.jsx("div",{className:"user-avatar",children:q.name?.charAt(0).toUpperCase()||q.email?.charAt(0).toUpperCase()}),e.jsxs("div",{className:"user-details",children:[e.jsx("span",{className:"user-name",children:q.name||q.email}),q.role&&e.jsx("span",{className:"user-role",children:q.role})]})]}),e.jsxs("div",{className:"notification-controls",children:[e.jsxs("select",{className:"preset-select",value:E.presetId||"",onChange:ae=>ae.target.value&&U(q.id,ae.target.value),children:[e.jsx("option",{value:"",children:"Apply preset..."}),y.map(ae=>e.jsx("option",{value:ae.id,children:ae.name},ae.id))]}),e.jsx("button",{className:`toggle-all-btn ${W?"all-on":ue?"some-on":""}`,onClick:()=>X(q.id,!W),title:W?"Disable all":"Enable all",children:W?"All On":ue?"Some":"None"})]}),e.jsx("div",{className:"notification-types",children:vd.map(ae=>e.jsxs("label",{className:`notification-type-toggle ${E.types.includes(ae.id)?"active":""}`,title:ae.description,children:[e.jsx("input",{type:"checkbox",checked:E.types.includes(ae.id),onChange:()=>C(q.id,ae.id)}),e.jsx("span",{className:"type-icon",children:e.jsx(ae.Icon,{size:16})}),e.jsx("span",{className:"type-label",children:ae.label})]},ae.id))})]},q.id)})}),e.jsxs("div",{className:"notification-settings-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:i,children:"Cancel"}),e.jsx("button",{className:"btn-primary",onClick:V,disabled:_,children:_?"Saving...":"Save Settings"})]})]})}const Qp=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},xy=r=>new Promise(l=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>{const i=document.createElement("canvas");i.width=c.width,i.height=c.height,i.getContext("2d").drawImage(c,0,0),l(i.toDataURL("image/png"))},c.onerror=()=>l(null),c.src=r});function jy({project:r,company:l,onShowToast:c}){const{branding:i}=Dr(),[d,h]=x.useState([]),[g,p]=x.useState(!0),[y,m]=x.useState(null),[v,A]=x.useState(new Set),[_,j]=x.useState(!1),[$,C]=x.useState("recent"),[U,X]=x.useState(new Set),[V,q]=x.useState({start:"",end:""});x.useEffect(()=>{E();const D=K.subscribeToDailyReports?.(r.id,()=>{E()});return()=>{D&&K.unsubscribe?.(D)}},[r.id]);const E=async()=>{try{const D=await K.getDailyReports(r.id,365);h(D||[])}catch(D){console.error("Error loading daily reports:",D),c?.("Error loading daily reports","error")}finally{p(!1)}},W=x.useMemo(()=>{let D=[...d];if(V.start){const z=new Date(V.start);z.setHours(0,0,0,0),D=D.filter(se=>new Date(se.report_date||se.created_at)>=z)}if(V.end){const z=new Date(V.end);z.setHours(23,59,59,999),D=D.filter(se=>new Date(se.report_date||se.created_at)<=z)}if($==="recent"){const z=new Date;z.setDate(z.getDate()-7),z.setHours(0,0,0,0),D=D.filter(se=>new Date(se.report_date||se.created_at)>=z)}return D},[d,$,V]),ue=x.useMemo(()=>{if($!=="all")return null;const D={};return W.forEach(z=>{const se=new Date(z.report_date||z.created_at),Z=`${se.getFullYear()}-${String(se.getMonth()+1).padStart(2,"0")}`,ne=se.toLocaleDateString("en-US",{month:"long",year:"numeric"});D[Z]||(D[Z]={label:ne,reports:[]}),D[Z].reports.push(z)}),Object.entries(D).sort((z,se)=>se[0].localeCompare(z[0]))},[W,$]);x.useEffect(()=>{if(ue&&ue.length>0){const D=ue[0][0];X(new Set([D]))}},[ue]);const ae=()=>{j(!_),_&&A(new Set)},Y=D=>{const z=new Set(v);z.has(D)?z.delete(D):z.add(D),A(z)},P=()=>{v.size===W.length?A(new Set):A(new Set(W.map(D=>D.id)))},ce=D=>{const z=new Set(U);z.has(D)?z.delete(D):z.add(D),X(z)},M=()=>v.size>0?W.filter(D=>v.has(D.id)):W,b=D=>new Date(D).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),R=D=>new Date(D).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),B=D=>{switch(D){case"submitted":return"";case"reviewed":return"";case"draft":return"";default:return""}},me=D=>{switch(D){case"submitted":return"Submitted";case"reviewed":return"Reviewed";case"draft":return"Draft";default:return D}},T=async()=>{const D=M();if(D.length===0){c?.("No reports to export","error");return}c?.("Generating PDF...","info");const z=new Sl,se=z.internal.pageSize.getWidth(),Z=20;let ne=Z;const F=Qp(i?.primary_color||"#3B82F6"),fe=Qp(i?.secondary_color||"#1E40AF");z.setFillColor(...F),z.rect(0,0,se,45,"F"),z.setFillColor(...fe),z.rect(0,42,se,3,"F");let de=Z;if(i?.logo_url)try{const ze=await xy(i.logo_url);ze&&(z.addImage(ze,"PNG",Z,7,30,30),de=Z+40)}catch(ze){console.error("Error adding logo:",ze)}z.setTextColor(255,255,255),z.setFontSize(22),z.setFont("helvetica","bold"),z.text(l?.name||"Company Name",de,20),z.setFontSize(10),z.setFont("helvetica","normal"),z.text("DAILY REPORTS SUMMARY",de,30),z.setFontSize(9),z.text(`Generated: ${new Date().toLocaleDateString()}`,se-Z,20,{align:"right"}),r.job_number&&z.text(`Job #: ${r.job_number}`,se-Z,28,{align:"right"}),ne=55,z.setFillColor(248,250,252),z.rect(Z,ne-5,se-Z*2,20,"F"),z.setTextColor(...F),z.setFontSize(14),z.setFont("helvetica","bold"),z.text(`Project: ${r.name}`,Z+5,ne+7),z.setFontSize(10),z.setTextColor(100,100,100),z.text(`${D.length} Report${D.length!==1?"s":""}`,se-Z-5,ne+7,{align:"right"}),ne+=25,D.forEach((ze,Me)=>{ne>250&&(z.addPage(),ne=Z),z.setFillColor(...F),z.setTextColor(255,255,255),z.rect(Z,ne,se-Z*2,10,"F"),z.setFontSize(11),z.setFont("helvetica","bold"),z.text(b(ze.report_date||ze.created_at),Z+5,ne+7),z.text(me(ze.status),se-Z-5,ne+7,{align:"right"}),ne+=15,z.setTextColor(50,50,50),z.setFontSize(10),z.setFont("helvetica","normal");const nt=`Crew: ${ze.crew_count||0}  |  Tasks: ${ze.tasks_completed||0}  |  T&M: ${ze.tm_tickets_count||0}  |  Photos: ${ze.photos_count||0}`;if(z.text(nt,Z+5,ne),ne+=8,ze.crew_list?.length>0){z.setFont("helvetica","bold"),z.text("Crew:",Z+5,ne),z.setFont("helvetica","normal");const qe=ze.crew_list.map(Oe=>`${Oe.name} (${Oe.role})`).join(", "),J=z.splitTextToSize(qe,se-Z*2-30);z.text(J,Z+25,ne),ne+=J.length*5+3}if(ze.field_notes){z.setFont("helvetica","bold"),z.text("Notes:",Z+5,ne),z.setFont("helvetica","normal");const qe=z.splitTextToSize(ze.field_notes,se-Z*2-30);z.text(qe,Z+25,ne),ne+=qe.length*5+3}if(ze.issues){z.setTextColor(180,50,50),z.setFont("helvetica","bold"),z.text("Issues:",Z+5,ne),z.setFont("helvetica","normal");const qe=z.splitTextToSize(ze.issues,se-Z*2-30);z.text(qe,Z+25,ne),z.setTextColor(50,50,50),ne+=qe.length*5+3}ne+=10});const ye=z.internal.getNumberOfPages();for(let ze=1;ze<=ye;ze++)z.setPage(ze),z.setFontSize(8),z.setTextColor(150,150,150),z.text(`Page ${ze} of ${ye}`,se/2,z.internal.pageSize.getHeight()-10,{align:"center"});const Fe=`${r.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;z.save(Fe),c?.("PDF exported!","success")},ee=D=>e.jsxs("div",{className:`daily-report-card ${D.status} ${v.has(D.id)?"selected":""}`,children:[e.jsxs("div",{className:"daily-report-header-row",onClick:()=>m(y===D.id?null:D.id),children:[_&&e.jsx("input",{type:"checkbox",className:"report-checkbox",checked:v.has(D.id),onChange:z=>{z.stopPropagation(),Y(D.id)},onClick:z=>z.stopPropagation()}),e.jsxs("div",{className:"daily-report-info",children:[e.jsx("span",{className:"report-date",children:b(D.report_date||D.created_at)}),e.jsxs("span",{className:`report-status ${D.status}`,children:[B(D.status)," ",me(D.status)]})]}),e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("span",{className:"report-crew",children:[D.crew_count||0," crew"]}),e.jsxs("span",{className:"report-tasks",children:[D.tasks_completed||0," tasks"]}),e.jsx("span",{className:"report-expand",children:y===D.id?"":""})]})]}),y===D.id&&e.jsxs("div",{className:"daily-report-details",children:[e.jsxs("div",{className:"report-stats-grid",children:[e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:D.crew_count||0}),e.jsx("span",{className:"stat-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:D.tasks_completed||0}),e.jsx("span",{className:"stat-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:D.tm_tickets_count||0}),e.jsx("span",{className:"stat-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:D.photos_count||0}),e.jsx("span",{className:"stat-label",children:"Photos"})]})]}),D.crew_list?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Crew"}),e.jsx("div",{className:"report-crew-list",children:D.crew_list.map((z,se)=>e.jsxs("div",{className:"crew-member",children:[e.jsx("span",{className:"crew-name",children:z.name}),e.jsx("span",{className:"crew-role",children:z.role})]},se))})]}),D.completed_tasks?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Completed Today"}),e.jsx("ul",{className:"report-tasks-list",children:D.completed_tasks.map((z,se)=>e.jsxs("li",{children:[z.name,z.group&&e.jsx("span",{className:"task-group",children:z.group})]},se))})]}),D.field_notes&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Field Notes"}),e.jsx("p",{className:"report-notes",children:D.field_notes})]}),D.issues&&e.jsxs("div",{className:"report-section issues",children:[e.jsx("h4",{children:"Issues / Concerns"}),e.jsx("p",{className:"report-issues",children:D.issues})]}),D.submitted_at&&e.jsx("div",{className:"report-meta",children:e.jsxs("span",{children:["Submitted by ",D.submitted_by||"Field"," at ",R(D.submitted_at)]})})]})]},D.id);if(g)return e.jsx("div",{className:"loading",children:"Loading daily reports..."});const k=d.length,pe=W.length;return e.jsxs("div",{className:"daily-reports-list card",children:[e.jsxs("div",{className:"daily-reports-header",children:[e.jsx("h3",{children:"Daily Reports"}),e.jsx("div",{className:"daily-reports-actions",children:d.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn btn-small ${_?"btn-primary":"btn-secondary"}`,onClick:ae,children:_?"Cancel":"Select"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:T,children:["PDF",v.size>0?` (${v.size})`:""]})]})})]}),d.length>0&&e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${$==="recent"?"active":""}`,onClick:()=>C("recent"),children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${$==="all"?"active":""}`,onClick:()=>C("all"),children:["All (",k,")"]})]}),$==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Gn,{size:14,className:"date-filter-icon"}),e.jsx("input",{type:"date",value:V.start,onChange:D=>q(z=>({...z,start:D.target.value})),className:"date-input"}),e.jsx("span",{className:"date-separator",children:"to"}),e.jsx("input",{type:"date",value:V.end,onChange:D=>q(z=>({...z,end:D.target.value})),className:"date-input"}),(V.start||V.end)&&e.jsx("button",{className:"date-clear",onClick:()=>q({start:"",end:""}),children:"Clear"})]})]}),_&&W.length>0&&e.jsxs("div",{className:"select-all-bar",children:[e.jsxs("label",{className:"select-all-label",children:[e.jsx("input",{type:"checkbox",checked:v.size===W.length&&W.length>0,onChange:P}),"Select All (",W.length,")"]}),v.size>0&&e.jsxs("span",{className:"selected-count",children:[v.size," selected"]})]}),d.length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(cs,{size:32})}),e.jsx("p",{children:"No daily reports yet"}),e.jsx("small",{children:"Reports from the field will appear here"})]}):W.length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(cs,{size:32})}),e.jsx("p",{children:"No reports in this time period"}),e.jsx("small",{children:$==="recent"?"No reports in the last 7 days":"Try adjusting your date filter"})]}):$==="recent"?e.jsxs("div",{className:"daily-reports",children:[W.map(D=>ee(D)),k>pe&&e.jsx("div",{className:"view-all-prompt",children:e.jsxs("button",{className:"btn btn-secondary",onClick:()=>C("all"),children:["View All ",k," Reports"]})})]}):e.jsx("div",{className:"daily-reports grouped",children:ue?.map(([D,{label:z,reports:se}])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>ce(D),children:[U.has(D)?e.jsx(Ma,{size:18,className:"month-chevron"}):e.jsx(Bs,{size:18,className:"month-chevron"}),e.jsx("span",{className:"month-label",children:z}),e.jsxs("span",{className:"month-count",children:[se.length," report",se.length!==1?"s":""]})]}),U.has(D)&&e.jsx("div",{className:"month-reports",children:se.map(Z=>ee(Z))})]},D))})]})}function vy({project:r,company:l,onShowToast:c}){const[i,d]=x.useState(null),[h,g]=x.useState(!0),[p,y]=x.useState(!1);x.useEffect(()=>{if(r?.id&&l?.id){m();const $=K.subscribeToCrewCheckins?.(r.id,()=>{m()});return()=>{$&&K.unsubscribe?.($)}}},[r?.id,l?.id]);const m=async()=>{try{const $=await K.calculateManDayCosts(r.id,l.id,r.work_type||"demolition",r.job_type||"standard");d($)}catch($){console.error("Error loading man day costs:",$)}finally{g(!1)}},v=$=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format($),A=$=>new Date($).toLocaleDateString("en-US",{month:"short",day:"numeric"}),_=$=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[$]||$.charAt(0).toUpperCase()+$.slice(1);if(h)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!i||i.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(Da,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const j=Object.entries(i.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>y(!p),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:v(i.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:p?" Collapse":" Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:i.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:i.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:v(i.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:i.daysWorked>0?v(i.totalCost/i.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),p&&e.jsxs("div",{className:"man-day-details",children:[j.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:j.map(([$,C])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:_($)}),e.jsxs("span",{className:"role-rate",children:[v(C.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[C.count," days"]}),e.jsx("span",{className:"role-cost",children:v(C.cost)})]})]},$))})]}),i.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:i.byDate.slice(0,7).map(($,C)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:A($.date)}),e.jsxs("span",{className:"date-workers",children:[$.workers," crew"]}),e.jsx("span",{className:"date-cost",children:v($.cost)})]},C))}),i.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",i.byDate.length-7," more days"]})]})]})]})}const os=r=>((r||0)/100).toFixed(2),Ue=r=>{const l=(r||0)/100;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(l)},Hi=r=>Math.round((parseFloat(r)||0)*100),gn=r=>((r||0)/100).toFixed(2),oa=r=>`${gn(r)}%`,Ln=r=>Math.round((parseFloat(r)||0)*100),yy=(r,l,c,i)=>{const d=parseFloat(r)||0,h=parseFloat(l)||0,g=parseInt(c)||0,p=parseInt(i)||0,y=Math.round(d*g),m=Math.round(h*p),v=y+m;return{regularTotal:y,overtimeTotal:m,total:v}},Xp=(r,l)=>{const c=parseFloat(r)||0,i=parseInt(l)||0;return Math.round(c*i)},Bi=(r,l)=>{const c=parseInt(r)||0,i=parseInt(l)||0;return Math.round(c*i/1e4)},yd=(r,l)=>{const c=parseInt(r)||0,i=parseInt(l)||0;return Math.round(c*i/1e4)},Ji=r=>{const l=(r.change_order_labor||[]).reduce((C,U)=>C+(parseInt(U.total)||0),0),c=(r.change_order_materials||[]).reduce((C,U)=>C+(parseInt(U.total)||0),0),i=(r.change_order_equipment||[]).reduce((C,U)=>C+(parseInt(U.total)||0),0),d=(r.change_order_subcontractors||[]).reduce((C,U)=>C+(parseInt(U.total)||0),0),h=Bi(l,r.labor_markup_percent??1500),g=Bi(c,r.materials_markup_percent??1500),p=Bi(i,r.equipment_markup_percent??1500),y=Bi(d,r.subcontractors_markup_percent??500),m=l+c+i+d+h+g+p+y,v=yd(m,r.liability_insurance_percent??144),A=yd(m,r.bond_percent??100),_=yd(m,r.license_fee_percent??10),j=v+A+_,$=m+j;return{labor_subtotal:l,materials_subtotal:c,equipment_subtotal:i,subcontractors_subtotal:d,labor_markup_amount:h,materials_markup_amount:g,equipment_markup_amount:p,subcontractors_markup_amount:y,liability_insurance_amount:v,bond_amount:A,license_fee_amount:_,additional_fees_total:j,cor_subtotal:m,cor_total:$}},Zp=r=>{const l=[];if(r.title?.trim()||l.push("Title is required"),r.scope_of_work?.trim()||l.push("Description is required"),r.period_start&&r.period_end){const i=new Date(r.period_start);new Date(r.period_end)<i&&l.push("End date must be after start date")}const c=5e3;return r.labor_markup_percent>c&&l.push("Labor markup percentage seems too high (>50%)"),r.materials_markup_percent>c&&l.push("Materials markup percentage seems too high (>50%)"),r.equipment_markup_percent>c&&l.push("Equipment markup percentage seems too high (>50%)"),r.subcontractors_markup_percent>c&&l.push("Subcontractors markup percentage seems too high (>50%)"),{valid:l.length===0,errors:l}},Mf=r=>{const l={draft:{label:"Draft",color:"#6b7280",bgColor:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bgColor:"#fef3c7"},approved:{label:"Approved",color:"#059669",bgColor:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bgColor:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bgColor:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bgColor:"#e5e7eb"}};return l[r]||l.draft},Na=r=>r?new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"",Wi=(r,l)=>{const c=Na(r),i=Na(l);return c&&i?`${c} - ${i}`:c||i||""},Un={labor_markup:1500,materials_markup:1500,equipment_markup:1500,subcontractors_markup:500,liability_insurance:144,bond:100,license_fee:10},Jp=["Foreman","Superintendent","Operator","Laborer"],by=[{value:"standard",label:"Standard"},{value:"pla",label:"PLA (Project Labor Agreement)"},{value:"prevailing",label:"Prevailing Wage"}],Wp=["each","day","week","month","hour","sqft","lf","gallon","pound","ton","cy","lump sum"];function _y({project:r,company:l,areas:c,refreshKey:i,onShowToast:d,onCreateCOR:h,onViewCOR:g,onEditCOR:p}){const[y,m]=x.useState([]),[v,A]=x.useState(!0),[_,j]=x.useState("all"),[$,C]=x.useState("all"),[U,X]=x.useState("all"),[V,q]=x.useState(null),[E,W]=x.useState(new Set),[ue,ae]=x.useState(!1),[Y,P]=x.useState(!1),[ce,M]=x.useState(""),[b,R]=x.useState("recent"),[B,me]=x.useState(new Set),[T,ee]=x.useState({start:"",end:""}),[k,pe]=x.useState(null);x.useEffect(()=>{D(),z();const J=K.subscribeToCORs?.(r.id,()=>{D(),z()});return()=>{J&&K.unsubscribe?.(J)}},[r.id,i]);const D=async()=>{try{const J=await K.getCORs(r.id);m(J||[])}catch(J){console.error("Error loading CORs:",J),d?.("Error loading change order requests","error")}finally{A(!1)}},z=async()=>{try{const J=await K.getCORStats?.(r.id);pe(J)}catch(J){console.error("Error loading COR stats:",J)}},se=async(J,Oe)=>{if(Oe?.stopPropagation(),!!confirm("Are you sure you want to delete this COR? This action cannot be undone."))try{await K.deleteCOR(J),m(y.filter(Ie=>Ie.id!==J)),d?.("COR deleted","success"),z()}catch(Ie){console.error("Error deleting COR:",Ie),d?.("Error deleting COR","error")}},Z=async(J,Oe)=>{Oe?.stopPropagation();try{await K.submitCORForApproval(J),await D(),d?.("COR submitted for approval","success"),z()}catch(Ie){console.error("Error submitting COR:",Ie?.message||Ie),d?.(Ie?.message||"Error submitting COR","error")}},ne=(J,Oe)=>{Oe?.stopPropagation(),W(Ie=>{const ft=new Set(Ie);return ft.has(J)?ft.delete(J):ft.add(J),ft})},F=()=>{ae(!1),W(new Set)},fe=async()=>{if(!ce.trim()){d?.("Please enter a group name","error");return}try{await K.bulkUpdateCORGroup([...E],ce.trim()),d?.(`${E.size} CORs grouped as "${ce.trim()}"`,"success"),P(!1),M(""),W(new Set),ae(!1),D()}catch(J){console.error("Error grouping CORs:",J),d?.("Error grouping CORs","error")}},de=x.useMemo(()=>{const J=y.map(Oe=>Oe.group_name).filter(Boolean);return[...new Set(J)].sort()},[y]),ye=x.useMemo(()=>{let J=[...y];if(_!=="all"&&(J=J.filter(Oe=>Oe.status===_)),$!=="all"&&(J=J.filter(Oe=>Oe.area_id===$)),U!=="all"&&(J=J.filter(Oe=>Oe.group_name===U)),T.start){const Oe=new Date(T.start);Oe.setHours(0,0,0,0),J=J.filter(Ie=>new Date(Ie.created_at)>=Oe)}if(T.end){const Oe=new Date(T.end);Oe.setHours(23,59,59,999),J=J.filter(Ie=>new Date(Ie.created_at)<=Oe)}if(b==="recent"){const Oe=new Date;Oe.setDate(Oe.getDate()-7),Oe.setHours(0,0,0,0),J=J.filter(Ie=>new Date(Ie.created_at)>=Oe)}return J.sort((Oe,Ie)=>new Date(Ie.created_at)-new Date(Oe.created_at)),J},[y,_,$,U,b,T]),Fe=x.useMemo(()=>{if(b!=="all")return null;const J={};return ye.forEach(Oe=>{const Ie=new Date(Oe.created_at),ft=`${Ie.getFullYear()}-${String(Ie.getMonth()+1).padStart(2,"0")}`,ja=Ie.toLocaleDateString("en-US",{month:"long",year:"numeric"});J[ft]||(J[ft]={label:ja,cors:[],totalAmount:0}),J[ft].cors.push(Oe),J[ft].totalAmount+=Oe.cor_total||0}),Object.entries(J).sort((Oe,Ie)=>Ie[0].localeCompare(Oe[0]))},[ye,b]);x.useEffect(()=>{if(Fe&&Fe.length>0){const J=Fe[0][0];me(new Set([J]))}},[Fe]);const ze=J=>{const Oe=new Set(B);Oe.has(J)?Oe.delete(J):Oe.add(J),me(Oe)},Me=x.useMemo(()=>({all:y.length,draft:y.filter(J=>J.status==="draft").length,pending_approval:y.filter(J=>J.status==="pending_approval").length,approved:y.filter(J=>J.status==="approved").length,rejected:y.filter(J=>J.status==="rejected").length,billed:y.filter(J=>J.status==="billed").length,closed:y.filter(J=>J.status==="closed").length}),[y]);_==="all"?y.length:y.filter(J=>J.status===_).length;const nt=J=>c?.find(Ie=>Ie.id===J)?.name||"No Area",qe=J=>{const Oe=Mf(J.status);J.id;const Ie=E.has(J.id),ft=["draft","pending_approval","approved"].includes(J.status),ja=["draft","pending_approval","rejected"].includes(J.status),ke=J.status==="draft";return e.jsxs("div",{className:`cor-card ${J.status} ${Ie?"selected":""}`,onClick:()=>ue?ne(J.id):g?.(J),onKeyDown:Le=>{(Le.key==="Enter"||Le.key===" ")&&(Le.preventDefault(),ue?ne(J.id):g?.(J))},tabIndex:0,role:"button","aria-label":`${ue?Ie?"Deselect":"Select":"View"} COR ${J.cor_number}: ${J.title||"Untitled"}, ${Oe.label}, ${Ue(J.cor_total||0)}`,children:[e.jsxs("div",{className:"cor-card-header",children:[e.jsxs("div",{className:"cor-card-left",children:[ue&&e.jsx("button",{className:"cor-select-checkbox",onClick:Le=>ne(J.id,Le),"aria-label":Ie?"Deselect":"Select",children:Ie?e.jsx(Rd,{size:18}):e.jsx(Dv,{size:18})}),e.jsx("span",{className:"cor-number",children:J.cor_number}),e.jsx("span",{className:"cor-status-badge",style:{backgroundColor:Oe.bgColor,color:Oe.color},children:Oe.label}),(J.gc_signature_data||J.client_signature_data)&&e.jsxs("span",{className:"cor-signed-badge",title:`Signed by ${J.gc_signature_name||J.client_signature_name||"Client"}`,children:[e.jsx(Ta,{size:12})," Signed"]})]}),e.jsx("div",{className:"cor-card-right",children:e.jsx("span",{className:"cor-total",children:Ue(J.cor_total||0)})})]}),e.jsxs("div",{className:"cor-card-body",children:[e.jsx("h4",{className:"cor-title",children:J.title||"Untitled COR"}),e.jsxs("div",{className:"cor-meta",children:[J.group_name&&e.jsx("span",{className:"cor-group-badge",children:J.group_name}),J.area_id&&e.jsx("span",{className:"cor-area",children:nt(J.area_id)}),e.jsx("span",{className:"cor-period",children:Wi(J.period_start,J.period_end)})]})]}),e.jsxs("div",{className:"cor-card-footer",children:[e.jsx("span",{className:"cor-created",children:Na(J.created_at)}),e.jsxs("div",{className:"cor-actions",onClick:Le=>Le.stopPropagation(),children:[ke&&e.jsx("button",{className:"cor-action-btn submit",onClick:Le=>Z(J.id,Le),title:"Submit for Approval","aria-label":`Submit COR ${J.cor_number} for approval`,children:e.jsx($d,{size:14,"aria-hidden":"true"})}),ft&&e.jsx("button",{className:"cor-action-btn edit",onClick:Le=>{Le.stopPropagation(),p?.(J)},title:"Edit","aria-label":`Edit COR ${J.cor_number}`,children:e.jsx(bl,{size:14,"aria-hidden":"true"})}),e.jsx("button",{className:"cor-action-btn view",onClick:Le=>{Le.stopPropagation(),g?.(J)},title:"View Details","aria-label":`View COR ${J.cor_number} details`,children:e.jsx(Hj,{size:14,"aria-hidden":"true"})}),ja&&e.jsx("button",{className:"cor-action-btn delete",onClick:Le=>se(J.id,Le),title:"Delete","aria-label":`Delete COR ${J.cor_number}`,children:e.jsx(Us,{size:14,"aria-hidden":"true"})})]})]})]},J.id)};return v?e.jsx("div",{className:"loading",children:"Loading change order requests..."}):e.jsxs("div",{className:"cor-list",children:[e.jsxs("div",{className:"cor-list-header",children:[e.jsxs("div",{className:"cor-list-info",children:[e.jsx("h3",{children:"Change Orders"}),e.jsxs("div",{className:"cor-stats-inline",children:[e.jsxs("span",{className:"cor-stat-item",children:[Me.all," total"]}),Me.pending_approval>0&&e.jsxs("span",{className:"cor-stat-item pending",children:[Me.pending_approval," pending"]}),k?.totalApproved>0&&e.jsx("span",{className:"cor-stat-item approved",children:Ue(k.totalApproved)})]})]}),e.jsxs("div",{className:"cor-header-actions",children:[e.jsx("button",{className:`btn btn-secondary btn-small ${ue?"active":""}`,onClick:()=>ue?F():ae(!0),children:ue?e.jsxs(e.Fragment,{children:[e.jsx(Ra,{size:14})," Cancel"]}):e.jsxs(e.Fragment,{children:[e.jsx(Rd,{size:14})," Select"]})}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:h,children:[e.jsx(ys,{size:14})," New COR"]})]})]}),ue&&E.size>0&&e.jsxs("div",{className:"cor-selection-bar",children:[e.jsxs("span",{className:"selection-count",children:[E.size," selected"]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:()=>P(!0),children:[e.jsx(Gj,{size:14})," Group Selected"]})]}),e.jsxs("div",{className:"cor-controls",children:[e.jsx("div",{className:"cor-filter-pills",role:"tablist",children:[{id:"all",label:"All"},{id:"draft",label:"Draft"},{id:"pending_approval",label:"Pending"},{id:"approved",label:"Approved"}].map(J=>e.jsxs("button",{role:"tab","aria-selected":_===J.id,className:`cor-pill ${_===J.id?"active":""}`,onClick:()=>j(J.id),children:[J.label,Me[J.id]>0&&e.jsx("span",{className:"cor-pill-count",children:Me[J.id]})]},J.id))}),de.length>0&&e.jsxs("select",{className:"cor-group-filter",value:U,onChange:J=>X(J.target.value),children:[e.jsx("option",{value:"all",children:"All Groups"}),de.map(J=>e.jsx("option",{value:J,children:J},J))]}),e.jsxs("div",{className:"cor-view-toggle",children:[e.jsx("button",{className:`cor-toggle-btn ${b==="recent"?"active":""}`,onClick:()=>{R("recent"),ee({start:"",end:""})},children:"Recent"}),e.jsx("button",{className:`cor-toggle-btn ${b==="all"?"active":""}`,onClick:()=>R("all"),children:"All"})]})]}),b==="all"&&e.jsxs("div",{className:"cor-date-filter",children:[e.jsx(Gn,{size:14}),e.jsx("input",{type:"date",value:T.start,onChange:J=>ee(Oe=>({...Oe,start:J.target.value}))}),e.jsx("span",{className:"cor-date-sep",children:"to"}),e.jsx("input",{type:"date",value:T.end,onChange:J=>ee(Oe=>({...Oe,end:J.target.value}))}),(T.start||T.end)&&e.jsx("button",{className:"cor-clear-btn",onClick:()=>ee({start:"",end:""}),children:"Clear"})]}),ye.length===0?e.jsxs("div",{className:"cor-empty",children:[e.jsx(Oa,{size:24,className:"cor-empty-icon"}),e.jsxs("p",{children:["No change orders ",_!=="all"?`(${_.replace("_"," ")})`:""]}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:h,children:[e.jsx(ys,{size:14})," Create COR"]})]}):e.jsx("div",{className:"cor-cards",children:b==="all"&&Fe?Fe.map(([J,Oe])=>e.jsxs("div",{className:"cor-month-group",children:[e.jsxs("button",{className:"cor-month-header",onClick:()=>ze(J),children:[e.jsxs("div",{className:"cor-month-left",children:[B.has(J)?e.jsx(Ma,{size:16}):e.jsx(Bs,{size:16}),e.jsx("span",{children:Oe.label}),e.jsx("span",{className:"cor-month-count",children:Oe.cors.length})]}),e.jsx("span",{className:"cor-month-total",children:Ue(Oe.totalAmount)})]}),B.has(J)&&e.jsx("div",{className:"cor-month-items",children:Oe.cors.map(Ie=>qe(Ie))})]},J)):ye.map(J=>qe(J))}),Y&&e.jsx("div",{className:"modal-overlay",onClick:()=>P(!1),children:e.jsxs("div",{className:"modal-content cor-group-modal",onClick:J=>J.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["Group ",E.size," CORs"]}),e.jsx("button",{className:"close-btn",onClick:()=>P(!1),children:e.jsx(Ra,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Group Name"}),e.jsx("input",{type:"text",value:ce,onChange:J=>M(J.target.value),placeholder:"e.g., Phase 1, Building A, Week 1",autoFocus:!0,onKeyDown:J=>{J.key==="Enter"&&fe(),J.key==="Escape"&&P(!1)}})]}),de.length>0&&e.jsxs("div",{className:"existing-groups",children:[e.jsx("label",{children:"Or select existing group:"}),e.jsx("div",{className:"group-chips",children:de.map(J=>e.jsx("button",{className:"group-chip",onClick:()=>M(J),children:J},J))})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>P(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:fe,children:"Group CORs"})]})]})})]})}function Ny({projectId:r,corId:l,onImport:c,onClose:i,onShowToast:d}){const[h,g]=x.useState([]),[p,y]=x.useState(!0),[m,v]=x.useState(new Set),[A,_]=x.useState(null),[j,$]=x.useState(""),[C,U]=x.useState("unassigned");x.useEffect(()=>{X()},[r]);const X=async()=>{try{const Y=await K.getTMTickets(r);g(Y||[])}catch(Y){console.error("Error loading tickets:",Y),d?.("Error loading tickets","error")}finally{y(!1)}},V=x.useMemo(()=>{let Y=[...h];if(C==="unassigned"?Y=Y.filter(P=>!P.assigned_cor_id):C==="approved"&&(Y=Y.filter(P=>P.status==="approved")),j){const P=j.toLowerCase();Y=Y.filter(ce=>ce.work_description?.toLowerCase().includes(P)||ce.ce_pco_number?.toLowerCase().includes(P)||ce.ticket_date?.includes(P))}return Y.sort((P,ce)=>new Date(ce.ticket_date)-new Date(P.ticket_date)),Y},[h,C,j]),q=Y=>{const P=new Set(m);P.has(Y)?P.delete(Y):P.add(Y),v(P)},E=()=>{m.size===V.length?v(new Set):v(new Set(V.map(Y=>Y.id)))},W=Y=>new Date(Y).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),ue=Y=>{const P=Y.workers?.length||0,ce=Y.items?.length||0,M=Y.materials_equipment?.filter(R=>R.type==="equipment")?.length||0;let b=0;return Y.workers?.forEach(R=>{b+=(parseFloat(R.regular_hours)||0)+(parseFloat(R.overtime_hours)||0)}),{workerCount:P,itemCount:ce,equipmentCount:M,laborHours:b}},ae=()=>{if(m.size===0){d?.("Please select at least one ticket","error");return}const Y=h.filter(b=>m.has(b.id)),P=[],ce=[],M=[];Y.forEach(b=>{b.workers?.forEach(R=>{P.push({id:`import-${b.id}-${R.id||Date.now()}`,labor_class:R.role||"Laborer",wage_type:"standard",regular_hours:parseFloat(R.regular_hours)||0,overtime_hours:parseFloat(R.overtime_hours)||0,regular_rate:0,overtime_rate:0,total:0,source_ticket_id:b.id,source_ticket_date:b.ticket_date})}),b.items?.forEach(R=>{ce.push({id:`import-${b.id}-${R.id||Date.now()}`,description:R.description||R.name,source_type:"T&M Ticket",source_reference:`T&M ${W(b.ticket_date)}`,quantity:parseFloat(R.quantity)||1,unit:R.unit||"each",unit_cost:Hi(R.unit_cost||0),total:Hi((R.quantity||1)*(R.unit_cost||0)),source_ticket_id:b.id})}),b.materials_equipment?.filter(R=>R.type==="equipment").forEach(R=>{M.push({id:`import-${b.id}-${R.id||Date.now()}`,description:R.description||R.name,source_type:"T&M Ticket",source_reference:`T&M ${W(b.ticket_date)}`,quantity:parseFloat(R.quantity)||1,unit:R.unit||"day",unit_cost:Hi(R.unit_cost||R.cost||0),total:Hi((R.quantity||1)*(R.unit_cost||R.cost||0)),source_ticket_id:b.id})})}),c?.({ticketIds:Array.from(m),laborItems:P,materialsItems:ce,equipmentItems:M}),i?.()};return p?e.jsx("div",{className:"modal-overlay",onClick:i,role:"dialog","aria-modal":"true","aria-label":"Loading tickets",children:e.jsx("div",{className:"modal-content ticket-selector-modal",onClick:Y=>Y.stopPropagation(),children:e.jsx("div",{className:"loading",role:"status","aria-live":"polite",children:"Loading tickets..."})})}):e.jsx("div",{className:"modal-overlay",onClick:i,role:"dialog","aria-modal":"true","aria-labelledby":"ticket-selector-title",children:e.jsxs("div",{className:"modal-content ticket-selector-modal",onClick:Y=>Y.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"ticket-selector-title",children:"Import from T&M Tickets"}),e.jsx("button",{className:"close-btn",onClick:i,"aria-label":"Close ticket selector",children:e.jsx(Ra,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"ticket-selector-controls",children:[e.jsxs("div",{className:"ticket-search",children:[e.jsx(Xi,{size:16,"aria-hidden":"true"}),e.jsx("input",{type:"text",placeholder:"Search tickets...",value:j,onChange:Y=>$(Y.target.value),"aria-label":"Search tickets"})]}),e.jsxs("div",{className:"ticket-filters",role:"group","aria-label":"Filter tickets by status",children:[e.jsx("button",{className:`filter-btn ${C==="unassigned"?"active":""}`,onClick:()=>U("unassigned"),"aria-pressed":C==="unassigned",children:"Unassigned"}),e.jsx("button",{className:`filter-btn ${C==="approved"?"active":""}`,onClick:()=>U("approved"),"aria-pressed":C==="approved",children:"Approved"}),e.jsx("button",{className:`filter-btn ${C==="all"?"active":""}`,onClick:()=>U("all"),"aria-pressed":C==="all",children:"All"})]})]}),e.jsxs("div",{className:"ticket-selector-header",children:[e.jsxs("label",{className:"select-all",children:[e.jsx("input",{type:"checkbox",checked:m.size===V.length&&V.length>0,onChange:E,"aria-label":`Select all ${V.length} tickets`}),e.jsxs("span",{children:["Select All (",V.length,")"]})]}),e.jsxs("span",{className:"selected-count",children:[m.size," selected"]})]}),e.jsx("div",{className:"modal-body ticket-selector-body",children:V.length===0?e.jsxs("div",{className:"ticket-empty",children:[e.jsx(Oa,{size:32}),e.jsx("p",{children:"No tickets found"}),C==="unassigned"&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>U("all"),children:"Show all tickets"})]}):e.jsx("div",{className:"ticket-list",children:V.map(Y=>{const P=ue(Y),ce=m.has(Y.id),M=A===Y.id;return e.jsxs("div",{className:`ticket-item ${ce?"selected":""} ${Y.assigned_cor_id?"assigned":""}`,children:[e.jsxs("div",{className:"ticket-item-main",children:[e.jsx("label",{className:"ticket-checkbox",children:e.jsx("input",{type:"checkbox",checked:ce,onChange:()=>q(Y.id),disabled:Y.assigned_cor_id&&Y.assigned_cor_id!==l})}),e.jsxs("div",{className:"ticket-item-info",onClick:()=>_(M?null:Y.id),children:[e.jsxs("div",{className:"ticket-item-header",children:[e.jsx("span",{className:"ticket-date",children:W(Y.ticket_date)}),e.jsx("span",{className:`ticket-status ${Y.status}`,children:Y.status}),Y.ce_pco_number&&e.jsxs("span",{className:"ticket-pco",children:["CE/PCO: ",Y.ce_pco_number]})]}),e.jsx("div",{className:"ticket-item-desc",children:Y.work_description||"No description"}),e.jsxs("div",{className:"ticket-item-summary",children:[P.workerCount>0&&e.jsxs("span",{children:[e.jsx($s,{size:12})," ",P.workerCount," workers"]}),P.itemCount>0&&e.jsxs("span",{children:[e.jsx(Hs,{size:12})," ",P.itemCount," items"]}),P.equipmentCount>0&&e.jsxs("span",{children:[e.jsx(ds,{size:12})," ",P.equipmentCount," equipment"]}),P.laborHours>0&&e.jsxs("span",{children:[P.laborHours," hrs"]})]})]}),e.jsx("button",{className:"ticket-expand-btn",onClick:()=>_(M?null:Y.id),children:M?e.jsx(Ma,{size:16}):e.jsx(Bs,{size:16})})]}),M&&e.jsxs("div",{className:"ticket-item-details",children:[Y.workers?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Workers"}),e.jsx("ul",{children:Y.workers.map((b,R)=>e.jsxs("li",{children:[b.name||b.role," - ",b.regular_hours||0," reg hrs",b.overtime_hours>0&&`, ${b.overtime_hours} OT hrs`]},R))})]}),Y.items?.length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Materials"}),e.jsx("ul",{children:Y.items.map((b,R)=>e.jsxs("li",{children:[b.description||b.name," - ",b.quantity," ",b.unit]},R))})]}),Y.materials_equipment?.filter(b=>b.type==="equipment").length>0&&e.jsxs("div",{className:"ticket-detail-section",children:[e.jsx("h5",{children:"Equipment"}),e.jsx("ul",{children:Y.materials_equipment.filter(b=>b.type==="equipment").map((b,R)=>e.jsx("li",{children:b.description||b.name},R))})]})]})]},Y.id)})})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:i,children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:ae,disabled:m.size===0,children:[e.jsx(Aa,{size:16})," Import ",m.size," Ticket",m.size!==1?"s":""]})]})]})})}function Sy({project:r,company:l,areas:c,existingCOR:i,onClose:d,onSaved:h,onShowToast:g}){const[p,y]=x.useState(!1),[m,v]=x.useState([]),[A,_]=x.useState(!1),[j,$]=x.useState({labor:i?.change_order_labor?.length>0,materials:i?.change_order_materials?.length>0,equipment:i?.change_order_equipment?.length>0,subcontractors:i?.change_order_subcontractors?.length>0,markups:!1}),[C,U]=x.useState([]),[X,V]=x.useState(""),[q,E]=x.useState("all"),[W,ue]=x.useState(""),[ae,Y]=x.useState(i?.title||""),[P,ce]=x.useState(i?.scope_of_work||""),[M,b]=x.useState(i?.cor_number||""),[R,B]=x.useState(i?.group_name||""),[me,T]=x.useState(i?.area_id||""),[ee,k]=x.useState(i?.period_start||""),[pe,D]=x.useState(i?.period_end||""),[z,se]=x.useState(i?.change_order_labor||[]),[Z,ne]=x.useState(i?.change_order_materials||[]),[F,fe]=x.useState(i?.change_order_equipment||[]),[de,ye]=x.useState(i?.change_order_subcontractors||[]),[Fe,ze]=x.useState(i?.labor_markup_percent??Un.labor_markup),[Me,nt]=x.useState(i?.materials_markup_percent??Un.materials_markup),[qe,J]=x.useState(i?.equipment_markup_percent??Un.equipment_markup),[Oe,Ie]=x.useState(i?.subcontractors_markup_percent??Un.subcontractors_markup),[ft,ja]=x.useState(i?.liability_insurance_percent??Un.liability_insurance),[ke,Le]=x.useState(i?.bond_percent??Un.bond),[$e,Je]=x.useState(i?.license_fee_percent??Un.license_fee);x.useEffect(()=>{Mt(),et(),i||Dt()},[]);const et=async()=>{try{const O=await K.getAllMaterialsEquipment(l?.id);U(O||[])}catch(O){console.error("Error loading company materials:",O)}},tt=x.useMemo(()=>C.filter(O=>!["Containment","PPE","Disposal"].includes(O.category)||O.active===!1||q!=="all"&&O.category!==q?!1:X?O.name.toLowerCase().includes(X.toLowerCase()):!0),[C,X,q]),Ae=x.useMemo(()=>C.filter(O=>O.category!=="Equipment"||O.active===!1?!1:W?O.name.toLowerCase().includes(W.toLowerCase()):!0),[C,W]),bt=O=>{ne([...Z,{description:O.name,source_type:"field_ticket",source_reference:"",quantity:1,unit:O.unit||"each",unit_cost:O.cost_per_unit||0,total:O.cost_per_unit||0}])},kt=O=>{fe([...F,{description:O.name,source_type:"rental",source_reference:"",quantity:1,unit:O.unit||"day",unit_cost:O.cost_per_unit||0,total:O.cost_per_unit||0}])},Mt=async()=>{try{const O=await K.getLaborRates?.(l?.id,r?.work_type,r?.job_type);v(O||[])}catch(O){console.error("Error loading labor rates:",O)}},Gt=O=>{const je=O?.toLowerCase()||"";return m.find(xe=>xe.role?.toLowerCase()===je)||null},Dt=async()=>{try{const O=await K.getNextCORNumber?.(r.id);b(O||`COR-${Date.now()}`)}catch(O){console.error("Error generating COR number:",O),b(`COR-${Date.now()}`)}},aa=O=>{$(je=>({...je,[O]:!je[O]}))},da=x.useMemo(()=>({title:ae,scope_of_work:P,area_id:me||null,cor_number:M,group_name:R||null,period_start:ee||null,period_end:pe||null,change_order_labor:z,change_order_materials:Z,change_order_equipment:F,change_order_subcontractors:de,labor_markup_percent:Fe,materials_markup_percent:Me,equipment_markup_percent:qe,subcontractors_markup_percent:Oe,liability_insurance_percent:ft,bond_percent:ke,license_fee_percent:$e}),[ae,P,me,M,R,ee,pe,z,Z,F,de,Fe,Me,qe,Oe,ft,ke,$e]),St=x.useMemo(()=>Ji(da),[da]),We=()=>{const O=Jp[0],je=Gt(O);se([...z,{id:`temp-${Date.now()}`,labor_class:O,wage_type:"standard",regular_hours:0,overtime_hours:0,regular_rate:je?Math.round((parseFloat(je.regular_rate)||0)*100):0,overtime_rate:je?Math.round((parseFloat(je.overtime_rate)||0)*100):0,total:0}]),j.labor||aa("labor")},Ft=(O,je,xe)=>{const Re=[...z];if(Re[O]={...Re[O],[je]:xe},je==="labor_class"){const ct=Gt(xe);ct&&(Re[O].regular_rate=Math.round((parseFloat(ct.regular_rate)||0)*100),Re[O].overtime_rate=Math.round((parseFloat(ct.overtime_rate)||0)*100))}const{total:jt}=yy(Re[O].regular_hours,Re[O].overtime_hours,Re[O].regular_rate,Re[O].overtime_rate);Re[O].total=jt,se(Re)},De=O=>{se(z.filter((je,xe)=>xe!==O))},I=()=>{ne([...Z,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"each",unit_cost:0,total:0}]),j.materials||aa("materials")},L=(O,je,xe)=>{const Re=[...Z];Re[O]={...Re[O],[je]:xe},Re[O].total=Xp(Re[O].quantity,Re[O].unit_cost),ne(Re)},we=O=>{ne(Z.filter((je,xe)=>xe!==O))},it=()=>{fe([...F,{id:`temp-${Date.now()}`,description:"",source_type:"backup_sheet",source_reference:"",quantity:1,unit:"day",unit_cost:0,total:0}]),j.equipment||aa("equipment")},Te=(O,je,xe)=>{const Re=[...F];Re[O]={...Re[O],[je]:xe},Re[O].total=Xp(Re[O].quantity,Re[O].unit_cost),fe(Re)},be=O=>{fe(F.filter((je,xe)=>xe!==O))},st=()=>{ye([...de,{id:`temp-${Date.now()}`,company_name:"",description:"",source_type:"invoice",source_reference:"",amount:0,total:0}]),j.subcontractors||aa("subcontractors")},dt=(O,je,xe)=>{const Re=[...de];Re[O]={...Re[O],[je]:xe},je==="amount"&&(Re[O].total=parseInt(xe)||0),ye(Re)},It=O=>{ye(de.filter((je,xe)=>xe!==O))},sa=O=>{O.laborItems?.length>0&&(se([...z,...O.laborItems]),$(je=>({...je,labor:!0}))),O.materialsItems?.length>0&&(ne([...Z,...O.materialsItems]),$(je=>({...je,materials:!0}))),O.equipmentItems?.length>0&&(fe([...F,...O.equipmentItems]),$(je=>({...je,equipment:!0}))),g?.(`Imported data from ${O.ticketIds.length} ticket(s)`,"success")},Ce=ae.trim().length>0,xt=()=>({company_id:l.id,project_id:r.id,title:ae,scope_of_work:P||"",area_id:me||null,cor_number:M,group_name:R||null,period_start:ee||new Date().toISOString().split("T")[0],period_end:pe||new Date().toISOString().split("T")[0],labor_markup_percent:Fe,materials_markup_percent:Me,equipment_markup_percent:qe,subcontractors_markup_percent:Oe,liability_insurance_percent:ft,bond_percent:ke,license_fee_percent:$e,...St}),ut=async()=>{if(!Ce){g?.("Title is required","error");return}y(!0);try{const O={...xt(),status:"draft"};let je;i?.id?je=await K.updateCOR(i.id,O):je=await K.createCOR(O),je?.id&&await K.saveCORLineItems(je.id,{laborItems:z,materialItems:Z,equipmentItems:F,subcontractorItems:de}),g?.("COR saved as draft","success"),h?.(je),d?.()}catch(O){console.error("Error saving COR:",O),g?.("Error saving COR","error")}finally{y(!1)}},qa=async()=>{const O=Zp(da);if(!O.valid){g?.(O.errors[0],"error");return}y(!0);try{const je={...xt(),status:"draft"};let xe;i?.id?(xe=await K.updateCOR(i.id,je),await K.saveCORLineItems(i.id,{laborItems:z,materialItems:Z,equipmentItems:F,subcontractorItems:de}),await K.submitCORForApproval(i.id)):(xe=await K.createCOR(je),xe?.id&&(await K.saveCORLineItems(xe.id,{laborItems:z,materialItems:Z,equipmentItems:F,subcontractorItems:de}),await K.submitCORForApproval(xe.id))),g?.("COR submitted for approval","success"),h?.(xe),d?.()}catch(je){console.error("Error submitting COR:",je),g?.("Error submitting COR","error")}finally{y(!1)}},Ee=({section:O,label:je,count:xe,subtotal:Re})=>e.jsxs("div",{className:`cor-section-header ${j[O]?"expanded":""}`,onClick:()=>aa(O),children:[e.jsxs("div",{className:"cor-section-title",children:[j[O]?e.jsx(Ma,{size:18}):e.jsx(Bs,{size:18}),e.jsx("span",{children:je}),xe>0&&e.jsx("span",{className:"cor-section-count",children:xe})]}),Re>0&&e.jsx("span",{className:"cor-section-subtotal",children:Ue(Re)})]});return e.jsxs("div",{className:"modal-overlay",onClick:d,children:[e.jsxs("div",{className:"modal-content cor-form-modal cor-form-simplified",onClick:O=>O.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:i?"Edit Change Order Request":"New Change Order Request"}),e.jsx("button",{className:"close-btn",onClick:d,children:e.jsx(Ra,{size:20})})]}),e.jsxs("div",{className:"modal-body cor-form-body",children:[e.jsxs("div",{className:"cor-form-required",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group cor-number-field",children:[e.jsx("label",{children:"COR #"}),e.jsx("input",{type:"text",value:M,onChange:O=>b(O.target.value),className:"input-small"})]}),e.jsxs("div",{className:"form-group flex-grow required",children:[e.jsx("label",{children:"Title"}),e.jsx("input",{type:"text",value:ae,onChange:O=>Y(O.target.value),placeholder:"e.g., Additional Demolition Work - Building A",className:"input-required"})]})]}),e.jsxs("div",{className:"form-group required",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:P,onChange:O=>ce(O.target.value),rows:2,placeholder:"Describe the scope of work",className:"input-required"})]}),e.jsxs("div",{className:"form-row form-row-compact",children:[c&&c.length>0&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Area"}),e.jsxs("select",{value:me,onChange:O=>T(O.target.value),children:[e.jsx("option",{value:"",children:"None"}),c.map(O=>e.jsx("option",{value:O.id,children:O.name},O.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Group"}),e.jsx("input",{type:"text",value:R,onChange:O=>B(O.target.value),placeholder:"e.g., Phase 1"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Start"}),e.jsx("input",{type:"date",value:ee,onChange:O=>k(O.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"End"}),e.jsx("input",{type:"date",value:pe,onChange:O=>D(O.target.value),min:ee})]})]})]}),e.jsx("div",{className:"cor-import-bar",children:e.jsxs("button",{className:"btn btn-ghost",onClick:()=>_(!0),children:[e.jsx(Oa,{size:16})," Import from T&M Tickets"]})}),e.jsxs("div",{className:"cor-sections",children:[e.jsxs("div",{className:"cor-section",children:[e.jsx(Ee,{section:"labor",label:"Labor",count:z.length,subtotal:St.labor_subtotal}),j.labor&&e.jsxs("div",{className:"cor-section-content",children:[z.map((O,je)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("select",{value:O.labor_class,onChange:xe=>Ft(je,"labor_class",xe.target.value),children:Jp.map(xe=>e.jsx("option",{value:xe,children:xe},xe))}),e.jsx("select",{value:O.wage_type,onChange:xe=>Ft(je,"wage_type",xe.target.value),children:by.map(xe=>e.jsx("option",{value:xe.value,children:xe.label},xe.value))}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"Reg hrs",value:O.regular_hours||"",onChange:xe=>Ft(je,"regular_hours",xe.target.value.replace(/[^0-9.]/g,"")),className:"input-small"}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$/hr",value:O.regular_rate?O.regular_rate/100:"",onChange:xe=>{const Re=xe.target.value.replace(/[^0-9.]/g,"");Ft(je,"regular_rate",Math.round(parseFloat(Re||0)*100))},className:"input-small"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"OT hrs",value:O.overtime_hours||"",onChange:xe=>Ft(je,"overtime_hours",xe.target.value.replace(/[^0-9.]/g,"")),className:"input-small"}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$/hr",value:O.overtime_rate?O.overtime_rate/100:"",onChange:xe=>{const Re=xe.target.value.replace(/[^0-9.]/g,"");Ft(je,"overtime_rate",Math.round(parseFloat(Re||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:Ue(O.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>De(je),children:e.jsx(Us,{size:14})})]})},O.id||je)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:We,children:[e.jsx(ys,{size:14})," Add Labor"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(Ee,{section:"materials",label:"Materials",count:Z.length,subtotal:St.materials_subtotal}),j.materials&&e.jsxs("div",{className:"cor-section-content",children:[C.filter(O=>["Containment","PPE","Disposal"].includes(O.category)&&O.active!==!1).length>0&&e.jsxs("div",{className:"quick-select-compact",children:[e.jsxs("div",{className:"quick-select-search",children:[e.jsx(Xi,{size:14}),e.jsx("input",{type:"text",placeholder:"Search materials...",value:X,onChange:O=>V(O.target.value)})]}),e.jsx("div",{className:"quick-select-items",children:tt.slice(0,8).map(O=>e.jsx("button",{className:"quick-item",onClick:()=>bt(O),children:O.name},O.id))})]}),Z.map((O,je)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Description",value:O.description,onChange:xe=>L(je,"description",xe.target.value),className:"input-wide"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"Qty",value:O.quantity||"",onChange:xe=>L(je,"quantity",xe.target.value.replace(/[^0-9.]/g,"")),className:"input-small"}),e.jsx("select",{value:O.unit,onChange:xe=>L(je,"unit",xe.target.value),children:Wp.map(xe=>e.jsx("option",{value:xe,children:xe},xe))}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$/unit",value:O.unit_cost?O.unit_cost/100:"",onChange:xe=>{const Re=xe.target.value.replace(/[^0-9.]/g,"");L(je,"unit_cost",Math.round(parseFloat(Re||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:Ue(O.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>we(je),children:e.jsx(Us,{size:14})})]})},O.id||je)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:I,children:[e.jsx(ys,{size:14})," Add Material"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(Ee,{section:"equipment",label:"Equipment",count:F.length,subtotal:St.equipment_subtotal}),j.equipment&&e.jsxs("div",{className:"cor-section-content",children:[C.filter(O=>O.category==="Equipment"&&O.active!==!1).length>0&&e.jsxs("div",{className:"quick-select-compact",children:[e.jsxs("div",{className:"quick-select-search",children:[e.jsx(Xi,{size:14}),e.jsx("input",{type:"text",placeholder:"Search equipment...",value:W,onChange:O=>ue(O.target.value)})]}),e.jsx("div",{className:"quick-select-items",children:Ae.slice(0,8).map(O=>e.jsx("button",{className:"quick-item",onClick:()=>kt(O),children:O.name},O.id))})]}),F.map((O,je)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Description",value:O.description,onChange:xe=>Te(je,"description",xe.target.value),className:"input-wide"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"Qty",value:O.quantity||"",onChange:xe=>Te(je,"quantity",xe.target.value.replace(/[^0-9.]/g,"")),className:"input-small"}),e.jsx("select",{value:O.unit,onChange:xe=>Te(je,"unit",xe.target.value),children:Wp.map(xe=>e.jsx("option",{value:xe,children:xe},xe))}),e.jsx("span",{className:"input-label",children:"@"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$/unit",value:O.unit_cost?O.unit_cost/100:"",onChange:xe=>{const Re=xe.target.value.replace(/[^0-9.]/g,"");Te(je,"unit_cost",Math.round(parseFloat(Re||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:Ue(O.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>be(je),children:e.jsx(Us,{size:14})})]})},O.id||je)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:it,children:[e.jsx(ys,{size:14})," Add Equipment"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(Ee,{section:"subcontractors",label:"Subcontractors",count:de.length,subtotal:St.subcontractors_subtotal}),j.subcontractors&&e.jsxs("div",{className:"cor-section-content",children:[de.map((O,je)=>e.jsx("div",{className:"line-item compact",children:e.jsxs("div",{className:"line-item-row",children:[e.jsx("input",{type:"text",placeholder:"Company",value:O.company_name,onChange:xe=>dt(je,"company_name",xe.target.value)}),e.jsx("input",{type:"text",placeholder:"Description",value:O.description,onChange:xe=>dt(je,"description",xe.target.value),className:"input-wide"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"Amount",value:O.amount?O.amount/100:"",onChange:xe=>{const Re=xe.target.value.replace(/[^0-9.]/g,"");dt(je,"amount",Math.round(parseFloat(Re||0)*100))},className:"input-small"}),e.jsx("span",{className:"line-item-total",children:Ue(O.total)}),e.jsx("button",{className:"btn-icon",onClick:()=>It(je),children:e.jsx(Us,{size:14})})]})},O.id||je)),e.jsxs("button",{className:"btn btn-ghost btn-add",onClick:st,children:[e.jsx(ys,{size:14})," Add Subcontractor"]})]})]}),e.jsxs("div",{className:"cor-section",children:[e.jsx(Ee,{section:"markups",label:"Markups & Fees",count:0,subtotal:St.total_markup_amount+St.total_fees}),j.markups&&e.jsxs("div",{className:"cor-section-content markups-content",children:[e.jsxs("div",{className:"markups-grid-compact",children:[e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Labor Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:gn(Fe),onChange:O=>ze(Ln(O.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Ue(St.labor_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Materials Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:gn(Me),onChange:O=>nt(Ln(O.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Ue(St.materials_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Equipment Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:gn(qe),onChange:O=>J(Ln(O.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Ue(St.equipment_markup_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Subcontractors Markup"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:gn(Oe),onChange:O=>Ie(Ln(O.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Ue(St.subcontractors_markup_amount)]})]})]}),e.jsxs("div",{className:"fees-grid-compact",children:[e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Liability Insurance"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:gn(ft),onChange:O=>ja(Ln(O.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Ue(St.liability_insurance_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"Bond"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:gn(ke),onChange:O=>Le(Ln(O.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Ue(St.bond_amount)]})]}),e.jsxs("div",{className:"markup-row",children:[e.jsx("span",{children:"City License Fee"}),e.jsxs("div",{className:"markup-input-compact",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:gn($e),onChange:O=>Je(Ln(O.target.value.replace(/[^0-9.]/g,"")))}),e.jsx("span",{children:"%"})]}),e.jsxs("span",{className:"markup-result",children:["+",Ue(St.license_fee_amount)]})]})]})]})]})]}),e.jsxs("div",{className:"cor-summary-bar",children:[e.jsxs("div",{className:"cor-summary-item",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:Ue(St.cor_subtotal)})]}),e.jsxs("div",{className:"cor-summary-item total",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:Ue(St.cor_total)})]})]})]}),e.jsxs("div",{className:"modal-footer cor-form-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:d,disabled:p,children:"Cancel"}),e.jsxs("div",{className:"footer-actions",children:[e.jsxs("button",{className:"btn btn-secondary",onClick:ut,disabled:p||!Ce,children:[e.jsx(Nv,{size:16})," Save Draft"]}),e.jsxs("button",{className:"btn btn-primary",onClick:qa,disabled:p||!Zp(da).valid,children:[e.jsx($d,{size:16})," Submit"]})]})]})]}),A&&e.jsx(Ny,{projectId:r.id,corId:i?.id,onImport:sa,onClose:()=>_(!1),onShowToast:g})]})}const Cr={PENDING:"pending",GENERATING:"generating",COMPLETED:"completed",FAILED:"failed"},Cy={PDF:"pdf"};function wy(r,l,c=null){if(c)return`custom_${c}`;const i=Math.floor(Date.now()/6e4);return`cor_${r}_v${l||1}_${i}`}function ky(r){return`cor_${r}_force_${Date.now()}`}function Ey(r,l,c={}){const i=new Date().toISOString(),d=[];let h=0;for(const C of l||[]){const U=C.photos||[];h+=U.length;for(const X of U)d.push({ticketId:C.id,workDate:C.work_date,url:X,verified:!1,includedInExport:!0})}const g=(r.change_order_labor||[]).reduce((C,U)=>C+(parseInt(U.total)||0),0),p=(r.change_order_materials||[]).reduce((C,U)=>C+(parseInt(U.total)||0),0),y=(r.change_order_equipment||[]).reduce((C,U)=>C+(parseInt(U.total)||0),0),m=(r.change_order_subcontractors||[]).reduce((C,U)=>C+(parseInt(U.total)||0),0);let v=0,A=0;for(const C of l||[])for(const U of C.t_and_m_workers||[])v+=parseFloat(U.hours)||0,A+=parseFloat(U.overtime_hours)||0;const _=JSON.stringify({corId:r.id,version:r.version,totals:{laborTotal:g,materialsTotal:p,equipmentTotal:y,subcontractorsTotal:m},ticketCount:l?.length||0,photoCount:h});let j=0;for(let C=0;C<_.length;C++){const U=_.charCodeAt(C);j=(j<<5)-j+U,j=j&j}const $=Math.abs(j).toString(16).padStart(16,"0");return{snapshotId:crypto.randomUUID(),corId:r.id,corVersion:r.version||1,createdAt:i,checksum:$,corData:{id:r.id,cor_number:r.cor_number,title:r.title,description:r.description,scope_of_work:r.scope_of_work,status:r.status,period_start:r.period_start,period_end:r.period_end,change_order_labor:r.change_order_labor||[],change_order_materials:r.change_order_materials||[],change_order_equipment:r.change_order_equipment||[],change_order_subcontractors:r.change_order_subcontractors||[],labor_markup_percent:r.labor_markup_percent,materials_markup_percent:r.materials_markup_percent,equipment_markup_percent:r.equipment_markup_percent,subcontractors_markup_percent:r.subcontractors_markup_percent,liability_insurance_percent:r.liability_insurance_percent,bond_percent:r.bond_percent,license_fee_percent:r.license_fee_percent,labor_subtotal:r.labor_subtotal,materials_subtotal:r.materials_subtotal,equipment_subtotal:r.equipment_subtotal,subcontractors_subtotal:r.subcontractors_subtotal,labor_markup_amount:r.labor_markup_amount,materials_markup_amount:r.materials_markup_amount,equipment_markup_amount:r.equipment_markup_amount,subcontractors_markup_amount:r.subcontractors_markup_amount,liability_insurance_amount:r.liability_insurance_amount,bond_amount:r.bond_amount,license_fee_amount:r.license_fee_amount,cor_subtotal:r.cor_subtotal,additional_fees_total:r.additional_fees_total,cor_total:r.cor_total,gc_signature_data:r.gc_signature_data,gc_signature_name:r.gc_signature_name,gc_signature_date:r.gc_signature_date,created_at:r.created_at,submitted_at:r.submitted_at,approved_at:r.approved_at},ticketsData:(l||[]).map(C=>({id:C.id,work_date:C.work_date,ticket_date:C.ticket_date,ce_pco_number:C.ce_pco_number,notes:C.notes,status:C.status,created_at:C.created_at,t_and_m_workers:(C.t_and_m_workers||[]).map(U=>({id:U.id,name:U.name,role:U.role,labor_class:U.labor_class,hours:U.hours,overtime_hours:U.overtime_hours,time_started:U.time_started,time_ended:U.time_ended})),t_and_m_items:(C.t_and_m_items||[]).map(U=>({id:U.id,description:U.description,quantity:U.quantity,unit:U.unit,materials_equipment:U.materials_equipment})),photos:C.photos||[],client_signature_data:C.client_signature_data,client_signature_name:C.client_signature_name,client_signature_title:C.client_signature_title,client_signature_company:C.client_signature_company,client_signature_date:C.client_signature_date})),photoManifest:d,totals:{laborTotal:g,materialsTotal:p,equipmentTotal:y,subcontractorsTotal:m,totalLaborHours:v,totalOTHours:A,ticketCount:l?.length||0,photoCount:h,verifiedTicketCount:(l||[]).filter(C=>C.client_signature_data).length}}}async function Dy(r,l={}){const{forceNew:c=!1,idempotencyKey:i=null,exportType:d=Cy.PDF,includeBackup:h=!0}=l;try{const{data:g,error:p}=await w.from("change_orders").select("id, version, cor_number").eq("id",r).single();if(p||!g)throw new Error(`COR not found: ${r}`);const y=c?ky(r):i||wy(r,g.version),{data:m,error:v}=await w.rpc("request_cor_export",{p_cor_id:r,p_idempotency_key:y,p_options:{exportType:d,includeBackup:h},p_requested_by:(await w.auth.getUser())?.data?.user?.id});if(v)throw v;const A=m?.[0];if(!A)throw new Error("Failed to create export job");return Et.activity("cor_export_requested",{cor_id:r,job_id:A.job_id,is_new:A.is_new,status:A.status}),{jobId:A.job_id,status:A.status,isNew:A.is_new,snapshotId:A.snapshot_id,pdfUrl:A.pdf_url,idempotencyKey:y}}catch(g){throw Et.error("cor_export_request_failed",{cor_id:r,error:g.message}),g}}async function bd(r,l,c={}){const{data:i,error:d}=await w.rpc("update_export_job_status",{p_job_id:r,p_status:l,p_snapshot_id:c.snapshotId||null,p_pdf_url:c.pdfUrl||null,p_error:c.error||null,p_error_details:c.errorDetails||null,p_metrics:c.metrics||null});if(d)throw Et.error("cor_export_job_update_failed",{job_id:r,status:l,error:d.message}),d;return i}async function Ty(r,l){await w.from("cor_export_snapshots").update({is_current:!1}).eq("cor_id",r.corId);const{data:c,error:i}=await w.from("cor_export_snapshots").insert({id:r.snapshotId,cor_id:r.corId,job_id:l,cor_version:r.corVersion,cor_data:r.corData,tickets_data:r.ticketsData,photos_manifest:r.photoManifest,totals_snapshot:r.totals,checksum:r.checksum,is_current:!0,exported_by:(await w.auth.getUser())?.data?.user?.id}).select().single();if(i)throw i;return await w.from("change_orders").update({last_snapshot_version:r.corVersion}).eq("id",r.corId),c}async function My(r,{cor:l,tickets:c,project:i,company:d,branding:h,options:g={}}={}){let p=null;try{if(p=await Dy(r,g),p.status===Cr.COMPLETED&&p.pdfUrl)return Et.activity("cor_export_cache_hit",{cor_id:r,job_id:p.jobId}),{success:!0,jobId:p.jobId,cached:!0,pdfUrl:p.pdfUrl};if(p.status===Cr.GENERATING)return{success:!0,jobId:p.jobId,status:Cr.GENERATING,message:"Export already in progress"};if(await bd(p.jobId,Cr.GENERATING),!l){const{db:_}=await ld(async()=>{const{db:j}=await Promise.resolve().then(()=>Lp);return{db:j}},void 0);l=await _.getCORById(r)}if(!c&&g.includeBackup!==!1){const{db:_}=await ld(async()=>{const{db:j}=await Promise.resolve().then(()=>Lp);return{db:j}},void 0);c=await _.getCORTickets(r)}const y=Ey(l,c,g),m=await Ty(y,p.jobId),{generatePDFFromSnapshot:v}=await ld(async()=>{const{generatePDFFromSnapshot:_}=await import("./corPdfGenerator-BJpfHtgs.js");return{generatePDFFromSnapshot:_}},__vite__mapDeps([0,1,2,3,4])),A=await v(y,{project:i,company:d,branding:h});return await bd(p.jobId,Cr.COMPLETED,{snapshotId:m.id,pdfUrl:A.fileName,metrics:{photo_count:y.totals.photoCount,ticket_count:y.totals.ticketCount,page_count:A.pageCount||1,pdf_size_bytes:A.sizeBytes||0}}),Et.activity("cor_export_completed",{cor_id:r,job_id:p.jobId,photo_count:y.totals.photoCount,ticket_count:y.totals.ticketCount}),{success:!0,jobId:p.jobId,snapshotId:m.id,fileName:A.fileName,snapshot:y.totals}}catch(y){throw p?.jobId&&await bd(p.jobId,Cr.FAILED,{error:y.message,errorDetails:{stack:y.stack}}).catch(()=>{}),Et.error("cor_export_failed",{cor_id:r,job_id:p?.jobId,error:y.message}),y}}function zy({onSave:r,onClose:l,signerName:c=""}){const i=x.useRef(null),[d,h]=x.useState(c),[g,p]=x.useState(!1),[y,m]=x.useState(!1),v=()=>{const V=i.current;return V?V.getContext("2d"):null},A=V=>{const q=i.current;if(!q)return{x:0,y:0};const E=q.getBoundingClientRect(),W=q.width/E.width,ue=q.height/E.height,ae=V.touches?V.touches[0].clientX:V.clientX,Y=V.touches?V.touches[0].clientY:V.clientY;return{x:(ae-E.left)*W,y:(Y-E.top)*ue}},_=V=>{V.preventDefault();const q=v();if(!q)return;const{x:E,y:W}=A(V);q.beginPath(),q.moveTo(E,W),m(!0),p(!0)},j=V=>{if(!y)return;V.preventDefault();const q=v();if(!q)return;const{x:E,y:W}=A(V);q.lineTo(E,W),q.stroke()},$=()=>{m(!1)},C=()=>{const V=i.current,q=v();!V||!q||(q.clearRect(0,0,V.width,V.height),p(!1))},U=V=>{if(!V)return;i.current=V;const q=V.getContext("2d");q.strokeStyle="#1e293b",q.lineWidth=2,q.lineCap="round",q.lineJoin="round"},X=()=>{if(!g||!d.trim())return;const V=i.current;if(!V)return;const q=V.toDataURL("image/png");r({signature:q,signerName:d.trim(),signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:l,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal",onClick:V=>V.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:"signature-title",children:"GC Signature"}),e.jsx("button",{className:"close-btn",onClick:l,"aria-label":"Close signature modal",children:e.jsx(Ra,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-name",children:"Signer Name *"}),e.jsx("input",{id:"signer-name",type:"text",value:d,onChange:V=>h(V.target.value),placeholder:"Enter full name","aria-required":"true"})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(Hd,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Sign below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:U,width:500,height:200,className:"signature-canvas",onMouseDown:_,onMouseMove:j,onMouseUp:$,onMouseLeave:$,onTouchStart:_,onTouchMove:j,onTouchEnd:$,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!g&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:C,disabled:!g,"aria-label":"Clear signature",children:[e.jsx(_l,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("p",{className:"signature-legal",role:"note",children:"By signing above, I acknowledge that I have reviewed and approve this Change Order Request."})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:l,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:X,disabled:!g||!d.trim(),"aria-label":"Save signature",children:[e.jsx(Aa,{size:16,"aria-hidden":"true"})," Save Signature"]})]})]})})}function Ay({cor:r,project:l,company:c,areas:i,onClose:d,onEdit:h,onShowToast:g,onStatusChange:p}){const[y,m]=x.useState(!0),[v,A]=x.useState(r),[_,j]=x.useState(!1),[$,C]=x.useState(!1),[U,X]=x.useState(new Set),[V,q]=x.useState(null),[E,W]=x.useState(!1),[ue,ae]=x.useState(""),Y=x.useCallback(async()=>{try{const F=await K.getCORById(r.id);F&&A(F)}catch(F){console.error("Error fetching COR details:",F),g?.("Error loading COR details","error")}finally{m(!1)}},[r.id,g]);x.useEffect(()=>{Y()},[Y]),x.useEffect(()=>{const F=K.subscribeToCorTickets?.(r.id,()=>{Y()});return()=>{F&&K.unsubscribe?.(F)}},[r.id,Y]);const P=x.useMemo(()=>Ji(v),[v]),ce=Mf(v.status),M=v.status==="pending_approval",b=["draft","pending_approval","approved"].includes(v.status),R=F=>i?.find(de=>de.id===F)?.name||null,B=async()=>{if(confirm("Approve this change order request?")){m(!0);try{await K.approveCOR(v.id),A({...v,status:"approved",approved_at:new Date().toISOString()}),g?.("COR approved","success"),p?.()}catch(F){console.error("Error approving COR:",F),g?.("Error approving COR","error")}finally{m(!1)}}},me=async()=>{const F=prompt("Enter rejection reason (optional):");if(F!==null){m(!0);try{await K.rejectCOR(v.id,F),A({...v,status:"rejected",rejection_reason:F}),g?.("COR rejected","success"),p?.()}catch(fe){console.error("Error rejecting COR:",fe),g?.("Error rejecting COR","error")}finally{m(!1)}}},T=async()=>{if(confirm("Mark this COR as billed?")){m(!0);try{await K.markCORAsBilled(v.id),A({...v,status:"billed"}),g?.("COR marked as billed","success"),p?.()}catch(F){console.error("Error marking COR as billed:",F),g?.("Error updating status","error")}finally{m(!1)}}},ee=async F=>{m(!0);try{await K.saveCORSignature?.(v.id,{gc_signature:F.signature,gc_signer_name:F.signerName,signed_at:F.signedAt}),A({...v,gc_signature:F.signature,gc_signer_name:F.signerName,signed_at:F.signedAt}),j(!1),g?.("Signature saved","success"),p?.()}catch(fe){console.error("Error saving signature:",fe),g?.("Error saving signature","error")}finally{m(!1)}},k=v.status==="approved"&&!v.gc_signature,pe=async()=>{if(!ue.trim()){W(!1);return}m(!0);try{await K.updateCOR(v.id,{cor_number:ue.trim()}),A({...v,cor_number:ue.trim()}),W(!1),g?.("COR number updated","success")}catch(F){console.error("Error updating COR number:",F),g?.("Error updating COR number","error")}finally{m(!1)}},D=()=>{ae(v.cor_number||""),W(!0)},z=F=>{X(fe=>{const de=new Set(fe);return de.has(F)?de.delete(F):de.add(F),de})},se=x.useMemo(()=>v.change_order_ticket_associations?.map(F=>F.t_and_m_tickets).filter(Boolean)||[],[v.change_order_ticket_associations]),Z=F=>{const fe=F.t_and_m_workers||[],de=fe.reduce((Fe,ze)=>Fe+(parseFloat(ze.hours)||0),0),ye=fe.reduce((Fe,ze)=>Fe+(parseFloat(ze.overtime_hours)||0),0);return{regular:de,overtime:ye,total:de+ye}},ne=async()=>{try{g?.("Generating PDF with backup...","info"),(await My(v.id,{cor:v,tickets:se,project:l,company:c,branding:{logoUrl:c?.logo_url,primaryColor:c?.branding_color},options:{includeBackup:!0}})).cached?g?.("PDF downloaded (cached)","success"):g?.("PDF downloaded","success")}catch(F){console.error("Error exporting PDF:",F),g?.("Error generating PDF","error")}};return y?e.jsx("div",{className:"modal-overlay",onClick:d,children:e.jsx("div",{className:"modal-content cor-detail-modal",onClick:F=>F.stopPropagation(),children:e.jsx("div",{className:"cor-detail-loading",children:"Loading COR details..."})})}):e.jsxs("div",{className:"modal-overlay",onClick:d,role:"dialog","aria-modal":"true","aria-labelledby":"cor-detail-title",children:[e.jsxs("div",{className:"modal-content cor-detail-modal",onClick:F=>F.stopPropagation(),children:[e.jsxs("div",{className:"modal-header cor-detail-header",children:[e.jsxs("div",{className:"cor-detail-title-row",children:[e.jsxs("div",{children:[e.jsx("div",{className:"cor-detail-number",children:E?e.jsxs("div",{className:"cor-number-edit",children:[e.jsx("input",{type:"text",value:ue,onChange:F=>ae(F.target.value),onKeyDown:F=>{F.key==="Enter"&&pe(),F.key==="Escape"&&W(!1)},autoFocus:!0,className:"cor-number-input"}),e.jsx("button",{className:"btn-icon-sm",onClick:pe,title:"Save",children:e.jsx(Aa,{size:14})}),e.jsx("button",{className:"btn-icon-sm",onClick:()=>W(!1),title:"Cancel",children:e.jsx(Ra,{size:14})})]}):e.jsxs("div",{className:"cor-number-display",children:[e.jsx("span",{children:v.cor_number}),b&&e.jsx("button",{className:"btn-icon-sm",onClick:D,title:"Edit COR number",children:e.jsx(Bd,{size:12})})]})}),e.jsx("h2",{id:"cor-detail-title",children:v.title||"Untitled COR"})]}),e.jsx("button",{className:"close-btn",onClick:d,"aria-label":"Close COR details",children:e.jsx(Ra,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"cor-detail-meta",children:[e.jsx("span",{className:"cor-detail-status",style:{backgroundColor:ce.bgColor,color:ce.color},children:ce.label}),v.group_name&&e.jsx("span",{className:"cor-detail-group",children:v.group_name}),R(v.area_id)&&e.jsx("span",{className:"cor-detail-area",children:R(v.area_id)}),e.jsxs("span",{className:"cor-detail-period",children:[e.jsx(jn,{size:14})," ",Wi(v.period_start,v.period_end)]})]})]}),e.jsxs("div",{className:"modal-body cor-detail-body",children:[e.jsxs("div",{className:"cor-detail-section",children:[e.jsxs("h3",{children:[e.jsx(Oa,{size:18})," Scope of Work"]}),e.jsx("p",{className:"cor-scope-text",children:v.scope_of_work||"No scope of work provided."})]}),e.jsxs("div",{className:"cor-detail-section pricing-breakdown",children:[e.jsxs("h3",{children:[e.jsx(Er,{size:18})," Pricing Breakdown"]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx($s,{size:16}),e.jsx("span",{children:"Labor"})]}),e.jsx("span",{className:"category-subtotal",children:Ue(P.labor_subtotal)})]}),v.change_order_labor?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"Reg Rate"}),e.jsx("th",{children:"OT Hrs"}),e.jsx("th",{children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:v.change_order_labor.map((F,fe)=>e.jsxs("tr",{children:[e.jsx("td",{children:F.labor_class}),e.jsx("td",{children:F.wage_type}),e.jsx("td",{children:F.regular_hours}),e.jsxs("td",{children:["$",os(F.regular_rate),"/hr"]}),e.jsx("td",{children:F.overtime_hours||"-"}),e.jsx("td",{children:F.overtime_hours?`$${os(F.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:Ue(F.total)})]},fe))})]})}):e.jsx("div",{className:"category-empty",children:"No labor items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",oa(v.labor_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Ue(P.labor_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(Hs,{size:16}),e.jsx("span",{children:"Materials"})]}),e.jsx("span",{className:"category-subtotal",children:Ue(P.materials_subtotal)})]}),v.change_order_materials?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:v.change_order_materials.map((F,fe)=>e.jsxs("tr",{children:[e.jsx("td",{children:F.description}),e.jsx("td",{children:F.source_reference||F.source_type}),e.jsx("td",{children:F.quantity}),e.jsx("td",{children:F.unit}),e.jsxs("td",{children:["$",os(F.unit_cost)]}),e.jsx("td",{className:"text-right",children:Ue(F.total)})]},fe))})]})}):e.jsx("div",{className:"category-empty",children:"No material items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",oa(v.materials_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Ue(P.materials_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(ds,{size:16}),e.jsx("span",{children:"Equipment"})]}),e.jsx("span",{className:"category-subtotal",children:Ue(P.equipment_subtotal)})]}),v.change_order_equipment?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:v.change_order_equipment.map((F,fe)=>e.jsxs("tr",{children:[e.jsx("td",{children:F.description}),e.jsx("td",{children:F.source_reference||F.source_type}),e.jsx("td",{children:F.quantity}),e.jsx("td",{children:F.unit}),e.jsxs("td",{children:["$",os(F.unit_cost)]}),e.jsx("td",{className:"text-right",children:Ue(F.total)})]},fe))})]})}):e.jsx("div",{className:"category-empty",children:"No equipment items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",oa(v.equipment_markup_percent||1500),")"]}),e.jsxs("span",{children:["+",Ue(P.equipment_markup_amount)]})]})]}),e.jsxs("div",{className:"pricing-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(Cl,{size:16}),e.jsx("span",{children:"Subcontractors"})]}),e.jsx("span",{className:"category-subtotal",children:Ue(P.subcontractors_subtotal)})]}),v.change_order_subcontractors?.length>0?e.jsx("div",{className:"category-items",children:e.jsxs("table",{className:"pricing-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:v.change_order_subcontractors.map((F,fe)=>e.jsxs("tr",{children:[e.jsx("td",{children:F.company_name}),e.jsx("td",{children:F.description}),e.jsx("td",{children:F.source_reference||F.source_type}),e.jsx("td",{className:"text-right",children:Ue(F.total)})]},fe))})]})}):e.jsx("div",{className:"category-empty",children:"No subcontractor items"}),e.jsxs("div",{className:"category-markup",children:[e.jsxs("span",{children:["Markup (",oa(v.subcontractors_markup_percent||500),")"]}),e.jsxs("span",{children:["+",Ue(P.subcontractors_markup_amount)]})]})]}),e.jsxs("div",{className:"cor-subtotal-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:Ue(P.cor_subtotal)})]}),e.jsxs("div",{className:"pricing-category fees-category",children:[e.jsxs("div",{className:"category-header",children:[e.jsxs("div",{className:"category-title",children:[e.jsx(gv,{size:16}),e.jsx("span",{children:"Additional Fees"})]}),e.jsx("span",{className:"category-subtotal",children:Ue(P.additional_fees_total)})]}),e.jsxs("div",{className:"fees-list",children:[e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Zi,{size:14}),e.jsxs("span",{children:["Liability Insurance (",oa(v.liability_insurance_percent||144),")"]})]}),e.jsx("span",{className:"fee-amount",children:Ue(P.liability_insurance_amount)})]}),e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Oa,{size:14}),e.jsxs("span",{children:["Bond (",oa(v.bond_percent||100),")"]})]}),e.jsx("span",{className:"fee-amount",children:Ue(P.bond_amount)})]}),e.jsxs("div",{className:"fee-row",children:[e.jsxs("div",{className:"fee-label",children:[e.jsx(Qi,{size:14}),e.jsxs("span",{children:["City License Fee (",oa(v.license_fee_percent||10),")"]})]}),e.jsx("span",{className:"fee-amount",children:Ue(P.license_fee_amount)})]})]})]}),e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:Ue(P.cor_total)})]})]}),se.length>0&&e.jsxs("div",{className:"cor-detail-section backup-section",children:[e.jsxs("h3",{children:[e.jsx(Oa,{size:18})," Backup Documentation"]}),e.jsxs("p",{className:"backup-summary",children:[se.length," T&M ticket",se.length!==1?"s":""," associated with this COR"]}),e.jsx("div",{className:"backup-tickets-list",children:se.map(F=>{const fe=U.has(F.id),de=Z(F),ye=F.t_and_m_workers?.length||0,Fe=F.t_and_m_items?.length||0,ze=F.photos?.length||0;return e.jsxs("div",{className:"backup-ticket-card",children:[e.jsxs("div",{className:"backup-ticket-header",onClick:()=>z(F.id),children:[e.jsx("div",{className:"backup-ticket-toggle",children:fe?e.jsx(Ma,{size:18}):e.jsx(Bs,{size:18})}),e.jsxs("div",{className:"backup-ticket-info",children:[e.jsxs("div",{className:"backup-ticket-date",children:[e.jsx(Gn,{size:14}),e.jsx("span",{children:Na(F.work_date)})]}),F.ce_pco_number&&e.jsxs("span",{className:"backup-ticket-pco",children:["CE/PCO: ",F.ce_pco_number]})]}),e.jsxs("div",{className:"backup-ticket-stats",children:[e.jsxs("span",{className:"backup-stat",children:[e.jsx($s,{size:14})," ",ye]}),e.jsxs("span",{className:"backup-stat",children:[de.total.toFixed(1)," hrs"]}),ze>0&&e.jsxs("span",{className:"backup-stat",children:[e.jsx(Zj,{size:14})," ",ze]}),F.client_signature_data&&e.jsxs("span",{className:"backup-stat verified",title:`Verified by ${F.client_signature_name}`,children:[e.jsx(fd,{size:14})," Verified"]})]}),e.jsx("span",{className:`backup-ticket-status status-${F.status}`,children:F.status})]}),fe&&e.jsxs("div",{className:"backup-ticket-details",children:[F.notes&&e.jsxs("div",{className:"backup-ticket-notes",children:[e.jsx("strong",{children:"Notes:"})," ",F.notes]}),F.t_and_m_workers?.length>0&&e.jsxs("div",{className:"backup-workers",children:[e.jsxs("h4",{children:["Labor (",ye," workers)"]}),e.jsxs("table",{className:"backup-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Time"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"OT Hrs"})]})}),e.jsx("tbody",{children:F.t_and_m_workers.map((Me,nt)=>e.jsxs("tr",{children:[e.jsx("td",{children:Me.name}),e.jsx("td",{children:Me.role||"-"}),e.jsx("td",{className:"backup-time-range",children:Me.time_started&&Me.time_ended?`${Me.time_started} - ${Me.time_ended}`:"-"}),e.jsx("td",{children:Me.hours||0}),e.jsx("td",{children:Me.overtime_hours||"-"})]},nt))})]})]}),F.t_and_m_items?.length>0&&e.jsxs("div",{className:"backup-items",children:[e.jsxs("h4",{children:["Materials & Equipment (",Fe," items)"]}),e.jsxs("table",{className:"backup-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Qty"})]})}),e.jsx("tbody",{children:F.t_and_m_items.map((Me,nt)=>e.jsxs("tr",{children:[e.jsx("td",{children:Me.materials_equipment?.name||Me.custom_name||"Item"}),e.jsx("td",{children:Me.materials_equipment?.category||Me.custom_category||"-"}),e.jsx("td",{children:Me.quantity})]},nt))})]})]}),F.photos?.length>0&&e.jsxs("div",{className:"backup-photos",children:[e.jsxs("h4",{children:["Photos (",ze,")"]}),e.jsx("div",{className:"backup-photos-grid",children:F.photos.map((Me,nt)=>e.jsx("div",{className:"backup-photo-thumb",onClick:()=>q(Me),children:e.jsx("img",{src:Me,alt:`Photo ${nt+1}`})},nt))})]}),F.client_signature_data&&e.jsxs("div",{className:"backup-verification",children:[e.jsxs("h4",{children:[e.jsx(fd,{size:14})," Client Verification"]}),e.jsxs("div",{className:"backup-signature-display",children:[e.jsx("img",{src:F.client_signature_data,alt:"Client Signature",className:"backup-signature-image"}),e.jsxs("div",{className:"backup-signature-info",children:[e.jsx("span",{className:"backup-signer-name",children:F.client_signature_name}),F.client_signature_title&&e.jsx("span",{className:"backup-signer-title",children:F.client_signature_title}),F.client_signature_company&&e.jsx("span",{className:"backup-signer-company",children:F.client_signature_company}),e.jsxs("span",{className:"backup-signed-date",children:["Verified: ",Na(F.client_signature_date)]})]})]})]})]})]},F.id)})})]}),(v.gc_signature_data||v.gc_signature||v.client_signature_data)&&e.jsxs("div",{className:"cor-detail-section signature-section",children:[e.jsxs("h3",{children:[e.jsx(Mv,{size:18})," Signatures"]}),e.jsxs("div",{className:"dual-signatures",children:[(v.gc_signature_data||v.gc_signature)&&e.jsxs("div",{className:"signature-block",children:[e.jsx("span",{className:"signature-label",children:"GC Authorization"}),e.jsxs("div",{className:"signature-display",children:[e.jsx("img",{src:v.gc_signature_data||v.gc_signature,alt:"GC Signature",className:"signature-image"}),e.jsxs("div",{className:"signature-info",children:[e.jsx("span",{className:"signer-name",children:v.gc_signature_name||v.gc_signer_name}),(v.gc_signature_title||v.gc_signature_company)&&e.jsxs("span",{className:"signer-org",children:[v.gc_signature_title,v.gc_signature_title&&v.gc_signature_company&&" - ",v.gc_signature_company]}),e.jsxs("span",{className:"signed-date",children:["Signed: ",Na(v.gc_signature_date||v.signed_at)]})]})]})]}),v.client_signature_data&&e.jsxs("div",{className:"signature-block",children:[e.jsx("span",{className:"signature-label",children:"Client Authorization"}),e.jsxs("div",{className:"signature-display",children:[e.jsx("img",{src:v.client_signature_data,alt:"Client Signature",className:"signature-image"}),e.jsxs("div",{className:"signature-info",children:[e.jsx("span",{className:"signer-name",children:v.client_signature_name}),(v.client_signature_title||v.client_signature_company)&&e.jsxs("span",{className:"signer-org",children:[v.client_signature_title,v.client_signature_title&&v.client_signature_company&&" - ",v.client_signature_company]}),e.jsxs("span",{className:"signed-date",children:["Signed: ",Na(v.client_signature_date)]})]})]})]})]})]}),v.status==="rejected"&&v.rejection_reason&&e.jsxs("div",{className:"cor-detail-section rejection-section",children:[e.jsxs("h3",{children:[e.jsx(Hp,{size:18})," Rejection Reason"]}),e.jsx("p",{className:"rejection-text",children:v.rejection_reason})]})]}),e.jsxs("div",{className:"modal-footer cor-detail-footer",children:[e.jsxs("div",{className:"footer-info",children:[e.jsxs("span",{children:["Created: ",Na(v.created_at)]}),v.approved_at&&e.jsxs("span",{children:["Approved: ",Na(v.approved_at)]})]}),e.jsxs("div",{className:"footer-actions",role:"group","aria-label":"COR actions",children:[b&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>h?.(v),disabled:y,"aria-label":"Edit this COR",children:[e.jsx(bl,{size:16,"aria-hidden":"true"})," Edit"]}),M&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"btn btn-danger",onClick:me,disabled:y,"aria-label":"Reject this COR",children:[e.jsx(Hp,{size:16,"aria-hidden":"true"})," Reject"]}),e.jsxs("button",{className:"btn btn-success",onClick:B,disabled:y,"aria-label":"Approve this COR",children:[e.jsx(Ta,{size:16,"aria-hidden":"true"})," Approve"]})]}),k&&e.jsxs("button",{className:"btn btn-success",onClick:()=>j(!0),disabled:y,"aria-label":"Get GC signature for this COR",children:[e.jsx(fd,{size:16,"aria-hidden":"true"})," Get GC Signature"]}),(v.status==="approved"||v.status==="pending_approval")&&e.jsxs("button",{className:"btn btn-secondary",onClick:()=>C(!0),disabled:y,"aria-label":"Get shareable signature link",children:[e.jsx(Ud,{size:16,"aria-hidden":"true"})," Get Signature Link"]}),v.status==="approved"&&e.jsxs("button",{className:"btn btn-primary",onClick:T,disabled:y,"aria-label":"Mark this COR as billed",children:[e.jsx(Er,{size:16,"aria-hidden":"true"})," Mark Billed"]}),e.jsxs("button",{className:"btn btn-secondary",onClick:ne,"aria-label":"Export COR to PDF",children:[e.jsx(Ii,{size:16,"aria-hidden":"true"})," Export PDF"]})]})]})]}),_&&e.jsx(zy,{onSave:ee,onClose:()=>j(!1),signerName:""}),$&&e.jsx(Vd,{documentType:"cor",documentId:v.id,companyId:c?.id,projectId:l?.id,documentTitle:`COR ${v.cor_number}: ${v.title||"Untitled"}`,onClose:()=>C(!1),onShowToast:g}),V&&e.jsxs("div",{className:"photo-lightbox",onClick:()=>q(null),children:[e.jsx("button",{className:"lightbox-close",onClick:()=>q(null),children:e.jsx(Ra,{size:24})}),e.jsx("img",{src:V,alt:"Full size photo",onClick:F=>F.stopPropagation()})]})]})}const pn=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0),Oy=r=>new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric"});function Ry({dailyBurn:r,totalBurn:l,daysWorked:c,laborCost:i,haulOffCost:d,progress:h,contractValue:g,laborByDate:p=[],haulOffByDate:y=[]}){const[m,v]=x.useState(!1),A=g*(h/100)*.6,_=l<=A?"on-budget":l<=A*1.2?"warning":"over-budget",j={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[_],$=_==="on-budget"?Nf:_==="warning"?Od:Sf,U=h>0?l/(h/100):0,X=[],V={};p.forEach(E=>{V[E.date]||(V[E.date]={date:E.date,labor:0,haulOff:0,total:0}),V[E.date].labor=E.cost||0,V[E.date].total+=E.cost||0}),y.forEach(E=>{V[E.date]||(V[E.date]={date:E.date,labor:0,haulOff:0,total:0}),V[E.date].haulOff=E.cost||0,V[E.date].total+=E.cost||0}),Object.values(V).sort((E,W)=>new Date(W.date)-new Date(E.date)).slice(0,10).forEach(E=>X.push(E));const q=Math.max(...X.map(E=>E.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(Pj,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${_}`,children:[e.jsx($,{size:14}),e.jsx("span",{children:j})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:pn(r)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),c>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",c," work day",c!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:pn(l)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:pn(i)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Disposal"}),e.jsx("span",{className:"burn-summary-value",children:pn(d)})]})]}),h>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${U>g*.7?"warning":""}`,children:pn(U)})]}),X.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>v(!m),children:[m?e.jsx(vf,{size:16}):e.jsx(Ma,{size:16}),e.jsxs("span",{children:[m?"Hide":"View"," Daily Breakdown"]})]}),m&&X.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Disposal"}),e.jsx("span",{children:"Total"})]}),X.map(E=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:Oy(E.date)}),e.jsx("span",{className:"burn-labor",children:E.labor>0?pn(E.labor):"-"}),e.jsx("span",{className:"burn-hauloff",children:E.haulOff>0?pn(E.haulOff):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${E.total/q*100}%`}}),e.jsx("span",{className:"burn-amount",children:pn(E.total)})]})]},E.date))]})]})}const _d=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0),$i={labor:{label:"Labor",Icon:Da,color:"#3b82f6"},disposal:{label:"Disposal",Icon:ds,color:"#10b981"},equipment:{label:"Equipment",Icon:wl,color:"#f59e0b"},materials:{label:"Materials",Icon:Hs,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:$s,color:"#ec4899"},other:{label:"Other",Icon:yf,color:"#6b7280"}};function qy({laborCost:r=0,haulOffCost:l=0,customCosts:c=[],onAddCost:i,onDeleteCost:d}){const[h,g]=x.useState(!1),[p,y]=x.useState(null),m=[];r>0&&m.push({category:"labor",label:"Labor",amount:r,source:"auto",description:"From crew check-ins"}),l>0&&m.push({category:"disposal",label:"Disposal",amount:l,source:"auto",description:"From haul-off logs"});const v={};c.forEach(j=>{v[j.category]||(v[j.category]={category:j.category,items:[],total:0}),v[j.category].items.push(j),v[j.category].total+=parseFloat(j.amount)||0}),Object.values(v).forEach(j=>{const $=$i[j.category]||$i.other;m.push({category:j.category,label:$.label,amount:j.total,source:"manual",items:j.items})});const A=m.reduce((j,$)=>j+$.amount,0);m.forEach(j=>{j.percentage=A>0?j.amount/A*100:0}),m.sort((j,$)=>$.amount-j.amount);const _=j=>{y(p===j?null:j)};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:_d(A)})]}),m.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):e.jsx("div",{className:"cost-breakdown",children:m.map(j=>{const $=$i[j.category]||$i.other,C=$.Icon,U=j.items&&j.items.length>0,X=p===j.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${U?"expandable":""}`,onClick:()=>U&&_(j.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(j.percentage,2)}%`,backgroundColor:$.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(C,{size:14,style:{color:$.color}}),e.jsx("span",{children:j.label}),j.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),U&&(X?e.jsx(vf,{size:14}):e.jsx(Ma,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:_d(j.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(j.percentage),"%"]})]})]})]}),X&&U&&e.jsx("div",{className:"cost-category-items",children:j.items.map(V=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:V.description}),e.jsx("span",{className:"cost-item-date",children:new Date(V.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:_d(V.amount)}),d&&e.jsx("button",{className:"cost-item-delete",onClick:q=>{q.stopPropagation(),confirm("Delete this cost entry?")&&d(V.id)},children:e.jsx(Us,{size:14})})]})]},V.id))})]},j.category)})}),i&&e.jsxs("button",{className:"cost-add-btn",onClick:i,children:[e.jsx(ys,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const Hn=r=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r||0);function Fy({revenue:r,totalCosts:l,contractValue:c,progress:i}){const d=r-l,h=r>0?d/r*100:0,g=c,p=i>0?l/(i/100):l,y=g-p,m=g>0?y/g*100:0,v=h>=20,A=h>=0&&h<20,_=h<0,j=v?"healthy":A?"warning":"loss",$=v?"On Track":A?"Watch Margin":"Over Cost",C=v?Ta:A?vn:Nf;return e.jsxs("div",{className:`profitability-card ${j}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${j}`,children:[e.jsx(C,{size:14}),e.jsx("span",{children:$})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${h<0?"negative":""}`,children:[Math.round(h),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${h<0?"negative":h<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(h),100)}%`}})})]}),i>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${m<0?"negative":""}`,children:[Math.round(m),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${m<0?"negative":m<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(m),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:Hn(r)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",Hn(l)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${d<0?"negative":"positive"}`,children:[d>=0?"":"-",Hn(Math.abs(d))]})]})]}),i>10&&e.jsxs("div",{className:"profitability-insight",children:[v&&e.jsxs("p",{children:["At ",Math.round(i),"% complete, you're at ",Hn(d)," profit.",y>0&&` Projected final profit: ${Hn(y)}`]}),A&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",y<0&&` Trending toward ${Hn(y)} loss.`]}),_&&e.jsxs("p",{children:["Currently over cost by ",Hn(Math.abs(d)),". Immediate review recommended."]})]})]})}const Ly={concrete:{label:"Concrete",icon:"",color:"#6b7280"},trash:{label:"Trash",icon:"",color:"#10b981"},metals:{label:"Metals",icon:"",color:"#3b82f6"},hazardous_waste:{label:"Hazardous Waste",icon:"",color:"#f59e0b"}};function Uy({project:r,period:l="week"}){const[c,i]=x.useState([]),[d,h]=x.useState([]),[g,p]=x.useState(!0),y=()=>{const _=new Date,j=new Date;switch(l){case"week":j.setDate(j.getDate()-7);break;case"month":j.setMonth(j.getMonth()-1);break;case"all":j.setFullYear(2020);break;default:j.setDate(j.getDate()-7)}return{startDate:j.toISOString().split("T")[0],endDate:_.toISOString().split("T")[0]}};x.useEffect(()=>{m()},[r.id,l]);const m=async()=>{try{p(!0);const{startDate:_,endDate:j}=y(),[$,C]=await Promise.all([K.getDisposalSummary(r.id,_,j),K.getWeeklyDisposalSummary(r.id,4)]);i($||[]),h(C||[])}catch(_){console.error("Error loading disposal summary:",_)}finally{p(!1)}},v=c.reduce((_,j)=>_+(j.total_loads||0),0),A={week:"This Week",month:"This Month",all:"All Time"}[l]||"This Week";return g?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(ds,{size:20}),e.jsx("span",{children:"Disposal Activity"})]}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):v===0?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx(ds,{size:20}),e.jsx("span",{children:"Disposal Activity"})]}),e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("p",{className:"text-muted",children:A})]})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(ds,{size:20}),e.jsx("span",{children:"Disposal Activity"})]}),e.jsx("span",{className:"period-badge",children:A})]}),e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"total-number",children:v}),e.jsx("span",{className:"total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:c.map(_=>{const j=Ly[_.load_type]||{label:_.load_type,icon:"",color:"#6b7280"},$=Math.round(_.total_loads/v*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"type-info",children:[e.jsx("span",{className:"type-icon",children:j.icon}),e.jsx("span",{className:"type-label",children:j.label})]}),e.jsxs("div",{className:"type-stats",children:[e.jsx("div",{className:"type-bar-container",children:e.jsx("div",{className:"type-bar",style:{width:`${$}%`,backgroundColor:j.color}})}),e.jsx("span",{className:"type-count",children:_.total_loads})]})]},_.load_type)})}),d.length>1&&e.jsxs("div",{className:"disposal-trend",children:[e.jsxs("div",{className:"trend-header",children:[e.jsx(Sf,{size:16}),e.jsx("span",{children:"Weekly Trend"})]}),e.jsx("div",{className:"trend-chart",children:d.map((_,j)=>{const $=_.concrete+_.trash+_.metals+_.hazardous_waste,C=Math.max(...d.map(X=>X.concrete+X.trash+X.metals+X.hazardous_waste)),U=C>0?$/C*100:0;return e.jsxs("div",{className:"trend-bar-wrapper",children:[e.jsx("div",{className:"trend-bar",style:{height:`${U}%`},title:`Week of ${_.week}: ${$} loads`}),e.jsxs("span",{className:"trend-label",children:["W",j+1]})]},_.week)})})]}),c.length>0&&c[0].days_with_activity&&e.jsxs("div",{className:"disposal-activity-days",children:[e.jsx(Gn,{size:14}),e.jsxs("span",{children:[c.reduce((_,j)=>Math.max(_,j.days_with_activity||0),0)," days with disposal activity"]})]})]})}const Hy=[{value:"labor",label:"Labor",Icon:Da,description:"Additional labor costs"},{value:"materials",label:"Materials",Icon:Hs,description:"Materials and supplies"},{value:"equipment",label:"Equipment",Icon:wl,description:"Equipment rental or purchase"},{value:"subcontractor",label:"Subcontractor",Icon:$s,description:"Subcontractor work"},{value:"disposal",label:"Disposal",Icon:ds,description:"Additional disposal costs"},{value:"other",label:"Other",Icon:yf,description:"Miscellaneous costs"}];function By({onClose:r,onSave:l,saving:c=!1}){const[i,d]=x.useState({category:"materials",description:"",amount:"",cost_date:new Date().toISOString().split("T")[0],notes:""}),[h,g]=x.useState({}),p=(v,A)=>{d(_=>({..._,[v]:A})),h[v]&&g(_=>({..._,[v]:null}))},y=()=>{const v={};i.description.trim()||(v.description="Description is required");const A=parseFloat(i.amount);return(isNaN(A)||A<=0)&&(v.amount="Enter a valid amount"),i.cost_date||(v.cost_date="Date is required"),g(v),Object.keys(v).length===0},m=v=>{v.preventDefault(),y()&&l(i)};return e.jsx("div",{className:"modal-overlay",onClick:r,role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"modal-content add-cost-modal",onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:[e.jsx(Er,{size:20}),"Add Cost"]}),e.jsx("button",{className:"close-btn",onClick:r,"aria-label":"Close",children:e.jsx(Ra,{size:20})})]}),e.jsxs("form",{onSubmit:m,children:[e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category *"}),e.jsx("div",{className:"category-grid",children:Hy.map(v=>{const A=v.Icon,_=i.category===v.value;return e.jsxs("button",{type:"button",className:`category-option ${_?"selected":""}`,onClick:()=>p("category",v.value),children:[e.jsx(A,{size:18}),e.jsx("span",{className:"category-label",children:v.label})]},v.value)})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-description",children:"Description *"}),e.jsx("input",{id:"cost-description",type:"text",value:i.description,onChange:v=>p("description",v.target.value),placeholder:"e.g., Excavator rental - Week 1",className:h.description?"error":""}),h.description&&e.jsx("span",{className:"form-error",children:h.description})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-amount",children:"Amount *"}),e.jsxs("div",{className:"input-with-prefix",children:[e.jsx("span",{className:"input-prefix",children:"$"}),e.jsx("input",{id:"cost-amount",type:"text",inputMode:"decimal",value:i.amount,onChange:v=>{const A=v.target.value.replace(/[^0-9.]/g,"");p("amount",A)},placeholder:"0.00",className:h.amount?"error":""})]}),h.amount&&e.jsx("span",{className:"form-error",children:h.amount})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-date",children:"Date *"}),e.jsx("input",{id:"cost-date",type:"date",value:i.cost_date,onChange:v=>p("cost_date",v.target.value),className:h.cost_date?"error":""}),h.cost_date&&e.jsx("span",{className:"form-error",children:h.cost_date})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"cost-notes",children:"Notes (optional)"}),e.jsx("textarea",{id:"cost-notes",value:i.notes,onChange:v=>p("notes",v.target.value),placeholder:"Additional details...",rows:2})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:r,disabled:c,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:c,children:c?"Saving...":"Add Cost"})]})]})]})})}const Kp=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function $y({project:r,company:l,user:c,isAdmin:i,onShowToast:d}){const[h,g]=x.useState([]),[p,y]=x.useState([]),[m,v]=x.useState(!0),[A,_]=x.useState(!1),[j,$]=x.useState(""),[C,U]=x.useState("Team Member"),[X,V]=x.useState(null);x.useEffect(()=>{r?.id&&q()},[r?.id]),x.useEffect(()=>{A&&l?.id&&E()},[A,l?.id]);const q=async()=>{try{v(!0);const Y=await K.getProjectTeam(r.id);g(Y)}catch(Y){console.error("Error loading project team:",Y)}finally{v(!1)}},E=async()=>{try{const Y=await K.getCompanyMembers(l.id),P=h.map(M=>M.users?.id),ce=Y.filter(M=>!P.includes(M.users?.id));y(ce)}catch(Y){console.error("Error loading company members:",Y)}},W=async()=>{if(!j){d("Select a team member","error");return}try{V("add"),await K.addProjectMember(r.id,j,C,c.id),d("Team member added","success"),_(!1),$(""),U("Team Member"),q()}catch(Y){console.error("Error adding team member:",Y),d("Error adding team member","error")}finally{V(null)}},ue=async(Y,P)=>{try{V(Y.id),await K.updateProjectMemberRole(r.id,Y.users?.id,P),d("Role updated","success"),q()}catch(ce){console.error("Error updating role:",ce),d("Error updating role","error")}finally{V(null)}},ae=async Y=>{try{V(Y.id),await K.removeProjectMember(r.id,Y.users?.id),d("Team member removed","success"),q()}catch(P){console.error("Error removing team member:",P),d("Error removing team member","error")}finally{V(null)}};return m?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx($s,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx($s,{size:18})," Project Team"]}),i&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>_(!0),children:[e.jsx(Vv,{size:14})," Add"]})]}),h.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",i&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:h.map(Y=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:Y.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:Y.users?.email})]}),e.jsx("div",{className:"team-member-role",children:i?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:Y.project_role,onChange:P=>ue(Y,P.target.value),disabled:X===Y.id,className:"role-select",children:Kp.map(P=>e.jsx("option",{value:P,children:P},P))}),e.jsx(Ma,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:Y.project_role})}),i&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>ae(Y),disabled:X===Y.id,title:"Remove from project",children:e.jsx(wf,{size:14})})]},Y.id))}),A&&e.jsx("div",{className:"modal-overlay",onClick:()=>_(!1),children:e.jsxs("div",{className:"modal-content small",onClick:Y=>Y.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>_(!1),children:e.jsx(Ra,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:j,onChange:Y=>$(Y.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),p.map(Y=>e.jsx("option",{value:Y.users?.id,children:Y.users?.name||Y.users?.email},Y.users?.id))]}),p.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:C,onChange:Y=>U(Y.target.value),className:"form-select",children:Kp.map(Y=>e.jsx("option",{value:Y,children:Y},Y))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>_(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:W,disabled:!j||X==="add",children:X==="add"?"Adding...":"Add to Project"})]})]})})]})}function Py({company:r,user:l,isAdmin:c,onShowToast:i,navigateToProjectId:d,onProjectNavigated:h}){const[g,p]=x.useState([]),[y,m]=x.useState([]),[v,A]=x.useState(null),[_,j]=x.useState([]),[$,C]=x.useState(!0),[U,X]=x.useState(!1),[V,q]=x.useState(null),[E,W]=x.useState(!1),[ue,ae]=x.useState(!1),[Y,P]=x.useState(!1),[ce,M]=x.useState("overview"),[b,R]=x.useState([]),[B,me]=x.useState(!1),[T,ee]=x.useState(null),[k,pe]=x.useState(!1),[D,z]=x.useState(null),[se,Z]=x.useState(0),[ne,F]=x.useState(!1),[fe,de]=x.useState(!1),ye=x.useRef(null),Fe=x.useRef(!1),ze=x.useRef(!1),Me=x.useCallback((Ee={})=>{const{refreshAreas:O=!1,refreshCOR:je=!1,projectId:xe=null}=Ee;O&&xe&&(Fe.current=xe),je&&(ze.current=!0),ye.current&&clearTimeout(ye.current),ye.current=setTimeout(async()=>{Fe.current&&(await J(Fe.current),Fe.current=!1),ze.current&&(Z(Re=>Re+1),ze.current=!1),await qe()},150)},[]);x.useEffect(()=>()=>{ye.current&&clearTimeout(ye.current)},[]),x.useEffect(()=>{if(r?.id){qe(),nt();const Ee=g.map(je=>je.id),O=Ee.length>0?K.subscribeToCompanyActivity?.(r.id,Ee,{onMessage:()=>Me(),onMaterialRequest:()=>Me(),onTMTicket:()=>Me(),onInjuryReport:()=>Me()}):null;return()=>{O&&K.unsubscribe?.(O)}}},[r?.id,g.length,Me]);const nt=async()=>{try{const Ee=await K.getDumpSites(r.id);R(Ee||[])}catch(Ee){console.error("Error loading dump sites:",Ee)}};x.useEffect(()=>{if(d&&g.length>0){const Ee=g.find(O=>O.id===d);Ee&&(A(Ee),h?.())}},[d,g]),x.useEffect(()=>{if(v){J(v.id);const Ee=[],O=v.id,je=K.subscribeToAreas?.(O,()=>{Me({refreshAreas:!0,projectId:O})});je&&Ee.push(je);const xe=K.subscribeToDailyReports?.(O,()=>{Me()});xe&&Ee.push(xe);const Re=K.subscribeToCrewCheckins?.(O,()=>{Me()});Re&&Ee.push(Re);const jt=K.subscribeToHaulOffs?.(O,()=>{Me()});jt&&Ee.push(jt);const ct=K.subscribeToCORs?.(O,()=>{Me({refreshCOR:!0})});return ct&&Ee.push(ct),()=>{Ee.forEach(Tt=>K.unsubscribe?.(Tt))}}},[v,Me]);const qe=async()=>{try{const Ee=await K.getProjects(r?.id);p(Ee);const O=await Promise.all(Ee.map(async je=>{try{const[xe,Re,jt,ct,Tt,ot,ht,va,Qt]=await Promise.all([K.getAreas(je.id).catch(()=>[]),K.getTMTickets(je.id).catch(()=>[]),K.getChangeOrderTotals(je.id).catch(()=>null),K.getDailyReports(je.id,100).catch(()=>[]),K.getInjuryReports(je.id).catch(()=>[]),K.calculateManDayCosts(je.id,r?.id,je.work_type||"demolition",je.job_type||"standard").catch(()=>null),K.calculateHaulOffCosts(je.id).catch(()=>null),K.getProjectCosts(je.id).catch(()=>[]),K.getCORStats(je.id).catch(()=>null)]),Sa=Vp(xe),Pe=Sa.progress,rt=jt?.totalApprovedValue||0,Xt=je.contract_value+rt,ya=Sa.isValueBased?Sa.earnedValue:Pe/100*Xt,Pa=Re.filter(He=>He.status==="pending").length,ba=new Date;ba.setDate(ba.getDate()-7);const Zt=ct.filter(He=>new Date(He.report_date)>=ba).length,ga=va.reduce((He,gt)=>{const Qe=parseFloat(gt.amount);return He+(isNaN(Qe)?0:Qe)},0),zt=ot?.totalCost||0,Va=ht?.totalCost||0,Ve=zt+Va+ga,at=ya-Ve,At=ya>0?at/ya*100:0,Pt=ot?.byDate?.length||0,S=ht?.daysWithHaulOff||0,re=Math.max(Pt,S),Ne=zt+Va,le=re>0?Ne/re:0,Ge=ty({...je,progress:Pe},ot?.totalManDays||0);return{...je,areas:xe,progress:Pe,billable:ya,changeOrderValue:rt,revisedContractValue:Xt,changeOrderPending:jt?.pendingCount||0,totalTickets:Re.length,pendingTickets:Pa,approvedTickets:Re.filter(He=>He.status==="approved").length,dailyReportsCount:ct.length,recentDailyReports:Zt,injuryReportsCount:Tt.length,lastDailyReport:ct[0]?.report_date||null,isValueBased:Sa.isValueBased,earnedValue:Sa.earnedValue,totalSOVValue:Sa.totalValue,laborCost:zt,laborDaysWorked:Pt,laborManDays:ot?.totalManDays||0,laborByDate:ot?.byDate||[],dailyBurn:le,haulOffCost:Va,haulOffLoads:ht?.totalLoads||0,haulOffDays:S,haulOffByType:ht?.byWasteType||{},haulOffByDate:ht?.byDate||[],customCosts:va,customCostTotal:ga,totalBurn:Ne,totalBurnDays:re,allCostsTotal:Ve,currentProfit:at,profitMargin:At,corPendingValue:Qt?.total_pending_value||0,corPendingCount:Qt?.pending_count||0,corApprovedValue:Qt?.total_approved_value||0,corBilledValue:Qt?.total_billed_value||0,corTotalCount:Qt?.total_cors||0,scheduleStatus:Ge.scheduleStatus,scheduleVariance:Ge.scheduleVariance,scheduleLabel:Ge.scheduleLabel,laborStatus:Ge.laborStatus,laborVariance:Ge.laborVariance,laborLabel:Ge.laborLabel,hasScheduleData:Ge.hasScheduleData,hasLaborData:Ge.hasLaborData,actualManDays:ot?.totalManDays||0,hasError:!1}}catch(xe){return console.error(`Error loading data for project ${je.id}:`,xe),{...je,areas:[],progress:0,billable:0,changeOrderValue:0,revisedContractValue:je.contract_value,changeOrderPending:0,totalTickets:0,pendingTickets:0,approvedTickets:0,dailyReportsCount:0,recentDailyReports:0,injuryReportsCount:0,lastDailyReport:null,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corTotalCount:0,hasError:!0}}}));m(O)}catch(Ee){console.error("Error loading projects:",Ee),i("Error loading projects","error")}finally{C(!1)}},J=async Ee=>{try{const O=await K.getAreas(Ee);j(O)}catch(O){console.error("Error loading areas:",O)}},Oe=Ee=>{A(Ee)},Ie=()=>{A(null),j([]),X(!1),q(null),M("overview"),qe()},ft=()=>{q({name:v.name,job_number:v.job_number||"",address:v.address||"",general_contractor:v.general_contractor||"",client_contact:v.client_contact||"",client_phone:v.client_phone||"",contract_value:v.contract_value,work_type:v.work_type||"demolition",job_type:v.job_type||"standard",pin:v.pin||"",default_dump_site_id:v.default_dump_site_id||"",areas:_.map(Ee=>({id:Ee.id,name:Ee.name,weight:Ee.weight,isNew:!1}))}),X(!0)},ja=()=>{X(!1),q(null)},ke=(Ee,O)=>{q(je=>({...je,[Ee]:O}))},Le=(Ee,O,je)=>{q(xe=>({...xe,areas:xe.areas.map((Re,jt)=>jt===Ee?{...Re,[O]:je}:Re)}))},$e=()=>{q(Ee=>({...Ee,areas:[...Ee.areas,{id:null,name:"",weight:"",isNew:!0}]}))},Je=Ee=>{V.areas.length>1&&q(O=>({...O,areas:O.areas.filter((je,xe)=>xe!==Ee)}))},et=async()=>{if(!V.name.trim()){i("Please enter a project name","error");return}const Ee=parseFloat(V.contract_value);if(!Ee||Ee<=0){i("Please enter a valid contract value","error");return}if(V.pin&&V.pin.length!==4){i("PIN must be 4 digits","error");return}if(V.pin&&V.pin!==v.pin&&!await K.isPinAvailable(V.pin,v.id)){i("This PIN is already in use","error");return}const O=V.areas.filter(xe=>xe.name.trim()&&parseFloat(xe.weight)>0);if(O.length===0){i("Please add at least one area","error");return}if(O.reduce((xe,Re)=>xe+parseFloat(Re.weight),0)!==100){i("Area weights must total 100%","error");return}W(!0);try{await K.updateProject(v.id,{name:V.name.trim(),job_number:V.job_number?.trim()||null,address:V.address?.trim()||null,general_contractor:V.general_contractor?.trim()||null,client_contact:V.client_contact?.trim()||null,client_phone:V.client_phone?.trim()||null,contract_value:Ee,work_type:V.work_type||"demolition",job_type:V.job_type||"standard",pin:V.pin||null,default_dump_site_id:V.default_dump_site_id||null});const xe=_.map(ct=>ct.id),Re=V.areas.filter(ct=>ct.id).map(ct=>ct.id);for(const ct of xe)Re.includes(ct)||await K.deleteArea(ct);for(let ct=0;ct<O.length;ct++){const Tt=O[ct];Tt.id?await K.updateArea(Tt.id,{name:Tt.name.trim(),weight:parseFloat(Tt.weight),sort_order:ct}):await K.createArea({project_id:v.id,name:Tt.name.trim(),weight:parseFloat(Tt.weight),status:"not_started",sort_order:ct})}const jt=await K.getProject(v.id);A(jt),await J(v.id),X(!1),q(null),i("Project updated!","success")}catch(xe){console.error("Error saving project:",xe?.message||xe),i(xe?.message||"Error saving changes","error")}finally{W(!1)}},tt=async()=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await K.deleteProject(v.id),i("Project deleted","success"),Ie()}catch(Ee){console.error("Error deleting project:",Ee),i("Error deleting project","error")}},Ae=x.useMemo(()=>v?y.find(Ee=>Ee.id===v.id):null,[v,y]),bt=x.useMemo(()=>{if(!v)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const Ee=Vp(_),O=Ee.progress,je=Ae?.changeOrderValue||0,xe=v.contract_value+je,Re=Ee.isValueBased?Ee.earnedValue:O/100*xe;return{progress:O,billable:Re,changeOrderValue:je,revisedContractValue:xe,isValueBased:Ee.isValueBased,earnedValue:Ee.earnedValue,totalSOVValue:Ee.totalValue}},[v,_,Ae]),kt=x.useMemo(()=>{const Ee=y.reduce((ot,ht)=>ot+(ht.contract_value||0),0),O=y.reduce((ot,ht)=>ot+(ht.changeOrderValue||0),0),je=Ee+O,xe=y.reduce((ot,ht)=>ot+(ht.billable||0),0),Re=je-xe,jt=je>0?Math.round(xe/je*100):0,ct=y.reduce((ot,ht)=>ot+(ht.corPendingValue||0),0),Tt=y.reduce((ot,ht)=>ot+(ht.corPendingCount||0),0);return{totalOriginalContract:Ee,totalChangeOrders:O,totalPortfolioValue:je,totalEarned:xe,totalRemaining:Re,weightedCompletion:jt,totalPendingCORValue:ct,totalPendingCORCount:Tt}},[y]),Mt=x.useMemo(()=>{let Ee=0,O=0,je=0,xe=0,Re=0;for(const jt of y){const ct=jt.revisedContractValue||jt.contract_value;jt.progress>=100&&Ee++,jt.progress<100&&jt.billable<=ct*(jt.progress/100)*1.1&&O++,jt.billable>ct*.9&&jt.progress<90&&je++,jt.billable>ct&&xe++,(jt.changeOrderValue||0)>0&&Re++}return{projectsComplete:Ee,projectsOnTrack:O,projectsAtRisk:je,projectsOverBudget:xe,projectsWithChangeOrders:Re}},[y]),Gt=x.useMemo(()=>{let Ee=0,O=0,je=0,xe=0,Re=0,jt=0;for(const ct of y)ct.hasScheduleData&&(ct.scheduleStatus==="ahead"?Ee++:ct.scheduleStatus==="behind"?je++:O++),ct.hasLaborData&&(ct.laborStatus==="over"?xe++:ct.laborStatus==="under"?Re++:jt++);return{scheduleAhead:Ee,scheduleOnTrack:O,scheduleBehind:je,laborOver:xe,laborUnder:Re,laborOnTrack:jt,hasAnyScheduleData:Ee+O+je>0,hasAnyLaborData:xe+Re+jt>0}},[y]);x.useEffect(()=>{const Ee=async()=>{for(const O of y)if(ay(O,30)){console.log(`Auto-archiving completed project: ${O.name}`);try{await K.archiveProject(O.id),i(`Project "${O.name}" has been auto-archived after 30 days of completion`,"info")}catch(je){console.error("Failed to auto-archive project:",je)}}};y.length>0&&Ee()},[]);const{totalOriginalContract:Dt,totalChangeOrders:aa,totalPortfolioValue:da,totalEarned:St,totalRemaining:We,weightedCompletion:Ft,totalPendingCORValue:De,totalPendingCORCount:I}=kt,{projectsComplete:L,projectsOnTrack:we,projectsAtRisk:it,projectsOverBudget:Te,projectsWithChangeOrders:be}=Mt,{scheduleAhead:st,scheduleOnTrack:dt,scheduleBehind:It,laborOver:sa,laborUnder:Ce,laborOnTrack:xt,hasAnyScheduleData:ut,hasAnyLaborData:qa}=Gt;if($)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(v){const{progress:Ee,billable:O,changeOrderValue:je,revisedContractValue:xe,isValueBased:Re,earnedValue:jt,totalSOVValue:ct}=bt;if(U&&V){const Pe=V.areas.reduce((rt,Xt)=>rt+(parseFloat(Xt.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:ja,style:{marginBottom:"1.5rem"},children:" Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:V.name,onChange:rt=>ke("name",rt.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:V.job_number,onChange:rt=>ke("job_number",rt.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:V.address,onChange:rt=>ke("address",rt.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:V.general_contractor,onChange:rt=>ke("general_contractor",rt.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:V.client_contact,onChange:rt=>ke("client_contact",rt.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:V.client_phone,onChange:rt=>ke("client_phone",rt.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:V.contract_value,onChange:rt=>ke("contract_value",rt.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:V.pin,onChange:rt=>ke("pin",rt.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:V.work_type,onChange:rt=>ke("work_type",rt.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:V.job_type,onChange:rt=>ke("job_type",rt.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:V.default_dump_site_id,onChange:rt=>ke("default_dump_site_id",rt.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),b.map(rt=>e.jsx("option",{value:rt.id,children:rt.name},rt.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),V.areas.map((rt,Xt)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:rt.name,onChange:ya=>Le(Xt,"name",ya.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:rt.weight,onChange:ya=>Le(Xt,"weight",ya.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>Je(Xt),children:""})]},Xt)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${Pe===100?"valid":"invalid"}`,children:[Pe,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:$e,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:et,disabled:E,style:{flex:1},children:E?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:tt,children:"Delete Project"})]})}const Tt=_.filter(Pe=>Pe.status==="done").length,ot=_.filter(Pe=>Pe.status==="working").length,ht=_.filter(Pe=>Pe.status==="not_started").length,va=xe>0?Math.round(O/xe*100):0,Qt=je>0,Sa=[{id:"overview",label:"Overview",Icon:$p},{id:"financials",label:"Financials",Icon:Er},{id:"reports",label:"Reports",Icon:cs},{id:"info",label:"Info",Icon:Ad}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:Ie,children:[e.jsx("span",{children:""}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>ae(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>P(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:ft,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:v.name}),(v.job_number||v.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[v.job_number&&`Job #${v.job_number}`,v.job_number&&v.work_type&&"  ",v.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[Ee,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:Yt(O)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:Yt(xe-O)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:Sa.map(Pe=>e.jsxs("button",{className:`pv-tab ${ce===Pe.id?"active":""}`,onClick:()=>M(Pe.id),children:[e.jsx(Pe.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:Pe.label})]},Pe.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[ce==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab",children:[e.jsx("div",{className:"overview-hero",children:e.jsxs("div",{className:"overview-hero-grid",children:[e.jsxs("div",{className:"overview-metric primary",children:[e.jsxs("div",{className:"overview-metric-value",children:[Ee,"%"]}),e.jsx("div",{className:"overview-metric-label",children:"Complete"}),e.jsx("div",{className:"overview-metric-bar",children:e.jsx("div",{className:"overview-metric-fill",style:{width:`${Ee}%`}})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsxs("div",{className:"overview-metric-value",children:[Tt,"/",_.length]}),e.jsx("div",{className:"overview-metric-label",children:"Areas Done"}),e.jsx("div",{className:"overview-metric-detail",children:ot>0&&e.jsxs("span",{className:"working",children:[ot," active"]})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value",children:Yt(xe)}),e.jsx("div",{className:"overview-metric-label",children:"Contract"}),Qt&&e.jsxs("div",{className:"overview-metric-detail green",children:["+",Yt(je)," COs"]})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value green",children:Yt(O)}),e.jsx("div",{className:"overview-metric-label",children:"Earned"}),e.jsx("div",{className:"overview-metric-detail",children:Re?e.jsxs("span",{children:["of ",Yt(ct)," SOV"]}):e.jsxs("span",{children:[va,"% billed"]})})]})]})}),(Ae?.pendingTickets>0||Ae?.changeOrderPending>0)&&e.jsxs("div",{className:"overview-attention-card",children:[e.jsxs("div",{className:"attention-header",children:[e.jsx("h3",{children:"Needs Attention"}),e.jsxs("span",{className:"attention-count",children:[(Ae?.pendingTickets||0)+(Ae?.changeOrderPending||0)," items"]})]}),e.jsxs("div",{className:"attention-items",children:[Ae?.pendingTickets>0&&e.jsxs("div",{className:"attention-item",onClick:()=>M("financials"),children:[e.jsx("div",{className:"attention-item-icon warning",children:e.jsx(cs,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[Ae.pendingTickets," T&M ticket",Ae.pendingTickets!==1?"s":""," awaiting approval"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]}),Ae?.changeOrderPending>0&&e.jsxs("div",{className:"attention-item",onClick:()=>M("financials"),children:[e.jsx("div",{className:"attention-item-icon info",children:e.jsx(Oa,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[Ae.changeOrderPending," change order",Ae.changeOrderPending!==1?"s":""," pending"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:""})]})]})]}),e.jsxs("div",{className:"overview-section-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[Tt>0&&e.jsxs("span",{className:"section-badge done",children:[Tt," Complete"]}),ot>0&&e.jsxs("span",{className:"section-badge working",children:[ot," Active"]}),ht>0&&e.jsxs("span",{className:"section-badge pending",children:[ht," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list",children:_.map(Pe=>e.jsxs("div",{className:`work-area-item ${Pe.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[Pe.status==="done"&&e.jsx("span",{className:"status-icon done",children:""}),Pe.status==="working"&&e.jsx("span",{className:"status-icon working",children:""}),Pe.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:""})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:Pe.name}),e.jsx("span",{className:"work-area-weight",children:Pe.scheduled_value?Yt(Pe.scheduled_value):`${Pe.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${Pe.status}`,style:{width:Pe.status==="done"?"100%":Pe.status==="working"?"50%":"0%"}})})]},Pe.id))})]}),e.jsxs("div",{className:"overview-stats-row",children:[e.jsxs("div",{className:"quick-stat-card",onClick:()=>M("reports"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(cs,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:Ae?.dailyReportsCount||0}),e.jsx("span",{className:"quick-stat-label",children:"Daily Reports"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]}),e.jsxs("div",{className:"quick-stat-card",onClick:()=>M("financials"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(Er,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:Ae?.totalTickets||0}),e.jsx("span",{className:"quick-stat-label",children:"T&M Tickets"})]}),e.jsx("span",{className:"quick-stat-arrow",children:""})]})]})]}),ce==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsx("div",{className:"financials-hero",children:e.jsxs("div",{className:"financials-hero-grid",children:[e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Contract"}),e.jsx("div",{className:"fin-metric-value",children:Yt(xe)}),Qt&&e.jsxs("div",{className:"fin-metric-detail green",children:["+",Yt(je)," COs"]})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Earned"}),e.jsx("div",{className:"fin-metric-value",children:Yt(O)}),e.jsx("div",{className:"fin-metric-bar",children:e.jsx("div",{className:"fin-metric-fill",style:{width:`${va}%`}})})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Costs"}),e.jsx("div",{className:"fin-metric-value",children:Yt(Ae?.allCostsTotal||0)}),O>0&&e.jsxs("div",{className:`fin-metric-detail ${(Ae?.allCostsTotal||0)/O>.6?"warning":""}`,children:[Math.round((Ae?.allCostsTotal||0)/O*100),"% of revenue"]})]}),e.jsxs("div",{className:"fin-metric",children:[e.jsx("div",{className:"fin-metric-label",children:"Profit"}),e.jsx("div",{className:`fin-metric-value ${(Ae?.currentProfit||0)<0?"negative":"positive"}`,children:Yt(Ae?.currentProfit||0)}),e.jsxs("div",{className:`fin-metric-detail ${(Ae?.profitMargin||0)<20?"warning":""}`,children:[Math.round(Ae?.profitMargin||0),"% margin"]})]})]})}),e.jsxs("div",{className:"financials-analysis-row",children:[e.jsx(Ry,{dailyBurn:Ae?.dailyBurn||0,totalBurn:Ae?.totalBurn||0,daysWorked:Ae?.totalBurnDays||0,laborCost:Ae?.laborCost||0,haulOffCost:Ae?.haulOffCost||0,progress:Ee,contractValue:xe,laborByDate:Ae?.laborByDate||[],haulOffByDate:Ae?.haulOffByDate||[]}),e.jsx(Fy,{revenue:O,totalCosts:Ae?.allCostsTotal||0,contractValue:xe,progress:Ee}),e.jsx(Uy,{project:v,period:"week"})]}),e.jsx(qy,{laborCost:Ae?.laborCost||0,haulOffCost:Ae?.haulOffCost||0,customCosts:Ae?.customCosts||[],onAddCost:()=>F(!0),onDeleteCost:async Pe=>{try{await K.deleteProjectCost(Pe),qe(),i("Cost deleted","success")}catch{i("Error deleting cost","error")}}}),e.jsx("div",{className:"financials-section cor-section-primary",children:e.jsx(_y,{project:v,company:r,areas:_,refreshKey:se,onShowToast:i,onCreateCOR:()=>{ee(null),me(!0)},onViewCOR:Pe=>{z(Pe),pe(!0)},onEditCOR:Pe=>{ee(Pe),me(!0)}})}),e.jsxs("div",{className:"financials-section tm-section",children:[e.jsxs("div",{className:"tm-section-header",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("span",{className:"tm-badge",children:[Ae?.totalTickets||0," total",Ae?.pendingTickets>0&&`  ${Ae.pendingTickets} pending`]})]}),e.jsx(my,{project:v,company:r,onShowToast:i,compact:!0})]}),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(Da,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:Yt(Ae?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(vy,{project:v,company:r,onShowToast:i})})]})]}),ce==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(cs,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:Ae?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:Ae?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((Ae?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:`reports-metric ${(Ae?.injuryReportsCount||0)>0?"warning":"success"}`,children:[e.jsx("div",{className:"reports-metric-value",children:Ae?.injuryReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Injuries"}),e.jsx("div",{className:"reports-metric-status",children:(Ae?.injuryReportsCount||0)===0?"No incidents":"Review required"})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value small",children:Ae?.lastDailyReport?new Date(Ae.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"None"}),e.jsx("div",{className:"reports-metric-label",children:"Last Filed"}),Ae?.lastDailyReport&&e.jsxs("div",{className:"reports-metric-detail",children:[Math.floor((new Date-new Date(Ae.lastDailyReport))/(1e3*60*60*24))," days ago"]})]})]})}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(cs,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[Ae?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(jy,{project:v,company:r,onShowToast:i})})]}),e.jsxs("div",{className:`reports-section-card ${(Ae?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(Ae?.injuryReportsCount||0)>0?"warning":"success"}`,children:(Ae?.injuryReportsCount||0)>0?"":""}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(Ae?.injuryReportsCount||0)>0?"warning":"success"}`,children:(Ae?.injuryReportsCount||0)>0?`${Ae.injuryReportsCount} incident${Ae.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(fy,{project:v,companyId:r?.id||v?.company_id,company:r,onShowToast:i})})]})]}),ce==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:v.name}),v.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",v.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:ft,children:e.jsx("span",{children:"Edit Project"})})]}),v.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(rv,{size:14}),e.jsx("span",{children:v.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Da,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:v.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Oa,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:v.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Er,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:Yt(xe)}),e.jsx("span",{className:"info-quick-label",children:je>0?`Incl. +${Yt(je)} COs`:"Contract Value"})]})]}),v.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:v.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Qi,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[v.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:v.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),v.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:v.client_contact})]}),v.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(jv,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${v.client_phone}`,className:"info-detail-value link",children:v.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx($p,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[Tt>0&&e.jsxs("span",{className:"info-badge done",children:[Tt," Done"]}),ot>0&&e.jsxs("span",{className:"info-badge working",children:[ot," Active"]}),ht>0&&e.jsxs("span",{className:"info-badge pending",children:[ht," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:_.map(Pe=>e.jsxs("div",{className:`info-area-item ${Pe.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[Pe.status==="done"&&e.jsx("span",{className:"status-dot done",children:""}),Pe.status==="working"&&e.jsx("span",{className:"status-dot working",children:""}),Pe.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:""})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:Pe.name}),e.jsx("span",{className:`info-area-status-label ${Pe.status}`,children:Pe.status==="done"?"Complete":Pe.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[Pe.weight,"%"]})]},Pe.id))})]}),e.jsx($y,{project:v,company:r,user:l,isAdmin:c,onShowToast:i}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(Ad,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:Yt(v.contract_value)})]}),je>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",Yt(je)]})]}),v.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:b.find(Pe=>Pe.id===v.default_dump_site_id)?.name||"Unknown"})]})]})]})]})]}),ue&&e.jsx(hy,{project:v,onClose:()=>ae(!1),onShareCreated:Pe=>{i("Share link created successfully!","success")}}),Y&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(gy,{project:v,company:r,onShowToast:i,onClose:()=>P(!1)})}),B&&e.jsx(Sy,{project:v,company:r,areas:_,existingCOR:T,onClose:()=>{me(!1),ee(null)},onSaved:()=>{me(!1),ee(null),Z(Pe=>Pe+1)},onShowToast:i}),k&&D&&e.jsx(Ay,{cor:D,project:v,company:r,areas:_,onClose:()=>{pe(!1),z(null)},onEdit:Pe=>{pe(!1),z(null),ee(Pe),me(!0)},onShowToast:i,onStatusChange:()=>{}}),ne&&e.jsx(By,{onClose:()=>F(!1),saving:fe,onSave:async Pe=>{try{de(!0),await K.addProjectCost(v.id,r.id,Pe),F(!1),qe(),i("Cost added successfully","success")}catch(rt){console.error("Error adding cost:",rt),i("Error adding cost","error")}finally{de(!1)}}})]})}return g.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(cs,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("div",{className:"bo-project-count",children:[g.length," Active Project",g.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(Ft,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:Yt(St)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:Yt(da)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:Yt(We)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),aa>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:Yt(Dt)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",be," project",be!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",Yt(aa)]})]})]}),I>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:Yt(De)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",I," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[L>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:L}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),we>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:we}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),it>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:it}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),Te>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:Te}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),ut&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[st>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:st}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),dt>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:dt}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),It>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:It}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),qa&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),Ce>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[Ce," under"]}),xt>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[xt," on track"]}),sa>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[sa," over"]})]})]})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[g.length," active"]})]}),e.jsx("div",{className:"project-list",children:y.map(Ee=>e.jsx(Vy,{project:Ee,onClick:()=>Oe(Ee)},Ee.id))})]})}function Vy({project:r,onClick:l}){const c=kf(r.areas||[]),i=ey(r.areas||[]),d=r.contract_value-r.billable,h=r.billable>r.contract_value*.9&&r.progress<90;return e.jsxs("div",{className:`project-card enhanced ${h?"at-risk":""}`,onClick:l,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:r.name}),e.jsx("div",{className:"project-card-value",children:Yt(r.contract_value)})]}),e.jsx("span",{className:`status-badge ${c}`,children:i})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[r.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:Yt(r.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${d<0?"negative":""}`,children:Yt(Math.abs(d))}),e.jsx("span",{className:"stat-label",children:d>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${r.progress}%`}})}),(r.pendingTickets>0||r.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[r.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[r.pendingTickets," Pending T&M"]}),r.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[r.approvedTickets," Approved T&M"]})]}),r.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${r.scheduleStatus}`,children:r.scheduleLabel}),r.hasLaborData&&r.laborLabel&&e.jsx("span",{className:`labor-indicator ${r.laborStatus}`,children:r.laborLabel})]})]})}const Nd=r=>{if(r==null||r==="")return"";const l=parseFloat(r);return isNaN(l)?"":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l)},ef=r=>{if(!r)return null;const l=String(r).replace(/[$,\s]/g,""),c=parseFloat(l);return isNaN(c)?null:c};function Gy({company:r,user:l,onProjectCreated:c,onShowToast:i}){const[d,h]=x.useState(""),[g,p]=x.useState(""),[y,m]=x.useState(""),[v,A]=x.useState(""),[_,j]=x.useState(""),[$,C]=x.useState(""),[U,X]=x.useState("demolition"),[V,q]=x.useState("standard"),[E,W]=x.useState([{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null}]),[ue,ae]=x.useState(!1),[Y,P]=x.useState(!1),[ce,M]=x.useState(!1),[b,R]=x.useState([]),[B,me]=x.useState(!1),[T,ee]=x.useState(""),[k,pe]=x.useState(""),[D,z]=x.useState(""),se=x.useRef(null),Z=E.reduce((ke,Le)=>ke+(parseFloat(Le.weight)||0),0),ne=ke=>{const Le=ke.replace(/\D/g,"").slice(0,4);C(Le)},F=()=>{const ke=Math.floor(1e3+Math.random()*9e3).toString();C(ke)},fe=(ke,Le,$e)=>{W(Je=>Je.map((et,tt)=>tt===ke?{...et,[Le]:$e}:et))},de=()=>{W(ke=>[...ke,{name:"",weight:"",group:"",scheduledValue:null}])},ye=ke=>{E.length>1&&W(Le=>Le.filter(($e,Je)=>Je!==ke))},Fe=(ke="value")=>{const Le=E.filter(Ae=>Ae.name.trim());if(Le.length===0){i("Add tasks first","error");return}let $e=[...E];const Je=E.map((Ae,bt)=>Ae.name.trim()?bt:-1).filter(Ae=>Ae>=0);if(ke==="value"){const Ae=Le.reduce((bt,kt)=>bt+(parseFloat(kt.scheduledValue)||0),0);if(Ae===0)i("No scheduled values - using equal distribution","info"),ke="equal";else{let bt=0;Je.forEach((kt,Mt)=>{const Gt=parseFloat(E[kt].scheduledValue)||0;let Dt;Mt===Je.length-1?Dt=100-bt:(Dt=Math.round(Gt/Ae*1e4)/100,bt+=Dt),$e[kt]={...$e[kt],weight:Dt.toFixed(2)}}),W($e),me(!1),i("Weights calculated by value","success");return}}const et=Math.round(100/Je.length*100)/100;let tt=0;Je.forEach((Ae,bt)=>{let kt;bt===Je.length-1?kt=100-tt:(kt=et,tt+=kt),$e[Ae]={...$e[Ae],weight:kt.toFixed(2)}}),W($e),me(!1),i("Weights distributed equally","success")},ze=()=>{h(""),p(""),m(""),A(""),j(""),C(""),X("demolition"),q("standard"),ee(""),pe(""),z(""),W([{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null},{name:"",weight:"",group:"",scheduledValue:null}]),M(!1),R([])},Me=()=>{se.current?.click()},nt=ke=>new Promise((Le,$e)=>{const Je=new FileReader;Je.onload=et=>{try{const tt=new Uint8Array(et.target.result),Ae=$x(tt,{type:"array"}),bt=Ae.SheetNames[0],kt=Ae.Sheets[bt],Mt=fn.sheet_to_json(kt,{header:1}),Gt=[];let Dt="General";const aa=/^\$?\d{1,3}(,\d{3})*(\.\d{2})?$/,da=/^(\d+\.?\d*|[A-Z]\.?\d*)$/i,St=/^(SF|LF|EA|LS|Days?|MD|Load|CY|SY|GAL|TON)$/i,We=/^\d{1,3}(,\d{3})*$|^\d+$/,Ft=/^(Item|#|No\.?|Description|Scheduled|Value|Amount|Quantity|Unit|Total|Application|Balance|Completed|Stored|Retainage)/i;for(const L of Mt){if(!L||L.length===0)continue;const we=L.map(xt=>xt==null?"":String(xt).trim()).filter(xt=>xt.length>0);if(we.length===0)continue;const it=we.join(" ");if(Ft.test(we[0])||we.length>1&&Ft.test(we[1])||/^(Total|Subtotal|Grand Total|Base Bid|Contract Sum)/i.test(it))continue;const Te=we.some(xt=>aa.test(xt.replace(/[$,]/g,"")+(xt.includes(".")?"":".00")));if((!Te&&we.length<=3&&/^(L\d|Level|Floor|\d+(?:st|nd|rd|th)|Plaza|Street|Basement|Roof|Penthouse|Site|Exterior|Interior|Misc|MEP|ABATEMENT|DEMOLITION|UNIVERSAL|SOFT|TRASH|DEMO|Phase|Division|Section|Area|Building|Wing)/i.test(we[0])||we.length===2&&da.test(we[0])&&!Te&&!/^\d+\.\d+$/.test(we[0]))&&!Te){Dt=(we.find(ut=>!da.test(ut)&&ut.length>1)||we.join(" ")).replace(/\s*\(\d{1,3}(?:,\d{3})*\s*SF\)\s*$/i,"").replace(/\s*[-:]\s*$/,"").trim();continue}let st="",dt=!1,It="",sa=null;const Ce=[];for(let xt=0;xt<we.length;xt++){const ut=we[xt];if(xt===0&&da.test(ut)){It=ut;continue}if(!/^ID-\d+$/i.test(ut)&&!/^KN\s*\d+$/i.test(ut)){if(aa.test(ut.replace(/[$,]/g,"")+(ut.includes(".")?"":".00"))||/^\$/.test(ut)){const qa=ut.replace(/[$,]/g,""),Ee=parseFloat(qa);!isNaN(Ee)&&Ee>100&&(sa===null||Ee>sa)&&(sa=Ee),dt=!0;continue}if(We.test(ut.replace(/,/g,""))){dt=!0;continue}St.test(ut)||/^\d+\.?\d*%$/.test(ut)||ut.length>1&&!da.test(ut)&&Ce.push(ut)}}st=Ce.join(" ").trim(),st=st.replace(/\s+/g," ").replace(/^[-]\s*/,"").trim(),!(st.length<3)&&(/^(Plan|Page|Total|Base Bid|Payment|Condition|Exclusion|Subtotal)/i.test(st)||dt&&st.length>=3&&Gt.push({name:st,group:Dt,itemNumber:It,scheduledValue:sa,selected:!0}))}const De=new Set,I=Gt.filter(L=>{const we=`${L.group}:${L.name}`;return De.has(we)?!1:(De.add(we),!0)});Le(I)}catch(tt){$e(tt)}},Je.onerror=()=>$e(new Error("Failed to read file")),Je.readAsArrayBuffer(ke)}),qe=async ke=>{const Le=ke.target.files?.[0];if(!Le)return;const $e=Le.name.split(".").pop().toLowerCase();if(!["xlsx","xls","csv"].includes($e)){i("Please upload an Excel file (.xlsx, .xls, or .csv)","error");return}P(!0);try{const Je=await nt(Le);if(Je.length===0){i("No tasks found. Check Excel format.","error"),P(!1);return}R(Je),M(!0),i(`Found ${Je.length} tasks`,"success")}catch(Je){console.error("Excel import error:",Je),i("Error reading Excel file","error")}finally{P(!1),se.current&&(se.current.value="")}},J=ke=>{R(Le=>Le.map(($e,Je)=>Je===ke?{...$e,selected:!$e.selected}:$e))},Oe=()=>{const ke=b.filter(et=>et.selected);if(ke.length===0){i("Please select at least one task","error");return}const Le=ke.reduce((et,tt)=>et+(tt.scheduledValue||0),0),$e=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});let Je;if(Le>0){let et=0;Je=ke.map((tt,Ae)=>{const bt=tt.scheduledValue||0;let kt;return Ae===ke.length-1?kt=100-et:(kt=Math.round(bt/Le*1e4)/100,et+=kt),{name:tt.name,weight:kt.toFixed(2),group:tt.group,scheduledValue:tt.scheduledValue||null}}),i(`Tasks imported with value-based weights! Total SOV: ${$e.format(Le)}`,"success")}else{const et=Math.round(100/ke.length*100)/100;Je=ke.map((tt,Ae)=>({name:tt.name,weight:Ae===ke.length-1?(100-et*(ke.length-1)).toFixed(2):et.toFixed(2),group:tt.group,scheduledValue:tt.scheduledValue||null})),i("Tasks imported with equal weights","success")}W(Je),M(!1)},Ie=async()=>{if(!r?.id){i("No company selected. Please log in again.","error");return}if(!d.trim()){i("Please enter a project name","error");return}const ke=parseFloat(_);if(!ke||ke<=0){i("Please enter a valid contract value","error");return}if($.length!==4){i("Please enter a 4-digit PIN","error");return}if(!await K.isPinAvailable($)){i("This PIN is already in use. Try another.","error");return}const $e=E.filter(Je=>Je.name.trim()&&parseFloat(Je.weight)>0);if($e.length===0){i("Please add at least one area","error");return}if(Math.abs(Z-100)>.1){i("Area weights must total 100%","error");return}if(!T||!k){i("Start date and end date are required","error");return}if(new Date(k)<new Date(T)){i("End date must be on or after start date","error");return}ae(!0);try{const Je=await K.createProject({name:d.trim(),job_number:g.trim()||null,address:y.trim()||null,general_contractor:v.trim()||null,contract_value:ke,pin:$,work_type:U,job_type:V,company_id:r?.id,created_by:l?.id,start_date:T,end_date:k,planned_man_days:D?parseInt(D):null});for(let et=0;et<$e.length;et++)await K.createArea({project_id:Je.id,name:$e[et].name.trim(),weight:parseFloat($e[et].weight),scheduled_value:$e[et].scheduledValue||null,group_name:$e[et].group||null,status:"not_started",sort_order:et});i("Project created!","success"),ze(),c()}catch(Je){console.error("Error creating project:",Je),i("Error creating project","error")}finally{ae(!1)}};if(ce){const ke=[...new Set(b.map(et=>et.group))],Le=b.filter(et=>et.selected).length,$e=b.reduce((et,tt)=>et+(tt.scheduledValue||0),0),Je=b.filter(et=>et.selected).reduce((et,tt)=>et+(tt.scheduledValue||0),0);return e.jsxs("div",{children:[e.jsx("h1",{children:"Review Imported Tasks"}),e.jsx("p",{className:"subtitle",children:"Select the tasks to include in your project"}),e.jsxs("div",{className:"import-summary",children:[e.jsxs("span",{children:[Le," of ",b.length," tasks selected"]}),$e>0&&e.jsxs("span",{className:"import-sov-total",children:[" Total SOV: ",new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(Je)]})]}),ke.map(et=>{const tt=b.filter(bt=>bt.group===et),Ae=tt.filter(bt=>bt.selected).length;return e.jsxs("div",{className:"card import-group",children:[e.jsxs("div",{className:"import-group-header",children:[e.jsx("h3",{children:et}),e.jsxs("span",{className:"import-group-count",children:[Ae,"/",tt.length]})]}),e.jsx("div",{className:"import-task-list",children:tt.map(bt=>{const kt=b.indexOf(bt);return e.jsxs("label",{className:"import-task-item",children:[e.jsx("input",{type:"checkbox",checked:bt.selected,onChange:()=>J(kt)}),e.jsx("span",{className:"import-task-name",children:bt.name}),bt.scheduledValue>0&&e.jsx("span",{className:"import-task-value",children:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(bt.scheduledValue)})]},kt)})})]},et)}),e.jsxs("div",{className:"import-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>M(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:Oe,children:["Use Selected Tasks (",Le,")"]})]})]})}const ft=E.reduce((ke,Le,$e)=>{const Je=Le.group||"General";return ke[Je]||(ke[Je]=[]),ke[Je].push({...Le,originalIndex:$e}),ke},{}),ja=Object.keys(ft).length>1||Object.keys(ft).length===1&&!ft.General;return e.jsxs("div",{children:[e.jsx("h1",{children:"New Project"}),e.jsx("p",{className:"subtitle",children:"Set up a new project to track"}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Name"}),e.jsx("input",{type:"text",placeholder:"e.g., Sunrise Apartments",value:d,onChange:ke=>h(ke.target.value)})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",placeholder:"e.g., 4032",value:g,onChange:ke=>p(ke.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($)"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"e.g., 365000",value:_,onChange:ke=>{const Le=ke.target.value.replace(/[^0-9.]/g,"");j(Le)},className:"currency-input"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",placeholder:"e.g., 123 Main St, Los Angeles, CA 90001",value:y,onChange:ke=>m(ke.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",placeholder:"e.g., ABC Construction Inc.",value:v,onChange:ke=>A(ke.target.value)})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Start Date ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"date",value:T,onChange:ke=>ee(ke.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["End Date ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"date",value:k,onChange:ke=>pe(ke.target.value),min:T||void 0,required:!0}),T&&k&&new Date(k)<new Date(T)&&e.jsx("span",{className:"error-text",children:"End date must be after start date"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Planned Man-Days ",e.jsx("span",{className:"optional",children:"(optional)"})]}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.85rem",marginBottom:"0.5rem"},children:"Total estimated man-days to complete the project"}),e.jsx("input",{type:"number",inputMode:"numeric",placeholder:"e.g., 120",value:D,onChange:ke=>z(ke.target.value.replace(/\D/g,"")),min:"1"})]}),e.jsxs("div",{className:"form-row-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("div",{className:"project-type-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${U==="demolition"?"active":""}`,onClick:()=>X("demolition"),children:"Demolition"}),e.jsx("button",{type:"button",className:`toggle-btn ${U==="abatement"?"active":""}`,onClick:()=>X("abatement"),children:"Abatement"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("div",{className:"project-type-toggle",children:[e.jsx("button",{type:"button",className:`toggle-btn ${V==="standard"?"active":""}`,onClick:()=>q("standard"),children:"Standard"}),e.jsx("button",{type:"button",className:`toggle-btn ${V==="pla"?"active":""}`,onClick:()=>q("pla"),children:"PLA"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN (4 digits)"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.85rem",marginBottom:"0.5rem"},children:"Foremen will enter this PIN to access this project"}),e.jsxs("div",{className:"pin-input-row",children:[e.jsx("input",{type:"text",placeholder:"e.g., 2847",value:$,onChange:ke=>ne(ke.target.value),maxLength:4,className:"pin-input"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:F,children:"Generate"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"areas-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Areas / Tasks"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginTop:"0.25rem"},children:"Define the areas for this project. Weights must total 100%."})]}),e.jsxs("div",{className:"import-btn-container",children:[e.jsx("input",{ref:se,type:"file",accept:".xlsx,.xls,.csv",onChange:qe,style:{display:"none"}}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Me,disabled:Y,children:Y?"Reading...":" Import Excel"})]})]}),ja?Object.entries(ft).map(([ke,Le])=>e.jsxs("div",{className:"area-group",children:[e.jsx("div",{className:"area-group-header",children:ke}),Le.map($e=>e.jsxs("div",{className:"area-row area-row-with-value",children:[e.jsx("input",{type:"text",placeholder:"Task name",value:$e.name,onChange:Je=>fe($e.originalIndex,"name",Je.target.value),className:"area-name-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$0",value:$e.scheduledValue?Nd($e.scheduledValue):"",onChange:Je=>fe($e.originalIndex,"scheduledValue",ef(Je.target.value)),className:"currency-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"%",value:$e.weight,onChange:Je=>fe($e.originalIndex,"weight",Je.target.value),className:"weight-input"}),e.jsx("button",{className:"remove-btn",onClick:()=>ye($e.originalIndex),children:""})]},$e.originalIndex))]},ke)):E.map((ke,Le)=>e.jsxs("div",{className:"area-row area-row-with-value",children:[e.jsx("input",{type:"text",placeholder:"Area name (e.g., Level 1)",value:ke.name,onChange:$e=>fe(Le,"name",$e.target.value),className:"area-name-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"$0",value:ke.scheduledValue?Nd(ke.scheduledValue):"",onChange:$e=>fe(Le,"scheduledValue",ef($e.target.value)),className:"currency-input"}),e.jsx("input",{type:"text",inputMode:"decimal",placeholder:"%",value:ke.weight,onChange:$e=>fe(Le,"weight",$e.target.value),className:"weight-input"}),e.jsx("button",{className:"remove-btn",onClick:()=>ye(Le),children:""})]},Le)),e.jsxs("div",{className:"weight-total-row",children:[e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${Math.abs(Z-100)<.1?"valid":"invalid"}`,children:[Z.toFixed(1),"%"]}),E.some(ke=>ke.scheduledValue>0)&&e.jsxs("span",{className:"sov-total",children:[" SOV: ",Nd(E.reduce((ke,Le)=>ke+(parseFloat(Le.scheduledValue)||0),0))]})]}),e.jsxs("div",{className:"auto-weight-dropdown",children:[e.jsx("button",{type:"button",className:"btn btn-secondary btn-small",onClick:()=>me(!B),children:"Auto-Calculate "}),B&&e.jsxs("div",{className:"weight-dropdown-menu",children:[e.jsxs("button",{onClick:()=>Fe("value"),children:["By Value ",e.jsx("span",{className:"dropdown-hint",children:"(Recommended)"})]}),e.jsx("button",{onClick:()=>Fe("equal"),children:"Equal Distribution"})]})]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:de,children:"+ Add Area"})]}),e.jsx("button",{className:"btn btn-primary btn-full",onClick:Ie,disabled:ue,children:ue?"Creating...":"Create Project"})]})}function Yy({company:r,onShowToast:l}){const{branding:c,updateBranding:i,uploadBrandingImage:d,loading:h}=Dr(),[g,p]=x.useState(!1),[y,m]=x.useState(!1),[v,A]=x.useState(c),[_,j]=x.useState(""),[$,C]=x.useState(!1),U=x.useRef(null),X=x.useRef(null),V=x.useRef(null);x.useEffect(()=>{r?.id&&q()},[r?.id]);const q=async()=>{try{const{data:B,error:me}=await w.from("companies").select("office_code").eq("id",r.id).single();!me&&B?.office_code&&j(B.office_code)}catch(B){console.error("Error loading office code:",B)}},E=async()=>{if(confirm("Regenerate office code? Current code will stop working immediately.")){C(!0);try{const B=Math.random().toString(36).substring(2,8).toUpperCase(),{error:me}=await w.from("companies").update({office_code:B}).eq("id",r.id);if(me)throw me;j(B),l?.("Office code regenerated","success")}catch(B){console.error("Error regenerating code:",B),l?.("Error regenerating code","error")}finally{C(!1)}}},W=()=>{navigator.clipboard.writeText(_),l?.("Office code copied to clipboard","success")},ue=r?.subscription_tier||"free",ae=["pro","business","enterprise"].includes(ue),Y=["business","enterprise"].includes(ue),P=ue==="enterprise",ce=(B,me)=>{A(T=>({...T,[B]:me}))},M=async(B,me)=>{if(B){if(B.size>5*1024*1024){l?.("Image must be smaller than 5MB","error");return}if(!B.type.startsWith("image/")){l?.("Please upload an image file","error");return}try{const T=await d(B,me);T.success?(ce(`${me}_url`,T.url),l?.(`${me.charAt(0).toUpperCase()+me.slice(1)} uploaded successfully`,"success")):l?.(T.error||"Failed to upload image","error")}catch(T){console.error("Upload error:",T),l?.("Failed to upload image","error")}}},b=async()=>{try{p(!0);const B=/^#[0-9A-F]{6}$/i;if(!B.test(v.primary_color)){l?.("Primary color must be a valid hex color (e.g., #3B82F6)","error");return}if(!B.test(v.secondary_color)){l?.("Secondary color must be a valid hex color (e.g., #1E40AF)","error");return}const me=await i(v);me.success?l?.("Branding settings saved successfully!","success"):l?.(me.error||"Failed to save branding settings","error")}catch(B){console.error("Save error:",B),l?.("Failed to save branding settings","error")}finally{p(!1)}},R=()=>{y?(document.documentElement.style.setProperty("--primary-color",c.primary_color),document.documentElement.style.setProperty("--secondary-color",c.secondary_color),document.title=c.custom_app_name||"FieldSync"):(document.documentElement.style.setProperty("--primary-color",v.primary_color),document.documentElement.style.setProperty("--secondary-color",v.secondary_color),document.title=v.custom_app_name||"FieldSync"),m(!y)};return h?e.jsxs("div",{className:"settings-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading branding settings..."})]}):e.jsxs("div",{className:"branding-settings",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("h2",{children:" Branding Settings"}),ue==="free"&&e.jsx("div",{className:"tier-badge tier-free",children:"Free Plan - Upgrade for branding options"}),ue==="pro"&&e.jsx("div",{className:"tier-badge tier-pro",children:"Pro Plan"}),ue==="business"&&e.jsx("div",{className:"tier-badge tier-business",children:"Business Plan"}),ue==="enterprise"&&e.jsx("div",{className:"tier-badge tier-enterprise",children:"Enterprise Plan"})]}),e.jsxs("div",{className:"settings-section security-section",children:[e.jsx("h3",{children:"Security"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Office Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Share this code with office staff only. Required to create new office accounts."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:_||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:W,disabled:!_,children:"Copy"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:E,disabled:$,children:$?"...":"Regenerate"})]}),e.jsx("p",{className:"help-text",style:{marginTop:"0.5rem",color:"var(--accent-amber)"},children:"Field workers should NOT have this code - they use project PINs only."})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Company Code"}),e.jsx("p",{className:"help-text",style:{marginBottom:"0.75rem"},children:"Public code for employees to find your company."}),e.jsxs("div",{className:"office-code-display",children:[e.jsx("code",{className:"office-code-value",children:r?.code||"------"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:()=>{navigator.clipboard.writeText(r?.code||""),l?.("Company code copied","success")},disabled:!r?.code,children:"Copy"})]})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Visual Identity"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Logo"}),ae?e.jsxs(e.Fragment,{children:[v.logo_url&&e.jsx("div",{className:"logo-preview",children:e.jsx("img",{src:v.logo_url,alt:"Logo preview"})}),e.jsx("input",{ref:U,type:"file",accept:"image/*",style:{display:"none"},onChange:B=>M(B.target.files[0],"logo")}),e.jsx("button",{className:"btn-secondary",onClick:()=>U.current?.click(),children:v.logo_url?"Change Logo":"Upload Logo"}),e.jsx("p",{className:"help-text",children:"Recommended: 200x60px, PNG with transparent background"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your logo"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"app-name",children:"App Name"}),ae?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"app-name",type:"text",className:"input",value:v.custom_app_name||"",onChange:B=>ce("custom_app_name",B.target.value),placeholder:"FieldSync",maxLength:50}),e.jsx("p",{className:"help-text",children:"This name appears in the browser tab and throughout the app"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your app name"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"primary-color",children:"Primary Color"}),ae?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"primary-color",type:"color",value:v.primary_color||"#3B82F6",onChange:B=>ce("primary_color",B.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:v.primary_color||"#3B82F6",onChange:B=>ce("primary_color",B.target.value),placeholder:"#3B82F6",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"secondary-color",children:"Secondary Color"}),ae?e.jsxs("div",{className:"color-input-group",children:[e.jsx("input",{id:"secondary-color",type:"color",value:v.secondary_color||"#1E40AF",onChange:B=>ce("secondary_color",B.target.value),className:"color-picker"}),e.jsx("input",{type:"text",className:"input color-text",value:v.secondary_color||"#1E40AF",onChange:B=>ce("secondary_color",B.target.value),placeholder:"#1E40AF",pattern:"^#[0-9A-Fa-f]{6}$"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize colors"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Favicon"}),ae?e.jsxs(e.Fragment,{children:[v.favicon_url&&e.jsx("div",{className:"favicon-preview",children:e.jsx("img",{src:v.favicon_url,alt:"Favicon preview"})}),e.jsx("input",{ref:X,type:"file",accept:"image/*",style:{display:"none"},onChange:B=>M(B.target.files[0],"favicon")}),e.jsx("button",{className:"btn-secondary",onClick:()=>X.current?.click(),children:v.favicon_url?"Change Favicon":"Upload Favicon"}),e.jsx("p",{className:"help-text",children:"Recommended: 32x32px or 64x64px, PNG or ICO format"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Pro, Business, or Enterprise to customize your favicon"})})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{children:"Login Background"}),Y?e.jsxs(e.Fragment,{children:[v.login_background_url&&e.jsx("div",{className:"background-preview",children:e.jsx("img",{src:v.login_background_url,alt:"Background preview"})}),e.jsx("input",{ref:V,type:"file",accept:"image/*",style:{display:"none"},onChange:B=>M(B.target.files[0],"login_background")}),e.jsx("button",{className:"btn-secondary",onClick:()=>V.current?.click(),children:v.login_background_url?"Change Background":"Upload Background"}),e.jsx("p",{className:"help-text",children:"Recommended: 1920x1080px, JPG or PNG"})]}):e.jsx("div",{className:"upgrade-notice",children:e.jsx("p",{children:" Upgrade to Business or Enterprise to customize login background"})})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"White-Label Options"}),e.jsxs("div",{className:"setting-item",children:[e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:v.hide_fieldsync_branding||!1,onChange:B=>ce("hide_fieldsync_branding",B.target.checked),disabled:!Y}),e.jsx("span",{children:'Hide "Powered by FieldSync"'})]}),!Y&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Email Branding"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-name",children:"From Name"}),e.jsx("input",{id:"email-from-name",type:"text",className:"input",value:v.email_from_name||"",onChange:B=>ce("email_from_name",B.target.value),placeholder:"Your Company Name",disabled:!Y}),!Y&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"email-from-address",children:"From Email"}),e.jsx("input",{id:"email-from-address",type:"email",className:"input",value:v.email_from_address||"",onChange:B=>ce("email_from_address",B.target.value),placeholder:"noreply@yourcompany.com",disabled:!Y}),!Y&&e.jsx("p",{className:"help-text",children:" Business or Enterprise plan required"})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("h3",{children:"Custom Domain"}),e.jsxs("div",{className:"setting-item",children:[e.jsx("label",{htmlFor:"custom-domain",children:"Domain"}),P?e.jsxs(e.Fragment,{children:[e.jsx("input",{id:"custom-domain",type:"text",className:"input",value:v.custom_domain||"",onChange:B=>ce("custom_domain",B.target.value),placeholder:"app.yourcompany.com"}),v.custom_domain&&e.jsx("div",{className:`domain-status ${v.domain_verified?"verified":"pending"}`,children:v.domain_verified?e.jsx(e.Fragment,{children:" Connected"}):e.jsx(e.Fragment,{children:" DNS setup required"})}),e.jsx("p",{className:"help-text",children:"Contact support to configure DNS and SSL certificate for your custom domain"})]}):e.jsxs("div",{className:"upgrade-notice",children:[e.jsx("p",{children:" Enterprise plan required for custom domain support"}),e.jsx("p",{className:"help-text",children:"Custom domains allow you to host the app at your own URL (e.g., app.yourcompany.com)"})]})]})]}),e.jsxs("div",{className:"settings-actions",children:[e.jsx("button",{className:"btn-secondary",onClick:R,children:y?"Exit Preview":"Preview Changes"}),e.jsx("button",{className:"btn-primary",onClick:b,disabled:g||!ae,children:g?"Saving...":"Save Changes"})]}),y&&e.jsx("div",{className:"preview-banner",children:"Preview Mode Active - Your changes are not yet saved"})]})}const Sd=["foreman","operator","laborer"],Cd=["demolition","abatement"],wd=["standard","pla"];function Iy({company:r,onShowToast:l}){const[c,i]=x.useState({}),[d,h]=x.useState(!1),[g,p]=x.useState(!1),[y,m]=x.useState("demolition"),[v,A]=x.useState(!0);x.useEffect(()=>{r?.id&&j()},[r?.id]);const _=()=>{const q={};return Cd.forEach(E=>{q[E]={},wd.forEach(W=>{q[E][W]={},Sd.forEach(ue=>{q[E][W][ue]={regular:"",overtime:""}})})}),q},j=async()=>{if(!H){i(_()),A(!1);return}const q=_();try{const{data:E,error:W}=await w.from("labor_rates").select("*").eq("company_id",r.id);if(W){i(q),A(!1);return}E&&E.length>0&&E.forEach(ue=>{q[ue.work_type]&&q[ue.work_type][ue.job_type]&&q[ue.work_type][ue.job_type][ue.role]&&(q[ue.work_type][ue.job_type][ue.role]={regular:ue.regular_rate||"",overtime:ue.overtime_rate||""})}),i(q)}catch(E){console.error("Error loading labor rates:",E),i(q)}finally{A(!1)}},$=async()=>{if(!H){l("Labor rates require database connection","error");return}p(!0);try{await w.from("labor_rates").delete().eq("company_id",r.id);const q=[];Cd.forEach(W=>{wd.forEach(ue=>{Sd.forEach(ae=>{const Y=c[W]?.[ue]?.[ae]||{regular:0,overtime:0};q.push({company_id:r.id,role:ae,work_type:W,job_type:ue,regular_rate:parseFloat(Y.regular)||0,overtime_rate:parseFloat(Y.overtime)||0})})})});const{error:E}=await w.from("labor_rates").insert(q);if(E)throw E;l("Labor rates saved","success"),h(!1)}catch(q){console.error("Error saving labor rates:",q),l("Error saving rates: "+(q.message||"Unknown error"),"error")}finally{p(!1)}},C=(q,E,W,ue,ae)=>{i(Y=>({...Y,[q]:{...Y[q],[E]:{...Y[q]?.[E],[W]:{...Y[q]?.[E]?.[W],[ue]:ae}}}}))},U=q=>q.charAt(0).toUpperCase()+q.slice(1),X=q=>q.charAt(0).toUpperCase()+q.slice(1),V=q=>q==="pla"?"PLA (Prevailing Wage)":"Standard (Private)";return v?e.jsx("div",{className:"loading",children:"Loading labor rates..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"pricing-section-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Labor Rates"}),e.jsx("p",{className:"section-desc",children:"Configure hourly rates by role, work type, and job classification"})]}),d?e.jsxs("div",{className:"rate-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>{h(!1),j()},children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:$,disabled:g,children:g?"Saving...":"Save All Rates"})]}):e.jsx("button",{className:"btn btn-primary",onClick:()=>h(!0),children:"Edit Rates"})]}),e.jsx("div",{className:"work-type-tabs",children:Cd.map(q=>e.jsx("button",{className:`work-type-tab ${y===q?"active":""}`,onClick:()=>m(q),children:X(q)},q))}),e.jsx("div",{className:"labor-rates-container",children:wd.map(q=>e.jsxs("div",{className:"job-type-section",children:[e.jsx("h3",{className:"job-type-header",children:V(q)}),e.jsxs("div",{className:"rates-table",children:[e.jsxs("div",{className:"rates-table-header",children:[e.jsx("div",{className:"rate-cell role-cell",children:"Role"}),e.jsx("div",{className:"rate-cell",children:"Regular"}),e.jsx("div",{className:"rate-cell",children:"Overtime"})]}),Sd.map(E=>{const W=c[y]?.[q]?.[E]||{regular:"",overtime:""};return e.jsxs("div",{className:"rates-table-row",children:[e.jsx("div",{className:"rate-cell role-cell",children:U(E)}),e.jsx("div",{className:"rate-cell",children:d?e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",value:W.regular,onChange:ue=>C(y,q,E,"regular",ue.target.value.replace(/[^0-9.]/g,"")),placeholder:"0"}),e.jsx("span",{children:"/hr"})]}):e.jsxs("span",{className:"rate-value",children:["$",parseFloat(W.regular)||0,"/hr"]})}),e.jsx("div",{className:"rate-cell",children:d?e.jsxs("div",{className:"rate-input-inline",children:[e.jsx("span",{children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",value:W.overtime,onChange:ue=>C(y,q,E,"overtime",ue.target.value.replace(/[^0-9.]/g,"")),placeholder:"0"}),e.jsx("span",{children:"/hr"})]}):e.jsxs("span",{className:"rate-value ot",children:["$",parseFloat(W.overtime)||0,"/hr"]})})]},E)})]})]},q))})]})}const Pi=["Containment","PPE","Disposal","Equipment"];function Qy({company:r,onShowToast:l}){const[c,i]=x.useState([]),[d,h]=x.useState(!0),[g,p]=x.useState("all"),[y,m]=x.useState(null),[v,A]=x.useState(!1),[_,j]=x.useState({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),[$,C]=x.useState([]),[U,X]=x.useState(!1);x.useEffect(()=>{r?.id&&V()},[r?.id]);const V=async()=>{h(!0);try{const M=await K.getAllMaterialsEquipment(r.id);i(M||[]),q(M||[])}catch(M){console.error("Error loading items:",M),l("Error loading materials","error")}finally{h(!1)}},q=M=>{const b={},R=[];M.filter(me=>me.active!==!1).forEach(me=>{const T=me.name.toLowerCase().trim();b[T]||(b[T]=[]),b[T].push(me)}),Object.entries(b).forEach(([me,T])=>{T.length>1&&R.push({name:me,items:T})}),C(R)},E=async M=>{try{const b=M.items.filter(me=>me.cost_per_unit>0),R=b.length>0?b[0]:M.items[0],B=M.items.filter(me=>me.id!==R.id);for(const me of B)await K.deleteMaterialEquipment(me.id);l(`Merged ${M.items.length} items into one`,"success"),V()}catch(b){console.error("Error merging duplicates:",b),l("Error merging duplicates","error")}},W=async()=>{if(confirm(`Merge all ${$.length} duplicate groups?`))try{for(const M of $){const b=M.items.filter(me=>me.cost_per_unit>0),R=b.length>0?b[0]:M.items[0],B=M.items.filter(me=>me.id!==R.id);for(const me of B)await K.deleteMaterialEquipment(me.id)}l("All duplicates merged!","success"),V(),X(!1)}catch(M){console.error("Error merging all duplicates:",M),l("Error merging duplicates","error")}},ue=async()=>{if(!_.name.trim()){l("Enter item name","error");return}try{await K.createMaterialEquipment({company_id:r.id,name:_.name.trim(),category:_.category,unit:_.unit||"each",cost_per_unit:parseFloat(_.cost_per_unit)||0,active:!0}),l("Item added","success"),j({name:"",category:"Equipment",unit:"each",cost_per_unit:""}),A(!1),V()}catch(M){console.error("Error adding item:",M),l("Error adding item","error")}},ae=async M=>{try{await K.updateMaterialEquipment(M.id,{name:M.name,category:M.category,unit:M.unit,cost_per_unit:parseFloat(M.cost_per_unit)||0}),l("Item updated","success"),m(null),V()}catch(b){console.error("Error updating item:",b),l("Error updating item","error")}},Y=async M=>{if(confirm("Delete this item?"))try{await K.deleteMaterialEquipment(M),l("Item deleted","success"),V()}catch(b){console.error("Error deleting item:",b),l("Error deleting item","error")}},P=g==="all"?c.filter(M=>M.active!==!1):c.filter(M=>M.category===g&&M.active!==!1),ce=P.reduce((M,b)=>{const R=b.category||"Other";return M[R]||(M[R]=[]),M[R].push(b),M},{});return d?e.jsx("div",{className:"loading",children:"Loading materials..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"materials-header",children:[e.jsxs("div",{className:"materials-title",children:[e.jsx("h2",{children:"Materials & Equipment"}),e.jsxs("span",{className:"materials-count",children:[c.filter(M=>M.active!==!1).length," items"]})]}),e.jsxs("div",{className:"materials-actions",children:[$.length>0&&e.jsxs("button",{className:`btn btn-warning ${U?"active":""}`,onClick:()=>X(!U),children:[$.length," Duplicates"]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>A(!0),children:"+ Add Item"})]})]}),U&&$.length>0&&e.jsxs("div",{className:"duplicates-panel",children:[e.jsxs("div",{className:"duplicates-header",children:[e.jsx("h3",{children:"Duplicate Items Found"}),e.jsxs("button",{className:"btn btn-success btn-small",onClick:W,children:["Merge All (",$.length,")"]})]}),e.jsx("div",{className:"duplicates-list",children:$.map((M,b)=>e.jsxs("div",{className:"duplicate-group",children:[e.jsxs("div",{className:"duplicate-name",children:['"',M.name,'" x ',M.items.length]}),e.jsx("div",{className:"duplicate-items",children:M.items.map(R=>e.jsxs("span",{className:"duplicate-item",children:[R.category," - $",R.cost_per_unit||0]},R.id))}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>E(M),children:"Merge"})]},b))})]}),v&&e.jsxs("div",{className:"add-item-form",children:[e.jsx("h3",{children:"Add New Item"}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Item Name",value:_.name,onChange:M=>j({..._,name:M.target.value}),autoFocus:!0}),e.jsx("select",{value:_.category,onChange:M=>j({..._,category:M.target.value}),children:Pi.map(M=>e.jsx("option",{value:M,children:M},M))})]}),e.jsxs("div",{className:"form-row",children:[e.jsx("input",{type:"text",placeholder:"Unit (e.g., each, day, hour)",value:_.unit,onChange:M=>j({..._,unit:M.target.value})}),e.jsxs("div",{className:"dollar-input-wrapper",children:[e.jsx("span",{className:"dollar-prefix",children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",className:"dollar-input",placeholder:"Cost per unit",value:_.cost_per_unit,onChange:M=>{const b=M.target.value.replace(/[^0-9.]/g,"");j({..._,cost_per_unit:b})}})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>A(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:ue,children:"Add Item"})]})]}),e.jsxs("div",{className:"materials-filter",children:[e.jsx("button",{className:`filter-tab ${g==="all"?"active":""}`,onClick:()=>p("all"),children:"All"}),Pi.map(M=>e.jsxs("button",{className:`filter-tab ${g===M?"active":""}`,onClick:()=>p(M),children:[M,e.jsx("span",{className:"filter-count",children:c.filter(b=>b.category===M&&b.active!==!1).length})]},M))]}),e.jsxs("div",{className:"materials-list",children:[g==="all"?Object.entries(ce).map(([M,b])=>e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:M}),e.jsx("div",{className:"category-items",children:b.map(R=>e.jsx(tf,{item:R,editingItem:y,setEditingItem:m,handleUpdateItem:ae,handleDeleteItem:Y,categories:Pi},R.id))})]},M)):e.jsxs("div",{className:"materials-category",children:[e.jsx("h3",{className:"category-header",children:g}),e.jsx("div",{className:"category-items",children:P.map(M=>e.jsx(tf,{item:M,editingItem:y,setEditingItem:m,handleUpdateItem:ae,handleDeleteItem:Y,categories:Pi},M.id))})]}),P.length===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No items in this category"})})]})]})}function tf({item:r,editingItem:l,setEditingItem:c,handleUpdateItem:i,handleDeleteItem:d,categories:h}){return l?.id===r.id?e.jsx("div",{className:"material-item",children:e.jsxs("div",{className:"item-edit-form",children:[e.jsx("input",{type:"text",value:l.name,onChange:g=>c({...l,name:g.target.value})}),e.jsx("select",{value:l.category,onChange:g=>c({...l,category:g.target.value}),children:h.map(g=>e.jsx("option",{value:g,children:g},g))}),e.jsx("input",{type:"text",value:l.unit,onChange:g=>c({...l,unit:g.target.value}),placeholder:"Unit"}),e.jsxs("div",{className:"dollar-input-wrapper compact",children:[e.jsx("span",{className:"dollar-prefix",children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",className:"dollar-input",value:l.cost_per_unit,onChange:g=>{const p=g.target.value.replace(/[^0-9.]/g,"");c({...l,cost_per_unit:p})},placeholder:"Cost"})]}),e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:()=>i(l),children:"Save"}),e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>c(null),children:"Cancel"})]})]})}):e.jsxs("div",{className:"material-item",children:[e.jsxs("div",{className:"item-info",children:[e.jsx("span",{className:"item-name",children:r.name}),e.jsx("span",{className:"item-unit",children:r.unit||"each"})]}),e.jsxs("div",{className:"item-cost",children:["$",(r.cost_per_unit||0).toFixed(2)]}),e.jsxs("div",{className:"item-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>c({...r}),title:"Edit",children:e.jsx(Bd,{size:16})}),e.jsx("button",{className:"btn-icon danger",onClick:()=>d(r.id),title:"Delete",children:e.jsx(Us,{size:16})})]})]})}const Xy=[{id:"trash",label:"Trash",description:"General debris"},{id:"metal",label:"Metal",description:"Scrap metal (recyclable)"},{id:"copper",label:"Copper",description:"Copper scrap (recyclable)"},{id:"concrete",label:"Concrete",description:"Concrete/masonry"},{id:"hazardous",label:"Hazardous",description:"Hazardous materials"}];function Zy({company:r,onShowToast:l}){const[c,i]=x.useState([]),[d,h]=x.useState(!0),[g,p]=x.useState(!1),[y,m]=x.useState(null),[v,A]=x.useState({name:"",address:"",notes:""}),[_,j]=x.useState(!1),[$,C]=x.useState({}),U=x.useRef({});x.useEffect(()=>{r?.id&&X()},[r?.id]),x.useEffect(()=>()=>{Object.values(U.current).forEach(P=>clearTimeout(P))},[]);const X=async()=>{h(!0);try{const P=await K.getDumpSites(r.id);i(P||[])}catch(P){console.error("Error loading dump sites:",P),l("Error loading dump sites","error")}finally{h(!1)}},V=async()=>{if(!v.name.trim()){l("Please enter a site name","error");return}j(!0);try{await K.createDumpSite(r.id,v.name,v.address,v.notes),l("Dump site added","success"),A({name:"",address:"",notes:""}),p(!1),X()}catch(P){console.error("Error adding dump site:",P),l("Error adding dump site","error")}finally{j(!1)}},q=async()=>{if(!y?.name.trim()){l("Please enter a site name","error");return}j(!0);try{await K.updateDumpSite(y.id,{name:y.name,address:y.address,notes:y.notes}),l("Dump site updated","success"),m(null),X()}catch(P){console.error("Error updating dump site:",P),l("Error updating dump site","error")}finally{j(!1)}},E=async P=>{if(confirm("Are you sure you want to delete this dump site?"))try{await K.deleteDumpSite(P),l("Dump site deleted","success"),X()}catch(ce){console.error("Error deleting dump site:",ce),l("Error deleting dump site","error")}},W=x.useCallback(async(P,ce,M)=>{try{await K.setDumpSiteRate(P,ce,M),i(b=>b.map(R=>{if(R.id===P){const B=[...R.dump_site_rates||[]],me=B.findIndex(T=>T.waste_type===ce);return me>=0?B[me]={...B[me],estimated_cost_per_load:M}:B.push({waste_type:ce,estimated_cost_per_load:M}),{...R,dump_site_rates:B}}return R})),C(b=>{const R={...b};return delete R[`${P}-${ce}`],R})}catch(b){console.error("Error saving rate:",b?.message||b),l("Error saving rate","error")}},[l]),ue=(P,ce,M)=>{const b=`${P}-${ce}`;C(R=>({...R,[b]:M})),U.current[b]&&clearTimeout(U.current[b]),U.current[b]=setTimeout(()=>{const R=parseFloat(M)||0;W(P,ce,R)},500)},ae=(P,ce)=>{const M=`${P.id}-${ce}`;return $[M]!==void 0?$[M]:P.dump_site_rates?.find(R=>R.waste_type===ce)?.estimated_cost_per_load??""},Y=P=>{if(P===""||P===null||P===void 0)return"";const ce=parseFloat(P);return ce<0?`-$${Math.abs(ce).toFixed(0)}`:`$${ce.toFixed(0)}`};return d?e.jsx("div",{className:"loading",children:"Loading dump sites..."}):e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"dump-site-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"Disposal & Haul-Off"}),e.jsx("p",{className:"section-desc",children:"Configure dump sites and estimated costs per load for each waste type. Use negative values for recyclables (metal, copper) to indicate revenue."})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>p(!0),children:"+ Add Dump Site"})]}),g&&e.jsxs("div",{className:"dump-site-form card",children:[e.jsx("h4",{children:"Add Dump Site"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name *"}),e.jsx("input",{type:"text",value:v.name,onChange:P=>A({...v,name:P.target.value}),placeholder:"e.g., Metro Landfill"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:v.address,onChange:P=>A({...v,address:P.target.value}),placeholder:"123 Main St, City"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:v.notes,onChange:P=>A({...v,notes:P.target.value}),placeholder:"Operating hours, contact, etc."})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>p(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:V,disabled:_,children:_?"Adding...":"Add Site"})]})]}),c.length===0?e.jsxs("div",{className:"dump-site-empty",children:[e.jsx("p",{children:"No dump sites configured yet."}),e.jsx("p",{children:"Add a dump site to start tracking haul-off costs."})]}):e.jsx("div",{className:"dump-sites-list",children:c.map(P=>e.jsxs("div",{className:"dump-site-card card",children:[y?.id===P.id?e.jsxs("div",{className:"dump-site-edit",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Site Name *"}),e.jsx("input",{type:"text",value:y.name,onChange:ce=>m({...y,name:ce.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Address"}),e.jsx("input",{type:"text",value:y.address||"",onChange:ce=>m({...y,address:ce.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:y.notes||"",onChange:ce=>m({...y,notes:ce.target.value})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>m(null),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary btn-sm",onClick:q,disabled:_,children:_?"Saving...":"Save"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dump-site-info",children:[e.jsx("div",{className:"dump-site-name",children:P.name}),P.address&&e.jsx("div",{className:"dump-site-address",children:P.address}),P.notes&&e.jsx("div",{className:"dump-site-notes",children:P.notes})]}),e.jsxs("div",{className:"dump-site-actions",children:[e.jsx("button",{className:"btn-icon",onClick:()=>m({...P}),title:"Edit",children:e.jsx(Bd,{size:16})}),e.jsx("button",{className:"btn-icon",onClick:()=>E(P.id),title:"Delete",children:e.jsx(Us,{size:16})})]})]}),e.jsxs("div",{className:"dump-site-rates",children:[e.jsx("div",{className:"rates-header",children:"Estimated Cost per Load"}),e.jsx("div",{className:"rates-grid",children:Xy.map(ce=>e.jsxs("div",{className:"rate-item",children:[e.jsxs("label",{children:[e.jsx("span",{className:"rate-label",children:ce.label}),e.jsx("span",{className:"rate-desc",children:ce.description})]}),e.jsxs("div",{className:"rate-input-wrapper",children:[e.jsx("span",{className:"rate-prefix",children:"$"}),e.jsx("input",{type:"text",inputMode:"decimal",className:"rate-input",value:ae(P,ce.id),onChange:M=>{const b=M.target.value.replace(/[^0-9.-]/g,"");ue(P.id,ce.id,b)},placeholder:"0"})]}),ae(P,ce.id)!==""&&e.jsxs("span",{className:`rate-preview ${parseFloat(ae(P,ce.id))<0?"revenue":"cost"}`,children:[Y(ae(P,ce.id)),"/load"]})]},ce.id))}),e.jsx("div",{className:"rates-note",children:"Tip: Use negative values for recyclables that generate revenue (e.g., -50 for metal)"})]})]},P.id))})]})}const Jy=[{id:"labor",label:"Labor Rates",Icon:Da},{id:"materials",label:"Materials & Equipment",Icon:wl},{id:"disposal",label:"Disposal & Haul-Off",Icon:ds}];function Wy({company:r,onShowToast:l}){const[c,i]=x.useState("labor");return e.jsxs("div",{className:"pricing-manager",children:[e.jsxs("div",{className:"pricing-header",children:[e.jsx("h1",{children:"Pricing Configuration"}),e.jsx("p",{className:"pricing-subtitle",children:"Set up labor rates, materials pricing, and disposal costs"})]}),e.jsx("div",{className:"pricing-tabs",children:Jy.map(d=>e.jsxs("button",{className:`pricing-tab ${c===d.id?"active":""}`,onClick:()=>i(d.id),children:[e.jsx(d.Icon,{size:18,className:"pricing-tab-icon"}),e.jsx("span",{className:"pricing-tab-label",children:d.label})]},d.id))}),e.jsxs("div",{className:"pricing-content",children:[c==="labor"&&e.jsx(Iy,{company:r,onShowToast:l}),c==="materials"&&e.jsx(Qy,{company:r,onShowToast:l}),c==="disposal"&&e.jsx(Zy,{company:r,onShowToast:l})]})]})}function Ky({shareToken:r}){const[l,c]=x.useState(!0),[i,d]=x.useState(null),[h,g]=x.useState(null),[p,y]=x.useState(0),{branding:m}=Dr();x.useEffect(()=>{v()},[r]);const v=async()=>{c(!0),d(null);try{const E=await K.getPublicProjectData(r);if(!E){d("This share link is invalid or has expired.");return}g(E)}catch(E){console.error("Error loading public data:",E),d("Failed to load project data.")}finally{c(!1)}},A=E=>E?new Date(E).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",_=E=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(E);if(l)return e.jsxs("div",{className:"public-view",children:[e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading project..."})]}),e.jsx("style",{children:kd})]});if(i)return e.jsxs("div",{className:"public-view",children:[e.jsxs("div",{className:"error-container",children:[e.jsx("div",{className:"error-icon",children:e.jsx(Tr,{size:48})}),e.jsx("h2",{children:i}),e.jsx("p",{children:"Please contact the project owner for a valid link."})]}),e.jsx("style",{children:kd})]});const{share:j,project:$,progress:C,areas:U,photos:X,dailyReports:V,tmTickets:q}=h;return e.jsxs("div",{className:"public-view",children:[e.jsx("header",{className:"public-header",children:e.jsxs("div",{className:"container",children:[e.jsx(ps,{size:"large"}),e.jsx("div",{className:"header-meta",children:e.jsxs("span",{className:"last-updated",children:["Last updated: ",A($.updated_at||$.created_at)]})})]})}),e.jsx("main",{className:"public-main",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"project-header",children:[e.jsx("h1",{children:$.name}),$.address&&e.jsx("p",{className:"project-address",children:$.address})]}),j.permissions.progress&&e.jsxs("div",{className:"public-card progress-card",children:[e.jsx("h2",{children:"Project Progress"}),e.jsxs("div",{className:"progress-visual",children:[e.jsxs("div",{className:"progress-circle",children:[e.jsxs("svg",{viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#e5e7eb",strokeWidth:"8"}),e.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"var(--primary-color, #3b82f6)",strokeWidth:"8",strokeDasharray:`${C*2.827} 282.7`,strokeLinecap:"round",transform:"rotate(-90 50 50)"})]}),e.jsxs("div",{className:"progress-percentage",children:[C,"%"]})]}),e.jsxs("div",{className:"progress-details",children:[e.jsx("div",{className:"progress-label",children:"Complete"}),U&&U.length>0&&e.jsxs("div",{className:"areas-summary",children:[U.filter(E=>E.status==="done").length," of ",U.length," areas completed"]})]})]}),U&&U.length>0&&e.jsxs("div",{className:"areas-list",children:[e.jsx("h3",{children:"Work Areas"}),U.map(E=>e.jsxs("div",{className:"area-item",children:[e.jsxs("div",{className:"area-info",children:[e.jsx("span",{className:"area-name",children:E.name}),e.jsxs("span",{className:"area-weight",children:[E.weight,"%"]})]}),e.jsx("div",{className:`area-status status-${E.status}`,children:E.status==="done"?" Complete":E.status==="working"?" In Progress":" Not Started"})]},E.id))]})]}),j.permissions.photos&&X&&X.length>0&&e.jsxs("div",{className:"public-card photos-card",children:[e.jsx("h2",{children:"Recent Photos"}),e.jsxs("div",{className:"photos-carousel",children:[e.jsxs("div",{className:"carousel-main",children:[X[p]&&e.jsx("img",{src:X[p].url,alt:`Project photo from ${A(X[p].date)}`,className:"carousel-image"}),e.jsx("div",{className:"carousel-date",children:A(X[p]?.date)})]}),e.jsx("div",{className:"carousel-thumbnails",children:X.slice(0,10).map((E,W)=>e.jsx("div",{className:`thumbnail ${W===p?"active":""}`,onClick:()=>y(W),children:e.jsx("img",{src:E.url,alt:`Thumbnail ${W+1}`})},W))}),X.length>1&&e.jsxs("div",{className:"carousel-controls",children:[e.jsx("button",{onClick:()=>y(E=>E>0?E-1:X.length-1),className:"carousel-btn",children:""}),e.jsxs("span",{className:"carousel-counter",children:[p+1," / ",X.length]}),e.jsx("button",{onClick:()=>y(E=>E<X.length-1?E+1:0),className:"carousel-btn",children:""})]})]})]}),j.permissions.daily_reports&&V&&V.length>0&&e.jsxs("div",{className:"public-card reports-card",children:[e.jsx("h2",{children:"Daily Reports"}),e.jsx("div",{className:"reports-list",children:V.map((E,W)=>e.jsxs("div",{className:"report-item",children:[e.jsx("div",{className:"report-date",children:A(E.report_date)}),e.jsxs("div",{className:"report-content",children:[E.crew_count&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Crew:"})," ",E.crew_count," workers"]}),E.tasks_completed&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Tasks Completed:"})," ",E.tasks_completed]}),E.weather&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Weather:"})," ",E.weather]}),E.notes&&e.jsxs("div",{className:"report-field",children:[e.jsx("strong",{children:"Notes:"})," ",E.notes]})]})]},W))})]}),j.permissions.tm_tickets&&q&&q.length>0&&e.jsxs("div",{className:"public-card tm-card",children:[e.jsx("h2",{children:"Time & Materials Tickets"}),e.jsx("div",{className:"tm-list",children:q.map((E,W)=>e.jsxs("div",{className:"tm-item",children:[e.jsxs("div",{className:"tm-header",children:[e.jsx("span",{className:"tm-date",children:A(E.work_date)}),e.jsx("span",{className:`tm-status status-${E.status}`,children:E.status})]}),E.description&&e.jsx("div",{className:"tm-description",children:E.description}),E.total_amount&&e.jsxs("div",{className:"tm-amount",children:["Total: ",_(E.total_amount)]})]},W))})]})]})}),e.jsx("footer",{className:"public-footer",children:e.jsx("div",{className:"container",children:!m?.hide_fieldsync_branding&&e.jsx("p",{children:"Powered by FieldSync"})})}),e.jsx("style",{children:kd})]})}const kd=`
  .public-view {
    min-height: 100vh;
    background-color: #f9fafb;
    display: flex;
    flex-direction: column;
  }

  .container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 1rem;
    width: 100%;
  }

  /* Header */
  .public-header {
    background-color: white;
    border-bottom: 1px solid #e5e7eb;
    padding: 1.5rem 0;
  }

  .public-header .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .header-meta {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Main Content */
  .public-main {
    flex: 1;
    padding: 2rem 0;
  }

  .project-header {
    margin-bottom: 2rem;
  }

  .project-header h1 {
    font-size: 2rem;
    margin: 0 0 0.5rem 0;
    color: #111827;
  }

  .project-address {
    font-size: 1rem;
    color: #6b7280;
    margin: 0;
  }

  /* Cards */
  .public-card {
    background-color: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .public-card h2 {
    font-size: 1.5rem;
    margin: 0 0 1.5rem 0;
    color: #111827;
  }

  .public-card h3 {
    font-size: 1.125rem;
    margin: 1.5rem 0 1rem 0;
    color: #374151;
  }

  /* Progress Card */
  .progress-visual {
    display: flex;
    align-items: center;
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .progress-circle {
    position: relative;
    width: 150px;
    height: 150px;
    flex-shrink: 0;
  }

  .progress-circle svg {
    width: 100%;
    height: 100%;
  }

  .progress-percentage {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2rem;
    font-weight: bold;
    color: var(--primary-color, #3b82f6);
  }

  .progress-details {
    flex: 1;
  }

  .progress-label {
    font-size: 1.25rem;
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.5rem;
  }

  .areas-summary {
    font-size: 1rem;
    color: #6b7280;
  }

  /* Areas List */
  .areas-list {
    border-top: 1px solid #e5e7eb;
    padding-top: 1rem;
  }

  .area-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f3f4f6;
  }

  .area-item:last-child {
    border-bottom: none;
  }

  .area-info {
    flex: 1;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-right: 1rem;
  }

  .area-name {
    font-weight: 500;
    color: #374151;
  }

  .area-weight {
    color: #6b7280;
    font-size: 0.875rem;
  }

  .area-status {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    white-space: nowrap;
  }

  .area-status.status-done {
    background-color: #d1fae5;
    color: #065f46;
  }

  .area-status.status-working {
    background-color: #fef3c7;
    color: #92400e;
  }

  .area-status.status-not_started {
    background-color: #f3f4f6;
    color: #6b7280;
  }

  /* Photos Carousel */
  .photos-carousel {
    position: relative;
  }

  .carousel-main {
    position: relative;
    width: 100%;
    height: 400px;
    background-color: #111827;
    border-radius: 8px;
    overflow: hidden;
    margin-bottom: 1rem;
  }

  .carousel-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .carousel-date {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
    color: white;
    padding: 1rem;
    text-align: center;
  }

  .carousel-thumbnails {
    display: flex;
    gap: 0.5rem;
    overflow-x: auto;
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
  }

  .thumbnail {
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    border-radius: 4px;
    overflow: hidden;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.2s;
  }

  .thumbnail:hover {
    border-color: #d1d5db;
  }

  .thumbnail.active {
    border-color: var(--primary-color, #3b82f6);
  }

  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .carousel-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
  }

  .carousel-btn {
    background-color: white;
    border: 1px solid #d1d5db;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 1.25rem;
    transition: background-color 0.2s;
  }

  .carousel-btn:hover {
    background-color: #f3f4f6;
  }

  .carousel-counter {
    font-size: 0.875rem;
    color: #6b7280;
  }

  /* Daily Reports */
  .reports-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .report-item {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
  }

  .report-date {
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.75rem;
    font-size: 1.125rem;
  }

  .report-content {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .report-field {
    color: #374151;
    line-height: 1.5;
  }

  .report-field strong {
    color: #111827;
  }

  /* T&M Tickets */
  .tm-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .tm-item {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    padding: 1rem;
  }

  .tm-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .tm-date {
    font-weight: 600;
    color: #111827;
  }

  .tm-status {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: capitalize;
  }

  .tm-status.status-approved {
    background-color: #d1fae5;
    color: #065f46;
  }

  .tm-status.status-pending {
    background-color: #fef3c7;
    color: #92400e;
  }

  .tm-status.status-rejected {
    background-color: #fee2e2;
    color: #991b1b;
  }

  .tm-description {
    color: #374151;
    margin-bottom: 0.5rem;
  }

  .tm-amount {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--primary-color, #3b82f6);
  }

  /* Footer */
  .public-footer {
    background-color: white;
    border-top: 1px solid #e5e7eb;
    padding: 2rem 0;
    margin-top: auto;
  }

  .public-footer p {
    text-align: center;
    color: #6b7280;
    margin: 0;
    font-size: 0.875rem;
  }

  /* Loading & Error States */
  .loading-container,
  .error-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 2rem;
  }

  .spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #e5e7eb;
    border-top-color: var(--primary-color, #3b82f6);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  .loading-container p {
    margin-top: 1rem;
    color: #6b7280;
  }

  .error-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
  }

  .error-container h2 {
    color: #111827;
    margin: 0 0 0.5rem 0;
  }

  .error-container p {
    color: #6b7280;
    margin: 0;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .project-header h1 {
      font-size: 1.5rem;
    }

    .public-card {
      padding: 1.5rem;
    }

    .progress-visual {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .progress-circle {
      width: 120px;
      height: 120px;
    }

    .progress-percentage {
      font-size: 1.5rem;
    }

    .carousel-main {
      height: 300px;
    }

    .area-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .area-info {
      width: 100%;
      margin-right: 0;
    }
  }
`,zf=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[30,41,59]},af=r=>{if(!r)return"";const[l,c]=r.split(":"),i=parseInt(l),d=i>=12?"pm":"am";return`${i%12||12}:${c}${d}`},Af=r=>r.time_started&&r.time_ended?`${af(r.time_started)} - ${af(r.time_ended)}`:"-",Nl=r=>new Promise(l=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>{const i=document.createElement("canvas");i.width=c.width,i.height=c.height,i.getContext("2d").drawImage(c,0,0),l(i.toDataURL("image/png"))},c.onerror=()=>l(null),c.src=r});async function eb(r){if(!r||r.length===0)return{totalPhotos:0,verified:0,failed:0,issues:[],manifest:[]};const l=[];let c=0,i=0;const d=[];for(const h of r)if(!(!h.photos||h.photos.length===0))for(const g of h.photos){const p={ticketId:h.id,workDate:h.work_date,url:g,verified:!1,error:null};try{await Nl(g)?(p.verified=!0,c++):(p.error="Failed to load image",i++,d.push({ticketId:h.id,workDate:h.work_date,url:g,error:"Failed to load image"}))}catch(y){p.error=y.message||"Unknown error",i++,d.push({ticketId:h.id,workDate:h.work_date,url:g,error:p.error})}l.push(p)}return{totalPhotos:c+i,verified:c,failed:i,issues:d,manifest:l,allVerified:i===0,verifiedAt:new Date().toISOString()}}function tb(r,l,c,i){const d=JSON.stringify({cor:r,tmTickets:l,photoManifest:c,totals:i});let h=0;for(let p=0;p<d.length;p++){const y=d.charCodeAt(p);h=(h<<5)-h+y,h=h&h}const g=Math.abs(h).toString(16).padStart(16,"0");return{cor_data:{id:r.id,cor_number:r.cor_number,title:r.title,description:r.description,status:r.status,created_at:r.created_at,submitted_at:r.submitted_at,labor_items:r.labor_items,material_items:r.material_items,equipment_items:r.equipment_items,gc_markup_percent:r.gc_markup_percent,profit_markup_percent:r.profit_markup_percent},tickets_data:(l||[]).map(p=>({id:p.id,work_date:p.work_date,ce_pco_number:p.ce_pco_number,notes:p.notes,status:p.status,created_at:p.created_at,workers:p.t_and_m_workers||[],items:p.t_and_m_items||[],photos:p.photos||[],client_signature_name:p.client_signature_name,client_signature_date:p.client_signature_date})),photos_manifest:c,totals_snapshot:i,checksum:g}}async function ab(r,l,c,i={},d=null,h={}){const{verifyPhotos:g=!1,createSnapshot:p=!1}=h;let y=null;g&&d?.length>0&&(y=await eb(d));const m=new Sl,v=m.internal.pageSize.getWidth(),A=m.internal.pageSize.getHeight(),_=20;let j=_;const $=Ji(r),C=i.primaryColor?zf(i.primaryColor):[30,58,138],U=[241,245,249];let X=null;if(i.logoUrl)try{X=await Nl(i.logoUrl)}catch(b){console.error("Error loading logo:",b)}if(X)try{m.addImage(X,"PNG",_,j,40,15),j+=20}catch{m.setFontSize(16),m.setFont("helvetica","bold"),m.setTextColor(...C),m.text(c?.name||"Company Name",_,j+10),j+=20}else m.setFontSize(16),m.setFont("helvetica","bold"),m.setTextColor(...C),m.text(c?.name||"Company Name",_,j+10),j+=20;m.setFontSize(20),m.setFont("helvetica","bold"),m.setTextColor(0,0,0),m.text("CHANGE ORDER REQUEST",_,j),j+=10,m.setFontSize(12),m.setFont("helvetica","normal"),m.setTextColor(100,100,100),m.text(r.cor_number||"COR-XXXX",_,j);const V=r.status?.replace("_"," ").toUpperCase()||"DRAFT";m.setTextColor(...C),m.text(V,v-_-m.getTextWidth(V),j),j+=12,m.setDrawColor(...C),m.setLineWidth(.5),m.line(_,j,v-_,j),j+=10,m.setFontSize(10),m.setTextColor(0,0,0);const q=_,E=v/2;m.setFont("helvetica","bold"),m.text("Project:",q,j),m.setFont("helvetica","normal"),m.text(l?.name||"Project Name",q+25,j),m.setFont("helvetica","bold"),m.text("Job #:",E,j),m.setFont("helvetica","normal"),m.text(l?.job_number||"N/A",E+25,j),j+=6,m.setFont("helvetica","bold"),m.text("Period:",q,j),m.setFont("helvetica","normal"),m.text(Wi(r.period_start,r.period_end),q+25,j),m.setFont("helvetica","bold"),m.text("Date:",E,j),m.setFont("helvetica","normal"),m.text(Na(r.created_at),E+25,j),j+=10,m.setFont("helvetica","bold"),m.setFontSize(12),m.text(r.title||"Untitled Change Order",_,j),j+=8,m.setFont("helvetica","normal"),m.setFontSize(10),m.setTextColor(80,80,80);const W=m.splitTextToSize(r.scope_of_work||"No scope of work provided.",v-_*2);m.text(W,_,j),j+=W.length*5+10,r.change_order_labor?.length>0&&(m.setFont("helvetica","bold"),m.setFontSize(11),m.setTextColor(0,0,0),m.text("LABOR",_,j),j+=6,vs(m,{startY:j,head:[["Class","Type","Reg Hrs","Reg Rate","OT Hrs","OT Rate","Total"]],body:r.change_order_labor.map(b=>[b.labor_class,b.wage_type,b.regular_hours.toString(),`$${os(b.regular_rate)}/hr`,b.overtime_hours?.toString()||"-",b.overtime_hours?`$${os(b.overtime_rate)}/hr`:"-",Ue(b.total)]),foot:[[{content:`Subtotal: ${Ue($.labor_subtotal)}`,colSpan:5,styles:{halign:"right",fontStyle:"bold"}},{content:`+${oa(r.labor_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Ue($.labor_subtotal+$.labor_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:_,right:_},headStyles:{fillColor:C,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:U,textColor:[0,0,0],fontSize:8},theme:"striped"}),j=m.lastAutoTable.finalY+10),r.change_order_materials?.length>0&&(j>A-80&&(m.addPage(),j=_),m.setFont("helvetica","bold"),m.setFontSize(11),m.setTextColor(0,0,0),m.text("MATERIALS",_,j),j+=6,vs(m,{startY:j,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:r.change_order_materials.map(b=>[b.description,b.source_reference||b.source_type,b.quantity.toString(),b.unit,`$${os(b.unit_cost)}`,Ue(b.total)]),foot:[[{content:`Subtotal: ${Ue($.materials_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${oa(r.materials_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Ue($.materials_subtotal+$.materials_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:_,right:_},headStyles:{fillColor:C,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:U,textColor:[0,0,0],fontSize:8},theme:"striped"}),j=m.lastAutoTable.finalY+10),r.change_order_equipment?.length>0&&(j>A-80&&(m.addPage(),j=_),m.setFont("helvetica","bold"),m.setFontSize(11),m.setTextColor(0,0,0),m.text("EQUIPMENT",_,j),j+=6,vs(m,{startY:j,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:r.change_order_equipment.map(b=>[b.description,b.source_reference||b.source_type,b.quantity.toString(),b.unit,`$${os(b.unit_cost)}`,Ue(b.total)]),foot:[[{content:`Subtotal: ${Ue($.equipment_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${oa(r.equipment_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Ue($.equipment_subtotal+$.equipment_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:_,right:_},headStyles:{fillColor:C,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:U,textColor:[0,0,0],fontSize:8},theme:"striped"}),j=m.lastAutoTable.finalY+10),r.change_order_subcontractors?.length>0&&(j>A-80&&(m.addPage(),j=_),m.setFont("helvetica","bold"),m.setFontSize(11),m.setTextColor(0,0,0),m.text("SUBCONTRACTORS",_,j),j+=6,vs(m,{startY:j,head:[["Company","Description","Source","Amount"]],body:r.change_order_subcontractors.map(b=>[b.company_name,b.description,b.source_reference||b.source_type,Ue(b.total)]),foot:[[{content:`Subtotal: ${Ue($.subcontractors_subtotal)}`,colSpan:2,styles:{halign:"right",fontStyle:"bold"}},{content:`+${oa(r.subcontractors_markup_percent||500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:Ue($.subcontractors_subtotal+$.subcontractors_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:_,right:_},headStyles:{fillColor:C,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:U,textColor:[0,0,0],fontSize:8},theme:"striped"}),j=m.lastAutoTable.finalY+10),j>A-100&&(m.addPage(),j=_),m.setFillColor(...U),m.roundedRect(_,j,v-_*2,70,3,3,"F"),j+=10,m.setFontSize(10),m.setFont("helvetica","normal"),m.setTextColor(0,0,0);const ue=_+10,ae=v-_-60;m.text("COR Subtotal:",ue,j),m.setFont("helvetica","bold"),m.text(Ue($.cor_subtotal),ae,j,{align:"right"}),j+=8,m.setFont("helvetica","normal"),m.setFontSize(9),m.text(`Liability Insurance (${oa(r.liability_insurance_percent||144)}):`,ue,j),m.text(Ue($.liability_insurance_amount),ae,j,{align:"right"}),j+=6,m.text(`Bond (${oa(r.bond_percent||100)}):`,ue,j),m.text(Ue($.bond_amount),ae,j,{align:"right"}),j+=6,m.text(`City License Fee (${oa(r.license_fee_percent||10)}):`,ue,j),m.text(Ue($.license_fee_amount),ae,j,{align:"right"}),j+=10,m.setFillColor(...C),m.roundedRect(ue-5,j-3,v-_*2-10,16,2,2,"F"),m.setTextColor(255,255,255),m.setFontSize(12),m.setFont("helvetica","bold"),m.text("COR TOTAL:",ue,j+8),m.text(Ue($.cor_total),ae,j+8,{align:"right"}),j+=25,j>A-120&&(m.addPage(),j=_),j+=10,m.setTextColor(0,0,0),m.setFontSize(10),m.setFont("helvetica","bold"),m.text("AUTHORIZATION",_,j),j+=15,m.setFont("helvetica","normal"),m.setFontSize(9),m.setDrawColor(0,0,0);const Y=(b,R,B,me,T,ee,k)=>{m.setFont("helvetica","bold"),m.setFontSize(8),m.text(R,_,b),m.setFont("helvetica","normal"),m.setFontSize(9);const pe=b+20;if(m.line(_,pe,_+70,pe),m.text("Signature",_,pe+8),m.line(_+85,pe,_+145,pe),m.text("Title / Company",_+85,pe+8),m.line(v-_-40,pe,v-_,pe),m.text("Date",v-_-40,pe+8),B)try{if(m.addImage(B,"PNG",_,pe-18,60,18),me&&(m.setFontSize(8),m.text(me,_,pe+15)),T||ee){const D=[T,ee].filter(Boolean).join(" - ");m.text(D,_+85,pe-5)}k&&m.text(Na(k),v-_-40,pe-5)}catch(D){console.error("Error adding signature:",D)}else m.setFont("helvetica","italic"),m.setFontSize(9),m.setTextColor(150,150,150),m.text("Awaiting Signature",_+5,pe-5),m.setTextColor(0,0,0),m.setFont("helvetica","normal");return pe+25};if(j=Y(j,"GC AUTHORIZATION",r.gc_signature_data||r.gc_signature,r.gc_signature_name||r.gc_signer_name,r.gc_signature_title,r.gc_signature_company,r.gc_signature_date||r.signed_at),j+=10,j=Y(j,"CLIENT AUTHORIZATION",r.client_signature_data,r.client_signature_name,r.client_signature_title,r.client_signature_company,r.client_signature_date),d&&d.length>0){const b=d.reduce((z,se)=>z+(se.t_and_m_workers?.reduce((Z,ne)=>Z+(parseFloat(ne.hours)||0),0)||0),0),R=d.reduce((z,se)=>z+(se.t_and_m_workers?.reduce((Z,ne)=>Z+(parseFloat(ne.overtime_hours)||0),0)||0),0),B=d.reduce((z,se)=>z+(se.photos?.length||0),0),me=d.filter(z=>z.client_signature_data).length,T=d.length>0?{start:d.reduce((z,se)=>!z||se.work_date<z?se.work_date:z,null),end:d.reduce((z,se)=>!z||se.work_date>z?se.work_date:z,null)}:null,ee=`FS-${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}-${Math.random().toString(36).substr(2,4).toUpperCase()}`;if(m.addPage(),j=_,X)try{m.addImage(X,"PNG",_,j,50,18)}catch{m.setFontSize(14),m.setFont("helvetica","bold"),m.setTextColor(...C),m.text(c?.name||"Company Name",_,j+10)}else m.setFontSize(14),m.setFont("helvetica","bold"),m.setTextColor(...C),m.text(c?.name||"Company Name",_,j+10);j+=35,m.setDrawColor(...C),m.setLineWidth(.8),m.line(_,j,v-_,j),m.setLineWidth(.3),m.line(_,j+3,v-_,j+3),j+=15,m.setFontSize(22),m.setFont("helvetica","bold"),m.setTextColor(30,41,59),m.text("SUPPORTING DOCUMENTATION",v/2,j,{align:"center"}),j+=8,m.setFontSize(12),m.setFont("helvetica","normal"),m.setTextColor(100,116,139),m.text("Change Order Request Backup",v/2,j,{align:"center"}),j+=8,m.setDrawColor(...C),m.setLineWidth(.3),m.line(_,j,v-_,j),m.setLineWidth(.8),m.line(_,j+3,v-_,j+3),j+=20,m.setFontSize(10),m.setFont("helvetica","bold"),m.setTextColor(30,41,59),m.text("COR Reference:",_,j),m.setFont("helvetica","normal"),m.text(r.cor_number||"N/A",_+35,j),m.setFont("helvetica","bold"),m.text("Project:",v/2,j),m.setFont("helvetica","normal"),m.text(l?.name||"N/A",v/2+20,j),j+=7,m.setFont("helvetica","bold"),m.text("Job #:",_,j),m.setFont("helvetica","normal"),m.text(l?.job_number||"N/A",_+35,j),j+=20,m.setFillColor(248,250,252),m.setDrawColor(203,213,225),m.roundedRect(_,j,v-_*2,65,4,4,"FD"),j+=10,m.setFontSize(11),m.setFont("helvetica","bold"),m.setTextColor(30,41,59),m.text("DOCUMENTATION SUMMARY",_+10,j),m.setDrawColor(203,213,225),m.setLineWidth(.3),m.line(_+10,j+3,_+80,j+3),j+=12,m.setFontSize(9),m.setFont("helvetica","normal"),m.setTextColor(71,85,105);const k=_+15,pe=_+70;m.text("T&M Tickets:",k,j),m.setFont("helvetica","bold"),m.text(String(d.length),pe,j),m.setFont("helvetica","normal"),j+=7,m.text("Total Labor:",k,j),m.setFont("helvetica","bold"),m.text(`${b.toFixed(1)} hrs`,pe,j),m.setFont("helvetica","normal"),j+=7,R>0&&(m.text("Total OT:",k,j),m.setFont("helvetica","bold"),m.text(`${R.toFixed(1)} hrs`,pe,j),m.setFont("helvetica","normal"),j+=7),m.text("Photo Evidence:",k,j),m.setFont("helvetica","bold"),m.text(`${B} photos`,pe,j),m.setFont("helvetica","normal"),j+=7,m.text("Client Verified:",k,j),m.setFont("helvetica","bold"),m.setTextColor(me>0?16:71,me>0?185:85,me>0?129:105),m.text(`${me} of ${d.length} tickets`,pe,j),m.setTextColor(71,85,105),m.setFont("helvetica","normal"),j+=7,T?.start&&T?.end&&(m.text("Date Range:",k,j),m.setFont("helvetica","bold"),m.text(`${Na(T.start)} - ${Na(T.end)}`,pe,j)),j+=30,m.setFontSize(9),m.setFont("helvetica","normal"),m.setTextColor(100,116,139);const D=new Date;m.text(`Generated: ${D.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})} at ${D.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`,_,j),j+=6,m.text(`Document ID: ${ee}`,_,j);for(const z of d){m.addPage(),j=_;const se=!!z.client_signature_data,Z=22,ne=se?[16,185,129]:z.status==="approved"?[16,185,129]:[245,158,11];if(m.setFillColor(...ne),m.rect(_,j,4,Z,"F"),m.setFillColor(248,250,252),m.rect(_+4,j,v-_*2-4,Z,"F"),m.setFontSize(12),m.setFont("helvetica","bold"),m.setTextColor(30,41,59),m.text(`T&M TICKET  ${Na(z.work_date)}`,_+10,j+8),z.ce_pco_number&&(m.setFontSize(9),m.setFont("helvetica","normal"),m.setTextColor(59,130,246),m.text(`CE/PCO: ${z.ce_pco_number}`,_+10,j+16)),se&&(m.setFontSize(8),m.setFont("helvetica","bold"),m.setTextColor(16,185,129),m.text(" CLIENT VERIFIED",v-_-35,j+12)),j+=Z+8,z.notes){m.setFontSize(10),m.setFont("helvetica","bold"),m.setTextColor(71,85,105),m.text("DESCRIPTION",_,j),j+=6,m.setFontSize(9),m.setFont("helvetica","normal"),m.setTextColor(51,65,85);const F=m.splitTextToSize(z.notes,v-_*2);m.text(F,_,j),j+=F.length*4+10}if(z.t_and_m_workers?.length>0&&(m.setFontSize(10),m.setFont("helvetica","bold"),m.setTextColor(71,85,105),m.text("LABOR",_,j),j+=6,vs(m,{startY:j,head:[["Worker","Time Period","Class","Reg Hrs","OT Hrs"]],body:z.t_and_m_workers.map(F=>[F.name,Af(F),F.role||F.labor_class||"Laborer",F.hours?.toString()||"0",F.overtime_hours?.toString()||"-"]),margin:{left:_,right:_},headStyles:{fillColor:C,textColor:[255,255,255],fontSize:8,cellPadding:3,fontStyle:"bold"},bodyStyles:{fontSize:8,cellPadding:3},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),j=m.lastAutoTable.finalY+10),z.t_and_m_items?.length>0&&(j>A-60&&(m.addPage(),j=_),m.setFontSize(10),m.setFont("helvetica","bold"),m.setTextColor(71,85,105),m.text("MATERIALS / EQUIPMENT",_,j),m.setFontSize(7),m.setFont("helvetica","normal"),m.setTextColor(100,116,139),m.text("Source: T&M Ticket",_+55,j),j+=6,vs(m,{startY:j,head:[["Item","Qty","Unit","Unit Cost","Total"]],body:z.t_and_m_items.map(F=>[F.materials_equipment?.name||F.description||"Item",F.quantity?.toString()||"1",F.materials_equipment?.unit||"ea",F.materials_equipment?.cost_per_unit?`$${F.materials_equipment.cost_per_unit}`:"-",F.materials_equipment?.cost_per_unit&&F.quantity?`$${(F.quantity*F.materials_equipment.cost_per_unit).toFixed(2)}`:"-"]),margin:{left:_,right:_},headStyles:{fillColor:C,textColor:[255,255,255],fontSize:8,cellPadding:3,fontStyle:"bold"},bodyStyles:{fontSize:8,cellPadding:3},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),j=m.lastAutoTable.finalY+10),z.photos?.length>0){j>A-80&&(m.addPage(),j=_),m.setFontSize(10),m.setFont("helvetica","bold"),m.setTextColor(71,85,105),m.text("PHOTO DOCUMENTATION",_,j),m.setFontSize(8),m.setFont("helvetica","normal"),m.setTextColor(59,130,246),m.text(`${z.photos.length} photo${z.photos.length!==1?"s":""}`,_+50,j),j+=8;let F=_;const fe=55,de=45,ye=6,Fe=3,ze=1;for(let Me=0;Me<z.photos.length;Me++){Me>0&&Me%Fe===0&&(F=_,j+=de+ye+4),j+de>A-20&&(m.addPage(),j=_,F=_);try{const nt=await Nl(z.photos[Me]);nt?(m.setDrawColor(200,200,200),m.setLineWidth(ze),m.rect(F-ze,j-ze,fe+ze*2,de+ze*2,"S"),m.setFillColor(230,230,230),m.rect(F+2,j+2,fe,de,"F"),m.addImage(nt,"JPEG",F,j,fe,de)):(m.setFillColor(245,245,245),m.rect(F,j,fe,de,"F"),m.setDrawColor(200,200,200),m.rect(F,j,fe,de,"S"),m.setFontSize(7),m.setTextColor(150,150,150),m.text("Photo unavailable",F+8,j+de/2))}catch{m.setFillColor(245,245,245),m.rect(F,j,fe,de,"F"),m.setDrawColor(200,200,200),m.rect(F,j,fe,de,"S"),m.setFontSize(7),m.setTextColor(150,150,150),m.text("Photo unavailable",F+8,j+de/2)}F+=fe+ye}j+=de+12}if(z.client_signature_data){j>A-50&&(m.addPage(),j=_);const F=32,fe=v-_*2;m.setFillColor(240,253,244),m.roundedRect(_,j,fe,F,3,3,"F"),m.setFillColor(16,185,129),m.rect(_,j,4,F,"F"),m.setDrawColor(187,247,208),m.setLineWidth(.5),m.line(_+4,j,_+fe,j);const de=_+14,ye=j+F/2;m.setFillColor(16,185,129),m.circle(de,ye,6,"F"),m.setFontSize(9),m.setTextColor(255,255,255),m.text("",de-2.5,ye+3),m.setFontSize(9),m.setFont("helvetica","bold"),m.setTextColor(16,185,129),m.text("CLIENT VERIFIED",_+26,j+10);try{m.addImage(z.client_signature_data,"PNG",_+26,j+13,50,16);const Me=z.client_signature_name||"Client",nt=z.client_signature_title||"",qe=z.client_signature_company||"",J=z.client_signature_date?Na(z.client_signature_date):"",Oe=_+85;m.setFont("helvetica","bold"),m.setFontSize(9),m.setTextColor(30,41,59),m.text(Me,Oe,j+12),m.setFont("helvetica","normal"),m.setFontSize(8),m.setTextColor(71,85,105),(nt||qe)&&m.text(`${nt}${nt&&qe?", ":""}${qe}`,Oe,j+18),J&&(m.setTextColor(100,116,139),m.text(`Verified: ${J}`,Oe,j+24))}catch{const ze=z.client_signature_name||"Client";m.setFont("helvetica","normal"),m.setFontSize(9),m.setTextColor(30,41,59),m.text(`Signed by: ${ze}`,_+26,j+20)}j+=F+8}j+=5,m.setDrawColor(200,200,200),m.setLineWidth(.2),m.line(_,j,v-_,j),j+=10}}const P=m.internal.getNumberOfPages();for(let b=1;b<=P;b++){m.setPage(b);const R=A-10;m.setFontSize(8),m.setTextColor(150,150,150),m.text(`Generated on ${new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,_,R),m.text(`Page ${b} of ${P}`,v-_,R,{align:"right"})}const ce=`${r.cor_number||"COR"}_${l?.job_number||"export"}${d?.length?"_with_backup":""}.pdf`;m.save(ce);const M={success:!0,fileName:ce,exportedAt:new Date().toISOString(),photoManifest:y};return p&&(M.snapshot=tb(r,d,y,$)),M}async function sb(r,l,c,i={}){const d=new Sl("p","mm","letter"),h=d.internal.pageSize.getWidth(),g=d.internal.pageSize.getHeight(),p=20;let y=p;const m=i.primaryColor?zf(i.primaryColor):[30,58,95];if(i.logoUrl)try{const C=await Nl(i.logoUrl);C&&d.addImage(C,"PNG",p,y,40,15)}catch{c?.name&&(d.setFontSize(14),d.setFont("helvetica","bold"),d.setTextColor(...m),d.text(c.name,p,y+8))}else c?.name&&(d.setFontSize(14),d.setFont("helvetica","bold"),d.setTextColor(...m),d.text(c.name,p,y+8));if(d.setFontSize(16),d.setFont("helvetica","bold"),d.setTextColor(30,41,59),d.text("T&M TICKET",h-p,y+8,{align:"right"}),y+=25,d.setDrawColor(...m),d.setLineWidth(.5),d.line(p,y,h-p,y),y+=10,!!r.client_signature_data&&(d.setFillColor(240,253,244),d.roundedRect(h-p-45,y-5,45,12,2,2,"F"),d.setFontSize(9),d.setFont("helvetica","bold"),d.setTextColor(16,185,129),d.text(" CLIENT VERIFIED",h-p-42,y+3)),d.setFontSize(10),d.setFont("helvetica","bold"),d.setTextColor(71,85,105),d.text("Project:",p,y),d.setFont("helvetica","normal"),d.setTextColor(30,41,59),d.text(l?.name||"N/A",p+20,y),y+=6,l?.job_number&&(d.setFont("helvetica","bold"),d.setTextColor(71,85,105),d.text("Job #:",p,y),d.setFont("helvetica","normal"),d.setTextColor(30,41,59),d.text(l.job_number,p+20,y),y+=6),d.setFont("helvetica","bold"),d.setTextColor(71,85,105),d.text("Work Date:",p,y),d.setFont("helvetica","normal"),d.setTextColor(30,41,59),d.text(Na(r.work_date||r.ticket_date),p+26,y),r.ce_pco_number&&(d.setFont("helvetica","bold"),d.setTextColor(71,85,105),d.text("CE/PCO:",p+70,y),d.setFont("helvetica","normal"),d.setTextColor(59,130,246),d.text(r.ce_pco_number,p+88,y)),y+=12,r.notes){d.setFontSize(10),d.setFont("helvetica","bold"),d.setTextColor(71,85,105),d.text("DESCRIPTION",p,y),y+=6,d.setFontSize(9),d.setFont("helvetica","normal"),d.setTextColor(51,65,85);const C=d.splitTextToSize(r.notes,h-p*2);d.text(C,p,y),y+=C.length*4+10}r.t_and_m_workers?.length>0&&(d.setFontSize(10),d.setFont("helvetica","bold"),d.setTextColor(71,85,105),d.text("LABOR",p,y),y+=6,vs(d,{startY:y,head:[["Worker","Time Period","Class","Reg Hrs","OT Hrs"]],body:r.t_and_m_workers.map(C=>[C.name,Af(C),C.role||C.labor_class||"Laborer",C.hours?.toString()||"0",C.overtime_hours?.toString()||"-"]),margin:{left:p,right:p},headStyles:{fillColor:m,textColor:[255,255,255],fontSize:8,cellPadding:3,fontStyle:"bold"},bodyStyles:{fontSize:8,cellPadding:3},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),y=d.lastAutoTable.finalY+10);const A=r.t_and_m_items||r.materials_equipment?.filter(C=>C.type==="material")||[];if(A.length>0&&(y>g-60&&(d.addPage(),y=p),d.setFontSize(10),d.setFont("helvetica","bold"),d.setTextColor(71,85,105),d.text("MATERIALS / EQUIPMENT",p,y),y+=6,vs(d,{startY:y,head:[["Item","Qty","Unit"]],body:A.map(C=>[C.materials_equipment?.name||C.description||C.name||"Item",C.quantity?.toString()||"1",C.materials_equipment?.unit||C.unit||"ea"]),margin:{left:p,right:p},headStyles:{fillColor:m,textColor:[255,255,255],fontSize:8,cellPadding:3,fontStyle:"bold"},bodyStyles:{fontSize:8,cellPadding:3},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),y=d.lastAutoTable.finalY+10),r.photos?.length>0){y>g-80&&(d.addPage(),y=p),d.setFontSize(10),d.setFont("helvetica","bold"),d.setTextColor(71,85,105),d.text("PHOTO DOCUMENTATION",p,y),d.setFontSize(8),d.setFont("helvetica","normal"),d.setTextColor(59,130,246),d.text(`${r.photos.length} photo${r.photos.length!==1?"s":""}`,p+50,y),y+=8;let C=p;const U=55,X=45,V=6,q=3;for(let E=0;E<r.photos.length;E++){E>0&&E%q===0&&(C=p,y+=X+V+4),y+X>g-20&&(d.addPage(),y=p,C=p);try{const W=await Nl(r.photos[E]);W?(d.setDrawColor(200,200,200),d.setLineWidth(1),d.rect(C-1,y-1,U+2,X+2,"S"),d.setFillColor(230,230,230),d.rect(C+2,y+2,U,X,"F"),d.addImage(W,"JPEG",C,y,U,X)):(d.setFillColor(245,245,245),d.rect(C,y,U,X,"F"),d.setDrawColor(200,200,200),d.rect(C,y,U,X,"S"),d.setFontSize(7),d.setTextColor(150,150,150),d.text("Photo unavailable",C+8,y+X/2))}catch{d.setFillColor(245,245,245),d.rect(C,y,U,X,"F"),d.setDrawColor(200,200,200),d.rect(C,y,U,X,"S"),d.setFontSize(7),d.setTextColor(150,150,150),d.text("Photo unavailable",C+8,y+X/2)}C+=U+V}y+=X+12}if(r.client_signature_data){y>g-50&&(d.addPage(),y=p);const C=32,U=h-p*2;d.setFillColor(240,253,244),d.roundedRect(p,y,U,C,3,3,"F"),d.setFillColor(16,185,129),d.rect(p,y,4,C,"F"),d.setDrawColor(187,247,208),d.setLineWidth(.5),d.line(p+4,y,p+U,y);const X=p+14,V=y+C/2;d.setFillColor(16,185,129),d.circle(X,V,6,"F"),d.setFontSize(9),d.setTextColor(255,255,255),d.text("",X-2.5,V+3),d.setFontSize(9),d.setFont("helvetica","bold"),d.setTextColor(16,185,129),d.text("CLIENT VERIFIED",p+26,y+10);try{d.addImage(r.client_signature_data,"PNG",p+26,y+13,50,16);const W=r.client_signature_name||"Client",ue=r.client_signature_title||"",ae=r.client_signature_company||"",Y=r.client_signature_date?Na(r.client_signature_date):"",P=p+85;d.setFont("helvetica","bold"),d.setFontSize(9),d.setTextColor(30,41,59),d.text(W,P,y+12),d.setFont("helvetica","normal"),d.setFontSize(8),d.setTextColor(71,85,105),(ue||ae)&&d.text(`${ue}${ue&&ae?", ":""}${ae}`,P,y+18),Y&&(d.setTextColor(100,116,139),d.text(`Verified: ${Y}`,P,y+24))}catch{const E=r.client_signature_name||"Client";d.setFont("helvetica","normal"),d.setFontSize(9),d.setTextColor(30,41,59),d.text(`Signed by: ${E}`,p+26,y+20)}y+=C+8}const _=d.internal.getNumberOfPages();for(let C=1;C<=_;C++){d.setPage(C);const U=g-10;d.setFontSize(8),d.setTextColor(150,150,150),d.text(`Generated on ${new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,p,U),d.text(`Page ${C} of ${_}`,h-p,U,{align:"right"})}const $=`TM_Ticket_${Na(r.work_date||r.ticket_date).replace(/\//g,"-")}${r.ce_pco_number?"_"+r.ce_pco_number:""}.pdf`;return d.save($),{success:!0,fileName:$}}function sf({onSave:r,onClose:l,slot:c=1,documentType:i="cor",documentTitle:d="",signerName:h="",signerTitle:g="",signerCompany:p=""}){const y=x.useRef(null),[m,v]=x.useState(h),[A,_]=x.useState(g),[j,$]=x.useState(p),[C,U]=x.useState(!1),[X,V]=x.useState(!1),[q,E]=x.useState(!1),W=c===1?"GC Authorization":"Client Authorization",ue=i==="cor"?"Change Order Request":"T&M Work Order",ae=()=>{const T=y.current;return T?T.getContext("2d"):null},Y=T=>{const ee=y.current;if(!ee)return{x:0,y:0};const k=ee.getBoundingClientRect(),pe=ee.width/k.width,D=ee.height/k.height,z=T.touches?T.touches[0].clientX:T.clientX,se=T.touches?T.touches[0].clientY:T.clientY;return{x:(z-k.left)*pe,y:(se-k.top)*D}},P=T=>{T.preventDefault();const ee=ae();if(!ee)return;const{x:k,y:pe}=Y(T);ee.beginPath(),ee.moveTo(k,pe),V(!0),U(!0)},ce=T=>{if(!X)return;T.preventDefault();const ee=ae();if(!ee)return;const{x:k,y:pe}=Y(T);ee.lineTo(k,pe),ee.stroke()},M=()=>{V(!1)},b=()=>{const T=y.current,ee=ae();!T||!ee||(ee.clearRect(0,0,T.width,T.height),U(!1))},R=T=>{if(!T)return;y.current=T;const ee=T.getContext("2d");ee.strokeStyle="#1e293b",ee.lineWidth=2,ee.lineCap="round",ee.lineJoin="round"},B=C&&m.trim()&&q,me=()=>{if(!B)return;const T=y.current;if(!T)return;const ee=T.toDataURL("image/png");r({signature:ee,signerName:m.trim(),signerTitle:A.trim()||null,signerCompany:j.trim()||null,signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:l,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal enhanced",onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"signature-header-info",children:[e.jsx("h2",{id:"signature-title",children:W}),d&&e.jsx("span",{className:"signature-doc-ref",children:d})]}),e.jsx("button",{className:"close-btn",onClick:l,"aria-label":"Close signature modal",children:e.jsx(Ra,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"signature-slot-badge",children:[e.jsx(Zi,{size:14}),e.jsxs("span",{children:["Signature ",c," of 2"]})]}),e.jsxs("div",{className:"signature-fields",children:[e.jsxs("div",{className:"form-group required",children:[e.jsx("label",{htmlFor:"signer-name",children:"Print Name"}),e.jsx("input",{id:"signer-name",type:"text",value:m,onChange:T=>v(T.target.value),placeholder:"Enter your full legal name","aria-required":"true",className:"input-required"})]}),e.jsxs("div",{className:"signature-fields-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-title",children:"Title"}),e.jsx("input",{id:"signer-title",type:"text",value:A,onChange:T=>_(T.target.value),placeholder:"e.g., Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-company",children:"Company"}),e.jsx("input",{id:"signer-company",type:"text",value:j,onChange:T=>$(T.target.value),placeholder:"e.g., ABC Construction"})]})]})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(Hd,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Draw your signature below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:R,width:500,height:180,className:"signature-canvas",onMouseDown:P,onMouseMove:ce,onMouseUp:M,onMouseLeave:M,onTouchStart:P,onTouchMove:ce,onTouchEnd:M,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!C&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:b,disabled:!C,"aria-label":"Clear signature",children:[e.jsx(_l,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("div",{className:"signature-acknowledgment",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:q,onChange:T=>E(T.target.checked)}),e.jsxs("span",{children:["I acknowledge that this electronic signature is legally binding and that I have reviewed and approve this ",ue,". I understand that my signature, name, and IP address will be recorded for verification purposes."]})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:l,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:me,disabled:!B,"aria-label":"Submit signature",children:[e.jsx(Aa,{size:16,"aria-hidden":"true"})," Submit Signature"]})]})]})})}const Bn=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",Vi=r=>{if(!r)return"";const[l,c]=r.split(":"),i=parseInt(l),d=i>=12?"pm":"am";return`${i%12||12}:${c}${d}`},nb=({status:r})=>{const l={draft:{label:"Draft",color:"#6b7280",bg:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bg:"#fef3c7"},approved:{label:"Approved",color:"#059669",bg:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bg:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bg:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bg:"#e5e7eb"}},c=l[r]||l.draft;return e.jsx("span",{className:"cor-status-badge",style:{color:c.color,backgroundColor:c.bg},children:c.label})};function rb({signatureToken:r}){const[l,c]=x.useState(!0),[i,d]=x.useState(null),[h,g]=x.useState(null),[p,y]=x.useState(null),[m,v]=x.useState(!1),[A,_]=x.useState(null),[j,$]=x.useState(!1),[C,U]=x.useState(null),[X,V]=x.useState(!1),[q,E]=x.useState([]),[W,ue]=x.useState(!1),[ae,Y]=x.useState(new Set);x.useEffect(()=>{P()},[r]);const P=async()=>{try{c(!0),d(null);const ne=await K.getSignatureRequestByToken(r);if(!ne){d("This signature link is invalid or has expired.");return}if(ne.status==="completed"){d("This document has already been fully signed.");return}if(ne.status==="revoked"){d("This signature link has been revoked.");return}if(ne.status==="expired"){d("This signature link has expired.");return}g(ne);const F=await K.getDocumentForSigning(ne.document_type,ne.document_id);if(!F){d("The document associated with this link could not be found.");return}if(y(F),ne.document_type==="cor"&&F?.id)try{const fe=await K.getCORTickets(F.id);E(fe||[])}catch(fe){console.warn("Failed to load backup tickets:",fe)}}catch(ne){console.error("Error loading signature data:",ne),d("Unable to load signature request. Please try again.")}finally{c(!1)}},ce=x.useMemo(()=>!p||h?.document_type!=="cor"?null:Ji(p),[p,h]),M=()=>{if(!h)return{slot1:null,slot2:null,availableSlots:[]};const ne=h.signatures||[],F=ne.find(ye=>ye.signature_slot===1),fe=ne.find(ye=>ye.signature_slot===2),de=[];return F||de.push(1),fe||de.push(2),{slot1:F,slot2:fe,availableSlots:de}},b=async()=>{try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip}catch{return null}},R=async ne=>{if(!(!h||!A))try{$(!0);const F=await b(),fe=await K.addSignature(h.id,A,{...ne,ipAddress:F,userAgent:navigator.userAgent});await K.syncSignatureToDocument(fe,h),await P(),v(!1),_(null),U("signed")}catch(F){console.error("Error submitting signature:",F),d("Failed to submit signature. Please try again.")}finally{$(!1)}},B=ne=>{_(ne),v(!0)},me=async()=>{if(!(!p||!h))try{V(!0);let ne=null;if(z)try{ne=await K.getCORTickets(p.id)}catch(fe){console.warn("Failed to fetch T&M tickets for backup:",fe)}const F={logoUrl:se?.logo_url,primaryColor:se?.branding_color};await ab(p,Z,se,F,ne),U("PDF downloaded successfully!"),setTimeout(()=>U(null),3e3)}catch(ne){console.error("Download failed:",ne),d("Failed to generate PDF. Please try again.")}finally{V(!1)}},T=async()=>{if(!(!p||!h))try{V(!0);const ne=p?.projects?.companies,F=p?.projects,fe={logoUrl:ne?.logo_url,primaryColor:ne?.branding_color};await sb(p,F,ne,fe),U("PDF downloaded successfully!"),setTimeout(()=>U(null),3e3)}catch(ne){console.error("Download failed:",ne),d("Failed to generate PDF. Please try again.")}finally{V(!1)}};if(l)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading document..."})]})});if(i)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-error",children:[e.jsx(vn,{size:48}),e.jsx("h2",{children:"Unable to Load Document"}),e.jsx("p",{children:i})]})});const{slot1:ee,slot2:k,availableSlots:pe}=M(),D=ee||k,z=h?.document_type==="cor",se=p?.projects?.companies,Z=p?.projects;if(!z){const ne=p.t_and_m_workers?.length||0,F=p.t_and_m_workers?.reduce((fe,de)=>fe+(de.hours||0),0)||0;return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[se?.logo_url?e.jsx("img",{src:se.logo_url,alt:se.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(Qi,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:se?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"T&M Ticket Signature"})]})]}),C==="signed"&&e.jsx("div",{className:"signature-signed-overlay",children:e.jsxs("div",{className:"signature-signed-content",children:[e.jsx(Ta,{size:48}),e.jsx("h2",{children:"Document Signed Successfully"}),e.jsx("p",{children:"This document has been signed and submitted."}),e.jsx("button",{className:"btn btn-primary download-copy-btn",onClick:T,disabled:X,children:X?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"btn-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ii,{size:18}),"Save a Copy for Your Records"]})}),e.jsx("p",{className:"close-prompt",children:"You may close this page when done."})]})}),e.jsxs("main",{className:"signature-page-content",children:[e.jsxs("div",{className:"signature-document-card",children:[e.jsxs("div",{className:"document-card-header",children:[e.jsx(Oa,{size:20}),e.jsxs("div",{className:"document-card-title",children:[e.jsx("h2",{children:"T&M Ticket"}),e.jsx("span",{className:"document-subtitle",children:p.ce_pco_number?`CE/PCO: ${p.ce_pco_number}`:"Time & Materials"})]})]}),e.jsxs("div",{className:"document-card-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Project"}),e.jsx("span",{className:"detail-value",children:Z?.name})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Work Date"}),e.jsx("span",{className:"detail-value",children:Bn(p.work_date)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Workers"}),e.jsxs("span",{className:"detail-value",children:[ne," (",F," hrs)"]})]}),p.notes&&e.jsxs("div",{className:"detail-row full-width",children:[e.jsx("span",{className:"detail-label",children:"Description"}),e.jsx("span",{className:"detail-value",children:p.notes})]})]}),p.t_and_m_workers?.length>0&&e.jsxs("div",{className:"signature-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Da,{size:16})," Workers"]}),e.jsxs("table",{className:"signature-detail-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Time"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"OT"})]})}),e.jsx("tbody",{children:p.t_and_m_workers.map((fe,de)=>e.jsxs("tr",{children:[e.jsx("td",{children:fe.name}),e.jsx("td",{children:fe.role||"Laborer"}),e.jsx("td",{children:fe.time_started&&fe.time_ended?`${Vi(fe.time_started)} - ${Vi(fe.time_ended)}`:"-"}),e.jsx("td",{children:fe.hours||0}),e.jsx("td",{children:fe.overtime_hours||"-"})]},de))})]})]}),p.t_and_m_items?.length>0&&e.jsxs("div",{className:"signature-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Hs,{size:16})," Materials & Equipment"]}),e.jsxs("table",{className:"signature-detail-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"})]})}),e.jsx("tbody",{children:p.t_and_m_items.map((fe,de)=>e.jsxs("tr",{children:[e.jsx("td",{children:fe.custom_name||fe.materials_equipment?.name||"Item"}),e.jsx("td",{children:fe.quantity}),e.jsx("td",{children:fe.materials_equipment?.unit||"each"})]},de))})]})]}),p.photos?.length>0&&e.jsxs("div",{className:"signature-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Pn,{size:16})," Photos (",p.photos.length,")"]}),e.jsx("div",{className:"signature-photo-grid",children:p.photos.map((fe,de)=>e.jsx("div",{className:"signature-photo-thumb",children:e.jsx("img",{src:typeof fe=="string"?fe:fe.url,alt:`Photo ${de+1}`,onError:ye=>{ye.target.style.display="none"}})},de))})]})]}),e.jsxs("div",{className:"signature-status-section",children:[e.jsx("h3",{children:"Signature"}),D?e.jsxs(e.Fragment,{children:[ee&&Gi(1,ee,"GC Authorization",B,j),k&&Gi(2,k,"Client Authorization",B,j)]}):e.jsxs(e.Fragment,{children:[Gi(1,ee,"GC Authorization",B,j),!ee&&e.jsx("p",{className:"or-divider",children:" or "}),Gi(2,k,"Client Authorization",B,j)]}),D&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(Ta,{size:24}),e.jsx("p",{children:"This document has been signed."})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),m&&A&&e.jsx(sf,{slot:A,documentType:"tm_ticket",documentTitle:"T&M Ticket",onSave:R,onClose:()=>{v(!1),_(null)}})]})}return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[se?.logo_url?e.jsx("img",{src:se.logo_url,alt:se.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(Qi,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:se?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"Change Order Request"})]})]}),C==="signed"&&e.jsx("div",{className:"signature-signed-overlay",children:e.jsxs("div",{className:"signature-signed-content",children:[e.jsx(Ta,{size:48}),e.jsx("h2",{children:"Document Signed Successfully"}),e.jsx("p",{children:"This document has been signed and submitted."}),e.jsx("button",{className:"btn btn-primary download-copy-btn",onClick:me,disabled:X,children:X?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"btn-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ii,{size:18}),"Save a Copy for Your Records"]})}),e.jsx("p",{className:"close-prompt",children:"You may close this page when done."})]})}),e.jsxs("main",{className:"signature-page-content cor-full-document",children:[e.jsxs("div",{className:"cor-header-card",children:[e.jsxs("div",{className:"cor-header-top",children:[e.jsxs("div",{className:"cor-title-section",children:[e.jsx("h2",{className:"cor-number",children:p.cor_number}),e.jsx(nb,{status:p.status})]}),e.jsxs("div",{className:"cor-date",children:["Created ",Bn(p.created_at)]})]}),e.jsx("h3",{className:"cor-title",children:p.title||"Untitled Change Order"}),e.jsxs("div",{className:"cor-info-grid",children:[e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Project"}),e.jsx("span",{className:"cor-info-value",children:Z?.name})]}),Z?.job_number&&e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Job #"}),e.jsx("span",{className:"cor-info-value",children:Z.job_number})]}),e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Period"}),e.jsx("span",{className:"cor-info-value",children:Wi(p.period_start,p.period_end)})]})]}),p.scope_of_work&&e.jsxs("div",{className:"cor-scope",children:[e.jsx("h4",{children:"Scope of Work"}),e.jsx("p",{children:p.scope_of_work})]})]}),p.change_order_labor?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx($s,{size:18}),e.jsx("h4",{children:"Labor"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{className:"text-right",children:"Reg Hrs"}),e.jsx("th",{className:"text-right",children:"Reg Rate"}),e.jsx("th",{className:"text-right",children:"OT Hrs"}),e.jsx("th",{className:"text-right",children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:p.change_order_labor.map((ne,F)=>e.jsxs("tr",{children:[e.jsx("td",{children:ne.labor_class}),e.jsx("td",{children:ne.wage_type}),e.jsx("td",{className:"text-right",children:ne.regular_hours}),e.jsxs("td",{className:"text-right",children:["$",os(ne.regular_rate),"/hr"]}),e.jsx("td",{className:"text-right",children:ne.overtime_hours||"-"}),e.jsx("td",{className:"text-right",children:ne.overtime_hours?`$${os(ne.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:Ue(ne.total)})]},F))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ue(ce.labor_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"5",className:"text-right",children:["+ ",oa(p.labor_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ue(ce.labor_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"5",className:"text-right",children:e.jsx("strong",{children:"Labor Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Ue(ce.labor_subtotal+ce.labor_markup_amount)})})]})]})]})})]}),p.change_order_materials?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Hs,{size:18}),e.jsx("h4",{children:"Materials"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:p.change_order_materials.map((ne,F)=>e.jsxs("tr",{children:[e.jsx("td",{children:ne.description}),e.jsx("td",{children:ne.source_reference||ne.source_type}),e.jsx("td",{className:"text-right",children:ne.quantity}),e.jsx("td",{children:ne.unit}),e.jsxs("td",{className:"text-right",children:["$",os(ne.unit_cost)]}),e.jsx("td",{className:"text-right",children:Ue(ne.total)})]},F))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ue(ce.materials_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",oa(p.materials_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ue(ce.materials_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Materials Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Ue(ce.materials_subtotal+ce.materials_markup_amount)})})]})]})]})})]}),p.change_order_equipment?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(ds,{size:18}),e.jsx("h4",{children:"Equipment"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:p.change_order_equipment.map((ne,F)=>e.jsxs("tr",{children:[e.jsx("td",{children:ne.description}),e.jsx("td",{children:ne.source_reference||ne.source_type}),e.jsx("td",{className:"text-right",children:ne.quantity}),e.jsx("td",{children:ne.unit}),e.jsxs("td",{className:"text-right",children:["$",os(ne.unit_cost)]}),e.jsx("td",{className:"text-right",children:Ue(ne.total)})]},F))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ue(ce.equipment_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",oa(p.equipment_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ue(ce.equipment_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Equipment Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Ue(ce.equipment_subtotal+ce.equipment_markup_amount)})})]})]})]})})]}),p.change_order_subcontractors?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Cl,{size:18}),e.jsx("h4",{children:"Subcontractors"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:p.change_order_subcontractors.map((ne,F)=>e.jsxs("tr",{children:[e.jsx("td",{children:ne.company_name}),e.jsx("td",{children:ne.description}),e.jsx("td",{children:ne.source_reference||ne.source_type}),e.jsx("td",{className:"text-right",children:Ue(ne.total)})]},F))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ue(ce.subcontractors_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"2",className:"text-right",children:["+ ",oa(p.subcontractors_markup_percent||500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:Ue(ce.subcontractors_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"2",className:"text-right",children:e.jsx("strong",{children:"Subcontractors Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:Ue(ce.subcontractors_subtotal+ce.subcontractors_markup_amount)})})]})]})]})})]}),q.length>0&&(()=>{const ne=q.reduce((ye,Fe)=>ye+(Fe.t_and_m_workers?.reduce((ze,Me)=>ze+(parseFloat(Me.hours)||0),0)||0),0),F=q.reduce((ye,Fe)=>ye+(Fe.t_and_m_workers?.reduce((ze,Me)=>ze+(parseFloat(Me.overtime_hours)||0),0)||0),0),fe=q.reduce((ye,Fe)=>ye+(Fe.photos?.length||0),0),de=q.filter(ye=>ye.client_signature_data).length;return e.jsxs("div",{className:"cor-section cor-backup-section",children:[e.jsxs("div",{className:"backup-official-header",children:[e.jsxs("div",{className:"backup-official-badge",children:[e.jsx(Oa,{size:16}),e.jsx("span",{children:"Supporting Documentation"})]}),e.jsxs("div",{className:"backup-summary-bar",children:[e.jsxs("div",{className:"backup-stat",children:[e.jsx("span",{className:"backup-stat-value",children:q.length}),e.jsx("span",{className:"backup-stat-label",children:"Tickets"})]}),e.jsxs("div",{className:"backup-stat",children:[e.jsx("span",{className:"backup-stat-value",children:ne.toFixed(1)}),e.jsx("span",{className:"backup-stat-label",children:"Labor Hrs"})]}),F>0&&e.jsxs("div",{className:"backup-stat",children:[e.jsx("span",{className:"backup-stat-value",children:F.toFixed(1)}),e.jsx("span",{className:"backup-stat-label",children:"OT Hrs"})]}),e.jsxs("div",{className:"backup-stat",children:[e.jsx("span",{className:"backup-stat-value",children:fe}),e.jsx("span",{className:"backup-stat-label",children:"Photos"})]}),de>0&&e.jsxs("div",{className:"backup-stat verified",children:[e.jsx("span",{className:"backup-stat-value",children:de}),e.jsx("span",{className:"backup-stat-label",children:"Verified"})]})]})]}),e.jsxs("div",{className:"cor-section-header cor-backup-header",onClick:()=>ue(!W),style:{cursor:"pointer",marginBottom:W?"1rem":0},children:[e.jsx("div",{className:"backup-header-left",children:e.jsx("span",{children:"View All T&M Tickets"})}),e.jsx("div",{className:"backup-header-toggle",children:W?e.jsx(Ma,{size:20}):e.jsx(Bs,{size:20})})]}),W&&e.jsx("div",{className:"backup-tickets-list",style:{padding:"0 0.5rem"},children:q.map(ye=>{const Fe=ae.has(ye.id),ze=ye.t_and_m_workers?.reduce((qe,J)=>qe+(parseFloat(J.hours)||0),0)||0,Me=ye.t_and_m_workers?.reduce((qe,J)=>qe+(parseFloat(J.overtime_hours)||0),0)||0,nt=!!ye.client_signature_data;return e.jsxs("div",{className:"backup-ticket-pro","data-verified":nt,"data-status":ye.status||"pending",children:[e.jsxs("div",{className:"ticket-pro-header",onClick:()=>{const qe=new Set(ae);Fe?qe.delete(ye.id):qe.add(ye.id),Y(qe)},style:{cursor:"pointer"},children:[e.jsxs("div",{className:"ticket-date-badge",children:[e.jsx(Gn,{size:14}),e.jsx("span",{children:Bn(ye.work_date)})]}),ye.ce_pco_number&&e.jsx("span",{className:"ticket-pco-badge",children:ye.ce_pco_number}),nt&&e.jsxs("span",{className:"ticket-verified-seal",children:[e.jsx(Ta,{size:12})," Verified"]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-muted)"},children:[ye.t_and_m_workers?.length||0," workers  ",ze+Me," hrs"]}),Fe?e.jsx(Ma,{size:16}):e.jsx(Bs,{size:16})]})]}),Fe&&e.jsxs("div",{className:"ticket-pro-body",children:[ye.notes&&e.jsx("div",{className:"ticket-description-box",children:e.jsx("p",{children:ye.notes})}),ye.t_and_m_workers?.length>0&&e.jsxs("div",{className:"ticket-section-pro",children:[e.jsxs("div",{className:"ticket-section-header",children:[e.jsx(Da,{size:14}),e.jsx("span",{children:"Labor"}),e.jsxs("span",{className:"section-count",children:[ze+Me," hrs total"]})]}),e.jsx("div",{className:"worker-pro-grid",children:ye.t_and_m_workers.map((qe,J)=>e.jsxs("div",{className:"worker-pro-row",children:[e.jsxs("div",{children:[e.jsx("span",{className:"worker-name",children:qe.name}),qe.role&&e.jsxs("span",{className:"worker-role",children:["  ",qe.role]})]}),e.jsx("span",{className:"worker-time",children:qe.time_started&&qe.time_ended?`${Vi(qe.time_started)} - ${Vi(qe.time_ended)}`:"-"}),e.jsxs("span",{className:"worker-hours",children:[qe.hours||0," hrs"]}),e.jsx("span",{className:"worker-ot",children:parseFloat(qe.overtime_hours)>0?`+${qe.overtime_hours} OT`:"-"})]},J))})]}),ye.t_and_m_items?.length>0&&e.jsxs("div",{className:"ticket-section-pro",children:[e.jsxs("div",{className:"ticket-section-header",children:[e.jsx(Hs,{size:14}),e.jsx("span",{children:"Materials / Equipment"}),e.jsxs("span",{className:"section-count",children:[ye.t_and_m_items.length," items"]})]}),e.jsx("div",{className:"materials-pro-list",children:ye.t_and_m_items.map((qe,J)=>e.jsxs("div",{className:"material-pro-row",children:[e.jsx("span",{className:"material-name",children:qe.materials_equipment?.name||qe.description||"Item"}),e.jsxs("span",{className:"material-qty",children:[qe.quantity||1," ",qe.materials_equipment?.unit||"ea"]}),e.jsx("span",{className:"material-source",children:"T&M Ticket"})]},J))})]}),ye.photos?.length>0&&e.jsxs("div",{className:"ticket-section-pro",children:[e.jsxs("div",{className:"ticket-section-header",children:[e.jsx(Pn,{size:14}),e.jsx("span",{children:"Photo Evidence"}),e.jsx("span",{className:"section-count",children:ye.photos.length})]}),e.jsx("div",{className:"photo-evidence-grid",children:ye.photos.map((qe,J)=>e.jsx("a",{href:qe,target:"_blank",rel:"noopener noreferrer",className:"photo-evidence-item",children:e.jsx("img",{src:qe,alt:`Evidence ${J+1}`,onError:Oe=>{Oe.target.onerror=null,Oe.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiI+PHJlY3QgeD0iMyIgeT0iMyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiByeD0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg=="}})},J))})]}),nt&&e.jsxs("div",{className:"ticket-verification-footer",children:[e.jsx("div",{className:"verification-seal-icon",children:e.jsx(Ta,{size:22})}),ye.client_signature_data&&e.jsx("img",{src:ye.client_signature_data,alt:"Client Signature",className:"verification-signature-img"}),e.jsxs("div",{className:"verification-info",children:[e.jsx("span",{className:"signer-name",children:ye.client_signature_name||"Client"}),(ye.client_signature_title||ye.client_signature_company)&&e.jsx("span",{className:"signer-title",children:[ye.client_signature_title,ye.client_signature_company].filter(Boolean).join(", ")}),ye.client_signature_date&&e.jsxs("span",{className:"verify-date",children:["Verified ",Bn(ye.client_signature_date)]})]})]})]})]},ye.id)})}),e.jsxs("div",{className:"backup-note",children:[e.jsx(vn,{size:14}),e.jsx("span",{children:"This documentation supports the work described in this Change Order Request."})]})]})})(),e.jsxs("div",{className:"cor-totals-card",children:[e.jsx("h4",{children:"COR Summary"}),e.jsxs("div",{className:"cor-totals-grid",children:[e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:Ue(ce.cor_subtotal)})]}),e.jsxs("div",{className:"cor-fees-section",children:[e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Liability Insurance (",oa(p.liability_insurance_percent||144),")"]}),e.jsx("span",{children:Ue(ce.liability_insurance_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Bond (",oa(p.bond_percent||100),")"]}),e.jsx("span",{children:Ue(ce.bond_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["City License Fee (",oa(p.license_fee_percent||10),")"]}),e.jsx("span",{children:Ue(ce.license_fee_amount)})]})]}),e.jsxs("div",{className:"cor-grand-total",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:Ue(ce.cor_total)})]})]})]}),e.jsxs("div",{className:"cor-signature-section",children:[e.jsx("h4",{children:"Authorization"}),e.jsx("p",{className:"signature-instruction",children:"By signing below, you authorize the above change order request and agree to the terms and costs outlined."}),e.jsx("div",{className:"signature-slots-grid",children:D?e.jsxs(e.Fragment,{children:[ee&&e.jsxs("div",{className:"signature-slot-card signed",children:[e.jsxs("div",{className:"slot-header",children:[e.jsx(Ta,{size:20,className:"status-icon signed"}),e.jsx("span",{className:"slot-label",children:"GC Authorization"})]}),e.jsxs("div",{className:"slot-signed-info",children:[ee.signature_data&&e.jsx("img",{src:ee.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:ee.signer_name}),(ee.signer_title||ee.signer_company)&&e.jsxs("span",{className:"signer-org",children:[ee.signer_title,ee.signer_title&&ee.signer_company&&"  ",ee.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",Bn(ee.signed_at)]})]})]}),k&&e.jsxs("div",{className:"signature-slot-card signed",children:[e.jsxs("div",{className:"slot-header",children:[e.jsx(Ta,{size:20,className:"status-icon signed"}),e.jsx("span",{className:"slot-label",children:"Client Authorization"})]}),e.jsxs("div",{className:"slot-signed-info",children:[k.signature_data&&e.jsx("img",{src:k.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:k.signer_name}),(k.signer_title||k.signer_company)&&e.jsxs("span",{className:"signer-org",children:[k.signer_title,k.signer_title&&k.signer_company&&"  ",k.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",Bn(k.signed_at)]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`signature-slot-card ${ee?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[ee?e.jsx(Ta,{size:20,className:"status-icon signed"}):e.jsx(jn,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"GC Authorization"})]}),e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>B(1),disabled:j,children:"Sign as GC"})]}),e.jsx("p",{className:"or-divider",children:" or "}),e.jsxs("div",{className:`signature-slot-card ${k?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[k?e.jsx(Ta,{size:20,className:"status-icon signed"}):e.jsx(jn,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"Client Authorization"})]}),e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>B(2),disabled:j,children:"Sign as Client"})]})]})}),D&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(Ta,{size:24}),e.jsx("p",{children:"This change order request has been signed."})]}),e.jsxs("div",{className:"cor-download-section",children:[e.jsx("h4",{children:"Download Your Copy"}),e.jsx("p",{className:"download-description",children:D?"Download a PDF copy of this fully signed COR including all T&M backup documentation.":"Download a PDF copy of this COR for your records. Signature status will be included."}),e.jsx("button",{className:"btn btn-primary download-btn",onClick:me,disabled:X,children:X?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"download-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ii,{size:18}),"Download COR + Backup"]})})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),m&&A&&e.jsx(sf,{slot:A,documentType:h.document_type,documentTitle:`${p.cor_number} - ${p.title}`,onSave:R,onClose:()=>{v(!1),_(null)}})]})}function Gi(r,l,c,i,d){return e.jsxs("div",{className:`signature-slot-card ${l?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[l?e.jsx(Ta,{size:20,className:"status-icon signed"}):e.jsx(jn,{size:20,className:"status-icon pending"}),e.jsxs("span",{className:"slot-label",children:["Signature ",r,"  ",c]})]}),l?e.jsxs("div",{className:"slot-signed-info",children:[e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:l.signer_name}),(l.signer_title||l.signer_company)&&e.jsxs("span",{className:"signer-org",children:[l.signer_title,l.signer_title&&l.signer_company&&"  ",l.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",Bn(l.signed_at)]})]}):e.jsxs("button",{className:"btn btn-primary sign-btn",onClick:()=>i(r),disabled:d,children:["Sign as ",r===1?"GC":"Client"]})]})}const Ed=[{value:"member",label:"Member",icon:Pd,description:"Standard access to projects"},{value:"administrator",label:"Administrator",icon:Zi,description:"Full control, can manage team"}],nf=[{value:"Project Manager",label:"Project Manager"},{value:"Superintendent",label:"Superintendent"},{value:"Job Costing",label:"Job Costing"},{value:"Accounting",label:"Accounting"}];function lb({company:r,user:l,onShowToast:c}){const[i,d]=x.useState("pending"),[h,g]=x.useState([]),[p,y]=x.useState(!0),[m,v]=x.useState(null),[A,_]=x.useState({}),[j,$]=x.useState({});x.useEffect(()=>{r?.id&&C()},[r?.id]);const C=async()=>{try{y(!0);const M=await K.getCompanyMemberships(r.id);g(M)}catch(M){console.error("Error loading members:",M),c("Error loading team members","error")}finally{y(!1)}},U=async M=>{const b=j[M.id];if(!b){c("Please select a role for this member","error");return}try{v(M.id);const R=A[M.id]||"member";await K.approveMembershipWithRole(M.id,l.id,R),await K.updateMemberCompanyRole(M.id,b),c(`${M.users?.name||M.users?.email} approved as ${b}`,"success"),_(B=>{const me={...B};return delete me[M.id],me}),$(B=>{const me={...B};return delete me[M.id],me}),C()}catch(R){console.error("Error approving membership:",R),c("Error approving request","error")}finally{v(null)}},X=(M,b)=>{_(R=>({...R,[M]:b}))},V=(M,b)=>{$(R=>({...R,[M]:b}))},q=async(M,b)=>{try{v(M.id),await K.updateMemberCompanyRole(M.id,b),c(`${M.users?.name||"User"} role updated to ${b}`,"success"),C()}catch(R){console.error("Error updating company role:",R),c("Error updating role","error")}finally{v(null)}},E=async(M,b)=>{if(M.users?.id===l.id&&b!=="administrator"){c("You cannot demote yourself","error");return}try{v(M.id),await K.updateMemberAccessLevel(M.id,b);const R=Ed.find(B=>B.value===b)?.label||b;c(`${M.users?.name||"User"} is now ${R}`,"success"),C()}catch(R){console.error("Error updating access level:",R),c("Error updating access level","error")}finally{v(null)}},W=async M=>{try{v(M.id),await K.rejectMembership(M.id),c("Request rejected","success"),C()}catch(b){console.error("Error rejecting membership:",b),c("Error rejecting request","error")}finally{v(null)}},ue=async M=>{if(M.users?.id===l.id){c("You cannot remove yourself","error");return}try{v(M.id),await K.removeMember(M.id,l.id),c(`${M.users?.name||M.users?.email} removed`,"success"),C()}catch(b){console.error("Error removing member:",b),c("Error removing member","error")}finally{v(null)}},ae=h.filter(M=>i==="all"?!0:M.status===i),Y=h.filter(M=>M.status==="pending").length,P=h.filter(M=>M.status==="active").length,ce=h.filter(M=>M.status==="removed").length;return p?e.jsx("div",{className:"membership-manager",children:e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading team members..."]})}):e.jsxs("div",{className:"membership-manager",children:[e.jsxs("div",{className:"membership-header",children:[e.jsxs("h2",{children:[e.jsx($s,{size:24})," Team Members"]}),e.jsxs("p",{className:"membership-subtitle",children:["Manage who has access to ",r?.name]})]}),Y>0&&e.jsxs("div",{className:"pending-alert",children:[e.jsx(Tr,{size:20}),e.jsxs("span",{children:[Y," pending request",Y>1?"s":""," awaiting approval"]})]}),e.jsxs("div",{className:"tm-filter-tabs",children:[e.jsxs("button",{className:`tm-filter-tab ${i==="pending"?"active":""}`,onClick:()=>d("pending"),children:["Pending",e.jsx("span",{className:"tm-filter-count",children:Y})]}),e.jsxs("button",{className:`tm-filter-tab ${i==="active"?"active":""}`,onClick:()=>d("active"),children:["Active",e.jsx("span",{className:"tm-filter-count",children:P})]}),e.jsxs("button",{className:`tm-filter-tab ${i==="removed"?"active":""}`,onClick:()=>d("removed"),children:["Removed",e.jsx("span",{className:"tm-filter-count",children:ce})]})]}),e.jsx("div",{className:"member-list",children:ae.length===0?e.jsxs("div",{className:"member-empty",children:[i==="pending"&&"No pending requests",i==="active"&&"No active members",i==="removed"&&"No removed members"]}):ae.map(M=>e.jsxs("div",{className:`member-card ${M.status}`,children:[e.jsxs("div",{className:"member-info",children:[e.jsxs("div",{className:"member-name",children:[M.users?.name||"Unknown",M.users?.id===l.id&&e.jsx("span",{className:"member-you",children:"(You)"})]}),e.jsx("div",{className:"member-email",children:M.users?.email}),e.jsxs("div",{className:"member-meta",children:[M.status==="pending"&&e.jsxs(e.Fragment,{children:["Requested ",new Date(M.created_at).toLocaleDateString()]}),M.status==="active"&&M.approved_at&&e.jsxs(e.Fragment,{children:["Approved ",new Date(M.approved_at).toLocaleDateString()]}),M.status==="active"&&!M.approved_at&&e.jsxs(e.Fragment,{children:["Member since ",new Date(M.created_at).toLocaleDateString()]}),M.status==="removed"&&M.removed_at&&e.jsxs(e.Fragment,{children:["Removed ",new Date(M.removed_at).toLocaleDateString()]})]}),M.status==="active"&&e.jsxs("div",{className:"member-badges",children:[M.access_level==="administrator"?e.jsxs("span",{className:"access-badge admin",children:[e.jsx(Zi,{size:12})," Administrator"]}):e.jsxs("span",{className:"access-badge member",children:[e.jsx(Pd,{size:12})," Member"]}),M.company_role&&e.jsxs("span",{className:"access-badge role",children:[e.jsx(Cl,{size:12})," ",M.company_role]})]})]}),e.jsxs("div",{className:"member-actions",children:[M.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"role-selector",children:[e.jsxs("select",{value:j[M.id]||"",onChange:b=>V(M.id,b.target.value),disabled:m===M.id,className:"role-select",children:[e.jsx("option",{value:"",children:"Select Role..."}),nf.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value))]}),e.jsx(Ma,{size:14,className:"role-select-icon"})]}),e.jsxs("div",{className:"role-selector",children:[e.jsx("select",{value:A[M.id]||"member",onChange:b=>X(M.id,b.target.value),disabled:m===M.id,className:"role-select",children:Ed.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value))}),e.jsx(Ma,{size:14,className:"role-select-icon"})]}),e.jsx("button",{className:"btn btn-success btn-small",onClick:()=>U(M),disabled:m===M.id,children:m===M.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(Cf,{size:16})," Approve"]})}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:()=>W(M),disabled:m===M.id,children:m===M.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(Yv,{size:16})," Reject"]})})]}),M.status==="active"&&M.users?.id!==l.id&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"role-selector",children:[e.jsxs("select",{value:M.company_role||"",onChange:b=>q(M,b.target.value),disabled:m===M.id,className:"role-select",children:[e.jsx("option",{value:"",children:"No Role"}),nf.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value))]}),e.jsx(Ma,{size:14,className:"role-select-icon"})]}),e.jsxs("div",{className:"role-selector",children:[e.jsx("select",{value:M.access_level||"member",onChange:b=>E(M,b.target.value),disabled:m===M.id,className:"role-select",children:Ed.map(b=>e.jsx("option",{value:b.value,children:b.label},b.value))}),e.jsx(Ma,{size:14,className:"role-select-icon"})]}),e.jsx("button",{className:"btn btn-danger btn-small",onClick:()=>ue(M),disabled:m===M.id,children:m===M.id?"...":e.jsxs(e.Fragment,{children:[e.jsx(wf,{size:16})," Remove"]})})]})]})]},M.id))})]})}function ib({company:r,projects:l,userId:c,onNotificationClick:i,onShowToast:d}){const[h,g]=x.useState([]),[p,y]=x.useState(0),[m,v]=x.useState(!1),[A,_]=x.useState(!1),[j,$]=x.useState({}),C=x.useRef(null);x.useRef(null);const U=x.useRef(null);x.useEffect(()=>{c&&X()},[c]);const X=async()=>{try{const b=await K.getUserNotificationPreferences(c),R={};b.forEach(B=>{R[B.project_id]=B.notification_types||[]}),$(R)}catch(b){console.error("Error loading user preferences:",b)}},V=(b,R)=>j[b]?j[b].length===0?!1:j[b].includes(R):!0;x.useEffect(()=>{if(!r?.id||!l||l.length===0)return;q();const b=E();return()=>{b&&K.unsubscribe(b)}},[r?.id,l,j]),x.useEffect(()=>()=>{U.current&&(U.current.close().catch(()=>{}),U.current=null)},[]),x.useEffect(()=>{function b(R){C.current&&!C.current.contains(R.target)&&v(!1)}return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[]);const q=async()=>{if(!l||l.length===0)return;const b=[];for(const R of l)try{V(R.id,"message")&&(await K.getMessages(R.id,20)).filter(T=>T.sender_type==="field"&&!T.is_read).forEach(T=>{b.push({id:`msg-${T.id}`,type:"message",title:"New Message",message:T.message?.slice(0,50)+(T.message?.length>50?"...":""),projectId:R.id,projectName:R.name,senderName:T.sender_name,createdAt:T.created_at,isRead:T.is_read,data:T})}),V(R.id,"material_request")&&(await K.getMaterialRequests(R.id,"pending")).forEach(me=>{b.push({id:`req-${me.id}`,type:"material_request",title:"Material Request",message:`${me.items?.length||0} items requested`,projectId:R.id,projectName:R.name,senderName:me.requested_by,priority:me.priority,createdAt:me.created_at,isRead:!1,data:me})})}catch(B){console.error("Error loading notifications for project:",R.id,B)}try{(await K.getCompanyInjuryReports(r.id,"open")).slice(0,5).forEach(B=>{if(V(B.project_id,"injury_report")){const me=l.find(T=>T.id===B.project_id);b.push({id:`injury-${B.id}`,type:"injury_report",title:"Safety Report",message:`${B.injury_type} - ${B.injured_person_name}`,projectId:B.project_id,projectName:me?.name||"Unknown Project",senderName:B.reported_by_name,createdAt:B.created_at,isRead:B.status!=="open",data:B})}})}catch(R){console.error("Error loading injury reports:",R)}b.sort((R,B)=>new Date(B.createdAt)-new Date(R.createdAt)),g(b.slice(0,50)),y(b.filter(R=>!R.isRead).length)},E=()=>{if(!r?.id||!l||l.length===0)return null;const b=l.map(B=>B.id),R=K.subscribeToCompanyActivity(r.id,b,{onMessage:B=>{if(B.new?.sender_type==="field"){if(!V(B.new.project_id,"message"))return;W({id:`msg-${B.new.id}`,type:"message",title:"New Message",message:B.new.message?.slice(0,50)+(B.new.message?.length>50?"...":""),projectId:B.new.project_id,projectName:l.find(me=>me.id===B.new.project_id)?.name||"Project",senderName:B.new.sender_name,createdAt:B.new.created_at,isRead:!1,data:B.new})}},onMaterialRequest:B=>{V(B.new.project_id,"material_request")&&W({id:`req-${B.new.id}`,type:"material_request",title:"Material Request",message:`${B.new.items?.length||0} items requested`,projectId:B.new.project_id,projectName:l.find(me=>me.id===B.new.project_id)?.name||"Project",senderName:B.new.requested_by,priority:B.new.priority,createdAt:B.new.created_at,isRead:!1,data:B.new})},onTMTicket:B=>{if(B.eventType==="INSERT"){if(!V(B.new.project_id,"tm_ticket"))return;W({id:`tm-${B.new.id}`,type:"tm_ticket",title:"New T&M Ticket",message:`Submitted by ${B.new.created_by_name||"Field"}`,projectId:B.new.project_id,projectName:l.find(me=>me.id===B.new.project_id)?.name||"Project",senderName:B.new.created_by_name,createdAt:B.new.created_at,isRead:!1,data:B.new})}},onInjuryReport:B=>{V(B.new.project_id,"injury_report")&&W({id:`injury-${B.new.id}`,type:"injury_report",title:"Safety Report",message:`${B.new.injury_type} - ${B.new.injured_person_name}`,projectId:B.new.project_id,projectName:l.find(me=>me.id===B.new.project_id)?.name||"Project",senderName:B.new.reported_by_name,createdAt:B.new.created_at,isRead:!1,data:B.new})}});return R&&_(!0),R},W=b=>{g(B=>[b,...B.slice(0,49)]),y(B=>B+1),ue();const R=ae(b.type);d?.(`${R} ${b.title}: ${b.message}`,"info")},ue=()=>{try{(!U.current||U.current.state==="closed")&&(U.current=new(window.AudioContext||window.webkitAudioContext));const b=U.current;b.state==="suspended"&&b.resume();const R=b.createOscillator(),B=b.createGain();R.connect(B),B.connect(b.destination),R.frequency.value=800,R.type="sine",B.gain.value=.3,R.start(),R.stop(b.currentTime+.15),setTimeout(()=>{if(!U.current||U.current.state==="closed")return;const me=U.current.createOscillator(),T=U.current.createGain();me.connect(T),T.connect(U.current.destination),me.frequency.value=1e3,me.type="sine",T.gain.value=.3,me.start(),me.stop(U.current.currentTime+.15)},150)}catch{}},ae=b=>{switch(b){case"message":return e.jsx(bf,{size:16});case"material_request":return e.jsx(Hs,{size:16});case"injury_report":return e.jsx(vn,{size:16});case"tm_ticket":return e.jsx(cs,{size:16});default:return e.jsx(xj,{size:16})}},Y=b=>{switch(b){case"message":return"blue";case"material_request":return"orange";case"injury_report":return"red";case"tm_ticket":return"green";default:return"gray"}},P=b=>{g(R=>R.map(B=>B.id===b.id?{...B,isRead:!0}:B)),y(R=>Math.max(0,R-1)),v(!1),i?.(b)},ce=async()=>{for(const b of l)try{await K.markMessagesRead(b.id,"office")}catch{}g(b=>b.map(R=>({...R,isRead:!0}))),y(0)},M=b=>{const R=new Date(b),me=new Date-R,T=Math.floor(me/6e4),ee=Math.floor(me/36e5),k=Math.floor(me/864e5);return T<1?"Just now":T<60?`${T}m ago`:ee<24?`${ee}h ago`:k<7?`${k}d ago`:R.toLocaleDateString()};return e.jsxs("div",{className:"notification-center",ref:C,children:[e.jsxs("button",{className:`notification-bell ${p>0?"has-notifications":""}`,onClick:()=>v(!m),title:`${p} unread notifications`,children:[e.jsx("span",{className:"bell-icon",children:""}),p>0&&e.jsx("span",{className:"notification-badge",children:p>99?"99+":p}),A&&e.jsx("span",{className:"connection-dot"})]}),m&&e.jsxs("div",{className:"notification-dropdown",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx("h4",{children:"Notifications"}),p>0&&e.jsx("button",{className:"mark-all-read",onClick:ce,children:"Mark all read"})]}),e.jsx("div",{className:"notification-list",children:h.length===0?e.jsxs("div",{className:"notification-empty",children:[e.jsx("span",{className:"empty-icon",children:""}),e.jsx("p",{children:"No notifications yet"}),e.jsx("small",{children:"You'll see updates from the field here"})]}):h.map(b=>e.jsxs("div",{className:`notification-item ${b.isRead?"read":"unread"} ${Y(b.type)}`,onClick:()=>P(b),children:[e.jsx("div",{className:"notification-icon",children:ae(b.type)}),e.jsxs("div",{className:"notification-content",children:[e.jsxs("div",{className:"notification-title",children:[b.title,b.priority==="urgent"&&e.jsx("span",{className:"priority-badge urgent",children:"URGENT"})]}),e.jsx("div",{className:"notification-message",children:b.message}),e.jsxs("div",{className:"notification-meta",children:[e.jsx("span",{className:"notification-project",children:b.projectName}),e.jsx("span",{className:"notification-time",children:M(b.createdAt)})]})]}),!b.isRead&&e.jsx("div",{className:"unread-dot"})]},b.id))}),h.length>0&&e.jsx("div",{className:"notification-footer",children:e.jsx("button",{className:"view-all-btn",onClick:()=>{v(!1),i?.({type:"view_all"})},children:"View All Activity"})})]})]})}class wr extends x.Component{constructor(l){super(l),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(l){return{hasError:!0}}componentDidCatch(l,c){this.setState({error:l,errorInfo:c}),console.error("ErrorBoundary caught an error:",l,c)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleReload=()=>{window.location.reload()};render(){return this.state.hasError?e.jsx("div",{className:"error-boundary",children:e.jsxs("div",{className:"error-boundary-content",children:[e.jsx("div",{className:"error-icon",children:e.jsx(Tr,{size:48})}),e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{children:"We're sorry, but something unexpected happened. Please try again."}),e.jsxs("div",{className:"error-actions",children:[e.jsx("button",{className:"btn btn-primary",onClick:this.handleRetry,children:"Try Again"}),e.jsx("button",{className:"btn btn-secondary",onClick:this.handleReload,children:"Reload Page"})]}),!1]})}):this.props.children}}function rf(){const[r,l]=x.useState(kr()),[c,i]=x.useState(0),[d,h]=x.useState(!1),[g,p]=x.useState(!1);return x.useEffect(()=>{const y=Ld(async v=>{l(v),v&&g&&(h(!0),setTimeout(()=>h(!1),3e3)),v||p(!0);const A=await Yi();i(A)});Yi().then(i);const m=setInterval(async()=>{if(!kr()){const v=await Yi();i(v)}},5e3);return()=>{y(),clearInterval(m)}},[g]),r&&c===0&&!d?null:e.jsxs("div",{className:`offline-indicator ${r?"online":"offline"} ${d?"synced":""}`,children:[e.jsx("div",{className:"offline-indicator-content",children:r?d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"online-icon",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("span",{className:"offline-text",children:"Changes synced!"})]}):c>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"syncing-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"23 4 23 10 17 10"}),e.jsx("polyline",{points:"1 20 1 14 7 14"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),e.jsxs("span",{className:"offline-text",children:["Syncing ",c,"..."]})]}):null:e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"offline-icon",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),e.jsx("path",{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}),e.jsx("path",{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}),e.jsx("path",{d:"M10.71 5.05A16 16 0 0 1 22.58 9"}),e.jsx("path",{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"}),e.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),e.jsx("line",{x1:"12",y1:"20",x2:"12.01",y2:"20"})]})}),e.jsxs("span",{className:"offline-text",children:["Offline",c>0&&e.jsxs("span",{className:"pending-badge",children:[c," pending"]})]})]})}),e.jsx("style",{children:`
        .offline-indicator {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 9999;
          padding: 10px 16px;
          border-radius: 24px;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
          from {
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
          }
        }

        .offline-indicator.offline {
          background: #1f2937;
          color: #fbbf24;
        }

        .offline-indicator.online {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator.synced {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .offline-icon,
        .online-icon,
        .syncing-icon {
          display: flex;
          align-items: center;
        }

        .syncing-icon svg {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        .offline-text {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .pending-badge {
          background: rgba(251, 191, 36, 0.2);
          padding: 2px 8px;
          border-radius: 12px;
          font-size: 12px;
        }

        @media (max-width: 480px) {
          .offline-indicator {
            bottom: 70px; /* Above mobile nav */
            left: 16px;
            right: 16px;
            transform: none;
          }
        }
      `})]})}function cb(){const[r,l]=x.useState("entry"),[c,i]=x.useState(null),[d,h]=x.useState(null),[g,p]=x.useState([]),[y,m]=x.useState([]),[v,A]=x.useState(null),[_,j]=x.useState(null),[$,C]=x.useState(null),[U,X]=x.useState(!0),[V,q]=x.useState("dashboard"),[E,W]=x.useState(null),[ue,ae]=x.useState(!1),[Y,P]=x.useState(null),[ce,M]=x.useState(0);x.useEffect(()=>{const de=window.location.pathname,ye=de.match(/^\/view\/([a-zA-Z0-9_-]+)$/),Fe=de.match(/^\/sign\/([a-zA-Z0-9_-]+)$/);ye?(j(ye[1]),l("public"),X(!1)):Fe?(C(Fe[1]),l("signature"),X(!1)):b()},[]);const b=async()=>{try{const{data:{user:de}}=await w.auth.getUser();if(!de){X(!1);return}const{data:ye,error:Fe}=await w.from("users").select("*").eq("id",de.id).single();if(ye){i(ye);let ze=await K.getUserCompanies(de.id);if(ze.length===0&&ye.company_id&&(console.log("Legacy user detected, attempting repair..."),await K.repairLegacyUser(de.id,ye.company_id,ye.role||"member")&&(ze=await K.getUserCompanies(de.id),console.log("Legacy user repaired, companies:",ze.length))),p(ze),ze.length===0){if(await K.getUserPendingMemberships(de.id)>0){l("pending");return}k("No company access. Join a company to continue.","error"),await Md.signOut();return}const Me=localStorage.getItem("selectedCompanyId");let nt=null;if(Me&&ze.find(qe=>qe.id===Me)?nt=ze.find(qe=>qe.id===Me):ze.length>0&&(nt=ze[0]),nt){const{data:qe}=await w.from("companies").select("*").eq("id",nt.id).single();h(qe),l("office")}}}catch(de){console.error("Auth check error:",de)}finally{X(!1)}},R=de=>{A(de),l("foreman")},B=async(de,ye)=>{try{const{data:Fe,error:ze}=await w.auth.signInWithPassword({email:de,password:ye});if(ze){k(ze.message||"Invalid credentials","error");return}const{data:Me,error:nt}=await w.from("users").select("*").eq("id",Fe.user.id).single();if(nt){console.error("User fetch error:",nt),k("Error loading profile","error");return}if(Me){i(Me);let qe=await K.getUserCompanies(Fe.user.id);qe.length===0&&Me.company_id&&(console.log("Legacy user detected on login, attempting repair..."),await K.repairLegacyUser(Fe.user.id,Me.company_id,Me.role||"member")&&(qe=await K.getUserCompanies(Fe.user.id),console.log("Legacy user repaired on login, companies:",qe.length))),p(qe);const J=localStorage.getItem("selectedCompanyId");let Oe=null;if(J&&qe.find(Ie=>Ie.id===J)?Oe=qe.find(Ie=>Ie.id===J):qe.length>0&&(Oe=qe[0]),Oe){const{data:Ie}=await w.from("companies").select("*").eq("id",Oe.id).single();h(Ie),l("office")}else await K.getUserPendingMemberships(Fe.user.id)>0?l("pending"):k("No company access. Please contact admin.","error")}else k("Profile not found. Please contact admin.","error")}catch(Fe){console.error("Login error:",Fe),k("Login failed","error")}},me=async de=>{try{const{data:ye}=await w.from("companies").select("*").eq("id",de).single();ye&&(h(ye),localStorage.setItem("selectedCompanyId",de),ae(!1),q("dashboard"),k(`Switched to ${ye.name}`,"success"))}catch(ye){console.error("Switch company error:",ye),k("Error switching company","error")}},T=async()=>{try{await Md.signOut(),i(null),h(null),p([]),l("entry"),q("dashboard"),localStorage.removeItem("selectedCompanyId")}catch(de){console.error("Logout error:",de),k("Error signing out","error")}},ee=()=>{A(null),l("entry")},k=(de,ye="")=>{W({message:de,type:ye})},pe=()=>{q("dashboard"),d?.id&&D()},D=async()=>{if(d?.id)try{const de=await K.getProjects(d.id);m(de)}catch(de){console.error("Error loading projects:",de)}};x.useEffect(()=>{d?.id&&r==="office"&&(D(),z())},[d?.id,r]);const z=async()=>{if(d?.id)try{const ye=(await K.getCompanyMemberships(d.id)).filter(Fe=>Fe.status==="pending").length;M(ye)}catch(de){console.error("Error loading pending count:",de)}},se=de=>{if(de.type==="view_all"){q("dashboard"),P(null);return}q("dashboard"),de.projectId&&P(de.projectId)},Z=()=>{P(null)};if(U)return e.jsx(Fn,{children:e.jsx(qn,{companyId:d?.id,children:e.jsxs("div",{className:"loading-screen",children:[e.jsx(ps,{className:"loading-logo"}),e.jsx("div",{className:"spinner"})]})})});if(r==="entry")return e.jsx(Fn,{children:e.jsxs(qn,{children:[e.jsx(wr,{children:e.jsx(Wv,{onForemanAccess:R,onOfficeLogin:B,onShowToast:k})}),E&&e.jsx(Ls,{message:E.message,type:E.type,onClose:()=>W(null)})]})});if(r==="public"&&_)return e.jsx(Fn,{children:e.jsxs(qn,{children:[e.jsx(wr,{children:e.jsx(Ky,{shareToken:_})}),E&&e.jsx(Ls,{message:E.message,type:E.type,onClose:()=>W(null)})]})});if(r==="signature"&&$)return e.jsx(Fn,{children:e.jsxs(qn,{children:[e.jsx(wr,{children:e.jsx(rb,{signatureToken:$})}),E&&e.jsx(Ls,{message:E.message,type:E.type,onClose:()=>W(null)})]})});if(r==="pending")return e.jsx(Fn,{children:e.jsxs(qn,{children:[e.jsx(wr,{children:e.jsxs("div",{className:"pending-approval-screen",children:[e.jsx(ps,{className:"pending-logo"}),e.jsx("h2",{children:"Awaiting Approval"}),e.jsx("p",{children:"Your membership request has been submitted."}),e.jsx("p",{children:"A company admin will review your request."}),e.jsxs("div",{className:"pending-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:T,children:"Sign Out"}),e.jsx("button",{className:"btn btn-primary",onClick:b,children:"Check Status"})]})]})}),E&&e.jsx(Ls,{message:E.message,type:E.type,onClose:()=>W(null)})]})});if(r==="foreman"&&v)return e.jsx(Fn,{children:e.jsxs(qn,{companyId:v.company_id,children:[e.jsx(wr,{children:e.jsx(dy,{project:v,companyId:v.company_id,onShowToast:k,onExit:ee})}),e.jsx(rf,{}),E&&e.jsx(Ls,{message:E.message,type:E.type,onClose:()=>W(null)})]})});const fe=g.find(de=>de.id===d?.id)?.access_level==="administrator"||d?.owner_user_id===c?.id;return e.jsx(Fn,{children:e.jsx(qn,{companyId:d?.id,children:e.jsxs("div",{children:[!H&&e.jsx("div",{className:"demo-banner",children:"Demo Mode - Data saved locally in your browser"}),e.jsx("nav",{className:"nav",children:e.jsxs("div",{className:"nav-content",children:[e.jsx(ps,{}),e.jsxs("div",{className:"nav-tabs",children:[e.jsx("button",{className:`nav-tab ${V==="dashboard"?"active":""}`,onClick:()=>q("dashboard"),children:"Dashboard"}),e.jsx("button",{className:`nav-tab ${V==="setup"?"active":""}`,onClick:()=>q("setup"),children:"+ New Project"}),e.jsx("button",{className:`nav-tab ${V==="pricing"?"active":""}`,onClick:()=>q("pricing"),children:"Pricing"}),fe&&e.jsx("button",{className:`nav-tab ${V==="branding"?"active":""}`,onClick:()=>q("branding"),children:"Branding"}),fe&&e.jsxs("button",{className:`nav-tab ${V==="team"?"active":""}`,onClick:()=>q("team"),children:["Team",ce>0&&e.jsx("span",{className:"nav-tab-badge",children:ce})]})]}),e.jsxs("div",{className:"nav-user",children:[e.jsx(Tf,{compact:!0}),e.jsx(ib,{company:d,projects:y,userId:c?.id,onNotificationClick:se,onShowToast:k}),g.length>1&&e.jsxs("div",{className:"company-switcher",children:[e.jsxs("button",{className:"company-switcher-btn",onClick:()=>ae(!ue),children:[d?.name||"Select Company",e.jsx("span",{className:"switcher-arrow",children:""})]}),ue&&e.jsx("div",{className:"company-dropdown",children:g.map(de=>e.jsxs("button",{className:`company-option ${de.id===d?.id?"active":""}`,onClick:()=>me(de.id),children:[de.name,de.id===d?.id&&e.jsx("span",{className:"check",children:""})]},de.id))})]}),g.length<=1&&d&&e.jsx("span",{className:"nav-company-name",children:d.name}),e.jsx("span",{className:"nav-user-name",children:c?.name||c?.email}),e.jsx("button",{className:"nav-logout",onClick:T,children:"Sign Out"})]})]})}),e.jsx(wr,{children:e.jsxs("div",{className:"container",children:[V==="dashboard"&&e.jsx(Py,{company:d,user:c,isAdmin:fe,onShowToast:k,navigateToProjectId:Y,onProjectNavigated:Z}),V==="setup"&&e.jsx(Gy,{company:d,user:c,onProjectCreated:pe,onShowToast:k}),V==="pricing"&&e.jsx(Wy,{company:d,onShowToast:k}),V==="branding"&&e.jsx(Yy,{company:d,onShowToast:k}),V==="team"&&fe&&e.jsx(lb,{company:d,user:c,onShowToast:k})]},d?.id)}),e.jsx(rf,{}),E&&e.jsx(Ls,{message:E.message,type:E.type,onClose:()=>W(null)})]})})})}Jx.createRoot(document.getElementById("root")).render(e.jsx(Gx.StrictMode,{children:e.jsx(cb,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(r=>{console.log("SW registered:",r.scope),setInterval(()=>{r.update()},6e4)}).catch(r=>{console.log("SW registration failed:",r)})});export{Ue as a,oa as b,Na as c,Wi as f};
