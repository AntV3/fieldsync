{"version":3,"file":"SignaturePage-UzUrubot.js","sources":["../../src/lib/corPdfExport.js","../../src/components/SignaturePage.jsx"],"sourcesContent":["// ============================================\n// DEPRECATED: Legacy COR PDF Export\n// ============================================\n//\n// This file is DEPRECATED and maintained only for backward compatibility\n// with SignaturePage.jsx (client-side downloads after signing).\n//\n// For new code, use the snapshot-based export pipeline:\n// - corExportPipeline.js - Orchestrates idempotent, async exports\n// - corPdfGenerator.js - Generates PDFs from frozen snapshots\n//\n// The new system provides:\n// - Idempotent exports (repeat requests return same result)\n// - Snapshot-based generation (deterministic, reproducible)\n// - Async pipeline with state tracking (pending/generating/completed/failed)\n// - Pre-aggregated stats and photo manifests\n//\n// Migration: Replace exportCORToPDF calls with executeExport from corExportPipeline.js\n// ============================================\n\nimport jsPDF from 'jspdf'\nimport autoTable from 'jspdf-autotable'\nimport {\n  formatCurrency,\n  formatPercent,\n  centsToDollars,\n  calculateCORTotals,\n  formatDate,\n  formatDateRange\n} from './corCalculations'\nimport { hexToRgb, loadImageAsBase64, loadImagesAsBase64 } from './imageUtils'\n\n// Helper to format time (HH:MM or HH:MM:SS to 9:00am format)\nconst formatTime = (timeStr) => {\n  if (!timeStr) return ''\n  const [hours, minutes] = timeStr.split(':')\n  const h = parseInt(hours)\n  const ampm = h >= 12 ? 'pm' : 'am'\n  const h12 = h % 12 || 12\n  return `${h12}:${minutes}${ampm}`\n}\n\n// Format time period for workers\nconst formatTimePeriod = (worker) => {\n  if (worker.time_started && worker.time_ended) {\n    return `${formatTime(worker.time_started)} - ${formatTime(worker.time_ended)}`\n  }\n  return '-'\n}\n\n/**\n * Pre-verify all photos in T&M tickets before export\n * Creates a manifest of verified photos and tracks failures\n * @param {Object[]} tmTickets - T&M tickets with photos\n * @returns {Promise<Object>} Photo manifest with verification status\n */\nexport async function verifyPhotosForExport(tmTickets) {\n  if (!tmTickets || tmTickets.length === 0) {\n    return { totalPhotos: 0, verified: 0, failed: 0, issues: [], manifest: [] }\n  }\n\n  const manifest = []\n  let verified = 0\n  let failed = 0\n  const issues = []\n\n  for (const ticket of tmTickets) {\n    if (!ticket.photos || ticket.photos.length === 0) continue\n\n    for (const photoUrl of ticket.photos) {\n      const entry = {\n        ticketId: ticket.id,\n        workDate: ticket.work_date,\n        url: photoUrl,\n        verified: false,\n        error: null\n      }\n\n      try {\n        // Try to load the image to verify accessibility\n        const imgData = await loadImageAsBase64(photoUrl)\n        if (imgData) {\n          entry.verified = true\n          verified++\n        } else {\n          entry.error = 'Failed to load image'\n          failed++\n          issues.push({\n            ticketId: ticket.id,\n            workDate: ticket.work_date,\n            url: photoUrl,\n            error: 'Failed to load image'\n          })\n        }\n      } catch (err) {\n        entry.error = err.message || 'Unknown error'\n        failed++\n        issues.push({\n          ticketId: ticket.id,\n          workDate: ticket.work_date,\n          url: photoUrl,\n          error: entry.error\n        })\n      }\n\n      manifest.push(entry)\n    }\n  }\n\n  return {\n    totalPhotos: verified + failed,\n    verified,\n    failed,\n    issues,\n    manifest,\n    allVerified: failed === 0,\n    verifiedAt: new Date().toISOString()\n  }\n}\n\n/**\n * Create a frozen snapshot of COR data at export time for dispute purposes\n * @param {Object} cor - The COR data object\n * @param {Object[]} tmTickets - Associated T&M tickets\n * @param {Object} photoManifest - Photo verification manifest\n * @param {Object} totals - Calculated totals\n * @returns {Object} Frozen snapshot ready for database storage\n */\nexport function createExportSnapshot(cor, tmTickets, photoManifest, totals) {\n  // Create a SHA256-like checksum from the data (simplified for client-side)\n  const dataString = JSON.stringify({ cor, tmTickets, photoManifest, totals })\n  let hash = 0\n  for (let i = 0; i < dataString.length; i++) {\n    const char = dataString.charCodeAt(i)\n    hash = ((hash << 5) - hash) + char\n    hash = hash & hash\n  }\n  const checksum = Math.abs(hash).toString(16).padStart(16, '0')\n\n  return {\n    cor_data: {\n      id: cor.id,\n      cor_number: cor.cor_number,\n      title: cor.title,\n      description: cor.description,\n      status: cor.status,\n      created_at: cor.created_at,\n      submitted_at: cor.submitted_at,\n      labor_items: cor.labor_items,\n      material_items: cor.material_items,\n      equipment_items: cor.equipment_items,\n      gc_markup_percent: cor.gc_markup_percent,\n      profit_markup_percent: cor.profit_markup_percent\n    },\n    tickets_data: (tmTickets || []).map(ticket => ({\n      id: ticket.id,\n      work_date: ticket.work_date,\n      ce_pco_number: ticket.ce_pco_number,\n      notes: ticket.notes,\n      status: ticket.status,\n      created_at: ticket.created_at,\n      workers: ticket.t_and_m_workers || [],\n      items: ticket.t_and_m_items || [],\n      photos: ticket.photos || [],\n      client_signature_name: ticket.client_signature_name,\n      client_signature_date: ticket.client_signature_date\n    })),\n    photos_manifest: photoManifest,\n    totals_snapshot: totals,\n    checksum: checksum\n  }\n}\n\n/**\n * Export a Change Order Request to PDF\n * @param {Object} cor - The COR data object\n * @param {Object} project - The project data\n * @param {Object} company - The company data\n * @param {Object} branding - Optional branding settings\n * @param {Object[]} tmTickets - Optional T&M tickets for backup documentation\n * @param {Object} options - Export options (verifyPhotos, createSnapshot)\n * @returns {Promise<Object>} Export result with optional snapshot and verification data\n */\nexport async function exportCORToPDF(cor, project, company, branding = {}, tmTickets = null, options = {}) {\n  const { verifyPhotos = false, createSnapshot = false } = options\n\n  // Photo verification (optional, for dispute-ready exports)\n  let photoManifest = null\n  if (verifyPhotos && tmTickets?.length > 0) {\n    photoManifest = await verifyPhotosForExport(tmTickets)\n  }\n  const doc = new jsPDF()\n  const pageWidth = doc.internal.pageSize.getWidth()\n  const pageHeight = doc.internal.pageSize.getHeight()\n  const margin = 20\n  let yPos = margin\n\n  // Calculate totals\n  const totals = calculateCORTotals(cor)\n\n  // Colors\n  const primaryColor = branding.primaryColor ? hexToRgb(branding.primaryColor) : [30, 58, 138]\n  const headerBg = [241, 245, 249]\n\n  // Load company logo if available\n  let logoBase64 = null\n  if (branding.logoUrl) {\n    try {\n      logoBase64 = await loadImageAsBase64(branding.logoUrl)\n    } catch (e) {\n      console.error('Error loading logo:', e)\n    }\n  }\n\n  // ============================================\n  // HEADER\n  // ============================================\n\n  // Company Logo or Name\n  if (logoBase64) {\n    try {\n      doc.addImage(logoBase64, 'PNG', margin, yPos, 40, 15)\n      yPos += 20\n    } catch (e) {\n      doc.setFontSize(16)\n      doc.setFont('helvetica', 'bold')\n      doc.setTextColor(...primaryColor)\n      doc.text(company?.name || 'Company Name', margin, yPos + 10)\n      yPos += 20\n    }\n  } else {\n    doc.setFontSize(16)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(...primaryColor)\n    doc.text(company?.name || 'Company Name', margin, yPos + 10)\n    yPos += 20\n  }\n\n  // Title\n  doc.setFontSize(20)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(0, 0, 0)\n  doc.text('CHANGE ORDER REQUEST', margin, yPos)\n  yPos += 10\n\n  // COR Number and Status\n  doc.setFontSize(12)\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(100, 100, 100)\n  doc.text(cor.cor_number || 'COR-XXXX', margin, yPos)\n\n  // Status badge\n  const statusText = cor.status?.replace('_', ' ').toUpperCase() || 'DRAFT'\n  doc.setTextColor(...primaryColor)\n  doc.text(statusText, pageWidth - margin - doc.getTextWidth(statusText), yPos)\n  yPos += 12\n\n  // Divider line\n  doc.setDrawColor(...primaryColor)\n  doc.setLineWidth(0.5)\n  doc.line(margin, yPos, pageWidth - margin, yPos)\n  yPos += 10\n\n  // ============================================\n  // PROJECT & COR INFO\n  // ============================================\n\n  doc.setFontSize(10)\n  doc.setTextColor(0, 0, 0)\n\n  // Two column layout for project info\n  const col1X = margin\n  const col2X = pageWidth / 2\n\n  doc.setFont('helvetica', 'bold')\n  doc.text('Project:', col1X, yPos)\n  doc.setFont('helvetica', 'normal')\n  doc.text(project?.name || 'Project Name', col1X + 25, yPos)\n\n  doc.setFont('helvetica', 'bold')\n  doc.text('Job #:', col2X, yPos)\n  doc.setFont('helvetica', 'normal')\n  doc.text(project?.job_number || 'N/A', col2X + 25, yPos)\n  yPos += 6\n\n  doc.setFont('helvetica', 'bold')\n  doc.text('Period:', col1X, yPos)\n  doc.setFont('helvetica', 'normal')\n  doc.text(formatDateRange(cor.period_start, cor.period_end), col1X + 25, yPos)\n\n  doc.setFont('helvetica', 'bold')\n  doc.text('Date:', col2X, yPos)\n  doc.setFont('helvetica', 'normal')\n  doc.text(formatDate(cor.created_at), col2X + 25, yPos)\n  yPos += 10\n\n  // COR Title\n  doc.setFont('helvetica', 'bold')\n  doc.setFontSize(12)\n  doc.text(cor.title || 'Untitled Change Order', margin, yPos)\n  yPos += 8\n\n  // Scope of Work\n  doc.setFont('helvetica', 'normal')\n  doc.setFontSize(10)\n  doc.setTextColor(80, 80, 80)\n  const scopeLines = doc.splitTextToSize(cor.scope_of_work || 'No scope of work provided.', pageWidth - (margin * 2))\n  doc.text(scopeLines, margin, yPos)\n  yPos += (scopeLines.length * 5) + 10\n\n  // ============================================\n  // LABOR SECTION\n  // ============================================\n\n  if (cor.change_order_labor?.length > 0) {\n    doc.setFont('helvetica', 'bold')\n    doc.setFontSize(11)\n    doc.setTextColor(0, 0, 0)\n    doc.text('LABOR', margin, yPos)\n    yPos += 6\n\n    autoTable(doc, {\n      startY: yPos,\n      head: [['Class', 'Type', 'Reg Hrs', 'Reg Rate', 'OT Hrs', 'OT Rate', 'Total']],\n      body: cor.change_order_labor.map(item => [\n        item.labor_class,\n        item.wage_type,\n        item.regular_hours.toString(),\n        `$${centsToDollars(item.regular_rate)}/hr`,\n        item.overtime_hours?.toString() || '-',\n        item.overtime_hours ? `$${centsToDollars(item.overtime_rate)}/hr` : '-',\n        formatCurrency(item.total)\n      ]),\n      foot: [[\n        { content: `Subtotal: ${formatCurrency(totals.labor_subtotal)}`, colSpan: 5, styles: { halign: 'right', fontStyle: 'bold' } },\n        { content: `+${formatPercent(cor.labor_markup_percent || 1500)} Markup`, colSpan: 1, styles: { halign: 'right' } },\n        { content: formatCurrency(totals.labor_subtotal + totals.labor_markup_amount), styles: { fontStyle: 'bold' } }\n      ]],\n      margin: { left: margin, right: margin },\n      headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontStyle: 'bold', fontSize: 8 },\n      bodyStyles: { fontSize: 8 },\n      footStyles: { fillColor: headerBg, textColor: [0, 0, 0], fontSize: 8 },\n      theme: 'striped'\n    })\n\n    yPos = doc.lastAutoTable.finalY + 10\n  }\n\n  // ============================================\n  // MATERIALS SECTION\n  // ============================================\n\n  if (cor.change_order_materials?.length > 0) {\n    // Check if we need a new page\n    if (yPos > pageHeight - 80) {\n      doc.addPage()\n      yPos = margin\n    }\n\n    doc.setFont('helvetica', 'bold')\n    doc.setFontSize(11)\n    doc.setTextColor(0, 0, 0)\n    doc.text('MATERIALS', margin, yPos)\n    yPos += 6\n\n    autoTable(doc, {\n      startY: yPos,\n      head: [['Description', 'Source', 'Qty', 'Unit', 'Unit Cost', 'Total']],\n      body: cor.change_order_materials.map(item => [\n        item.description,\n        item.source_reference || item.source_type,\n        item.quantity.toString(),\n        item.unit,\n        `$${centsToDollars(item.unit_cost)}`,\n        formatCurrency(item.total)\n      ]),\n      foot: [[\n        { content: `Subtotal: ${formatCurrency(totals.materials_subtotal)}`, colSpan: 4, styles: { halign: 'right', fontStyle: 'bold' } },\n        { content: `+${formatPercent(cor.materials_markup_percent || 1500)} Markup`, colSpan: 1, styles: { halign: 'right' } },\n        { content: formatCurrency(totals.materials_subtotal + totals.materials_markup_amount), styles: { fontStyle: 'bold' } }\n      ]],\n      margin: { left: margin, right: margin },\n      headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontStyle: 'bold', fontSize: 8 },\n      bodyStyles: { fontSize: 8 },\n      footStyles: { fillColor: headerBg, textColor: [0, 0, 0], fontSize: 8 },\n      theme: 'striped'\n    })\n\n    yPos = doc.lastAutoTable.finalY + 10\n  }\n\n  // ============================================\n  // EQUIPMENT SECTION\n  // ============================================\n\n  if (cor.change_order_equipment?.length > 0) {\n    if (yPos > pageHeight - 80) {\n      doc.addPage()\n      yPos = margin\n    }\n\n    doc.setFont('helvetica', 'bold')\n    doc.setFontSize(11)\n    doc.setTextColor(0, 0, 0)\n    doc.text('EQUIPMENT', margin, yPos)\n    yPos += 6\n\n    autoTable(doc, {\n      startY: yPos,\n      head: [['Description', 'Source', 'Qty', 'Unit', 'Unit Cost', 'Total']],\n      body: cor.change_order_equipment.map(item => [\n        item.description,\n        item.source_reference || item.source_type,\n        item.quantity.toString(),\n        item.unit,\n        `$${centsToDollars(item.unit_cost)}`,\n        formatCurrency(item.total)\n      ]),\n      foot: [[\n        { content: `Subtotal: ${formatCurrency(totals.equipment_subtotal)}`, colSpan: 4, styles: { halign: 'right', fontStyle: 'bold' } },\n        { content: `+${formatPercent(cor.equipment_markup_percent || 1500)} Markup`, colSpan: 1, styles: { halign: 'right' } },\n        { content: formatCurrency(totals.equipment_subtotal + totals.equipment_markup_amount), styles: { fontStyle: 'bold' } }\n      ]],\n      margin: { left: margin, right: margin },\n      headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontStyle: 'bold', fontSize: 8 },\n      bodyStyles: { fontSize: 8 },\n      footStyles: { fillColor: headerBg, textColor: [0, 0, 0], fontSize: 8 },\n      theme: 'striped'\n    })\n\n    yPos = doc.lastAutoTable.finalY + 10\n  }\n\n  // ============================================\n  // SUBCONTRACTORS SECTION\n  // ============================================\n\n  if (cor.change_order_subcontractors?.length > 0) {\n    if (yPos > pageHeight - 80) {\n      doc.addPage()\n      yPos = margin\n    }\n\n    doc.setFont('helvetica', 'bold')\n    doc.setFontSize(11)\n    doc.setTextColor(0, 0, 0)\n    doc.text('SUBCONTRACTORS', margin, yPos)\n    yPos += 6\n\n    autoTable(doc, {\n      startY: yPos,\n      head: [['Company', 'Description', 'Source', 'Amount']],\n      body: cor.change_order_subcontractors.map(item => [\n        item.company_name,\n        item.description,\n        item.source_reference || item.source_type,\n        formatCurrency(item.total)\n      ]),\n      foot: [[\n        { content: `Subtotal: ${formatCurrency(totals.subcontractors_subtotal)}`, colSpan: 2, styles: { halign: 'right', fontStyle: 'bold' } },\n        { content: `+${formatPercent(cor.subcontractors_markup_percent || 500)} Markup`, colSpan: 1, styles: { halign: 'right' } },\n        { content: formatCurrency(totals.subcontractors_subtotal + totals.subcontractors_markup_amount), styles: { fontStyle: 'bold' } }\n      ]],\n      margin: { left: margin, right: margin },\n      headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontStyle: 'bold', fontSize: 8 },\n      bodyStyles: { fontSize: 8 },\n      footStyles: { fillColor: headerBg, textColor: [0, 0, 0], fontSize: 8 },\n      theme: 'striped'\n    })\n\n    yPos = doc.lastAutoTable.finalY + 10\n  }\n\n  // ============================================\n  // TOTALS SECTION\n  // ============================================\n\n  if (yPos > pageHeight - 100) {\n    doc.addPage()\n    yPos = margin\n  }\n\n  // Totals box\n  doc.setFillColor(...headerBg)\n  doc.roundedRect(margin, yPos, pageWidth - (margin * 2), 70, 3, 3, 'F')\n\n  yPos += 10\n  doc.setFontSize(10)\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(0, 0, 0)\n\n  const totalsCol1 = margin + 10\n  const totalsCol2 = pageWidth - margin - 60\n\n  // COR Subtotal\n  doc.text('COR Subtotal:', totalsCol1, yPos)\n  doc.setFont('helvetica', 'bold')\n  doc.text(formatCurrency(totals.cor_subtotal), totalsCol2, yPos, { align: 'right' })\n  yPos += 8\n\n  // Additional Fees\n  doc.setFont('helvetica', 'normal')\n  doc.setFontSize(9)\n  doc.text(`Liability Insurance (${formatPercent(cor.liability_insurance_percent || 144)}):`, totalsCol1, yPos)\n  doc.text(formatCurrency(totals.liability_insurance_amount), totalsCol2, yPos, { align: 'right' })\n  yPos += 6\n\n  doc.text(`Bond (${formatPercent(cor.bond_percent || 100)}):`, totalsCol1, yPos)\n  doc.text(formatCurrency(totals.bond_amount), totalsCol2, yPos, { align: 'right' })\n  yPos += 6\n\n  doc.text(`City License Fee (${formatPercent(cor.license_fee_percent || 10)}):`, totalsCol1, yPos)\n  doc.text(formatCurrency(totals.license_fee_amount), totalsCol2, yPos, { align: 'right' })\n  yPos += 10\n\n  // Grand Total\n  doc.setFillColor(...primaryColor)\n  doc.roundedRect(totalsCol1 - 5, yPos - 3, pageWidth - (margin * 2) - 10, 16, 2, 2, 'F')\n  doc.setTextColor(255, 255, 255)\n  doc.setFontSize(12)\n  doc.setFont('helvetica', 'bold')\n  doc.text('COR TOTAL:', totalsCol1, yPos + 8)\n  doc.text(formatCurrency(totals.cor_total), totalsCol2, yPos + 8, { align: 'right' })\n  yPos += 25\n\n  // ============================================\n  // SIGNATURE SECTION (Dual Signatures)\n  // ============================================\n\n  if (yPos > pageHeight - 120) {\n    doc.addPage()\n    yPos = margin\n  }\n\n  yPos += 10\n  doc.setTextColor(0, 0, 0)\n  doc.setFontSize(10)\n  doc.setFont('helvetica', 'bold')\n  doc.text('AUTHORIZATION', margin, yPos)\n  yPos += 15\n\n  doc.setFont('helvetica', 'normal')\n  doc.setFontSize(9)\n  doc.setDrawColor(0, 0, 0)\n\n  // Helper function to render a signature block\n  const renderSignatureBlock = (startY, label, signatureData, signerName, signerTitle, signerCompany, signedDate) => {\n    // Label\n    doc.setFont('helvetica', 'bold')\n    doc.setFontSize(8)\n    doc.text(label, margin, startY)\n    doc.setFont('helvetica', 'normal')\n    doc.setFontSize(9)\n\n    const sigLineY = startY + 20\n\n    // Signature line\n    doc.line(margin, sigLineY, margin + 70, sigLineY)\n    doc.text('Signature', margin, sigLineY + 8)\n\n    // Title/Company line\n    doc.line(margin + 85, sigLineY, margin + 145, sigLineY)\n    doc.text('Title / Company', margin + 85, sigLineY + 8)\n\n    // Date line\n    doc.line(pageWidth - margin - 40, sigLineY, pageWidth - margin, sigLineY)\n    doc.text('Date', pageWidth - margin - 40, sigLineY + 8)\n\n    // If signature exists, add it\n    if (signatureData) {\n      try {\n        doc.addImage(signatureData, 'PNG', margin, sigLineY - 18, 60, 18)\n        if (signerName) {\n          doc.setFontSize(8)\n          doc.text(signerName, margin, sigLineY + 15)\n        }\n        if (signerTitle || signerCompany) {\n          const titleCompany = [signerTitle, signerCompany].filter(Boolean).join(' - ')\n          doc.text(titleCompany, margin + 85, sigLineY - 5)\n        }\n        if (signedDate) {\n          doc.text(formatDate(signedDate), pageWidth - margin - 40, sigLineY - 5)\n        }\n      } catch (e) {\n        console.error('Error adding signature:', e)\n      }\n    } else {\n      // Show \"Awaiting Signature\" when not yet signed\n      doc.setFont('helvetica', 'italic')\n      doc.setFontSize(9)\n      doc.setTextColor(150, 150, 150)\n      doc.text('Awaiting Signature', margin + 5, sigLineY - 5)\n      doc.setTextColor(0, 0, 0)\n      doc.setFont('helvetica', 'normal')\n    }\n\n    return sigLineY + 25\n  }\n\n  // GC Signature (Signature 1)\n  yPos = renderSignatureBlock(\n    yPos,\n    'GC AUTHORIZATION',\n    cor.gc_signature_data || cor.gc_signature,\n    cor.gc_signature_name || cor.gc_signer_name,\n    cor.gc_signature_title,\n    cor.gc_signature_company,\n    cor.gc_signature_date || cor.signed_at\n  )\n\n  yPos += 10\n\n  // Client Signature (Signature 2)\n  yPos = renderSignatureBlock(\n    yPos,\n    'CLIENT AUTHORIZATION',\n    cor.client_signature_data,\n    cor.client_signature_name,\n    cor.client_signature_title,\n    cor.client_signature_company,\n    cor.client_signature_date\n  )\n\n  // ============================================\n  // T&M BACKUP SECTION (if tickets provided)\n  // Professional Layout with Cover Page\n  // ============================================\n\n  if (tmTickets && tmTickets.length > 0) {\n    // Calculate summary statistics\n    const totalLaborHours = tmTickets.reduce((sum, t) =>\n      sum + (t.t_and_m_workers?.reduce((wSum, w) => wSum + (parseFloat(w.hours) || 0), 0) || 0), 0\n    )\n    const totalOTHours = tmTickets.reduce((sum, t) =>\n      sum + (t.t_and_m_workers?.reduce((wSum, w) => wSum + (parseFloat(w.overtime_hours) || 0), 0) || 0), 0\n    )\n    const totalPhotos = tmTickets.reduce((sum, t) => sum + (t.photos?.length || 0), 0)\n    const verifiedCount = tmTickets.filter(t => t.client_signature_data).length\n    const dateRange = tmTickets.length > 0 ? {\n      start: tmTickets.reduce((min, t) => !min || t.work_date < min ? t.work_date : min, null),\n      end: tmTickets.reduce((max, t) => !max || t.work_date > max ? t.work_date : max, null)\n    } : null\n\n    // Generate document ID with secure random suffix\n    const docIdArray = new Uint8Array(3)\n    crypto.getRandomValues(docIdArray)\n    const docIdSuffix = Array.from(docIdArray, b => b.toString(36)).join('').toUpperCase().substring(0, 4)\n    const docId = `FS-${new Date().getFullYear()}-${String(new Date().getMonth() + 1).padStart(2, '0')}${String(new Date().getDate()).padStart(2, '0')}-${docIdSuffix}`\n\n    doc.addPage()\n    yPos = margin\n\n    // ============================================\n    // BACKUP COVER PAGE\n    // ============================================\n\n    // Company Logo/Name at top\n    if (logoBase64) {\n      try {\n        doc.addImage(logoBase64, 'PNG', margin, yPos, 50, 18)\n      } catch (e) {\n        doc.setFontSize(14)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(...primaryColor)\n        doc.text(company?.name || 'Company Name', margin, yPos + 10)\n      }\n    } else {\n      doc.setFontSize(14)\n      doc.setFont('helvetica', 'bold')\n      doc.setTextColor(...primaryColor)\n      doc.text(company?.name || 'Company Name', margin, yPos + 10)\n    }\n    yPos += 35\n\n    // Decorative double line\n    doc.setDrawColor(...primaryColor)\n    doc.setLineWidth(0.8)\n    doc.line(margin, yPos, pageWidth - margin, yPos)\n    doc.setLineWidth(0.3)\n    doc.line(margin, yPos + 3, pageWidth - margin, yPos + 3)\n    yPos += 15\n\n    // Title\n    doc.setFontSize(22)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(30, 41, 59)\n    doc.text('SUPPORTING DOCUMENTATION', pageWidth / 2, yPos, { align: 'center' })\n    yPos += 8\n\n    doc.setFontSize(12)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(100, 116, 139)\n    doc.text('Change Order Request Backup', pageWidth / 2, yPos, { align: 'center' })\n    yPos += 8\n\n    // Decorative double line\n    doc.setDrawColor(...primaryColor)\n    doc.setLineWidth(0.3)\n    doc.line(margin, yPos, pageWidth - margin, yPos)\n    doc.setLineWidth(0.8)\n    doc.line(margin, yPos + 3, pageWidth - margin, yPos + 3)\n    yPos += 20\n\n    // Reference info\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(30, 41, 59)\n    doc.text('COR Reference:', margin, yPos)\n    doc.setFont('helvetica', 'normal')\n    doc.text(cor.cor_number || 'N/A', margin + 35, yPos)\n\n    doc.setFont('helvetica', 'bold')\n    doc.text('Project:', pageWidth / 2, yPos)\n    doc.setFont('helvetica', 'normal')\n    doc.text(project?.name || 'N/A', pageWidth / 2 + 20, yPos)\n    yPos += 7\n\n    doc.setFont('helvetica', 'bold')\n    doc.text('Job #:', margin, yPos)\n    doc.setFont('helvetica', 'normal')\n    doc.text(project?.job_number || 'N/A', margin + 35, yPos)\n    yPos += 20\n\n    // Summary Box\n    doc.setFillColor(248, 250, 252)\n    doc.setDrawColor(203, 213, 225)\n    doc.roundedRect(margin, yPos, pageWidth - (margin * 2), 65, 4, 4, 'FD')\n\n    yPos += 10\n    doc.setFontSize(11)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(30, 41, 59)\n    doc.text('DOCUMENTATION SUMMARY', margin + 10, yPos)\n\n    doc.setDrawColor(203, 213, 225)\n    doc.setLineWidth(0.3)\n    doc.line(margin + 10, yPos + 3, margin + 80, yPos + 3)\n    yPos += 12\n\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(71, 85, 105)\n\n    const summaryCol1 = margin + 15\n    const summaryCol2 = margin + 70\n\n    doc.text('T&M Tickets:', summaryCol1, yPos)\n    doc.setFont('helvetica', 'bold')\n    doc.text(String(tmTickets.length), summaryCol2, yPos)\n    doc.setFont('helvetica', 'normal')\n    yPos += 7\n\n    doc.text('Total Labor:', summaryCol1, yPos)\n    doc.setFont('helvetica', 'bold')\n    doc.text(`${totalLaborHours.toFixed(1)} hrs`, summaryCol2, yPos)\n    doc.setFont('helvetica', 'normal')\n    yPos += 7\n\n    if (totalOTHours > 0) {\n      doc.text('Total OT:', summaryCol1, yPos)\n      doc.setFont('helvetica', 'bold')\n      doc.text(`${totalOTHours.toFixed(1)} hrs`, summaryCol2, yPos)\n      doc.setFont('helvetica', 'normal')\n      yPos += 7\n    }\n\n    doc.text('Photo Evidence:', summaryCol1, yPos)\n    doc.setFont('helvetica', 'bold')\n    doc.text(`${totalPhotos} photos`, summaryCol2, yPos)\n    doc.setFont('helvetica', 'normal')\n    yPos += 7\n\n    doc.text('Client Verified:', summaryCol1, yPos)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(verifiedCount > 0 ? 16 : 71, verifiedCount > 0 ? 185 : 85, verifiedCount > 0 ? 129 : 105)\n    doc.text(`${verifiedCount} of ${tmTickets.length} tickets`, summaryCol2, yPos)\n    doc.setTextColor(71, 85, 105)\n    doc.setFont('helvetica', 'normal')\n    yPos += 7\n\n    if (dateRange?.start && dateRange?.end) {\n      doc.text('Date Range:', summaryCol1, yPos)\n      doc.setFont('helvetica', 'bold')\n      doc.text(`${formatDate(dateRange.start)} - ${formatDate(dateRange.end)}`, summaryCol2, yPos)\n    }\n\n    yPos += 30\n\n    // Footer info\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(100, 116, 139)\n    const genDate = new Date()\n    doc.text(`Generated: ${genDate.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })} at ${genDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' })}`, margin, yPos)\n    yPos += 6\n    doc.text(`Document ID: ${docId}`, margin, yPos)\n\n    // ============================================\n    // INDIVIDUAL TICKET PAGES\n    // ============================================\n\n    for (const ticket of tmTickets) {\n      doc.addPage()\n      yPos = margin\n\n      const hasVerification = !!ticket.client_signature_data\n\n      // Ticket Header with colored left border\n      const headerHeight = 22\n      const ticketStatusColor = hasVerification ? [16, 185, 129] : (ticket.status === 'approved' ? [16, 185, 129] : [245, 158, 11])\n\n      // Colored left border\n      doc.setFillColor(...ticketStatusColor)\n      doc.rect(margin, yPos, 4, headerHeight, 'F')\n\n      // Header background\n      doc.setFillColor(248, 250, 252)\n      doc.rect(margin + 4, yPos, pageWidth - (margin * 2) - 4, headerHeight, 'F')\n\n      // Ticket title\n      doc.setFontSize(12)\n      doc.setFont('helvetica', 'bold')\n      doc.setTextColor(30, 41, 59)\n      doc.text(`T&M TICKET — ${formatDate(ticket.work_date)}`, margin + 10, yPos + 8)\n\n      // CE/PCO badge\n      if (ticket.ce_pco_number) {\n        doc.setFontSize(9)\n        doc.setFont('helvetica', 'normal')\n        doc.setTextColor(59, 130, 246)\n        doc.text(`CE/PCO: ${ticket.ce_pco_number}`, margin + 10, yPos + 16)\n      }\n\n      // Verified badge\n      if (hasVerification) {\n        doc.setFontSize(8)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(16, 185, 129)\n        doc.text('✓ CLIENT VERIFIED', pageWidth - margin - 35, yPos + 12)\n      }\n\n      yPos += headerHeight + 8\n\n      // Description/Notes\n      if (ticket.notes) {\n        doc.setFontSize(10)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(71, 85, 105)\n        doc.text('DESCRIPTION', margin, yPos)\n        yPos += 6\n\n        doc.setFontSize(9)\n        doc.setFont('helvetica', 'normal')\n        doc.setTextColor(51, 65, 85)\n        const notesLines = doc.splitTextToSize(ticket.notes, pageWidth - (margin * 2))\n        doc.text(notesLines, margin, yPos)\n        yPos += (notesLines.length * 4) + 10\n      }\n\n      // Workers table\n      if (ticket.t_and_m_workers?.length > 0) {\n        doc.setFontSize(10)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(71, 85, 105)\n        doc.text('LABOR', margin, yPos)\n        yPos += 6\n\n        autoTable(doc, {\n          startY: yPos,\n          head: [['Worker', 'Time Period', 'Class', 'Reg Hrs', 'OT Hrs']],\n          body: ticket.t_and_m_workers.map(w => [\n            w.name,\n            formatTimePeriod(w),\n            w.role || w.labor_class || 'Laborer',\n            w.hours?.toString() || '0',\n            w.overtime_hours?.toString() || '-'\n          ]),\n          margin: { left: margin, right: margin },\n          headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 8, cellPadding: 3, fontStyle: 'bold' },\n          bodyStyles: { fontSize: 8, cellPadding: 3 },\n          alternateRowStyles: { fillColor: [248, 250, 252] },\n          theme: 'grid'\n        })\n\n        yPos = doc.lastAutoTable.finalY + 10\n      }\n\n      // Items table (materials/equipment)\n      if (ticket.t_and_m_items?.length > 0) {\n        if (yPos > pageHeight - 60) {\n          doc.addPage()\n          yPos = margin\n        }\n\n        doc.setFontSize(10)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(71, 85, 105)\n        doc.text('MATERIALS / EQUIPMENT', margin, yPos)\n\n        // Source badge\n        doc.setFontSize(7)\n        doc.setFont('helvetica', 'normal')\n        doc.setTextColor(100, 116, 139)\n        doc.text('Source: T&M Ticket', margin + 55, yPos)\n        yPos += 6\n\n        autoTable(doc, {\n          startY: yPos,\n          head: [['Item', 'Qty', 'Unit', 'Unit Cost', 'Total']],\n          body: ticket.t_and_m_items.map(item => [\n            item.materials_equipment?.name || item.description || 'Item',\n            item.quantity?.toString() || '1',\n            item.materials_equipment?.unit || 'ea',\n            item.materials_equipment?.cost_per_unit ? `$${item.materials_equipment.cost_per_unit}` : '-',\n            item.materials_equipment?.cost_per_unit && item.quantity\n              ? `$${(item.quantity * item.materials_equipment.cost_per_unit).toFixed(2)}`\n              : '-'\n          ]),\n          margin: { left: margin, right: margin },\n          headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 8, cellPadding: 3, fontStyle: 'bold' },\n          bodyStyles: { fontSize: 8, cellPadding: 3 },\n          alternateRowStyles: { fillColor: [248, 250, 252] },\n          theme: 'grid'\n        })\n\n        yPos = doc.lastAutoTable.finalY + 10\n      }\n\n      // Photos - Professional Evidence Section\n      if (ticket.photos?.length > 0) {\n        if (yPos > pageHeight - 80) {\n          doc.addPage()\n          yPos = margin\n        }\n\n        doc.setFontSize(10)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(71, 85, 105)\n        doc.text('PHOTO DOCUMENTATION', margin, yPos)\n\n        // Photo count badge\n        doc.setFontSize(8)\n        doc.setFont('helvetica', 'normal')\n        doc.setTextColor(59, 130, 246)\n        doc.text(`${ticket.photos.length} photo${ticket.photos.length !== 1 ? 's' : ''}`, margin + 50, yPos)\n        yPos += 8\n\n        let xPos = margin\n        const photoWidth = 55\n        const photoHeight = 45\n        const photoGap = 6\n        const photosPerRow = 3\n        const frameWidth = 1\n\n        // Load all photos in parallel for faster PDF generation\n        const photoImages = await loadImagesAsBase64(ticket.photos)\n\n        for (let i = 0; i < ticket.photos.length; i++) {\n          // Check if we need to wrap to next row\n          if (i > 0 && i % photosPerRow === 0) {\n            xPos = margin\n            yPos += photoHeight + photoGap + 4\n          }\n\n          // Check if we need a new page\n          if (yPos + photoHeight > pageHeight - 20) {\n            doc.addPage()\n            yPos = margin\n            xPos = margin\n          }\n\n          const imgData = photoImages[i]\n          if (imgData) {\n            // Draw frame border\n            doc.setDrawColor(200, 200, 200)\n            doc.setLineWidth(frameWidth)\n            doc.rect(xPos - frameWidth, yPos - frameWidth, photoWidth + frameWidth * 2, photoHeight + frameWidth * 2, 'S')\n\n            // Add photo with shadow effect (light gray background offset)\n            doc.setFillColor(230, 230, 230)\n            doc.rect(xPos + 2, yPos + 2, photoWidth, photoHeight, 'F')\n\n            doc.addImage(imgData, 'JPEG', xPos, yPos, photoWidth, photoHeight)\n          } else {\n            // Draw placeholder for failed images\n            doc.setFillColor(245, 245, 245)\n            doc.rect(xPos, yPos, photoWidth, photoHeight, 'F')\n            doc.setDrawColor(200, 200, 200)\n            doc.rect(xPos, yPos, photoWidth, photoHeight, 'S')\n            doc.setFontSize(7)\n            doc.setTextColor(150, 150, 150)\n            doc.text('Photo unavailable', xPos + 8, yPos + photoHeight / 2)\n          }\n\n          xPos += photoWidth + photoGap\n        }\n\n        yPos += photoHeight + 12\n      }\n\n      // Client Signature Verification Block (if ticket was signed) - Professional styling\n      if (ticket.client_signature_data) {\n        if (yPos > pageHeight - 50) {\n          doc.addPage()\n          yPos = margin\n        }\n\n        // Verification block with green background\n        const verifyBlockHeight = 32\n        const verifyBlockWidth = pageWidth - (margin * 2)\n\n        // Light green background\n        doc.setFillColor(240, 253, 244) // Very light green\n        doc.roundedRect(margin, yPos, verifyBlockWidth, verifyBlockHeight, 3, 3, 'F')\n\n        // Green left accent border\n        doc.setFillColor(16, 185, 129)\n        doc.rect(margin, yPos, 4, verifyBlockHeight, 'F')\n\n        // Top border line\n        doc.setDrawColor(187, 247, 208)\n        doc.setLineWidth(0.5)\n        doc.line(margin + 4, yPos, margin + verifyBlockWidth, yPos)\n\n        // Checkmark seal icon (circle)\n        const sealX = margin + 14\n        const sealY = yPos + verifyBlockHeight / 2\n        doc.setFillColor(16, 185, 129)\n        doc.circle(sealX, sealY, 6, 'F')\n        doc.setFontSize(9)\n        doc.setTextColor(255, 255, 255)\n        doc.text('✓', sealX - 2.5, sealY + 3)\n\n        // \"CLIENT VERIFIED\" header\n        doc.setFontSize(9)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(16, 185, 129)\n        doc.text('CLIENT VERIFIED', margin + 26, yPos + 10)\n\n        try {\n          // Add signature image\n          const sigWidth = 50\n          const sigHeight = 16\n          doc.addImage(ticket.client_signature_data, 'PNG', margin + 26, yPos + 13, sigWidth, sigHeight)\n\n          // Add signer info to the right of signature\n          const signerName = ticket.client_signature_name || 'Client'\n          const signerTitle = ticket.client_signature_title || ''\n          const signerCompany = ticket.client_signature_company || ''\n          const signedDate = ticket.client_signature_date\n            ? formatDate(ticket.client_signature_date)\n            : ''\n\n          const infoX = margin + 85\n\n          doc.setFont('helvetica', 'bold')\n          doc.setFontSize(9)\n          doc.setTextColor(30, 41, 59)\n          doc.text(signerName, infoX, yPos + 12)\n\n          doc.setFont('helvetica', 'normal')\n          doc.setFontSize(8)\n          doc.setTextColor(71, 85, 105)\n          if (signerTitle || signerCompany) {\n            doc.text(`${signerTitle}${signerTitle && signerCompany ? ', ' : ''}${signerCompany}`, infoX, yPos + 18)\n          }\n          if (signedDate) {\n            doc.setTextColor(100, 116, 139)\n            doc.text(`Verified: ${signedDate}`, infoX, yPos + 24)\n          }\n        } catch (e) {\n          // If signature image fails, show text info\n          const signerName = ticket.client_signature_name || 'Client'\n          doc.setFont('helvetica', 'normal')\n          doc.setFontSize(9)\n          doc.setTextColor(30, 41, 59)\n          doc.text(`Signed by: ${signerName}`, margin + 26, yPos + 20)\n        }\n\n        yPos += verifyBlockHeight + 8\n      }\n\n      // Ticket divider\n      yPos += 5\n      doc.setDrawColor(200, 200, 200)\n      doc.setLineWidth(0.2)\n      doc.line(margin, yPos, pageWidth - margin, yPos)\n      yPos += 10\n    }\n  }\n\n  // ============================================\n  // FOOTER (on all pages)\n  // ============================================\n\n  const totalPages = doc.internal.getNumberOfPages()\n  for (let i = 1; i <= totalPages; i++) {\n    doc.setPage(i)\n    const footerY = pageHeight - 10\n    doc.setFontSize(8)\n    doc.setTextColor(150, 150, 150)\n    doc.text(`Generated on ${new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`, margin, footerY)\n    doc.text(`Page ${i} of ${totalPages}`, pageWidth - margin, footerY, { align: 'right' })\n  }\n\n  // Save the PDF\n  const fileName = `${cor.cor_number || 'COR'}_${project?.job_number || 'export'}${tmTickets?.length ? '_with_backup' : ''}.pdf`\n  doc.save(fileName)\n\n  // Build export result\n  const result = {\n    success: true,\n    fileName,\n    exportedAt: new Date().toISOString(),\n    photoManifest\n  }\n\n  // Create snapshot for dispute-ready export (if requested)\n  if (createSnapshot) {\n    result.snapshot = createExportSnapshot(cor, tmTickets, photoManifest, totals)\n  }\n\n  return result\n}\n\n/**\n * Export a single T&M ticket to PDF\n * @param {Object} ticket - T&M ticket data\n * @param {Object} project - Project data\n * @param {Object} company - Company data\n * @param {Object} branding - Company branding (logoUrl, primaryColor)\n */\nexport async function exportTMTicketToPDF(ticket, project, company, branding = {}) {\n  const doc = new jsPDF('p', 'mm', 'letter')\n  const pageWidth = doc.internal.pageSize.getWidth()\n  const pageHeight = doc.internal.pageSize.getHeight()\n  const margin = 20\n  let yPos = margin\n\n  const primaryColor = branding.primaryColor\n    ? hexToRgb(branding.primaryColor)\n    : [30, 58, 95]\n\n  // ============================================\n  // HEADER\n  // ============================================\n\n  // Company info or logo\n  if (branding.logoUrl) {\n    try {\n      const logoData = await loadImageAsBase64(branding.logoUrl)\n      if (logoData) {\n        doc.addImage(logoData, 'PNG', margin, yPos, 40, 15)\n      }\n    } catch (e) {\n      // Fall back to company name\n      if (company?.name) {\n        doc.setFontSize(14)\n        doc.setFont('helvetica', 'bold')\n        doc.setTextColor(...primaryColor)\n        doc.text(company.name, margin, yPos + 8)\n      }\n    }\n  } else if (company?.name) {\n    doc.setFontSize(14)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(...primaryColor)\n    doc.text(company.name, margin, yPos + 8)\n  }\n\n  // T&M Ticket title\n  doc.setFontSize(16)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(30, 41, 59)\n  doc.text('T&M TICKET', pageWidth - margin, yPos + 8, { align: 'right' })\n\n  yPos += 25\n\n  // Divider line\n  doc.setDrawColor(...primaryColor)\n  doc.setLineWidth(0.5)\n  doc.line(margin, yPos, pageWidth - margin, yPos)\n  yPos += 10\n\n  // ============================================\n  // TICKET INFO\n  // ============================================\n\n  const hasVerification = !!ticket.client_signature_data\n\n  // Status indicator\n  if (hasVerification) {\n    doc.setFillColor(240, 253, 244)\n    doc.roundedRect(pageWidth - margin - 45, yPos - 5, 45, 12, 2, 2, 'F')\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(16, 185, 129)\n    doc.text('✓ CLIENT VERIFIED', pageWidth - margin - 42, yPos + 3)\n  }\n\n  // Project and date info\n  doc.setFontSize(10)\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(71, 85, 105)\n  doc.text('Project:', margin, yPos)\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(30, 41, 59)\n  doc.text(project?.name || 'N/A', margin + 20, yPos)\n  yPos += 6\n\n  if (project?.job_number) {\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(71, 85, 105)\n    doc.text('Job #:', margin, yPos)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(30, 41, 59)\n    doc.text(project.job_number, margin + 20, yPos)\n    yPos += 6\n  }\n\n  doc.setFont('helvetica', 'bold')\n  doc.setTextColor(71, 85, 105)\n  doc.text('Work Date:', margin, yPos)\n  doc.setFont('helvetica', 'normal')\n  doc.setTextColor(30, 41, 59)\n  doc.text(formatDate(ticket.work_date || ticket.ticket_date), margin + 26, yPos)\n\n  if (ticket.ce_pco_number) {\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(71, 85, 105)\n    doc.text('CE/PCO:', margin + 70, yPos)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(59, 130, 246)\n    doc.text(ticket.ce_pco_number, margin + 88, yPos)\n  }\n\n  yPos += 12\n\n  // Description/Notes\n  if (ticket.notes) {\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(71, 85, 105)\n    doc.text('DESCRIPTION', margin, yPos)\n    yPos += 6\n\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(51, 65, 85)\n    const notesLines = doc.splitTextToSize(ticket.notes, pageWidth - (margin * 2))\n    doc.text(notesLines, margin, yPos)\n    yPos += (notesLines.length * 4) + 10\n  }\n\n  // ============================================\n  // LABOR TABLE\n  // ============================================\n\n  if (ticket.t_and_m_workers?.length > 0) {\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(71, 85, 105)\n    doc.text('LABOR', margin, yPos)\n    yPos += 6\n\n    autoTable(doc, {\n      startY: yPos,\n      head: [['Worker', 'Time Period', 'Class', 'Reg Hrs', 'OT Hrs']],\n      body: ticket.t_and_m_workers.map(w => [\n        w.name,\n        formatTimePeriod(w),\n        w.role || w.labor_class || 'Laborer',\n        w.hours?.toString() || '0',\n        w.overtime_hours?.toString() || '-'\n      ]),\n      margin: { left: margin, right: margin },\n      headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 8, cellPadding: 3, fontStyle: 'bold' },\n      bodyStyles: { fontSize: 8, cellPadding: 3 },\n      alternateRowStyles: { fillColor: [248, 250, 252] },\n      theme: 'grid'\n    })\n\n    yPos = doc.lastAutoTable.finalY + 10\n  }\n\n  // ============================================\n  // MATERIALS/EQUIPMENT\n  // ============================================\n\n  const materials = ticket.t_and_m_items || ticket.materials_equipment?.filter(m => m.type === 'material') || []\n  if (materials.length > 0) {\n    if (yPos > pageHeight - 60) {\n      doc.addPage()\n      yPos = margin\n    }\n\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(71, 85, 105)\n    doc.text('MATERIALS / EQUIPMENT', margin, yPos)\n    yPos += 6\n\n    autoTable(doc, {\n      startY: yPos,\n      head: [['Item', 'Qty', 'Unit']],\n      body: materials.map(item => [\n        item.materials_equipment?.name || item.description || item.name || 'Item',\n        item.quantity?.toString() || '1',\n        item.materials_equipment?.unit || item.unit || 'ea'\n      ]),\n      margin: { left: margin, right: margin },\n      headStyles: { fillColor: primaryColor, textColor: [255, 255, 255], fontSize: 8, cellPadding: 3, fontStyle: 'bold' },\n      bodyStyles: { fontSize: 8, cellPadding: 3 },\n      alternateRowStyles: { fillColor: [248, 250, 252] },\n      theme: 'grid'\n    })\n\n    yPos = doc.lastAutoTable.finalY + 10\n  }\n\n  // ============================================\n  // PHOTOS\n  // ============================================\n\n  if (ticket.photos?.length > 0) {\n    if (yPos > pageHeight - 80) {\n      doc.addPage()\n      yPos = margin\n    }\n\n    doc.setFontSize(10)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(71, 85, 105)\n    doc.text('PHOTO DOCUMENTATION', margin, yPos)\n\n    doc.setFontSize(8)\n    doc.setFont('helvetica', 'normal')\n    doc.setTextColor(59, 130, 246)\n    doc.text(`${ticket.photos.length} photo${ticket.photos.length !== 1 ? 's' : ''}`, margin + 50, yPos)\n    yPos += 8\n\n    let xPos = margin\n    const photoWidth = 55\n    const photoHeight = 45\n    const photoGap = 6\n    const photosPerRow = 3\n\n    // Load all photos in parallel for faster PDF generation\n    const photoImages = await loadImagesAsBase64(ticket.photos)\n\n    for (let i = 0; i < ticket.photos.length; i++) {\n      if (i > 0 && i % photosPerRow === 0) {\n        xPos = margin\n        yPos += photoHeight + photoGap + 4\n      }\n\n      if (yPos + photoHeight > pageHeight - 20) {\n        doc.addPage()\n        yPos = margin\n        xPos = margin\n      }\n\n      const imgData = photoImages[i]\n      if (imgData) {\n        doc.setDrawColor(200, 200, 200)\n        doc.setLineWidth(1)\n        doc.rect(xPos - 1, yPos - 1, photoWidth + 2, photoHeight + 2, 'S')\n        doc.setFillColor(230, 230, 230)\n        doc.rect(xPos + 2, yPos + 2, photoWidth, photoHeight, 'F')\n        doc.addImage(imgData, 'JPEG', xPos, yPos, photoWidth, photoHeight)\n      } else {\n        doc.setFillColor(245, 245, 245)\n        doc.rect(xPos, yPos, photoWidth, photoHeight, 'F')\n        doc.setDrawColor(200, 200, 200)\n        doc.rect(xPos, yPos, photoWidth, photoHeight, 'S')\n        doc.setFontSize(7)\n        doc.setTextColor(150, 150, 150)\n        doc.text('Photo unavailable', xPos + 8, yPos + photoHeight / 2)\n      }\n\n      xPos += photoWidth + photoGap\n    }\n\n    yPos += photoHeight + 12\n  }\n\n  // ============================================\n  // CLIENT VERIFICATION\n  // ============================================\n\n  if (ticket.client_signature_data) {\n    if (yPos > pageHeight - 50) {\n      doc.addPage()\n      yPos = margin\n    }\n\n    const verifyBlockHeight = 32\n    const verifyBlockWidth = pageWidth - (margin * 2)\n\n    doc.setFillColor(240, 253, 244)\n    doc.roundedRect(margin, yPos, verifyBlockWidth, verifyBlockHeight, 3, 3, 'F')\n\n    doc.setFillColor(16, 185, 129)\n    doc.rect(margin, yPos, 4, verifyBlockHeight, 'F')\n\n    doc.setDrawColor(187, 247, 208)\n    doc.setLineWidth(0.5)\n    doc.line(margin + 4, yPos, margin + verifyBlockWidth, yPos)\n\n    const sealX = margin + 14\n    const sealY = yPos + verifyBlockHeight / 2\n    doc.setFillColor(16, 185, 129)\n    doc.circle(sealX, sealY, 6, 'F')\n    doc.setFontSize(9)\n    doc.setTextColor(255, 255, 255)\n    doc.text('✓', sealX - 2.5, sealY + 3)\n\n    doc.setFontSize(9)\n    doc.setFont('helvetica', 'bold')\n    doc.setTextColor(16, 185, 129)\n    doc.text('CLIENT VERIFIED', margin + 26, yPos + 10)\n\n    try {\n      const sigWidth = 50\n      const sigHeight = 16\n      doc.addImage(ticket.client_signature_data, 'PNG', margin + 26, yPos + 13, sigWidth, sigHeight)\n\n      const signerName = ticket.client_signature_name || 'Client'\n      const signerTitle = ticket.client_signature_title || ''\n      const signerCompany = ticket.client_signature_company || ''\n      const signedDate = ticket.client_signature_date\n        ? formatDate(ticket.client_signature_date)\n        : ''\n\n      const infoX = margin + 85\n\n      doc.setFont('helvetica', 'bold')\n      doc.setFontSize(9)\n      doc.setTextColor(30, 41, 59)\n      doc.text(signerName, infoX, yPos + 12)\n\n      doc.setFont('helvetica', 'normal')\n      doc.setFontSize(8)\n      doc.setTextColor(71, 85, 105)\n      if (signerTitle || signerCompany) {\n        doc.text(`${signerTitle}${signerTitle && signerCompany ? ', ' : ''}${signerCompany}`, infoX, yPos + 18)\n      }\n      if (signedDate) {\n        doc.setTextColor(100, 116, 139)\n        doc.text(`Verified: ${signedDate}`, infoX, yPos + 24)\n      }\n    } catch (e) {\n      const signerName = ticket.client_signature_name || 'Client'\n      doc.setFont('helvetica', 'normal')\n      doc.setFontSize(9)\n      doc.setTextColor(30, 41, 59)\n      doc.text(`Signed by: ${signerName}`, margin + 26, yPos + 20)\n    }\n\n    yPos += verifyBlockHeight + 8\n  }\n\n  // ============================================\n  // FOOTER\n  // ============================================\n\n  const totalPages = doc.internal.getNumberOfPages()\n  for (let i = 1; i <= totalPages; i++) {\n    doc.setPage(i)\n    const footerY = pageHeight - 10\n    doc.setFontSize(8)\n    doc.setTextColor(150, 150, 150)\n    doc.text(`Generated on ${new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`, margin, footerY)\n    doc.text(`Page ${i} of ${totalPages}`, pageWidth - margin, footerY, { align: 'right' })\n  }\n\n  // Save the PDF\n  const ticketDate = formatDate(ticket.work_date || ticket.ticket_date).replace(/\\//g, '-')\n  const fileName = `TM_Ticket_${ticketDate}${ticket.ce_pco_number ? '_' + ticket.ce_pco_number : ''}.pdf`\n  doc.save(fileName)\n\n  return { success: true, fileName }\n}\n","import { useState, useEffect, useMemo } from 'react'\nimport { FileText, CheckCircle, Clock, AlertCircle, Building2, Users, Package, Truck, Briefcase, Download, Camera, HardHat, ChevronDown, ChevronRight, Calendar } from 'lucide-react'\nimport { db } from '../lib/supabase'\nimport { calculateCORTotals, formatCurrency, formatPercent, centsToDollars, formatDateRange } from '../lib/corCalculations'\nimport { exportCORToPDF, exportTMTicketToPDF } from '../lib/corPdfExport'\nimport SignatureCanvas from './ui/SignatureCanvas'\n\n// Helper to format date\nconst formatDate = (dateString) => {\n  if (!dateString) return ''\n  return new Date(dateString).toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric'\n  })\n}\n\n// Helper to format time (HH:MM or HH:MM:SS to 9:00am format)\nconst formatTime = (timeStr) => {\n  if (!timeStr) return ''\n  const [hours, minutes] = timeStr.split(':')\n  const h = parseInt(hours)\n  const ampm = h >= 12 ? 'pm' : 'am'\n  const h12 = h % 12 || 12\n  return `${h12}:${minutes}${ampm}`\n}\n\n// Status badge component\nconst StatusBadge = ({ status }) => {\n  const statusMap = {\n    draft: { label: 'Draft', color: '#6b7280', bg: '#f3f4f6' },\n    pending_approval: { label: 'Pending Approval', color: '#d97706', bg: '#fef3c7' },\n    approved: { label: 'Approved', color: '#059669', bg: '#d1fae5' },\n    rejected: { label: 'Rejected', color: '#dc2626', bg: '#fee2e2' },\n    billed: { label: 'Billed', color: '#2563eb', bg: '#dbeafe' },\n    closed: { label: 'Closed', color: '#4b5563', bg: '#e5e7eb' }\n  }\n  const info = statusMap[status] || statusMap.draft\n  return (\n    <span\n      className=\"cor-status-badge\"\n      style={{ color: info.color, backgroundColor: info.bg }}\n    >\n      {info.label}\n    </span>\n  )\n}\n\nexport default function SignaturePage({ signatureToken }) {\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState(null)\n  const [signatureRequest, setSignatureRequest] = useState(null)\n  const [document, setDocument] = useState(null)\n  const [showSignatureModal, setShowSignatureModal] = useState(false)\n  const [activeSlot, setActiveSlot] = useState(null)\n  const [submitting, setSubmitting] = useState(false)\n  const [successMessage, setSuccessMessage] = useState(null)\n  const [downloading, setDownloading] = useState(false)\n\n  // T&M backup documentation state\n  const [backupTickets, setBackupTickets] = useState([])\n  const [backupExpanded, setBackupExpanded] = useState(false)\n  const [expandedTickets, setExpandedTickets] = useState(new Set())\n\n  // Load signature request and document\n  useEffect(() => {\n    loadData()\n  }, [signatureToken])\n\n  const loadData = async () => {\n    try {\n      setLoading(true)\n      setError(null)\n\n      // Get signature request by token\n      const request = await db.getSignatureRequestByToken(signatureToken)\n      if (!request) {\n        setError('This signature link is invalid or has expired.')\n        return\n      }\n\n      if (request.status === 'completed') {\n        setError('This document has already been fully signed.')\n        return\n      }\n\n      if (request.status === 'revoked') {\n        setError('This signature link has been revoked.')\n        return\n      }\n\n      if (request.status === 'expired') {\n        setError('This signature link has expired.')\n        return\n      }\n\n      setSignatureRequest(request)\n\n      // Get the document data\n      const docData = await db.getDocumentForSigning(request.document_type, request.document_id)\n      if (!docData) {\n        setError('The document associated with this link could not be found.')\n        return\n      }\n\n      setDocument(docData)\n\n      // Load T&M backup tickets if this is a COR\n      if (request.document_type === 'cor' && docData?.id) {\n        try {\n          const tickets = await db.getCORTickets(docData.id)\n          // Resolve ticket photos to signed URLs in one batch (bucket is private)\n          if (tickets?.length) {\n            const photoGroups = tickets.map(t => t.photos || [])\n            const allPhotos = photoGroups.flat()\n            if (allPhotos.length) {\n              const signed = await db.resolvePhotoUrls(allPhotos)\n              let offset = 0\n              const resolved = tickets.map((t, i) => {\n                const len = photoGroups[i].length\n                const photos = signed.slice(offset, offset + len)\n                offset += len\n                return { ...t, photos }\n              })\n              setBackupTickets(resolved)\n            } else {\n              setBackupTickets(tickets)\n            }\n          } else {\n            setBackupTickets(tickets || [])\n          }\n        } catch (err) {\n          console.warn('Failed to load backup tickets:', err)\n        }\n      }\n    } catch (err) {\n      console.error('Error loading signature data:', err)\n      setError('Unable to load signature request. Please try again.')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  // Calculate COR totals\n  const totals = useMemo(() => {\n    if (!document || signatureRequest?.document_type !== 'cor') return null\n    return calculateCORTotals(document)\n  }, [document, signatureRequest])\n\n  // Get available signature slots\n  const getSignatureStatus = () => {\n    if (!signatureRequest) return { slot1: null, slot2: null, availableSlots: [] }\n\n    const signatures = signatureRequest.signatures || []\n    const slot1 = signatures.find(s => s.signature_slot === 1)\n    const slot2 = signatures.find(s => s.signature_slot === 2)\n    const availableSlots = []\n    if (!slot1) availableSlots.push(1)\n    if (!slot2) availableSlots.push(2)\n\n    return { slot1, slot2, availableSlots }\n  }\n\n  // Get client IP address\n  const getClientIP = async () => {\n    try {\n      const response = await fetch('https://api.ipify.org?format=json')\n      const data = await response.json()\n      return data.ip\n    } catch {\n      return null\n    }\n  }\n\n  // Handle signature submission\n  const handleSignatureSubmit = async (signatureData) => {\n    if (!signatureRequest || !activeSlot) return\n\n    try {\n      setSubmitting(true)\n\n      // Get IP address\n      const ipAddress = await getClientIP()\n\n      // Add signature\n      const signature = await db.addSignature(signatureRequest.id, activeSlot, {\n        ...signatureData,\n        ipAddress,\n        userAgent: navigator.userAgent\n      })\n\n      // Sync signature to main document table\n      await db.syncSignatureToDocument(signature, signatureRequest)\n\n      // Reload data to get updated status\n      await loadData()\n\n      setShowSignatureModal(false)\n      setActiveSlot(null)\n      // Show persistent signed confirmation (don't auto-clear)\n      setSuccessMessage('signed')\n    } catch (err) {\n      console.error('Error submitting signature:', err)\n      setError('Failed to submit signature. Please try again.')\n    } finally {\n      setSubmitting(false)\n    }\n  }\n\n  // Open signature modal for a specific slot\n  const openSignatureModal = (slot) => {\n    setActiveSlot(slot)\n    setShowSignatureModal(true)\n  }\n\n  // Handle PDF download with T&M backup\n  const handleDownload = async () => {\n    if (!document || !signatureRequest) return\n\n    try {\n      setDownloading(true)\n\n      // Fetch associated T&M tickets if this is a COR\n      let tmTickets = null\n      if (isCOR) {\n        try {\n          tmTickets = await db.getCORTickets(document.id)\n        } catch (err) {\n          console.warn('Failed to fetch T&M tickets for backup:', err)\n          // Continue without T&M backup\n        }\n      }\n\n      // Get branding from company\n      const branding = {\n        logoUrl: company?.logo_url,\n        primaryColor: company?.branding_color\n      }\n\n      // Export PDF with T&M backup\n      await exportCORToPDF(document, project, company, branding, tmTickets)\n\n      setSuccessMessage('PDF downloaded successfully!')\n      setTimeout(() => setSuccessMessage(null), 3000)\n    } catch (err) {\n      console.error('Download failed:', err)\n      setError('Failed to generate PDF. Please try again.')\n    } finally {\n      setDownloading(false)\n    }\n  }\n\n  // Handle T&M Ticket PDF download\n  const handleDownloadTMTicket = async () => {\n    if (!document || !signatureRequest) return\n\n    try {\n      setDownloading(true)\n\n      const company = document?.projects?.companies\n      const project = document?.projects\n\n      // Get branding from company\n      const branding = {\n        logoUrl: company?.logo_url,\n        primaryColor: company?.branding_color\n      }\n\n      // Export T&M Ticket PDF\n      await exportTMTicketToPDF(document, project, company, branding)\n\n      setSuccessMessage('PDF downloaded successfully!')\n      setTimeout(() => setSuccessMessage(null), 3000)\n    } catch (err) {\n      console.error('Download failed:', err)\n      setError('Failed to generate PDF. Please try again.')\n    } finally {\n      setDownloading(false)\n    }\n  }\n\n  // Render loading state\n  if (loading) {\n    return (\n      <div className=\"signature-page\">\n        <div className=\"signature-page-loading\">\n          <div className=\"loading-spinner\"></div>\n          <p>Loading document...</p>\n        </div>\n      </div>\n    )\n  }\n\n  // Render error state\n  if (error) {\n    return (\n      <div className=\"signature-page\">\n        <div className=\"signature-page-error\">\n          <AlertCircle size={48} />\n          <h2>Unable to Load Document</h2>\n          <p>{error}</p>\n        </div>\n      </div>\n    )\n  }\n\n  const { slot1, slot2, availableSlots } = getSignatureStatus()\n  // Only one signature is required - either slot1 OR slot2\n  const isFullySigned = slot1 || slot2\n  const isCOR = signatureRequest?.document_type === 'cor'\n  const company = document?.projects?.companies\n  const project = document?.projects\n\n  // Render T&M ticket (simpler view)\n  if (!isCOR) {\n    const workerCount = document.t_and_m_workers?.length || 0\n    const totalHours = document.t_and_m_workers?.reduce((sum, w) => sum + (w.hours || 0), 0) || 0\n\n    return (\n      <div className=\"signature-page\">\n        <header className=\"signature-page-header\">\n          {company?.logo_url ? (\n            <img src={company.logo_url} alt={company.name} className=\"company-logo\" />\n          ) : (\n            <div className=\"company-logo-placeholder\">\n              <Building2 size={24} />\n            </div>\n          )}\n          <div className=\"company-info\">\n            <h1>{company?.name || 'FieldSync'}</h1>\n            <span className=\"doc-type-label\">T&M Ticket Signature</span>\n          </div>\n        </header>\n\n        {successMessage === 'signed' && (\n          <div className=\"signature-signed-overlay\">\n            <div className=\"signature-signed-content\">\n              <CheckCircle size={48} />\n              <h2>Document Signed Successfully</h2>\n              <p>This document has been signed and submitted.</p>\n              <button\n                className=\"btn btn-primary download-copy-btn\"\n                onClick={handleDownloadTMTicket}\n                disabled={downloading}\n              >\n                {downloading ? (\n                  <>\n                    <span className=\"btn-spinner\"></span>\n                    Generating PDF...\n                  </>\n                ) : (\n                  <>\n                    <Download size={18} />\n                    Save a Copy for Your Records\n                  </>\n                )}\n              </button>\n              <p className=\"close-prompt\">You may close this page when done.</p>\n            </div>\n          </div>\n        )}\n\n        <main className=\"signature-page-content\">\n          <div className=\"signature-document-card\">\n            <div className=\"document-card-header\">\n              <FileText size={20} />\n              <div className=\"document-card-title\">\n                <h2>T&M Ticket</h2>\n                <span className=\"document-subtitle\">\n                  {document.ce_pco_number ? `CE/PCO: ${document.ce_pco_number}` : 'Time & Materials'}\n                </span>\n              </div>\n            </div>\n\n            <div className=\"document-card-details\">\n              <div className=\"detail-row\">\n                <span className=\"detail-label\">Project</span>\n                <span className=\"detail-value\">{project?.name}</span>\n              </div>\n              <div className=\"detail-row\">\n                <span className=\"detail-label\">Work Date</span>\n                <span className=\"detail-value\">{formatDate(document.work_date)}</span>\n              </div>\n              <div className=\"detail-row\">\n                <span className=\"detail-label\">Workers</span>\n                <span className=\"detail-value\">{workerCount} ({totalHours} hrs)</span>\n              </div>\n              {document.notes && (\n                <div className=\"detail-row full-width\">\n                  <span className=\"detail-label\">Description</span>\n                  <span className=\"detail-value\">{document.notes}</span>\n                </div>\n              )}\n            </div>\n\n            {/* Full Ticket Details - Workers */}\n            {document.t_and_m_workers?.length > 0 && (\n              <div className=\"signature-detail-section\">\n                <h4><HardHat size={16} /> Workers</h4>\n                <table className=\"signature-detail-table\">\n                  <thead>\n                    <tr>\n                      <th>Name</th>\n                      <th>Role</th>\n                      <th>Time</th>\n                      <th>Reg Hrs</th>\n                      <th>OT</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {document.t_and_m_workers.map((w, idx) => (\n                      <tr key={idx}>\n                        <td>{w.name}</td>\n                        <td>{w.role || 'Laborer'}</td>\n                        <td>\n                          {w.time_started && w.time_ended\n                            ? `${formatTime(w.time_started)} - ${formatTime(w.time_ended)}`\n                            : '-'}\n                        </td>\n                        <td>{w.hours || 0}</td>\n                        <td>{w.overtime_hours || '-'}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            )}\n\n            {/* Full Ticket Details - Materials/Equipment */}\n            {document.t_and_m_items?.length > 0 && (\n              <div className=\"signature-detail-section\">\n                <h4><Package size={16} /> Materials & Equipment</h4>\n                <table className=\"signature-detail-table\">\n                  <thead>\n                    <tr>\n                      <th>Item</th>\n                      <th>Qty</th>\n                      <th>Unit</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {document.t_and_m_items.map((item, idx) => (\n                      <tr key={idx}>\n                        <td>{item.custom_name || item.materials_equipment?.name || 'Item'}</td>\n                        <td>{item.quantity}</td>\n                        <td>{item.materials_equipment?.unit || 'each'}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            )}\n\n            {/* Full Ticket Details - Photos */}\n            {document.photos?.length > 0 && (\n              <div className=\"signature-detail-section\">\n                <h4><Camera size={16} /> Photos ({document.photos.length})</h4>\n                <div className=\"signature-photo-grid\">\n                  {document.photos.map((photo, idx) => (\n                    <div key={idx} className=\"signature-photo-thumb\">\n                      <img\n                        src={typeof photo === 'string' ? photo : photo.url}\n                        alt={`Photo ${idx + 1}`}\n                        onError={(e) => { e.target.style.display = 'none' }}\n                      />\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* Signature section */}\n          <div className=\"signature-status-section\">\n            <h3>Signature</h3>\n            {!isFullySigned ? (\n              <>\n                {renderSignatureSlot(1, slot1, 'GC Authorization', openSignatureModal, submitting)}\n                {!slot1 && <p className=\"or-divider\">— or —</p>}\n                {renderSignatureSlot(2, slot2, 'Client Authorization', openSignatureModal, submitting)}\n              </>\n            ) : (\n              <>\n                {slot1 && renderSignatureSlot(1, slot1, 'GC Authorization', openSignatureModal, submitting)}\n                {slot2 && renderSignatureSlot(2, slot2, 'Client Authorization', openSignatureModal, submitting)}\n              </>\n            )}\n            {isFullySigned && (\n              <div className=\"fully-signed-message\">\n                <CheckCircle size={24} />\n                <p>This document has been signed.</p>\n              </div>\n            )}\n          </div>\n        </main>\n\n        <footer className=\"signature-page-footer\">\n          <p>Powered by FieldSync</p>\n        </footer>\n\n        {showSignatureModal && activeSlot && (\n          <SignatureCanvas\n            enhanced\n            requireAcknowledgment\n            lockBodyScroll\n            slot={activeSlot}\n            documentType=\"tm_ticket\"\n            documentTitle=\"T&M Ticket\"\n            onSave={handleSignatureSubmit}\n            onClose={() => {\n              setShowSignatureModal(false)\n              setActiveSlot(null)\n            }}\n          />\n        )}\n      </div>\n    )\n  }\n\n  // Render full COR document\n  return (\n    <div className=\"signature-page\">\n      {/* Header with company branding */}\n      <header className=\"signature-page-header\">\n        {company?.logo_url ? (\n          <img src={company.logo_url} alt={company.name} className=\"company-logo\" />\n        ) : (\n          <div className=\"company-logo-placeholder\">\n            <Building2 size={24} />\n          </div>\n        )}\n        <div className=\"company-info\">\n          <h1>{company?.name || 'FieldSync'}</h1>\n          <span className=\"doc-type-label\">Change Order Request</span>\n        </div>\n      </header>\n\n      {/* Success message - persistent signed confirmation */}\n      {successMessage === 'signed' && (\n        <div className=\"signature-signed-overlay\">\n          <div className=\"signature-signed-content\">\n            <CheckCircle size={48} />\n            <h2>Document Signed Successfully</h2>\n            <p>This document has been signed and submitted.</p>\n            <button\n              className=\"btn btn-primary download-copy-btn\"\n              onClick={handleDownload}\n              disabled={downloading}\n            >\n              {downloading ? (\n                <>\n                  <span className=\"btn-spinner\"></span>\n                  Generating PDF...\n                </>\n              ) : (\n                <>\n                  <Download size={18} />\n                  Save a Copy for Your Records\n                </>\n              )}\n            </button>\n            <p className=\"close-prompt\">You may close this page when done.</p>\n          </div>\n        </div>\n      )}\n\n      {/* Main COR Document */}\n      <main className=\"signature-page-content cor-full-document\">\n        {/* COR Header Card */}\n        <div className=\"cor-header-card\">\n          <div className=\"cor-header-top\">\n            <div className=\"cor-title-section\">\n              <h2 className=\"cor-number\">{document.cor_number}</h2>\n              <StatusBadge status={document.status} />\n            </div>\n            <div className=\"cor-date\">\n              Created {formatDate(document.created_at)}\n            </div>\n          </div>\n\n          <h3 className=\"cor-title\">{document.title || 'Untitled Change Order'}</h3>\n\n          <div className=\"cor-info-grid\">\n            <div className=\"cor-info-item\">\n              <span className=\"cor-info-label\">Project</span>\n              <span className=\"cor-info-value\">{project?.name}</span>\n            </div>\n            {project?.job_number && (\n              <div className=\"cor-info-item\">\n                <span className=\"cor-info-label\">Job #</span>\n                <span className=\"cor-info-value\">{project.job_number}</span>\n              </div>\n            )}\n            <div className=\"cor-info-item\">\n              <span className=\"cor-info-label\">Period</span>\n              <span className=\"cor-info-value\">{formatDateRange(document.period_start, document.period_end)}</span>\n            </div>\n          </div>\n\n          {document.scope_of_work && (\n            <div className=\"cor-scope\">\n              <h4>Scope of Work</h4>\n              <p>{document.scope_of_work}</p>\n            </div>\n          )}\n        </div>\n\n        {/* Labor Section */}\n        {document.change_order_labor?.length > 0 && (\n          <div className=\"cor-section\">\n            <div className=\"cor-section-header\">\n              <Users size={18} />\n              <h4>Labor</h4>\n            </div>\n            <div className=\"cor-table-wrapper\">\n              <table className=\"cor-line-items-table\">\n                <thead>\n                  <tr>\n                    <th>Class</th>\n                    <th>Type</th>\n                    <th className=\"text-right\">Reg Hrs</th>\n                    <th className=\"text-right\">Reg Rate</th>\n                    <th className=\"text-right\">OT Hrs</th>\n                    <th className=\"text-right\">OT Rate</th>\n                    <th className=\"text-right\">Total</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {document.change_order_labor.map((item, idx) => (\n                    <tr key={idx}>\n                      <td>{item.labor_class}</td>\n                      <td>{item.wage_type}</td>\n                      <td className=\"text-right\">{item.regular_hours}</td>\n                      <td className=\"text-right\">${centsToDollars(item.regular_rate)}/hr</td>\n                      <td className=\"text-right\">{item.overtime_hours || '-'}</td>\n                      <td className=\"text-right\">{item.overtime_hours ? `$${centsToDollars(item.overtime_rate)}/hr` : '-'}</td>\n                      <td className=\"text-right\">{formatCurrency(item.total)}</td>\n                    </tr>\n                  ))}\n                </tbody>\n                <tfoot>\n                  <tr>\n                    <td colSpan=\"5\" className=\"text-right\">Subtotal:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.labor_subtotal)}</td>\n                  </tr>\n                  <tr className=\"markup-row\">\n                    <td colSpan=\"5\" className=\"text-right\">+ {formatPercent(document.labor_markup_percent || 1500)} Markup:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.labor_markup_amount)}</td>\n                  </tr>\n                  <tr className=\"section-total-row\">\n                    <td colSpan=\"5\" className=\"text-right\"><strong>Labor Total:</strong></td>\n                    <td className=\"text-right\" colSpan=\"2\"><strong>{formatCurrency(totals.labor_subtotal + totals.labor_markup_amount)}</strong></td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n          </div>\n        )}\n\n        {/* Materials Section */}\n        {document.change_order_materials?.length > 0 && (\n          <div className=\"cor-section\">\n            <div className=\"cor-section-header\">\n              <Package size={18} />\n              <h4>Materials</h4>\n            </div>\n            <div className=\"cor-table-wrapper\">\n              <table className=\"cor-line-items-table\">\n                <thead>\n                  <tr>\n                    <th>Description</th>\n                    <th>Source</th>\n                    <th className=\"text-right\">Qty</th>\n                    <th>Unit</th>\n                    <th className=\"text-right\">Unit Cost</th>\n                    <th className=\"text-right\">Total</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {document.change_order_materials.map((item, idx) => (\n                    <tr key={idx}>\n                      <td>{item.description}</td>\n                      <td>{item.source_reference || item.source_type}</td>\n                      <td className=\"text-right\">{item.quantity}</td>\n                      <td>{item.unit}</td>\n                      <td className=\"text-right\">${centsToDollars(item.unit_cost)}</td>\n                      <td className=\"text-right\">{formatCurrency(item.total)}</td>\n                    </tr>\n                  ))}\n                </tbody>\n                <tfoot>\n                  <tr>\n                    <td colSpan=\"4\" className=\"text-right\">Subtotal:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.materials_subtotal)}</td>\n                  </tr>\n                  <tr className=\"markup-row\">\n                    <td colSpan=\"4\" className=\"text-right\">+ {formatPercent(document.materials_markup_percent || 1500)} Markup:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.materials_markup_amount)}</td>\n                  </tr>\n                  <tr className=\"section-total-row\">\n                    <td colSpan=\"4\" className=\"text-right\"><strong>Materials Total:</strong></td>\n                    <td className=\"text-right\" colSpan=\"2\"><strong>{formatCurrency(totals.materials_subtotal + totals.materials_markup_amount)}</strong></td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n          </div>\n        )}\n\n        {/* Equipment Section */}\n        {document.change_order_equipment?.length > 0 && (\n          <div className=\"cor-section\">\n            <div className=\"cor-section-header\">\n              <Truck size={18} />\n              <h4>Equipment</h4>\n            </div>\n            <div className=\"cor-table-wrapper\">\n              <table className=\"cor-line-items-table\">\n                <thead>\n                  <tr>\n                    <th>Description</th>\n                    <th>Source</th>\n                    <th className=\"text-right\">Qty</th>\n                    <th>Unit</th>\n                    <th className=\"text-right\">Unit Cost</th>\n                    <th className=\"text-right\">Total</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {document.change_order_equipment.map((item, idx) => (\n                    <tr key={idx}>\n                      <td>{item.description}</td>\n                      <td>{item.source_reference || item.source_type}</td>\n                      <td className=\"text-right\">{item.quantity}</td>\n                      <td>{item.unit}</td>\n                      <td className=\"text-right\">${centsToDollars(item.unit_cost)}</td>\n                      <td className=\"text-right\">{formatCurrency(item.total)}</td>\n                    </tr>\n                  ))}\n                </tbody>\n                <tfoot>\n                  <tr>\n                    <td colSpan=\"4\" className=\"text-right\">Subtotal:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.equipment_subtotal)}</td>\n                  </tr>\n                  <tr className=\"markup-row\">\n                    <td colSpan=\"4\" className=\"text-right\">+ {formatPercent(document.equipment_markup_percent || 1500)} Markup:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.equipment_markup_amount)}</td>\n                  </tr>\n                  <tr className=\"section-total-row\">\n                    <td colSpan=\"4\" className=\"text-right\"><strong>Equipment Total:</strong></td>\n                    <td className=\"text-right\" colSpan=\"2\"><strong>{formatCurrency(totals.equipment_subtotal + totals.equipment_markup_amount)}</strong></td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n          </div>\n        )}\n\n        {/* Subcontractors Section */}\n        {document.change_order_subcontractors?.length > 0 && (\n          <div className=\"cor-section\">\n            <div className=\"cor-section-header\">\n              <Briefcase size={18} />\n              <h4>Subcontractors</h4>\n            </div>\n            <div className=\"cor-table-wrapper\">\n              <table className=\"cor-line-items-table\">\n                <thead>\n                  <tr>\n                    <th>Company</th>\n                    <th>Description</th>\n                    <th>Source</th>\n                    <th className=\"text-right\">Amount</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {document.change_order_subcontractors.map((item, idx) => (\n                    <tr key={idx}>\n                      <td>{item.company_name}</td>\n                      <td>{item.description}</td>\n                      <td>{item.source_reference || item.source_type}</td>\n                      <td className=\"text-right\">{formatCurrency(item.total)}</td>\n                    </tr>\n                  ))}\n                </tbody>\n                <tfoot>\n                  <tr>\n                    <td colSpan=\"2\" className=\"text-right\">Subtotal:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.subcontractors_subtotal)}</td>\n                  </tr>\n                  <tr className=\"markup-row\">\n                    <td colSpan=\"2\" className=\"text-right\">+ {formatPercent(document.subcontractors_markup_percent || 500)} Markup:</td>\n                    <td className=\"text-right\" colSpan=\"2\">{formatCurrency(totals.subcontractors_markup_amount)}</td>\n                  </tr>\n                  <tr className=\"section-total-row\">\n                    <td colSpan=\"2\" className=\"text-right\"><strong>Subcontractors Total:</strong></td>\n                    <td className=\"text-right\" colSpan=\"2\"><strong>{formatCurrency(totals.subcontractors_subtotal + totals.subcontractors_markup_amount)}</strong></td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n          </div>\n        )}\n\n        {/* T&M Backup Documentation Section - Professional Layout */}\n        {backupTickets.length > 0 && (() => {\n          // Calculate summary statistics\n          const totalLaborHours = backupTickets.reduce((sum, t) =>\n            sum + (t.t_and_m_workers?.reduce((wSum, w) => wSum + (parseFloat(w.hours) || 0), 0) || 0), 0\n          )\n          const totalOTHours = backupTickets.reduce((sum, t) =>\n            sum + (t.t_and_m_workers?.reduce((wSum, w) => wSum + (parseFloat(w.overtime_hours) || 0), 0) || 0), 0\n          )\n          const totalPhotos = backupTickets.reduce((sum, t) => sum + (t.photos?.length || 0), 0)\n          const verifiedCount = backupTickets.filter(t => t.client_signature_data).length\n\n          return (\n            <div className=\"cor-section cor-backup-section\">\n              {/* Professional Official Header */}\n              <div className=\"backup-official-header\">\n                <div className=\"backup-official-badge\">\n                  <FileText size={16} />\n                  <span>Supporting Documentation</span>\n                </div>\n                <div className=\"backup-summary-bar\">\n                  <div className=\"backup-stat\">\n                    <span className=\"backup-stat-value\">{backupTickets.length}</span>\n                    <span className=\"backup-stat-label\">Tickets</span>\n                  </div>\n                  <div className=\"backup-stat\">\n                    <span className=\"backup-stat-value\">{totalLaborHours.toFixed(1)}</span>\n                    <span className=\"backup-stat-label\">Labor Hrs</span>\n                  </div>\n                  {totalOTHours > 0 && (\n                    <div className=\"backup-stat\">\n                      <span className=\"backup-stat-value\">{totalOTHours.toFixed(1)}</span>\n                      <span className=\"backup-stat-label\">OT Hrs</span>\n                    </div>\n                  )}\n                  <div className=\"backup-stat\">\n                    <span className=\"backup-stat-value\">{totalPhotos}</span>\n                    <span className=\"backup-stat-label\">Photos</span>\n                  </div>\n                  {verifiedCount > 0 && (\n                    <div className=\"backup-stat verified\">\n                      <span className=\"backup-stat-value\">{verifiedCount}</span>\n                      <span className=\"backup-stat-label\">Verified</span>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              {/* Collapsible Toggle */}\n              <div\n                className=\"cor-section-header cor-backup-header\"\n                onClick={() => setBackupExpanded(!backupExpanded)}\n                style={{ cursor: 'pointer', marginBottom: backupExpanded ? '1rem' : 0 }}\n              >\n                <div className=\"backup-header-left\">\n                  <span>View All T&M Tickets</span>\n                </div>\n                <div className=\"backup-header-toggle\">\n                  {backupExpanded ? <ChevronDown size={20} /> : <ChevronRight size={20} />}\n                </div>\n              </div>\n\n              {backupExpanded && (\n                <div className=\"backup-tickets-list\" style={{ padding: '0 0.5rem' }}>\n                  {backupTickets.map((ticket) => {\n                    const isExpanded = expandedTickets.has(ticket.id)\n                    const ticketTotalHours = ticket.t_and_m_workers?.reduce((sum, w) =>\n                      sum + (parseFloat(w.hours) || 0), 0\n                    ) || 0\n                    const ticketOTHours = ticket.t_and_m_workers?.reduce((sum, w) =>\n                      sum + (parseFloat(w.overtime_hours) || 0), 0\n                    ) || 0\n                    const hasVerification = !!ticket.client_signature_data\n\n                    return (\n                      <div\n                        key={ticket.id}\n                        className=\"backup-ticket-pro\"\n                        data-verified={hasVerification}\n                        data-status={ticket.status || 'pending'}\n                      >\n                        {/* Professional Ticket Header */}\n                        <div\n                          className=\"ticket-pro-header\"\n                          onClick={() => {\n                            const next = new Set(expandedTickets)\n                            if (isExpanded) {\n                              next.delete(ticket.id)\n                            } else {\n                              next.add(ticket.id)\n                            }\n                            setExpandedTickets(next)\n                          }}\n                          style={{ cursor: 'pointer' }}\n                        >\n                          <div className=\"ticket-date-badge\">\n                            <Calendar size={14} />\n                            <span>{formatDate(ticket.work_date)}</span>\n                          </div>\n                          {ticket.ce_pco_number && (\n                            <span className=\"ticket-pco-badge\">{ticket.ce_pco_number}</span>\n                          )}\n                          {hasVerification && (\n                            <span className=\"ticket-verified-seal\">\n                              <CheckCircle size={12} /> Verified\n                            </span>\n                          )}\n                          <div style={{ marginLeft: 'auto', display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\n                            <span style={{ fontSize: '0.85rem', color: 'var(--text-muted)' }}>\n                              {ticket.t_and_m_workers?.length || 0} workers • {ticketTotalHours + ticketOTHours} hrs\n                            </span>\n                            {isExpanded ? <ChevronDown size={16} /> : <ChevronRight size={16} />}\n                          </div>\n                        </div>\n\n                        {/* Ticket Body - Expanded Content */}\n                        {isExpanded && (\n                          <div className=\"ticket-pro-body\">\n                            {/* Description */}\n                            {ticket.notes && (\n                              <div className=\"ticket-description-box\">\n                                <p>{ticket.notes}</p>\n                              </div>\n                            )}\n\n                            {/* Workers Section */}\n                            {ticket.t_and_m_workers?.length > 0 && (\n                              <div className=\"ticket-section-pro\">\n                                <div className=\"ticket-section-header\">\n                                  <HardHat size={14} />\n                                  <span>Labor</span>\n                                  <span className=\"section-count\">{ticketTotalHours + ticketOTHours} hrs total</span>\n                                </div>\n                                <div className=\"worker-pro-grid\">\n                                  {ticket.t_and_m_workers.map((worker, wIdx) => (\n                                    <div key={wIdx} className=\"worker-pro-row\">\n                                      <div>\n                                        <span className=\"worker-name\">{worker.name}</span>\n                                        {worker.role && <span className=\"worker-role\"> • {worker.role}</span>}\n                                      </div>\n                                      <span className=\"worker-time\">\n                                        {worker.time_started && worker.time_ended\n                                          ? `${formatTime(worker.time_started)} - ${formatTime(worker.time_ended)}`\n                                          : '-'}\n                                      </span>\n                                      <span className=\"worker-hours\">{worker.hours || 0} hrs</span>\n                                      <span className=\"worker-ot\">\n                                        {parseFloat(worker.overtime_hours) > 0 ? `+${worker.overtime_hours} OT` : '-'}\n                                      </span>\n                                    </div>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* Materials Section */}\n                            {ticket.t_and_m_items?.length > 0 && (\n                              <div className=\"ticket-section-pro\">\n                                <div className=\"ticket-section-header\">\n                                  <Package size={14} />\n                                  <span>Materials / Equipment</span>\n                                  <span className=\"section-count\">{ticket.t_and_m_items.length} items</span>\n                                </div>\n                                <div className=\"materials-pro-list\">\n                                  {ticket.t_and_m_items.map((item, iIdx) => (\n                                    <div key={iIdx} className=\"material-pro-row\">\n                                      <span className=\"material-name\">\n                                        {item.materials_equipment?.name || item.description || 'Item'}\n                                      </span>\n                                      <span className=\"material-qty\">\n                                        {item.quantity || 1} {item.materials_equipment?.unit || 'ea'}\n                                      </span>\n                                      <span className=\"material-source\">T&M Ticket</span>\n                                    </div>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* Photos Section */}\n                            {ticket.photos?.length > 0 && (\n                              <div className=\"ticket-section-pro\">\n                                <div className=\"ticket-section-header\">\n                                  <Camera size={14} />\n                                  <span>Photo Evidence</span>\n                                  <span className=\"section-count\">{ticket.photos.length}</span>\n                                </div>\n                                <div className=\"photo-evidence-grid\">\n                                  {ticket.photos.map((photo, pIdx) => (\n                                    <a\n                                      key={pIdx}\n                                      href={photo}\n                                      target=\"_blank\"\n                                      rel=\"noopener noreferrer\"\n                                      className=\"photo-evidence-item\"\n                                    >\n                                      <img\n                                        src={photo}\n                                        alt={`Evidence ${pIdx + 1}`}\n                                        onError={(e) => {\n                                          e.target.onerror = null\n                                          e.target.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiI+PHJlY3QgeD0iMyIgeT0iMyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiByeD0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg=='\n                                        }}\n                                      />\n                                    </a>\n                                  ))}\n                                </div>\n                              </div>\n                            )}\n\n                            {/* Client Verification Footer */}\n                            {hasVerification && (\n                              <div className=\"ticket-verification-footer\">\n                                <div className=\"verification-seal-icon\">\n                                  <CheckCircle size={22} />\n                                </div>\n                                {ticket.client_signature_data && (\n                                  <img\n                                    src={ticket.client_signature_data}\n                                    alt=\"Client Signature\"\n                                    className=\"verification-signature-img\"\n                                  />\n                                )}\n                                <div className=\"verification-info\">\n                                  <span className=\"signer-name\">{ticket.client_signature_name || 'Client'}</span>\n                                  {(ticket.client_signature_title || ticket.client_signature_company) && (\n                                    <span className=\"signer-title\">\n                                      {[ticket.client_signature_title, ticket.client_signature_company].filter(Boolean).join(', ')}\n                                    </span>\n                                  )}\n                                  {ticket.client_signature_date && (\n                                    <span className=\"verify-date\">Verified {formatDate(ticket.client_signature_date)}</span>\n                                  )}\n                                </div>\n                              </div>\n                            )}\n                          </div>\n                        )}\n                      </div>\n                    )\n                  })}\n                </div>\n              )}\n\n              <div className=\"backup-note\">\n                <AlertCircle size={14} />\n                <span>This documentation supports the work described in this Change Order Request.</span>\n              </div>\n            </div>\n          )\n        })()}\n\n        {/* Totals Section */}\n        <div className=\"cor-totals-card\">\n          <h4>COR Summary</h4>\n\n          <div className=\"cor-totals-grid\">\n            <div className=\"cor-total-row\">\n              <span>COR Subtotal</span>\n              <span>{formatCurrency(totals.cor_subtotal)}</span>\n            </div>\n\n            <div className=\"cor-fees-section\">\n              <div className=\"cor-fee-row\">\n                <span>Liability Insurance ({formatPercent(document.liability_insurance_percent || 144)})</span>\n                <span>{formatCurrency(totals.liability_insurance_amount)}</span>\n              </div>\n              <div className=\"cor-fee-row\">\n                <span>Bond ({formatPercent(document.bond_percent || 100)})</span>\n                <span>{formatCurrency(totals.bond_amount)}</span>\n              </div>\n              <div className=\"cor-fee-row\">\n                <span>City License Fee ({formatPercent(document.license_fee_percent || 10)})</span>\n                <span>{formatCurrency(totals.license_fee_amount)}</span>\n              </div>\n            </div>\n\n            <div className=\"cor-grand-total\">\n              <span>COR TOTAL</span>\n              <span>{formatCurrency(totals.cor_total)}</span>\n            </div>\n          </div>\n        </div>\n\n        {/* Signature Section */}\n        <div className=\"cor-signature-section\">\n          <h4>Authorization</h4>\n          <p className=\"signature-instruction\">\n            By signing below, you authorize the above change order request and agree to the terms and costs outlined.\n          </p>\n\n          <div className=\"signature-slots-grid\">\n            {/* Show signature options if not signed yet */}\n            {!isFullySigned ? (\n              <>\n                {/* GC Signature */}\n                <div className={`signature-slot-card ${slot1 ? 'signed' : 'unsigned'}`}>\n                  <div className=\"slot-header\">\n                    {slot1 ? (\n                      <CheckCircle size={20} className=\"status-icon signed\" />\n                    ) : (\n                      <Clock size={20} className=\"status-icon pending\" />\n                    )}\n                    <span className=\"slot-label\">GC Authorization</span>\n                  </div>\n                  <button\n                    className=\"btn btn-primary sign-btn\"\n                    onClick={() => openSignatureModal(1)}\n                    disabled={submitting}\n                  >\n                    Sign as GC\n                  </button>\n                </div>\n\n                <p className=\"or-divider\">— or —</p>\n\n                {/* Client Signature */}\n                <div className={`signature-slot-card ${slot2 ? 'signed' : 'unsigned'}`}>\n                  <div className=\"slot-header\">\n                    {slot2 ? (\n                      <CheckCircle size={20} className=\"status-icon signed\" />\n                    ) : (\n                      <Clock size={20} className=\"status-icon pending\" />\n                    )}\n                    <span className=\"slot-label\">Client Authorization</span>\n                  </div>\n                  <button\n                    className=\"btn btn-primary sign-btn\"\n                    onClick={() => openSignatureModal(2)}\n                    disabled={submitting}\n                  >\n                    Sign as Client\n                  </button>\n                </div>\n              </>\n            ) : (\n              <>\n                {/* Show the collected signature */}\n                {slot1 && (\n                  <div className=\"signature-slot-card signed\">\n                    <div className=\"slot-header\">\n                      <CheckCircle size={20} className=\"status-icon signed\" />\n                      <span className=\"slot-label\">GC Authorization</span>\n                    </div>\n                    <div className=\"slot-signed-info\">\n                      {slot1.signature_data && (\n                        <img src={slot1.signature_data} alt=\"Signature\" className=\"signature-image\" />\n                      )}\n                      <div className=\"signer-details\">\n                        <span className=\"signer-name\">{slot1.signer_name}</span>\n                        {(slot1.signer_title || slot1.signer_company) && (\n                          <span className=\"signer-org\">\n                            {slot1.signer_title}{slot1.signer_title && slot1.signer_company && ' — '}{slot1.signer_company}\n                          </span>\n                        )}\n                      </div>\n                      <span className=\"signed-date\">Signed {formatDate(slot1.signed_at)}</span>\n                    </div>\n                  </div>\n                )}\n                {slot2 && (\n                  <div className=\"signature-slot-card signed\">\n                    <div className=\"slot-header\">\n                      <CheckCircle size={20} className=\"status-icon signed\" />\n                      <span className=\"slot-label\">Client Authorization</span>\n                    </div>\n                    <div className=\"slot-signed-info\">\n                      {slot2.signature_data && (\n                        <img src={slot2.signature_data} alt=\"Signature\" className=\"signature-image\" />\n                      )}\n                      <div className=\"signer-details\">\n                        <span className=\"signer-name\">{slot2.signer_name}</span>\n                        {(slot2.signer_title || slot2.signer_company) && (\n                          <span className=\"signer-org\">\n                            {slot2.signer_title}{slot2.signer_title && slot2.signer_company && ' — '}{slot2.signer_company}\n                          </span>\n                        )}\n                      </div>\n                      <span className=\"signed-date\">Signed {formatDate(slot2.signed_at)}</span>\n                    </div>\n                  </div>\n                )}\n              </>\n            )}\n          </div>\n\n          {/* Fully signed message */}\n          {isFullySigned && (\n            <div className=\"fully-signed-message\">\n              <CheckCircle size={24} />\n              <p>This change order request has been signed.</p>\n            </div>\n          )}\n\n          {/* Download section - always available so clients can save a copy */}\n          <div className=\"cor-download-section\">\n            <h4>Download Your Copy</h4>\n            <p className=\"download-description\">\n              {isFullySigned\n                ? 'Download a PDF copy of this fully signed COR including all T&M backup documentation.'\n                : 'Download a PDF copy of this COR for your records. Signature status will be included.'}\n            </p>\n            <button\n              className=\"btn btn-primary download-btn\"\n              onClick={handleDownload}\n              disabled={downloading}\n            >\n              {downloading ? (\n                <>\n                  <span className=\"download-spinner\"></span>\n                  Generating PDF...\n                </>\n              ) : (\n                <>\n                  <Download size={18} />\n                  Download COR + Backup\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </main>\n\n      {/* Footer */}\n      <footer className=\"signature-page-footer\">\n        <p>Powered by FieldSync</p>\n      </footer>\n\n      {/* Signature modal */}\n      {showSignatureModal && activeSlot && (\n        <SignatureCanvas\n          enhanced\n          requireAcknowledgment\n          lockBodyScroll\n          slot={activeSlot}\n          documentType={signatureRequest.document_type}\n          documentTitle={`${document.cor_number} - ${document.title}`}\n          onSave={handleSignatureSubmit}\n          onClose={() => {\n            setShowSignatureModal(false)\n            setActiveSlot(null)\n          }}\n        />\n      )}\n    </div>\n  )\n}\n\n// Helper function to render a signature slot (for T&M tickets)\nfunction renderSignatureSlot(slot, signatureData, label, openModal, submitting) {\n  return (\n    <div className={`signature-slot-card ${signatureData ? 'signed' : 'unsigned'}`}>\n      <div className=\"slot-header\">\n        {signatureData ? (\n          <CheckCircle size={20} className=\"status-icon signed\" />\n        ) : (\n          <Clock size={20} className=\"status-icon pending\" />\n        )}\n        <span className=\"slot-label\">Signature {slot} — {label}</span>\n      </div>\n\n      {signatureData ? (\n        <div className=\"slot-signed-info\">\n          <div className=\"signer-details\">\n            <span className=\"signer-name\">{signatureData.signer_name}</span>\n            {(signatureData.signer_title || signatureData.signer_company) && (\n              <span className=\"signer-org\">\n                {signatureData.signer_title}{signatureData.signer_title && signatureData.signer_company && ' — '}{signatureData.signer_company}\n              </span>\n            )}\n          </div>\n          <span className=\"signed-date\">Signed {formatDate(signatureData.signed_at)}</span>\n        </div>\n      ) : (\n        <button\n          className=\"btn btn-primary sign-btn\"\n          onClick={() => openModal(slot)}\n          disabled={submitting}\n        >\n          Sign as {slot === 1 ? 'GC' : 'Client'}\n        </button>\n      )}\n    </div>\n  )\n}\n"],"names":["formatTime","timeStr","hours","minutes","h","ampm","formatTimePeriod","worker","verifyPhotosForExport","tmTickets","manifest","verified","failed","issues","ticket","photoUrl","entry","loadImageAsBase64","err","createExportSnapshot","cor","photoManifest","totals","dataString","hash","i","char","checksum","exportCORToPDF","project","company","branding","options","verifyPhotos","createSnapshot","doc","jsPDF","pageWidth","pageHeight","margin","yPos","calculateCORTotals","primaryColor","hexToRgb","headerBg","logoBase64","e","statusText","col1X","col2X","formatDateRange","formatDate","scopeLines","autoTable","item","centsToDollars","formatCurrency","formatPercent","totalsCol1","totalsCol2","renderSignatureBlock","startY","label","signatureData","signerName","signerTitle","signerCompany","signedDate","sigLineY","titleCompany","totalLaborHours","sum","t","wSum","w","totalOTHours","totalPhotos","verifiedCount","dateRange","min","max","docIdArray","docIdSuffix","b","docId","summaryCol1","summaryCol2","genDate","hasVerification","headerHeight","ticketStatusColor","notesLines","xPos","photoWidth","photoHeight","photoGap","photosPerRow","frameWidth","photoImages","loadImagesAsBase64","imgData","verifyBlockHeight","verifyBlockWidth","sealX","sealY","infoX","totalPages","footerY","fileName","result","exportTMTicketToPDF","logoData","materials","m","dateString","StatusBadge","status","statusMap","info","jsx","SignaturePage","signatureToken","loading","setLoading","useState","error","setError","signatureRequest","setSignatureRequest","document","setDocument","showSignatureModal","setShowSignatureModal","activeSlot","setActiveSlot","submitting","setSubmitting","successMessage","setSuccessMessage","downloading","setDownloading","backupTickets","setBackupTickets","backupExpanded","setBackupExpanded","expandedTickets","setExpandedTickets","useEffect","loadData","request","db","docData","tickets","photoGroups","allPhotos","signed","offset","resolved","len","photos","useMemo","getSignatureStatus","signatures","slot1","s","slot2","availableSlots","getClientIP","handleSignatureSubmit","ipAddress","signature","openSignatureModal","slot","handleDownload","isCOR","handleDownloadTMTicket","jsxs","AlertCircle","isFullySigned","workerCount","totalHours","Building2","CheckCircle","Fragment","Download","FileText","HardHat","idx","Package","Camera","photo","renderSignatureSlot","SignatureCanvas","Users","Truck","Briefcase","ChevronDown","ChevronRight","isExpanded","ticketTotalHours","ticketOTHours","next","Calendar","wIdx","iIdx","pIdx","Clock","openModal"],"mappings":"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"}