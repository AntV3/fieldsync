const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TMList-Rfc_Alvx.js","assets/pdf-aQqpMATS.js","assets/index-DFPwIEoX.js","assets/icons-B-oSmWeD.js","assets/react-DXGY7bZi.js","assets/supabase-VuevzHjS.js","assets/index-BLAzwQri.css","assets/SignatureLinkGenerator-A3WFNAIP.js","assets/corCalculations-D9qkkIbo.js","assets/ShareModal-D3yYHayO.js","assets/InjuryReportsList-D1nDgKDi.js","assets/NotificationSettings-Dv6POBc1.js","assets/DailyReportsList-Brb4wmyj.js","assets/CORList-BGLrBuYD.js","assets/CORForm-DQC2J64i.js","assets/CORDetail-Fg1unTpx.js","assets/BillingCenter-CNisgNis.js","assets/DrawRequestModal-DcrpS29Z.js","assets/EquipmentModal-DP0QPrYa.js","assets/AddCostModal-CWfkj9eZ.js","assets/DocumentsTab-B-Xav4q_.js"])))=>i.map(i=>d[i]);
import{_ as Z}from"./pdf-aQqpMATS.js";import{r as Ve,c as Ta,a as _n,S as Pn,b as On,u as Ne,s as An,d as Rn,e as Mn,f as In,g as Tn,h as Ln,i as $n,j as fe,k as La,l as qn,m as Es,n as Vn,o as Fn,p as zn,D as Ys,q as $a,t as Bn,v as Wn,w as Kn,x as Ss,y as Un,z as Hn,A as Xs,Z as Js,L as Ie,C as Gn,B as Yn,E as de,F as _s,G as qa,H as Xn,I as va,J as Va,K as Zs,M as Qs,N as Jn,O as Zn,P as Fa,Q as za,R as Qn,T as er,U as et,V as Ps,W as ar,X as sr,Y as tr,_ as nr,$ as rr,a0 as ir,a1 as at,a2 as lr,a3 as cr,a4 as or,a5 as dr,a6 as ur,a7 as mr,a8 as hr,a9 as pr,aa as Os,ab as As,ac as Rs,ad as vr,ae as xr,af as fr,ag as ge,ah as jr,ai as gr,aj as br,ak as st,al as _a,am as yr,an as Nr,ao as Cr,ap as wr,aq as kr,ar as T,as as e,at as Dr,au as be,av as tt,aw as Er,ax as Sr,ay as _r,az as nt,aA as Pr,aB as Or,aC as Ar,aD as Ms,aE as H,aF as Rr,aG as Mr,aH as Ir,aI as Tr}from"./index-DFPwIEoX.js";import{r as i,e as rt,X as Fe,a4 as Lr,Y as Ma,y as Te,F as Le,s as ie,N as $e,a2 as oa,T as da,a5 as $r,a6 as qr,H as ua,z as Vr,n as qe,l as Me,p as xa,q as ze,O as Fr,R as zr,a7 as Br,a8 as it,a9 as Wr,aa as fa,m as Ba,K as ja,ab as Kr,ac as Ur,W as Hr,j as Gr,a as Be,i as Yr,ad as Xr,ae as Pa,af as Jr,c as Is,d as Zr,Q as ca,ag as lt,ah as Qr,ai as ei,aj as ai,ak as si,al as Ts,am as ti,an as ni,ao as ri,ap as ii}from"./icons-B-oSmWeD.js";import{f as ee}from"./corCalculations-D9qkkIbo.js";function ma(){return ma=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)({}).hasOwnProperty.call(n,t)&&(s[t]=n[t])}return s},ma.apply(null,arguments)}function Ls(s,a){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,t)}return n}function li(s){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?Ls(Object(n),!0).forEach(function(t){ci(s,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):Ls(Object(n)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(n,t))})}return s}function ci(s,a,n){return(a=oi(a))in s?Object.defineProperty(s,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[a]=n,s}function oi(s){var a=di(s,"string");return typeof a=="symbol"?a:a+""}function di(s,a){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var t=n.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}var Q=32,ui={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function mi(s){var{data:a,iconType:n,inactiveColor:t}=s,r=Q/2,c=Q/6,o=Q/3,d=a.inactive?t:a.color,h=n??a.type;if(h==="none")return null;if(h==="plainline"){var u;return i.createElement("line",{strokeWidth:4,fill:"none",stroke:d,strokeDasharray:(u=a.payload)===null||u===void 0?void 0:u.strokeDasharray,x1:0,y1:r,x2:Q,y2:r,className:"recharts-legend-icon"})}if(h==="line")return i.createElement("path",{strokeWidth:4,fill:"none",stroke:d,d:"M0,".concat(r,"h").concat(o,`
            A`).concat(c,",").concat(c,",0,1,1,").concat(2*o,",").concat(r,`
            H`).concat(Q,"M").concat(2*o,",").concat(r,`
            A`).concat(c,",").concat(c,",0,1,1,").concat(o,",").concat(r),className:"recharts-legend-icon"});if(h==="rect")return i.createElement("path",{stroke:"none",fill:d,d:"M0,".concat(Q/8,"h").concat(Q,"v").concat(Q*3/4,"h").concat(-Q,"z"),className:"recharts-legend-icon"});if(i.isValidElement(a.legendIcon)){var l=li({},a);return delete l.legendIcon,i.cloneElement(a.legendIcon,l)}return i.createElement(On,{fill:d,cx:r,cy:r,size:Q,sizeType:"diameter",type:h})}function hi(s){var{payload:a,iconSize:n,layout:t,formatter:r,inactiveColor:c,iconType:o}=s,d={x:0,y:0,width:Q,height:Q},h={display:t==="horizontal"?"inline-block":"block",marginRight:10},u={display:"inline-block",verticalAlign:"middle",marginRight:4};return a.map((l,f)=>{var j=l.formatter||r,g=Ta({"recharts-legend-item":!0,["legend-item-".concat(f)]:!0,inactive:l.inactive});if(l.type==="none")return null;var m=l.inactive?c:l.color,p=j?j(l.value,l,f):l.value;return i.createElement("li",ma({className:g,style:h,key:"legend-item-".concat(f)},_n(s,l,f)),i.createElement(Pn,{width:n,height:n,viewBox:d,style:u,"aria-label":"".concat(p," legend icon")},i.createElement(mi,{data:l,iconType:o,inactiveColor:c})),i.createElement("span",{className:"recharts-legend-item-text",style:{color:m}},p))})}var pi=s=>{var a=Ve(s,ui),{payload:n,layout:t,align:r}=a;if(!n||!n.length)return null;var c={padding:0,margin:0,textAlign:t==="horizontal"?r:"left"};return i.createElement("ul",{className:"recharts-default-legend",style:c},i.createElement(hi,ma({},a,{payload:n})))};function vi(){return Ne(An)}var xi=["contextPayload"];function Ia(){return Ia=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)({}).hasOwnProperty.call(n,t)&&(s[t]=n[t])}return s},Ia.apply(null,arguments)}function $s(s,a){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,t)}return n}function we(s){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?$s(Object(n),!0).forEach(function(t){fi(s,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):$s(Object(n)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(n,t))})}return s}function fi(s,a,n){return(a=ji(a))in s?Object.defineProperty(s,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[a]=n,s}function ji(s){var a=gi(s,"string");return typeof a=="symbol"?a:a+""}function gi(s,a){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var t=n.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function bi(s,a){if(s==null)return{};var n,t,r=yi(s,a);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(s);for(t=0;t<c.length;t++)n=c[t],a.indexOf(n)===-1&&{}.propertyIsEnumerable.call(s,n)&&(r[n]=s[n])}return r}function yi(s,a){if(s==null)return{};var n={};for(var t in s)if({}.hasOwnProperty.call(s,t)){if(a.indexOf(t)!==-1)continue;n[t]=s[t]}return n}function Ni(s){return s.value}function Ci(s){var{contextPayload:a}=s,n=bi(s,xi),t=Vn(a,s.payloadUniqBy,Ni),r=we(we({},n),{},{payload:t});return i.isValidElement(s.content)?i.cloneElement(s.content,r):typeof s.content=="function"?i.createElement(s.content,r):i.createElement(pi,r)}function wi(s,a,n,t,r,c){var{layout:o,align:d,verticalAlign:h}=a,u,l;return(!s||(s.left===void 0||s.left===null)&&(s.right===void 0||s.right===null))&&(d==="center"&&o==="vertical"?u={left:((t||0)-c.width)/2}:u=d==="right"?{right:n&&n.right||0}:{left:n&&n.left||0}),(!s||(s.top===void 0||s.top===null)&&(s.bottom===void 0||s.bottom===null))&&(h==="middle"?l={top:((r||0)-c.height)/2}:l=h==="bottom"?{bottom:n&&n.bottom||0}:{top:n&&n.top||0}),we(we({},u),l)}function ki(s){var a=La();return i.useEffect(()=>{a(qn(s))},[a,s]),null}function Di(s){var a=La();return i.useEffect(()=>(a(Es(s)),()=>{a(Es({width:0,height:0}))}),[a,s]),null}function Ei(s,a,n,t){return s==="vertical"&&fe(a)?{height:a}:s==="horizontal"?{width:n||t}:null}var Si={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function Wa(s){var a=Ve(s,Si),n=vi(),t=Rn(),r=Mn(),{width:c,height:o,wrapperStyle:d,portal:h}=a,[u,l]=In([n]),f=Tn(),j=Ln();if(f==null||j==null)return null;var g=f-(r?.left||0)-(r?.right||0),m=Ei(a.layout,o,c,g),p=h?d:we(we({position:"absolute",width:m?.width||c||"auto",height:m?.height||o||"auto"},wi(d,a,r,f,j,u)),d),w=h??t;if(w==null||n==null)return null;var E=i.createElement("div",{className:"recharts-legend-wrapper",style:p,ref:l},i.createElement(ki,{layout:a.layout,align:a.align,verticalAlign:a.verticalAlign,itemSorter:a.itemSorter}),!h&&i.createElement(Di,{width:u.width,height:u.height}),i.createElement(Ci,Ia({},a,m,{margin:r,chartWidth:f,chartHeight:j,contextPayload:n})));return $n.createPortal(E,w)}Wa.displayName="Legend";function qs(s,a){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,t)}return n}function Vs(s){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?qs(Object(n),!0).forEach(function(t){_i(s,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):qs(Object(n)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(n,t))})}return s}function _i(s,a,n){return(a=Pi(a))in s?Object.defineProperty(s,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[a]=n,s}function Pi(s){var a=Oi(s,"string");return typeof a=="symbol"?a:a+""}function Oi(s,a){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var t=n.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function ha(){return ha=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)({}).hasOwnProperty.call(n,t)&&(s[t]=n[t])}return s},ha.apply(null,arguments)}var Ai=(s,a)=>{var n;if(i.isValidElement(s))n=i.cloneElement(s,a);else if(typeof s=="function")n=s(a);else{if(!de(a.x1)||!de(a.y1)||!de(a.x2)||!de(a.y2))return null;n=i.createElement("line",ha({},a,{className:"recharts-reference-line-line"}))}return n},Ri=(s,a,n,t,r,c)=>{var{x:o,width:d}=c,h=r.y.apply(s,{position:n});if(qa(h)||a==="discard"&&!r.y.isInRange(h))return null;var u=[{x:o+d,y:h},{x:o,y:h}];return t==="left"?u.reverse():u},Mi=(s,a,n,t,r,c)=>{var{y:o,height:d}=c,h=r.x.apply(s,{position:n});if(qa(h)||a==="discard"&&!r.x.isInRange(h))return null;var u=[{x:h,y:o+d},{x:h,y:o}];return t==="top"?u.reverse():u},Ii=(s,a,n,t)=>{var r=s.map(c=>t.apply(c,{position:n}));return a==="discard"&&r.some(c=>!t.isInRange(c))?null:r},Ti=(s,a,n,t,r,c)=>{var{x:o,y:d,segment:h,ifOverflow:u}=c,l=_s(o),f=_s(d);return f?Ri(d,u,n,r,s,a):l?Mi(o,u,n,t,s,a):h!=null&&h.length===2?Ii(h,u,n,s):null};function Li(s){var a=La();return i.useEffect(()=>(a(Fn(s)),()=>{a(zn(s))})),null}function $i(s){var{xAxisId:a,yAxisId:n,shape:t,className:r,ifOverflow:c}=s,o=$a(),d=Bn(),h=Ne(R=>Wn(R,a)),u=Ne(R=>Kn(R,n)),l=Ne(R=>Ss(R,"xAxis",a,o)),f=Ne(R=>Ss(R,"yAxis",n,o)),j=Un();if(!d||!j||h==null||u==null||l==null||f==null)return null;var g=Hn({x:l,y:f}),m=Ti(g,j,s.position,h.orientation,u.orientation,s);if(!m)return null;var[{x:p,y:w},{x:E,y:v}]=m,S=c==="hidden"?"url(#".concat(d,")"):void 0,b=Vs(Vs({clipPath:S},Xs(s)),{},{x1:p,y1:w,x2:E,y2:v}),y=Xn({x1:p,y1:w,x2:E,y2:v});return i.createElement(Js,{zIndex:s.zIndex},i.createElement(Ie,{className:Ta("recharts-reference-line",r)},Ai(t,b),i.createElement(Gn,ha({},y,{lowerWidth:y.width,upperWidth:y.width}),i.createElement(Yn,{label:s.label}),s.children)))}var qi={ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle",zIndex:Ys.line};function ct(s){var a=Ve(s,qi);return i.createElement(i.Fragment,null,i.createElement(Li,{yAxisId:a.yAxisId,xAxisId:a.xAxisId,ifOverflow:a.ifOverflow,x:a.x,y:a.y,segment:a.segment}),i.createElement($i,a))}ct.displayName="ReferenceLine";var ot=(s,a,n)=>Zs(s,"xAxis",Fa(s,a),n),dt=(s,a,n)=>Qs(s,"xAxis",Fa(s,a),n),ut=(s,a,n)=>Zs(s,"yAxis",za(s,a),n),mt=(s,a,n)=>Qs(s,"yAxis",za(s,a),n),Vi=va([Va,ot,ut,dt,mt],(s,a,n,t,r)=>et(s,"xAxis")?Ps(a,t,!1):Ps(n,r,!1)),Fi=(s,a)=>a,ht=va([ar,Fi],(s,a)=>s.filter(n=>n.type==="area").find(n=>n.id===a)),pt=s=>{var a=Va(s),n=et(a,"xAxis");return n?"yAxis":"xAxis"},zi=(s,a)=>{var n=pt(s);return n==="yAxis"?za(s,a):Fa(s,a)},Bi=(s,a,n)=>Qn(s,pt(s),zi(s,a),n),Wi=va([ht,Bi],(s,a)=>{var n;if(!(s==null||a==null)){var{stackId:t}=s,r=er(s);if(!(t==null||r==null)){var c=(n=a[t])===null||n===void 0?void 0:n.stackedData,o=c?.find(d=>d.key===r);if(o!=null)return o.map(d=>[d[0],d[1]])}}}),Ki=va([Va,ot,ut,dt,mt,Wi,Jn,Vi,ht,Zn],(s,a,n,t,r,c,o,d,h,u)=>{var{chartData:l,dataStartIndex:f,dataEndIndex:j}=o;if(!(h==null||s!=="horizontal"&&s!=="vertical"||a==null||n==null||t==null||r==null||t.length===0||r.length===0||d==null)){var{data:g}=h,m;if(g&&g.length>0?m=g:m=l?.slice(f,j+1),m!=null)return dl({layout:s,xAxis:a,yAxis:n,xAxisTicks:t,yAxisTicks:r,dataStartIndex:f,areaSettings:h,stackedData:c,displayedData:m,chartBaseValue:u,bandSize:d})}}),Ui=["id"],Hi=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function xe(){return xe=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var t in n)({}).hasOwnProperty.call(n,t)&&(s[t]=n[t])}return s},xe.apply(null,arguments)}function vt(s,a){if(s==null)return{};var n,t,r=Gi(s,a);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(s);for(t=0;t<c.length;t++)n=c[t],a.indexOf(n)===-1&&{}.propertyIsEnumerable.call(s,n)&&(r[n]=s[n])}return r}function Gi(s,a){if(s==null)return{};var n={};for(var t in s)if({}.hasOwnProperty.call(s,t)){if(a.indexOf(t)!==-1)continue;n[t]=s[t]}return n}function Fs(s,a){var n=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),n.push.apply(n,t)}return n}function Ce(s){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?Fs(Object(n),!0).forEach(function(t){Yi(s,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):Fs(Object(n)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(n,t))})}return s}function Yi(s,a,n){return(a=Xi(a))in s?Object.defineProperty(s,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[a]=n,s}function Xi(s){var a=Ji(s,"string");return typeof a=="symbol"?a:a+""}function Ji(s,a){if(typeof s!="object"||!s)return s;var n=s[Symbol.toPrimitive];if(n!==void 0){var t=n.call(s,a);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)}function pa(s,a){return s&&s!=="none"?s:a}var Zi=s=>{var{dataKey:a,name:n,stroke:t,fill:r,legendType:c,hide:o}=s;return[{inactive:o,dataKey:a,type:c,color:pa(t,r),value:at(n,a),payload:s}]},Qi=i.memo(s=>{var{dataKey:a,data:n,stroke:t,strokeWidth:r,fill:c,name:o,hide:d,unit:h,tooltipType:u,id:l}=s,f={dataDefinedOnItem:n,positions:void 0,settings:{stroke:t,strokeWidth:r,fill:c,dataKey:a,nameKey:void 0,name:at(o,a),hide:d,type:u,color:pa(t,c),unit:h,graphicalItemId:l}};return i.createElement(lr,{tooltipEntrySettings:f})});function el(s){var{clipPathId:a,points:n,props:t}=s,{needClip:r,dot:c,dataKey:o}=t,d=st(t);return i.createElement(yr,{points:n,dot:c,className:"recharts-area-dots",dotClassName:"recharts-area-dot",dataKey:o,baseProps:d,needClip:r,clipPathId:a})}function al(s){var{showLabels:a,children:n,points:t}=s,r=t.map(c=>{var o,d,h={x:(o=c.x)!==null&&o!==void 0?o:0,y:(d=c.y)!==null&&d!==void 0?d:0,width:0,lowerWidth:0,upperWidth:0,height:0};return Ce(Ce({},h),{},{value:c.value,payload:c.payload,parentViewBox:void 0,viewBox:h,fill:void 0})});return i.createElement(br,{value:a?r:void 0},n)}function zs(s){var{points:a,baseLine:n,needClip:t,clipPathId:r,props:c}=s,{layout:o,type:d,stroke:h,connectNulls:u,isRange:l}=c,{id:f}=c,j=vt(c,Ui),g=st(j),m=Xs(j);return i.createElement(i.Fragment,null,a?.length>1&&i.createElement(Ie,{clipPath:t?"url(#clipPath-".concat(r,")"):void 0},i.createElement(_a,xe({},m,{id:f,points:a,connectNulls:u,type:d,baseLine:n,layout:o,stroke:"none",className:"recharts-area-area"})),h!=="none"&&i.createElement(_a,xe({},g,{className:"recharts-area-curve",layout:o,type:d,connectNulls:u,fill:"none",points:a})),h!=="none"&&l&&i.createElement(_a,xe({},g,{className:"recharts-area-curve",layout:o,type:d,connectNulls:u,fill:"none",points:n}))),i.createElement(el,{points:a,props:j,clipPathId:r}))}function sl(s){var a,n,{alpha:t,baseLine:r,points:c,strokeWidth:o}=s,d=(a=c[0])===null||a===void 0?void 0:a.y,h=(n=c[c.length-1])===null||n===void 0?void 0:n.y;if(!de(d)||!de(h))return null;var u=t*Math.abs(d-h),l=Math.max(...c.map(f=>f.x||0));return fe(r)?l=Math.max(r,l):r&&Array.isArray(r)&&r.length&&(l=Math.max(...r.map(f=>f.x||0),l)),fe(l)?i.createElement("rect",{x:0,y:d<h?d:d-u,width:l+(o?parseInt("".concat(o),10):1),height:Math.floor(u)}):null}function tl(s){var a,n,{alpha:t,baseLine:r,points:c,strokeWidth:o}=s,d=(a=c[0])===null||a===void 0?void 0:a.x,h=(n=c[c.length-1])===null||n===void 0?void 0:n.x;if(!de(d)||!de(h))return null;var u=t*Math.abs(d-h),l=Math.max(...c.map(f=>f.y||0));return fe(r)?l=Math.max(r,l):r&&Array.isArray(r)&&r.length&&(l=Math.max(...r.map(f=>f.y||0),l)),fe(l)?i.createElement("rect",{x:d<h?d:d-u,y:0,width:u,height:Math.floor(l+(o?parseInt("".concat(o),10):1))}):null}function nl(s){var{alpha:a,layout:n,points:t,baseLine:r,strokeWidth:c}=s;return n==="vertical"?i.createElement(sl,{alpha:a,points:t,baseLine:r,strokeWidth:c}):i.createElement(tl,{alpha:a,points:t,baseLine:r,strokeWidth:c})}function rl(s){var{needClip:a,clipPathId:n,props:t,previousPointsRef:r,previousBaselineRef:c}=s,{points:o,baseLine:d,isAnimationActive:h,animationBegin:u,animationDuration:l,animationEasing:f,onAnimationStart:j,onAnimationEnd:g}=t,m=i.useMemo(()=>({points:o,baseLine:d}),[o,d]),p=vr(m,"recharts-area-"),w=xr(),[E,v]=i.useState(!1),S=!E,b=i.useCallback(()=>{typeof g=="function"&&g(),v(!1)},[g]),y=i.useCallback(()=>{typeof j=="function"&&j(),v(!0)},[j]);if(w==null)return null;var R=r.current,F=c.current;return i.createElement(al,{showLabels:S,points:o},t.children,i.createElement(fr,{animationId:p,begin:u,duration:l,isActive:h,easing:f,onAnimationEnd:b,onAnimationStart:y,key:p},k=>{if(R){var N=R.length/o.length,A=k===1?o:o.map((z,G)=>{var Y=Math.floor(G*N);if(R[Y]){var le=R[Y];return Ce(Ce({},z),{},{x:ge(le.x,z.x,k),y:ge(le.y,z.y,k)})}return z}),M;return fe(d)?M=ge(F,d,k):jr(d)||qa(d)?M=ge(F,0,k):M=d.map((z,G)=>{var Y=Math.floor(G*N);if(Array.isArray(F)&&F[Y]){var le=F[Y];return Ce(Ce({},z),{},{x:ge(le.x,z.x,k),y:ge(le.y,z.y,k)})}return z}),k>0&&(r.current=A,c.current=M),i.createElement(zs,{points:A,baseLine:M,needClip:a,clipPathId:n,props:t})}return k>0&&(r.current=o,c.current=d),i.createElement(Ie,null,h&&i.createElement("defs",null,i.createElement("clipPath",{id:"animationClipPath-".concat(n)},i.createElement(nl,{alpha:k,points:o,baseLine:d,layout:w,strokeWidth:t.strokeWidth}))),i.createElement(Ie,{clipPath:"url(#animationClipPath-".concat(n,")")},i.createElement(zs,{points:o,baseLine:d,needClip:a,clipPathId:n,props:t})))}),i.createElement(gr,{label:t.label}))}function il(s){var{needClip:a,clipPathId:n,props:t}=s,r=i.useRef(null),c=i.useRef();return i.createElement(rl,{needClip:a,clipPathId:n,props:t,previousPointsRef:r,previousBaselineRef:c})}class ll extends i.PureComponent{render(){var{hide:a,dot:n,points:t,className:r,top:c,left:o,needClip:d,xAxisId:h,yAxisId:u,width:l,height:f,id:j,baseLine:g,zIndex:m}=this.props;if(a)return null;var p=Ta("recharts-area",r),w=j,{r:E,strokeWidth:v}=mr(n),S=hr(n),b=E*2+v,y=d?"url(#clipPath-".concat(S?"":"dots-").concat(w,")"):void 0;return i.createElement(Js,{zIndex:m},i.createElement(Ie,{className:p},d&&i.createElement("defs",null,i.createElement(pr,{clipPathId:w,xAxisId:h,yAxisId:u}),!S&&i.createElement("clipPath",{id:"clipPath-dots-".concat(w)},i.createElement("rect",{x:o-b/2,y:c-b/2,width:l+b,height:f+b}))),i.createElement(il,{needClip:d,clipPathId:w,props:this.props})),i.createElement(Os,{points:t,mainColor:pa(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:y}),this.props.isRange&&Array.isArray(g)&&i.createElement(Os,{points:g,mainColor:pa(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:y}))}}var xt={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:"auto",legendType:"line",stroke:"#3182bd",strokeWidth:1,type:"linear",label:!1,xAxisId:0,yAxisId:0,zIndex:Ys.area};function cl(s){var a,n=Ve(s,xt),{activeDot:t,animationBegin:r,animationDuration:c,animationEasing:o,connectNulls:d,dot:h,fill:u,fillOpacity:l,hide:f,isAnimationActive:j,legendType:g,stroke:m,xAxisId:p,yAxisId:w}=n,E=vt(n,Hi),v=cr(),S=or(),{needClip:b}=dr(p,w),y=$a(),{points:R,isRange:F,baseLine:k}=(a=Ne(Y=>Ki(Y,s.id,y)))!==null&&a!==void 0?a:{},N=ur();if(v!=="horizontal"&&v!=="vertical"||N==null||S!=="AreaChart"&&S!=="ComposedChart")return null;var{height:A,width:M,x:z,y:G}=N;return!R||!R.length?null:i.createElement(ll,xe({},E,{activeDot:t,animationBegin:r,animationDuration:c,animationEasing:o,baseLine:k,connectNulls:d,dot:h,fill:u,fillOpacity:l,height:A,hide:f,layout:v,isAnimationActive:j==="auto"?!Nr.isSsr:j,isRange:F,legendType:g,needClip:b,points:R,stroke:m,width:M,left:z,top:G,xAxisId:p,yAxisId:w}))}var ol=(s,a,n,t,r)=>{var c=n??a;if(fe(c))return c;var o=s==="horizontal"?r:t,d=o.scale.domain();if(o.type==="number"){var h=Math.max(d[0],d[1]),u=Math.min(d[0],d[1]);return c==="dataMin"?u:c==="dataMax"||h<0?h:Math.max(Math.min(d[0],d[1]),0)}return c==="dataMin"?d[0]:c==="dataMax"?d[1]:d[0]};function dl(s){var{areaSettings:{connectNulls:a,baseValue:n,dataKey:t},stackedData:r,layout:c,chartBaseValue:o,xAxis:d,yAxis:h,displayedData:u,dataStartIndex:l,xAxisTicks:f,yAxisTicks:j,bandSize:g}=s,m=r&&r.length,p=ol(c,o,n,d,h),w=c==="horizontal",E=!1,v=u.map((b,y)=>{var R,F,k;if(m)k=r[l+y];else{var N=As(b,t);Array.isArray(N)?(k=N,E=!0):k=[p,N]}var A=(R=(F=k)===null||F===void 0?void 0:F[1])!==null&&R!==void 0?R:null,M=A==null||m&&!a&&As(b,t)==null;return w?{x:Rs({axis:d,ticks:f,bandSize:g,entry:b,index:y}),y:M?null:h.scale(A),value:k,payload:b}:{x:M?null:d.scale(A),y:Rs({axis:h,ticks:j,bandSize:g,entry:b,index:y}),value:k,payload:b}}),S;return m||E?S=v.map(b=>{var y=Array.isArray(b.value)?b.value[0]:null;return w?{x:b.x,y:y!=null&&b.y!=null?h.scale(y):null,payload:b.payload}:{x:y!=null?d.scale(y):null,y:b.y,payload:b.payload}}):S=w?h.scale(p):d.scale(p),{points:v,baseLine:S,isRange:E}}function ul(s){var a=Ve(s,xt),n=$a();return i.createElement(tr,{id:a.id,type:"area"},t=>i.createElement(i.Fragment,null,i.createElement(nr,{legendPayload:Zi(a)}),i.createElement(Qi,{dataKey:a.dataKey,data:a.data,stroke:a.stroke,strokeWidth:a.strokeWidth,fill:a.fill,name:a.name,hide:a.hide,unit:a.unit,tooltipType:a.tooltipType,id:t}),i.createElement(rr,{type:"area",id:t,data:a.data,dataKey:a.dataKey,xAxisId:a.xAxisId,yAxisId:a.yAxisId,zAxisId:0,stackId:ir(a.stackId),hide:a.hide,barSize:void 0,baseValue:a.baseValue,isPanorama:n,connectNulls:a.connectNulls}),i.createElement(cl,xe({},a,{id:t}))))}var Ae=i.memo(ul,sr);Ae.displayName="Area";var ml=["axis"],hl=i.forwardRef((s,a)=>i.createElement(Cr,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:ml,tooltipPayloadSearcher:wr,categoricalChartProps:s,ref:a}));const Bs={WARNING:"warning",ERROR:"error"},ae={DATABASE:"database",NETWORK:"network",AUTH:"auth",VALIDATION:"validation",STORAGE:"storage",SYNC:"sync",GENERAL:"general"};function pl(s){const a=s?.message?.toLowerCase()||"",n=s?.code?.toLowerCase()||"";return a.includes("fetch")||a.includes("network")||a.includes("offline")?ae.NETWORK:a.includes("auth")||a.includes("unauthorized")||n.includes("auth")?ae.AUTH:a.includes("storage")||a.includes("bucket")||a.includes("upload")?ae.STORAGE:a.includes("validation")||a.includes("invalid")||a.includes("required")?ae.VALIDATION:a.includes("sync")||a.includes("conflict")?ae.SYNC:s?.code||a.includes("database")||a.includes("supabase")?ae.DATABASE:ae.GENERAL}function vl(s,a,n){return n?.userMessage?n.userMessage:a===ae.NETWORK?"Network connection issue. Your changes will sync when back online.":a===ae.AUTH?"Session expired. Please sign in again.":a===ae.STORAGE?"Failed to upload file. Please try again.":a===ae.VALIDATION?s?.message||"Please check your input and try again.":a===ae.SYNC?"Sync conflict detected. Please refresh and try again.":n?.operation?`Failed to ${n.operation.replace(/([A-Z])/g," $1").toLowerCase().trim()}. Please try again.`:"Something went wrong. Please try again."}function xl(s,a={}){const{operation:n="unknown",category:t=pl(s),severity:r=Bs.ERROR,showToast:c,userMessage:o,companyId:d,projectId:h,userId:u,silent:l=!1,rethrow:f=!1}=a;if(kr.error(t,{message:s?.message||"Unknown error",code:s?.code,severity:r,operation:n,company_id:d,project_id:h,user_id:u,extra:{stack:s?.stack,name:s?.name}}),!l&&c){const j=vl(s,t,{operation:n,userMessage:o}),g=r===Bs.WARNING?"warning":"error";c(j,g)}if(f)throw s;return null}async function re(s,a={}){const{fallback:n=null,context:t={},showToast:r,silent:c=!0}=a;try{return await s()}catch(o){return xl(o,{...t,showToast:r,silent:c}),n}}const ke={budget:{healthy:.6,warning:.75,critical:.85},schedule:{healthy:.05,warning:.15,critical:.25},corExposure:{healthy:.05,warning:.15,critical:.25},activity:{healthy:1,warning:3,critical:5},safety:{healthy:0,warning:1,critical:2}},fl={budget:.3,schedule:.25,corExposure:.2,activity:.15,safety:.1};function We(s,a){if(s<=a.healthy)return 0;if(s>=a.critical)return 100;const n=a.critical-a.healthy;return(s-a.healthy)/n*100}function Ke(s){return s<=25?"healthy":s<=60?"warning":"critical"}function jl(s,a,n=ke.budget){if(!a||a<=0)return{score:0,status:"healthy",ratio:0,label:"No revenue yet"};const t=s/a,r=We(t,n),c=Ke(r);let o;return t<n.healthy?o=`Costs at ${(t*100).toFixed(0)}% of revenue`:t<n.warning?o=`Costs at ${(t*100).toFixed(0)}% - monitor closely`:o=`Costs at ${(t*100).toFixed(0)}% - review immediately`,{score:r,status:c,ratio:t,label:o}}function gl(s,a,n=ke.schedule){if(!a||a<=0)return{score:0,status:"healthy",variance:0,label:"No schedule baseline"};const t=(a-s)/a,r=Math.max(0,t),c=We(r,n),o=Ke(c);let d;return t<=0?d=s>=100?"Complete":"On or ahead of schedule":t<n.warning?d=`${(t*100).toFixed(0)}% behind schedule`:d=`${(t*100).toFixed(0)}% behind - needs attention`,{score:c,status:o,variance:t,label:d}}function bl(s,a,n=ke.corExposure){if(!a||a<=0)return{score:0,status:"healthy",exposure:0,label:"No contract value"};const t=s/a,r=We(t,n),c=Ke(r);let o;return t<n.healthy?o=s>0?`$${Oa(s)} pending`:"No pending CORs":t<n.warning?o=`$${Oa(s)} pending (${(t*100).toFixed(0)}% of contract)`:o=`High exposure: $${Oa(s)} (${(t*100).toFixed(0)}%)`,{score:r,status:c,exposure:t,label:o}}function yl(s,a=ke.activity){if(!s)return{score:100,status:"critical",daysSince:null,label:"No reports filed"};const n=new Date(s),r=Math.floor((new Date-n)/(1e3*60*60*24)),c=We(r,a),o=Ke(c);let d;return r===0?d="Report filed today":r===1?d="Report filed yesterday":r<=a.warning?d=`Last report ${r} days ago`:d=`No report in ${r} days - may be stalled`,{score:c,status:o,daysSince:r,label:d}}function Nl(s,a=ke.safety){const n=s||0,t=We(n,a),r=Ke(t);let c;return n===0?c="No incidents":n===1?c="1 incident in last 30 days":c=`${n} incidents - safety review needed`,{score:t,status:r,count:n,label:c}}function Cl(s,a={}){const n={...ke,...a.thresholds},t={...fl,...a.weights},r=jl(s.totalCosts,s.earnedRevenue,n.budget),c=gl(s.actualProgress,s.expectedProgress,n.schedule),o=bl(s.pendingCORValue,s.contractValue,n.corExposure),d=yl(s.lastReportDate,n.activity),h=Nl(s.recentInjuryCount,n.safety),u=Math.round(r.score*t.budget+c.score*t.schedule+o.score*t.corExposure+d.score*t.activity+h.score*t.safety);let l;u<=25?l="healthy":u<=60?l="warning":l="critical";let f;return l==="healthy"?f="Project is on track":l==="warning"?f="Some factors need attention":f="Immediate review recommended",{score:u,status:l,label:f,factors:{budget:{...r,weight:t.budget},schedule:{...c,weight:t.schedule},corExposure:{...o,weight:t.corExposure},activity:{...d,weight:t.activity},safety:{...h,weight:t.safety}}}}function wl(s,a){const n=[],{factors:t}=s;t.budget.status==="critical"&&n.push({type:"critical",title:"Budget Alert",description:t.budget.label,action:"Review costs immediately",actionTarget:"financials",projectId:a.id}),t.activity.status==="critical"&&n.push({type:"critical",title:"Activity Alert",description:t.activity.label,action:"Check project status",actionTarget:"overview",projectId:a.id}),t.safety.status==="critical"&&n.push({type:"critical",title:"Safety Alert",description:t.safety.label,action:"Review safety reports",actionTarget:"reports",projectId:a.id}),t.budget.status==="warning"&&n.push({type:"warning",title:"Budget Watch",description:t.budget.label,action:"Monitor costs",actionTarget:"financials",projectId:a.id}),(t.schedule.status==="critical"||t.schedule.status==="warning")&&n.push({type:t.schedule.status==="critical"?"critical":"warning",title:"Schedule Alert",description:t.schedule.label,action:"Review progress",actionTarget:"overview",projectId:a.id}),(t.corExposure.status==="warning"||t.corExposure.status==="critical")&&n.push({type:t.corExposure.status==="critical"?"critical":"warning",title:"COR Exposure",description:t.corExposure.label,action:"Review pending CORs",actionTarget:"cors",projectId:a.id}),t.activity.status==="warning"&&n.push({type:"info",title:"Activity Notice",description:t.activity.label,action:"File daily report",actionTarget:"reports",projectId:a.id});const r={critical:0,warning:1,info:2};return n.sort((c,o)=>r[c.type]-r[o.type]),n}function kl(s){const{actualProgress:a,totalCosts:n,earnedRevenue:t,contractValue:r}=s;if(!a||a<=0)return{estimatedCompletionCost:null,estimatedFinalMargin:null,estimatedCompletionDate:null};const c=n/a,o=Math.round(c*100),d=r>0?(r-o)/r*100:0;let h=null;if(s.startDate&&a>0&&a<100){const u=new Date(s.startDate),l=new Date,f=Math.max(1,(l-u)/(1e3*60*60*24)),j=a/f,m=(100-a)/j;h=new Date(l.getTime()+m*24*60*60*1e3)}return{estimatedCompletionCost:o,estimatedFinalMargin:d,estimatedCompletionDate:h,costPerPercent:c}}function Oa(s){return s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(0)+"K":s.toFixed(0)}function Dl({isOpen:s,onClose:a,companyId:n,onSelectProject:t,onSelectTicket:r,onSelectCOR:c,onShowToast:o}){const[d,h]=i.useState(""),[u,l]=i.useState({projects:[],tickets:[],cors:[],workers:[]}),[f,j]=i.useState(!1),[g,m]=i.useState(0),p=i.useRef(null),w=i.useRef(null),E=i.useRef(null);i.useEffect(()=>()=>{w.current&&clearTimeout(w.current),E.current&&clearTimeout(E.current)},[]),i.useEffect(()=>{s&&(h(""),l({projects:[],tickets:[],cors:[],workers:[]}),m(0),E.current=setTimeout(()=>p.current?.focus(),50))},[s]);const v=i.useCallback(async N=>{if(!N.trim()||N.length<2){l({projects:[],tickets:[],cors:[],workers:[]});return}j(!0);try{const A=await T.universalSearch(n,N.trim());l(A),m(0)}catch(A){console.error("Search error:",A),o?.("Search failed","error")}finally{j(!1)}},[n,o]),S=N=>{const A=N.target.value;h(A),w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{v(A)},200)},y=(()=>{const N=[];return u.projects.forEach(A=>N.push({type:"project",data:A})),u.tickets.forEach(A=>N.push({type:"ticket",data:A})),u.cors.forEach(A=>N.push({type:"cor",data:A})),u.workers.forEach(A=>N.push({type:"worker",data:A})),N})(),R=y.length>0,F=N=>{N.key==="Escape"?a():N.key==="ArrowDown"?(N.preventDefault(),m(A=>Math.min(A+1,y.length-1))):N.key==="ArrowUp"?(N.preventDefault(),m(A=>Math.max(A-1,0))):N.key==="Enter"&&R&&(N.preventDefault(),k(y[g]))},k=N=>{if(N){switch(N.type){case"project":t?.(N.data);break;case"ticket":r?.(N.data);break;case"cor":c?.(N.data);break;case"worker":N.data.lastProject&&t?.(N.data.lastProject);break}a()}};return s?e.jsx("div",{className:"universal-search-overlay",onClick:a,children:e.jsxs("div",{className:"universal-search-modal",onClick:N=>N.stopPropagation(),children:[e.jsxs("div",{className:"universal-search-input-wrapper",children:[e.jsx(rt,{size:20,className:"universal-search-icon"}),e.jsx("input",{ref:p,type:"text",value:d,onChange:S,onKeyDown:F,placeholder:"Search projects, tickets, CORs, workers...",className:"universal-search-input",autoComplete:"off",autoCorrect:"off",spellCheck:"false"}),d&&e.jsx("button",{className:"universal-search-clear",onClick:()=>h(""),children:e.jsx(Fe,{size:16})}),e.jsx("div",{className:"universal-search-shortcut",children:e.jsx("span",{children:"esc"})})]}),e.jsx("div",{className:"universal-search-results",children:f?e.jsxs("div",{className:"universal-search-loading",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"Searching..."})]}):d.trim()?R?e.jsxs(e.Fragment,{children:[u.projects.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(Ma,{size:14}),e.jsx("span",{children:"Projects"})]}),u.projects.map((N,A)=>{const M=A;return e.jsxs("button",{className:`universal-search-item ${g===M?"selected":""}`,onClick:()=>k({type:"project",data:N}),onMouseEnter:()=>m(M),children:[e.jsx(Ma,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:N.name}),N.job_number&&e.jsxs("span",{className:"universal-search-item-meta",children:["#",N.job_number]})]}),e.jsx(Te,{size:16,className:"universal-search-item-arrow"})]},N.id)})]}),u.tickets.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(Le,{size:14}),e.jsx("span",{children:"T&M Tickets"})]}),u.tickets.map((N,A)=>{const M=u.projects.length+A;return e.jsxs("button",{className:`universal-search-item ${g===M?"selected":""}`,onClick:()=>k({type:"ticket",data:N}),onMouseEnter:()=>m(M),children:[e.jsx(Le,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[N.description?.substring(0,50)||"T&M Ticket",N.description?.length>50&&"..."]}),e.jsxs("span",{className:"universal-search-item-meta",children:[N.projectName," • ",N.work_date]})]}),e.jsx("span",{className:`universal-search-item-badge ${N.status}`,children:N.status})]},N.id)})]}),u.cors.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(ie,{size:14}),e.jsx("span",{children:"Change Orders"})]}),u.cors.map((N,A)=>{const M=u.projects.length+u.tickets.length+A;return e.jsxs("button",{className:`universal-search-item ${g===M?"selected":""}`,onClick:()=>k({type:"cor",data:N}),onMouseEnter:()=>m(M),children:[e.jsx(ie,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[N.cor_number?`COR #${N.cor_number}: `:"",N.title]}),e.jsx("span",{className:"universal-search-item-meta",children:N.projectName})]}),e.jsx("span",{className:`universal-search-item-badge ${N.status}`,children:N.status})]},N.id)})]}),u.workers.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx($e,{size:14}),e.jsx("span",{children:"Workers"})]}),u.workers.map((N,A)=>{const M=u.projects.length+u.tickets.length+u.cors.length+A;return e.jsxs("button",{className:`universal-search-item ${g===M?"selected":""}`,onClick:()=>k({type:"worker",data:N}),onMouseEnter:()=>m(M),children:[e.jsx($e,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:N.name}),e.jsxs("span",{className:"universal-search-item-meta",children:[N.role," • ",N.projectName]})]}),e.jsx(Te,{size:16,className:"universal-search-item-arrow"})]},`${N.name}-${A}`)})]})]}):e.jsx("div",{className:"universal-search-no-results",children:e.jsxs("span",{children:['No results for "',d,'"']})}):e.jsxs("div",{className:"universal-search-empty",children:[e.jsxs("div",{className:"universal-search-tip",children:[e.jsx(Lr,{size:14}),e.jsx("span",{children:"Type to search across all data"})]}),e.jsxs("div",{className:"universal-search-hints",children:[e.jsx("span",{children:"Projects"}),e.jsx("span",{children:"T&M Tickets"}),e.jsx("span",{children:"Change Orders"}),e.jsx("span",{children:"Workers"})]})]})}),e.jsxs("div",{className:"universal-search-footer",children:[e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↑↓"})," navigate"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↵"})," select"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"esc"})," close"]})]})]})}):null}function El(){const[s,a]=i.useState(!1);return i.useEffect(()=>{const n=t=>{(t.metaKey||t.ctrlKey)&&t.key==="k"&&(t.preventDefault(),a(r=>!r))};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[]),{isOpen:s,setIsOpen:a,open:()=>a(!0),close:()=>a(!1)}}function Sl({alerts:s=[],onAction:a,onDismiss:n,maxVisible:t=3,className:r=""}){const[c,o]=i.useState(new Set),d=s.filter(u=>!c.has(u.id||`${u.projectId}-${u.type}-${u.title}`)).slice(0,t),h=i.useCallback(u=>{const l=u.id||`${u.projectId}-${u.type}-${u.title}`;o(f=>new Set([...f,l])),n?.(u)},[n]);return d.length===0?null:e.jsxs("div",{className:`smart-alerts ${r}`,role:"region","aria-label":"Project alerts","aria-live":"polite",children:[d.map((u,l)=>e.jsx(_l,{alert:u,onAction:a,onDismiss:()=>h(u)},u.id||`${u.projectId}-${u.type}-${l}`)),s.length>t&&e.jsx("div",{className:"smart-alerts__overflow",children:e.jsxs("span",{className:"smart-alerts__overflow-text",children:["+",s.length-t," more alerts"]})})]})}function _l({alert:s,onAction:a,onDismiss:n}){const{type:t="info",title:r,description:c,action:o,actionTarget:d,projectId:h,projectName:u}=s,f={critical:$r,warning:da,info:oa}[t]||oa,j=()=>{a?.({target:d,projectId:h,alert:s})};return e.jsxs("div",{className:`smart-alert smart-alert--${t}`,role:"alert","aria-live":t==="critical"?"assertive":"polite",children:[e.jsx(f,{className:"smart-alert__icon","aria-hidden":"true"}),e.jsxs("div",{className:"smart-alert__content",children:[e.jsxs("div",{className:"smart-alert__title",children:[u&&e.jsxs("span",{className:"smart-alert__project",children:[u,": "]}),r]}),c&&e.jsx("div",{className:"smart-alert__description",children:c}),o&&e.jsx("div",{className:"smart-alert__action",children:e.jsxs("button",{type:"button",className:"smart-alert__action-btn",onClick:j,children:[o,e.jsx(qr,{size:14,"aria-hidden":"true"})]})})]}),n&&e.jsx("button",{type:"button",className:"smart-alert__dismiss",onClick:n,"aria-label":"Dismiss alert",children:e.jsx(Fe,{size:18,"aria-hidden":"true"})})]})}function Pl({project:s,company:a,onShowToast:n}){const[t,r]=i.useState(null),[c,o]=i.useState(!0),[d,h]=i.useState(!1);i.useEffect(()=>{if(s?.id&&a?.id){u();const m=T.subscribeToCrewCheckins?.(s.id,()=>{u()});return()=>{m&&T.unsubscribe?.(m)}}},[s?.id,a?.id]);const u=async()=>{try{const m=await T.calculateManDayCosts(s.id,a.id,s.work_type||"demolition",s.job_type||"standard");r(m)}catch(m){console.error("Error loading man day costs:",m)}finally{o(!1)}},l=m=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),f=m=>new Date(m).toLocaleDateString("en-US",{month:"short",day:"numeric"}),j=m=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[m]||m.charAt(0).toUpperCase()+m.slice(1);if(c)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!t||t.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(ua,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const g=Object.entries(t.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>h(!d),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:l(t.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:d?"▼ Collapse":"▶ Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:l(t.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.daysWorked>0?l(t.totalCost/t.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),d&&e.jsxs("div",{className:"man-day-details",children:[g.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:g.map(([m,p])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:j(m)}),e.jsxs("span",{className:"role-rate",children:[l(p.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[p.count," days"]}),e.jsx("span",{className:"role-cost",children:l(p.cost)})]})]},m))})]}),t.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:t.byDate.slice(0,7).map((m,p)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:f(m.date)}),e.jsxs("span",{className:"date-workers",children:[m.workers," crew"]}),e.jsx("span",{className:"date-cost",children:l(m.cost)})]},p))}),t.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",t.byDate.length-7," more days"]})]})]})]})}const Ol=i.memo(function({project:a,areas:n=[],corStats:t={},onCreateDraw:r,onViewDraw:c,onShowToast:o}){const[d,h]=i.useState([]),[u,l]=i.useState(!0),f=i.useMemo(()=>n.reduce((b,y)=>{const R=(y.square_footage||0)*(y.price_per_sqft||0);return b+Math.round(R*100)},0),[n]),j=i.useMemo(()=>t?.approvedTotal||0,[t?.approvedTotal]),g=f+j,m=i.useCallback(async()=>{if(a?.id)try{l(!0);const b=await Dr.getProjectDrawRequests(a.id);h(b||[])}catch(b){console.error("Error loading draw requests:",b)}finally{l(!1)}},[a?.id]);i.useEffect(()=>{m()},[m]);const p=i.useMemo(()=>{const b=d.filter(k=>["submitted","approved","paid"].includes(k.status)),y=b.reduce((k,N)=>k+(N.previous_billings||0)+(N.current_billing||0),0),F=b[0]?.retention_held||0;return{billedToDate:y,retentionHeld:F}},[d]),w=g>0?Math.round(p.billedToDate/g*100):0,E=d.length>0?Math.max(...d.map(b=>b.draw_number))+1:1,v=b=>b?new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",S=b=>{switch(b){case"draft":return e.jsx("span",{className:"badge badge-muted",children:"Draft"});case"submitted":return e.jsx("span",{className:"badge badge-warning",children:"Submitted"});case"approved":return e.jsx("span",{className:"badge badge-success",children:"Approved"});case"paid":return e.jsx("span",{className:"badge badge-info",children:"Paid"});case"rejected":return e.jsx("span",{className:"badge badge-danger",children:"Rejected"});default:return null}};return e.jsxs("div",{className:"progress-billing-card",children:[e.jsxs("div",{className:"progress-billing-header",children:[e.jsxs("div",{className:"progress-billing-title",children:[e.jsx(Vr,{size:18}),e.jsx("h3",{children:"Progress Billing"})]}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>r?.(),disabled:f===0,title:f===0?"Add areas with contract values first":`Create Draw #${E}`,children:[e.jsx(qe,{size:14}),e.jsxs("span",{children:["Draw #",E]})]})]}),e.jsxs("div",{className:"progress-billing-contract",children:[e.jsxs("div",{className:"contract-row",children:[e.jsx("span",{className:"contract-label",children:"Original Contract"}),e.jsx("span",{className:"contract-value",children:ee(f)})]}),j>0&&e.jsxs("div",{className:"contract-row co",children:[e.jsx("span",{className:"contract-label",children:"Approved COs"}),e.jsxs("span",{className:"contract-value positive",children:["+",ee(j)]})]}),e.jsxs("div",{className:"contract-row revised",children:[e.jsx("span",{className:"contract-label",children:"Revised Contract"}),e.jsx("span",{className:"contract-value",children:ee(g)})]})]}),e.jsxs("div",{className:"progress-billing-status",children:[e.jsx("div",{className:"billing-progress-bar",children:e.jsx("div",{className:"billing-progress-fill",style:{width:`${Math.min(w,100)}%`}})}),e.jsxs("div",{className:"billing-stats",children:[e.jsxs("div",{className:"billing-stat",children:[e.jsx("span",{className:"billing-stat-value",children:ee(p.billedToDate)}),e.jsxs("span",{className:"billing-stat-label",children:["Billed to Date (",w,"%)"]})]}),p.retentionHeld>0&&e.jsxs("div",{className:"billing-stat retention",children:[e.jsxs("span",{className:"billing-stat-value",children:["-",ee(p.retentionHeld)]}),e.jsx("span",{className:"billing-stat-label",children:"Retention Held"})]}),e.jsxs("div",{className:"billing-stat remaining",children:[e.jsx("span",{className:"billing-stat-value",children:ee(g-p.billedToDate)}),e.jsx("span",{className:"billing-stat-label",children:"Balance to Finish"})]})]})]}),u?e.jsx("div",{className:"progress-billing-loading",children:e.jsx("div",{className:"loading-spinner small"})}):d.length===0?e.jsxs("div",{className:"progress-billing-empty",children:[e.jsx("p",{children:"No draw requests yet"}),f>0&&e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>r?.(),children:[e.jsx(qe,{size:14}),"Create First Draw Request"]})]}):e.jsxs("div",{className:"progress-billing-draws",children:[e.jsx("div",{className:"draws-header",children:e.jsx("span",{children:"Recent Draws"})}),e.jsx("div",{className:"draws-list",children:d.slice(0,3).map(b=>e.jsxs("button",{className:"draw-item",onClick:()=>c?.(b),children:[e.jsxs("div",{className:"draw-item-info",children:[e.jsxs("span",{className:"draw-number",children:["Draw #",b.draw_number]}),e.jsx("span",{className:"draw-date",children:v(b.period_end||b.created_at)})]}),e.jsx("div",{className:"draw-item-amount",children:ee(b.current_billing||0)}),S(b.status),e.jsx(Te,{size:16,className:"draw-item-arrow"})]},b.id))}),d.length>3&&e.jsxs("button",{className:"btn btn-sm btn-ghost view-all-draws",children:["View all ",d.length," draws"]})]})]})}),Aa=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",Al=i.memo(function({project:a,onAddEquipment:n,onEditEquipment:t,onShowToast:r}){const[c,o]=i.useState([]),[d,h]=i.useState(!0),[u,l]=i.useState(!0),[f,j]=i.useState(0),g=i.useCallback(async()=>{if(a?.id)try{h(!0);const v=await be.getProjectEquipment(a.id);o(v||[]);const S=be.calculateProjectEquipmentCost(v||[]);j(S)}catch(v){console.error("Error loading equipment:",v),r?.("Failed to load equipment","error")}finally{h(!1)}},[a?.id]);i.useEffect(()=>{g()},[g]);const m=i.useCallback(async v=>{try{await be.markEquipmentReturned(v.id),r?.(`${v.equipment_name} marked as returned`,"success"),g()}catch(S){console.error("Error marking equipment returned:",S),r?.("Failed to update equipment","error")}},[g]),p=i.useCallback(async v=>{if(confirm(`Remove ${v.equipment_name} from this project?`))try{await be.removeEquipmentFromProject(v.id),r?.("Equipment removed","success"),g()}catch(S){console.error("Error removing equipment:",S),r?.("Failed to remove equipment","error")}},[g]),w=i.useMemo(()=>c.filter(v=>!v.end_date),[c]),E=i.useMemo(()=>c.filter(v=>v.end_date),[c]);return e.jsxs("div",{className:"project-equipment-card",children:[e.jsxs("div",{className:"project-equipment-header",children:[e.jsxs("div",{className:"project-equipment-title",children:[e.jsx(Me,{size:18}),e.jsx("h3",{children:"Equipment on Site"}),c.length>0&&e.jsxs("span",{className:"equipment-count",children:[w.length," active"]})]}),e.jsxs("div",{className:"project-equipment-actions",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>n?.(),title:"Add equipment",children:[e.jsx(qe,{size:14}),e.jsx("span",{children:"Add"})]}),c.length>0&&e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>l(!u),children:u?e.jsx(xa,{size:16}):e.jsx(ze,{size:16})})]})]}),d?e.jsx("div",{className:"equipment-loading",children:e.jsx("div",{className:"loading-spinner small"})}):c.length===0?e.jsxs("div",{className:"equipment-empty",children:[e.jsx("p",{children:"No equipment tracked on this project"}),e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>n?.(),children:[e.jsx(qe,{size:14}),"Track Equipment"]})]}):u?e.jsxs(e.Fragment,{children:[w.length>0&&e.jsx("div",{className:"equipment-list",children:w.map(v=>{const S=be.calculateDaysOnSite(v.start_date,v.end_date),b=v.daily_rate*S;return e.jsxs("div",{className:"equipment-item active",children:[e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:v.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[e.jsx(Fr,{size:12}),"On-site since ",Aa(v.start_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-rate",children:[ee(v.daily_rate),"/day"]}),e.jsxs("span",{className:"equipment-days",children:[S," days"]}),e.jsx("span",{className:"equipment-total",children:ee(b)})]})]}),e.jsxs("div",{className:"equipment-item-actions",children:[e.jsxs("button",{className:"btn btn-xs btn-outline",onClick:()=>m(v),title:"Mark as returned",children:[e.jsx(zr,{size:12}),"Returned"]}),e.jsx("button",{className:"btn btn-xs btn-ghost",onClick:()=>t?.(v),title:"Edit",children:e.jsx(Br,{size:12})}),e.jsx("button",{className:"btn btn-xs btn-ghost text-danger",onClick:()=>p(v),title:"Remove",children:e.jsx(it,{size:12})})]})]},v.id)})}),E.length>0&&e.jsxs("details",{className:"equipment-returned-section",children:[e.jsx("summary",{className:"equipment-returned-toggle",children:e.jsxs("span",{children:["Returned Equipment (",E.length,")"]})}),e.jsx("div",{className:"equipment-list returned",children:E.map(v=>{const S=be.calculateDaysOnSite(v.start_date,v.end_date),b=v.daily_rate*S;return e.jsx("div",{className:"equipment-item returned",children:e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:v.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[Aa(v.start_date)," - ",Aa(v.end_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-days",children:[S," days"]}),e.jsx("span",{className:"equipment-total",children:ee(b)})]})]})},v.id)})})]}),e.jsxs("div",{className:"equipment-total-row",children:[e.jsx("span",{children:"Total Equipment Cost"}),e.jsx("span",{className:"equipment-grand-total",children:ee(f)})]})]}):e.jsxs("div",{className:"equipment-summary-collapsed",children:[e.jsxs("span",{children:[w.length," active, ",E.length," returned"]}),e.jsx("span",{className:"equipment-grand-total",children:ee(f)})]})]})}),oe=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),Rl=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"});function Ml({dailyBurn:s,totalBurn:a,daysWorked:n,laborCost:t,materialsEquipmentCost:r=0,progress:c,contractValue:o,laborByDate:d=[],materialsEquipmentByDate:h=[]}){const[u,l]=i.useState(!1),f=o*(c/100)*.6,j=a<=f?"on-budget":a<=f*1.2?"warning":"over-budget",g={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[j],m=j==="on-budget"?fa:j==="warning"?Ba:ja,w=c>0?a/(c/100):0,E=[],v={};d.forEach(b=>{v[b.date]||(v[b.date]={date:b.date,labor:0,materialsEquipment:0,total:0}),v[b.date].labor=b.cost||0,v[b.date].total+=b.cost||0}),h.forEach(b=>{v[b.date]||(v[b.date]={date:b.date,labor:0,materialsEquipment:0,total:0}),v[b.date].materialsEquipment=b.cost||0,v[b.date].total+=b.cost||0}),Object.values(v).sort((b,y)=>new Date(y.date)-new Date(b.date)).slice(0,10).forEach(b=>E.push(b));const S=Math.max(...E.map(b=>b.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(Wr,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${j}`,children:[e.jsx(m,{size:14}),e.jsx("span",{children:g})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:oe(s)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),n>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",n," work day",n!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:oe(a)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:oe(t)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Materials"}),e.jsx("span",{className:"burn-summary-value",children:oe(r)})]})]}),c>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${w>o*.7?"warning":""}`,children:oe(w)})]}),E.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>l(!u),children:[u?e.jsx(xa,{size:16}):e.jsx(ze,{size:16}),e.jsxs("span",{children:[u?"Hide":"View"," Daily Breakdown"]})]}),u&&E.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Materials"}),e.jsx("span",{children:"Total"})]}),E.map(b=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:Rl(b.date)}),e.jsx("span",{className:"burn-labor",children:b.labor>0?oe(b.labor):"-"}),e.jsx("span",{className:"burn-materials",children:b.materialsEquipment>0?oe(b.materialsEquipment):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${b.total/S*100}%`}}),e.jsx("span",{className:"burn-amount",children:oe(b.total)})]})]},b.date))]})]})}const $={contract:"#3b82f6",revenue:"#10b981",costs:"#f59e0b",profit:"#22c55e",loss:"#ef4444",tmValue:"#8b5cf6",corValue:"#14b8a6",labor:"#6366f1",disposal:"#14b8a6",equipment:"#f97316",materials:"#a855f7",subcontractor:"#ec4899",other:"#6b7280"},Re={duration:800},Ws={labor:{label:"Labor",color:$.labor,icon:"HardHat"},disposal:{label:"Disposal",color:$.disposal,icon:"Trash2"},equipment:{label:"Equipment",color:$.equipment,icon:"Truck"},materials:{label:"Materials",color:$.materials,icon:"Package"},subcontractor:{label:"Subcontractor",color:$.subcontractor,icon:"Users"},other:{label:"Other",color:$.other,icon:"MoreHorizontal"}},Ks=[{id:"7d",label:"7D",days:7},{id:"30d",label:"30D",days:30},{id:"90d",label:"90D",days:90},{id:"all",label:"All",days:null}],ve=s=>s>=1e6?`$${(s/1e6).toFixed(1)}M`:s>=1e3?`$${(s/1e3).toFixed(0)}K`:`$${s.toFixed(0)}`,ft=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}),Il={revenue:{id:"revenueGradient",color:$.revenue,startOpacity:.3,endOpacity:0},costs:{id:"costsGradient",color:$.costs,startOpacity:.3,endOpacity:0},tmValue:{id:"tmValueGradient",color:$.tmValue,startOpacity:.2,endOpacity:0}};function Tl(s,a,n=[],t=null,r=[]){const c=a?.contract_value||0,o=s?.laborByDate||[],d=s?.haulOffByDate||[],h=s?.materialsEquipmentByDate||[],u=s?.customCosts||[],l=new Set;o.forEach(y=>l.add(y.date)),d.forEach(y=>l.add(y.date)),h.forEach(y=>l.add(y.date)),u.forEach(y=>{y.cost_date&&l.add(y.cost_date)}),n.forEach(y=>{y.work_date&&l.add(y.work_date),y.ticket_date&&l.add(y.ticket_date),y.created_at&&l.add(y.created_at.split("T")[0])}),r.forEach(y=>{y.status==="done"&&y.updated_at&&l.add(y.updated_at.split("T")[0])});const f=[...l].sort((y,R)=>new Date(y)-new Date(R));if(f.length===0)return[];const j={},g=r.reduce((y,R)=>y+(parseFloat(R.weight)||0),0);r.forEach(y=>{if(y.status==="done"&&y.updated_at){const R=y.updated_at.split("T")[0],F=parseFloat(y.weight)||0,k=y.scheduled_value?parseFloat(y.scheduled_value):g>0?F/g*c:0;j[R]||(j[R]=0),j[R]+=k}});let m=0,p=0;const w={};n.forEach(y=>{const R=y.work_date||y.ticket_date||y.created_at?.split("T")[0];if(!R)return;let F=0;const k=y.t_and_m_workers||y.workers||[];Array.isArray(k)&&k.forEach(A=>{const M=parseFloat(A.hours)||parseFloat(A.regular_hours)||0,z=parseFloat(A.overtime_hours)||0,G=parseFloat(A.regular_rate)||parseFloat(A.rate)||65,Y=parseFloat(A.overtime_rate)||G*1.5;F+=M*G+z*Y});const N=y.t_and_m_items||y.items||[];Array.isArray(N)&&N.forEach(A=>{const M=parseFloat(A.quantity)||1,z=parseFloat(A.unit_cost)||parseFloat(A.materials_equipment?.cost_per_unit)||0;F+=M*z}),w[R]||(w[R]=0),w[R]+=F});const E={};u.forEach(y=>{const R=y.cost_date;R&&(E[R]||(E[R]=0),E[R]+=parseFloat(y.amount)||0)});const v={};h.forEach(y=>{y.date&&(v[y.date]=y.cost||0)});let S=0;return f.map(y=>{const F=o.find(me=>me.date===y)?.cost||0,N=d.find(me=>me.date===y)?.cost||0,A=v[y]||0,M=E[y]||0,z=F+A+N+M;m+=z;const G=w[y]||0;p+=G;const Y=j[y]||0;S+=Y;const ue=Object.keys(j).length>0?S:s?.billable||0;return{date:y,contract:c,revenue:Math.round(ue),costs:Math.round(m),tmValue:Math.round(p),corValue:Math.round(t?.total_approved_value||0),profit:Math.round(ue-m),dailyLabor:Math.round(F),dailyRevenue:Math.round(Y),dailyMaterials:Math.round(A),dailyHaulOff:Math.round(N),dailyCustom:Math.round(M),dailyTM:Math.round(G),dailyTotal:Math.round(z)}})}function Ll(s,a){if(!a||!s.length)return s;const n=new Date,t=new Date;return t.setDate(n.getDate()-a),s.filter(r=>new Date(r.date)>=t)}function $l(s=0,a=0,n=[]){const t=[];s>0&&t.push({name:"Labor",value:s,color:$.labor,category:"labor"}),a>0&&t.push({name:"Disposal",value:a,color:$.disposal,category:"disposal"});const r={};n.forEach(o=>{const d=o.category||"other";r[d]||(r[d]={items:[],total:0}),r[d].items.push(o),r[d].total+=parseFloat(o.amount)||0}),Object.entries(r).forEach(([o,d])=>{if(d.total>0){const h=Ws[o]||Ws.other;t.push({name:h.label,value:d.total,color:h.color,category:o,items:d.items})}});const c=t.reduce((o,d)=>o+d.value,0);return t.forEach(o=>{o.percentage=c>0?Math.round(o.value/c*100):0}),t.sort((o,d)=>d.value-o.value),t}function Us(s,a){if(!s||s.length<2)return{direction:"flat",percentage:0};const n=s.slice(-7);if(n.length<2)return{direction:"flat",percentage:0};const t=n[0][a]||0,r=n[n.length-1][a]||0;if(t===0)return{direction:r>0?"up":"flat",percentage:0};const c=(r-t)/t*100;return{direction:c>5?"up":c<-5?"down":"flat",percentage:Math.abs(Math.round(c))}}function ql({active:s,payload:a,label:n}){if(!s||!a||!a.length)return null;const t=c=>c>=1e6?`$${(c/1e6).toFixed(2)}M`:c>=1e3?`$${(c/1e3).toFixed(1)}K`:`$${c.toFixed(0)}`,r=a[0]?.payload||{};return e.jsxs("div",{className:"chart-tooltip",children:[e.jsx("div",{className:"chart-tooltip-date",children:ft(n)}),e.jsxs("div",{className:"chart-tooltip-rows",children:[r.contract!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:$.contract}}),"Contract"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.contract)})]}),r.revenue!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:$.revenue}}),"Revenue"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.revenue)})]}),r.costs!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:$.costs}}),"Costs"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.costs)})]}),r.tmValue!==void 0&&r.tmValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:$.tmValue}}),"T&M Value"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.tmValue)})]}),r.corValue!==void 0&&r.corValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:$.corValue}}),"COR Approved"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.corValue)})]}),r.profit!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:r.profit>=0?$.profit:$.loss}}),r.profit>=0?"Profit":"Loss"]}),e.jsx("span",{className:"chart-tooltip-value",style:{color:r.profit>=0?$.profit:$.loss},children:t(Math.abs(r.profit))})]})]}),(r.dailyRevenue>0||r.dailyLabor>0||r.dailyMaterials>0||r.dailyHaulOff>0||r.dailyTM>0)&&e.jsxs("div",{className:"chart-tooltip-daily",children:[e.jsx("div",{className:"chart-tooltip-daily-label",children:"Today's Activity"}),r.dailyRevenue>0&&e.jsx("div",{className:"chart-tooltip-daily-row earned",children:e.jsxs("span",{style:{color:$.revenue},children:["Areas Completed: ",t(r.dailyRevenue)]})}),r.dailyLabor>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Labor: ",t(r.dailyLabor)]}),r.dailyMaterials>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Materials: ",t(r.dailyMaterials)]}),r.dailyHaulOff>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Disposal: ",t(r.dailyHaulOff)]}),r.dailyTM>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["T&M Added: ",t(r.dailyTM)]}),r.dailyTotal>0&&e.jsx("div",{className:"chart-tooltip-daily-row total",children:e.jsxs("strong",{children:["Day Costs: ",t(r.dailyTotal)]})})]}),e.jsx("div",{className:"chart-tooltip-hint",children:"Click to see details"})]})}function Vl({projectData:s,project:a,tmTickets:n=[],corStats:t=null,areas:r=[],onDrillDown:c}){const[o,d]=i.useState("30d"),[h,u]=i.useState(null),l=i.useMemo(()=>{const p=Tl(s,a,n,t,r),w=Ks.find(E=>E.id===o);return Ll(p,w?.days)},[s,a,n,t,r,o]),f=i.useMemo(()=>Us(l,"costs"),[l]),j=i.useMemo(()=>Us(l,"revenue"),[l]),g=p=>{if(p?.activePayload?.[0]){const w=p.activePayload[0].payload;c?.(w.date,w)}},m=({trend:p})=>p.direction==="up"?e.jsx(ja,{size:14,className:"trend-icon up"}):p.direction==="down"?e.jsx(fa,{size:14,className:"trend-icon down"}):e.jsx(Ba,{size:14,className:"trend-icon flat"});return l.length?e.jsxs("div",{className:"financial-trend-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title-section",children:[e.jsx("h3",{children:"Financial Trend"}),e.jsxs("div",{className:"chart-trend-indicators",children:[e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:$.revenue},children:"Revenue"}),e.jsx(m,{trend:j}),j.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[j.percentage,"%"]})]}),e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:$.costs},children:"Costs"}),e.jsx(m,{trend:f}),f.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[f.percentage,"%"]})]})]})]}),e.jsx("div",{className:"time-range-selector",children:Ks.map(p=>e.jsx("button",{className:o===p.id?"active":"",onClick:()=>d(p.id),children:p.label},p.id))})]}),e.jsx("div",{className:"chart-container",children:e.jsx(tt,{width:"100%",height:300,children:e.jsxs(hl,{data:l,onClick:g,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:Object.values(Il).map(p=>e.jsxs("linearGradient",{id:p.id,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:p.color,stopOpacity:p.startOpacity}),e.jsx("stop",{offset:"95%",stopColor:p.color,stopOpacity:p.endOpacity})]},p.id))}),e.jsx(Er,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(Sr,{dataKey:"date",tickFormatter:ft,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:{stroke:"var(--border-color)"}}),e.jsx(_r,{tickFormatter:ve,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:!1,width:60}),e.jsx(nt,{content:e.jsx(ql,{})}),e.jsx(Wa,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,formatter:p=>e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:p})}),l[0]?.contract>0&&e.jsx(ct,{y:l[0].contract,stroke:$.contract,strokeDasharray:"5 5",strokeWidth:2,label:{value:"Contract",position:"right",fill:$.contract,fontSize:11}}),e.jsx(Ae,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:$.revenue,strokeWidth:2,fill:"url(#revenueGradient)",animationDuration:Re.duration,onMouseEnter:()=>u("revenue"),onMouseLeave:()=>u(null),style:{opacity:h&&h!=="revenue"?.3:1}}),e.jsx(Ae,{type:"monotone",dataKey:"costs",name:"Costs",stroke:$.costs,strokeWidth:2,fill:"url(#costsGradient)",animationDuration:Re.duration,onMouseEnter:()=>u("costs"),onMouseLeave:()=>u(null),style:{opacity:h&&h!=="costs"?.3:1}}),l.some(p=>p.tmValue>0)&&e.jsx(Ae,{type:"monotone",dataKey:"tmValue",name:"T&M Value",stroke:$.tmValue,strokeWidth:2,fill:"url(#tmValueGradient)",animationDuration:Re.duration,onMouseEnter:()=>u("tmValue"),onMouseLeave:()=>u(null),style:{opacity:h&&h!=="tmValue"?.3:1}}),l.some(p=>p.corValue>0)&&e.jsx(Ae,{type:"monotone",dataKey:"corValue",name:"COR Approved",stroke:$.corValue,strokeWidth:2,strokeDasharray:"4 2",fill:"transparent",animationDuration:Re.duration,onMouseEnter:()=>u("corValue"),onMouseLeave:()=>u(null),style:{opacity:h&&h!=="corValue"?.3:1}})]})})}),e.jsxs("div",{className:"chart-quick-stats",children:[e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Current Revenue"}),e.jsx("span",{className:"stat-value",style:{color:$.revenue},children:ve(l[l.length-1]?.revenue||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Total Costs"}),e.jsx("span",{className:"stat-value",style:{color:$.costs},children:ve(l[l.length-1]?.costs||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Margin"}),e.jsx("span",{className:"stat-value",style:{color:(l[l.length-1]?.profit||0)>=0?$.profit:$.loss},children:(()=>{const p=l[l.length-1];return!p||!p.revenue?"0%":`${((p.revenue-p.costs)/p.revenue*100).toFixed(1)}%`})()})]}),l[l.length-1]?.tmValue>0&&e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"T&M Pending"}),e.jsx("span",{className:"stat-value",style:{color:$.tmValue},children:ve(l[l.length-1]?.tmValue||0)})]})]})]}):e.jsx("div",{className:"financial-trend-chart empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No financial data available yet."}),e.jsx("span",{children:"Start tracking labor and costs to see trends."})]})})}function Fl({laborCost:s=0,haulOffCost:a=0,customCosts:n=[],onSegmentClick:t}){const[r,c]=i.useState(null),o=i.useMemo(()=>$l(s,a,n),[s,a,n]),d=i.useMemo(()=>o.reduce((g,m)=>g+m.value,0),[o]),h=(g,m)=>{c(m)},u=()=>{c(null)},l=(g,m)=>{t&&t(o[m])},f=({active:g,payload:m})=>{if(!g||!m||!m.length)return null;const p=m[0].payload;return e.jsxs("div",{className:"chart-tooltip donut-tooltip",children:[e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:p.color}}),p.name]}),e.jsx("span",{className:"chart-tooltip-value",children:ve(p.value)})]}),e.jsxs("div",{className:"donut-tooltip-pct",children:[p.percentage,"% of total costs"]}),p.items&&p.items.length>0&&e.jsx("div",{className:"donut-tooltip-items",children:e.jsxs("div",{className:"donut-tooltip-items-label",children:[p.items.length," item",p.items.length>1?"s":""]})}),t&&e.jsx("div",{className:"chart-tooltip-hint",children:"Click to view details"})]})},j=g=>{const{payload:m}=g;return e.jsx("div",{className:"donut-legend",children:m.map((p,w)=>e.jsxs("div",{className:`donut-legend-item ${r===w?"active":""}`,onMouseEnter:()=>c(w),onMouseLeave:()=>c(null),onClick:()=>l(null,w),children:[e.jsx("span",{className:"donut-legend-color",style:{backgroundColor:p.payload.color}}),e.jsx("span",{className:"donut-legend-name",children:p.value}),e.jsx("span",{className:"donut-legend-value",children:ve(p.payload.value)})]},`legend-${w}`))})};return!o.length||d===0?e.jsx("div",{className:"cost-donut empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No cost data available."}),e.jsx("span",{children:"Add labor, disposal, or custom costs to see breakdown."})]})}):e.jsx("div",{className:"cost-donut",children:e.jsxs("div",{className:"donut-chart-container",children:[e.jsx(tt,{width:"100%",height:200,children:e.jsxs(Pr,{children:[e.jsx(Or,{data:o,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",onMouseEnter:h,onMouseLeave:u,onClick:l,animationDuration:Re.duration,animationEasing:"ease-out",children:o.map((g,m)=>e.jsx(Ar,{fill:g.color,stroke:"var(--card-bg)",strokeWidth:2,style:{filter:r===m?"brightness(1.1)":"none",cursor:t?"pointer":"default",transform:r===m?"scale(1.05)":"scale(1)",transformOrigin:"center",transition:"all 0.2s ease"}},`cell-${m}`))}),e.jsx(nt,{content:e.jsx(f,{})}),e.jsx(Wa,{content:j})]})}),e.jsxs("div",{className:"donut-center-label",children:[e.jsx("span",{className:"donut-center-value",children:ve(d)}),e.jsx("span",{className:"donut-center-text",children:"Total"})]})]})})}const Ra=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),ia={labor:{label:"Labor",Icon:ua,color:"#3b82f6"},disposal:{label:"Disposal",Icon:Me,color:"#10b981"},equipment:{label:"Equipment",Icon:Hr,color:"#f59e0b"},materials:{label:"Materials",Icon:Ur,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:$e,color:"#ec4899"},other:{label:"Other",Icon:Kr,color:"#6b7280"}};function zl({laborCost:s=0,haulOffCost:a=0,customCosts:n=[],onAddCost:t,onDeleteCost:r}){const[c,o]=i.useState(!0),[d,h]=i.useState(null),u=[];s>0&&u.push({category:"labor",label:"Labor",amount:s,source:"auto",description:"From crew check-ins"}),a>0&&u.push({category:"disposal",label:"Disposal",amount:a,source:"auto",description:"From haul-off logs"});const l={};n.forEach(m=>{l[m.category]||(l[m.category]={category:m.category,items:[],total:0}),l[m.category].items.push(m),l[m.category].total+=parseFloat(m.amount)||0}),Object.values(l).forEach(m=>{const p=ia[m.category]||ia.other;u.push({category:m.category,label:p.label,amount:m.total,source:"manual",items:m.items})});const f=u.reduce((m,p)=>m+p.amount,0);u.forEach(m=>{m.percentage=f>0?m.amount/f*100:0}),u.sort((m,p)=>p.amount-m.amount);const j=m=>{h(d===m?null:m)},g=m=>{m.items&&m.items.length>0&&(o(!1),h(m.category))};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsxs("div",{className:"cost-contributors-title",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:Ra(f)})]}),u.length>0&&e.jsxs("div",{className:"cost-view-toggle",children:[e.jsx("button",{className:c?"active":"",onClick:()=>o(!0),children:"Chart"}),e.jsx("button",{className:c?"":"active",onClick:()=>o(!1),children:"List"})]})]}),u.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):c?e.jsx(Fl,{laborCost:s,haulOffCost:a,customCosts:n,onSegmentClick:g}):e.jsx("div",{className:"cost-breakdown",children:u.map(m=>{const p=ia[m.category]||ia.other,w=p.Icon,E=m.items&&m.items.length>0,v=d===m.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${E?"expandable":""}`,onClick:()=>E&&j(m.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(m.percentage,2)}%`,backgroundColor:p.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(w,{size:14,style:{color:p.color}}),e.jsx("span",{children:m.label}),m.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),E&&(v?e.jsx(xa,{size:14}):e.jsx(ze,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:Ra(m.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(m.percentage),"%"]})]})]})]}),v&&E&&e.jsx("div",{className:"cost-category-items",children:m.items.map(S=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:S.description}),e.jsx("span",{className:"cost-item-date",children:new Date(S.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:Ra(S.amount)}),r&&e.jsx("button",{className:"cost-item-delete",onClick:b=>{b.stopPropagation(),confirm("Delete this cost entry?")&&r(S.id)},children:e.jsx(it,{size:14})})]})]},S.id))})]},m.category)})}),t&&e.jsxs("button",{className:"cost-add-btn",onClick:t,children:[e.jsx(qe,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const pe=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0);function Bl({revenue:s,totalCosts:a,contractValue:n,progress:t}){const r=s-a,c=s>0?r/s*100:0,o=n,d=t>0?a/(t/100):a,h=o-d,u=o>0?h/o*100:0,l=c>=20,f=c>=0&&c<20,j=c<0,g=l?"healthy":f?"warning":"loss",m=l?"On Track":f?"Watch Margin":"Over Cost",p=l?Gr:f?Be:fa;return e.jsxs("div",{className:`profitability-card ${g}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${g}`,children:[e.jsx(p,{size:14}),e.jsx("span",{children:m})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${c<0?"negative":""}`,children:[Math.round(c),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${c<0?"negative":c<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(c),100)}%`}})})]}),t>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${u<0?"negative":""}`,children:[Math.round(u),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${u<0?"negative":u<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(u),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:pe(s)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",pe(a)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${r<0?"negative":"positive"}`,children:[r>=0?"":"-",pe(Math.abs(r))]})]})]}),t>10&&e.jsxs("div",{className:"profitability-insight",children:[l&&e.jsxs("p",{children:["At ",Math.round(t),"% complete, you're at ",pe(r)," profit.",h>0&&` Projected final profit: ${pe(h)}`]}),f&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",h<0&&` Trending toward ${pe(h)} loss.`]}),j&&e.jsxs("p",{children:["Currently over cost by ",pe(Math.abs(r)),". Immediate review recommended."]})]})]})}const jt=[{value:"concrete",label:"Concrete",icon:"🧱"},{value:"trash",label:"Trash",icon:"🗑️"},{value:"metals",label:"Metals",icon:"🔩"},{value:"hazardous_waste",label:"Hazardous",icon:"☣️"}],Wl=s=>jt.find(a=>a.value===s)||{label:s,icon:"📦"};function Kl({project:s,period:a="week"}){const[n,t]=i.useState([]),[r,c]=i.useState(!0),[o,d]=i.useState(!1);i.useEffect(()=>{s?.id&&h()},[s?.id,a]);const h=async()=>{try{c(!0);const m=a==="week"?7:a==="month"?30:14,p=await T.getDisposalLoadsHistory(s.id,m);t(p||[])}catch(m){console.error("Error loading disposal summary:",m)}finally{c(!1)}},u=n.reduce((m,p)=>{const w=p.load_type;return m[w]||(m[w]=0),m[w]+=p.load_count,m},{}),l=n.reduce((m,p)=>{const w=p.load_date||p.work_date;return m[w]||(m[w]={date:w,loads:[],total:0}),m[w].loads.push(p),m[w].total+=p.load_count,m},{}),f=Object.values(l).sort((m,p)=>new Date(p.date)-new Date(m.date)).slice(0,7),j=n.reduce((m,p)=>m+p.load_count,0),g=j>0;return r?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"header-left",children:[e.jsx(Me,{size:18}),e.jsx("span",{children:"Disposal Loads"})]})}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(Me,{size:18}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("span",{className:"period-badge",children:a==="week"?"Last 7 days":a==="month"?"Last 30 days":"Last 14 days"})]}),g?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"disposal-total-value",children:j}),e.jsx("span",{className:"disposal-total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:jt.map(m=>{const p=u[m.value]||0;if(p===0)return null;const w=Math.round(p/j*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"disposal-type-info",children:[e.jsx("span",{className:"disposal-type-icon",children:m.icon}),e.jsx("span",{className:"disposal-type-label",children:m.label})]}),e.jsxs("div",{className:"disposal-type-stats",children:[e.jsx("span",{className:"disposal-type-count",children:p}),e.jsx("div",{className:"disposal-type-bar",children:e.jsx("div",{className:"disposal-type-bar-fill",style:{width:`${w}%`}})})]})]},m.value)})}),f.length>0&&e.jsxs("button",{className:"disposal-expand-btn",onClick:()=>d(!o),children:[o?e.jsx(xa,{size:16}):e.jsx(ze,{size:16}),e.jsxs("span",{children:[o?"Hide":"View"," Daily Breakdown"]})]}),o&&f.length>0&&e.jsx("div",{className:"disposal-daily-breakdown",children:f.map(m=>{const p=new Date(m.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),w=m.loads.reduce((E,v)=>(E[v.load_type]||(E[v.load_type]=0),E[v.load_type]+=v.load_count,E),{});return e.jsxs("div",{className:"disposal-daily-row",children:[e.jsxs("div",{className:"disposal-daily-header",children:[e.jsx("span",{className:"disposal-daily-date",children:p}),e.jsxs("span",{className:"disposal-daily-total",children:[m.total," loads"]})]}),e.jsx("div",{className:"disposal-daily-types",children:Object.entries(w).map(([E,v])=>{const S=Wl(E);return e.jsxs("span",{className:"disposal-daily-type",children:[S.icon," ",v]},E)})})]},m.date)})})]}):e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx(Me,{size:32}),e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("span",{className:"text-muted",children:"Loads will appear here when logged by field crews"})]})]})}const Hs=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function Ul({project:s,company:a,user:n,isAdmin:t,onShowToast:r}){const[c,o]=i.useState([]),[d,h]=i.useState([]),[u,l]=i.useState(!0),[f,j]=i.useState(!1),[g,m]=i.useState(""),[p,w]=i.useState("Team Member"),[E,v]=i.useState(null);i.useEffect(()=>{s?.id&&S()},[s?.id]),i.useEffect(()=>{f&&a?.id&&b()},[f,a?.id]);const S=async()=>{try{l(!0);const k=await T.getProjectTeam(s.id);o(k)}catch(k){console.error("Error loading project team:",k)}finally{l(!1)}},b=async()=>{try{const k=await T.getCompanyMembers(a.id),N=c.map(M=>M.users?.id),A=k.filter(M=>!N.includes(M.users?.id));h(A)}catch(k){console.error("Error loading company members:",k)}},y=async()=>{if(!g){r("Select a team member","error");return}try{v("add"),await T.addProjectMember(s.id,g,p,n.id),r("Team member added","success"),j(!1),m(""),w("Team Member"),S()}catch(k){console.error("Error adding team member:",k),r("Error adding team member","error")}finally{v(null)}},R=async(k,N)=>{try{v(k.id),await T.updateProjectMemberRole(s.id,k.users?.id,N),r("Role updated","success"),S()}catch(A){console.error("Error updating role:",A),r("Error updating role","error")}finally{v(null)}},F=async k=>{try{v(k.id),await T.removeProjectMember(s.id,k.users?.id),r("Team member removed","success"),S()}catch(N){console.error("Error removing team member:",N),r("Error removing team member","error")}finally{v(null)}};return u?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx($e,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx($e,{size:18})," Project Team"]}),t&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>j(!0),children:[e.jsx(Yr,{size:14})," Add"]})]}),c.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",t&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:c.map(k=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:k.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:k.users?.email})]}),e.jsx("div",{className:"team-member-role",children:t?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:k.project_role,onChange:N=>R(k,N.target.value),disabled:E===k.id,className:"role-select",children:Hs.map(N=>e.jsx("option",{value:N,children:N},N))}),e.jsx(ze,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:k.project_role})}),t&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>F(k),disabled:E===k.id,title:"Remove from project",children:e.jsx(Xr,{size:14})})]},k.id))}),f&&e.jsx("div",{className:"modal-overlay",onClick:()=>j(!1),children:e.jsxs("div",{className:"modal-content small",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>j(!1),children:e.jsx(Fe,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:g,onChange:k=>m(k.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),d.map(k=>e.jsx("option",{value:k.users?.id,children:k.users?.name||k.users?.email},k.users?.id))]}),d.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:p,onChange:k=>w(k.target.value),className:"form-select",children:Hs.map(k=>e.jsx("option",{value:k,children:k},k))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>j(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:y,disabled:!g||E==="add",children:E==="add"?"Adding...":"Add to Project"})]})]})})]})}const B=i.memo(function({width:a,height:n,borderRadius:t="8px",className:r="",variant:c="default"}){const d=(()=>{switch(c){case"text":return{height:"1em",borderRadius:"4px"};case"circular":return{borderRadius:"50%"};case"rectangular":return{borderRadius:"0"};default:return{borderRadius:t}}})();return e.jsx("div",{className:`skeleton ${r}`,style:{width:a||"100%",height:n||d.height||"1rem",borderRadius:d.borderRadius},"aria-hidden":"true"})});i.memo(function({showProgress:a=!1}){return e.jsxs("div",{className:"metric-skeleton",children:[e.jsx(B,{width:"60%",height:"0.75rem",className:"skeleton-label"}),e.jsx(B,{width:"80%",height:"1.75rem",className:"skeleton-value"}),a&&e.jsx(B,{width:"100%",height:"6px",className:"skeleton-progress"})]})});const bc=i.memo(function({lines:a=3,showHeader:n=!0,showAction:t=!1}){return e.jsxs("div",{className:"card-skeleton","aria-busy":"true","aria-label":"Loading content",children:[n&&e.jsxs("div",{className:"card-skeleton-header",children:[e.jsx(B,{width:"40%",height:"1.25rem"}),t&&e.jsx(B,{width:"80px",height:"32px"})]}),e.jsx("div",{className:"card-skeleton-body",children:Array.from({length:a}).map((r,c)=>e.jsx(B,{width:`${100-c*15}%`,height:"1rem",className:"skeleton-line"},c))})]})});i.memo(function({count:a=3,showAvatar:n=!1,showAction:t=!1}){return e.jsx("div",{className:"list-skeleton","aria-busy":"true","aria-label":"Loading list",children:Array.from({length:a}).map((r,c)=>e.jsxs("div",{className:"list-item-skeleton",children:[n&&e.jsx(B,{width:"40px",height:"40px",variant:"circular"}),e.jsxs("div",{className:"list-item-skeleton-content",children:[e.jsx(B,{width:"60%",height:"1rem"}),e.jsx(B,{width:"40%",height:"0.75rem"})]}),t&&e.jsx(B,{width:"60px",height:"28px"})]},c))})});i.memo(function(){return e.jsx("div",{className:"financial-row-skeleton","aria-busy":"true","aria-label":"Loading financial data",children:[1,2,3].map(a=>e.jsxs("div",{className:"financial-card-skeleton",children:[e.jsxs("div",{className:"financial-card-skeleton-header",children:[e.jsx(B,{width:"24px",height:"24px",variant:"circular"}),e.jsx(B,{width:"60%",height:"1rem"})]}),e.jsx(B,{width:"50%",height:"2rem",className:"skeleton-hero-value"}),e.jsxs("div",{className:"financial-card-skeleton-details",children:[e.jsx(B,{width:"100%",height:"0.875rem"}),e.jsx(B,{width:"80%",height:"0.875rem"})]})]},a))})});i.memo(function({height:a="200px"}){return e.jsxs("div",{className:"chart-skeleton",style:{height:a},"aria-busy":"true","aria-label":"Loading chart",children:[e.jsx("div",{className:"chart-skeleton-bars",children:[40,65,45,80,55,70,50,75,60,85].map((n,t)=>e.jsx("div",{className:"chart-skeleton-bar",style:{height:`${n}%`}},t))}),e.jsx(B,{width:"100%",height:"1px",className:"chart-skeleton-axis"})]})});const ye=i.memo(function({count:a=3}){return e.jsx("div",{className:"ticket-skeleton-list","aria-busy":"true","aria-label":"Loading tickets",children:Array.from({length:a}).map((n,t)=>e.jsxs("div",{className:"ticket-skeleton-item",children:[e.jsxs("div",{className:"ticket-skeleton-header",children:[e.jsx(B,{width:"100px",height:"0.875rem"}),e.jsx(B,{width:"80px",height:"24px",borderRadius:"12px"})]}),e.jsx(B,{width:"90%",height:"1rem"}),e.jsxs("div",{className:"ticket-skeleton-footer",children:[e.jsx(B,{width:"60px",height:"0.75rem"}),e.jsx(B,{width:"60px",height:"0.75rem"}),e.jsx(B,{width:"60px",height:"0.75rem"})]})]},t))})}),Hl=i.memo(function(){return e.jsx("div",{className:"hero-metrics-skeleton","aria-busy":"true","aria-label":"Loading metrics",children:[1,2,3,4].map(a=>e.jsxs("div",{className:"hero-metric-skeleton",children:[e.jsx(B,{width:"80px",height:"0.75rem",className:"skeleton-label"}),e.jsx(B,{width:"120px",height:"1.75rem",className:"skeleton-value"}),e.jsx(B,{width:"100%",height:"4px",className:"skeleton-bar"})]},a))})}),yc=i.memo(function({title:a="Unable to load data",message:n="Something went wrong. Please try again.",error:t=null,onRetry:r=null,retryLabel:c="Try Again",variant:o="default",icon:d=null}){const u=d||(t?.message?.includes("network")||t?.message?.includes("offline")?Jr:da);return o==="compact"?e.jsxs("div",{className:"error-state error-state-compact",role:"alert",children:[e.jsx(u,{size:16,className:"error-state-icon","aria-hidden":"true"}),e.jsx("span",{className:"error-state-message",children:n}),r&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:r,"aria-label":c,children:e.jsx(Pa,{size:14})})]}):o==="inline"?e.jsxs("div",{className:"error-state error-state-inline",role:"alert",children:[e.jsxs("div",{className:"error-state-content",children:[e.jsx(u,{size:20,className:"error-state-icon","aria-hidden":"true"}),e.jsxs("div",{className:"error-state-text",children:[e.jsx("span",{className:"error-state-title",children:a}),e.jsx("span",{className:"error-state-message",children:n})]})]}),r&&e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:r,children:[e.jsx(Pa,{size:14})," ",c]})]}):e.jsxs("div",{className:"error-state",role:"alert","aria-live":"polite",children:[e.jsx("div",{className:"error-state-icon-wrapper",children:e.jsx(u,{size:32,className:"error-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"error-state-title",children:a}),e.jsx("p",{className:"error-state-message",children:n}),!1,r&&e.jsxs("button",{className:"btn btn-primary",onClick:r,children:[e.jsx(Pa,{size:16})," ",c]})]})}),Nc=i.memo(function({title:a="No data yet",message:n="Items will appear here once added.",icon:t=null,action:r=null,actionLabel:c="Get Started",onAction:o=null}){return e.jsxs("div",{className:"empty-state",role:"status",children:[t&&e.jsx("div",{className:"empty-state-icon-wrapper",children:e.jsx(t,{size:32,className:"empty-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"empty-state-title",children:a}),e.jsx("p",{className:"empty-state-message",children:n}),o&&e.jsx("button",{className:"btn btn-primary btn-small",onClick:o,children:c}),r&&!o&&r]})});i.memo(function({label:a,error:n,required:t=!1,hint:r,children:c,className:o=""}){return e.jsxs("div",{className:`form-field ${n?"has-error":""} ${o}`,children:[a&&e.jsxs("label",{className:"form-field-label",children:[a,t&&e.jsx("span",{className:"form-field-required",children:"*"})]}),e.jsx("div",{className:"form-field-input",children:c}),n&&e.jsxs("div",{className:"form-field-error",role:"alert",children:[e.jsx(Be,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:n})]}),r&&!n&&e.jsx("div",{className:"form-field-hint",children:r})]})});i.memo(function({type:a="text",value:n,onChange:t,onBlur:r,error:c,placeholder:o,disabled:d,min:h,max:u,step:l,pattern:f,required:j,autoComplete:g,name:m,id:p,className:w="","aria-label":E,"aria-describedby":v}){const S=p||m,b=c?`${S}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:a,id:S,name:m,value:n,onChange:t,onBlur:r,placeholder:o,disabled:d,min:h,max:u,step:l,pattern:f,required:j,autoComplete:g,className:`validated-input ${c?"has-error":""} ${w}`,"aria-label":E,"aria-invalid":!!c,"aria-describedby":c?b:v}),c&&e.jsxs("div",{id:b,className:"input-error-inline",role:"alert",children:[e.jsx(Be,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:c})]})]})});i.memo(function({value:a,onChange:n,onBlur:t,error:r,disabled:c,required:o,name:d,id:h,className:u="",children:l,"aria-label":f}){const j=h||d,g=r?`${j}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("select",{id:j,name:d,value:a,onChange:n,onBlur:t,disabled:c,required:o,className:`validated-select ${r?"has-error":""} ${u}`,"aria-label":f,"aria-invalid":!!r,"aria-describedby":r?g:void 0,children:l}),r&&e.jsxs("div",{id:g,className:"input-error-inline",role:"alert",children:[e.jsx(Be,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:r})]})]})});i.memo(function({value:a,onChange:n,onBlur:t,error:r,placeholder:c,disabled:o,required:d,rows:h=3,maxLength:u,name:l,id:f,className:j="","aria-label":g}){const m=f||l,p=r?`${m}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("textarea",{id:m,name:l,value:a,onChange:n,onBlur:t,placeholder:c,disabled:o,required:d,rows:h,maxLength:u,className:`validated-textarea ${r?"has-error":""} ${j}`,"aria-label":g,"aria-invalid":!!r,"aria-describedby":r?p:void 0}),u&&e.jsxs("div",{className:"textarea-counter",children:[a?.length||0," / ",u]}),r&&e.jsxs("div",{id:p,className:"input-error-inline",role:"alert",children:[e.jsx(Be,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:r})]})]})});const Gl=i.memo(function({count:a,label:n,variant:t="default",size:r="medium",pulse:c=!1,icon:o}){const[d,h]=i.useState(a),[u,l]=i.useState(!1);return i.useEffect(()=>{if(a!==d){l(!0);const f=setTimeout(()=>{l(!1),h(a)},400);return()=>clearTimeout(f)}},[a,d]),e.jsxs("span",{className:`count-badge count-badge-${t} count-badge-${r} ${c?"badge-new":""} ${u?"animate-count-up":""}`,title:n,children:[o&&e.jsx(o,{size:r==="small"?12:r==="large"?18:14}),e.jsx("span",{className:"count-badge-value",children:a}),n&&e.jsx("span",{className:"count-badge-label",children:n})]})}),Yl=i.memo(function({value:a,max:n=100,showLabel:t=!1,size:r="medium",variant:c="default",animated:o=!0}){const d=Math.min(100,Math.max(0,a/n*100)),h=r==="small"?"4px":r==="large"?"8px":"6px",u=c==="default"?d>=80?"danger":d>=60?"warning":"success":c;return e.jsxs("div",{className:`mini-progress mini-progress-${r}`,children:[e.jsx("div",{className:"mini-progress-track",style:{height:h},children:e.jsx("div",{className:`mini-progress-fill mini-progress-${u} ${o?"progress-animate":""}`,style:{width:`${d}%`}})}),t&&e.jsxs("span",{className:"mini-progress-label",children:[Math.round(d),"%"]})]})}),Xl=i.memo(function({value:a,previousValue:n,format:t="percent",inverted:r=!1,showValue:c=!0}){const o=a-n,d=n!==0?o/n*100:0;let h=o===0?"neutral":o>0?"up":"down",u="neutral";o!==0&&(r?u=o>0?"negative":"positive":u=o>0?"positive":"negative");const l=h==="up"?ja:h==="down"?fa:Ba,f=()=>{const j=Math.abs(o);switch(t){case"percent":return`${Math.abs(d).toFixed(1)}%`;case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(j);default:return j.toLocaleString()}};return e.jsxs("span",{className:`trend-indicator trend-${u}`,children:[e.jsx(l,{size:14}),c&&e.jsx("span",{className:"trend-value",children:f()})]})});i.memo(function({status:a="default",label:n,size:t="medium",pulse:r=!1}){return e.jsxs("span",{className:`status-dot-container status-dot-${t}`,children:[e.jsx("span",{className:`status-dot status-dot-${a} ${r?"status-dot-pulse":""}`}),n&&e.jsx("span",{className:"status-dot-label",children:n})]})});i.memo(function({data:a=[],width:n=80,height:t=24,strokeWidth:r=2,color:c="var(--accent-blue)",showArea:o=!0}){if(!a.length)return null;const d=Math.max(...a),h=Math.min(...a),u=d-h||1,l=a.map((j,g)=>{const m=g/(a.length-1)*n,p=t-(j-h)/u*(t-r*2)-r;return`${m},${p}`}).join(" "),f=`0,${t} ${l} ${n},${t}`;return e.jsxs("svg",{width:n,height:t,className:"sparkline",viewBox:`0 0 ${n} ${t}`,children:[o&&e.jsx("polygon",{points:f,fill:c,fillOpacity:"0.15"}),e.jsx("polyline",{points:l,fill:"none",stroke:c,strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]})});i.memo(function({items:a=[]}){return e.jsx("div",{className:"quick-stats",children:a.map((n,t)=>e.jsxs("span",{className:"quick-stat-item",children:[n.icon&&e.jsx(n.icon,{size:12}),e.jsx("span",{className:"quick-stat-value",children:n.value}),n.label&&e.jsx("span",{className:"quick-stat-label",children:n.label})]},t))})});i.memo(function({status:a,label:n,size:t="medium"}){const r={success:Zr,warning:da,danger:da,info:Is,pending:Is},c=r[a]||r.info;return e.jsxs("span",{className:`status-indicator status-indicator-${a} status-indicator-${t}`,children:[e.jsx(c,{size:t==="small"?12:t==="large"?18:14}),n&&e.jsx("span",{className:"status-indicator-label",children:n})]})});i.memo(function({current:a,previous:n,format:t="number",label:r,inverted:c=!1}){const o=a-n,d=c?o<0:o>0,h=c?o>0:o<0,u=l=>{switch(t){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(Math.abs(l));case"percent":return`${Math.abs(l).toFixed(1)}%`;default:return Math.abs(l).toLocaleString()}};return e.jsxs("div",{className:`metric-delta ${d?"positive":h?"negative":"neutral"}`,children:[e.jsx("span",{className:"metric-delta-arrow",children:o>0?"↑":o<0?"↓":"→"}),e.jsx("span",{className:"metric-delta-value",children:u(o)}),r&&e.jsx("span",{className:"metric-delta-label",children:r})]})});i.memo(function({value:a,max:n=100,size:t=40,strokeWidth:r=4,showValue:c=!0,color:o="var(--accent-blue)"}){const d=Math.min(100,Math.max(0,a/n*100)),h=(t-r)/2,u=h*2*Math.PI,l=u-d/100*u;return e.jsxs("div",{className:"circular-progress",style:{width:t,height:t},children:[e.jsxs("svg",{width:t,height:t,viewBox:`0 0 ${t} ${t}`,children:[e.jsx("circle",{className:"circular-progress-track",cx:t/2,cy:t/2,r:h,fill:"none",strokeWidth:r}),e.jsx("circle",{className:"circular-progress-fill",cx:t/2,cy:t/2,r:h,fill:"none",stroke:o,strokeWidth:r,strokeDasharray:u,strokeDashoffset:l,strokeLinecap:"round",transform:`rotate(-90 ${t/2} ${t/2})`,style:{transition:"stroke-dashoffset 0.5s ease"}})]}),c&&e.jsxs("span",{className:"circular-progress-value",children:[Math.round(d),"%"]})]})});i.memo(function({isOpen:a,onClose:n,title:t,children:r,size:c="medium",className:o="",showCloseButton:d=!0,closeOnOverlayClick:h=!0,closeOnEscape:u=!0,footer:l,ariaDescribedBy:f}){const j=i.useRef(null),g=i.useRef(null),m=i.useRef(`modal-title-${Math.random().toString(36).substr(2,9)}`);i.useEffect(()=>{if(a){g.current=document.activeElement;const v=setTimeout(()=>{j.current?.focus()},10);return()=>clearTimeout(v)}},[a]),i.useEffect(()=>{!a&&g.current&&g.current.focus()},[a]),i.useEffect(()=>{if(!a||!u)return;const v=S=>{S.key==="Escape"&&(S.preventDefault(),n())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[a,u,n]),i.useEffect(()=>{if(a){const v=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=v}}},[a]);const p=i.useCallback(v=>{if(v.key!=="Tab")return;const S=j.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!S||S.length===0)return;const b=S[0],y=S[S.length-1];v.shiftKey?document.activeElement===b&&(v.preventDefault(),y.focus()):document.activeElement===y&&(v.preventDefault(),b.focus())},[]),w=v=>{h&&v.target===v.currentTarget&&n()};if(!a)return null;const E={small:"modal-small",medium:"modal-medium",large:"modal-large",full:"modal-full"};return e.jsx("div",{className:"modal-overlay",onClick:w,role:"presentation",children:e.jsxs("div",{ref:j,className:`modal-content ${E[c]||""} ${o}`,role:"dialog","aria-modal":"true","aria-labelledby":t?m.current:void 0,"aria-describedby":f,tabIndex:-1,onKeyDown:p,onClick:v=>v.stopPropagation(),children:[t&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:m.current,children:t}),d&&e.jsx("button",{className:"close-btn",onClick:n,"aria-label":"Close modal",type:"button",children:e.jsx(Fe,{size:20})})]}),e.jsx("div",{className:"modal-body",children:r}),l&&e.jsx("div",{className:"modal-footer",children:l})]})})});const Oe=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),la=i.memo(function({icon:a,label:n,value:t,formattedValue:r,subLabel:c,progress:o,progressLabel:d,variant:h="default",trend:u,previousValue:l}){const f={default:"var(--accent-blue)",success:"var(--accent-green)",warning:"var(--accent-amber)",danger:"var(--accent-red)"};return e.jsxs("div",{className:"hero-metric-card hover-lift animate-fade-in-up",children:[e.jsxs("div",{className:"hero-metric-header",children:[e.jsx("div",{className:"hero-metric-icon",style:{color:f[h]},children:e.jsx(a,{size:18})}),e.jsx("span",{className:"hero-metric-label",children:n})]}),e.jsxs("div",{className:"hero-metric-value-row",children:[e.jsx("span",{className:`hero-metric-value hero-metric-${h}`,children:r}),u!==void 0&&l!==void 0&&e.jsx(Xl,{value:t,previousValue:l,format:"currency",inverted:n.toLowerCase().includes("cost")})]}),c&&e.jsx("span",{className:"hero-metric-sublabel",children:c}),o!==void 0&&e.jsxs("div",{className:"hero-metric-progress",children:[e.jsx(Yl,{value:o,max:100,size:"small",variant:h,showLabel:!0}),d&&e.jsx("span",{className:"hero-metric-progress-label",children:d})]})]})}),Jl=i.memo(function({contractValue:a=0,earnedRevenue:n=0,totalCosts:t=0,profit:r=0,progress:c=0,corApprovedValue:o=0,loading:d=!1,previousData:h}){const u=a+o,l=n>0?r/n*100:0,f=n>0?t/n*100:0,j=u>0?n/u*100:0,g=u>0?t/u*100:0,m=i.useMemo(()=>l>=20?"success":l>=10?"warning":l<0?"danger":"default",[l]),p=i.useMemo(()=>f<=60?"success":f<=80?"warning":"danger",[f]);return d?e.jsx(Hl,{}):e.jsxs("div",{className:"hero-metrics stagger-children",children:[e.jsx(la,{icon:ca,label:"Contract Value",value:u,formattedValue:Oe(u),subLabel:o>0?`+${Oe(o)} CORs`:null,variant:"default"}),e.jsx(la,{icon:ja,label:"Earned Revenue",value:n,formattedValue:Oe(n),progress:j,progressLabel:`${Math.round(j)}% of contract`,variant:"success",previousValue:h?.earnedRevenue,trend:h?n:void 0}),e.jsx(la,{icon:lt,label:"Total Costs",value:t,formattedValue:Oe(t),progress:g,progressLabel:`${Math.round(f)}% of revenue`,variant:p,previousValue:h?.totalCosts,trend:h?t:void 0}),e.jsx(la,{icon:Qr,label:"Profit",value:r,formattedValue:Oe(r),subLabel:`${l>=0?"+":""}${l.toFixed(1)}% margin`,variant:m,previousValue:h?.profit,trend:h?r:void 0})]})}),Gs=[{id:"overview",label:"Overview",shortLabel:"Overview",icon:si,description:"Metrics & trends",step:null},{id:"cors",label:"Change Orders",shortLabel:"CORs",icon:Le,description:"CORs & approvals",step:1},{id:"tickets",label:"T&M Tickets",shortLabel:"Tickets",icon:ie,description:"Field data",step:2},{id:"billing",label:"Billing",shortLabel:"Billing",icon:lt,description:"Invoices & billing",step:3}],Zl=i.memo(function({activeSection:a="overview",onSectionChange:n,collapsed:t=!1,onToggleCollapse:r,onMobileClose:c,stats:o={}}){const{corCount:d=0,ticketCount:h=0,corPending:u=0,ticketPending:l=0,billableCount:f=0,invoiceCount:j=0}=o,g=m=>m==="cors"&&d>0?{count:d,variant:u>0?"warning":"default",pending:u}:m==="tickets"&&h>0?{count:h,variant:l>0?"warning":"default",pending:l}:m==="billing"&&f>0?{count:f,variant:"success",pending:f}:null;return e.jsxs("nav",{className:`financials-nav ${t?"collapsed":""}`,"aria-label":"Financials sections",children:[c&&e.jsxs("div",{className:"financials-nav-mobile-header",children:[e.jsx("span",{className:"financials-nav-mobile-title",children:"Financials"}),e.jsx("button",{className:"financials-nav-mobile-close",onClick:c,"aria-label":"Close menu",children:e.jsx(Fe,{size:20})})]}),e.jsxs("button",{className:"financials-nav-toggle",onClick:r,"aria-label":t?"Expand sidebar":"Collapse sidebar",title:t?"Expand sidebar":"Collapse sidebar",children:[t?e.jsx(ei,{size:18}):e.jsx(ai,{size:18}),!t&&e.jsx("span",{children:"Collapse"})]}),e.jsx("div",{className:"financials-nav-items",children:Gs.map((m,p)=>{const w=a===m.id,E=m.icon,v=g(m.id),S=p<Gs.length-1&&m.step!==null;return e.jsxs("div",{className:"financials-nav-item-wrapper",children:[e.jsxs("button",{className:`financials-nav-item ${w?"active":""}`,onClick:()=>n?.(m.id),"aria-current":w?"page":void 0,title:`${m.label}${v?` (${v.count})`:""}`,children:[m.step&&!t&&e.jsx("span",{className:"financials-nav-step",children:m.step}),e.jsxs("div",{className:"financials-nav-icon",children:[e.jsx(E,{size:t?22:20}),v&&v.pending>0&&e.jsx("span",{className:"financials-nav-dot"})]}),t&&e.jsx("span",{className:"financials-nav-short-label",children:m.shortLabel}),!t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"financials-nav-content",children:[e.jsx("span",{className:"financials-nav-label",children:m.label}),e.jsx("span",{className:"financials-nav-desc",children:m.description})]}),v&&e.jsx(Gl,{count:v.count,size:"small",variant:v.variant}),e.jsx(Te,{size:16,className:"financials-nav-arrow"})]})]}),S&&!t&&e.jsx("div",{className:"financials-nav-connector",children:e.jsx("div",{className:"connector-line"})})]},m.id)})}),t&&e.jsxs("button",{className:"financials-nav-expand-btn",onClick:r,"aria-label":"Expand sidebar",children:[e.jsx(Te,{size:14}),e.jsx("span",{children:"Expand"})]})]})}),Ql=i.memo(function({progress:a=0,areasComplete:n=0,totalAreas:t=0,areasWorking:r=0,size:c=140,strokeWidth:o=10}){const[d,h]=i.useState(0),u=i.useRef(null);i.useEffect(()=>{const m=d,p=Math.min(100,Math.max(0,a)),w=800,E=performance.now(),v=S=>{const b=S-E,y=Math.min(b/w,1),R=1-Math.pow(1-y,3),F=m+(p-m)*R;h(F),y<1&&(u.current=requestAnimationFrame(v))};return u.current=requestAnimationFrame(v),()=>{u.current&&cancelAnimationFrame(u.current)}},[a]);const l=(c-o)/2,f=l*2*Math.PI,j=f-d/100*f,g=()=>d>=80?"var(--accent-green)":d>=50||d>=25?"var(--accent-blue)":"var(--text-muted)";return e.jsxs("div",{className:"overview-progress-gauge",children:[e.jsxs("div",{className:"progress-gauge-circle",style:{width:c,height:c},children:[e.jsxs("svg",{width:c,height:c,viewBox:`0 0 ${c} ${c}`,children:[e.jsx("circle",{className:"gauge-track",cx:c/2,cy:c/2,r:l,fill:"none",strokeWidth:o,stroke:"var(--bg-tertiary)"}),e.jsx("circle",{className:"gauge-fill",cx:c/2,cy:c/2,r:l,fill:"none",stroke:g(),strokeWidth:o,strokeDasharray:f,strokeDashoffset:j,strokeLinecap:"round",transform:`rotate(-90 ${c/2} ${c/2})`,style:{transition:"stroke 0.3s ease"}})]}),e.jsxs("div",{className:"gauge-center",children:[e.jsxs("span",{className:"gauge-value",children:[Math.round(d),"%"]}),e.jsx("span",{className:"gauge-label",children:"Complete"})]})]}),e.jsxs("div",{className:"gauge-areas-status",children:[e.jsxs("span",{className:"areas-count",children:[e.jsx("strong",{children:n}),"/",t," Areas Done"]}),r>0&&e.jsxs("span",{className:"areas-active",children:[r," active"]})]})]})}),ec=i.memo(function({earnedRevenue:a=0,totalCosts:n=0,laborCost:t=0,disposalCost:r=0,equipmentCost:c=0,materialsCost:o=0,otherCost:d=0,contractValue:h=0}){const u=a-n,l=a>0?u/a*100:0,f=u>=0,j=p=>p>=1e6?`$${(p/1e6).toFixed(1)}M`:p>=1e3?`$${(p/1e3).toFixed(1)}K`:`$${p.toFixed(0)}`,g=[{key:"labor",value:t,color:$.labor,label:"Labor"},{key:"disposal",value:r,color:$.disposal,label:"Disposal"},{key:"equipment",value:c,color:$.equipment,label:"Equipment"},{key:"materials",value:o,color:$.materials,label:"Materials"},{key:"other",value:d,color:$.other,label:"Other"}].filter(p=>p.value>0),m=g.length>0&&n>0;return e.jsxs("div",{className:"overview-financial-card animate-fade-in-up",children:[e.jsxs("div",{className:"financial-metrics-row",children:[e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value green",children:j(a)}),e.jsx("span",{className:"financial-metric-label",children:"Earned"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value amber",children:j(n)}),e.jsx("span",{className:"financial-metric-label",children:"Costs"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsxs("span",{className:`financial-metric-value ${f?"green":"red"}`,children:[f?"":"-",j(Math.abs(u))]}),e.jsxs("span",{className:"financial-metric-label",children:["Profit",e.jsxs("span",{className:`margin-badge ${f?"positive":"negative"}`,children:[l>=0?"+":"",l.toFixed(0),"%"]})]})]})]}),m&&e.jsxs("div",{className:"cost-breakdown-section",children:[e.jsx("div",{className:"cost-breakdown-bar",children:g.map((p,w)=>{const E=p.value/n*100;return e.jsx("div",{className:"cost-segment",style:{width:`${E}%`,backgroundColor:p.color,animationDelay:`${w*100}ms`},title:`${p.label}: ${j(p.value)} (${E.toFixed(0)}%)`},p.key)})}),e.jsx("div",{className:"cost-breakdown-legend",children:g.slice(0,4).map(p=>e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot",style:{backgroundColor:p.color}}),e.jsx("span",{className:"legend-label",children:p.label})]},p.key))})]})]})}),ac=i.lazy(()=>Z(()=>import("./TMList-Rfc_Alvx.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),sc=i.lazy(()=>Z(()=>import("./ShareModal-D3yYHayO.js"),__vite__mapDeps([9,2,3,4,1,5,6]))),tc=i.lazy(()=>Z(()=>import("./InjuryReportsList-D1nDgKDi.js"),__vite__mapDeps([10,1,2,3,4,5,6,8]))),nc=i.lazy(()=>Z(()=>import("./NotificationSettings-Dv6POBc1.js"),__vite__mapDeps([11,2,3,4,1,5,6]))),rc=i.lazy(()=>Z(()=>import("./DailyReportsList-Brb4wmyj.js"),__vite__mapDeps([12,1,2,3,4,5,6,8]))),ic=i.lazy(()=>Z(()=>import("./CORList-BGLrBuYD.js"),__vite__mapDeps([13,1,2,3,4,5,6,8]))),lc=i.lazy(()=>Z(()=>import("./CORForm-DQC2J64i.js"),__vite__mapDeps([14,2,3,4,1,5,6,8]))),cc=i.lazy(()=>Z(()=>import("./CORDetail-Fg1unTpx.js"),__vite__mapDeps([15,2,3,4,1,5,6,8,7]))),oc=i.lazy(()=>Z(()=>import("./BillingCenter-CNisgNis.js"),__vite__mapDeps([16,2,3,4,1,5,6,8]))),dc=i.lazy(()=>Z(()=>import("./DrawRequestModal-DcrpS29Z.js"),__vite__mapDeps([17,2,3,4,1,5,6,8]))),uc=i.lazy(()=>Z(()=>import("./EquipmentModal-DP0QPrYa.js"),__vite__mapDeps([18,2,3,4,1,5,6]))),mc=i.lazy(()=>Z(()=>import("./AddCostModal-CWfkj9eZ.js"),__vite__mapDeps([19,2,3,4,1,5,6]))),hc=i.lazy(()=>Z(()=>import("./DocumentsTab-B-Xav4q_.js"),__vite__mapDeps([20,2,3,4,1,5,6])));function pc({company:s,user:a,isAdmin:n,onShowToast:t,navigateToProjectId:r,onProjectNavigated:c}){const[o,d]=i.useState([]),[h,u]=i.useState([]),[l,f]=i.useState(null),[j,g]=i.useState([]),[m,p]=i.useState(!0),[w,E]=i.useState(!1),[v,S]=i.useState(null),[b,y]=i.useState(!1),[R,F]=i.useState(!1),[k,N]=i.useState(!1),[A,M]=i.useState("overview"),[z,G]=i.useState("overview"),[Y,le]=i.useState(!0),[ue,me]=i.useState(!1),[Ka,Ua]=i.useState("preview"),[Ha,gt]=i.useState("list"),[ga,ba]=i.useState("preview"),[Ga,bt]=i.useState([]),[yt,De]=i.useState(!1),[Nt,Ee]=i.useState(null),[Ct,Ue]=i.useState(!1),[Ya,He]=i.useState(null),[wt,Xa]=i.useState(0),[kt,ya]=i.useState(!1),[Dt,Ja]=i.useState(!1),[Et,Ge]=i.useState(!1),[Za,Ye]=i.useState(null),[St,_t]=i.useState(0),[Pt,Xe]=i.useState(!1),[Qa,Je]=i.useState(null),[Ot,At]=i.useState(0),{isOpen:Rt,setIsOpen:Mt,close:It}=El(),Se=i.useRef(null),Ze=i.useRef(!1),Na=i.useRef(!1),Ca=i.useRef(new Map),es=300*1e3,J=i.useCallback((x={})=>{const{refreshAreas:D=!1,refreshCOR:C=!1,projectId:O=null}=x;D&&O&&(Ze.current=O),C&&(Na.current=!0),Se.current&&clearTimeout(Se.current),Se.current=setTimeout(async()=>{Ze.current&&(await wa(Ze.current),Ze.current=!1),Na.current&&(Xa(I=>I+1),Na.current=!1),await _e()},150)},[]);i.useEffect(()=>()=>{Se.current&&clearTimeout(Se.current)},[]),i.useEffect(()=>{s?.id&&(_e(),$t())},[s?.id]);const Tt=i.useRef([]),Lt=o.map(x=>x.id).sort().join(",");i.useEffect(()=>{if(!s?.id||o.length===0)return;const x=o.map(C=>C.id).sort();Tt.current=x;const D=T.subscribeToCompanyActivity?.(s.id,x,{onMessage:()=>J(),onMaterialRequest:()=>J(),onTMTicket:()=>J(),onCrewCheckin:()=>J(),onAreaUpdate:()=>J(),onCORChange:()=>J({refreshCOR:!0}),onInjuryReport:()=>J()});return()=>{D&&T.unsubscribe?.(D)}},[s?.id,Lt,J]),i.useEffect(()=>(ue?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[ue]);const $t=async()=>{try{const x=await T.getDumpSites(s.id);bt(x||[])}catch(x){console.error("Error loading dump sites:",x)}},as=i.useRef(null);i.useEffect(()=>{if(r&&r!==as.current&&o.length>0){const x=o.find(D=>D.id===r);x&&(as.current=r,f(x),c?.())}},[r,o,c]),i.useEffect(()=>{if(l){wa(l.id);const x=[],D=l.id,C=T.subscribeToAreas?.(D,()=>{J({refreshAreas:!0,projectId:D})});C&&x.push(C);const O=T.subscribeToDailyReports?.(D,()=>{J()});O&&x.push(O);const I=T.subscribeToCrewCheckins?.(D,()=>{J()});I&&x.push(I);const V=T.subscribeToHaulOffs?.(D,()=>{J()});V&&x.push(V);const q=T.subscribeToCORs?.(D,()=>{J({refreshCOR:!0})});return q&&x.push(q),()=>{x.forEach(W=>T.unsubscribe?.(W))}}},[l,J]),i.useEffect(()=>{z==="tickets"&&ba("full")},[z]);const qt=async(x,D=!1)=>{const C=x.id,O=Ca.current.get(C);if(O&&!D&&Date.now()-O.timestamp<es)return O.data;try{const[I,V,q,W,U,K,he,ea,P]=await Promise.all([re(()=>T.getAreas(x.id),{fallback:[],context:{operation:"getAreas",projectId:x.id}}),re(()=>T.getTMTickets(x.id),{fallback:[],context:{operation:"getTMTickets",projectId:x.id}}),re(()=>T.getChangeOrderTotals(x.id),{fallback:null,context:{operation:"getChangeOrderTotals",projectId:x.id}}),re(()=>T.getDailyReports(x.id,100),{fallback:[],context:{operation:"getDailyReports",projectId:x.id}}),re(()=>T.getInjuryReports(x.id),{fallback:[],context:{operation:"getInjuryReports",projectId:x.id}}),re(()=>T.calculateManDayCosts(x.id,s?.id,x.work_type||"demolition",x.job_type||"standard"),{fallback:null,context:{operation:"calculateManDayCosts",projectId:x.id}}),re(()=>T.calculateHaulOffCosts(x.id),{fallback:null,context:{operation:"calculateHaulOffCosts",projectId:x.id}}),re(()=>T.getProjectCosts(x.id),{fallback:[],context:{operation:"getProjectCosts",projectId:x.id}}),re(()=>T.getCORStats(x.id),{fallback:null,context:{operation:"getCORStats",projectId:x.id}})]),L=Ms(I),te=L.progress,je=q?.totalApprovedValue||0,gs=x.contract_value+je,aa=L.isValueBased?L.earnedValue:te/100*gs,yn=V.filter(X=>X.status==="pending").length,ka=new Date;ka.setDate(ka.getDate()-7);const Nn=W.filter(X=>new Date(X.report_date)>=ka).length,bs=ea.reduce((X,ne)=>{const na=parseFloat(ne.amount);return X+(isNaN(na)?0:na)},0);let sa=0;const ta={};V.forEach(X=>{const ne=X.work_date||X.ticket_date||X.created_at?.split("T")[0],na=X.t_and_m_items||X.items||[];let ra=0;na.forEach(Sa=>{const En=parseFloat(Sa.quantity)||1,Sn=parseFloat(Sa.unit_cost)||parseFloat(Sa.materials_equipment?.cost_per_unit)||0;ra+=En*Sn}),ra>0&&ne&&(sa+=ra,ta[ne]||(ta[ne]={date:ne,cost:0}),ta[ne].cost+=ra)});const ys=Object.values(ta).sort((X,ne)=>new Date(ne.date)-new Date(X.date)),Da=K?.totalCost||0,Cn=he?.totalCost||0,Ns=Da+sa+bs,Cs=aa-Ns,wn=aa>0?Cs/aa*100:0,ws=K?.byDate?.length||0,kn=ys.length,Ea=Math.max(ws,kn),ks=Da+sa,Dn=Ea>0?ks/Ea:0,ce=Tr({...x,progress:te},K?.totalManDays||0),Ds={...x,areas:I,progress:te,billable:aa,changeOrderValue:je,revisedContractValue:gs,changeOrderPending:q?.pendingCount||0,totalTickets:V.length,pendingTickets:yn,approvedTickets:V.filter(X=>X.status==="approved").length,tmTickets:V,dailyReportsCount:W.length,recentDailyReports:Nn,injuryReportsCount:U.length,lastDailyReport:W[0]?.report_date||null,isValueBased:L.isValueBased,earnedValue:L.earnedValue,totalSOVValue:L.totalValue,laborCost:Da,laborDaysWorked:ws,laborManDays:K?.totalManDays||0,laborByDate:K?.byDate||[],dailyBurn:Dn,materialsEquipmentCost:sa,materialsEquipmentByDate:ys,haulOffCost:Cn,haulOffLoads:he?.totalLoads||0,haulOffDays:he?.daysWithHaulOff||0,haulOffByType:he?.byWasteType||{},haulOffByDate:he?.byDate||[],customCosts:ea,customCostTotal:bs,totalBurn:ks,totalBurnDays:Ea,allCostsTotal:Ns,currentProfit:Cs,profitMargin:wn,corPendingValue:P?.total_pending_value||0,corPendingCount:P?.pending_count||0,corApprovedValue:P?.total_approved_value||0,corBilledValue:P?.total_billed_value||0,corTotalCount:P?.total_cors||0,corStats:P,scheduleStatus:ce.scheduleStatus,scheduleVariance:ce.scheduleVariance,scheduleLabel:ce.scheduleLabel,laborStatus:ce.laborStatus,laborVariance:ce.laborVariance,laborLabel:ce.laborLabel,hasScheduleData:ce.hasScheduleData,hasLaborData:ce.hasLaborData,actualManDays:K?.totalManDays||0,hasError:!1,_detailsLoaded:!0};return Ca.current.set(C,{data:Ds,timestamp:Date.now()}),Ds}catch(I){return console.error(`Error loading details for project ${x.id}:`,I),{...x,hasError:!0,_detailsLoaded:!1}}},_e=async()=>{try{const x=await T.getProjectDashboardSummary(s?.id);d(x);const D=x.map(C=>{const O=Ca.current.get(C.id);if(O&&Date.now()-O.timestamp<es)return O.data;const I=C.areaCount||0,V=C.completedAreas||0,q=I>0?Math.round(V/I*100):0;return{...C,progress:q,areas:[],totalTickets:C.ticketCount||0,pendingTickets:C.pendingTicketCount||0,approvedTickets:C.approvedTicketCount||0,dailyReportsCount:C.dailyReportsThisWeek||0,recentDailyReports:C.dailyReportsThisWeek||0,corTotalCount:C.corCount||0,billable:0,changeOrderValue:0,revisedContractValue:C.contract_value||0,changeOrderPending:0,tmTickets:[],injuryReportsCount:0,lastDailyReport:null,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,materialsEquipmentCost:0,materialsEquipmentByDate:[],haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corStats:null,scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1,actualManDays:0,hasError:!1,_detailsLoaded:!1}});u(D)}catch(x){console.error("Error loading projects:",x),t("Error loading projects","error")}finally{p(!1)}},wa=async x=>{try{const D=await T.getAreas(x);g(D)}catch(D){console.error("Error loading areas:",D)}},Qe=async x=>{if(f(x),!x._detailsLoaded){const D=await qt(x);u(C=>C.map(O=>O.id===x.id?D:O)),f(D)}},ss=()=>{f(null),g([]),E(!1),S(null),M("overview"),_e()},ts=()=>{S({name:l.name,job_number:l.job_number||"",address:l.address||"",general_contractor:l.general_contractor||"",client_contact:l.client_contact||"",client_phone:l.client_phone||"",contract_value:l.contract_value,work_type:l.work_type||"demolition",job_type:l.job_type||"standard",pin:l.pin||"",default_dump_site_id:l.default_dump_site_id||"",areas:j.map(x=>({id:x.id,name:x.name,weight:x.weight,isNew:!1}))}),E(!0)},Vt=()=>{E(!1),S(null)},se=(x,D)=>{S(C=>({...C,[x]:D}))},ns=(x,D,C)=>{S(O=>({...O,areas:O.areas.map((I,V)=>V===x?{...I,[D]:C}:I)}))},Ft=()=>{S(x=>({...x,areas:[...x.areas,{id:null,name:"",weight:"",isNew:!0}]}))},zt=x=>{v.areas.length>1&&S(D=>({...D,areas:D.areas.filter((C,O)=>O!==x)}))},Bt=async()=>{if(!v.name.trim()){t("Please enter a project name","error");return}const x=parseFloat(v.contract_value);if(!x||x<=0){t("Please enter a valid contract value","error");return}if(v.pin&&v.pin.length!==4){t("PIN must be 4 digits","error");return}if(v.pin&&v.pin!==l.pin&&!await T.isPinAvailable(v.pin,l.id)){t("This PIN is already in use","error");return}const D=v.areas.filter(O=>O.name.trim()&&parseFloat(O.weight)>0);if(D.length===0){t("Please add at least one area","error");return}if(D.reduce((O,I)=>O+parseFloat(I.weight),0)!==100){t("Area weights must total 100%","error");return}y(!0);try{await T.updateProject(l.id,{name:v.name.trim(),job_number:v.job_number?.trim()||null,address:v.address?.trim()||null,general_contractor:v.general_contractor?.trim()||null,client_contact:v.client_contact?.trim()||null,client_phone:v.client_phone?.trim()||null,contract_value:x,work_type:v.work_type||"demolition",job_type:v.job_type||"standard",pin:v.pin||null,default_dump_site_id:v.default_dump_site_id||null},s?.id);const O=j.map(q=>q.id),I=v.areas.filter(q=>q.id).map(q=>q.id);for(const q of O)I.includes(q)||await T.deleteArea(q);for(let q=0;q<D.length;q++){const W=D[q];W.id?await T.updateArea(W.id,{name:W.name.trim(),weight:parseFloat(W.weight),sort_order:q}):await T.createArea({project_id:l.id,name:W.name.trim(),weight:parseFloat(W.weight),status:"not_started",sort_order:q})}const V=await T.getProject(l.id);f(V),await wa(l.id),E(!1),S(null),t("Project updated!","success")}catch(O){console.error("Error saving project:",O?.message||O),t(O?.message||"Error saving changes","error")}finally{y(!1)}},Wt=async()=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await T.deleteProject(l.id),t("Project deleted","success"),ss()}catch(x){console.error("Error deleting project:",x),t("Error deleting project","error")}},_=i.useMemo(()=>l?h.find(x=>x.id===l.id):null,[l,h]),Kt=i.useMemo(()=>{if(!l)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const x=Ms(j),D=x.progress,C=_?.changeOrderValue||0,O=l.contract_value+C,I=x.isValueBased?x.earnedValue:D/100*O;return{progress:D,billable:I,changeOrderValue:C,revisedContractValue:O,isValueBased:x.isValueBased,earnedValue:x.earnedValue,totalSOVValue:x.totalValue}},[l,j,_]),Ut=i.useMemo(()=>{const x=h.reduce((U,K)=>U+(K.contract_value||0),0),D=h.reduce((U,K)=>U+(K.changeOrderValue||0),0),C=x+D,O=h.reduce((U,K)=>U+(K.billable||0),0),I=C-O,V=C>0?Math.round(O/C*100):0,q=h.reduce((U,K)=>U+(K.corPendingValue||0),0),W=h.reduce((U,K)=>U+(K.corPendingCount||0),0);return{totalOriginalContract:x,totalChangeOrders:D,totalPortfolioValue:C,totalEarned:O,totalRemaining:I,weightedCompletion:V,totalPendingCORValue:q,totalPendingCORCount:W}},[h]),Ht=i.useMemo(()=>{let x=0,D=0,C=0,O=0,I=0;for(const V of h){const q=V.revisedContractValue||V.contract_value;V.progress>=100&&x++,V.progress<100&&V.billable<=q*(V.progress/100)*1.1&&D++,V.billable>q*.9&&V.progress<90&&C++,V.billable>q&&O++,(V.changeOrderValue||0)>0&&I++}return{projectsComplete:x,projectsOnTrack:D,projectsAtRisk:C,projectsOverBudget:O,projectsWithChangeOrders:I}},[h]),Gt=i.useMemo(()=>{let x=0,D=0,C=0,O=0,I=0,V=0;for(const q of h)q.hasScheduleData&&(q.scheduleStatus==="ahead"?x++:q.scheduleStatus==="behind"?C++:D++),q.hasLaborData&&(q.laborStatus==="over"?O++:q.laborStatus==="under"?I++:V++);return{scheduleAhead:x,scheduleOnTrack:D,scheduleBehind:C,laborOver:O,laborUnder:I,laborOnTrack:V,hasAnyScheduleData:x+D+C>0,hasAnyLaborData:O+I+V>0}},[h]),Pe=i.useMemo(()=>{const x=h.map(C=>{const O={id:C.id,name:C.name,totalCosts:C.totalCosts||0,earnedRevenue:C.billable||0,actualProgress:C.progress||0,expectedProgress:C.expectedProgress||C.progress,pendingCORValue:C.corPendingValue||0,contractValue:C.revisedContractValue||C.contract_value||0,lastReportDate:C.lastDailyReport,recentInjuryCount:C.recentInjuryCount||0,startDate:C.start_date},I=Cl(O),V=wl(I,{...O,name:C.name}),q=kl(O),W=V.map(U=>({...U,projectName:C.name,projectId:C.id}));return{projectId:C.id,projectName:C.name,riskScore:I.score,riskStatus:I.status,riskLabel:I.label,factors:I.factors,alerts:W,projections:q}}),D=x.flatMap(C=>C.alerts).sort((C,O)=>{const I={critical:0,warning:1,info:2};return I[C.type]-I[O.type]});return{projectRisks:x,allAlerts:D,criticalCount:D.filter(C=>C.type==="critical").length,warningCount:D.filter(C=>C.type==="warning").length}},[h]),Yt=i.useCallback(({target:x,projectId:D,alert:C})=>{const O=o.find(I=>I.id===D);O&&(f(O),x==="financials"?M("financials"):x==="reports"?M("reports"):x==="cors"?(M("financials"),G("cors")):M("overview"))},[o]);i.useEffect(()=>{const x=async()=>{for(const D of h)if(Rr(D,30))try{await T.archiveProject(D.id),t(`Project "${D.name}" has been auto-archived after 30 days of completion`,"info")}catch(C){console.error("Failed to auto-archive project:",C)}};h.length>0&&x()},[]);const Xt=i.useCallback(()=>{Ye(null),Ge(!0)},[]),Jt=i.useCallback(x=>{Ye(x),Ge(!0)},[]),Zt=i.useCallback(()=>{Je(null),Xe(!0)},[]),Qt=i.useCallback(x=>{Je(x),Xe(!0)},[]),en=i.useCallback(()=>{ba("full")},[]),an=i.useCallback(()=>{le(x=>!x)},[]),sn=i.useCallback(()=>{me(x=>!x)},[]),rs=i.useCallback(()=>{me(!1)},[]),tn=i.useCallback(()=>{Ua("full")},[]),nn=i.useCallback(()=>{ba("preview")},[]),rn=i.useCallback(()=>{Ua("preview")},[]),ln=i.useCallback(()=>{Ee(null),De(!0)},[]),cn=i.useCallback(x=>{He(x),Ue(!0)},[]),on=i.useCallback(x=>{Ee(x),De(!0)},[]),dn=i.useCallback(()=>{ya(!0)},[]),un=i.useCallback(async x=>{try{await T.deleteProjectCost(x),_e(),t?.("Cost deleted","success")}catch{t?.("Error deleting cost","error")}},[]),mn=i.useMemo(()=>({corCount:_?.corStats?.total||0,ticketCount:_?.totalTickets||0,corPending:_?.corStats?.pending||0,ticketPending:_?.pendingTickets||0}),[_?.corStats?.total,_?.totalTickets,_?.corStats?.pending,_?.pendingTickets]),{totalOriginalContract:hn,totalChangeOrders:is,totalPortfolioValue:pn,totalEarned:vn,totalRemaining:xn,weightedCompletion:fn,totalPendingCORValue:jn,totalPendingCORCount:ls}=Ut,{projectsComplete:cs,projectsOnTrack:os,projectsAtRisk:ds,projectsOverBudget:us,projectsWithChangeOrders:ms}=Ht,{scheduleAhead:hs,scheduleOnTrack:ps,scheduleBehind:vs,laborOver:xs,laborUnder:fs,laborOnTrack:js,hasAnyScheduleData:gn,hasAnyLaborData:bn}=Gt;if(m)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(l){const{progress:x,billable:D,changeOrderValue:C,revisedContractValue:O,isValueBased:I,earnedValue:V,totalSOVValue:q}=Kt;if(w&&v){const P=v.areas.reduce((L,te)=>L+(parseFloat(te.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Vt,style:{marginBottom:"1.5rem"},children:"← Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:v.name,onChange:L=>se("name",L.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:v.job_number,onChange:L=>se("job_number",L.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:v.address,onChange:L=>se("address",L.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:v.general_contractor,onChange:L=>se("general_contractor",L.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:v.client_contact,onChange:L=>se("client_contact",L.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:v.client_phone,onChange:L=>se("client_phone",L.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:v.contract_value,onChange:L=>se("contract_value",L.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:v.pin,onChange:L=>se("pin",L.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:v.work_type,onChange:L=>se("work_type",L.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:v.job_type,onChange:L=>se("job_type",L.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:v.default_dump_site_id,onChange:L=>se("default_dump_site_id",L.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),Ga.map(L=>e.jsx("option",{value:L.id,children:L.name},L.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),v.areas.map((L,te)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:L.name,onChange:je=>ns(te,"name",je.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:L.weight,onChange:je=>ns(te,"weight",je.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>zt(te),children:"×"})]},te)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${P===100?"valid":"invalid"}`,children:[P,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:Ft,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:Bt,disabled:b,style:{flex:1},children:b?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:Wt,children:"Delete Project"})]})}const W=j.filter(P=>P.status==="done").length,U=j.filter(P=>P.status==="working").length,K=j.filter(P=>P.status==="not_started").length,he=(_?.pendingTickets||0)+(_?.changeOrderPending||0),ea=[{id:"overview",label:"Overview",Icon:Ts},{id:"financials",label:"Financials",Icon:ca,badge:he},{id:"reports",label:"Reports",Icon:ie},{id:"documents",label:"Documents",Icon:Ma},{id:"info",label:"Info",Icon:oa}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:ss,children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>F(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>N(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:ts,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:l.name}),(l.job_number||l.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[l.job_number&&`Job #${l.job_number}`,l.job_number&&l.work_type&&" • ",l.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[x,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:H(D)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:H(O-D)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:ea.map(P=>e.jsxs("button",{className:`pv-tab ${A===P.id?"active":""} ${P.badge>0?"has-badge":""}`,onClick:()=>M(P.id),children:[e.jsx(P.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:P.label}),P.badge>0&&e.jsx("span",{className:"pv-tab-badge",children:P.badge})]},P.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[A==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab animate-fade-in",children:[e.jsxs("div",{className:"overview-hero-split",children:[e.jsx(Ql,{progress:x,areasComplete:W,totalAreas:j.length,areasWorking:U}),e.jsx(ec,{earnedRevenue:D,totalCosts:_?.allCostsTotal||0,laborCost:_?.laborCost||0,disposalCost:_?.haulOffCost||0,equipmentCost:_?.materialsEquipmentCost||0,materialsCost:0,otherCost:_?.customCostTotal||0,contractValue:O})]}),(_?.pendingTickets>0||_?.changeOrderPending>0)&&e.jsxs("div",{className:"overview-attention-card",children:[e.jsxs("div",{className:"attention-header",children:[e.jsx("h3",{children:"Needs Attention"}),e.jsxs("span",{className:"attention-count",children:[(_?.pendingTickets||0)+(_?.changeOrderPending||0)," items"]})]}),e.jsxs("div",{className:"attention-items",children:[_?.pendingTickets>0&&e.jsxs("div",{className:"attention-item",onClick:()=>M("financials"),children:[e.jsx("div",{className:"attention-item-icon warning",children:e.jsx(ie,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[_.pendingTickets," T&M ticket",_.pendingTickets!==1?"s":""," awaiting approval"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:"→"})]}),_?.changeOrderPending>0&&e.jsxs("div",{className:"attention-item",onClick:()=>M("financials"),children:[e.jsx("div",{className:"attention-item-icon info",children:e.jsx(Le,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[_.changeOrderPending," change order",_.changeOrderPending!==1?"s":""," pending"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:"→"})]})]})]}),e.jsxs("div",{className:"overview-section-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[W>0&&e.jsxs("span",{className:"section-badge done",children:[W," Complete"]}),U>0&&e.jsxs("span",{className:"section-badge working",children:[U," Active"]}),K>0&&e.jsxs("span",{className:"section-badge pending",children:[K," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list stagger-areas",children:j.map(P=>e.jsxs("div",{className:`work-area-item ${P.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[P.status==="done"&&e.jsx("span",{className:"status-icon done",children:"✓"}),P.status==="working"&&e.jsx("span",{className:"status-icon working",children:"●"}),P.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:"○"})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:P.name}),e.jsx("span",{className:"work-area-weight",children:P.scheduled_value?H(P.scheduled_value):`${P.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${P.status}`,style:{width:P.status==="done"?"100%":P.status==="working"?"50%":"0%"}})})]},P.id))})]}),e.jsxs("div",{className:"overview-stats-row",children:[e.jsxs("div",{className:"quick-stat-card",onClick:()=>M("reports"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(ie,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:_?.dailyReportsCount||0}),e.jsx("span",{className:"quick-stat-label",children:"Daily Reports"})]}),e.jsx("span",{className:"quick-stat-arrow",children:"→"})]}),e.jsxs("div",{className:"quick-stat-card",onClick:()=>M("financials"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(ca,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:_?.totalTickets||0}),e.jsx("span",{className:"quick-stat-label",children:"T&M Tickets"})]}),e.jsx("span",{className:"quick-stat-arrow",children:"→"})]})]})]}),A==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsx(Jl,{contractValue:l?.contract_value||0,earnedRevenue:D,totalCosts:_?.allCostsTotal||0,profit:_?.currentProfit||0,progress:x,corApprovedValue:C,loading:!_}),e.jsxs("div",{className:`financials-layout ${Y?"sidebar-collapsed":""}`,children:[e.jsxs("button",{className:"financials-mobile-menu-toggle",onClick:sn,"aria-label":"Open navigation menu",title:"Open navigation menu",children:[e.jsx(ti,{size:20}),e.jsx("span",{children:"Menu"})]}),ue&&e.jsx("div",{className:"financials-sidebar-overlay",onClick:rs,"aria-hidden":"true"}),e.jsx("div",{className:`financials-sidebar ${Y?"collapsed":""} ${ue?"mobile-open":""}`,children:e.jsx(Zl,{activeSection:z,onSectionChange:P=>{G(P),me(!1)},collapsed:Y,onToggleCollapse:an,onMobileClose:rs,stats:mn})}),e.jsxs("div",{className:"financials-main",children:[z==="overview"&&e.jsxs("div",{className:"financials-overview animate-fade-in",children:[e.jsx(Vl,{projectData:_,project:l,tmTickets:_?.tmTickets||[],corStats:_?.corStats,areas:j}),e.jsxs("div",{className:"financials-analysis-row stagger-children",children:[e.jsx(Ml,{dailyBurn:_?.dailyBurn||0,totalBurn:_?.totalBurn||0,daysWorked:_?.totalBurnDays||0,laborCost:_?.laborCost||0,materialsEquipmentCost:_?.materialsEquipmentCost||0,progress:x,contractValue:O,laborByDate:_?.laborByDate||[],materialsEquipmentByDate:_?.materialsEquipmentByDate||[]}),e.jsx(Bl,{revenue:D,totalCosts:_?.allCostsTotal||0,contractValue:O,progress:x})]}),e.jsxs("div",{className:"cost-disposal-row",children:[e.jsx(zl,{laborCost:_?.laborCost||0,haulOffCost:_?.haulOffCost||0,customCosts:_?.customCosts||[],onAddCost:dn,onDeleteCost:un}),e.jsx(Kl,{project:l,period:"week"})]}),e.jsx(Al,{project:l,onAddEquipment:Xt,onEditEquipment:Jt,onShowToast:t},St),e.jsx(Ol,{project:l,areas:j,corStats:_?.corStats,onCreateDraw:Zt,onViewDraw:Qt,onShowToast:t},Ot),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(ua,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:H(_?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(Pl,{project:l,company:s,onShowToast:t})})]})]}),z==="cors"&&e.jsx("div",{className:"financials-cors animate-fade-in",children:e.jsxs("div",{className:"financials-section cor-section-primary",children:[Ka==="full"&&Ha!=="log"&&e.jsx("button",{className:"section-back-btn",onClick:rn,children:"← Back to summary"}),e.jsx(i.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(ic,{project:l,company:s,areas:j,refreshKey:wt,onShowToast:t,previewMode:Ka==="preview"&&Ha!=="log",previewLimit:5,onViewAll:tn,onDisplayModeChange:gt,onCreateCOR:ln,onViewCOR:cn,onEditCOR:on})})]})}),z==="tickets"&&e.jsx("div",{className:"financials-tickets animate-fade-in",children:e.jsxs("div",{className:"financials-section tm-section",children:[ga==="full"&&e.jsx("button",{className:"section-back-btn",onClick:nn,children:"← Back to summary"}),e.jsx(i.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(ac,{project:l,company:s,onShowToast:t,compact:ga==="preview",previewMode:ga==="preview",onViewAll:en})})]})}),z==="billing"&&e.jsx("div",{className:"financials-billing animate-fade-in",children:e.jsx(i.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(oc,{project:l,company:s,user:a,onShowToast:t})})})]})]})]}),A==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(ie,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:_?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:_?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((_?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:`reports-metric ${(_?.injuryReportsCount||0)>0?"warning":"success"}`,children:[e.jsx("div",{className:"reports-metric-value",children:_?.injuryReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Injuries"}),e.jsx("div",{className:"reports-metric-status",children:(_?.injuryReportsCount||0)===0?"No incidents":"Review required"})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value small",children:_?.lastDailyReport?new Date(_.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"None"}),e.jsx("div",{className:"reports-metric-label",children:"Last Filed"}),_?.lastDailyReport&&e.jsxs("div",{className:"reports-metric-detail",children:[Math.floor((new Date-new Date(_.lastDailyReport))/(1e3*60*60*24))," days ago"]})]})]})}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(ie,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[_?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(i.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(rc,{project:l,company:s,onShowToast:t})})})]}),e.jsxs("div",{className:`reports-section-card ${(_?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(_?.injuryReportsCount||0)>0?"warning":"success"}`,children:(_?.injuryReportsCount||0)>0?"⚠":"✓"}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(_?.injuryReportsCount||0)>0?"warning":"success"}`,children:(_?.injuryReportsCount||0)>0?`${_.injuryReportsCount} incident${_.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(i.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(tc,{project:l,companyId:s?.id||l?.company_id,company:s,user:a,onShowToast:t})})})]})]}),A==="documents"&&e.jsx("div",{className:"pv-tab-panel documents-tab",children:e.jsx(i.Suspense,{fallback:e.jsx(ye,{}),children:e.jsx(hc,{project:l,companyId:s?.id||l?.company_id,onShowToast:t,userRole:a?.access_level||"office"})})}),A==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:l.name}),l.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",l.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:ts,children:e.jsx("span",{children:"Edit Project"})})]}),l.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(ni,{size:14}),e.jsx("span",{children:l.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(ua,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:l.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(Le,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:l.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(ca,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:H(O)}),e.jsx("span",{className:"info-quick-label",children:C>0?`Incl. +${H(C)} COs`:"Contract Value"})]})]}),l.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:l.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(ri,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[l.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:l.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),l.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:l.client_contact})]}),l.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(ii,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${l.client_phone}`,className:"info-detail-value link",children:l.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Ts,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[W>0&&e.jsxs("span",{className:"info-badge done",children:[W," Done"]}),U>0&&e.jsxs("span",{className:"info-badge working",children:[U," Active"]}),K>0&&e.jsxs("span",{className:"info-badge pending",children:[K," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:j.map(P=>e.jsxs("div",{className:`info-area-item ${P.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[P.status==="done"&&e.jsx("span",{className:"status-dot done",children:"✓"}),P.status==="working"&&e.jsx("span",{className:"status-dot working",children:"●"}),P.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:"○"})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:P.name}),e.jsx("span",{className:`info-area-status-label ${P.status}`,children:P.status==="done"?"Complete":P.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[P.weight,"%"]})]},P.id))})]}),e.jsx(Ul,{project:l,company:s,user:a,isAdmin:n,onShowToast:t}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(oa,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:H(l.contract_value)})]}),C>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",H(C)]})]}),l.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:Ga.find(P=>P.id===l.default_dump_site_id)?.name||"Unknown"})]})]})]})]})]}),R&&e.jsx(i.Suspense,{fallback:null,children:e.jsx(sc,{project:l,user:a,onClose:()=>F(!1),onShareCreated:P=>{t("Share link created successfully!","success")}})}),k&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(i.Suspense,{fallback:null,children:e.jsx(nc,{project:l,company:s,onShowToast:t,onClose:()=>N(!1)})})}),yt&&e.jsx(i.Suspense,{fallback:null,children:e.jsx(lc,{project:l,company:s,areas:j,existingCOR:Nt,onClose:()=>{De(!1),Ee(null)},onSaved:()=>{De(!1),Ee(null),Xa(P=>P+1)},onShowToast:t})}),Ct&&Ya&&e.jsx(i.Suspense,{fallback:null,children:e.jsx(cc,{cor:Ya,project:l,company:s,areas:j,onClose:()=>{Ue(!1),He(null)},onEdit:P=>{Ue(!1),He(null),Ee(P),De(!0)},onShowToast:t,onStatusChange:()=>{}})}),kt&&e.jsx(i.Suspense,{fallback:null,children:e.jsx(mc,{onClose:()=>ya(!1),saving:Dt,onSave:async P=>{try{Ja(!0),await T.addProjectCost(l.id,s.id,P),ya(!1),_e(),t("Cost added successfully","success")}catch(L){console.error("Error adding cost:",L),t("Error adding cost","error")}finally{Ja(!1)}}})}),Et&&e.jsx(i.Suspense,{fallback:null,children:e.jsx(uc,{project:l,company:s,user:a,editItem:Za,onSave:()=>{Ge(!1),Ye(null),_t(P=>P+1),t(Za?"Equipment updated":"Equipment added","success")},onClose:()=>{Ge(!1),Ye(null)}})}),Pt&&e.jsx(i.Suspense,{fallback:null,children:e.jsx(dc,{project:l,company:s,areas:j,corStats:h.find(P=>P.id===l?.id)?.corStats,editDrawRequest:Qa,onSave:()=>{Xe(!1),Je(null),At(P=>P+1),t(Qa?"Draw request updated":"Draw request created","success")},onClose:()=>{Xe(!1),Je(null)}})})]})}return o.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(ie,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("button",{className:"search-trigger-btn",onClick:()=>Mt(!0),children:[e.jsx(rt,{size:16}),e.jsx("span",{children:"Search"}),e.jsx("span",{className:"shortcut",children:"⌘K"})]}),e.jsxs("div",{className:"bo-project-count",children:[o.length," Active Project",o.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(fn,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:H(vn)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:H(pn)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:H(xn)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),is>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:H(hn)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",ms," project",ms!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",H(is)]})]})]}),ls>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:H(jn)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",ls," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[cs>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:cs}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),os>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:os}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),ds>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:ds}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),us>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:us}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),gn&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[hs>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:hs}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),ps>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:ps}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),vs>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:vs}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),bn&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),fs>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[fs," under"]}),js>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[js," on track"]}),xs>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[xs," over"]})]})]})]}),Pe.allAlerts.length>0&&e.jsxs("div",{className:"smart-alerts-section",style:{marginBottom:"var(--space-lg, 1.5rem)"},children:[e.jsx("div",{className:"smart-alerts-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"var(--space-sm, 0.5rem)"},children:e.jsxs("h3",{style:{fontSize:"var(--font-size-md, 1rem)",fontWeight:"var(--font-weight-semibold, 600)",color:"var(--text-primary)",margin:0},children:["Needs Attention",Pe.criticalCount>0&&e.jsxs("span",{style:{marginLeft:"0.5rem",padding:"2px 8px",fontSize:"0.75rem",fontWeight:600,borderRadius:"9999px",background:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"},children:[Pe.criticalCount," critical"]})]})}),e.jsx(Sl,{alerts:Pe.allAlerts,onAction:Yt,maxVisible:3})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[o.length," active"]})]}),e.jsx("div",{className:"project-list",children:h.map(x=>{const D=Pe.projectRisks.find(C=>C.projectId===x.id);return e.jsx(vc,{project:x,riskScore:D?.riskScore,riskStatus:D?.riskStatus,onClick:()=>Qe(x)},x.id)})}),e.jsx(Dl,{isOpen:Rt,onClose:It,companyId:s?.id,onSelectProject:x=>{Qe(x)},onSelectTicket:x=>{const D=o.find(C=>C.id===x.project_id);D&&(Qe(D),M("financials"),G("tickets"))},onSelectCOR:x=>{const D=o.find(C=>C.id===x.project_id);D&&(Qe(D),M("financials"),G("cors"),He(x),Ue(!0))},onShowToast:t})]})}function vc({project:s,riskScore:a,riskStatus:n,onClick:t}){const r=Mr(s.areas||[]),c=Ir(s.areas||[]),o=s.contract_value-s.billable,d=s.billable>s.contract_value*.9&&s.progress<90,h={healthy:{bg:"var(--status-success-bg, #064e3b)",color:"var(--status-success, #059669)"},warning:{bg:"var(--status-warning-bg, #78350f)",color:"var(--status-warning, #d97706)"},critical:{bg:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"}},u=h[n]||h.healthy;return e.jsxs("div",{className:`project-card enhanced ${d?"at-risk":""}`,onClick:t,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[typeof a=="number"&&e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"50%",fontSize:"0.75rem",fontWeight:700,background:u.bg,color:u.color},title:`Risk Score: ${a}`,"aria-label":`Risk score ${a}, ${n}`,children:a}),e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:s.name}),e.jsx("div",{className:"project-card-value",children:H(s.contract_value)})]})]}),e.jsx("span",{className:`status-badge ${r}`,children:c})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[s.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:H(s.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${o<0?"negative":""}`,children:H(Math.abs(o))}),e.jsx("span",{className:"stat-label",children:o>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${s.progress}%`}})}),(s.pendingTickets>0||s.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[s.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[s.pendingTickets," Pending T&M"]}),s.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[s.approvedTickets," Approved T&M"]})]}),s.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${s.scheduleStatus}`,children:s.scheduleLabel}),s.hasLaborData&&s.laborLabel&&e.jsx("span",{className:`labor-indicator ${s.laborStatus}`,children:s.laborLabel})]})]})}const Cc=Object.freeze(Object.defineProperty({__proto__:null,default:pc},Symbol.toStringTag,{value:"Module"}));export{hl as A,Gl as C,Cc as D,yc as E,ye as T,Ae as a,Nc as b,bc as c};
//# sourceMappingURL=Dashboard-CSVmFiWJ.js.map
