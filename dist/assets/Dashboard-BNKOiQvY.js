const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ShareModal-BP8gCt2-.js","assets/react-BSqwb0tX.js","assets/index-BIaaQ6dM.js","assets/pdf-DgmPe6PY.js","assets/supabase-CJTGJ4KY.js","assets/icons-B4eeUMwP.js","assets/recharts-CI1uxbzf.js","assets/index-Bk8JRRJt.css","assets/NotificationSettings-CrxKwqzM.js","assets/CORForm-Dj-thhUe.js","assets/corCalculations-vdJc_BOT.js","assets/CORDetail-DHrvtIrO.js","assets/SignatureCanvas-ClNi7ES9.js","assets/SignatureLinkGenerator-CmyCQfb9.js","assets/CORLog-BV_Xgni8.js","assets/DrawRequestModal-BGKjHwIK.js","assets/EquipmentModal-ByW3uRS8.js","assets/AddCostModal-BB-cNloE.js","assets/DocumentsTab-BVOYY6Ef.js","assets/CORLogPreview-DZRloOYn.js","assets/CORList-zM-0oK9y.js","assets/TMList-DWX3-xaq.js","assets/BillingCenter-CtHqLAFW.js","assets/PhotoTimeline-tjwCqI49.js"])))=>i.map(i=>d[i]);
import{_ as oe}from"./pdf-DgmPe6PY.js";import{r as d,j as e}from"./react-BSqwb0tX.js";import{o as Mn,d as I,e as Xe,a as $n,u as pa,h as hs,l as xa,I as Pn,T as An,s as os,f as ae,c as Xt,b as On,g as Ln,i as zn,j as In}from"./index-BIaaQ6dM.js";import{h as ja,X as as,ab as qn,$ as ct,C as Ie,F as ss,u as xe,O as Re,aa as As,T as Fe,ac as Vn,ad as ms,D as We,ae as va,Q as Ls,H as He,W as ot,af as tt,ag as Bn,f as xs,N as ns,ah as rs,p as ut,e as dt,b as ga,V as es,ai as fa,aj as Un,ak as Wn,al as Hn,m as Gn,am as Kn,an as Ps,o as Ge,s as zs,t as Ke,a9 as ba,q as ps,R as Jn,ao as Yn,J as Qn,ap as Xn,U as Zn,aq as er,ar as at,d as mt,L as Zt,as as ea,g as sr,at as sa,au as ta,av as tr,k as ar,i as nr,a6 as rr,a as ir,aw as lr}from"./icons-B4eeUMwP.js";import{R as Is,B as cr,b as Na,X as ht,Y as pt,T as qs,e as Vs,c as aa,A as or,f as dr,g as Ts,P as mr,a as ur,C as hr,L as pr,d as nt}from"./recharts-CI1uxbzf.js";import{f as Ne}from"./corCalculations-vdJc_BOT.js";const na={WARNING:"warning",ERROR:"error"},ye={DATABASE:"database",NETWORK:"network",AUTH:"auth",VALIDATION:"validation",STORAGE:"storage",SYNC:"sync",GENERAL:"general"};function xr(s){const n=s?.message?.toLowerCase()||"",o=s?.code?.toLowerCase()||"";return n.includes("fetch")||n.includes("network")||n.includes("offline")?ye.NETWORK:n.includes("auth")||n.includes("unauthorized")||o.includes("auth")?ye.AUTH:n.includes("storage")||n.includes("bucket")||n.includes("upload")?ye.STORAGE:n.includes("validation")||n.includes("invalid")||n.includes("required")?ye.VALIDATION:n.includes("sync")||n.includes("conflict")?ye.SYNC:s?.code||n.includes("database")||n.includes("supabase")?ye.DATABASE:ye.GENERAL}function jr(s,n,o){return o?.userMessage?o.userMessage:n===ye.NETWORK?"Network connection issue. Your changes will sync when back online.":n===ye.AUTH?"Session expired. Please sign in again.":n===ye.STORAGE?"Failed to upload file. Please try again.":n===ye.VALIDATION?s?.message||"Please check your input and try again.":n===ye.SYNC?"Sync conflict detected. Please refresh and try again.":o?.operation?`Failed to ${o.operation.replace(/([A-Z])/g," $1").toLowerCase().trim()}. Please try again.`:"Something went wrong. Please try again."}function vr(s,n={}){const{operation:o="unknown",category:a=xr(s),severity:t=na.ERROR,showToast:l,userMessage:i,companyId:r,projectId:m,userId:u,silent:c=!1,rethrow:j=!1}=n;if(Mn.error(a,{message:s?.message||"Unknown error",code:s?.code,severity:t,operation:o,company_id:r,project_id:m,user_id:u,extra:{stack:s?.stack,name:s?.name}}),!c&&l){const x=jr(s,a,{operation:o,userMessage:i}),b=t===na.WARNING?"warning":"error";l(x,b)}if(j)throw s;return null}async function be(s,n={}){const{fallback:o=null,context:a={},showToast:t,silent:l=!0}=n;try{return await s()}catch(i){return vr(i,{...a,showToast:t,silent:l}),o}}const is={budget:{healthy:.6,warning:.75,critical:.85},schedule:{healthy:.05,warning:.15,critical:.25},corExposure:{healthy:.05,warning:.15,critical:.25},activity:{healthy:1,warning:3,critical:5},safety:{healthy:0,warning:1,critical:2}},gr={budget:.3,schedule:.25,corExposure:.2,activity:.15,safety:.1};function js(s,n){if(s<=n.healthy)return 0;if(s>=n.critical)return 100;const o=n.critical-n.healthy;return(s-n.healthy)/o*100}function vs(s){return s<=25?"healthy":s<=60?"warning":"critical"}function fr(s,n,o=is.budget){if(!n||n<=0)return{score:0,status:"healthy",ratio:0,label:"No revenue yet"};const a=s/n,t=js(a,o),l=vs(t);let i;return a<o.healthy?i=`Costs at ${(a*100).toFixed(0)}% of revenue`:a<o.warning?i=`Costs at ${(a*100).toFixed(0)}% - monitor closely`:i=`Costs at ${(a*100).toFixed(0)}% - review immediately`,{score:t,status:l,ratio:a,label:i}}function br(s,n,o=is.schedule){if(!n||n<=0)return{score:0,status:"healthy",variance:0,label:"No schedule baseline"};const a=(n-s)/n,t=Math.max(0,a),l=js(t,o),i=vs(l);let r;return a<=0?r=s>=100?"Complete":"On or ahead of schedule":a<o.warning?r=`${(a*100).toFixed(0)}% behind schedule`:r=`${(a*100).toFixed(0)}% behind - needs attention`,{score:l,status:i,variance:a,label:r}}function Nr(s,n,o=is.corExposure){if(!n||n<=0)return{score:0,status:"healthy",exposure:0,label:"No contract value"};const a=s/n,t=js(a,o),l=vs(t);let i;return a<o.healthy?i=s>0?`$${rt(s)} pending`:"No pending CORs":a<o.warning?i=`$${rt(s)} pending (${(a*100).toFixed(0)}% of contract)`:i=`High exposure: $${rt(s)} (${(a*100).toFixed(0)}%)`,{score:t,status:l,exposure:a,label:i}}function yr(s,n=is.activity){if(!s)return{score:100,status:"critical",daysSince:null,label:"No reports filed"};const o=new Date(s),t=Math.floor((new Date-o)/(1e3*60*60*24)),l=js(t,n),i=vs(l);let r;return t===0?r="Report filed today":t===1?r="Report filed yesterday":t<=n.warning?r=`Last report ${t} days ago`:r=`No report in ${t} days - may be stalled`,{score:l,status:i,daysSince:t,label:r}}function wr(s,n=is.safety){const o=s||0,a=js(o,n),t=vs(a);let l;return o===0?l="No incidents":o===1?l="1 incident in last 30 days":l=`${o} incidents - safety review needed`,{score:a,status:t,count:o,label:l}}function Cr(s,n={}){const o={...is,...n.thresholds},a={...gr,...n.weights},t=fr(s.totalCosts,s.earnedRevenue,o.budget),l=br(s.actualProgress,s.expectedProgress,o.schedule),i=Nr(s.pendingCORValue,s.contractValue,o.corExposure),r=yr(s.lastReportDate,o.activity),m=wr(s.recentInjuryCount,o.safety),u=Math.round(t.score*a.budget+l.score*a.schedule+i.score*a.corExposure+r.score*a.activity+m.score*a.safety);let c;u<=25?c="healthy":u<=60?c="warning":c="critical";let j;return c==="healthy"?j="Project is on track":c==="warning"?j="Some factors need attention":j="Immediate review recommended",{score:u,status:c,label:j,factors:{budget:{...t,weight:a.budget},schedule:{...l,weight:a.schedule},corExposure:{...i,weight:a.corExposure},activity:{...r,weight:a.activity},safety:{...m,weight:a.safety}}}}function kr(s,n){const o=[],{factors:a}=s;a.budget.status==="critical"&&o.push({type:"critical",title:"Budget Alert",description:a.budget.label,action:"Review costs immediately",actionTarget:"financials",projectId:n.id}),a.activity.status==="critical"&&o.push({type:"critical",title:"Activity Alert",description:a.activity.label,action:"Check project status",actionTarget:"overview",projectId:n.id}),a.safety.status==="critical"&&o.push({type:"critical",title:"Safety Alert",description:a.safety.label,action:"Review safety reports",actionTarget:"reports",projectId:n.id}),a.budget.status==="warning"&&o.push({type:"warning",title:"Budget Watch",description:a.budget.label,action:"Monitor costs",actionTarget:"financials",projectId:n.id}),(a.schedule.status==="critical"||a.schedule.status==="warning")&&o.push({type:a.schedule.status==="critical"?"critical":"warning",title:"Schedule Alert",description:a.schedule.label,action:"Review progress",actionTarget:"overview",projectId:n.id}),(a.corExposure.status==="warning"||a.corExposure.status==="critical")&&o.push({type:a.corExposure.status==="critical"?"critical":"warning",title:"COR Exposure",description:a.corExposure.label,action:"Review pending CORs",actionTarget:"cors",projectId:n.id}),a.activity.status==="warning"&&o.push({type:"info",title:"Activity Notice",description:a.activity.label,action:"File daily report",actionTarget:"reports",projectId:n.id});const t={critical:0,warning:1,info:2};return o.sort((l,i)=>t[l.type]-t[i.type]),o}function _r(s){const{actualProgress:n,totalCosts:o,earnedRevenue:a,contractValue:t}=s;if(!n||n<=0)return{estimatedCompletionCost:null,estimatedFinalMargin:null,estimatedCompletionDate:null};const l=o/n,i=Math.round(l*100),r=t>0?(t-i)/t*100:0;let m=null;if(s.startDate&&n>0&&n<100){const u=new Date(s.startDate),c=new Date,j=Math.max(1,(c-u)/(1e3*60*60*24)),x=n/j,h=(100-n)/x;m=new Date(c.getTime()+h*24*60*60*1e3)}return{estimatedCompletionCost:i,estimatedFinalMargin:r,estimatedCompletionDate:m,costPerPercent:l}}function rt(s){return s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(0)+"K":s.toFixed(0)}function Sr(s){const n=d.useMemo(()=>{const l=s.reduce((b,h)=>b+(h.contract_value||0),0),i=s.reduce((b,h)=>b+(h.changeOrderValue||0),0),r=l+i,m=s.reduce((b,h)=>b+(h.billable||0),0),u=r-m,c=r>0?Math.round(m/r*100):0,j=s.reduce((b,h)=>b+(h.corPendingValue||0),0),x=s.reduce((b,h)=>b+(h.corPendingCount||0),0);return{totalOriginalContract:l,totalChangeOrders:i,totalPortfolioValue:r,totalEarned:m,totalRemaining:u,weightedCompletion:c,totalPendingCORValue:j,totalPendingCORCount:x}},[s]),o=d.useMemo(()=>{let l=0,i=0,r=0,m=0,u=0;for(const c of s){const j=c.revisedContractValue||c.contract_value;c.progress>=100&&l++,c.progress<100&&c.billable<=j*(c.progress/100)*1.1&&i++,c.billable>j*.9&&c.progress<90&&r++,c.billable>j&&m++,(c.changeOrderValue||0)>0&&u++}return{projectsComplete:l,projectsOnTrack:i,projectsAtRisk:r,projectsOverBudget:m,projectsWithChangeOrders:u}},[s]),a=d.useMemo(()=>{let l=0,i=0,r=0,m=0,u=0,c=0;for(const j of s)j.hasScheduleData&&(j.scheduleStatus==="ahead"?l++:j.scheduleStatus==="behind"?r++:i++),j.hasLaborData&&(j.laborStatus==="over"?m++:j.laborStatus==="under"?u++:c++);return{scheduleAhead:l,scheduleOnTrack:i,scheduleBehind:r,laborOver:m,laborUnder:u,laborOnTrack:c,hasAnyScheduleData:l+i+r>0,hasAnyLaborData:m+u+c>0}},[s]),t=d.useMemo(()=>{const l=s.map(r=>{const m={id:r.id,name:r.name,totalCosts:r.totalCosts||0,earnedRevenue:r.billable||0,actualProgress:r.progress||0,expectedProgress:r.expectedProgress||r.progress,pendingCORValue:r.corPendingValue||0,contractValue:r.revisedContractValue||r.contract_value||0,lastReportDate:r.lastDailyReport,recentInjuryCount:r.recentInjuryCount||0,startDate:r.start_date},u=Cr(m),c=kr(u,{...m,name:r.name}),j=_r(m),x=c.map(b=>({...b,projectName:r.name,projectId:r.id}));return{projectId:r.id,projectName:r.name,riskScore:u.score,riskStatus:u.status,riskLabel:u.label,factors:u.factors,alerts:x,projections:j}}),i=l.flatMap(r=>r.alerts).sort((r,m)=>{const u={critical:0,warning:1,info:2};return u[r.type]-u[m.type]});return{projectRisks:l,allAlerts:i,criticalCount:i.filter(r=>r.type==="critical").length,warningCount:i.filter(r=>r.type==="warning").length}},[s]);return{portfolioMetrics:n,projectHealth:o,scheduleMetrics:a,riskAnalysis:t}}function Dr({selectedProject:s,areas:n,company:o,onShowToast:a,loadAreas:t,setSelectedProject:l}){const[i,r]=d.useState(!1),[m,u]=d.useState(null),[c,j]=d.useState(!1);return{editMode:i,editData:m,saving:c,handleEditClick:()=>{u({name:s.name,job_number:s.job_number||"",address:s.address||"",general_contractor:s.general_contractor||"",client_contact:s.client_contact||"",client_phone:s.client_phone||"",contract_value:s.contract_value,work_type:s.work_type||"demolition",job_type:s.job_type||"standard",pin:s.pin||"",default_dump_site_id:s.default_dump_site_id||"",areas:n.map(v=>({id:v.id,name:v.name,weight:v.weight,isNew:!1}))}),r(!0)},handleCancelEdit:()=>{r(!1),u(null)},handleEditChange:(v,C)=>{u(O=>({...O,[v]:C}))},handleAreaEditChange:(v,C,O)=>{u(L=>({...L,areas:L.areas.map((T,S)=>S===v?{...T,[C]:O}:T)}))},handleAddArea:()=>{u(v=>({...v,areas:[...v.areas,{id:null,name:"",weight:"",isNew:!0}]}))},handleRemoveArea:v=>{m.areas.length>1&&u(C=>({...C,areas:C.areas.filter((O,L)=>L!==v)}))},handleSaveEdit:async()=>{if(!m.name.trim()){a("Please enter a project name","error");return}const v=parseFloat(m.contract_value);if(!v||v<=0){a("Please enter a valid contract value","error");return}if(m.pin&&m.pin.length!==4){a("PIN must be 4 digits","error");return}if(m.pin&&m.pin!==s.pin&&!await I.isPinAvailable(m.pin,s.id)){a("This PIN is already in use","error");return}const C=m.areas.filter(L=>L.name.trim()&&parseFloat(L.weight)>0);if(C.length===0){a("Please add at least one area","error");return}if(C.reduce((L,T)=>L+parseFloat(T.weight),0)!==100){a("Area weights must total 100%","error");return}j(!0);try{await I.updateProject(s.id,{name:m.name.trim(),job_number:m.job_number?.trim()||null,address:m.address?.trim()||null,general_contractor:m.general_contractor?.trim()||null,client_contact:m.client_contact?.trim()||null,client_phone:m.client_phone?.trim()||null,contract_value:v,work_type:m.work_type||"demolition",job_type:m.job_type||"standard",pin:m.pin||null,default_dump_site_id:m.default_dump_site_id||null},o?.id);const L=n.map(E=>E.id),T=m.areas.filter(E=>E.id).map(E=>E.id);for(const E of L)T.includes(E)||await I.deleteArea(E);for(let E=0;E<C.length;E++){const V=C[E];V.id?await I.updateArea(V.id,{name:V.name.trim(),weight:parseFloat(V.weight),sort_order:E}):await I.createArea({project_id:s.id,name:V.name.trim(),weight:parseFloat(V.weight),status:"not_started",sort_order:E})}const S=await I.getProject(s.id);l(S),await t(s.id),r(!1),u(null),a("Project updated!","success")}catch(L){console.error("Error saving project:",L?.message||L),a(L?.message||"Error saving changes","error")}finally{j(!1)}},handleDeleteProject:async v=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await I.deleteProject(s.id),l(null),a("Project deleted","success"),v()}catch(C){console.error("Error deleting project:",C),a("Error deleting project","error")}}}}const Bs=()=>oe(()=>import("./pdf-DgmPe6PY.js").then(s=>s.j),[]),ie=210,q=14,De=ie-q*2,ts=s=>s?new Date(s+(s.includes("T")?"":"T12:00:00")).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"—",Me=(s,n,o=30)=>n+o>s.internal.pageSize.height-20?(s.addPage(),20):n;async function Rr(s,n){const a=(await Bs()).default,t=new a;let l=20;t.setFontSize(18),t.setFont(void 0,"bold"),t.text("Daily Reports",ie/2,l,{align:"center"}),l+=8,t.setFontSize(11),t.setFont(void 0,"normal"),t.text(`Project: ${n.name}`,ie/2,l,{align:"center"}),l+=6,t.text(`${s.length} report${s.length!==1?"s":""}`,ie/2,l,{align:"center"}),l+=12,s.forEach((r,m)=>{l=Me(t,l,60),t.setDrawColor(200,200,200),t.setFillColor(245,247,250),t.roundedRect(q,l-2,De,10,2,2,"F"),t.setFontSize(11),t.setFont(void 0,"bold"),t.setTextColor(30,30,30),t.text(`${ts(r.report_date)}`,q+4,l+5);const u=r.status==="submitted"?"Submitted":"Draft";t.setFontSize(9),t.setFont(void 0,"normal"),t.text(u,ie-q-4,l+5,{align:"right"}),l+=14,t.setTextColor(0,0,0),t.setFontSize(9);const c=[`Crew: ${r.crew_count||0}`,`Tasks: ${r.tasks_completed||0}/${r.tasks_total||0}`,`T&M Tickets: ${r.tm_tickets_count||0}`,`Photos: ${r.photos_count||0}`];if(t.text(c.join("    |    "),q+4,l),l+=7,r.crew_list?.length>0){t.setFont(void 0,"bold"),t.text("Crew:",q+4,l),t.setFont(void 0,"normal");const j=r.crew_list.map(b=>`${b.name} (${b.role||"Laborer"})`).join(", "),x=t.splitTextToSize(j,De-8);l+=4,t.text(x,q+4,l),l+=x.length*4+2}if(r.field_notes){l=Me(t,l,15),t.setFont(void 0,"bold"),t.text("Field Notes:",q+4,l),t.setFont(void 0,"normal"),l+=4;const j=t.splitTextToSize(r.field_notes,De-8);t.text(j,q+4,l),l+=j.length*4+2}if(r.issues){l=Me(t,l,15),t.setFont(void 0,"bold"),t.text("Issues:",q+4,l),t.setFont(void 0,"normal"),l+=4;const j=t.splitTextToSize(r.issues,De-8);t.text(j,q+4,l),l+=j.length*4+2}l+=8,m<s.length-1&&(t.setDrawColor(220,220,220),t.line(q,l,ie-q,l),l+=6)});const i=`${n.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;t.save(i)}async function Er(s,n){const a=(await Bs()).default,t=new a;let l=20;t.setFontSize(18),t.setFont(void 0,"bold"),t.text("Incident / Injury Reports",ie/2,l,{align:"center"}),l+=8,t.setFontSize(11),t.setFont(void 0,"normal"),t.text(`Project: ${n.name}`,ie/2,l,{align:"center"}),l+=6,t.text(`${s.length} report${s.length!==1?"s":""}`,ie/2,l,{align:"center"}),l+=12,s.forEach((r,m)=>{l=Me(t,l,50);const c={minor:[34,197,94],serious:[245,158,11],critical:[239,68,68],near_miss:[59,130,246]}[r.injury_type]||[128,128,128];t.setFillColor(...c),t.roundedRect(q,l-2,3,14,1,1,"F"),t.setFontSize(11),t.setFont(void 0,"bold"),t.setTextColor(30,30,30),t.text(`${ts(r.incident_date)}`,q+8,l+4),t.setFontSize(9);const j=(r.injury_type||"").replace("_"," ").toUpperCase();if(t.text(j,q+8,l+10),t.setFont(void 0,"normal"),t.text(r.status==="open"?"OPEN":"CLOSED",ie-q-4,l+4,{align:"right"}),l+=16,t.setTextColor(0,0,0),r.description){t.setFontSize(9),t.setFont(void 0,"bold"),t.text("Description:",q+4,l),t.setFont(void 0,"normal"),l+=4;const x=t.splitTextToSize(r.description,De-8);t.text(x,q+4,l),l+=x.length*4+2}r.location&&(t.setFont(void 0,"bold"),t.text("Location: ",q+4,l),t.setFont(void 0,"normal"),t.text(r.location,q+30,l),l+=6),l+=6,m<s.length-1&&(t.setDrawColor(220,220,220),t.line(q,l,ie-q,l),l+=6)});const i=`${n.name}_Incident_Reports_${new Date().toISOString().split("T")[0]}.pdf`;t.save(i)}async function Tr(s,n){const a=(await Bs()).default,t=new a;let l=20;t.setFontSize(18),t.setFont(void 0,"bold"),t.text("Crew Check-In History",ie/2,l,{align:"center"}),l+=8,t.setFontSize(11),t.setFont(void 0,"normal"),t.text(`Project: ${n.name}`,ie/2,l,{align:"center"}),l+=6,t.text(`${s.length} check-in${s.length!==1?"s":""}`,ie/2,l,{align:"center"}),l+=12,s.forEach((r,m)=>{l=Me(t,l,30);const u=r.workers||[];t.setFillColor(245,247,250),t.roundedRect(q,l-2,De,9,2,2,"F"),t.setFontSize(10),t.setFont(void 0,"bold"),t.setTextColor(30,30,30),t.text(ts(r.check_in_date),q+4,l+4),t.setFont(void 0,"normal"),t.text(`${u.length} workers`,ie-q-4,l+4,{align:"right"}),l+=12,t.setTextColor(0,0,0),t.setFontSize(9),u.length>0&&(t.setFont(void 0,"bold"),t.text("Name",q+4,l),t.text("Role",110,l),l+=5,t.setFont(void 0,"normal"),u.forEach(c=>{l=Me(t,l,6),t.text(c.name||"—",q+4,l),t.text(c.role||"Laborer",110,l),l+=4.5})),l+=6,m<s.length-1&&(t.setDrawColor(220,220,220),t.line(q,l,ie-q,l),l+=5)});const i=`${n.name}_Crew_Checkins_${new Date().toISOString().split("T")[0]}.pdf`;t.save(i)}async function Fr({dailyReports:s=[],incidentReports:n=[],crewCheckins:o=[],project:a}){const l=(await Bs()).default,i=new l;let r=20;i.setFontSize(22),i.setFont(void 0,"bold"),i.text("Field Documents Report",ie/2,r,{align:"center"}),r+=10,i.setFontSize(13),i.setFont(void 0,"normal"),i.text(`Project: ${a.name}`,ie/2,r,{align:"center"}),r+=8,i.setFontSize(10),i.text(`Generated: ${new Date().toLocaleDateString()}`,ie/2,r,{align:"center"}),r+=16,i.setFontSize(11),i.setFont(void 0,"bold"),i.text("Document Summary",q,r),r+=8,i.setFontSize(10),i.setFont(void 0,"normal"),[["Daily Reports",`${s.length}`],["Incident Reports",`${n.length}`],["Crew Check-Ins",`${o.length}`]].forEach(([c,j])=>{i.text(c,q+4,r),i.text(j,100,r),r+=6}),s.length>0&&(i.addPage(),r=20,i.setFontSize(16),i.setFont(void 0,"bold"),i.text("Daily Reports",q,r),r+=10,s.forEach((c,j)=>{if(r=Me(i,r,40),i.setFontSize(10),i.setFont(void 0,"bold"),i.setTextColor(30,30,30),i.text(ts(c.report_date),q+2,r),i.setFont(void 0,"normal"),i.setFontSize(8),i.text(`Crew: ${c.crew_count||0} | Tasks: ${c.tasks_completed||0}/${c.tasks_total||0} | T&M: ${c.tm_tickets_count||0}`,q+60,r),r+=6,i.setTextColor(0,0,0),i.setFontSize(9),c.field_notes){const x=i.splitTextToSize(c.field_notes,De-4);i.text(x,q+2,r),r+=x.length*4+2}if(c.issues){i.setFont(void 0,"bold"),i.text("Issues: ",q+2,r),i.setFont(void 0,"normal");const x=i.splitTextToSize(c.issues,De-20);i.text(x,q+20,r),r+=x.length*4+2}r+=4,j<s.length-1&&(i.setDrawColor(220,220,220),i.line(q,r,ie-q,r),r+=4)})),n.length>0&&(i.addPage(),r=20,i.setFontSize(16),i.setFont(void 0,"bold"),i.text("Incident / Injury Reports",q,r),r+=10,n.forEach((c,j)=>{r=Me(i,r,35),i.setFontSize(10),i.setFont(void 0,"bold"),i.setTextColor(30,30,30),i.text(ts(c.incident_date),q+2,r),i.setFontSize(8),i.setFont(void 0,"normal");const x=(c.injury_type||"").replace("_"," ").toUpperCase();if(i.text(`${x} — ${c.status?.toUpperCase()||""}`,q+60,r),r+=6,i.setTextColor(0,0,0),i.setFontSize(9),c.description){const b=i.splitTextToSize(c.description,De-4);i.text(b,q+2,r),r+=b.length*4+2}c.location&&(i.text(`Location: ${c.location}`,q+2,r),r+=5),r+=4,j<n.length-1&&(i.setDrawColor(220,220,220),i.line(q,r,ie-q,r),r+=4)})),o.length>0&&(i.addPage(),r=20,i.setFontSize(16),i.setFont(void 0,"bold"),i.text("Crew Check-In History",q,r),r+=10,o.forEach((c,j)=>{r=Me(i,r,20);const x=c.workers||[];if(i.setFontSize(10),i.setFont(void 0,"bold"),i.setTextColor(30,30,30),i.text(ts(c.check_in_date),q+2,r),i.setFont(void 0,"normal"),i.setFontSize(8),i.text(`${x.length} workers`,q+60,r),r+=6,i.setTextColor(0,0,0),i.setFontSize(8),x.length>0){const b=x.map(p=>`${p.name} (${p.role||"Laborer"})`).join(", "),h=i.splitTextToSize(b,De-4);i.text(h,q+2,r),r+=h.length*3.5+3}j<o.length-1&&(i.setDrawColor(230,230,230),i.line(q,r,ie-q,r),r+=3)}));const u=`${a.name}_Field_Documents_${new Date().toISOString().split("T")[0]}.pdf`;i.save(u)}function Us(s,n,o="text/csv"){const a=new Blob([s],{type:o}),t=URL.createObjectURL(a),l=document.createElement("a");l.href=t,l.download=n,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(t)}function ra(s){if(s==null)return"";const n=String(s);return n.includes(",")||n.includes('"')||n.includes(`
`)?`"${n.replace(/"/g,'""')}"`:n}function xt(s,n){const o=s.map(t=>ra(t.label)).join(","),a=n.map(t=>s.map(l=>ra(t[l.key])).join(","));return[o,...a].join(`
`)}function Mr(s,n){const o=[{key:"category",label:"Category"},{key:"description",label:"Description"},{key:"amount",label:"Amount"},{key:"date",label:"Date"},{key:"type",label:"Type"}],a=[];a.push({category:"Revenue",description:"Original Contract Value",amount:s.contract_value||0,date:s.start_date||"",type:"Contract"}),n?.earnedRevenue&&a.push({category:"Revenue",description:"Earned Revenue (Progress)",amount:n.earnedRevenue,date:new Date().toISOString().split("T")[0],type:"Earned"}),n?.approvedCORs&&n.approvedCORs.forEach(m=>{a.push({category:"Revenue",description:`COR: ${m.cor_number} - ${m.title}`,amount:(m.cor_total||0)/100,date:m.approved_at?.split("T")[0]||"",type:"Change Order"})}),n?.laborByDate&&n.laborByDate.forEach(m=>{a.push({category:"Cost",description:"Labor",amount:m.cost,date:m.date,type:"Labor"})}),n?.haulOffByDate&&n.haulOffByDate.forEach(m=>{a.push({category:"Cost",description:"Disposal/Haul-off",amount:m.cost,date:m.date,type:"Disposal"})}),n?.customCosts&&n.customCosts.forEach(m=>{a.push({category:"Cost",description:m.description||m.category||"Other",amount:parseFloat(m.amount)||0,date:m.cost_date||"",type:m.category||"Other"})});const t=a.filter(m=>m.category==="Revenue").reduce((m,u)=>m+(parseFloat(u.amount)||0),0),l=a.filter(m=>m.category==="Cost").reduce((m,u)=>m+(parseFloat(u.amount)||0),0);a.push({category:"",description:"",amount:"",date:"",type:""}),a.push({category:"Summary",description:"Total Revenue",amount:t,date:"",type:""}),a.push({category:"Summary",description:"Total Costs",amount:l,date:"",type:""}),a.push({category:"Summary",description:"Gross Profit",amount:t-l,date:"",type:""}),a.push({category:"Summary",description:"Margin %",amount:t>0?((t-l)/t*100).toFixed(1)+"%":"N/A",date:"",type:""});const i=xt(o,a),r=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_Financials_${new Date().toISOString().split("T")[0]}.csv`;Us(i,r)}function Ji(s,n){const o=[],a=[{key:"section",label:"Section"},{key:"description",label:"Description"},{key:"quantity",label:"Quantity"},{key:"unit",label:"Unit"},{key:"rate",label:"Rate"},{key:"total",label:"Total"}];o.push({section:"COR Info",description:`${s.cor_number} - ${s.title}`,quantity:"",unit:"",rate:"",total:""}),o.push({section:"Status",description:s.status,quantity:"",unit:"",rate:"",total:""}),o.push({section:"Period",description:`${s.period_start||""} to ${s.period_end||""}`,quantity:"",unit:"",rate:"",total:""}),o.push({section:"",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_labor?.length>0&&(o.push({section:"LABOR",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_labor.forEach(i=>{const r=parseFloat(i.regular_hours)||0,m=parseFloat(i.overtime_hours)||0;o.push({section:"",description:i.description||i.classification,quantity:r+m,unit:"hours",rate:(parseInt(i.regular_rate)||0)/100,total:(parseInt(i.total)||0)/100})})),s.change_order_materials?.length>0&&(o.push({section:"MATERIALS",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_materials.forEach(i=>{o.push({section:"",description:i.description,quantity:parseFloat(i.quantity)||0,unit:i.unit||"each",rate:(parseInt(i.unit_cost)||0)/100,total:(parseInt(i.total)||0)/100})})),s.change_order_equipment?.length>0&&(o.push({section:"EQUIPMENT",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_equipment.forEach(i=>{o.push({section:"",description:i.description,quantity:parseFloat(i.quantity)||0,unit:i.unit||"day",rate:(parseInt(i.unit_cost)||0)/100,total:(parseInt(i.total)||0)/100})})),s.change_order_subcontractors?.length>0&&(o.push({section:"SUBCONTRACTORS",description:"",quantity:"",unit:"",rate:"",total:""}),s.change_order_subcontractors.forEach(i=>{o.push({section:"",description:i.description,quantity:parseFloat(i.quantity)||0,unit:i.unit||"lump sum",rate:(parseInt(i.unit_cost)||0)/100,total:(parseInt(i.total)||0)/100})}));const t=xt(a,o),l=`COR_${s.cor_number||s.id}_${new Date().toISOString().split("T")[0]}.csv`;Us(t,l)}function Yi(s,n){const o=[{key:"date",label:"Date"},{key:"status",label:"Status"},{key:"workers",label:"Worker Count"},{key:"totalHours",label:"Total Hours"},{key:"otHours",label:"OT Hours"},{key:"materialsCost",label:"Materials Cost"},{key:"corNumber",label:"COR #"},{key:"notes",label:"Notes"}],a=s.map(i=>{const r=i.t_and_m_workers||[],m=i.t_and_m_items||[],u=r.reduce((x,b)=>x+(parseFloat(b.hours)||0),0),c=r.reduce((x,b)=>x+(parseFloat(b.overtime_hours)||0),0),j=m.reduce((x,b)=>x+(parseFloat(b.quantity)||0)*(b.materials_equipment?.cost_per_unit||0),0);return{date:i.work_date,status:i.status,workers:r.length,totalHours:(u+c).toFixed(1),otHours:c.toFixed(1),materialsCost:j.toFixed(2),corNumber:i.assigned_cor_id?"Linked":"",notes:i.notes||""}}),t=xt(o,a),l=`${n.name.replace(/[^a-zA-Z0-9]/g,"_")}_TM_Tickets_${new Date().toISOString().split("T")[0]}.csv`;Us(t,l)}function $r(s,n){const o=[],a=new Date().toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"});o.push("!TRNS	TRNSTYPE	DATE	ACCNT	NAME	AMOUNT	MEMO"),o.push("!SPL	TRNSTYPE	DATE	ACCNT	NAME	AMOUNT	MEMO"),o.push("!ENDTRNS");const t=s.contract_value||0;o.push(`TRNS	GENERAL JOURNAL	${a}	Accounts Receivable	${s.name}	${t.toFixed(2)}	FieldSync - Contract Revenue`),o.push(`SPL	GENERAL JOURNAL	${a}	Construction Revenue	${s.name}	${(-t).toFixed(2)}	Contract: ${s.name}`),o.push("ENDTRNS");const l=n?.totalLaborCost||0;l>0&&(o.push(`TRNS	GENERAL JOURNAL	${a}	Direct Labor	${s.name}	${l.toFixed(2)}	Labor costs - ${s.name}`),o.push(`SPL	GENERAL JOURNAL	${a}	Accounts Payable	${s.name}	${(-l).toFixed(2)}	Labor costs`),o.push("ENDTRNS"));const i=n?.totalDisposalCost||0;i>0&&(o.push(`TRNS	GENERAL JOURNAL	${a}	Disposal Expense	${s.name}	${i.toFixed(2)}	Disposal costs - ${s.name}`),o.push(`SPL	GENERAL JOURNAL	${a}	Accounts Payable	${s.name}	${(-i).toFixed(2)}	Disposal costs`),o.push("ENDTRNS"));const r=o.join(`
`),m=`${s.name.replace(/[^a-zA-Z0-9]/g,"_")}_QB_${new Date().toISOString().split("T")[0]}.iif`;Us(r,m,"application/x-iif")}function Pr({isOpen:s,onClose:n,companyId:o,onSelectProject:a,onSelectTicket:t,onSelectCOR:l,onShowToast:i}){const[r,m]=d.useState(""),[u,c]=d.useState({projects:[],tickets:[],cors:[],workers:[]}),[j,x]=d.useState(!1),[b,h]=d.useState(0),p=d.useRef(null),D=d.useRef(null),F=d.useRef(null);d.useEffect(()=>()=>{D.current&&clearTimeout(D.current),F.current&&clearTimeout(F.current)},[]),d.useEffect(()=>{s&&(m(""),c({projects:[],tickets:[],cors:[],workers:[]}),h(0),F.current=setTimeout(()=>p.current?.focus(),50))},[s]);const N=d.useCallback(async S=>{if(!S.trim()||S.length<2){c({projects:[],tickets:[],cors:[],workers:[]});return}x(!0);try{const E=await I.universalSearch(o,S.trim());c(E),h(0)}catch(E){console.error("Search error:",E),i?.("Search failed","error")}finally{x(!1)}},[o,i]),$=S=>{const E=S.target.value;m(E),D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{N(E)},200)},C=(()=>{const S=[];return u.projects.forEach(E=>S.push({type:"project",data:E})),u.tickets.forEach(E=>S.push({type:"ticket",data:E})),u.cors.forEach(E=>S.push({type:"cor",data:E})),u.workers.forEach(E=>S.push({type:"worker",data:E})),S})(),O=C.length>0,L=S=>{S.key==="Escape"?n():S.key==="ArrowDown"?(S.preventDefault(),h(E=>Math.min(E+1,C.length-1))):S.key==="ArrowUp"?(S.preventDefault(),h(E=>Math.max(E-1,0))):S.key==="Enter"&&O&&(S.preventDefault(),T(C[b]))},T=S=>{if(S){switch(S.type){case"project":a?.(S.data);break;case"ticket":t?.(S.data);break;case"cor":l?.(S.data);break;case"worker":S.data.lastProject&&a?.(S.data.lastProject);break}n()}};return s?e.jsx("div",{className:"universal-search-overlay",onClick:n,children:e.jsxs("div",{className:"universal-search-modal",onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"universal-search-input-wrapper",children:[e.jsx(ja,{size:20,className:"universal-search-icon"}),e.jsx("input",{ref:p,type:"text",value:r,onChange:$,onKeyDown:L,placeholder:"Search projects, tickets, CORs, workers...",className:"universal-search-input",autoComplete:"off",autoCorrect:"off",spellCheck:"false"}),r&&e.jsx("button",{className:"universal-search-clear",onClick:()=>m(""),children:e.jsx(as,{size:16})}),e.jsx("div",{className:"universal-search-shortcut",children:e.jsx("span",{children:"esc"})})]}),e.jsx("div",{className:"universal-search-results",children:j?e.jsxs("div",{className:"universal-search-loading",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"Searching..."})]}):r.trim()?O?e.jsxs(e.Fragment,{children:[u.projects.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(ct,{size:14}),e.jsx("span",{children:"Projects"})]}),u.projects.map((S,E)=>{const V=E;return e.jsxs("button",{className:`universal-search-item ${b===V?"selected":""}`,onClick:()=>T({type:"project",data:S}),onMouseEnter:()=>h(V),children:[e.jsx(ct,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:S.name}),S.job_number&&e.jsxs("span",{className:"universal-search-item-meta",children:["#",S.job_number]})]}),e.jsx(Ie,{size:16,className:"universal-search-item-arrow"})]},S.id)})]}),u.tickets.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(ss,{size:14}),e.jsx("span",{children:"T&M Tickets"})]}),u.tickets.map((S,E)=>{const V=u.projects.length+E;return e.jsxs("button",{className:`universal-search-item ${b===V?"selected":""}`,onClick:()=>T({type:"ticket",data:S}),onMouseEnter:()=>h(V),children:[e.jsx(ss,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[S.description?.substring(0,50)||"T&M Ticket",S.description?.length>50&&"..."]}),e.jsxs("span",{className:"universal-search-item-meta",children:[S.projectName," • ",S.work_date]})]}),e.jsx("span",{className:`universal-search-item-badge ${S.status}`,children:S.status})]},S.id)})]}),u.cors.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(xe,{size:14}),e.jsx("span",{children:"Change Orders"})]}),u.cors.map((S,E)=>{const V=u.projects.length+u.tickets.length+E;return e.jsxs("button",{className:`universal-search-item ${b===V?"selected":""}`,onClick:()=>T({type:"cor",data:S}),onMouseEnter:()=>h(V),children:[e.jsx(xe,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[S.cor_number?`COR #${S.cor_number}: `:"",S.title]}),e.jsx("span",{className:"universal-search-item-meta",children:S.projectName})]}),e.jsx("span",{className:`universal-search-item-badge ${S.status}`,children:S.status})]},S.id)})]}),u.workers.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(Re,{size:14}),e.jsx("span",{children:"Workers"})]}),u.workers.map((S,E)=>{const V=u.projects.length+u.tickets.length+u.cors.length+E;return e.jsxs("button",{className:`universal-search-item ${b===V?"selected":""}`,onClick:()=>T({type:"worker",data:S}),onMouseEnter:()=>h(V),children:[e.jsx(Re,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:S.name}),e.jsxs("span",{className:"universal-search-item-meta",children:[S.role," • ",S.projectName]})]}),e.jsx(Ie,{size:16,className:"universal-search-item-arrow"})]},`${S.name}-${E}`)})]})]}):e.jsx("div",{className:"universal-search-no-results",children:e.jsxs("span",{children:['No results for "',r,'"']})}):e.jsxs("div",{className:"universal-search-empty",children:[e.jsxs("div",{className:"universal-search-tip",children:[e.jsx(qn,{size:14}),e.jsx("span",{children:"Type to search across all data"})]}),e.jsxs("div",{className:"universal-search-hints",children:[e.jsx("span",{children:"Projects"}),e.jsx("span",{children:"T&M Tickets"}),e.jsx("span",{children:"Change Orders"}),e.jsx("span",{children:"Workers"})]})]})}),e.jsxs("div",{className:"universal-search-footer",children:[e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↑↓"})," navigate"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↵"})," select"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"esc"})," close"]})]})]})}):null}function Ar(){const[s,n]=d.useState(!1);return d.useEffect(()=>{const o=a=>{(a.metaKey||a.ctrlKey)&&a.key==="k"&&(a.preventDefault(),n(t=>!t))};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[]),{isOpen:s,setIsOpen:n,open:()=>n(!0),close:()=>n(!1)}}function Or({alerts:s=[],onAction:n,onDismiss:o,maxVisible:a=3,className:t=""}){const[l,i]=d.useState(new Set),r=s.filter(u=>!l.has(u.id||`${u.projectId}-${u.type}-${u.title}`)).slice(0,a),m=d.useCallback(u=>{const c=u.id||`${u.projectId}-${u.type}-${u.title}`;i(j=>new Set([...j,c])),o?.(u)},[o]);return r.length===0?null:e.jsxs("div",{className:`smart-alerts ${t}`,role:"region","aria-label":"Project alerts","aria-live":"polite",children:[r.map((u,c)=>e.jsx(Lr,{alert:u,onAction:n,onDismiss:()=>m(u)},u.id||`${u.projectId}-${u.type}-${c}`)),s.length>a&&e.jsx("div",{className:"smart-alerts__overflow",children:e.jsxs("span",{className:"smart-alerts__overflow-text",children:["+",s.length-a," more alerts"]})})]})}function Lr({alert:s,onAction:n,onDismiss:o}){const{type:a="info",title:t,description:l,action:i,actionTarget:r,projectId:m,projectName:u}=s,j={critical:Vn,warning:Fe,info:As}[a]||As,x=()=>{n?.({target:r,projectId:m,alert:s})};return e.jsxs("div",{className:`smart-alert smart-alert--${a}`,role:"alert","aria-live":a==="critical"?"assertive":"polite",children:[e.jsx(j,{className:"smart-alert__icon","aria-hidden":"true"}),e.jsxs("div",{className:"smart-alert__content",children:[e.jsxs("div",{className:"smart-alert__title",children:[u&&e.jsxs("span",{className:"smart-alert__project",children:[u,": "]}),t]}),l&&e.jsx("div",{className:"smart-alert__description",children:l}),i&&e.jsx("div",{className:"smart-alert__action",children:e.jsxs("button",{type:"button",className:"smart-alert__action-btn",onClick:x,children:[i,e.jsx(ms,{size:14,"aria-hidden":"true"})]})})]}),o&&e.jsx("button",{type:"button",className:"smart-alert__dismiss",onClick:o,"aria-label":"Dismiss alert",children:e.jsx(as,{size:18,"aria-hidden":"true"})})]})}const zr=d.memo(function({progress:n=0,areasComplete:o=0,totalAreas:a=0,areasWorking:t=0,size:l=110,strokeWidth:i=9}){const[r,m]=d.useState(0),u=d.useRef(null);d.useEffect(()=>{const h=r,p=Math.min(100,Math.max(0,n)),D=800,F=performance.now(),N=$=>{const v=$-F,C=Math.min(v/D,1),O=1-Math.pow(1-C,3),L=h+(p-h)*O;m(L),C<1&&(u.current=requestAnimationFrame(N))};return u.current=requestAnimationFrame(N),()=>{u.current&&cancelAnimationFrame(u.current)}},[n]);const c=(l-i)/2,j=c*2*Math.PI,x=j-r/100*j,b=()=>r>=80?"var(--accent-green)":r>=50||r>=25?"var(--accent-blue)":"var(--text-muted)";return e.jsxs("div",{className:"overview-progress-gauge",children:[e.jsxs("div",{className:"progress-gauge-circle",style:{width:l,height:l},children:[e.jsxs("svg",{width:l,height:l,viewBox:`0 0 ${l} ${l}`,children:[e.jsx("circle",{className:"gauge-track",cx:l/2,cy:l/2,r:c,fill:"none",strokeWidth:i,stroke:"var(--bg-tertiary)"}),e.jsx("circle",{className:"gauge-fill",cx:l/2,cy:l/2,r:c,fill:"none",stroke:b(),strokeWidth:i,strokeDasharray:j,strokeDashoffset:x,strokeLinecap:"round",transform:`rotate(-90 ${l/2} ${l/2})`,style:{transition:"stroke 0.3s ease"}})]}),e.jsxs("div",{className:"gauge-center",children:[e.jsxs("span",{className:"gauge-value",children:[Math.round(r),"%"]}),e.jsx("span",{className:"gauge-label",children:"Complete"})]})]}),e.jsxs("div",{className:"gauge-areas-status",children:[e.jsxs("span",{className:"areas-count",children:[e.jsx("strong",{children:o}),"/",a," Areas Done"]}),t>0&&e.jsxs("span",{className:"areas-active",children:[t," active"]})]})]})}),G={contract:"#3b82f6",revenue:"#10b981",costs:"#f59e0b",profit:"#22c55e",loss:"#ef4444",tmValue:"#8b5cf6",corValue:"#14b8a6",labor:"#6366f1",disposal:"#14b8a6",equipment:"#f97316",materials:"#a855f7",subcontractor:"#ec4899",other:"#6b7280"},us={duration:800},Os={contentStyle:{background:"var(--bg-card)",border:"1px solid var(--border-color)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"12px 16px"},labelStyle:{color:"var(--text-primary)",fontWeight:600,marginBottom:"8px"}},ia={labor:{label:"Labor",color:G.labor,icon:"HardHat"},disposal:{label:"Disposal",color:G.disposal,icon:"Trash2"},equipment:{label:"Equipment",color:G.equipment,icon:"Truck"},materials:{label:"Materials",color:G.materials,icon:"Package"},subcontractor:{label:"Subcontractor",color:G.subcontractor,icon:"Users"},other:{label:"Other",color:G.other,icon:"MoreHorizontal"}},la=[{id:"7d",label:"7D",days:7},{id:"30d",label:"30D",days:30},{id:"90d",label:"90D",days:90},{id:"all",label:"All",days:null}],ze=s=>s>=1e6?`$${(s/1e6).toFixed(1)}M`:s>=1e3?`$${(s/1e3).toFixed(0)}K`:`$${s.toFixed(0)}`,jt=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}),Ir={revenue:{id:"revenueGradient",color:G.revenue,startOpacity:.3,endOpacity:0},costs:{id:"costsGradient",color:G.costs,startOpacity:.3,endOpacity:0},tmValue:{id:"tmValueGradient",color:G.tmValue,startOpacity:.2,endOpacity:0}},qr=d.memo(function({earnedRevenue:n=0,totalCosts:o=0,laborCost:a=0,disposalCost:t=0,equipmentCost:l=0,materialsCost:i=0,otherCost:r=0,contractValue:m=0}){const u=n-o,c=n>0?u/n*100:0,j=u>=0,x=p=>p>=1e6?`$${(p/1e6).toFixed(1)}M`:p>=1e3?`$${(p/1e3).toFixed(1)}K`:`$${p.toFixed(0)}`,b=[{key:"labor",value:a,color:G.labor,label:"Labor"},{key:"disposal",value:t,color:G.disposal,label:"Disposal"},{key:"equipment",value:l,color:G.equipment,label:"Equipment"},{key:"materials",value:i,color:G.materials,label:"Materials"},{key:"other",value:r,color:G.other,label:"Other"}].filter(p=>p.value>0),h=b.length>0&&o>0;return e.jsxs("div",{className:"overview-financial-card animate-fade-in-up",children:[e.jsxs("div",{className:"financial-metrics-row",children:[e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value green",children:x(n)}),e.jsx("span",{className:"financial-metric-label",children:"Earned"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsx("span",{className:"financial-metric-value amber",children:x(o)}),e.jsx("span",{className:"financial-metric-label",children:"Costs"})]}),e.jsxs("div",{className:"financial-metric",children:[e.jsxs("span",{className:`financial-metric-value ${j?"green":"red"}`,children:[j?"":"-",x(Math.abs(u))]}),e.jsxs("span",{className:"financial-metric-label",children:["Profit",e.jsxs("span",{className:`margin-badge ${j?"positive":"negative"}`,children:[c>=0?"+":"",c.toFixed(0),"%"]})]})]})]}),h&&e.jsxs("div",{className:"cost-breakdown-section",children:[e.jsx("div",{className:"cost-breakdown-bar",children:b.map((p,D)=>{const F=p.value/o*100;return e.jsx("div",{className:"cost-segment",style:{width:`${F}%`,backgroundColor:p.color,animationDelay:`${D*100}ms`},title:`${p.label}: ${x(p.value)} (${F.toFixed(0)}%)`},p.key)})}),e.jsx("div",{className:"cost-breakdown-legend",children:b.slice(0,4).map(p=>e.jsxs("span",{className:"legend-item",children:[e.jsx("span",{className:"legend-dot",style:{backgroundColor:p.color}}),e.jsx("span",{className:"legend-label",children:p.label})]},p.key))})]})]})}),Vr=()=>oe(()=>import("./pdf-DgmPe6PY.js").then(s=>s.j),[]),Fs={contract:G.contract,tm:G.costs},ca=[{id:"7d",label:"7D",days:7},{id:"14d",label:"14D",days:14},{id:"30d",label:"30D",days:30}],Br=d.memo(function({project:n,onShowToast:o}){const[a,t]=d.useState([]),[l,i]=d.useState([]),[r,m]=d.useState(new Date().toISOString().split("T")[0]),[u,c]=d.useState("14d"),[j,x]=d.useState(!0),[b,h]=d.useState(!1);d.useEffect(()=>{n?.id&&p()},[n?.id]);const p=async()=>{x(!0);try{const[A,B]=await Promise.all([I.getCrewCheckinHistory(n.id,365),I.getTMTickets(n.id)]);t(A||[]),i(B||[])}catch(A){console.error("Error loading crew metrics:",A)}finally{x(!1)}},D=d.useMemo(()=>{const A={};return l.forEach(B=>{const R=B.work_date;R&&(A[R]||(A[R]=new Set),(B.t_and_m_workers||[]).forEach(se=>{A[R].add(se.name.toLowerCase().trim())}))}),A},[l]),F=d.useMemo(()=>{const A={};return a.forEach(B=>{A[B.check_in_date]=B.workers||[]}),A},[a]),N=F[r]||[],$=D[r]||new Set,v=d.useMemo(()=>{const A=[],B=[];return N.forEach(R=>{$.has(R.name.toLowerCase().trim())?B.push(R):A.push(R)}),{total:N.length,contract:A,tm:B}},[N,$]),C=d.useMemo(()=>{const A=ca.find(se=>se.id===u)?.days||14,B=[],R=new Date;for(let se=A-1;se>=0;se--){const P=new Date(R);P.setDate(P.getDate()-se);const re=P.toISOString().split("T")[0],ue=F[re]||[],le=D[re]||new Set;let _e=0,M=0;ue.forEach(g=>{le.has(g.name.toLowerCase().trim())?M++:_e++}),B.push({date:re,displayDate:jt(re),contract:_e,tm:M,total:ue.length})}return B},[F,D,u]),O=d.useCallback(A=>{const B=new Date(r+"T12:00:00");B.setDate(B.getDate()+A),m(B.toISOString().split("T")[0])},[r]),L=r===new Date().toISOString().split("T")[0],T=A=>new Date(A+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),S=d.useCallback(A=>{A?.date&&m(A.date)},[]),E=({active:A,payload:B,label:R})=>{if(!A||!B?.length)return null;const se=(B[0]?.value||0)+(B[1]?.value||0);return e.jsxs("div",{style:{...Os.contentStyle,fontSize:"0.8rem"},children:[e.jsx("p",{style:{...Os.labelStyle,fontSize:"0.85rem",marginBottom:6},children:R}),e.jsxs("p",{style:{margin:"3px 0",color:Fs.contract},children:["Contract: ",e.jsx("strong",{children:B[0]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:Fs.tm},children:["T&M: ",e.jsx("strong",{children:B[1]?.value||0})]}),e.jsxs("p",{style:{margin:"3px 0",color:"var(--text-primary)",borderTop:"1px solid var(--border-color)",paddingTop:4},children:["Total: ",e.jsx("strong",{children:se})]})]})},V=d.useCallback(async()=>{h(!0),o?.("Generating crew report PDF...","info");try{const B=(await Vr()).default,R=new B,se=R.internal.pageSize.width;let P=20;R.setFontSize(18),R.setFont(void 0,"bold"),R.text("Crew On-Site Report",se/2,P,{align:"center"}),P+=8,R.setFontSize(11),R.setFont(void 0,"normal"),R.text(`Project: ${n.name}`,se/2,P,{align:"center"}),P+=6,R.text(`Date: ${T(r)}`,se/2,P,{align:"center"}),P+=12,R.setFontSize(12),R.setFont(void 0,"bold"),R.text("Selected Day Summary",14,P),P+=7,R.setFontSize(10),R.setFont(void 0,"normal"),R.text(`Total Crew On-Site: ${v.total}`,14,P),P+=5,R.text(`Contract Workers: ${v.contract.length}`,14,P),P+=5,R.text(`T&M Workers: ${v.tm.length}`,14,P),P+=10,v.contract.length>0&&(R.setFontSize(12),R.setFont(void 0,"bold"),R.text("Contract Workers",14,P),P+=7,R.setFontSize(9),R.setFont(void 0,"bold"),R.text("Name",14,P),R.text("Role",100,P),P+=5,R.setFont(void 0,"normal"),v.contract.forEach(le=>{P>270&&(R.addPage(),P=20),R.text(le.name,14,P),R.text(le.role||"—",100,P),P+=5}),P+=8),v.tm.length>0&&(P>240&&(R.addPage(),P=20),R.setFontSize(12),R.setFont(void 0,"bold"),R.text("T&M Workers (Extra Work)",14,P),P+=7,R.setFontSize(9),R.setFont(void 0,"bold"),R.text("Name",14,P),R.text("Role",100,P),P+=5,R.setFont(void 0,"normal"),v.tm.forEach(le=>{P>270&&(R.addPage(),P=20),R.text(le.name,14,P),R.text(le.role||"—",100,P),P+=5}),P+=8),P>200&&(R.addPage(),P=20),R.setFontSize(12),R.setFont(void 0,"bold"),R.text("Daily Timeline",14,P),P+=7,R.setFontSize(8),R.setFont(void 0,"bold"),R.text("Date",14,P),R.text("Total",70,P),R.text("Contract",95,P),R.text("T&M",125,P),P+=5,R.setFont(void 0,"normal"),C.forEach(le=>{P>275&&(R.addPage(),P=20),R.text(le.displayDate,14,P),R.text(String(le.total),70,P),R.text(String(le.contract),95,P),R.text(String(le.tm),125,P),P+=4.5});const re=R.internal.pageSize.height-10;R.setFontSize(8),R.setTextColor(128,128,128),R.text(`Generated ${new Date().toLocaleString()} — FieldSync`,se/2,re,{align:"center"});const ue=`${n.name}_Crew_Report_${r}.pdf`;R.save(ue),o?.("PDF exported!","success")}catch(A){console.error("Error exporting crew PDF:",A),o?.("Error generating PDF","error")}finally{h(!1)}},[n,r,v,C,o]);return j?e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsx("div",{className:"crew-metrics-header",children:e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Crew On-Site"]})}),e.jsxs("div",{className:"crew-metrics-loading",children:[e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"}),e.jsx("div",{className:"skeleton-stat"})]})]}):e.jsxs("div",{className:"crew-metrics-card animate-fade-in-up",children:[e.jsxs("div",{className:"crew-metrics-header",children:[e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Crew On-Site"]}),e.jsx("div",{className:"crew-metrics-actions",children:e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:V,disabled:b,title:"Export crew report as PDF",children:[e.jsx(We,{size:14})," ",b?"Exporting...":"PDF"]})})]}),e.jsxs("div",{className:"crew-date-nav",children:[e.jsx("button",{className:"crew-date-btn",onClick:()=>O(-1),children:e.jsx(va,{size:16})}),e.jsxs("span",{className:"crew-date-label",children:[e.jsx(Ls,{size:14}),L?"Today":T(r)]}),e.jsx("button",{className:"crew-date-btn",onClick:()=>O(1),disabled:L,children:e.jsx(Ie,{size:16})})]}),e.jsxs("div",{className:"crew-stats-row",children:[e.jsxs("div",{className:"crew-stat total",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(Re,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:v.total}),e.jsx("span",{className:"crew-stat-label",children:"Total On-Site"})]})]}),e.jsxs("div",{className:"crew-stat contract",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(He,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:v.contract.length}),e.jsx("span",{className:"crew-stat-label",children:"Contract"})]})]}),e.jsxs("div",{className:"crew-stat tm",children:[e.jsx("div",{className:"crew-stat-icon",children:e.jsx(ot,{size:20})}),e.jsxs("div",{className:"crew-stat-content",children:[e.jsx("span",{className:"crew-stat-value",children:v.tm.length}),e.jsx("span",{className:"crew-stat-label",children:"T&M"})]})]})]}),v.total>0&&e.jsxs("div",{className:"crew-breakdown-bar",children:[e.jsx("div",{className:"crew-bar-segment contract",style:{width:`${v.contract.length/v.total*100}%`},title:`${v.contract.length} Contract`}),e.jsx("div",{className:"crew-bar-segment tm",style:{width:`${v.tm.length/v.total*100}%`},title:`${v.tm.length} T&M`})]}),v.total>0&&e.jsxs("div",{className:"crew-name-lists",children:[v.contract.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header contract",children:[e.jsx(He,{size:13}),e.jsxs("span",{children:["Contract (",v.contract.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:v.contract.map((A,B)=>e.jsxs("span",{className:"crew-name-tag contract",children:[A.name,A.role&&A.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:A.role})]},B))})]}),v.tm.length>0&&e.jsxs("div",{className:"crew-name-group",children:[e.jsxs("div",{className:"crew-name-group-header tm",children:[e.jsx(ot,{size:13}),e.jsxs("span",{children:["T&M (",v.tm.length,")"]})]}),e.jsx("div",{className:"crew-name-tags",children:v.tm.map((A,B)=>e.jsxs("span",{className:"crew-name-tag tm",children:[A.name,A.role&&A.role!=="Laborer"&&e.jsx("span",{className:"crew-name-role",children:A.role})]},B))})]})]}),e.jsxs("div",{className:"crew-timeline-section",children:[e.jsxs("div",{className:"crew-timeline-header",children:[e.jsx("span",{className:"crew-timeline-title",children:"Daily Breakdown"}),e.jsx("div",{className:"crew-time-range-pills",children:ca.map(A=>e.jsx("button",{className:`crew-range-pill ${u===A.id?"active":""}`,onClick:()=>c(A.id),children:A.label},A.id))})]}),e.jsx("div",{className:"crew-chart-container",children:e.jsx(Is,{width:"100%",height:140,children:e.jsxs(cr,{data:C,onClick:A=>A?.activePayload?.[0]&&S(A.activePayload[0].payload),style:{cursor:"pointer"},children:[e.jsx(Na,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(ht,{dataKey:"displayDate",tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:{stroke:"var(--border-color)"},tickLine:!1,interval:u==="30d"?4:u==="14d"?1:0}),e.jsx(pt,{tick:{fontSize:10,fill:"var(--text-muted)"},axisLine:!1,tickLine:!1,allowDecimals:!1,width:30}),e.jsx(qs,{content:e.jsx(E,{})}),e.jsx(Vs,{wrapperStyle:{fontSize:"0.75rem",paddingTop:4},iconType:"circle",iconSize:8}),e.jsx(aa,{dataKey:"contract",name:"Contract",stackId:"crew",fill:Fs.contract,radius:[0,0,0,0]}),e.jsx(aa,{dataKey:"tm",name:"T&M (Extra Work)",stackId:"crew",fill:Fs.tm,radius:[3,3,0,0]})]})})})]}),v.total===0&&e.jsx("div",{className:"crew-empty",children:e.jsx("p",{children:"No crew checked in for this date"})})]})}),ne=d.memo(function({width:n,height:o,borderRadius:a="8px",className:t="",variant:l="default"}){const r=(()=>{switch(l){case"text":return{height:"1em",borderRadius:"4px"};case"circular":return{borderRadius:"50%"};case"rectangular":return{borderRadius:"0"};default:return{borderRadius:a}}})();return e.jsx("div",{className:`skeleton ${t}`,style:{width:n||"100%",height:o||r.height||"1rem",borderRadius:r.borderRadius},"aria-hidden":"true"})});d.memo(function({showProgress:n=!1}){return e.jsxs("div",{className:"metric-skeleton",children:[e.jsx(ne,{width:"60%",height:"0.75rem",className:"skeleton-label"}),e.jsx(ne,{width:"80%",height:"1.75rem",className:"skeleton-value"}),n&&e.jsx(ne,{width:"100%",height:"6px",className:"skeleton-progress"})]})});const Qi=d.memo(function({lines:n=3,showHeader:o=!0,showAction:a=!1}){return e.jsxs("div",{className:"card-skeleton","aria-busy":"true","aria-label":"Loading content",children:[o&&e.jsxs("div",{className:"card-skeleton-header",children:[e.jsx(ne,{width:"40%",height:"1.25rem"}),a&&e.jsx(ne,{width:"80px",height:"32px"})]}),e.jsx("div",{className:"card-skeleton-body",children:Array.from({length:n}).map((t,l)=>e.jsx(ne,{width:`${100-l*15}%`,height:"1rem",className:"skeleton-line"},l))})]})});d.memo(function({count:n=3,showAvatar:o=!1,showAction:a=!1}){return e.jsx("div",{className:"list-skeleton","aria-busy":"true","aria-label":"Loading list",children:Array.from({length:n}).map((t,l)=>e.jsxs("div",{className:"list-item-skeleton",children:[o&&e.jsx(ne,{width:"40px",height:"40px",variant:"circular"}),e.jsxs("div",{className:"list-item-skeleton-content",children:[e.jsx(ne,{width:"60%",height:"1rem"}),e.jsx(ne,{width:"40%",height:"0.75rem"})]}),a&&e.jsx(ne,{width:"60px",height:"28px"})]},l))})});d.memo(function(){return e.jsx("div",{className:"financial-row-skeleton","aria-busy":"true","aria-label":"Loading financial data",children:[1,2,3].map(n=>e.jsxs("div",{className:"financial-card-skeleton",children:[e.jsxs("div",{className:"financial-card-skeleton-header",children:[e.jsx(ne,{width:"24px",height:"24px",variant:"circular"}),e.jsx(ne,{width:"60%",height:"1rem"})]}),e.jsx(ne,{width:"50%",height:"2rem",className:"skeleton-hero-value"}),e.jsxs("div",{className:"financial-card-skeleton-details",children:[e.jsx(ne,{width:"100%",height:"0.875rem"}),e.jsx(ne,{width:"80%",height:"0.875rem"})]})]},n))})});d.memo(function({height:n="200px"}){return e.jsxs("div",{className:"chart-skeleton",style:{height:n},"aria-busy":"true","aria-label":"Loading chart",children:[e.jsx("div",{className:"chart-skeleton-bars",children:[40,65,45,80,55,70,50,75,60,85].map((o,a)=>e.jsx("div",{className:"chart-skeleton-bar",style:{height:`${o}%`}},a))}),e.jsx(ne,{width:"100%",height:"1px",className:"chart-skeleton-axis"})]})});const Be=d.memo(function({count:n=3}){return e.jsx("div",{className:"ticket-skeleton-list","aria-busy":"true","aria-label":"Loading tickets",children:Array.from({length:n}).map((o,a)=>e.jsxs("div",{className:"ticket-skeleton-item",children:[e.jsxs("div",{className:"ticket-skeleton-header",children:[e.jsx(ne,{width:"100px",height:"0.875rem"}),e.jsx(ne,{width:"80px",height:"24px",borderRadius:"12px"})]}),e.jsx(ne,{width:"90%",height:"1rem"}),e.jsxs("div",{className:"ticket-skeleton-footer",children:[e.jsx(ne,{width:"60px",height:"0.75rem"}),e.jsx(ne,{width:"60px",height:"0.75rem"}),e.jsx(ne,{width:"60px",height:"0.75rem"})]})]},a))})}),Ur=d.memo(function(){return e.jsx("div",{className:"hero-metrics-skeleton","aria-busy":"true","aria-label":"Loading metrics",children:[1,2,3,4].map(n=>e.jsxs("div",{className:"hero-metric-skeleton",children:[e.jsx(ne,{width:"80px",height:"0.75rem",className:"skeleton-label"}),e.jsx(ne,{width:"120px",height:"1.75rem",className:"skeleton-value"}),e.jsx(ne,{width:"100%",height:"4px",className:"skeleton-bar"})]},n))})}),ya=d.memo(function({title:n="Unable to load data",message:o="Something went wrong. Please try again.",error:a=null,onRetry:t=null,retryLabel:l="Try Again",variant:i="default",icon:r=null}){const u=r||(a?.message?.includes("network")||a?.message?.includes("offline")?Bn:Fe);return i==="compact"?e.jsxs("div",{className:"error-state error-state-compact",role:"alert",children:[e.jsx(u,{size:16,className:"error-state-icon","aria-hidden":"true"}),e.jsx("span",{className:"error-state-message",children:o}),t&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:t,"aria-label":l,children:e.jsx(tt,{size:14})})]}):i==="inline"?e.jsxs("div",{className:"error-state error-state-inline",role:"alert",children:[e.jsxs("div",{className:"error-state-content",children:[e.jsx(u,{size:20,className:"error-state-icon","aria-hidden":"true"}),e.jsxs("div",{className:"error-state-text",children:[e.jsx("span",{className:"error-state-title",children:n}),e.jsx("span",{className:"error-state-message",children:o})]})]}),t&&e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:t,children:[e.jsx(tt,{size:14})," ",l]})]}):e.jsxs("div",{className:"error-state",role:"alert","aria-live":"polite",children:[e.jsx("div",{className:"error-state-icon-wrapper",children:e.jsx(u,{size:32,className:"error-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"error-state-title",children:n}),e.jsx("p",{className:"error-state-message",children:o}),!1,t&&e.jsxs("button",{className:"btn btn-primary",onClick:t,children:[e.jsx(tt,{size:16})," ",l]})]})}),oa=d.memo(function({title:n="No data yet",message:o="Items will appear here once added.",icon:a=null,action:t=null,actionLabel:l="Get Started",onAction:i=null}){return e.jsxs("div",{className:"empty-state",role:"status",children:[a&&e.jsx("div",{className:"empty-state-icon-wrapper",children:e.jsx(a,{size:32,className:"empty-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"empty-state-title",children:n}),e.jsx("p",{className:"empty-state-message",children:o}),i&&e.jsx("button",{className:"btn btn-primary btn-small",onClick:i,children:l}),t&&!i&&t]})});d.memo(function({label:n,error:o,required:a=!1,hint:t,children:l,className:i=""}){return e.jsxs("div",{className:`form-field ${o?"has-error":""} ${i}`,children:[n&&e.jsxs("label",{className:"form-field-label",children:[n,a&&e.jsx("span",{className:"form-field-required",children:"*"})]}),e.jsx("div",{className:"form-field-input",children:l}),o&&e.jsxs("div",{className:"form-field-error",role:"alert",children:[e.jsx(xs,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:o})]}),t&&!o&&e.jsx("div",{className:"form-field-hint",children:t})]})});d.memo(function({type:n="text",value:o,onChange:a,onBlur:t,error:l,placeholder:i,disabled:r,min:m,max:u,step:c,pattern:j,required:x,autoComplete:b,name:h,id:p,className:D="","aria-label":F,"aria-describedby":N}){const $=p||h,v=l?`${$}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:n,id:$,name:h,value:o,onChange:a,onBlur:t,placeholder:i,disabled:r,min:m,max:u,step:c,pattern:j,required:x,autoComplete:b,className:`validated-input ${l?"has-error":""} ${D}`,"aria-label":F,"aria-invalid":!!l,"aria-describedby":l?v:N}),l&&e.jsxs("div",{id:v,className:"input-error-inline",role:"alert",children:[e.jsx(xs,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:l})]})]})});d.memo(function({value:n,onChange:o,onBlur:a,error:t,disabled:l,required:i,name:r,id:m,className:u="",children:c,"aria-label":j}){const x=m||r,b=t?`${x}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("select",{id:x,name:r,value:n,onChange:o,onBlur:a,disabled:l,required:i,className:`validated-select ${t?"has-error":""} ${u}`,"aria-label":j,"aria-invalid":!!t,"aria-describedby":t?b:void 0,children:c}),t&&e.jsxs("div",{id:b,className:"input-error-inline",role:"alert",children:[e.jsx(xs,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:t})]})]})});d.memo(function({value:n,onChange:o,onBlur:a,error:t,placeholder:l,disabled:i,required:r,rows:m=3,maxLength:u,name:c,id:j,className:x="","aria-label":b}){const h=j||c,p=t?`${h}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("textarea",{id:h,name:c,value:n,onChange:o,onBlur:a,placeholder:l,disabled:i,required:r,rows:m,maxLength:u,className:`validated-textarea ${t?"has-error":""} ${x}`,"aria-label":b,"aria-invalid":!!t,"aria-describedby":t?p:void 0}),u&&e.jsxs("div",{className:"textarea-counter",children:[n?.length||0," / ",u]}),t&&e.jsxs("div",{id:p,className:"input-error-inline",role:"alert",children:[e.jsx(xs,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:t})]})]})});const Wr=d.memo(function({count:n,label:o,variant:a="default",size:t="medium",pulse:l=!1,icon:i}){const[r,m]=d.useState(n),[u,c]=d.useState(!1);return d.useEffect(()=>{if(n!==r){c(!0);const j=setTimeout(()=>{c(!1),m(n)},400);return()=>clearTimeout(j)}},[n,r]),e.jsxs("span",{className:`count-badge count-badge-${a} count-badge-${t} ${l?"badge-new":""} ${u?"animate-count-up":""}`,title:o,children:[i&&e.jsx(i,{size:t==="small"?12:t==="large"?18:14}),e.jsx("span",{className:"count-badge-value",children:n}),o&&e.jsx("span",{className:"count-badge-label",children:o})]})}),Hr=d.memo(function({value:n,max:o=100,showLabel:a=!1,size:t="medium",variant:l="default",animated:i=!0}){const r=Math.min(100,Math.max(0,n/o*100)),m=t==="small"?"4px":t==="large"?"8px":"6px",u=l==="default"?r>=80?"danger":r>=60?"warning":"success":l;return e.jsxs("div",{className:`mini-progress mini-progress-${t}`,children:[e.jsx("div",{className:"mini-progress-track",style:{height:m},children:e.jsx("div",{className:`mini-progress-fill mini-progress-${u} ${i?"progress-animate":""}`,style:{width:`${r}%`}})}),a&&e.jsxs("span",{className:"mini-progress-label",children:[Math.round(r),"%"]})]})}),Gr=d.memo(function({value:n,previousValue:o,format:a="percent",inverted:t=!1,showValue:l=!0}){const i=n-o,r=o!==0?i/o*100:0;let m=i===0?"neutral":i>0?"up":"down",u="neutral";i!==0&&(t?u=i>0?"negative":"positive":u=i>0?"positive":"negative");const c=m==="up"?ns:m==="down"?rs:ut,j=()=>{const x=Math.abs(i);switch(a){case"percent":return`${Math.abs(r).toFixed(1)}%`;case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(x);default:return x.toLocaleString()}};return e.jsxs("span",{className:`trend-indicator trend-${u}`,children:[e.jsx(c,{size:14}),l&&e.jsx("span",{className:"trend-value",children:j()})]})});d.memo(function({status:n="default",label:o,size:a="medium",pulse:t=!1}){return e.jsxs("span",{className:`status-dot-container status-dot-${a}`,children:[e.jsx("span",{className:`status-dot status-dot-${n} ${t?"status-dot-pulse":""}`}),o&&e.jsx("span",{className:"status-dot-label",children:o})]})});d.memo(function({data:n=[],width:o=80,height:a=24,strokeWidth:t=2,color:l="var(--accent-blue)",showArea:i=!0}){if(!n.length)return null;const r=Math.max(...n),m=Math.min(...n),u=r-m||1,c=n.map((x,b)=>{const h=b/(n.length-1)*o,p=a-(x-m)/u*(a-t*2)-t;return`${h},${p}`}).join(" "),j=`0,${a} ${c} ${o},${a}`;return e.jsxs("svg",{width:o,height:a,className:"sparkline",viewBox:`0 0 ${o} ${a}`,children:[i&&e.jsx("polygon",{points:j,fill:l,fillOpacity:"0.15"}),e.jsx("polyline",{points:c,fill:"none",stroke:l,strokeWidth:t,strokeLinecap:"round",strokeLinejoin:"round"})]})});d.memo(function({items:n=[]}){return e.jsx("div",{className:"quick-stats",children:n.map((o,a)=>e.jsxs("span",{className:"quick-stat-item",children:[o.icon&&e.jsx(o.icon,{size:12}),e.jsx("span",{className:"quick-stat-value",children:o.value}),o.label&&e.jsx("span",{className:"quick-stat-label",children:o.label})]},a))})});d.memo(function({status:n,label:o,size:a="medium"}){const t={success:ga,warning:Fe,danger:Fe,info:dt,pending:dt},l=t[n]||t.info;return e.jsxs("span",{className:`status-indicator status-indicator-${n} status-indicator-${a}`,children:[e.jsx(l,{size:a==="small"?12:a==="large"?18:14}),o&&e.jsx("span",{className:"status-indicator-label",children:o})]})});d.memo(function({current:n,previous:o,format:a="number",label:t,inverted:l=!1}){const i=n-o,r=l?i<0:i>0,m=l?i>0:i<0,u=c=>{switch(a){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(Math.abs(c));case"percent":return`${Math.abs(c).toFixed(1)}%`;default:return Math.abs(c).toLocaleString()}};return e.jsxs("div",{className:`metric-delta ${r?"positive":m?"negative":"neutral"}`,children:[e.jsx("span",{className:"metric-delta-arrow",children:i>0?"↑":i<0?"↓":"→"}),e.jsx("span",{className:"metric-delta-value",children:u(i)}),t&&e.jsx("span",{className:"metric-delta-label",children:t})]})});d.memo(function({value:n,max:o=100,size:a=40,strokeWidth:t=4,showValue:l=!0,color:i="var(--accent-blue)"}){const r=Math.min(100,Math.max(0,n/o*100)),m=(a-t)/2,u=m*2*Math.PI,c=u-r/100*u;return e.jsxs("div",{className:"circular-progress",style:{width:a,height:a},children:[e.jsxs("svg",{width:a,height:a,viewBox:`0 0 ${a} ${a}`,children:[e.jsx("circle",{className:"circular-progress-track",cx:a/2,cy:a/2,r:m,fill:"none",strokeWidth:t}),e.jsx("circle",{className:"circular-progress-fill",cx:a/2,cy:a/2,r:m,fill:"none",stroke:i,strokeWidth:t,strokeDasharray:u,strokeDashoffset:c,strokeLinecap:"round",transform:`rotate(-90 ${a/2} ${a/2})`,style:{transition:"stroke-dashoffset 0.5s ease"}})]}),l&&e.jsxs("span",{className:"circular-progress-value",children:[Math.round(r),"%"]})]})});d.memo(function({isOpen:n,onClose:o,title:a,children:t,size:l="medium",className:i="",showCloseButton:r=!0,closeOnOverlayClick:m=!0,closeOnEscape:u=!0,footer:c,ariaDescribedBy:j}){const x=d.useRef(null),b=d.useRef(null),h=d.useRef(`modal-title-${Math.random().toString(36).substr(2,9)}`);d.useEffect(()=>{if(n){b.current=document.activeElement;const N=setTimeout(()=>{x.current?.focus()},10);return()=>clearTimeout(N)}},[n]),d.useEffect(()=>{!n&&b.current&&b.current.focus()},[n]),d.useEffect(()=>{if(!n||!u)return;const N=$=>{$.key==="Escape"&&($.preventDefault(),o())};return document.addEventListener("keydown",N),()=>document.removeEventListener("keydown",N)},[n,u,o]),d.useEffect(()=>{if(n){const N=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=N}}},[n]);const p=d.useCallback(N=>{if(N.key!=="Tab")return;const $=x.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!$||$.length===0)return;const v=$[0],C=$[$.length-1];N.shiftKey?document.activeElement===v&&(N.preventDefault(),C.focus()):document.activeElement===C&&(N.preventDefault(),v.focus())},[]),D=N=>{m&&N.target===N.currentTarget&&o()};if(!n)return null;const F={small:"modal-small",medium:"modal-medium",large:"modal-large",full:"modal-full"};return e.jsx("div",{className:"modal-overlay",onClick:D,role:"presentation",children:e.jsxs("div",{ref:x,className:`modal-content ${F[l]||""} ${i}`,role:"dialog","aria-modal":"true","aria-labelledby":a?h.current:void 0,"aria-describedby":j,tabIndex:-1,onKeyDown:p,onClick:N=>N.stopPropagation(),children:[a&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:h.current,children:a}),r&&e.jsx("button",{className:"close-btn",onClick:o,"aria-label":"Close modal",type:"button",children:e.jsx(as,{size:20})})]}),e.jsx("div",{className:"modal-body",children:t}),c&&e.jsx("div",{className:"modal-footer",children:c})]})})});const ds=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),Ms=d.memo(function({icon:n,label:o,value:a,formattedValue:t,subLabel:l,progress:i,progressLabel:r,variant:m="default",trend:u,previousValue:c}){const j={default:"var(--accent-blue)",success:"var(--accent-green)",warning:"var(--accent-amber)",danger:"var(--accent-red)"};return e.jsxs("div",{className:"hero-metric-card hover-lift animate-fade-in-up",children:[e.jsxs("div",{className:"hero-metric-header",children:[e.jsx("div",{className:"hero-metric-icon",style:{color:j[m]},children:e.jsx(n,{size:18})}),e.jsx("span",{className:"hero-metric-label",children:o})]}),e.jsxs("div",{className:"hero-metric-value-row",children:[e.jsx("span",{className:`hero-metric-value hero-metric-${m}`,children:t}),u!==void 0&&c!==void 0&&e.jsx(Gr,{value:a,previousValue:c,format:"currency",inverted:o.toLowerCase().includes("cost")})]}),l&&e.jsx("span",{className:"hero-metric-sublabel",children:l}),i!==void 0&&e.jsxs("div",{className:"hero-metric-progress",children:[e.jsx(Hr,{value:i,max:100,size:"small",variant:m,showLabel:!0}),r&&e.jsx("span",{className:"hero-metric-progress-label",children:r})]})]})}),Kr=d.memo(function({contractValue:n=0,earnedRevenue:o=0,totalCosts:a=0,profit:t=0,progress:l=0,corApprovedValue:i=0,loading:r=!1,previousData:m}){const u=n+i,c=o>0?t/o*100:0,j=o>0?a/o*100:0,x=u>0?o/u*100:0,b=u>0?a/u*100:0,h=d.useMemo(()=>c>=20?"success":c>=10?"warning":c<0?"danger":"default",[c]),p=d.useMemo(()=>j<=60?"success":j<=80?"warning":"danger",[j]);return r?e.jsx(Ur,{}):e.jsxs("div",{className:"hero-metrics stagger-children",children:[e.jsx(Ms,{icon:es,label:"Contract Value",value:u,formattedValue:ds(u),subLabel:i>0?`+${ds(i)} CORs`:null,variant:"default"}),e.jsx(Ms,{icon:ns,label:"Earned Revenue",value:o,formattedValue:ds(o),progress:x,progressLabel:`${Math.round(x)}% of contract`,variant:"success",previousValue:m?.earnedRevenue,trend:m?o:void 0}),e.jsx(Ms,{icon:fa,label:"Total Costs",value:a,formattedValue:ds(a),progress:b,progressLabel:`${Math.round(j)}% of revenue`,variant:p,previousValue:m?.totalCosts,trend:m?a:void 0}),e.jsx(Ms,{icon:Un,label:"Profit",value:t,formattedValue:ds(t),subLabel:`${c>=0?"+":""}${c.toFixed(1)}% margin`,variant:h,previousValue:m?.profit,trend:m?t:void 0})]})}),da=[{id:"overview",label:"Overview",shortLabel:"Overview",icon:Hn,description:"Metrics & trends",step:null},{id:"cors",label:"Change Orders",shortLabel:"CORs",icon:ss,description:"CORs & approvals",step:1},{id:"tickets",label:"T&M Tickets",shortLabel:"Tickets",icon:xe,description:"Field data",step:2},{id:"billing",label:"Billing",shortLabel:"Billing",icon:fa,description:"Invoices & billing",step:3}],Jr=d.memo(function({activeSection:n="overview",onSectionChange:o,collapsed:a=!1,onToggleCollapse:t,onMobileClose:l,stats:i={}}){const{corCount:r=0,ticketCount:m=0,corPending:u=0,ticketPending:c=0,billableCount:j=0,invoiceCount:x=0}=i,b=h=>h==="cors"&&r>0?{count:r,variant:u>0?"warning":"default",pending:u}:h==="tickets"&&m>0?{count:m,variant:c>0?"warning":"default",pending:c}:h==="billing"&&j>0?{count:j,variant:"success",pending:j}:null;return e.jsxs("nav",{className:`financials-nav ${a?"collapsed":""}`,"aria-label":"Financials sections",children:[l&&e.jsxs("div",{className:"financials-nav-mobile-header",children:[e.jsx("span",{className:"financials-nav-mobile-title",children:"Financials"}),e.jsx("button",{className:"financials-nav-mobile-close",onClick:l,"aria-label":"Close menu",children:e.jsx(as,{size:20})})]}),e.jsxs("button",{className:"financials-nav-toggle",onClick:t,"aria-label":a?"Expand sidebar":"Collapse sidebar",title:a?"Expand sidebar":"Collapse sidebar",children:[a?e.jsx(Wn,{size:18}):e.jsx(va,{size:18}),!a&&e.jsx("span",{children:"Collapse"})]}),e.jsx("div",{className:"financials-nav-items",children:da.map((h,p)=>{const D=n===h.id,F=h.icon,N=b(h.id),$=p<da.length-1&&h.step!==null;return e.jsxs("div",{className:"financials-nav-item-wrapper",children:[e.jsxs("button",{className:`financials-nav-item ${D?"active":""}`,onClick:()=>o?.(h.id),"aria-current":D?"page":void 0,title:`${h.label}${N?` (${N.count})`:""}`,children:[h.step&&!a&&e.jsx("span",{className:"financials-nav-step",children:h.step}),e.jsxs("div",{className:"financials-nav-icon",children:[e.jsx(F,{size:a?22:20}),N&&N.pending>0&&e.jsx("span",{className:"financials-nav-dot"})]}),a&&e.jsx("span",{className:"financials-nav-short-label",children:h.shortLabel}),!a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"financials-nav-content",children:[e.jsx("span",{className:"financials-nav-label",children:h.label}),e.jsx("span",{className:"financials-nav-desc",children:h.description})]}),N&&e.jsx(Wr,{count:N.count,size:"small",variant:N.variant}),e.jsx(Ie,{size:16,className:"financials-nav-arrow"})]})]}),$&&!a&&e.jsx("div",{className:"financials-nav-connector",children:e.jsx("div",{className:"connector-line"})})]},h.id)})}),a&&e.jsxs("button",{className:"financials-nav-expand-btn",onClick:t,"aria-label":"Expand sidebar",children:[e.jsx(Ie,{size:14}),e.jsx("span",{children:"Expand"})]})]})});function Yr(s,n,o=[],a=null,t=[]){const l=n?.contract_value||0,i=s?.laborByDate||[],r=s?.haulOffByDate||[],m=s?.materialsEquipmentByDate||[],u=s?.customCosts||[],c=new Set;i.forEach(C=>c.add(C.date)),r.forEach(C=>c.add(C.date)),m.forEach(C=>c.add(C.date)),u.forEach(C=>{C.cost_date&&c.add(C.cost_date)}),o.forEach(C=>{C.work_date&&c.add(C.work_date),C.ticket_date&&c.add(C.ticket_date),C.created_at&&c.add(C.created_at.split("T")[0])}),t.forEach(C=>{C.status==="done"&&C.updated_at&&c.add(C.updated_at.split("T")[0])});const j=[...c].sort((C,O)=>new Date(C)-new Date(O));if(j.length===0)return[];const x={},b=t.reduce((C,O)=>C+(parseFloat(O.weight)||0),0);t.forEach(C=>{if(C.status==="done"&&C.updated_at){const O=C.updated_at.split("T")[0],L=parseFloat(C.weight)||0,T=C.scheduled_value?parseFloat(C.scheduled_value):b>0?L/b*l:0;x[O]||(x[O]=0),x[O]+=T}});let h=0,p=0;const D={};o.forEach(C=>{const O=C.work_date||C.ticket_date||C.created_at?.split("T")[0];if(!O)return;let L=0;const T=C.t_and_m_workers||C.workers||[];Array.isArray(T)&&T.forEach(E=>{const V=parseFloat(E.hours)||parseFloat(E.regular_hours)||0,A=parseFloat(E.overtime_hours)||0,B=parseFloat(E.regular_rate)||parseFloat(E.rate)||65,R=parseFloat(E.overtime_rate)||B*1.5;L+=V*B+A*R});const S=C.t_and_m_items||C.items||[];Array.isArray(S)&&S.forEach(E=>{const V=parseFloat(E.quantity)||1,A=parseFloat(E.unit_cost)||parseFloat(E.materials_equipment?.cost_per_unit)||0;L+=V*A}),D[O]||(D[O]=0),D[O]+=L});const F={};u.forEach(C=>{const O=C.cost_date;O&&(F[O]||(F[O]=0),F[O]+=parseFloat(C.amount)||0)});const N={};m.forEach(C=>{C.date&&(N[C.date]=C.cost||0)});let $=0;return j.map(C=>{const L=i.find(re=>re.date===C)?.cost||0,S=r.find(re=>re.date===C)?.cost||0,E=N[C]||0,V=F[C]||0,A=L+E+S+V;h+=A;const B=D[C]||0;p+=B;const R=x[C]||0;$+=R;const P=Object.keys(x).length>0?$:s?.billable||0;return{date:C,contract:l,revenue:Math.round(P),costs:Math.round(h),tmValue:Math.round(p),corValue:Math.round(a?.total_approved_value||0),profit:Math.round(P-h),dailyLabor:Math.round(L),dailyRevenue:Math.round(R),dailyMaterials:Math.round(E),dailyHaulOff:Math.round(S),dailyCustom:Math.round(V),dailyTM:Math.round(B),dailyTotal:Math.round(A)}})}function Qr(s,n){if(!n||!s.length)return s;const o=new Date,a=new Date;return a.setDate(o.getDate()-n),s.filter(t=>new Date(t.date)>=a)}function Xr(s=0,n=0,o=[]){const a=[];s>0&&a.push({name:"Labor",value:s,color:G.labor,category:"labor"}),n>0&&a.push({name:"Disposal",value:n,color:G.disposal,category:"disposal"});const t={};o.forEach(i=>{const r=i.category||"other";t[r]||(t[r]={items:[],total:0}),t[r].items.push(i),t[r].total+=parseFloat(i.amount)||0}),Object.entries(t).forEach(([i,r])=>{if(r.total>0){const m=ia[i]||ia.other;a.push({name:m.label,value:r.total,color:m.color,category:i,items:r.items})}});const l=a.reduce((i,r)=>i+r.value,0);return a.forEach(i=>{i.percentage=l>0?Math.round(i.value/l*100):0}),a.sort((i,r)=>r.value-i.value),a}function ma(s,n){if(!s||s.length<2)return{direction:"flat",percentage:0};const o=s.slice(-7);if(o.length<2)return{direction:"flat",percentage:0};const a=o[0][n]||0,t=o[o.length-1][n]||0;if(a===0)return{direction:t>0?"up":"flat",percentage:0};const l=(t-a)/a*100;return{direction:l>5?"up":l<-5?"down":"flat",percentage:Math.abs(Math.round(l))}}function Zr({active:s,payload:n,label:o}){if(!s||!n||!n.length)return null;const a=l=>l>=1e6?`$${(l/1e6).toFixed(2)}M`:l>=1e3?`$${(l/1e3).toFixed(1)}K`:`$${l.toFixed(0)}`,t=n[0]?.payload||{};return e.jsxs("div",{className:"chart-tooltip",children:[e.jsx("div",{className:"chart-tooltip-date",children:jt(o)}),e.jsxs("div",{className:"chart-tooltip-rows",children:[t.contract!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:G.contract}}),"Contract"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(t.contract)})]}),t.revenue!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:G.revenue}}),"Revenue"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(t.revenue)})]}),t.costs!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:G.costs}}),"Costs"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(t.costs)})]}),t.tmValue!==void 0&&t.tmValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:G.tmValue}}),"T&M Value"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(t.tmValue)})]}),t.corValue!==void 0&&t.corValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:G.corValue}}),"COR Approved"]}),e.jsx("span",{className:"chart-tooltip-value",children:a(t.corValue)})]}),t.profit!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:t.profit>=0?G.profit:G.loss}}),t.profit>=0?"Profit":"Loss"]}),e.jsx("span",{className:"chart-tooltip-value",style:{color:t.profit>=0?G.profit:G.loss},children:a(Math.abs(t.profit))})]})]}),(t.dailyRevenue>0||t.dailyLabor>0||t.dailyMaterials>0||t.dailyHaulOff>0||t.dailyTM>0)&&e.jsxs("div",{className:"chart-tooltip-daily",children:[e.jsx("div",{className:"chart-tooltip-daily-label",children:"Today's Activity"}),t.dailyRevenue>0&&e.jsx("div",{className:"chart-tooltip-daily-row earned",children:e.jsxs("span",{style:{color:G.revenue},children:["Areas Completed: ",a(t.dailyRevenue)]})}),t.dailyLabor>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Labor: ",a(t.dailyLabor)]}),t.dailyMaterials>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Materials: ",a(t.dailyMaterials)]}),t.dailyHaulOff>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Disposal: ",a(t.dailyHaulOff)]}),t.dailyTM>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["T&M Added: ",a(t.dailyTM)]}),t.dailyTotal>0&&e.jsx("div",{className:"chart-tooltip-daily-row total",children:e.jsxs("strong",{children:["Day Costs: ",a(t.dailyTotal)]})})]}),e.jsx("div",{className:"chart-tooltip-hint",children:"Click to see details"})]})}function ei({projectData:s,project:n,tmTickets:o=[],corStats:a=null,areas:t=[],onDrillDown:l}){const[i,r]=d.useState("30d"),[m,u]=d.useState(null),c=d.useMemo(()=>{const p=Yr(s,n,o,a,t),D=la.find(F=>F.id===i);return Qr(p,D?.days)},[s,n,o,a,t,i]),j=d.useMemo(()=>ma(c,"costs"),[c]),x=d.useMemo(()=>ma(c,"revenue"),[c]),b=p=>{if(p?.activePayload?.[0]){const D=p.activePayload[0].payload;l?.(D.date,D)}},h=({trend:p})=>p.direction==="up"?e.jsx(ns,{size:14,className:"trend-icon up"}):p.direction==="down"?e.jsx(rs,{size:14,className:"trend-icon down"}):e.jsx(ut,{size:14,className:"trend-icon flat"});return c.length?e.jsxs("div",{className:"financial-trend-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title-section",children:[e.jsx("h3",{children:"Financial Trend"}),e.jsxs("div",{className:"chart-trend-indicators",children:[e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:G.revenue},children:"Revenue"}),e.jsx(h,{trend:x}),x.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[x.percentage,"%"]})]}),e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:G.costs},children:"Costs"}),e.jsx(h,{trend:j}),j.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[j.percentage,"%"]})]})]})]}),e.jsx("div",{className:"time-range-selector",children:la.map(p=>e.jsx("button",{className:i===p.id?"active":"",onClick:()=>r(p.id),children:p.label},p.id))})]}),e.jsx("div",{className:"chart-container",children:e.jsx(Is,{width:"100%",height:300,children:e.jsxs(or,{data:c,onClick:b,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:Object.values(Ir).map(p=>e.jsxs("linearGradient",{id:p.id,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:p.color,stopOpacity:p.startOpacity}),e.jsx("stop",{offset:"95%",stopColor:p.color,stopOpacity:p.endOpacity})]},p.id))}),e.jsx(Na,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(ht,{dataKey:"date",tickFormatter:jt,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:{stroke:"var(--border-color)"}}),e.jsx(pt,{tickFormatter:ze,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:!1,width:60}),e.jsx(qs,{content:e.jsx(Zr,{})}),e.jsx(Vs,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,formatter:p=>e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:p})}),c[0]?.contract>0&&e.jsx(dr,{y:c[0].contract,stroke:G.contract,strokeDasharray:"5 5",strokeWidth:2,label:{value:"Contract",position:"right",fill:G.contract,fontSize:11}}),e.jsx(Ts,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:G.revenue,strokeWidth:2,fill:"url(#revenueGradient)",animationDuration:us.duration,onMouseEnter:()=>u("revenue"),onMouseLeave:()=>u(null),style:{opacity:m&&m!=="revenue"?.3:1}}),e.jsx(Ts,{type:"monotone",dataKey:"costs",name:"Costs",stroke:G.costs,strokeWidth:2,fill:"url(#costsGradient)",animationDuration:us.duration,onMouseEnter:()=>u("costs"),onMouseLeave:()=>u(null),style:{opacity:m&&m!=="costs"?.3:1}}),c.some(p=>p.tmValue>0)&&e.jsx(Ts,{type:"monotone",dataKey:"tmValue",name:"T&M Value",stroke:G.tmValue,strokeWidth:2,fill:"url(#tmValueGradient)",animationDuration:us.duration,onMouseEnter:()=>u("tmValue"),onMouseLeave:()=>u(null),style:{opacity:m&&m!=="tmValue"?.3:1}}),c.some(p=>p.corValue>0)&&e.jsx(Ts,{type:"monotone",dataKey:"corValue",name:"COR Approved",stroke:G.corValue,strokeWidth:2,strokeDasharray:"4 2",fill:"transparent",animationDuration:us.duration,onMouseEnter:()=>u("corValue"),onMouseLeave:()=>u(null),style:{opacity:m&&m!=="corValue"?.3:1}})]})})}),e.jsxs("div",{className:"chart-quick-stats",children:[e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Current Revenue"}),e.jsx("span",{className:"stat-value",style:{color:G.revenue},children:ze(c[c.length-1]?.revenue||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Total Costs"}),e.jsx("span",{className:"stat-value",style:{color:G.costs},children:ze(c[c.length-1]?.costs||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Margin"}),e.jsx("span",{className:"stat-value",style:{color:(c[c.length-1]?.profit||0)>=0?G.profit:G.loss},children:(()=>{const p=c[c.length-1];return!p||!p.revenue?"0%":`${((p.revenue-p.costs)/p.revenue*100).toFixed(1)}%`})()})]}),c[c.length-1]?.tmValue>0&&e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"T&M Pending"}),e.jsx("span",{className:"stat-value",style:{color:G.tmValue},children:ze(c[c.length-1]?.tmValue||0)})]})]})]}):e.jsx("div",{className:"financial-trend-chart empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No financial data available yet."}),e.jsx("span",{children:"Start tracking labor and costs to see trends."})]})})}function si({laborCost:s=0,haulOffCost:n=0,customCosts:o=[],onSegmentClick:a}){const[t,l]=d.useState(null),i=d.useMemo(()=>Xr(s,n,o),[s,n,o]),r=d.useMemo(()=>i.reduce((b,h)=>b+h.value,0),[i]),m=(b,h)=>{l(h)},u=()=>{l(null)},c=(b,h)=>{a&&a(i[h])},j=({active:b,payload:h})=>{if(!b||!h||!h.length)return null;const p=h[0].payload;return e.jsxs("div",{className:"chart-tooltip donut-tooltip",children:[e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:p.color}}),p.name]}),e.jsx("span",{className:"chart-tooltip-value",children:ze(p.value)})]}),e.jsxs("div",{className:"donut-tooltip-pct",children:[p.percentage,"% of total costs"]}),p.items&&p.items.length>0&&e.jsx("div",{className:"donut-tooltip-items",children:e.jsxs("div",{className:"donut-tooltip-items-label",children:[p.items.length," item",p.items.length>1?"s":""]})}),a&&e.jsx("div",{className:"chart-tooltip-hint",children:"Click to view details"})]})},x=b=>{const{payload:h}=b;return e.jsx("div",{className:"donut-legend",children:h.map((p,D)=>e.jsxs("div",{className:`donut-legend-item ${t===D?"active":""}`,onMouseEnter:()=>l(D),onMouseLeave:()=>l(null),onClick:()=>c(null,D),children:[e.jsx("span",{className:"donut-legend-color",style:{backgroundColor:p.payload.color}}),e.jsx("span",{className:"donut-legend-name",children:p.value}),e.jsx("span",{className:"donut-legend-value",children:ze(p.payload.value)})]},`legend-${D}`))})};return!i.length||r===0?e.jsx("div",{className:"cost-donut empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No cost data available."}),e.jsx("span",{children:"Add labor, disposal, or custom costs to see breakdown."})]})}):e.jsx("div",{className:"cost-donut",children:e.jsxs("div",{className:"donut-chart-container",children:[e.jsx(Is,{width:"100%",height:200,children:e.jsxs(mr,{children:[e.jsx(ur,{data:i,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",onMouseEnter:m,onMouseLeave:u,onClick:c,animationDuration:us.duration,animationEasing:"ease-out",children:i.map((b,h)=>e.jsx(hr,{fill:b.color,stroke:"var(--card-bg)",strokeWidth:2,style:{filter:t===h?"brightness(1.1)":"none",cursor:a?"pointer":"default",transform:t===h?"scale(1.05)":"scale(1)",transformOrigin:"center",transition:"all 0.2s ease"}},`cell-${h}`))}),e.jsx(qs,{content:e.jsx(j,{})}),e.jsx(Vs,{content:x})]})}),e.jsxs("div",{className:"donut-center-label",children:[e.jsx("span",{className:"donut-center-value",children:ze(r)}),e.jsx("span",{className:"donut-center-text",children:"Total"})]})]})})}const Ue=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0);function ti({revenue:s,totalCosts:n,contractValue:o,progress:a}){const t=s-n,l=s>0?t/s*100:0,i=o,r=a>0?n/(a/100):n,m=i-r,u=i>0?m/i*100:0,c=l>=20,j=l>=0&&l<20,x=l<0,b=c?"healthy":j?"warning":"loss",h=c?"On Track":j?"Watch Margin":"Over Cost",p=c?Gn:j?xs:rs;return e.jsxs("div",{className:`profitability-card ${b}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${b}`,children:[e.jsx(p,{size:14}),e.jsx("span",{children:h})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${l<0?"negative":""}`,children:[Math.round(l),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${l<0?"negative":l<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(l),100)}%`}})})]}),a>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${u<0?"negative":""}`,children:[Math.round(u),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${u<0?"negative":u<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(u),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:Ue(s)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",Ue(n)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${t<0?"negative":"positive"}`,children:[t>=0?"":"-",Ue(Math.abs(t))]})]})]}),a>10&&e.jsxs("div",{className:"profitability-insight",children:[c&&e.jsxs("p",{children:["At ",Math.round(a),"% complete, you're at ",Ue(t)," profit.",m>0&&` Projected final profit: ${Ue(m)}`]}),j&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",m<0&&` Trending toward ${Ue(m)} loss.`]}),x&&e.jsxs("p",{children:["Currently over cost by ",Ue(Math.abs(t)),". Immediate review recommended."]})]})]})}const it=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),$s={labor:{label:"Labor",Icon:He,color:"#3b82f6"},disposal:{label:"Disposal",Icon:Ge,color:"#10b981"},equipment:{label:"Equipment",Icon:ot,color:"#f59e0b"},materials:{label:"Materials",Icon:Ps,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:Re,color:"#ec4899"},other:{label:"Other",Icon:Kn,color:"#6b7280"}};function ai({laborCost:s=0,haulOffCost:n=0,customCosts:o=[],onAddCost:a,onDeleteCost:t}){const[l,i]=d.useState(!0),[r,m]=d.useState(null),u=[];s>0&&u.push({category:"labor",label:"Labor",amount:s,source:"auto",description:"From crew check-ins"}),n>0&&u.push({category:"disposal",label:"Disposal",amount:n,source:"auto",description:"From haul-off logs"});const c={};o.forEach(h=>{c[h.category]||(c[h.category]={category:h.category,items:[],total:0}),c[h.category].items.push(h),c[h.category].total+=parseFloat(h.amount)||0}),Object.values(c).forEach(h=>{const p=$s[h.category]||$s.other;u.push({category:h.category,label:p.label,amount:h.total,source:"manual",items:h.items})});const j=u.reduce((h,p)=>h+p.amount,0);u.forEach(h=>{h.percentage=j>0?h.amount/j*100:0}),u.sort((h,p)=>p.amount-h.amount);const x=h=>{m(r===h?null:h)},b=h=>{h.items&&h.items.length>0&&(i(!1),m(h.category))};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsxs("div",{className:"cost-contributors-title",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:it(j)})]}),u.length>0&&e.jsxs("div",{className:"cost-view-toggle",children:[e.jsx("button",{className:l?"active":"",onClick:()=>i(!0),children:"Chart"}),e.jsx("button",{className:l?"":"active",onClick:()=>i(!1),children:"List"})]})]}),u.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):l?e.jsx(si,{laborCost:s,haulOffCost:n,customCosts:o,onSegmentClick:b}):e.jsx("div",{className:"cost-breakdown",children:u.map(h=>{const p=$s[h.category]||$s.other,D=p.Icon,F=h.items&&h.items.length>0,N=r===h.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${F?"expandable":""}`,onClick:()=>F&&x(h.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(h.percentage,2)}%`,backgroundColor:p.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(D,{size:14,style:{color:p.color}}),e.jsx("span",{children:h.label}),h.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),F&&(N?e.jsx(zs,{size:14}):e.jsx(Ke,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:it(h.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(h.percentage),"%"]})]})]})]}),N&&F&&e.jsx("div",{className:"cost-category-items",children:h.items.map($=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:$.description}),e.jsx("span",{className:"cost-item-date",children:new Date($.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:it($.amount)}),t&&e.jsx("button",{className:"cost-item-delete",onClick:v=>{v.stopPropagation(),confirm("Delete this cost entry?")&&t($.id)},children:e.jsx(ba,{size:14})})]})]},$.id))})]},h.category)})}),a&&e.jsxs("button",{className:"cost-add-btn",onClick:a,children:[e.jsx(ps,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const wa=[{value:"concrete",label:"Concrete",icon:"🧱"},{value:"trash",label:"Trash",icon:"🗑️"},{value:"metals",label:"Metals",icon:"🔩"},{value:"hazardous_waste",label:"Hazardous",icon:"☣️"}],ni=s=>wa.find(n=>n.value===s)||{label:s,icon:"📦"};function ri({project:s,period:n="week"}){const[o,a]=d.useState([]),[t,l]=d.useState(!0),[i,r]=d.useState(!1);d.useEffect(()=>{s?.id&&m()},[s?.id,n]);const m=async()=>{try{l(!0);const h=n==="week"?7:n==="month"?30:14,p=await I.getDisposalLoadsHistory(s.id,h);a(p||[])}catch(h){console.error("Error loading disposal summary:",h)}finally{l(!1)}},u=o.reduce((h,p)=>{const D=p.load_type;return h[D]||(h[D]=0),h[D]+=p.load_count,h},{}),c=o.reduce((h,p)=>{const D=p.load_date||p.work_date;return h[D]||(h[D]={date:D,loads:[],total:0}),h[D].loads.push(p),h[D].total+=p.load_count,h},{}),j=Object.values(c).sort((h,p)=>new Date(p.date)-new Date(h.date)).slice(0,7),x=o.reduce((h,p)=>h+p.load_count,0),b=x>0;return t?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"header-left",children:[e.jsx(Ge,{size:18}),e.jsx("span",{children:"Disposal Loads"})]})}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(Ge,{size:18}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("span",{className:"period-badge",children:n==="week"?"Last 7 days":n==="month"?"Last 30 days":"Last 14 days"})]}),b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"disposal-total-value",children:x}),e.jsx("span",{className:"disposal-total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:wa.map(h=>{const p=u[h.value]||0;if(p===0)return null;const D=Math.round(p/x*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"disposal-type-info",children:[e.jsx("span",{className:"disposal-type-icon",children:h.icon}),e.jsx("span",{className:"disposal-type-label",children:h.label})]}),e.jsxs("div",{className:"disposal-type-stats",children:[e.jsx("span",{className:"disposal-type-count",children:p}),e.jsx("div",{className:"disposal-type-bar",children:e.jsx("div",{className:"disposal-type-bar-fill",style:{width:`${D}%`}})})]})]},h.value)})}),j.length>0&&e.jsxs("button",{className:"disposal-expand-btn",onClick:()=>r(!i),children:[i?e.jsx(zs,{size:16}):e.jsx(Ke,{size:16}),e.jsxs("span",{children:[i?"Hide":"View"," Daily Breakdown"]})]}),i&&j.length>0&&e.jsx("div",{className:"disposal-daily-breakdown",children:j.map(h=>{const p=new Date(h.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),D=h.loads.reduce((F,N)=>(F[N.load_type]||(F[N.load_type]=0),F[N.load_type]+=N.load_count,F),{});return e.jsxs("div",{className:"disposal-daily-row",children:[e.jsxs("div",{className:"disposal-daily-header",children:[e.jsx("span",{className:"disposal-daily-date",children:p}),e.jsxs("span",{className:"disposal-daily-total",children:[h.total," loads"]})]}),e.jsx("div",{className:"disposal-daily-types",children:Object.entries(D).map(([F,N])=>{const $=ni(F);return e.jsxs("span",{className:"disposal-daily-type",children:[$.icon," ",N]},F)})})]},h.date)})})]}):e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx(Ge,{size:32}),e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("span",{className:"text-muted",children:"Loads will appear here when logged by field crews"})]})]})}const lt=s=>s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",ii=d.memo(function({project:n,onAddEquipment:o,onEditEquipment:a,onShowToast:t}){const[l,i]=d.useState([]),[r,m]=d.useState(!0),[u,c]=d.useState(!0),[j,x]=d.useState(0),b=d.useCallback(async()=>{if(n?.id)try{m(!0);const N=await Xe.getProjectEquipment(n.id);i(N||[]);const $=Xe.calculateProjectEquipmentCost(N||[]);x($)}catch(N){console.error("Error loading equipment:",N),t?.("Failed to load equipment","error")}finally{m(!1)}},[n?.id]);d.useEffect(()=>{b()},[b]);const h=d.useCallback(async N=>{try{await Xe.markEquipmentReturned(N.id),t?.(`${N.equipment_name} marked as returned`,"success"),b()}catch($){console.error("Error marking equipment returned:",$),t?.("Failed to update equipment","error")}},[b]),p=d.useCallback(async N=>{if(confirm(`Remove ${N.equipment_name} from this project?`))try{await Xe.removeEquipmentFromProject(N.id),t?.("Equipment removed","success"),b()}catch($){console.error("Error removing equipment:",$),t?.("Failed to remove equipment","error")}},[b]),D=d.useMemo(()=>l.filter(N=>!N.end_date),[l]),F=d.useMemo(()=>l.filter(N=>N.end_date),[l]);return e.jsxs("div",{className:"project-equipment-card",children:[e.jsxs("div",{className:"project-equipment-header",children:[e.jsxs("div",{className:"project-equipment-title",children:[e.jsx(Ge,{size:18}),e.jsx("h3",{children:"Equipment on Site"}),l.length>0&&e.jsxs("span",{className:"equipment-count",children:[D.length," active"]})]}),e.jsxs("div",{className:"project-equipment-actions",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>o?.(),title:"Add equipment",children:[e.jsx(ps,{size:14}),e.jsx("span",{children:"Add"})]}),l.length>0&&e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>c(!u),children:u?e.jsx(zs,{size:16}):e.jsx(Ke,{size:16})})]})]}),r?e.jsx("div",{className:"equipment-loading",children:e.jsx("div",{className:"loading-spinner small"})}):l.length===0?e.jsxs("div",{className:"equipment-empty",children:[e.jsx("p",{children:"No equipment tracked on this project"}),e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>o?.(),children:[e.jsx(ps,{size:14}),"Track Equipment"]})]}):u?e.jsxs(e.Fragment,{children:[D.length>0&&e.jsx("div",{className:"equipment-list",children:D.map(N=>{const $=Xe.calculateDaysOnSite(N.start_date,N.end_date),v=N.daily_rate*$;return e.jsxs("div",{className:"equipment-item active",children:[e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:N.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[e.jsx(Ls,{size:12}),"On-site since ",lt(N.start_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-rate",children:[Ne(N.daily_rate),"/day"]}),e.jsxs("span",{className:"equipment-days",children:[$," days"]}),e.jsx("span",{className:"equipment-total",children:Ne(v)})]})]}),e.jsxs("div",{className:"equipment-item-actions",children:[e.jsxs("button",{className:"btn btn-xs btn-outline",onClick:()=>h(N),title:"Mark as returned",children:[e.jsx(Jn,{size:12}),"Returned"]}),e.jsx("button",{className:"btn btn-xs btn-ghost",onClick:()=>a?.(N),title:"Edit",children:e.jsx(Yn,{size:12})}),e.jsx("button",{className:"btn btn-xs btn-ghost text-danger",onClick:()=>p(N),title:"Remove",children:e.jsx(ba,{size:12})})]})]},N.id)})}),F.length>0&&e.jsxs("details",{className:"equipment-returned-section",children:[e.jsx("summary",{className:"equipment-returned-toggle",children:e.jsxs("span",{children:["Returned Equipment (",F.length,")"]})}),e.jsx("div",{className:"equipment-list returned",children:F.map(N=>{const $=Xe.calculateDaysOnSite(N.start_date,N.end_date),v=N.daily_rate*$;return e.jsx("div",{className:"equipment-item returned",children:e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:N.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[lt(N.start_date)," - ",lt(N.end_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-days",children:[$," days"]}),e.jsx("span",{className:"equipment-total",children:Ne(v)})]})]})},N.id)})})]}),e.jsxs("div",{className:"equipment-total-row",children:[e.jsx("span",{children:"Total Equipment Cost"}),e.jsx("span",{className:"equipment-grand-total",children:Ne(j)})]})]}):e.jsxs("div",{className:"equipment-summary-collapsed",children:[e.jsxs("span",{children:[D.length," active, ",F.length," returned"]}),e.jsx("span",{className:"equipment-grand-total",children:Ne(j)})]})]})}),li=d.memo(function({project:n,areas:o=[],corStats:a={},onCreateDraw:t,onViewDraw:l,onShowToast:i}){const[r,m]=d.useState([]),[u,c]=d.useState(!0),j=d.useMemo(()=>o.reduce((v,C)=>{const O=(C.square_footage||0)*(C.price_per_sqft||0);return v+Math.round(O*100)},0),[o]),x=d.useMemo(()=>a?.approvedTotal||0,[a?.approvedTotal]),b=j+x,h=d.useCallback(async()=>{if(n?.id)try{c(!0);const v=await $n.getProjectDrawRequests(n.id);m(v||[])}catch(v){console.error("Error loading draw requests:",v)}finally{c(!1)}},[n?.id]);d.useEffect(()=>{h()},[h]);const p=d.useMemo(()=>{const v=r.filter(T=>["submitted","approved","paid"].includes(T.status)),C=v.reduce((T,S)=>T+(S.previous_billings||0)+(S.current_billing||0),0),L=v[0]?.retention_held||0;return{billedToDate:C,retentionHeld:L}},[r]),D=b>0?Math.round(p.billedToDate/b*100):0,F=r.length>0?Math.max(...r.map(v=>v.draw_number))+1:1,N=v=>v?new Date(v).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",$=v=>{switch(v){case"draft":return e.jsx("span",{className:"badge badge-muted",children:"Draft"});case"submitted":return e.jsx("span",{className:"badge badge-warning",children:"Submitted"});case"approved":return e.jsx("span",{className:"badge badge-success",children:"Approved"});case"paid":return e.jsx("span",{className:"badge badge-info",children:"Paid"});case"rejected":return e.jsx("span",{className:"badge badge-danger",children:"Rejected"});default:return null}};return e.jsxs("div",{className:"progress-billing-card",children:[e.jsxs("div",{className:"progress-billing-header",children:[e.jsxs("div",{className:"progress-billing-title",children:[e.jsx(Qn,{size:18}),e.jsx("h3",{children:"Progress Billing"})]}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>t?.(),disabled:j===0,title:j===0?"Add areas with contract values first":`Create Draw #${F}`,children:[e.jsx(ps,{size:14}),e.jsxs("span",{children:["Draw #",F]})]})]}),e.jsxs("div",{className:"progress-billing-contract",children:[e.jsxs("div",{className:"contract-row",children:[e.jsx("span",{className:"contract-label",children:"Original Contract"}),e.jsx("span",{className:"contract-value",children:Ne(j)})]}),x>0&&e.jsxs("div",{className:"contract-row co",children:[e.jsx("span",{className:"contract-label",children:"Approved COs"}),e.jsxs("span",{className:"contract-value positive",children:["+",Ne(x)]})]}),e.jsxs("div",{className:"contract-row revised",children:[e.jsx("span",{className:"contract-label",children:"Revised Contract"}),e.jsx("span",{className:"contract-value",children:Ne(b)})]})]}),e.jsxs("div",{className:"progress-billing-status",children:[e.jsx("div",{className:"billing-progress-bar",children:e.jsx("div",{className:"billing-progress-fill",style:{width:`${Math.min(D,100)}%`}})}),e.jsxs("div",{className:"billing-stats",children:[e.jsxs("div",{className:"billing-stat",children:[e.jsx("span",{className:"billing-stat-value",children:Ne(p.billedToDate)}),e.jsxs("span",{className:"billing-stat-label",children:["Billed to Date (",D,"%)"]})]}),p.retentionHeld>0&&e.jsxs("div",{className:"billing-stat retention",children:[e.jsxs("span",{className:"billing-stat-value",children:["-",Ne(p.retentionHeld)]}),e.jsx("span",{className:"billing-stat-label",children:"Retention Held"})]}),e.jsxs("div",{className:"billing-stat remaining",children:[e.jsx("span",{className:"billing-stat-value",children:Ne(b-p.billedToDate)}),e.jsx("span",{className:"billing-stat-label",children:"Balance to Finish"})]})]})]}),u?e.jsx("div",{className:"progress-billing-loading",children:e.jsx("div",{className:"loading-spinner small"})}):r.length===0?e.jsxs("div",{className:"progress-billing-empty",children:[e.jsx("p",{children:"No draw requests yet"}),j>0&&e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>t?.(),children:[e.jsx(ps,{size:14}),"Create First Draw Request"]})]}):e.jsxs("div",{className:"progress-billing-draws",children:[e.jsx("div",{className:"draws-header",children:e.jsx("span",{children:"Recent Draws"})}),e.jsx("div",{className:"draws-list",children:r.slice(0,3).map(v=>e.jsxs("button",{className:"draw-item",onClick:()=>l?.(v),children:[e.jsxs("div",{className:"draw-item-info",children:[e.jsxs("span",{className:"draw-number",children:["Draw #",v.draw_number]}),e.jsx("span",{className:"draw-date",children:N(v.period_end||v.created_at)})]}),e.jsx("div",{className:"draw-item-amount",children:Ne(v.current_billing||0)}),$(v.status),e.jsx(Ie,{size:16,className:"draw-item-arrow"})]},v.id))}),r.length>3&&e.jsxs("button",{className:"btn btn-sm btn-ghost view-all-draws",children:["View all ",r.length," draws"]})]})]})});function ci({project:s,company:n,onShowToast:o}){const[a,t]=d.useState(null),[l,i]=d.useState(!0),[r,m]=d.useState(!1);d.useEffect(()=>{if(s?.id&&n?.id){u();const h=I.subscribeToCrewCheckins?.(s.id,()=>{u()});return()=>{h&&I.unsubscribe?.(h)}}},[s?.id,n?.id]);const u=async()=>{try{const h=await I.calculateManDayCosts(s.id,n.id,s.work_type||"demolition",s.job_type||"standard");t(h)}catch(h){console.error("Error loading man day costs:",h)}finally{i(!1)}},c=h=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(h),j=h=>new Date(h).toLocaleDateString("en-US",{month:"short",day:"numeric"}),x=h=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[h]||h.charAt(0).toUpperCase()+h.slice(1);if(l)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!a||a.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(He,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const b=Object.entries(a.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>m(!r),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:c(a.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:r?"▼ Collapse":"▶ Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:c(a.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:a.daysWorked>0?c(a.totalCost/a.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),r&&e.jsxs("div",{className:"man-day-details",children:[b.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:b.map(([h,p])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:x(h)}),e.jsxs("span",{className:"role-rate",children:[c(p.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[p.count," days"]}),e.jsx("span",{className:"role-cost",children:c(p.cost)})]})]},h))})]}),a.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:a.byDate.slice(0,7).map((h,p)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:j(h.date)}),e.jsxs("span",{className:"date-workers",children:[h.workers," crew"]}),e.jsx("span",{className:"date-cost",children:c(h.cost)})]},p))}),a.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",a.byDate.length-7," more days"]})]})]})]})}const Le=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s||0),oi=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric"});function di({dailyBurn:s,totalBurn:n,daysWorked:o,laborCost:a,materialsEquipmentCost:t=0,progress:l,contractValue:i,laborByDate:r=[],materialsEquipmentByDate:m=[]}){const[u,c]=d.useState(!1),j=i*(l/100)*.6,x=n<=j?"on-budget":n<=j*1.2?"warning":"over-budget",b={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[x],h=x==="on-budget"?rs:x==="warning"?ut:ns,D=l>0?n/(l/100):0,F=[],N={};r.forEach(v=>{N[v.date]||(N[v.date]={date:v.date,labor:0,materialsEquipment:0,total:0}),N[v.date].labor=v.cost||0,N[v.date].total+=v.cost||0}),m.forEach(v=>{N[v.date]||(N[v.date]={date:v.date,labor:0,materialsEquipment:0,total:0}),N[v.date].materialsEquipment=v.cost||0,N[v.date].total+=v.cost||0}),Object.values(N).sort((v,C)=>new Date(C.date)-new Date(v.date)).slice(0,10).forEach(v=>F.push(v));const $=Math.max(...F.map(v=>v.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(Xn,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${x}`,children:[e.jsx(h,{size:14}),e.jsx("span",{children:b})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:Le(s)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),o>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",o," work day",o!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:Le(n)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:Le(a)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Materials"}),e.jsx("span",{className:"burn-summary-value",children:Le(t)})]})]}),l>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${D>i*.7?"warning":""}`,children:Le(D)})]}),F.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>c(!u),children:[u?e.jsx(zs,{size:16}):e.jsx(Ke,{size:16}),e.jsxs("span",{children:[u?"Hide":"View"," Daily Breakdown"]})]}),u&&F.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Materials"}),e.jsx("span",{children:"Total"})]}),F.map(v=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:oi(v.date)}),e.jsx("span",{className:"burn-labor",children:v.labor>0?Le(v.labor):"-"}),e.jsx("span",{className:"burn-materials",children:v.materialsEquipment>0?Le(v.materialsEquipment):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${v.total/$*100}%`}}),e.jsx("span",{className:"burn-amount",children:Le(v.total)})]})]},v.date))]})]})}const mi=()=>oe(()=>import("./pdf-DgmPe6PY.js").then(s=>s.j),[]);function ui({project:s,company:n,onShowToast:o}){const{branding:a}=pa(),[t,l]=d.useState([]),[i,r]=d.useState(!0),[m,u]=d.useState(null),[c,j]=d.useState(null),[x,b]=d.useState(new Set),[h,p]=d.useState(!1),[D,F]=d.useState("recent"),[N,$]=d.useState(new Set),[v,C]=d.useState({start:"",end:""});d.useEffect(()=>{O();const g=I.subscribeToDailyReports?.(s.id,()=>{O()});return()=>{g&&I.unsubscribe?.(g)}},[s.id]);const O=d.useCallback(async()=>{try{u(null);const g=await I.getDailyReports(s.id,365);l(g||[])}catch(g){console.error("Error loading daily reports:",g),u(g),o?.("Error loading daily reports","error")}finally{r(!1)}},[s.id]),L=d.useMemo(()=>{let g=[...t];if(v.start){const y=new Date(v.start);y.setHours(0,0,0,0),g=g.filter(K=>new Date(K.report_date||K.created_at)>=y)}if(v.end){const y=new Date(v.end);y.setHours(23,59,59,999),g=g.filter(K=>new Date(K.report_date||K.created_at)<=y)}if(D==="recent"){const y=new Date;y.setDate(y.getDate()-7),y.setHours(0,0,0,0),g=g.filter(K=>new Date(K.report_date||K.created_at)>=y)}return g},[t,D,v]),T=d.useMemo(()=>{if(D!=="all")return null;const g={};return L.forEach(y=>{const K=new Date(y.report_date||y.created_at),_=`${K.getFullYear()}-${String(K.getMonth()+1).padStart(2,"0")}`,J=K.toLocaleDateString("en-US",{month:"long",year:"numeric"});g[_]||(g[_]={label:J,reports:[]}),g[_].reports.push(y)}),Object.entries(g).sort((y,K)=>K[0].localeCompare(y[0]))},[L,D]);d.useEffect(()=>{if(T&&T.length>0){const g=T[0][0];$(new Set([g]))}},[T]);const S=()=>{p(!h),h&&b(new Set)},E=g=>{const y=new Set(x);y.has(g)?y.delete(g):y.add(g),b(y)},V=()=>{x.size===L.length?b(new Set):b(new Set(L.map(g=>g.id)))},A=g=>{const y=new Set(N);y.has(g)?y.delete(g):y.add(g),$(y)},B=()=>x.size>0?L.filter(g=>x.has(g.id)):L,R=g=>new Date(g).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),se=g=>new Date(g).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}),P=g=>{switch(g){case"submitted":return"✓";case"reviewed":return"✓✓";case"draft":return"○";default:return"○"}},re=g=>{switch(g){case"submitted":return"Submitted";case"reviewed":return"Reviewed";case"draft":return"Draft";default:return g}},ue=async()=>{const g=B();if(g.length===0){o?.("No reports to export","error");return}o?.("Generating PDF...","info");const K=(await mi()).default,_=new K,J=_.internal.pageSize.getWidth(),Y=20;let ee=Y;const Se=hs(a?.primary_color||"#3B82F6"),Je=hs(a?.secondary_color||"#1E40AF");_.setFillColor(...Se),_.rect(0,0,J,45,"F"),_.setFillColor(...Je),_.rect(0,42,J,3,"F");let Ee=Y;if(a?.logo_url)try{const Z=await xa(a.logo_url);Z&&(_.addImage(Z,"PNG",Y,7,30,30),Ee=Y+40)}catch(Z){console.error("Error adding logo:",Z)}_.setTextColor(255,255,255),_.setFontSize(22),_.setFont("helvetica","bold"),_.text(n?.name||"Company Name",Ee,20),_.setFontSize(10),_.setFont("helvetica","normal"),_.text("DAILY REPORTS SUMMARY",Ee,30),_.setFontSize(9),_.text(`Generated: ${new Date().toLocaleDateString()}`,J-Y,20,{align:"right"}),s.job_number&&_.text(`Job #: ${s.job_number}`,J-Y,28,{align:"right"}),ee=55,_.setFillColor(248,250,252),_.rect(Y,ee-5,J-Y*2,20,"F"),_.setTextColor(...Se),_.setFontSize(14),_.setFont("helvetica","bold"),_.text(`Project: ${s.name}`,Y+5,ee+7),_.setFontSize(10),_.setTextColor(100,100,100),_.text(`${g.length} Report${g.length!==1?"s":""}`,J-Y-5,ee+7,{align:"right"}),ee+=25,g.forEach((Z,je)=>{ee>250&&(_.addPage(),ee=Y),_.setFillColor(...Se),_.setTextColor(255,255,255),_.rect(Y,ee,J-Y*2,10,"F"),_.setFontSize(11),_.setFont("helvetica","bold"),_.text(R(Z.report_date||Z.created_at),Y+5,ee+7),_.text(re(Z.status),J-Y-5,ee+7,{align:"right"}),ee+=15,_.setTextColor(50,50,50),_.setFontSize(10),_.setFont("helvetica","normal");const gs=`Crew: ${Z.crew_count||0}  |  Tasks: ${Z.tasks_completed||0}  |  T&M: ${Z.tm_tickets_count||0}  |  Photos: ${Z.photos_count||0}`;if(_.text(gs,Y+5,ee),ee+=8,Z.crew_list?.length>0){_.setFont("helvetica","bold"),_.text("Crew:",Y+5,ee),_.setFont("helvetica","normal");const ve=Z.crew_list.map(bs=>`${bs.name} (${bs.role})`).join(", "),fs=_.splitTextToSize(ve,J-Y*2-30);_.text(fs,Y+25,ee),ee+=fs.length*5+3}if(Z.field_notes){_.setFont("helvetica","bold"),_.text("Notes:",Y+5,ee),_.setFont("helvetica","normal");const ve=_.splitTextToSize(Z.field_notes,J-Y*2-30);_.text(ve,Y+25,ee),ee+=ve.length*5+3}if(Z.issues){_.setTextColor(180,50,50),_.setFont("helvetica","bold"),_.text("Issues:",Y+5,ee),_.setFont("helvetica","normal");const ve=_.splitTextToSize(Z.issues,J-Y*2-30);_.text(ve,Y+25,ee),_.setTextColor(50,50,50),ee+=ve.length*5+3}ee+=10});const X=_.internal.getNumberOfPages();for(let Z=1;Z<=X;Z++)_.setPage(Z),_.setFontSize(8),_.setTextColor(150,150,150),_.text(`Page ${Z} of ${X}`,J/2,_.internal.pageSize.getHeight()-10,{align:"center"});const Ye=`${s.name}_Daily_Reports_${new Date().toISOString().split("T")[0]}.pdf`;_.save(Ye),o?.("PDF exported!","success")},le=g=>e.jsxs("div",{className:`daily-report-card ${g.status} ${x.has(g.id)?"selected":""}`,children:[e.jsxs("div",{className:"daily-report-header-row",onClick:()=>j(c===g.id?null:g.id),children:[h&&e.jsx("input",{type:"checkbox",className:"report-checkbox",checked:x.has(g.id),onChange:y=>{y.stopPropagation(),E(g.id)},onClick:y=>y.stopPropagation()}),e.jsxs("div",{className:"daily-report-info",children:[e.jsx("span",{className:"report-date",children:R(g.report_date||g.created_at)}),e.jsxs("span",{className:`report-status ${g.status}`,children:[P(g.status)," ",re(g.status)]})]}),e.jsxs("div",{className:"daily-report-summary",children:[e.jsxs("span",{className:"report-crew",children:[g.crew_count||0," crew"]}),e.jsxs("span",{className:"report-tasks",children:[g.tasks_completed||0," tasks"]}),e.jsx("span",{className:"report-expand",children:c===g.id?"▼":"▶"})]})]}),c===g.id&&e.jsxs("div",{className:"daily-report-details",children:[e.jsxs("div",{className:"report-stats-grid",children:[e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:g.crew_count||0}),e.jsx("span",{className:"stat-label",children:"Crew on Site"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:g.tasks_completed||0}),e.jsx("span",{className:"stat-label",children:"Tasks Done"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:g.tm_tickets_count||0}),e.jsx("span",{className:"stat-label",children:"T&M Tickets"})]}),e.jsxs("div",{className:"report-stat",children:[e.jsx("span",{className:"stat-value",children:g.photos_count||0}),e.jsx("span",{className:"stat-label",children:"Photos"})]})]}),g.crew_list?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Crew"}),e.jsx("div",{className:"report-crew-list",children:g.crew_list.map((y,K)=>e.jsxs("div",{className:"crew-member",children:[e.jsx("span",{className:"crew-name",children:y.name}),e.jsx("span",{className:"crew-role",children:y.role})]},K))})]}),g.completed_tasks?.length>0&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Completed Today"}),e.jsx("ul",{className:"report-tasks-list",children:g.completed_tasks.map((y,K)=>e.jsxs("li",{children:[y.name,y.group&&e.jsx("span",{className:"task-group",children:y.group})]},K))})]}),g.field_notes&&e.jsxs("div",{className:"report-section",children:[e.jsx("h4",{children:"Field Notes"}),e.jsx("p",{className:"report-notes",children:g.field_notes})]}),g.issues&&e.jsxs("div",{className:"report-section issues",children:[e.jsx("h4",{children:"Issues / Concerns"}),e.jsx("p",{className:"report-issues",children:g.issues})]}),g.submitted_at&&e.jsx("div",{className:"report-meta",children:e.jsxs("span",{children:["Submitted by ",g.submitted_by||"Field"," at ",se(g.submitted_at)]})})]})]},g.id);if(i)return e.jsx("div",{className:"loading",children:"Loading daily reports..."});if(m)return e.jsx("div",{className:"daily-reports-list card",children:e.jsx(ya,{title:"Unable to load reports",message:"There was a problem loading daily reports. Please try again.",error:m,onRetry:O})});const _e=t.length,M=L.length;return e.jsxs("div",{className:"daily-reports-list card",children:[e.jsxs("div",{className:"daily-reports-header",children:[e.jsx("h3",{children:"Daily Reports"}),e.jsx("div",{className:"daily-reports-actions",children:t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:`btn btn-small ${h?"btn-primary":"btn-secondary"}`,onClick:S,children:h?"Cancel":"Select"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:ue,children:["PDF",x.size>0?` (${x.size})`:""]})]})})]}),t.length>0&&e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${D==="recent"?"active":""}`,onClick:()=>F("recent"),children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${D==="all"?"active":""}`,onClick:()=>F("all"),children:["All (",_e,")"]})]}),D==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Ls,{size:14,className:"date-filter-icon"}),e.jsx("input",{type:"date",value:v.start,onChange:g=>C(y=>({...y,start:g.target.value})),className:"date-input"}),e.jsx("span",{className:"date-separator",children:"to"}),e.jsx("input",{type:"date",value:v.end,onChange:g=>C(y=>({...y,end:g.target.value})),className:"date-input"}),(v.start||v.end)&&e.jsx("button",{className:"date-clear",onClick:()=>C({start:"",end:""}),children:"Clear"})]})]}),h&&L.length>0&&e.jsxs("div",{className:"select-all-bar",children:[e.jsxs("label",{className:"select-all-label",children:[e.jsx("input",{type:"checkbox",checked:x.size===L.length&&L.length>0,onChange:V}),"Select All (",L.length,")"]}),x.size>0&&e.jsxs("span",{className:"selected-count",children:[x.size," selected"]})]}),t.length===0?e.jsx(oa,{icon:xe,title:"No daily reports yet",message:"Reports from the field will appear here"}):L.length===0?e.jsx(oa,{icon:xe,title:"No reports in this time period",message:D==="recent"?"No reports in the last 7 days":"Try adjusting your date filter"}):D==="recent"?e.jsxs("div",{className:"daily-reports",children:[L.map(g=>le(g)),_e>M&&e.jsx("div",{className:"view-all-prompt",children:e.jsxs("button",{className:"btn btn-secondary",onClick:()=>F("all"),children:["View All ",_e," Reports"]})})]}):e.jsx("div",{className:"daily-reports grouped",children:T?.map(([g,{label:y,reports:K}])=>e.jsxs("div",{className:"month-group",children:[e.jsxs("div",{className:"month-header",onClick:()=>A(g),children:[N.has(g)?e.jsx(Ke,{size:18,className:"month-chevron"}):e.jsx(Ie,{size:18,className:"month-chevron"}),e.jsx("span",{className:"month-label",children:y}),e.jsxs("span",{className:"month-count",children:[K.length," report",K.length!==1?"s":""]})]}),N.has(g)&&e.jsx("div",{className:"month-reports",children:K.map(_=>le(_))})]},g))})]})}const ua=d.memo(function({report:n,formatDate:o,formatTime:a,getInjuryTypeColor:t,getInjuryTypeLabel:l,getStatusColor:i,onViewDetails:r}){const m=()=>r(n),u=c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),r(n))};return e.jsxs("div",{className:"report-card",onClick:m,onKeyDown:u,role:"button",tabIndex:0,"aria-label":`Injury report for ${n.employee_name} on ${o(n.incident_date)}`,children:[e.jsxs("div",{className:"report-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"report-date",children:[o(n.incident_date)," at ",a(n.incident_time)]}),e.jsx("div",{className:"employee-name",children:n.employee_name})]}),e.jsxs("div",{className:"report-badges",children:[e.jsx("span",{className:"badge",style:{backgroundColor:t(n.injury_type)},children:l(n.injury_type)}),e.jsx("span",{className:"badge",style:{backgroundColor:i(n.status)},children:n.status.replace("_"," ")})]})]}),e.jsxs("div",{className:"report-summary",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Location:"})," ",n.incident_location]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Reported by:"})," ",n.reported_by_name," (",n.reported_by_title,")"]}),n.body_part_affected&&e.jsxs("div",{className:"summary-item",children:[e.jsx("strong",{children:"Body Part:"})," ",n.body_part_affected]}),n.osha_recordable&&e.jsx("div",{className:"summary-item",children:e.jsx("span",{className:"osha-badge",children:"OSHA Recordable"})})]}),e.jsxs("div",{className:"report-description",children:[n.incident_description.substring(0,150),n.incident_description.length>150&&"..."]}),e.jsx("div",{className:"report-footer",children:e.jsx("span",{children:"Click to view full details"})})]})}),hi=()=>oe(()=>import("./pdf-DgmPe6PY.js").then(s=>s.j),[]);function pi({project:s,companyId:n,company:o,user:a,onShowToast:t}){const{branding:l}=pa(),[i,r]=d.useState([]),[m,u]=d.useState(null),[c,j]=d.useState(!1),[x,b]=d.useState(!0),[h,p]=d.useState(null),[D,F]=d.useState(null),[N,$]=d.useState("recent"),[v,C]=d.useState(new Set),[O,L]=d.useState({start:"",end:""});d.useEffect(()=>{T();const M=n||s?.company_id,g=M?I.subscribeToInjuryReports?.(M,()=>{T()}):null;return()=>{g&&I.unsubscribe?.(g)}},[s?.id,n]);const T=d.useCallback(async()=>{b(!0),p(null);try{const M=s?await I.getInjuryReports(s.id):await I.getCompanyInjuryReports(n);r(M)}catch(M){console.error("Error loading injury reports:",M),p(M),F({type:"error",message:"Failed to load injury reports"})}finally{b(!1)}},[s?.id,n]),S=()=>{T(),j(!1),F({type:"success",message:"Injury report created successfully"})},E=M=>{u(M)},V=()=>{u(null)},A=M=>M?new Date(M).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",B=M=>M?new Date(`2000-01-01T${M}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"",R=M=>({minor:"Minor Injury",serious:"Serious Injury",critical:"Critical Injury",near_miss:"Near Miss"})[M]||M,se=M=>({reported:"#fbbf24",under_investigation:"#3b82f6",closed:"#10b981"})[M]||"#9ca3af",P=M=>({minor:"#10b981",serious:"#f59e0b",critical:"#ef4444",near_miss:"#6b7280"})[M]||"#9ca3af",re=d.useMemo(()=>{let M=[...i];if(O.start){const g=new Date(O.start);g.setHours(0,0,0,0),M=M.filter(y=>new Date(y.incident_date)>=g)}if(O.end){const g=new Date(O.end);g.setHours(23,59,59,999),M=M.filter(y=>new Date(y.incident_date)<=g)}if(N==="recent"){const g=new Date;g.setDate(g.getDate()-7),g.setHours(0,0,0,0),M=M.filter(y=>new Date(y.incident_date)>=g)}return M},[i,N,O]),ue=d.useMemo(()=>{if(N!=="all")return null;const M={};return re.forEach(g=>{const y=new Date(g.incident_date),K=`${y.getFullYear()}-${String(y.getMonth()+1).padStart(2,"0")}`,_=y.toLocaleDateString("en-US",{month:"long",year:"numeric"});M[K]||(M[K]={label:_,reports:[]}),M[K].reports.push(g)}),Object.entries(M).sort((g,y)=>y[0].localeCompare(g[0]))},[re,N]);d.useEffect(()=>{if(ue&&ue.length>0){const M=ue[0][0];C(new Set([M]))}},[ue]);const le=M=>{const g=new Set(v);g.has(M)?g.delete(M):g.add(M),C(g)},_e=async()=>{if(i.length===0){F({type:"error",message:"No reports to export"});return}F({type:"info",message:"Generating PDF..."});const g=(await hi()).default,y=new g,K=y.internal.pageSize.getWidth(),_=20;let J=_;const Y=hs(l?.primary_color||"#3B82F6"),ee=hs(l?.secondary_color||"#1E40AF");y.setFillColor(...Y),y.rect(0,0,K,45,"F"),y.setFillColor(...ee),y.rect(0,42,K,3,"F");let Se=_;if(l?.logo_url)try{const X=await xa(l.logo_url);X&&(y.addImage(X,"PNG",_,7,30,30),Se=_+40)}catch(X){console.error("Error adding logo:",X)}y.setTextColor(255,255,255),y.setFontSize(22),y.setFont("helvetica","bold"),y.text(o?.name||"Company",Se,20),y.setFontSize(10),y.setFont("helvetica","normal"),y.text("INJURY & INCIDENT REPORTS",Se,30),y.setFontSize(9),y.text(`Generated: ${new Date().toLocaleDateString()}`,K-_,20,{align:"right"}),y.text(`Total Reports: ${i.length}`,K-_,28,{align:"right"}),J=55,s&&(y.setFillColor(248,250,252),y.rect(_,J-5,K-_*2,15,"F"),y.setTextColor(...Y),y.setFontSize(12),y.setFont("helvetica","bold"),y.text(`Project: ${s.name}`,_+5,J+5),J+=20),i.forEach(X=>{J>200&&(y.addPage(),J=_);const Ye=hs(P(X.injury_type));y.setFillColor(...Ye),y.rect(_,J,K-_*2,12,"F"),y.setTextColor(255,255,255),y.setFontSize(11),y.setFont("helvetica","bold"),y.text(`${X.employee_name} - ${R(X.injury_type)}`,_+5,J+8),y.text(A(X.incident_date),K-_-5,J+8,{align:"right"}),J+=17,y.setTextColor(50,50,50),y.setFontSize(9),y.setFont("helvetica","normal"),y.text(`Location: ${X.incident_location}`,_+5,J),X.incident_time&&y.text(`Time: ${B(X.incident_time)}`,_+100,J),J+=6,y.setFont("helvetica","bold"),y.text("Description:",_+5,J),y.setFont("helvetica","normal"),J+=5;const Z=y.splitTextToSize(X.incident_description,K-_*2-10);y.text(Z,_+5,J),J+=Z.length*4+3;const je=[];X.body_part_affected&&je.push(`Body Part: ${X.body_part_affected}`),X.osha_recordable&&je.push("OSHA Recordable"),X.workers_comp_claim&&je.push("Workers' Comp Filed"),X.medical_treatment_required&&je.push("Medical Treatment Required"),je.length>0&&(y.setFontSize(8),y.setTextColor(100,100,100),y.text(je.join("  |  "),_+5,J),J+=5),y.setFontSize(8),y.text(`Reported by: ${X.reported_by_name} (${X.reported_by_title})`,_+5,J),J+=12});const Je=y.internal.getNumberOfPages();for(let X=1;X<=Je;X++)y.setPage(X),y.setFontSize(8),y.setTextColor(150,150,150),y.text(`Page ${X} of ${Je}`,K/2,y.internal.pageSize.getHeight()-10,{align:"center"}),y.text("CONFIDENTIAL - Injury Report",_,y.internal.pageSize.getHeight()-10);const Ee=`Injury_Reports_${new Date().toISOString().split("T")[0]}.pdf`;y.save(Ee),F({type:"success",message:"PDF exported!"})};return x?e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading injury reports..."})]}):h?e.jsx("div",{className:"injury-reports-section card",children:e.jsx(ya,{title:"Unable to load reports",message:"There was a problem loading injury reports. Please try again.",error:h,onRetry:T})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"injury-reports-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Injury & Incident Reports"}),e.jsxs("div",{className:"section-header-actions",children:[i.length>0&&e.jsx("button",{className:"btn-secondary",onClick:_e,children:"PDF"}),e.jsx("button",{className:"btn-primary",onClick:()=>j(!0),children:"+ File Injury Report"})]})]}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${N==="recent"?"active":""}`,onClick:()=>{$("recent"),L({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${N==="all"?"active":""}`,onClick:()=>$("all"),children:["All (",i.length,")"]})]}),N==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Ls,{size:16}),e.jsx("input",{type:"date",value:O.start,onChange:M=>L(g=>({...g,start:M.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:O.end,onChange:M=>L(g=>({...g,end:M.target.value})),placeholder:"End date"}),(O.start||O.end)&&e.jsx("button",{className:"btn-ghost",onClick:()=>L({start:"",end:""}),children:"Clear"})]})]}),re.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-state-icon",children:"🏥"}),e.jsxs("h4",{children:["No Injury Reports",N==="recent"?" in the last 7 days":""]}),e.jsx("p",{children:'Click "File Injury Report" to document a workplace incident'}),N==="recent"&&i.length>0&&e.jsx("button",{className:"btn-secondary",onClick:()=>$("all"),children:"View All Reports"})]}):e.jsx("div",{className:"reports-list",children:N==="all"&&ue?ue.map(([M,g])=>e.jsxs("div",{className:"month-group",children:[e.jsx("div",{className:"month-header",onClick:()=>le(M),children:e.jsxs("div",{className:"month-header-left",children:[v.has(M)?e.jsx(Ke,{size:18}):e.jsx(Ie,{size:18}),e.jsx("span",{className:"month-label",children:g.label}),e.jsxs("span",{className:"month-count",children:[g.reports.length," reports"]})]})}),v.has(M)&&e.jsx("div",{className:"month-reports",children:g.reports.map(y=>e.jsx(ua,{report:y,formatDate:A,formatTime:B,getInjuryTypeColor:P,getInjuryTypeLabel:R,getStatusColor:se,onViewDetails:E},y.id))})]},M)):re.map(M=>e.jsx(ua,{report:M,formatDate:A,formatTime:B,getInjuryTypeColor:P,getInjuryTypeLabel:R,getStatusColor:se,onViewDetails:E},M.id))}),m&&e.jsx("div",{className:"modal-overlay",onClick:V,children:e.jsxs("div",{className:"modal-content report-details-modal",onClick:M=>M.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:"Injury Report Details"}),e.jsx("button",{className:"close-btn",onClick:V,children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Incident Information"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Date & Time"}),e.jsxs("div",{children:[A(m.incident_date)," at ",B(m.incident_time)]})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Location"}),e.jsx("div",{children:m.incident_location})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Injury Type"}),e.jsx("div",{children:e.jsx("span",{className:"badge",style:{backgroundColor:P(m.injury_type)},children:R(m.injury_type)})})]}),m.body_part_affected&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Body Part Affected"}),e.jsx("div",{children:m.body_part_affected})]})]}),e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Description"}),e.jsx("div",{className:"description-box",children:m.incident_description})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Injured Employee"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:m.employee_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Job Title"}),e.jsx("div",{children:m.employee_job_title})]}),m.employee_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:m.employee_phone})]}),m.employee_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:m.employee_email})]}),m.employee_address&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:m.employee_address})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Reported By"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Name"}),e.jsx("div",{children:m.reported_by_name})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Title"}),e.jsx("div",{children:m.reported_by_title})]}),m.reported_by_phone&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Phone"}),e.jsx("div",{children:m.reported_by_phone})]}),m.reported_by_email&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Email"}),e.jsx("div",{children:m.reported_by_email})]})]})]}),m.witnesses&&m.witnesses.length>0&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Witnesses"}),m.witnesses.map((M,g)=>e.jsxs("div",{className:"witness-card",children:[e.jsxs("div",{className:"witness-header",children:[e.jsx("strong",{children:M.name}),M.phone&&e.jsxs("span",{children:[" • ",M.phone]}),M.email&&e.jsxs("span",{children:[" • ",M.email]})]}),M.testimony&&e.jsx("div",{className:"witness-testimony",children:e.jsxs("em",{children:['"',M.testimony,'"']})})]},g))]}),m.medical_treatment_required&&e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Medical Treatment"}),e.jsxs("div",{className:"detail-grid",children:[m.medical_facility_name&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Facility"}),e.jsx("div",{children:m.medical_facility_name})]}),m.medical_facility_address&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Address"}),e.jsx("div",{children:m.medical_facility_address})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Hospitalized"}),e.jsx("div",{children:m.hospitalized?"Yes":"No"})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Actions & Safety"}),m.immediate_actions_taken&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Immediate Actions Taken"}),e.jsx("div",{className:"description-box",children:m.immediate_actions_taken})]}),m.corrective_actions_planned&&e.jsxs("div",{className:"detail-item full-width",children:[e.jsx("label",{children:"Corrective Actions Planned"}),e.jsx("div",{className:"description-box",children:m.corrective_actions_planned})]}),e.jsxs("div",{className:"detail-grid",children:[m.safety_equipment_used&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Used"}),e.jsx("div",{children:m.safety_equipment_used})]}),m.safety_equipment_failed&&e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Safety Equipment Failed"}),e.jsx("div",{children:m.safety_equipment_failed})]})]})]}),e.jsxs("section",{className:"details-section",children:[e.jsx("h3",{children:"Regulatory & Work Impact"}),e.jsxs("div",{className:"detail-grid",children:[e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"OSHA Recordable"}),e.jsx("div",{children:m.osha_recordable?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Workers' Comp Claim"}),e.jsx("div",{children:m.workers_comp_claim?"Yes":"No"})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Days Away From Work"}),e.jsx("div",{children:m.days_away_from_work||0})]}),e.jsxs("div",{className:"detail-item",children:[e.jsx("label",{children:"Restricted Work Days"}),e.jsx("div",{children:m.restricted_work_days||0})]})]})]}),e.jsxs("div",{className:"report-meta",children:["Filed on ",A(m.created_at)]})]})]})}),c&&e.jsx(Pn,{project:s,companyId:n,user:a,onClose:()=>j(!1),onReportCreated:S}),D&&e.jsx(An,{message:D.message,type:D.type,onClose:()=>F(null)})]}),e.jsx("style",{children:`
        .injury-reports-section {
          margin-top: 2rem;
        }

        .section-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
        }

        .section-header h3 {
          margin: 0;
          font-size: 1.25rem;
          color: var(--text-primary);
        }

        .view-mode-bar {
          display: flex;
          justify-content: space-between;
          align-items: center;
          gap: 1rem;
          margin-bottom: 1rem;
          padding: 0.75rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          flex-wrap: wrap;
        }

        .view-mode-tabs {
          display: flex;
          gap: 0.5rem;
        }

        .view-mode-tab {
          padding: 0.5rem 1rem;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          cursor: pointer;
          background: transparent;
          color: var(--text-secondary);
          transition: all 0.2s;
        }

        .view-mode-tab:hover {
          background: var(--bg-tertiary);
        }

        .view-mode-tab.active {
          background: var(--primary-color, #3b82f6);
          color: white;
        }

        .date-filter {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          color: var(--text-secondary);
        }

        .date-filter input[type="date"] {
          padding: 0.4rem 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 0.875rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .btn-ghost {
          background: transparent;
          border: none;
          padding: 0.4rem 0.75rem;
          color: var(--text-secondary);
          cursor: pointer;
          border-radius: 4px;
          font-size: 0.875rem;
        }

        .btn-ghost:hover {
          background: var(--bg-tertiary);
        }

        .month-group {
          margin-bottom: 0.5rem;
        }

        .month-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.75rem 1rem;
          background: var(--bg-elevated);
          border-radius: 8px;
          cursor: pointer;
          transition: background 0.2s;
        }

        .month-header:hover {
          background: var(--bg-tertiary);
        }

        .month-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .month-label {
          font-weight: 600;
          color: var(--text-primary);
        }

        .month-count {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .month-reports {
          margin-top: 0.5rem;
          padding-left: 0.5rem;
        }

        .reports-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .report-card {
          background: var(--bg-card);
          border: 1px solid var(--border-color);
          border-radius: 8px;
          padding: 1.5rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .report-card:hover {
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
          border-color: var(--accent-primary);
        }

        .report-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 1rem;
        }

        .report-date {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .employee-name {
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text-primary);
        }

        .report-badges {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
        }

        .badge {
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-size: 0.75rem;
          font-weight: 500;
          color: white;
          text-transform: capitalize;
        }

        .osha-badge {
          background-color: #dc2626;
          color: white;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
          font-size: 0.75rem;
          font-weight: 600;
        }

        .report-summary {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 0.75rem;
          margin-bottom: 1rem;
          padding: 1rem;
          background-color: var(--bg-elevated);
          border-radius: 6px;
        }

        .summary-item {
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .summary-item strong {
          color: var(--text-primary);
        }

        .report-description {
          color: var(--text-secondary);
          line-height: 1.6;
          margin-bottom: 1rem;
        }

        .report-footer {
          text-align: right;
          font-size: 0.875rem;
          color: var(--primary-color, #3b82f6);
        }

        .report-details-modal {
          max-width: 900px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .details-section {
          margin-bottom: 2rem;
          padding-bottom: 2rem;
          border-bottom: 1px solid var(--border-color);
        }

        .details-section:last-child {
          border-bottom: none;
        }

        .details-section h3 {
          margin-top: 0;
          margin-bottom: 1rem;
          font-size: 1.125rem;
          color: var(--text-primary);
        }

        .detail-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
        }

        .detail-item label {
          display: block;
          font-size: 0.875rem;
          font-weight: 600;
          color: var(--text-secondary);
          margin-bottom: 0.25rem;
        }

        .detail-item div {
          color: var(--text-primary);
        }

        .detail-item.full-width {
          grid-column: 1 / -1;
        }

        .description-box {
          background-color: var(--bg-elevated);
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          white-space: pre-wrap;
          line-height: 1.6;
          color: var(--text-primary);
        }

        .witness-card {
          background-color: var(--bg-elevated);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
        }

        .witness-header {
          margin-bottom: 0.5rem;
          color: var(--text-primary);
        }

        .witness-testimony {
          color: var(--text-secondary);
          font-size: 0.875rem;
          padding-left: 1rem;
          border-left: 3px solid var(--border-color);
        }

        .report-meta {
          text-align: center;
          font-size: 0.875rem;
          color: var(--text-secondary);
          padding-top: 1rem;
          border-top: 1px solid var(--border-color);
        }

        .empty-state {
          text-align: center;
          padding: 3rem 1rem;
        }

        .empty-state-icon {
          font-size: 3rem;
          margin-bottom: 1rem;
        }

        .empty-state h4 {
          margin: 0 0 0.5rem 0;
          color: var(--text-primary);
        }

        .empty-state p {
          margin: 0;
          color: var(--text-secondary);
        }

        .section-header-actions {
          display: flex;
          gap: 0.5rem;
          align-items: center;
        }

        .btn-primary, .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-primary:hover, .btn-secondary:hover {
          opacity: 0.9;
        }

        .loading-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 3rem;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 4px solid var(--border-color);
          border-top-color: var(--accent-primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
          .report-header {
            flex-direction: column;
            gap: 0.5rem;
          }

          .report-summary {
            grid-template-columns: 1fr;
          }

          .detail-grid {
            grid-template-columns: 1fr;
          }

          .report-details-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }
        }
      `})]})}const ha=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function xi({project:s,company:n,user:o,isAdmin:a,onShowToast:t}){const[l,i]=d.useState([]),[r,m]=d.useState([]),[u,c]=d.useState(!0),[j,x]=d.useState(!1),[b,h]=d.useState(""),[p,D]=d.useState("Team Member"),[F,N]=d.useState(null);d.useEffect(()=>{s?.id&&$()},[s?.id]),d.useEffect(()=>{j&&n?.id&&v()},[j,n?.id]);const $=async()=>{try{c(!0);const T=await I.getProjectTeam(s.id);i(T)}catch(T){console.error("Error loading project team:",T),t("Error loading project team","error")}finally{c(!1)}},v=async()=>{try{const T=await I.getCompanyMembers(n.id),S=l.map(V=>V.users?.id),E=T.filter(V=>!S.includes(V.users?.id));m(E)}catch(T){console.error("Error loading company members:",T),t("Error loading company members","error")}},C=async()=>{if(!b){t("Select a team member","error");return}try{N("add"),await I.addProjectMember(s.id,b,p,o.id),t("Team member added","success"),x(!1),h(""),D("Team Member"),$()}catch(T){console.error("Error adding team member:",T),t("Error adding team member","error")}finally{N(null)}},O=async(T,S)=>{try{N(T.id),await I.updateProjectMemberRole(s.id,T.users?.id,S),t("Role updated","success"),$()}catch(E){console.error("Error updating role:",E),t("Error updating role","error")}finally{N(null)}},L=async T=>{try{N(T.id),await I.removeProjectMember(s.id,T.users?.id),t("Team member removed","success"),$()}catch(S){console.error("Error removing team member:",S),t("Error removing team member","error")}finally{N(null)}};return u?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx(Re,{size:18})," Project Team"]}),a&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>x(!0),children:[e.jsx(Zn,{size:14})," Add"]})]}),l.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",a&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:l.map(T=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:T.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:T.users?.email})]}),e.jsx("div",{className:"team-member-role",children:a?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:T.project_role,onChange:S=>O(T,S.target.value),disabled:F===T.id,className:"role-select",children:ha.map(S=>e.jsx("option",{value:S,children:S},S))}),e.jsx(Ke,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:T.project_role})}),a&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>L(T),disabled:F===T.id,title:"Remove from project",children:e.jsx(er,{size:14})})]},T.id))}),j&&e.jsx("div",{className:"modal-overlay",onClick:()=>x(!1),children:e.jsxs("div",{className:"modal-content small",onClick:T=>T.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>x(!1),children:e.jsx(as,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:b,onChange:T=>h(T.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),r.map(T=>e.jsx("option",{value:T.users?.id,children:T.users?.name||T.users?.email},T.users?.id))]}),r.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:p,onChange:T=>D(T.target.value),className:"form-select",children:ha.map(T=>e.jsx("option",{value:T,children:T},T))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>x(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:C,disabled:!b||F==="add",children:F==="add"?"Adding...":"Add to Project"})]})]})})]})}function ji({onShowToast:s,onClose:n}){const[o,a]=d.useState("loading"),[t,l]=d.useState([]),[i,r]=d.useState(null),[m,u]=d.useState(null),[c,j]=d.useState(null),[x,b]=d.useState(""),[h,p]=d.useState(!1),[D,F]=d.useState(!1),[N,$]=d.useState(null);d.useEffect(()=>{v()},[]);const v=async()=>{try{const{data:E,error:V}=await os.auth.mfa.listFactors();if(V)throw V;const A=(E?.totp||[]).filter(B=>B.status==="verified");l(A),a("overview")}catch{a("overview")}},C=async()=>{$(null);try{const{data:E,error:V}=await os.auth.mfa.enroll({factorType:"totp",friendlyName:"FieldSync Authenticator"});if(V)throw V;if(!E?.totp)throw new Error("MFA enrollment response missing TOTP data");r(E.totp.qr_code),u(E.totp.secret),j(E.id),a("enroll")}catch(E){$(E.message),s?.("Failed to start MFA enrollment","error")}},O=async()=>{if(x.length===6){p(!0),$(null);try{const{data:E,error:V}=await os.auth.mfa.challenge({factorId:c});if(V)throw V;const{error:A}=await os.auth.mfa.verify({factorId:c,challengeId:E.id,code:x});if(A)throw A;a("success"),s?.("MFA enabled successfully!","success"),await v()}catch{$("Invalid code. Please try again."),b("")}finally{p(!1)}}},L=async E=>{try{const{error:V}=await os.auth.mfa.unenroll({factorId:E});if(V)throw V;s?.("MFA disabled","success"),await v()}catch{s?.("Failed to disable MFA","error")}},T=()=>{navigator.clipboard.writeText(m),F(!0),setTimeout(()=>F(!1),2e3)},S=t.length>0;return e.jsxs("div",{className:"mfa-setup",children:[e.jsxs("div",{className:"mfa-header",children:[e.jsxs("div",{className:"mfa-title",children:[S?e.jsx(at,{size:20,className:"text-success"}):e.jsx(mt,{size:20}),e.jsx("h3",{children:"Two-Factor Authentication"})]}),n&&e.jsx("button",{className:"close-btn",onClick:n,"aria-label":"Close",children:e.jsx(as,{size:20})})]}),o==="loading"&&e.jsxs("div",{className:"mfa-loading",children:[e.jsx(Zt,{size:24,className:"spinner"})," Loading..."]}),o==="overview"&&e.jsxs("div",{className:"mfa-overview",children:[e.jsx("p",{className:"mfa-description",children:"Add an extra layer of security to your account. When enabled, you will need to enter a code from your authenticator app each time you sign in."}),S?e.jsxs("div",{className:"mfa-status mfa-status-enabled",children:[e.jsx(at,{size:18}),e.jsx("span",{children:"MFA is enabled"}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>L(t[0].id),children:[e.jsx(ea,{size:14})," Disable"]})]}):e.jsxs("div",{className:"mfa-status mfa-status-disabled",children:[e.jsx(ea,{size:18}),e.jsx("span",{children:"MFA is not enabled"}),e.jsxs("button",{className:"btn btn-primary btn-small",onClick:C,children:[e.jsx(mt,{size:14})," Enable MFA"]})]})]}),o==="enroll"&&e.jsxs("div",{className:"mfa-enroll",children:[e.jsx("p",{children:"Scan this QR code with your authenticator app (Google Authenticator, Authy, 1Password):"}),i&&e.jsx("div",{className:"mfa-qr-container",children:e.jsx("img",{src:i,alt:"MFA QR Code",className:"mfa-qr"})}),e.jsxs("div",{className:"mfa-secret",children:[e.jsx("span",{className:"mfa-secret-label",children:"Or enter this key manually:"}),e.jsxs("div",{className:"mfa-secret-value",children:[e.jsx("code",{children:m}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:T,"aria-label":"Copy secret key",children:D?e.jsx(ga,{size:14}):e.jsx(sr,{size:14})})]})]}),e.jsxs("div",{className:"mfa-verify-section",children:[e.jsx("label",{htmlFor:"mfa-verify-code",children:"Enter the 6-digit code from your app:"}),e.jsxs("div",{className:"mfa-code-input",children:[e.jsx("input",{id:"mfa-verify-code",type:"text",value:x,onChange:E=>b(E.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",maxLength:6,autoFocus:!0,inputMode:"numeric",pattern:"[0-9]*"}),e.jsx("button",{className:"btn btn-primary",onClick:O,disabled:x.length!==6||h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(Zt,{size:14,className:"spinner"})," Verifying..."]}):"Verify & Enable"})]}),N&&e.jsx("p",{className:"mfa-error",children:N})]}),e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>a("overview"),children:"Cancel"})]}),o==="success"&&e.jsxs("div",{className:"mfa-success",children:[e.jsx(at,{size:48,className:"text-success"}),e.jsx("h4",{children:"MFA Enabled"}),e.jsx("p",{children:"Your account is now protected with two-factor authentication."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>a("overview"),children:"Done"})]})]})}function vi({contractValue:s=0,changeOrderValue:n=0,progressPercent:o=0,actualCosts:a=0,startDate:t,endDate:l,areas:i=[]}){const r=s+n,m=o/100*r,u=gi(r,t,l),c=a,j=c>0?m/c:1,x=u>0?m/u:1,b=m-c,h=m-u,p=j>0?r/j:r*2,D=Math.max(0,p-c),F=r-p,N=r-m,$=r-c,v=$>0?N/$:999,C=bi(t,l,x),O=Ni(j,x);return{bac:r,earnedValue:m,plannedValue:u,actualCost:c,cpi:Ze(j,2),spi:Ze(x,2),costVariance:b,scheduleVariance:h,eac:Math.round(p),etc:Math.round(D),vac:Math.round(F),tcpi:Ze(v,2),projectedEndDate:C,percentScheduled:fi(t,l),percentComplete:o,healthStatus:O,cpiLabel:yi(j),spiLabel:wi(x),budgetUtilization:r>0?Ze(c/r*100,1):0,earnedPercent:r>0?Ze(m/r*100,1):0}}function gi(s,n,o){if(!n||!o)return 0;const a=new Date(n),t=new Date(o),l=new Date,i=t-a;if(i<=0)return s;const r=l-a;return Math.min(1,Math.max(0,r/i))*s}function fi(s,n){if(!s||!n)return 0;const o=new Date(s),a=new Date(n),t=new Date,l=a-o;if(l<=0)return 100;const i=t-o;return Ze(Math.min(100,Math.max(0,i/l*100)),1)}function bi(s,n,o){if(!s||!n||o<=0)return null;const a=new Date(s),i=(new Date(n)-a)/(1e3*60*60*24)/o;return new Date(a.getTime()+i*24*60*60*1e3).toISOString().split("T")[0]}function Ni(s,n){return s>=.95&&n>=.95?"healthy":s>=.85&&n>=.85?"watch":s>=.7&&n>=.7?"warning":"critical"}function yi(s){return s>=1.05?"Under Budget":s>=.95?"On Budget":s>=.85?"Slightly Over":"Over Budget"}function wi(s){return s>=1.05?"Ahead of Schedule":s>=.95?"On Schedule":s>=.85?"Slightly Behind":"Behind Schedule"}function Ze(s,n){const o=Math.pow(10,n);return Math.round(s*o)/o}function Ci({contractValue:s=0,changeOrderValue:n=0,progressPercent:o=0,actualCosts:a=0,startDate:t,endDate:l}){if(!t||!l)return[];const i=s+n,r=new Date(t),m=new Date(l),u=new Date,c=Math.max(1,(m-r)/(1e3*60*60*24)),j=[],x=Math.min(12,Math.ceil(c/7));for(let b=0;b<=x;b++){const h=b/x,p=new Date(r.getTime()+h*(m-r)),D=p.toLocaleDateString("en-US",{month:"short",day:"numeric"}),F=Math.round(h*i),N=p<=u,$=b===x||N&&b===x-1,v={date:D,plannedValue:F};if(N||$){const C=Math.min(1,(p-r)/(u-r));v.earnedValue=Math.round(C*(o/100)*i),v.actualCost=Math.round(C*a)}j.push(v)}return j}function ki({contractValue:s=0,changeOrderValue:n=0,progressPercent:o=0,actualCosts:a=0,startDate:t,endDate:l,areas:i=[]}){const r=d.useMemo(()=>vi({contractValue:s,changeOrderValue:n,progressPercent:o,actualCosts:a,startDate:t,endDate:l,areas:i}),[s,n,o,a,t,l,i]),m=d.useMemo(()=>Ci({contractValue:s,changeOrderValue:n,progressPercent:o,actualCosts:a,startDate:t,endDate:l}),[s,n,o,a,t,l]),u={healthy:"#10b981",watch:"#f59e0b",warning:"#f97316",critical:"#ef4444"},c=u[r.healthStatus]||u.watch;return e.jsxs("div",{className:"ev-card",children:[e.jsxs("div",{className:"ev-card-header",children:[e.jsxs("div",{className:"ev-card-title",children:[e.jsx(sa,{size:18}),e.jsx("h3",{children:"Earned Value Analysis"})]}),e.jsx("span",{className:"ev-health-badge",style:{background:`${c}18`,color:c,borderColor:`${c}40`},children:r.healthStatus==="healthy"?"Healthy":r.healthStatus==="watch"?"Watch":r.healthStatus==="warning"?"Warning":"Critical"})]}),e.jsxs("div",{className:"ev-indices-row",children:[e.jsxs("div",{className:"ev-index-card",children:[e.jsxs("div",{className:"ev-index-header",children:[e.jsx(es,{size:14}),e.jsx("span",{children:"CPI"})]}),e.jsx("div",{className:"ev-index-value",style:{color:r.cpi>=.95?"#10b981":r.cpi>=.85?"#f59e0b":"#ef4444"},children:r.cpi.toFixed(2)}),e.jsx("div",{className:"ev-index-label",children:r.cpiLabel})]}),e.jsxs("div",{className:"ev-index-card",children:[e.jsxs("div",{className:"ev-index-header",children:[e.jsx(dt,{size:14}),e.jsx("span",{children:"SPI"})]}),e.jsx("div",{className:"ev-index-value",style:{color:r.spi>=.95?"#10b981":r.spi>=.85?"#f59e0b":"#ef4444"},children:r.spi.toFixed(2)}),e.jsx("div",{className:"ev-index-label",children:r.spiLabel})]}),e.jsxs("div",{className:"ev-index-card",children:[e.jsxs("div",{className:"ev-index-header",children:[r.vac>=0?e.jsx(ns,{size:14}):e.jsx(rs,{size:14}),e.jsx("span",{children:"EAC"})]}),e.jsx("div",{className:"ev-index-value",children:ae(r.eac)}),e.jsx("div",{className:"ev-index-label",children:"Est. at Completion"})]}),e.jsxs("div",{className:"ev-index-card",children:[e.jsxs("div",{className:"ev-index-header",children:[e.jsx(sa,{size:14}),e.jsx("span",{children:"ETC"})]}),e.jsx("div",{className:"ev-index-value",children:ae(r.etc)}),e.jsx("div",{className:"ev-index-label",children:"Est. to Complete"})]})]}),e.jsxs("div",{className:"ev-variance-row",children:[e.jsxs("div",{className:`ev-variance-item ${r.costVariance>=0?"positive":"negative"}`,children:[e.jsx("span",{className:"ev-variance-label",children:"Cost Variance"}),e.jsxs("span",{className:"ev-variance-value",children:[r.costVariance>=0?"+":"",ae(r.costVariance)]})]}),e.jsxs("div",{className:`ev-variance-item ${r.scheduleVariance>=0?"positive":"negative"}`,children:[e.jsx("span",{className:"ev-variance-label",children:"Schedule Variance"}),e.jsxs("span",{className:"ev-variance-value",children:[r.scheduleVariance>=0?"+":"",ae(r.scheduleVariance)]})]}),e.jsxs("div",{className:`ev-variance-item ${r.vac>=0?"positive":"negative"}`,children:[e.jsx("span",{className:"ev-variance-label",children:"Variance at Completion"}),e.jsxs("span",{className:"ev-variance-value",children:[r.vac>=0?"+":"",ae(r.vac)]})]})]}),m.length>0&&e.jsx("div",{className:"ev-chart-container",children:e.jsx(Is,{width:"100%",height:220,children:e.jsxs(pr,{data:m,margin:{top:8,right:8,left:0,bottom:0},children:[e.jsx(ht,{dataKey:"date",tick:{fontSize:11,fill:"var(--text-secondary)"},tickLine:!1,axisLine:{stroke:"var(--border-color)"}}),e.jsx(pt,{tickFormatter:ze,tick:{fontSize:11,fill:"var(--text-secondary)"},tickLine:!1,axisLine:!1,width:55}),e.jsx(qs,{formatter:j=>ae(j),contentStyle:Os.contentStyle,labelStyle:Os.labelStyle}),e.jsx(Vs,{iconType:"line",wrapperStyle:{fontSize:11,paddingTop:4}}),e.jsx(nt,{type:"monotone",dataKey:"plannedValue",stroke:G.contract,strokeDasharray:"5 5",strokeWidth:2,dot:!1,name:"Planned Value"}),e.jsx(nt,{type:"monotone",dataKey:"earnedValue",stroke:G.revenue,strokeWidth:2,dot:!1,name:"Earned Value",connectNulls:!1}),e.jsx(nt,{type:"monotone",dataKey:"actualCost",stroke:G.costs,strokeWidth:2,dot:!1,name:"Actual Cost",connectNulls:!1})]})})}),r.projectedEndDate&&l&&e.jsxs("div",{className:"ev-projection-row",children:[e.jsxs("div",{className:"ev-projection-item",children:[e.jsx("span",{className:"ev-projection-label",children:"Planned End"}),e.jsx("span",{className:"ev-projection-value",children:new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),e.jsxs("div",{className:"ev-projection-item",children:[e.jsx("span",{className:"ev-projection-label",children:"Projected End"}),e.jsx("span",{className:"ev-projection-value",style:{color:r.spi>=.95?"#10b981":"#f59e0b"},children:new Date(r.projectedEndDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),r.tcpi>1.1&&e.jsxs("div",{className:"ev-projection-alert",children:[e.jsx(Fe,{size:14}),e.jsxs("span",{children:["Need CPI of ",r.tcpi.toFixed(2)," to finish on budget"]})]})]})]})}const _i=d.lazy(()=>oe(()=>import("./ShareModal-BP8gCt2-.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),Si=d.lazy(()=>oe(()=>import("./NotificationSettings-CrxKwqzM.js"),__vite__mapDeps([8,1,2,3,4,5,6,7]))),Di=d.lazy(()=>oe(()=>import("./CORForm-Dj-thhUe.js"),__vite__mapDeps([9,1,2,3,4,5,6,7,10]))),Ri=d.lazy(()=>oe(()=>import("./CORDetail-DHrvtIrO.js"),__vite__mapDeps([11,1,2,3,4,5,6,7,10,12,13]))),Ei=d.lazy(()=>oe(()=>import("./CORLog-BV_Xgni8.js").then(s=>s.a),__vite__mapDeps([14,3,1,2,4,5,6,7,10]))),Ti=d.lazy(()=>oe(()=>import("./DrawRequestModal-BGKjHwIK.js"),__vite__mapDeps([15,1,2,3,4,5,6,7,10]))),Fi=d.lazy(()=>oe(()=>import("./EquipmentModal-ByW3uRS8.js"),__vite__mapDeps([16,1,2,3,4,5,6,7]))),Mi=d.lazy(()=>oe(()=>import("./AddCostModal-BB-cNloE.js"),__vite__mapDeps([17,1,5]))),$i=d.lazy(()=>oe(()=>import("./DocumentsTab-BVOYY6Ef.js"),__vite__mapDeps([18,1,2,3,4,5,6,7]))),Pi=d.lazy(()=>oe(()=>import("./CORLogPreview-DZRloOYn.js"),__vite__mapDeps([19,1,2,3,4,5,6,7,10]))),Ai=d.lazy(()=>oe(()=>import("./CORList-zM-0oK9y.js"),__vite__mapDeps([20,3,1,2,4,5,6,7,10,14]))),Oi=d.lazy(()=>oe(()=>import("./TMList-DWX3-xaq.js"),__vite__mapDeps([21,3,1,2,4,5,6,7,13,10]))),Li=d.lazy(()=>oe(()=>import("./BillingCenter-CtHqLAFW.js"),__vite__mapDeps([22,1,2,3,4,5,6,7,10]))),zi=d.lazy(()=>oe(()=>import("./PhotoTimeline-tjwCqI49.js"),__vite__mapDeps([23,1,2,3,4,5,6,7]))),Ii=d.lazy(()=>oe(()=>import("./index-BIaaQ6dM.js").then(s=>s.P),__vite__mapDeps([2,1,3,4,5,6,7])));function qi({company:s,user:n,isAdmin:o,onShowToast:a,navigateToProjectId:t,onProjectNavigated:l}){const[i,r]=d.useState([]),[m,u]=d.useState([]),[c,j]=d.useState(null),[x,b]=d.useState([]),[h,p]=d.useState(!0),[D,F]=d.useState(!1),[N,$]=d.useState(!1),[v,C]=d.useState("overview"),[O,L]=d.useState("overview"),[T,S]=d.useState(!0),[E,V]=d.useState(!1),[A,B]=d.useState(!1),[R,se]=d.useState("list"),[P,re]=d.useState("preview"),[ue,le]=d.useState([]),[_e,M]=d.useState(!1),[g,y]=d.useState(null),[K,_]=d.useState(!1),[J,Y]=d.useState(null),[ee,Se]=d.useState(0),[Je,Ee]=d.useState(!1),[X,Ye]=d.useState(!1),[Z,je]=d.useState(!1),[gs,ve]=d.useState(null),[fs,bs]=d.useState(0),[Ca,Ns]=d.useState(!1),[vt,ys]=d.useState(null),[ka,_a]=d.useState(0),{isOpen:Sa,setIsOpen:Da,close:Ra}=Ar(),{portfolioMetrics:Ea,projectHealth:Ta,scheduleMetrics:Fa,riskAnalysis:Te}=Sr(m),{editMode:Ma,editData:he,saving:gt,handleEditClick:ft,handleCancelEdit:bt,handleEditChange:we,handleAreaEditChange:Nt,handleAddArea:$a,handleRemoveArea:Pa,handleSaveEdit:Aa,handleDeleteProject:Oa}=Dr({selectedProject:c,areas:x,company:s,onShowToast:a,loadAreas:Gs,setSelectedProject:j}),ls=d.useRef(null),ws=d.useRef(!1),Ws=d.useRef(!1),Hs=d.useRef(new Map),yt=300*1e3,me=d.useCallback((w={})=>{const{refreshAreas:z=!1,refreshCOR:W=!1,projectId:Q=null}=w;z&&Q&&(ws.current=Q),W&&(Ws.current=!0),ls.current&&clearTimeout(ls.current),ls.current=setTimeout(async()=>{ws.current&&(await Gs(ws.current),ws.current=!1),Ws.current&&(Se(de=>de+1),Ws.current=!1),await cs()},150)},[]);d.useEffect(()=>()=>{ls.current&&clearTimeout(ls.current)},[]),d.useEffect(()=>{s?.id&&(cs(),Ia())},[s?.id]);const La=d.useRef([]),za=i.map(w=>w.id).sort().join(",");d.useEffect(()=>{if(!s?.id||i.length===0)return;const w=i.map(W=>W.id).sort();La.current=w;const z=I.subscribeToCompanyActivity?.(s.id,w,{onMessage:()=>me(),onMaterialRequest:()=>me(),onTMTicket:()=>me(),onCrewCheckin:()=>me(),onAreaUpdate:()=>me(),onCORChange:()=>me({refreshCOR:!0}),onInjuryReport:()=>me(),onProjectChange:()=>me(),onMaterialsEquipmentChange:()=>me(),onLaborRateChange:()=>me()});return()=>{z&&I.unsubscribe?.(z)}},[s?.id,za,me]),d.useEffect(()=>(E?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[E]);const Ia=async()=>{try{const w=await I.getDumpSites(s.id);le(w||[])}catch(w){console.error("Error loading dump sites:",w)}},wt=d.useRef(null);d.useEffect(()=>{if(t&&t!==wt.current&&i.length>0){const w=i.find(z=>z.id===t);w&&(wt.current=t,j(w),l?.())}},[t,i,l]),d.useEffect(()=>{if(c){Gs(c.id);const w=[],z=c.id,W=I.subscribeToAreas?.(z,()=>{me({refreshAreas:!0,projectId:z})});W&&w.push(W);const Q=I.subscribeToDailyReports?.(z,()=>{me()});Q&&w.push(Q);const de=I.subscribeToCrewCheckins?.(z,()=>{me()});de&&w.push(de);const ge=I.subscribeToHaulOffs?.(z,()=>{me()});ge&&w.push(ge);const $e=I.subscribeToCORs?.(z,()=>{me({refreshCOR:!0})});return $e&&w.push($e),()=>{w.forEach(pe=>I.unsubscribe?.(pe))}}},[c,me]),d.useEffect(()=>{O==="tickets"&&re("full")},[O]);const qa=async(w,z=!1)=>{const W=w.id,Q=Hs.current.get(W);if(Q&&!z&&Date.now()-Q.timestamp<yt)return Q.data;try{const[de,ge,$e,pe,fe,Ce,qe,_s,k,H,ce,Pe]=await Promise.all([be(()=>I.getAreas(w.id),{fallback:[],context:{operation:"getAreas",projectId:w.id}}),be(()=>I.getTMTickets(w.id),{fallback:[],context:{operation:"getTMTickets",projectId:w.id}}),be(()=>I.getChangeOrderTotals(w.id),{fallback:null,context:{operation:"getChangeOrderTotals",projectId:w.id}}),be(()=>I.getDailyReports(w.id,100),{fallback:[],context:{operation:"getDailyReports",projectId:w.id}}),be(()=>I.getInjuryReports(w.id),{fallback:[],context:{operation:"getInjuryReports",projectId:w.id}}),be(()=>I.calculateManDayCosts(w.id,s?.id,w.work_type||"demolition",w.job_type||"standard"),{fallback:null,context:{operation:"calculateManDayCosts",projectId:w.id}}),be(()=>I.calculateHaulOffCosts(w.id),{fallback:null,context:{operation:"calculateHaulOffCosts",projectId:w.id}}),be(()=>I.getProjectCosts(w.id),{fallback:[],context:{operation:"getProjectCosts",projectId:w.id}}),be(()=>I.getCORStats(w.id),{fallback:null,context:{operation:"getCORStats",projectId:w.id}}),be(()=>I.getCrewCheckinHistory(w.id,60),{fallback:[],context:{operation:"getCrewCheckinHistory",projectId:w.id}}),be(()=>I.getMaterialRequests(w.id),{fallback:[],context:{operation:"getMaterialRequests",projectId:w.id}}),be(()=>I.getWeeklyDisposalSummary(w.id,4),{fallback:[],context:{operation:"getWeeklyDisposalSummary",projectId:w.id}})]),ke=Xt(de),Ks=ke.progress,It=$e?.totalApprovedValue||0,qt=w.contract_value+It,Ss=ke.isValueBased?ke.earnedValue:Ks/100*qt,pn=ge.filter(U=>U.status==="pending").length,Js=new Date;Js.setDate(Js.getDate()-7);const xn=pe.filter(U=>new Date(U.report_date)>=Js).length,Vt=_s.reduce((U,te)=>{const Qe=parseFloat(te.amount);return U+(isNaN(Qe)?0:Qe)},0);let Ds=0;const Rs={};ge.forEach(U=>{const te=U.work_date||U.ticket_date||U.created_at?.split("T")[0],Qe=U.t_and_m_items||U.items||[];let Es=0;Qe.forEach(st=>{const Tn=parseFloat(st.quantity)||1,Fn=parseFloat(st.unit_cost)||parseFloat(st.materials_equipment?.cost_per_unit)||0;Es+=Tn*Fn}),Es>0&&te&&(Ds+=Es,Rs[te]||(Rs[te]={date:te,cost:0}),Rs[te].cost+=Es)});const Bt=Object.values(Rs).sort((U,te)=>new Date(te.date)-new Date(U.date)),Ys=Ce?.totalCost||0,jn=qe?.totalCost||0,Ut=Ys+Ds+Vt,Wt=Ss-Ut,vn=Ss>0?Wt/Ss*100:0,Ht=Ce?.byDate?.length||0,gn=Bt.length,Qs=Math.max(Ht,gn),Gt=Ys+Ds,fn=Qs>0?Gt/Qs:0,Ae=In({...w,progress:Ks},Ce?.totalManDays||0),Ve={},Kt=new Set;(H||[]).forEach(U=>{const te=U.workers||[];Ve[U.check_in_date]=te.length,te.forEach(Qe=>Kt.add(Qe.name?.toLowerCase()))});const Oe=Object.keys(Ve).sort(),bn=Oe.length>0?Math.round(Oe.reduce((U,te)=>U+Ve[te],0)/Oe.length*10)/10:0,Nn=Oe.length>0?Math.max(...Oe.map(U=>Ve[U])):0,Xs=Oe.slice(-7),Zs=Oe.slice(-14,-7),Jt=Xs.length>0?Xs.reduce((U,te)=>U+Ve[te],0)/Xs.length:0,et=Zs.length>0?Zs.reduce((U,te)=>U+Ve[te],0)/Zs.length:0,yn=(ce||[]).filter(U=>U.status==="pending").length,wn=(ce||[]).filter(U=>U.status==="ordered").length,Cn=(ce||[]).filter(U=>U.status==="delivered").length,kn=(ce||[]).filter(U=>U.priority==="urgent"&&U.status==="pending").length,_n=pe.filter(U=>U.issues&&U.issues.trim().length>0).length,Sn=ge.reduce((U,te)=>U+(te.photos?.length||0),0),Dn=(Pe||[]).reduce((U,te)=>U+(te.concrete||0)+(te.trash||0)+(te.metals||0)+(te.hazardous_waste||0),0),Yt=fe.length>0?new Date(fe[0]?.incident_date||fe[0]?.created_at):null,Rn=Yt?Math.floor((new Date-Yt)/(1e3*60*60*24)):null,En=de.filter(U=>U.status==="done"),Qt={...w,areas:de,progress:Ks,billable:Ss,changeOrderValue:It,revisedContractValue:qt,changeOrderPending:$e?.pendingCount||0,totalTickets:ge.length,pendingTickets:pn,approvedTickets:ge.filter(U=>U.status==="approved").length,tmTickets:ge,dailyReportsCount:pe.length,recentDailyReports:xn,injuryReportsCount:fe.length,lastDailyReport:pe[0]?.report_date||null,isValueBased:ke.isValueBased,earnedValue:ke.earnedValue,totalSOVValue:ke.totalValue,laborCost:Ys,laborDaysWorked:Ht,laborManDays:Ce?.totalManDays||0,laborByDate:Ce?.byDate||[],dailyBurn:fn,materialsEquipmentCost:Ds,materialsEquipmentByDate:Bt,haulOffCost:jn,haulOffLoads:qe?.totalLoads||0,haulOffDays:qe?.daysWithHaulOff||0,haulOffByType:qe?.byWasteType||{},haulOffByDate:qe?.byDate||[],customCosts:_s,customCostTotal:Vt,totalBurn:Gt,totalBurnDays:Qs,allCostsTotal:Ut,currentProfit:Wt,profitMargin:vn,corPendingValue:k?.total_pending_value||0,corPendingCount:k?.pending_count||0,corApprovedValue:k?.total_approved_value||0,corBilledValue:k?.total_billed_value||0,corTotalCount:k?.total_cors||0,corStats:k,scheduleStatus:Ae.scheduleStatus,scheduleVariance:Ae.scheduleVariance,scheduleLabel:Ae.scheduleLabel,laborStatus:Ae.laborStatus,laborVariance:Ae.laborVariance,laborLabel:Ae.laborLabel,hasScheduleData:Ae.hasScheduleData,hasLaborData:Ae.hasLaborData,actualManDays:Ce?.totalManDays||0,crewHistory:H||[],crewByDate:Ve,uniqueWorkerCount:Kt.size,avgCrewSize:bn,peakCrewSize:Nn,crewDaysTracked:Oe.length,crewTrend:et>0?(Jt-et)/et*100:0,recentCrewAvg:Jt,materialRequests:ce||[],pendingMaterialRequests:yn,orderedMaterialRequests:wn,deliveredMaterialRequests:Cn,urgentMaterialRequests:kn,totalMaterialRequests:(ce||[]).length,reportsWithIssues:_n,totalPhotosFromTickets:Sn,dailyReports:pe,weeklyDisposal:Pe||[],disposalTotalLoads:Dn,daysSinceLastInjury:Rn,injuryReports:fe,oshaRecordable:fe.filter(U=>U.osha_recordable).length,completedAreasCount:En.length,hasError:!1,_detailsLoaded:!0};return Hs.current.set(W,{data:Qt,timestamp:Date.now()}),Qt}catch(de){return console.error(`Error loading details for project ${w.id}:`,de),{...w,hasError:!0,_detailsLoaded:!1}}},cs=async()=>{try{const w=await I.getProjectDashboardSummary(s?.id);r(w);const z=w.map(W=>{const Q=Hs.current.get(W.id);if(Q&&Date.now()-Q.timestamp<yt)return Q.data;const de=W.areaCount||0,ge=W.completedAreas||0,$e=de>0?Math.round(ge/de*100):0;return{...W,progress:$e,areas:[],totalTickets:W.ticketCount||0,pendingTickets:W.pendingTicketCount||0,approvedTickets:W.approvedTicketCount||0,dailyReportsCount:W.dailyReportsThisWeek||0,recentDailyReports:W.dailyReportsThisWeek||0,corTotalCount:W.corCount||0,billable:0,changeOrderValue:0,revisedContractValue:W.contract_value||0,changeOrderPending:0,tmTickets:[],injuryReportsCount:0,lastDailyReport:null,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,materialsEquipmentCost:0,materialsEquipmentByDate:[],haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corStats:null,scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1,actualManDays:0,hasError:!1,_detailsLoaded:!1}});u(z)}catch(w){console.error("Error loading projects:",w),a("Error loading projects","error")}finally{p(!1)}};async function Gs(w){try{const z=await I.getAreas(w);b(z)}catch(z){console.error("Error loading areas:",z)}}const Cs=async w=>{if(j(w),!w._detailsLoaded){const z=await qa(w);u(W=>W.map(Q=>Q.id===w.id?z:Q)),j(z)}},Va=()=>{j(null),b([]),bt(),C("overview"),cs()},f=d.useMemo(()=>c?m.find(w=>w.id===c.id):null,[c,m]),Ba=d.useMemo(()=>{if(!c)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const w=Xt(x),z=w.progress,W=f?.changeOrderValue||0,Q=c.contract_value+W,de=w.isValueBased?w.earnedValue:z/100*Q;return{progress:z,billable:de,changeOrderValue:W,revisedContractValue:Q,isValueBased:w.isValueBased,earnedValue:w.earnedValue,totalSOVValue:w.totalValue}},[c,x,f]),Ua=d.useCallback(({target:w,projectId:z,alert:W})=>{const Q=i.find(de=>de.id===z);Q&&(j(Q),w==="financials"?C("financials"):w==="reports"?C("reports"):w==="cors"?(C("financials"),L("cors")):C("overview"))},[i]);d.useEffect(()=>{const w=async()=>{for(const z of m)if(On(z,30))try{await I.archiveProject(z.id),a(`Project "${z.name}" has been auto-archived after 30 days of completion`,"info")}catch(W){console.error("Failed to auto-archive project:",W)}};m.length>0&&w()},[]);const Wa=d.useCallback(()=>{ve(null),je(!0)},[]),Ha=d.useCallback(w=>{ve(w),je(!0)},[]),Ga=d.useCallback(()=>{ys(null),Ns(!0)},[]),Ka=d.useCallback(w=>{ys(w),Ns(!0)},[]),Ja=d.useCallback(()=>{re("full")},[]),Ya=d.useCallback(()=>{S(w=>!w)},[]),Qa=d.useCallback(()=>{V(w=>!w)},[]),Ct=d.useCallback(()=>{V(!1)},[]),kt=d.useCallback(()=>{B(w=>!w)},[]),ks=d.useCallback(async(w="all")=>{if(c){a("Gathering field data...","info");try{const[z,W,Q]=await Promise.all([I.getDailyReports(c.id,365),I.getInjuryReports(c.id),I.getCrewCheckinHistory(c.id,365)]);w==="daily"?await Rr(z||[],c):w==="incidents"?await Er(W||[],c):w==="crew"?await Tr(Q||[],c):await Fr({dailyReports:z||[],incidentReports:W||[],crewCheckins:Q||[],project:c}),a("PDF exported!","success")}catch(z){console.error("Error exporting field documents:",z),a("Error generating PDF","error")}}},[c,a]),Xa=d.useCallback(()=>{re("preview")},[]),Za=d.useCallback(()=>{se("log")},[]),_t=d.useCallback(()=>{y(null),M(!0)},[]),en=d.useCallback(w=>{Y(w),_(!0)},[]),sn=d.useCallback(w=>{y(w),M(!0)},[]),tn=d.useCallback(()=>{Ee(!0)},[]),an=d.useCallback(async w=>{try{await I.deleteProjectCost(w),cs(),a?.("Cost deleted","success")}catch{a?.("Error deleting cost","error")}},[]),nn=d.useMemo(()=>({corCount:f?.corStats?.total||0,ticketCount:f?.totalTickets||0,corPending:f?.corStats?.pending||0,ticketPending:f?.pendingTickets||0}),[f?.corStats?.total,f?.totalTickets,f?.corStats?.pending,f?.pendingTickets]),{totalOriginalContract:rn,totalChangeOrders:St,totalPortfolioValue:ln,totalEarned:cn,totalRemaining:on,weightedCompletion:dn,totalPendingCORValue:mn,totalPendingCORCount:Dt}=Ea,{projectsComplete:Rt,projectsOnTrack:Et,projectsAtRisk:Tt,projectsOverBudget:Ft,projectsWithChangeOrders:Mt}=Ta,{scheduleAhead:$t,scheduleOnTrack:Pt,scheduleBehind:At,laborOver:Ot,laborUnder:Lt,laborOnTrack:zt,hasAnyScheduleData:un,hasAnyLaborData:hn}=Fa;if(h)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(c){const{progress:w,billable:z,changeOrderValue:W,revisedContractValue:Q,isValueBased:de,earnedValue:ge,totalSOVValue:$e}=Ba;if(Ma&&he){const k=he.areas.reduce((H,ce)=>H+(parseFloat(ce.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:bt,style:{marginBottom:"1.5rem"},children:"← Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:he.name,onChange:H=>we("name",H.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:he.job_number,onChange:H=>we("job_number",H.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:he.address,onChange:H=>we("address",H.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:he.general_contractor,onChange:H=>we("general_contractor",H.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:he.client_contact,onChange:H=>we("client_contact",H.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:he.client_phone,onChange:H=>we("client_phone",H.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:he.contract_value,onChange:H=>we("contract_value",H.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:he.pin,onChange:H=>we("pin",H.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:he.work_type,onChange:H=>we("work_type",H.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:he.job_type,onChange:H=>we("job_type",H.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:he.default_dump_site_id,onChange:H=>we("default_dump_site_id",H.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),ue.map(H=>e.jsx("option",{value:H.id,children:H.name},H.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),he.areas.map((H,ce)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:H.name,onChange:Pe=>Nt(ce,"name",Pe.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:H.weight,onChange:Pe=>Nt(ce,"weight",Pe.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>Pa(ce),children:"×"})]},ce)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${k===100?"valid":"invalid"}`,children:[k,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:$a,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:Aa,disabled:gt,style:{flex:1},children:gt?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:Oa,children:"Delete Project"})]})}const pe=x.filter(k=>k.status==="done").length,fe=x.filter(k=>k.status==="working").length,Ce=x.filter(k=>k.status==="not_started").length,qe=(f?.pendingTickets||0)+(f?.changeOrderPending||0),_s=[{id:"overview",label:"Overview",Icon:ta},{id:"financials",label:"Financials",Icon:es,badge:qe},{id:"reports",label:"Reports",Icon:xe},{id:"documents",label:"Documents",Icon:ct},{id:"info",label:"Info",Icon:As}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:Va,children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>F(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>$(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:ft,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:c.name}),(c.job_number||c.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[c.job_number&&`Job #${c.job_number}`,c.job_number&&c.work_type&&" • ",c.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[w,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:ae(z)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:ae(Q-z)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:_s.map(k=>e.jsxs("button",{className:`pv-tab ${v===k.id?"active":""} ${k.badge>0?"has-badge":""}`,onClick:()=>C(k.id),children:[e.jsx(k.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:k.label}),k.badge>0&&e.jsx("span",{className:"pv-tab-badge",children:k.badge})]},k.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[v==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab animate-fade-in",children:[e.jsxs("div",{className:"overview-hero-split",children:[e.jsx(zr,{progress:w,areasComplete:pe,totalAreas:x.length,areasWorking:fe}),e.jsx(qr,{earnedRevenue:z,totalCosts:f?.allCostsTotal||0,laborCost:f?.laborCost||0,disposalCost:f?.haulOffCost||0,equipmentCost:f?.materialsEquipmentCost||0,materialsCost:0,otherCost:f?.customCostTotal||0,contractValue:Q})]}),e.jsxs("div",{className:"overview-two-col",children:[e.jsx(Br,{project:c,onShowToast:a}),e.jsxs("div",{className:"overview-section-card overview-work-areas-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[pe>0&&e.jsxs("span",{className:"section-badge done",children:[pe," Done"]}),fe>0&&e.jsxs("span",{className:"section-badge working",children:[fe," Active"]}),Ce>0&&e.jsxs("span",{className:"section-badge pending",children:[Ce," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list work-areas-scroll stagger-areas",children:x.map(k=>e.jsxs("div",{className:`work-area-item ${k.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[k.status==="done"&&e.jsx("span",{className:"status-icon done",children:"✓"}),k.status==="working"&&e.jsx("span",{className:"status-icon working",children:"●"}),k.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:"○"})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:k.name}),e.jsx("span",{className:"work-area-weight",children:k.scheduled_value?ae(k.scheduled_value):`${k.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${k.status}`,style:{width:k.status==="done"?"100%":k.status==="working"?"50%":"0%"}})})]},k.id))})]})]}),c?.contract_value>0&&e.jsx(ki,{contractValue:c.contract_value,changeOrderValue:W,progressPercent:w,actualCosts:f?.allCostsTotal||0,startDate:c.start_date,endDate:c.end_date,areas:x}),(f?.pendingTickets>0||f?.changeOrderPending>0||f?.pendingMaterialRequests>0||f?.urgentMaterialRequests>0)&&e.jsxs("div",{className:"overview-needs-attention",children:[e.jsxs("div",{className:"overview-needs-attention__header",children:[e.jsx(Fe,{size:15,className:"overview-needs-attention__icon"}),e.jsx("span",{className:"overview-needs-attention__title",children:"Needs Attention"}),e.jsx("span",{className:"overview-needs-attention__count",children:[f?.urgentMaterialRequests>0,!f?.urgentMaterialRequests&&f?.pendingMaterialRequests>0,f?.pendingTickets>0,f?.changeOrderPending>0].filter(Boolean).length})]}),e.jsxs("div",{className:"overview-needs-attention__items",children:[f?.urgentMaterialRequests>0&&e.jsxs("button",{className:"overview-needs-attention__item overview-needs-attention__item--warning",onClick:()=>C("reports"),children:[e.jsx(Fe,{size:14,className:"overview-needs-attention__item-icon"}),e.jsxs("span",{className:"overview-needs-attention__item-label",children:[f.urgentMaterialRequests," urgent material request",f.urgentMaterialRequests!==1?"s":""]}),e.jsx(ms,{size:13,className:"overview-needs-attention__item-arrow"})]}),f?.pendingMaterialRequests>0&&!f?.urgentMaterialRequests&&e.jsxs("button",{className:"overview-needs-attention__item overview-needs-attention__item--info",onClick:()=>C("reports"),children:[e.jsx(Ps,{size:14,className:"overview-needs-attention__item-icon"}),e.jsxs("span",{className:"overview-needs-attention__item-label",children:[f.pendingMaterialRequests," material request",f.pendingMaterialRequests!==1?"s":""," pending"]}),e.jsx(ms,{size:13,className:"overview-needs-attention__item-arrow"})]}),f?.pendingTickets>0&&e.jsxs("button",{className:"overview-needs-attention__item overview-needs-attention__item--warning",onClick:()=>C("financials"),children:[e.jsx(xe,{size:14,className:"overview-needs-attention__item-icon"}),e.jsxs("span",{className:"overview-needs-attention__item-label",children:[f.pendingTickets," T&M ticket",f.pendingTickets!==1?"s":""," need approval"]}),e.jsx(ms,{size:13,className:"overview-needs-attention__item-arrow"})]}),f?.changeOrderPending>0&&e.jsxs("button",{className:"overview-needs-attention__item overview-needs-attention__item--info",onClick:()=>C("financials"),children:[e.jsx(ss,{size:14,className:"overview-needs-attention__item-icon"}),e.jsxs("span",{className:"overview-needs-attention__item-label",children:[f.changeOrderPending," change order",f.changeOrderPending!==1?"s":""," pending"]}),e.jsx(ms,{size:13,className:"overview-needs-attention__item-arrow"})]})]})]}),e.jsxs("div",{className:"overview-two-col",children:[e.jsx(d.Suspense,{fallback:e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:"Loading photos..."}),children:e.jsx(zi,{projectId:c?.id,areas:x,onShowToast:a})}),e.jsx(d.Suspense,{fallback:e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:"Loading punch list..."}),children:e.jsx(Ii,{projectId:c?.id,areas:x,companyId:s?.id,onShowToast:a})})]}),e.jsx("div",{className:"overview-bottom-strip",children:e.jsxs("div",{className:"overview-quick-actions",children:[e.jsxs("button",{className:"overview-action-btn",onClick:()=>C("reports"),children:[e.jsx(xe,{size:15}),e.jsxs("span",{children:[f?.dailyReportsCount||0," Reports"]})]}),e.jsxs("button",{className:"overview-action-btn",onClick:()=>C("financials"),children:[e.jsx(es,{size:15}),e.jsxs("span",{children:[f?.totalTickets||0," T&M Tickets"]})]}),e.jsx("span",{className:"overview-action-divider"}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>ks("all"),children:[e.jsx(We,{size:15}),e.jsx("span",{children:"Export All"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>ks("daily"),children:[e.jsx(We,{size:14}),e.jsx("span",{children:"Daily"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>ks("incidents"),children:[e.jsx(We,{size:14}),e.jsx("span",{children:"Incidents"})]}),e.jsxs("button",{className:"overview-action-btn export",onClick:()=>ks("crew"),children:[e.jsx(We,{size:14}),e.jsx("span",{children:"Crew"})]})]})})]}),v==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsxs("div",{className:"export-actions",style:{display:"flex",gap:"8px",marginLeft:"auto",marginBottom:"12px",justifyContent:"flex-end"},children:[e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>Mr(c,{earnedRevenue:z,approvedCORs:f?.cors?.filter(k=>k.status==="approved"),laborByDate:f?.laborByDate,haulOffByDate:f?.haulOffByDate,customCosts:f?.customCosts}),children:[e.jsx(We,{size:14})," Export CSV"]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:()=>$r(c,{totalLaborCost:f?.totalLaborCost||0,totalDisposalCost:f?.totalDisposalCost||0}),children:[e.jsx(We,{size:14})," QuickBooks"]})]}),e.jsx(Kr,{contractValue:c?.contract_value||0,earnedRevenue:z,totalCosts:f?.allCostsTotal||0,profit:f?.currentProfit||0,progress:w,corApprovedValue:W,loading:!f}),e.jsxs("div",{className:`financials-layout ${T?"sidebar-collapsed":""}`,children:[e.jsxs("button",{className:"financials-mobile-menu-toggle",onClick:Qa,"aria-label":"Open navigation menu",title:"Open navigation menu",children:[e.jsx(tr,{size:20}),e.jsx("span",{children:"Menu"})]}),E&&e.jsx("div",{className:"financials-sidebar-overlay",onClick:Ct,"aria-hidden":"true"}),e.jsx("div",{className:`financials-sidebar ${T?"collapsed":""} ${E?"mobile-open":""}`,children:e.jsx(Jr,{activeSection:O,onSectionChange:k=>{L(k),V(!1)},collapsed:T,onToggleCollapse:Ya,onMobileClose:Ct,stats:nn})}),e.jsxs("div",{className:"financials-main",children:[O==="overview"&&e.jsxs("div",{className:"financials-overview animate-fade-in",children:[e.jsx(ei,{projectData:f,project:c,tmTickets:f?.tmTickets||[],corStats:f?.corStats,areas:x}),e.jsxs("div",{className:"financials-analysis-row stagger-children",children:[e.jsx(di,{dailyBurn:f?.dailyBurn||0,totalBurn:f?.totalBurn||0,daysWorked:f?.totalBurnDays||0,laborCost:f?.laborCost||0,materialsEquipmentCost:f?.materialsEquipmentCost||0,progress:w,contractValue:Q,laborByDate:f?.laborByDate||[],materialsEquipmentByDate:f?.materialsEquipmentByDate||[]}),e.jsx(ti,{revenue:z,totalCosts:f?.allCostsTotal||0,contractValue:Q,progress:w})]}),e.jsxs("div",{className:"cost-disposal-row",children:[e.jsx(ai,{laborCost:f?.laborCost||0,haulOffCost:f?.haulOffCost||0,customCosts:f?.customCosts||[],onAddCost:tn,onDeleteCost:an}),e.jsx(ri,{project:c,period:"week"})]}),e.jsx(ii,{project:c,onAddEquipment:Wa,onEditEquipment:Ha,onShowToast:a},fs),e.jsx(li,{project:c,areas:x,corStats:f?.corStats,onCreateDraw:Ga,onViewDraw:Ka,onShowToast:a},ka),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(He,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:ae(f?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(ci,{project:c,company:s,onShowToast:a})})]})]}),O==="cors"&&e.jsxs("div",{className:"financials-cors animate-fade-in",children:[e.jsx("div",{className:"financials-section cor-section-primary",children:e.jsx(d.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Pi,{project:c,onShowToast:a,onToggleList:kt,showingList:A,onViewFullLog:Za,onCreateCOR:_t})})}),A&&e.jsx("div",{className:"financials-section cor-section-list animate-fade-in",style:{marginTop:"1rem"},children:e.jsx(d.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Ai,{project:c,company:s,areas:x,refreshKey:ee,onShowToast:a,previewMode:!1,onViewAll:kt,onDisplayModeChange:se,onCreateCOR:_t,onViewCOR:en,onEditCOR:sn})})})]}),O==="tickets"&&e.jsx("div",{className:"financials-tickets animate-fade-in",children:e.jsxs("div",{className:"financials-section tm-section",children:[P==="full"&&e.jsx("button",{className:"section-back-btn",onClick:Xa,children:"← Back to summary"}),e.jsx(d.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Oi,{project:c,company:s,onShowToast:a,compact:P==="preview",previewMode:P==="preview",onViewAll:Ja})})]})}),O==="billing"&&e.jsx("div",{className:"financials-billing animate-fade-in",children:e.jsx(d.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(Li,{project:c,company:s,user:n,onShowToast:a})})})]})]})]}),v==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(xe,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:f?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:f?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((f?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:f?.totalTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"T&M Tickets"}),(f?.pendingTickets||0)>0&&e.jsxs("div",{className:"reports-metric-status",style:{background:"#fef3c7",color:"#92400e"},children:[f.pendingTickets," pending"]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:f?.totalPhotosFromTickets||0}),e.jsx("div",{className:"reports-metric-label",children:"Photos Captured"})]})]})}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsx("div",{className:"reports-insight-header",children:e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Re,{size:18}),e.jsx("h3",{children:"Crew Analytics"})]})}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:f?.uniqueWorkerCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Workers"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:f?.avgCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Avg Crew / Day"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:f?.peakCrewSize||0}),e.jsx("span",{className:"reports-stat-label",children:"Peak Crew Size"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:f?.crewDaysTracked||0}),e.jsx("span",{className:"reports-stat-label",children:"Days Tracked"})]})]}),(f?.crewTrend||0)!==0&&e.jsxs("div",{className:`reports-trend-badge ${f.crewTrend>0?"up":"down"}`,children:[f.crewTrend>0?e.jsx(ns,{size:14}):e.jsx(rs,{size:14}),e.jsxs("span",{children:[Math.abs(Math.round(f.crewTrend)),"% ",f.crewTrend>0?"increase":"decrease"," vs prior week"]})]}),f?.crewByDate&&Object.keys(f.crewByDate).length>0&&e.jsxs("div",{className:"reports-mini-chart",children:[e.jsx("div",{className:"reports-mini-chart-label",children:"Recent Crew Size"}),e.jsx("div",{className:"reports-mini-bars",children:Object.keys(f.crewByDate).sort().slice(-14).map(k=>{const H=f.crewByDate[k],ce=f.peakCrewSize||1;return e.jsx("div",{className:"reports-mini-bar-wrap",title:`${new Date(k+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}: ${H} workers`,children:e.jsx("div",{className:"reports-mini-bar",style:{height:`${H/ce*100}%`}})},k)})})]})]})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(mt,{size:18}),e.jsx("h3",{children:"Safety Dashboard"})]}),e.jsx("span",{className:`reports-section-badge ${(f?.injuryReportsCount||0)>0?"warning":"success"}`,children:(f?.injuryReportsCount||0)>0?`${f.injuryReportsCount} incident${f.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsxs("div",{className:"reports-insight-body",children:[e.jsx("div",{className:"reports-safety-hero",children:e.jsxs("div",{className:`reports-safety-days ${f?.daysSinceLastInjury===null||f?.daysSinceLastInjury>30?"excellent":f?.daysSinceLastInjury>7?"good":"caution"}`,children:[e.jsx("span",{className:"reports-safety-days-value",children:f?.daysSinceLastInjury!==null?f.daysSinceLastInjury:"--"}),e.jsx("span",{className:"reports-safety-days-label",children:f?.daysSinceLastInjury!==null?"Days Since Last Incident":"No Incidents Recorded"})]})}),e.jsxs("div",{className:"reports-stat-grid",children:[e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:f?.injuryReportsCount||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Incidents"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:f?.oshaRecordable||0}),e.jsx("span",{className:"reports-stat-label",children:"OSHA Recordable"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:f?.reportsWithIssues||0}),e.jsx("span",{className:"reports-stat-label",children:"Reports w/ Issues"})]}),e.jsxs("div",{className:"reports-stat",children:[e.jsx("span",{className:"reports-stat-value",children:f?.laborManDays||0}),e.jsx("span",{className:"reports-stat-label",children:"Total Man-Days"})]})]})]})]})]}),e.jsxs("div",{className:"reports-two-col",children:[e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Ps,{size:18}),e.jsx("h3",{children:"Material Requests"})]}),e.jsxs("span",{className:"reports-section-count",children:[f?.totalMaterialRequests||0," total"]})]}),e.jsx("div",{className:"reports-insight-body",children:(f?.totalMaterialRequests||0)===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Ps,{size:32}),e.jsx("p",{children:"No material requests yet"}),e.jsx("span",{children:"Requests from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-material-pipeline",children:[f?.urgentMaterialRequests>0&&e.jsxs("div",{className:"reports-material-status urgent",children:[e.jsx(Fe,{size:14}),e.jsxs("span",{children:[f.urgentMaterialRequests," Urgent"]})]}),e.jsxs("div",{className:"reports-material-status pending",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[f?.pendingMaterialRequests||0," Pending"]})]}),e.jsxs("div",{className:"reports-material-status ordered",children:[e.jsx("span",{className:"reports-material-dot"}),e.jsxs("span",{children:[f?.orderedMaterialRequests||0," Ordered"]})]}),e.jsxs("div",{className:"reports-material-status delivered",children:[e.jsx(ar,{size:14}),e.jsxs("span",{children:[f?.deliveredMaterialRequests||0," Delivered"]})]})]}),e.jsx("div",{className:"reports-recent-list",children:(f?.materialRequests||[]).slice(0,3).map(k=>e.jsxs("div",{className:`reports-recent-item ${k.status}`,children:[e.jsxs("div",{className:"reports-recent-item-main",children:[e.jsx("span",{className:`reports-recent-item-status ${k.status}`,children:k.status}),e.jsx("span",{className:"reports-recent-item-date",children:new Date(k.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"reports-recent-item-detail",children:[(k.items||[]).slice(0,2).map((H,ce)=>e.jsxs("span",{children:[H.name,H.quantity?` (${H.quantity})`:""]},ce)),(k.items||[]).length>2&&e.jsxs("span",{className:"reports-recent-more",children:["+",(k.items||[]).length-2," more"]})]}),k.priority==="urgent"&&e.jsx("span",{className:"reports-urgent-tag",children:"URGENT"})]},k.id))})]})})]}),e.jsxs("div",{className:"reports-insight-card",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(Ge,{size:18}),e.jsx("h3",{children:"Disposal Trends"})]}),e.jsxs("span",{className:"reports-section-count",children:[f?.disposalTotalLoads||0," loads"]})]}),e.jsx("div",{className:"reports-insight-body",children:(f?.weeklyDisposal||[]).length===0?e.jsxs("div",{className:"reports-empty-state",children:[e.jsx(Ge,{size:32}),e.jsx("p",{children:"No disposal data yet"}),e.jsx("span",{children:"Disposal loads from the field will appear here"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"reports-disposal-chart",children:[e.jsx("div",{className:"reports-disposal-bars",children:(f?.weeklyDisposal||[]).map((k,H)=>{const ce=(k.concrete||0)+(k.trash||0)+(k.metals||0)+(k.hazardous_waste||0),Pe=Math.max(...(f?.weeklyDisposal||[]).map(ke=>(ke.concrete||0)+(ke.trash||0)+(ke.metals||0)+(ke.hazardous_waste||0)))||1;return e.jsxs("div",{className:"reports-disposal-bar-col",children:[e.jsxs("div",{className:"reports-disposal-bar-stack",style:{height:`${ce/Pe*100}%`},children:[k.concrete>0&&e.jsx("div",{className:"reports-disposal-seg concrete",style:{flex:k.concrete},title:`Concrete: ${k.concrete}`}),k.trash>0&&e.jsx("div",{className:"reports-disposal-seg trash",style:{flex:k.trash},title:`Trash: ${k.trash}`}),k.metals>0&&e.jsx("div",{className:"reports-disposal-seg metals",style:{flex:k.metals},title:`Metals: ${k.metals}`}),k.hazardous_waste>0&&e.jsx("div",{className:"reports-disposal-seg hazardous",style:{flex:k.hazardous_waste},title:`Hazardous: ${k.hazardous_waste}`})]}),e.jsx("span",{className:"reports-disposal-bar-label",children:new Date(k.week+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})})]},H)})}),e.jsxs("div",{className:"reports-disposal-legend",children:[e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot concrete"}),"Concrete"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot trash"}),"Trash"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot metals"}),"Metals"]}),e.jsxs("span",{className:"reports-disposal-legend-item",children:[e.jsx("span",{className:"reports-disposal-dot hazardous"}),"Hazardous"]})]})]}),(f?.haulOffCost||0)>0&&e.jsxs("div",{className:"reports-disposal-cost",children:[e.jsx("span",{children:"Total Disposal Cost"}),e.jsx("strong",{children:ae(f.haulOffCost)})]})]})})]})]}),e.jsxs("div",{className:"reports-insight-card reports-activity-summary",children:[e.jsxs("div",{className:"reports-insight-header",children:[e.jsxs("div",{className:"reports-insight-title",children:[e.jsx(xe,{size:18}),e.jsx("h3",{children:"Field Activity Summary"})]}),e.jsx("div",{className:"reports-activity-badges",children:f?.lastDailyReport&&e.jsxs("span",{className:"reports-last-filed",children:["Last report: ",new Date(f.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"})," ","(",Math.floor((new Date-new Date(f.lastDailyReport))/(1e3*60*60*24)),"d ago)"]})})]}),e.jsx("div",{className:"reports-insight-body",children:e.jsxs("div",{className:"reports-activity-grid",children:[e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(xe,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:f?.dailyReportsCount||0}),e.jsx("span",{children:"Daily Reports Filed"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(ss,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:f?.totalTickets||0}),e.jsx("span",{children:"T&M Tickets Created"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(nr,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:f?.totalPhotosFromTickets||0}),e.jsx("span",{children:"Photos Documented"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(He,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsxs("strong",{children:[f?.completedAreasCount||0,"/",x.length]}),e.jsx("span",{children:"Work Areas Complete"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(es,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:ae(f?.allCostsTotal||0)}),e.jsx("span",{children:"Total Costs Tracked"})]})]}),e.jsxs("div",{className:"reports-activity-stat",children:[e.jsx("div",{className:"reports-activity-stat-icon",children:e.jsx(Re,{size:16})}),e.jsxs("div",{className:"reports-activity-stat-info",children:[e.jsx("strong",{children:f?.laborManDays||0}),e.jsx("span",{children:"Total Man-Days"})]})]})]})})]}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(xe,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[f?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(d.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(ui,{project:c,company:s,onShowToast:a})})})]}),e.jsxs("div",{className:`reports-section-card ${(f?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(f?.injuryReportsCount||0)>0?"warning":"success"}`,children:(f?.injuryReportsCount||0)>0?"⚠":"✓"}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(f?.injuryReportsCount||0)>0?"warning":"success"}`,children:(f?.injuryReportsCount||0)>0?`${f.injuryReportsCount} incident${f.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(d.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx(pi,{project:c,companyId:s?.id||c?.company_id,company:s,user:n,onShowToast:a})})})]})]}),v==="documents"&&e.jsx("div",{className:"pv-tab-panel documents-tab",children:e.jsx(d.Suspense,{fallback:e.jsx(Be,{}),children:e.jsx($i,{project:c,companyId:s?.id||c?.company_id,onShowToast:a,userRole:n?.access_level||"office"})})}),v==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:c.name}),c.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",c.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:ft,children:e.jsx("span",{children:"Edit Project"})})]}),c.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(rr,{size:14}),e.jsx("span",{children:c.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(He,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:c.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(ss,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:c.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(es,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:ae(Q)}),e.jsx("span",{className:"info-quick-label",children:W>0?`Incl. +${ae(W)} COs`:"Contract Value"})]})]}),c.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:c.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(ir,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[c.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:c.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),c.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:c.client_contact})]}),c.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(lr,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${c.client_phone}`,className:"info-detail-value link",children:c.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(ta,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[pe>0&&e.jsxs("span",{className:"info-badge done",children:[pe," Done"]}),fe>0&&e.jsxs("span",{className:"info-badge working",children:[fe," Active"]}),Ce>0&&e.jsxs("span",{className:"info-badge pending",children:[Ce," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:x.map(k=>e.jsxs("div",{className:`info-area-item ${k.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[k.status==="done"&&e.jsx("span",{className:"status-dot done",children:"✓"}),k.status==="working"&&e.jsx("span",{className:"status-dot working",children:"●"}),k.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:"○"})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:k.name}),e.jsx("span",{className:`info-area-status-label ${k.status}`,children:k.status==="done"?"Complete":k.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[k.weight,"%"]})]},k.id))})]}),e.jsx(xi,{project:c,company:s,user:n,isAdmin:o,onShowToast:a}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(As,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:ae(c.contract_value)})]}),W>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",ae(W)]})]}),c.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:ue.find(k=>k.id===c.default_dump_site_id)?.name||"Unknown"})]})]})]}),e.jsx("div",{className:"info-section-card",children:e.jsx(ji,{onShowToast:a})})]})]}),D&&e.jsx(d.Suspense,{fallback:null,children:e.jsx(_i,{project:c,user:n,onClose:()=>F(!1),onShareCreated:k=>{a("Share link created successfully!","success")}})}),N&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(d.Suspense,{fallback:null,children:e.jsx(Si,{project:c,company:s,onShowToast:a,onClose:()=>$(!1)})})}),_e&&e.jsx(d.Suspense,{fallback:null,children:e.jsx(Di,{project:c,company:s,areas:x,existingCOR:g,onClose:()=>{M(!1),y(null)},onSaved:()=>{M(!1),y(null),Se(k=>k+1)},onShowToast:a})}),K&&J&&e.jsx(d.Suspense,{fallback:null,children:e.jsx(Ri,{cor:J,project:c,company:s,areas:x,onClose:()=>{_(!1),Y(null)},onEdit:k=>{_(!1),Y(null),y(k),M(!0)},onShowToast:a,onStatusChange:()=>{}})}),R==="log"&&c&&e.jsx("div",{className:"cor-log-modal-overlay",onClick:()=>se("list"),children:e.jsxs("div",{className:"cor-log-modal",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"cor-log-modal-header",children:[e.jsx("h2",{children:"Change Order Log"}),e.jsx("button",{className:"cor-log-modal-close",onClick:()=>se("list"),title:"Close",children:"✕"})]}),e.jsx("div",{className:"cor-log-modal-content",children:e.jsx(d.Suspense,{fallback:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading..."}),children:e.jsx(Ei,{project:c,company:s,onShowToast:a})})})]})}),Je&&e.jsx(d.Suspense,{fallback:null,children:e.jsx(Mi,{onClose:()=>Ee(!1),saving:X,onSave:async k=>{try{Ye(!0),await I.addProjectCost(c.id,s.id,k),Ee(!1),cs(),a("Cost added successfully","success")}catch(H){console.error("Error adding cost:",H),a("Error adding cost","error")}finally{Ye(!1)}}})}),Z&&e.jsx(d.Suspense,{fallback:null,children:e.jsx(Fi,{project:c,company:s,user:n,editItem:gs,onSave:()=>{je(!1),ve(null),bs(k=>k+1),a(gs?"Equipment updated":"Equipment added","success")},onClose:()=>{je(!1),ve(null)}})}),Ca&&e.jsx(d.Suspense,{fallback:null,children:e.jsx(Ti,{project:c,company:s,areas:x,corStats:m.find(k=>k.id===c?.id)?.corStats,editDrawRequest:vt,onSave:()=>{Ns(!1),ys(null),_a(k=>k+1),a(vt?"Draw request updated":"Draw request created","success")},onClose:()=>{Ns(!1),ys(null)}})})]})}return i.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(xe,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("button",{className:"search-trigger-btn",onClick:()=>Da(!0),children:[e.jsx(ja,{size:16}),e.jsx("span",{children:"Search"}),e.jsx("span",{className:"shortcut",children:"⌘K"})]}),e.jsxs("div",{className:"bo-project-count",children:[i.length," Active Project",i.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(dn,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:ae(cn)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:ae(ln)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:ae(on)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),St>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:ae(rn)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",Mt," project",Mt!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",ae(St)]})]})]}),Dt>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:ae(mn)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",Dt," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[Rt>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:Rt}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),Et>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:Et}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),Tt>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:Tt}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),Ft>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:Ft}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),un&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[$t>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:$t}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),Pt>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:Pt}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),At>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:At}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),hn&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),Lt>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[Lt," under"]}),zt>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[zt," on track"]}),Ot>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[Ot," over"]})]})]})]}),Te.allAlerts.length>0&&e.jsxs("div",{className:`smart-alerts-section${Te.criticalCount>0?" smart-alerts-section--has-critical":Te.allAlerts.some(w=>w.type==="warning")?" smart-alerts-section--has-warning":""}`,children:[e.jsxs("div",{className:"smart-alerts-header",children:[e.jsxs("div",{className:"smart-alerts-header__left",children:[e.jsx(Fe,{className:"smart-alerts-header__icon",size:18}),e.jsx("h3",{className:"smart-alerts-header__title",children:"Needs Attention"})]}),Te.criticalCount>0?e.jsxs("span",{className:"smart-alerts-count-badge smart-alerts-count-badge--critical",children:[Te.criticalCount," critical"]}):e.jsxs("span",{className:"smart-alerts-count-badge smart-alerts-count-badge--warning",children:[Te.allAlerts.length," item",Te.allAlerts.length!==1?"s":""]})]}),e.jsx(Or,{alerts:Te.allAlerts,onAction:Ua,maxVisible:3})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[i.length," active"]})]}),e.jsx("div",{className:"project-list",children:m.map(w=>{const z=Te.projectRisks.find(W=>W.projectId===w.id);return e.jsx(Vi,{project:w,riskScore:z?.riskScore,riskStatus:z?.riskStatus,onClick:()=>Cs(w)},w.id)})}),e.jsx(Pr,{isOpen:Sa,onClose:Ra,companyId:s?.id,onSelectProject:w=>{Cs(w)},onSelectTicket:w=>{const z=i.find(W=>W.id===w.project_id);z&&(Cs(z),C("financials"),L("tickets"))},onSelectCOR:w=>{const z=i.find(W=>W.id===w.project_id);z&&(Cs(z),C("financials"),L("cors"),Y(w),_(!0))},onShowToast:a})]})}function Vi({project:s,riskScore:n,riskStatus:o,onClick:a}){const t=Ln(s.areas||[]),l=zn(s.areas||[]),i=s.contract_value-s.billable,r=s.billable>s.contract_value*.9&&s.progress<90,m={healthy:{bg:"var(--status-success-bg, #064e3b)",color:"var(--status-success, #059669)"},warning:{bg:"var(--status-warning-bg, #78350f)",color:"var(--status-warning, #d97706)"},critical:{bg:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"}},u=m[o]||m.healthy;return e.jsxs("div",{className:`project-card enhanced ${r?"at-risk":""}`,onClick:a,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[typeof n=="number"&&e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"50%",fontSize:"0.75rem",fontWeight:700,background:u.bg,color:u.color},title:`Risk Score: ${n}`,"aria-label":`Risk score ${n}, ${o}`,children:n}),e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:s.name}),e.jsx("div",{className:"project-card-value",children:ae(s.contract_value)})]})]}),e.jsx("span",{className:`status-badge ${t}`,children:l})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[s.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:ae(s.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${i<0?"negative":""}`,children:ae(Math.abs(i))}),e.jsx("span",{className:"stat-label",children:i>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${s.progress}%`}})}),(s.pendingTickets>0||s.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[s.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[s.pendingTickets," Pending T&M"]}),s.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[s.approvedTickets," Approved T&M"]})]}),s.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${s.scheduleStatus}`,children:s.scheduleLabel}),s.hasLaborData&&s.laborLabel&&e.jsx("span",{className:`labor-indicator ${s.laborStatus}`,children:s.laborLabel})]})]})}const Xi=Object.freeze(Object.defineProperty({__proto__:null,default:qi},Symbol.toStringTag,{value:"Module"}));export{Qi as C,Xi as D,Be as T,Wr as a,Yi as b,Ji as e};
//# sourceMappingURL=Dashboard-BNKOiQvY.js.map
