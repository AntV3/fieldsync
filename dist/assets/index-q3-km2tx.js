const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SignatureLinkGenerator-BZ7lrPvF.js","assets/icons-CYyh5fNc.js","assets/react-DXGY7bZi.js","assets/pdf-ChZ1zkDw.js","assets/supabase-VuevzHjS.js","assets/TMClientSignature-DK3rvw9b.js","assets/Dashboard--rMfOrwH.js","assets/xlsx-BvJTHLik.js","assets/corCalculations-DEvfBtaB.js","assets/Setup-B9tx7_z2.js","assets/BrandingSettings-CacmWlwj.js","assets/PricingManager-Djx3V_Iy.js","assets/PublicView-DpuF1TC1.js","assets/SignaturePage-CyUCLw_n.js","assets/MembershipManager-oTgnc-E1.js"])))=>i.map(i=>d[i]);
import{r as w,H as un,B as hg,S as pg,M as gg,T as Pc,C as Dc,G as _g,F as ji,a as pi,Z as Xc,b as yg,c as Tc,d as Ma,L as Zs,e as vg,f as Ac,g as bg,R as jg,U as Sg,W as xg,P as Oc,h as Hm,i as wg,j as Ng,k as Eg,l as Vc,m as Lm,n as kc,X as Cg,o as qg,p as Dg,q as Tg,I as Ag,s as Og,t as Bm,u as kg}from"./icons-CYyh5fNc.js";import{r as zg,b as Mg,a as Rg}from"./react-DXGY7bZi.js";import{_ as dn}from"./pdf-ChZ1zkDw.js";import{c as ah}from"./supabase-VuevzHjS.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const f of d)if(f.type==="childList")for(const p of f.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&c(p)}).observe(document,{childList:!0,subtree:!0});function i(d){const f={};return d.integrity&&(f.integrity=d.integrity),d.referrerPolicy&&(f.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?f.credentials="include":d.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function c(d){if(d.ep)return;d.ep=!0;const f=i(d);fetch(d.href,f)}})();var zc={exports:{}},Ks={};var Ym;function Ug(){if(Ym)return Ks;Ym=1;var r=Symbol.for("react.transitional.element"),l=Symbol.for("react.fragment");function i(c,d,f){var p=null;if(f!==void 0&&(p=""+f),d.key!==void 0&&(p=""+d.key),"key"in d){f={};for(var y in d)y!=="key"&&(f[y]=d[y])}else f=d;return d=f.ref,{$$typeof:r,type:c,key:p,ref:d!==void 0?d:null,props:f}}return Ks.Fragment=l,Ks.jsx=i,Ks.jsxs=i,Ks}var Gm;function Hg(){return Gm||(Gm=1,zc.exports=Ug()),zc.exports}var s=Hg(),Mc={exports:{}},Js={},Rc={exports:{}},Uc={};var Qm;function Lg(){return Qm||(Qm=1,(function(r){function l(D,Q){var W=D.length;D.push(Q);e:for(;0<W;){var be=W-1>>>1,Y=D[be];if(0<d(Y,Q))D[be]=Q,D[W]=Y,W=be;else break e}}function i(D){return D.length===0?null:D[0]}function c(D){if(D.length===0)return null;var Q=D[0],W=D.pop();if(W!==Q){D[0]=W;e:for(var be=0,Y=D.length,ye=Y>>>1;be<ye;){var J=2*(be+1)-1,he=D[J],Ne=J+1,K=D[Ne];if(0>d(he,W))Ne<Y&&0>d(K,he)?(D[be]=K,D[Ne]=W,be=Ne):(D[be]=he,D[J]=W,be=J);else if(Ne<Y&&0>d(K,W))D[be]=K,D[Ne]=W,be=Ne;else break e}}return Q}function d(D,Q){var W=D.sortIndex-Q.sortIndex;return W!==0?W:D.id-Q.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var f=performance;r.unstable_now=function(){return f.now()}}else{var p=Date,y=p.now();r.unstable_now=function(){return p.now()-y}}var S=[],z=[],k=1,M=null,F=3,P=!1,$=!1,Z=!1,oe=!1,ee=typeof setTimeout=="function"?setTimeout:null,me=typeof clearTimeout=="function"?clearTimeout:null,de=typeof setImmediate<"u"?setImmediate:null;function se(D){for(var Q=i(z);Q!==null;){if(Q.callback===null)c(z);else if(Q.startTime<=D)c(z),Q.sortIndex=Q.expirationTime,l(S,Q);else break;Q=i(z)}}function Se(D){if(Z=!1,se(D),!$)if(i(S)!==null)$=!0,Me||(Me=!0,U());else{var Q=i(z);Q!==null&&ve(Se,Q.startTime-D)}}var Me=!1,Ve=-1,Te=5,Ae=-1;function it(){return oe?!0:!(r.unstable_now()-Ae<Te)}function Le(){if(oe=!1,Me){var D=r.unstable_now();Ae=D;var Q=!0;try{e:{$=!1,Z&&(Z=!1,me(Ve),Ve=-1),P=!0;var W=F;try{t:{for(se(D),M=i(S);M!==null&&!(M.expirationTime>D&&it());){var be=M.callback;if(typeof be=="function"){M.callback=null,F=M.priorityLevel;var Y=be(M.expirationTime<=D);if(D=r.unstable_now(),typeof Y=="function"){M.callback=Y,se(D),Q=!0;break t}M===i(S)&&c(S),se(D)}else c(S);M=i(S)}if(M!==null)Q=!0;else{var ye=i(z);ye!==null&&ve(Se,ye.startTime-D),Q=!1}}break e}finally{M=null,F=W,P=!1}Q=void 0}}finally{Q?U():Me=!1}}}var U;if(typeof de=="function")U=function(){de(Le)};else if(typeof MessageChannel<"u"){var re=new MessageChannel,ge=re.port2;re.port1.onmessage=Le,U=function(){ge.postMessage(null)}}else U=function(){ee(Le,0)};function ve(D,Q){Ve=ee(function(){D(r.unstable_now())},Q)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(D){D.callback=null},r.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Te=0<D?Math.floor(1e3/D):5},r.unstable_getCurrentPriorityLevel=function(){return F},r.unstable_next=function(D){switch(F){case 1:case 2:case 3:var Q=3;break;default:Q=F}var W=F;F=Q;try{return D()}finally{F=W}},r.unstable_requestPaint=function(){oe=!0},r.unstable_runWithPriority=function(D,Q){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var W=F;F=D;try{return Q()}finally{F=W}},r.unstable_scheduleCallback=function(D,Q,W){var be=r.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?be+W:be):W=be,D){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=W+Y,D={id:k++,callback:Q,priorityLevel:D,startTime:W,expirationTime:Y,sortIndex:-1},W>be?(D.sortIndex=W,l(z,D),i(S)===null&&D===i(z)&&(Z?(me(Ve),Ve=-1):Z=!0,ve(Se,W-be))):(D.sortIndex=Y,l(S,D),$||P||($=!0,Me||(Me=!0,U()))),D},r.unstable_shouldYield=it,r.unstable_wrapCallback=function(D){var Q=F;return function(){var W=F;F=Q;try{return D.apply(this,arguments)}finally{F=W}}}})(Uc)),Uc}var Xm;function Bg(){return Xm||(Xm=1,Rc.exports=Lg()),Rc.exports}var Vm;function Yg(){if(Vm)return Js;Vm=1;var r=Bg(),l=zg(),i=Mg();function c(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function d(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function f(e){var t=e,a=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(a=t.return),e=t.return;while(e)}return t.tag===3?a:null}function p(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function y(e){if(e.tag===31){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function S(e){if(f(e)!==e)throw Error(c(188))}function z(e){var t=e.alternate;if(!t){if(t=f(e),t===null)throw Error(c(188));return t!==e?null:e}for(var a=e,n=t;;){var o=a.return;if(o===null)break;var u=o.alternate;if(u===null){if(n=o.return,n!==null){a=n;continue}break}if(o.child===u.child){for(u=o.child;u;){if(u===a)return S(o),e;if(u===n)return S(o),t;u=u.sibling}throw Error(c(188))}if(a.return!==n.return)a=o,n=u;else{for(var m=!1,g=o.child;g;){if(g===a){m=!0,a=o,n=u;break}if(g===n){m=!0,n=o,a=u;break}g=g.sibling}if(!m){for(g=u.child;g;){if(g===a){m=!0,a=u,n=o;break}if(g===n){m=!0,n=u,a=o;break}g=g.sibling}if(!m)throw Error(c(189))}}if(a.alternate!==n)throw Error(c(190))}if(a.tag!==3)throw Error(c(188));return a.stateNode.current===a?e:t}function k(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e;for(e=e.child;e!==null;){if(t=k(e),t!==null)return t;e=e.sibling}return null}var M=Object.assign,F=Symbol.for("react.element"),P=Symbol.for("react.transitional.element"),$=Symbol.for("react.portal"),Z=Symbol.for("react.fragment"),oe=Symbol.for("react.strict_mode"),ee=Symbol.for("react.profiler"),me=Symbol.for("react.consumer"),de=Symbol.for("react.context"),se=Symbol.for("react.forward_ref"),Se=Symbol.for("react.suspense"),Me=Symbol.for("react.suspense_list"),Ve=Symbol.for("react.memo"),Te=Symbol.for("react.lazy"),Ae=Symbol.for("react.activity"),it=Symbol.for("react.memo_cache_sentinel"),Le=Symbol.iterator;function U(e){return e===null||typeof e!="object"?null:(e=Le&&e[Le]||e["@@iterator"],typeof e=="function"?e:null)}var re=Symbol.for("react.client.reference");function ge(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===re?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Z:return"Fragment";case ee:return"Profiler";case oe:return"StrictMode";case Se:return"Suspense";case Me:return"SuspenseList";case Ae:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case $:return"Portal";case de:return e.displayName||"Context";case me:return(e._context.displayName||"Context")+".Consumer";case se:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ve:return t=e.displayName||null,t!==null?t:ge(e.type)||"Memo";case Te:t=e._payload,e=e._init;try{return ge(e(t))}catch{}}return null}var ve=Array.isArray,D=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W={pending:!1,data:null,method:null,action:null},be=[],Y=-1;function ye(e){return{current:e}}function J(e){0>Y||(e.current=be[Y],be[Y]=null,Y--)}function he(e,t){Y++,be[Y]=e.current,e.current=t}var Ne=ye(null),K=ye(null),ce=ye(null),He=ye(null);function ae(e,t){switch(he(ce,t),he(K,e),he(Ne,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?im(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)t=im(t),e=om(t,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}J(Ne),he(Ne,e)}function we(){J(Ne),J(K),J(ce)}function Je(e){e.memoizedState!==null&&he(He,e);var t=Ne.current,a=om(t,e.type);t!==a&&(he(K,e),he(Ne,a))}function Re(e){K.current===e&&(J(Ne),J(K)),He.current===e&&(J(He),Gs._currentValue=W)}var nt,wt;function Xe(e){if(nt===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);nt=t&&t[1]||"",wt=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+nt+e+wt}var na=!1;function ot(e,t){if(!e||na)return"";na=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(t){var B=function(){throw Error()};if(Object.defineProperty(B.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(B,[])}catch(O){var A=O}Reflect.construct(e,[],B)}else{try{B.call()}catch(O){A=O}e.call(B.prototype)}}else{try{throw Error()}catch(O){A=O}(B=e())&&typeof B.catch=="function"&&B.catch(function(){})}}catch(O){if(O&&A&&typeof O.stack=="string")return[O.stack,A.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var o=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");o&&o.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var u=n.DetermineComponentFrameRoot(),m=u[0],g=u[1];if(m&&g){var b=m.split(`
`),C=g.split(`
`);for(o=n=0;n<b.length&&!b[n].includes("DetermineComponentFrameRoot");)n++;for(;o<C.length&&!C[o].includes("DetermineComponentFrameRoot");)o++;if(n===b.length||o===C.length)for(n=b.length-1,o=C.length-1;1<=n&&0<=o&&b[n]!==C[o];)o--;for(;1<=n&&0<=o;n--,o--)if(b[n]!==C[o]){if(n!==1||o!==1)do if(n--,o--,0>o||b[n]!==C[o]){var H=`
`+b[n].replace(" at new "," at ");return e.displayName&&H.includes("<anonymous>")&&(H=H.replace("<anonymous>",e.displayName)),H}while(1<=n&&0<=o);break}}}finally{na=!1,Error.prepareStackTrace=a}return(a=e?e.displayName||e.name:"")?Xe(a):""}function Nt(e,t){switch(e.tag){case 26:case 27:case 5:return Xe(e.type);case 16:return Xe("Lazy");case 13:return e.child!==t&&t!==null?Xe("Suspense Fallback"):Xe("Suspense");case 19:return Xe("SuspenseList");case 0:case 15:return ot(e.type,!1);case 11:return ot(e.type.render,!1);case 1:return ot(e.type,!0);case 31:return Xe("Activity");default:return""}}function pr(e){try{var t="",a=null;do t+=Nt(e,a),a=e,e=e.return;while(e);return t}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var mn=Object.prototype.hasOwnProperty,Qn=r.unstable_scheduleCallback,Ra=r.unstable_cancelCallback,hn=r.unstable_shouldYield,pn=r.unstable_requestPaint,vt=r.unstable_now,Ua=r.unstable_getCurrentPriorityLevel,Xn=r.unstable_ImmediatePriority,Vn=r.unstable_UserBlockingPriority,ra=r.unstable_NormalPriority,Ha=r.unstable_LowPriority,bt=r.unstable_IdlePriority,La=r.log,Zn=r.unstable_setDisableYieldValue,_a=null,Et=null;function te(e){if(typeof La=="function"&&Zn(e),Et&&typeof Et.setStrictMode=="function")try{Et.setStrictMode(_a,e)}catch{}}var Dt=Math.clz32?Math.clz32:gr,G=Math.log,Ir=Math.LN2;function gr(e){return e>>>=0,e===0?32:31-(G(e)/Ir|0)|0}var ya=256,gn=262144,dt=4194304;function ft(e){var t=e&42;if(t!==0)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Na(e,t,a){var n=e.pendingLanes;if(n===0)return 0;var o=0,u=e.suspendedLanes,m=e.pingedLanes;e=e.warmLanes;var g=n&134217727;return g!==0?(n=g&~u,n!==0?o=ft(n):(m&=g,m!==0?o=ft(m):a||(a=g&~e,a!==0&&(o=ft(a))))):(g=n&~u,g!==0?o=ft(g):m!==0?o=ft(m):a||(a=n&~e,a!==0&&(o=ft(a)))),o===0?0:t!==0&&t!==o&&(t&u)===0&&(u=o&-o,a=t&-t,u>=a||u===32&&(a&4194048)!==0)?t:o}function Ea(e,t){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)===0}function mt(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function V(){var e=dt;return dt<<=1,(dt&62914560)===0&&(dt=4194304),e}function Rt(e){for(var t=[],a=0;31>a;a++)t.push(e);return t}function va(e,t){e.pendingLanes|=t,t!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Ps(e,t,a,n,o,u){var m=e.pendingLanes;e.pendingLanes=a,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=a,e.entangledLanes&=a,e.errorRecoveryDisabledLanes&=a,e.shellSuspendCounter=0;var g=e.entanglements,b=e.expirationTimes,C=e.hiddenUpdates;for(a=m&~a;0<a;){var H=31-Dt(a),B=1<<H;g[H]=0,b[H]=-1;var A=C[H];if(A!==null)for(C[H]=null,H=0;H<A.length;H++){var O=A[H];O!==null&&(O.lane&=-536870913)}a&=~B}n!==0&&Is(e,n,0),u!==0&&o===0&&e.tag!==0&&(e.suspendedLanes|=u&~(m&~t))}function Is(e,t,a){e.pendingLanes|=t,e.suspendedLanes&=~t;var n=31-Dt(t);e.entangledLanes|=t,e.entanglements[n]=e.entanglements[n]|1073741824|a&261930}function _r(e,t){var a=e.entangledLanes|=t;for(e=e.entanglements;a;){var n=31-Dt(a),o=1<<n;o&t|e[n]&t&&(e[n]|=t),a&=~o}}function el(e,t){var a=t&-t;return a=(a&42)!==0?1:es(a),(a&(e.suspendedLanes|t))!==0?0:a}function es(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function ts(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function tl(){var e=Q.p;return e!==0?e:(e=window.event,e===void 0?32:Am(e.type))}function al(e,t){var a=Q.p;try{return Q.p=e,t()}finally{Q.p=a}}var Ca=Math.random().toString(36).slice(2),et="__reactFiber$"+Ca,Mt="__reactProps$"+Ca,_n="__reactContainer$"+Ca,qa="__reactEvents$"+Ca,xi="__reactListeners$"+Ca,wi="__reactHandles$"+Ca,Ba="__reactResources$"+Ca,Kn="__reactMarker$"+Ca;function yr(e){delete e[et],delete e[Mt],delete e[qa],delete e[xi],delete e[wi]}function Tt(e){var t=e[et];if(t)return t;for(var a=e.parentNode;a;){if(t=a[_n]||a[et]){if(a=t.alternate,t.child!==null||a!==null&&a.child!==null)for(e=pm(e);e!==null;){if(a=e[et])return a;e=pm(e)}return t}e=a,a=e.parentNode}return null}function Ya(e){if(e=e[et]||e[_n]){var t=e.tag;if(t===5||t===6||t===13||t===31||t===26||t===27||t===3)return e}return null}function Ga(e){var t=e.tag;if(t===5||t===26||t===27||t===6)return e.stateNode;throw Error(c(33))}function yn(e){var t=e[Ba];return t||(t=e[Ba]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function ht(e){e[Kn]=!0}var vr=new Set,nl={};function Qa(e,t){Ut(e,t),Ut(e+"Capture",t)}function Ut(e,t){for(nl[e]=t,e=0;e<t.length;e++)vr.add(t[e])}var rl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),sl={},as={};function vn(e){return mn.call(as,e)?!0:mn.call(sl,e)?!1:rl.test(e)?as[e]=!0:(sl[e]=!0,!1)}function ba(e,t,a){if(vn(t))if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var n=t.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){e.removeAttribute(t);return}}e.setAttribute(t,""+a)}}function ja(e,t,a){if(a===null)e.removeAttribute(t);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+a)}}function Ht(e,t,a,n){if(n===null)e.removeAttribute(a);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(a);return}e.setAttributeNS(t,a,""+n)}}function jt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Xa(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Da(e,t,a){var n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var o=n.get,u=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return o.call(this)},set:function(m){a=""+m,u.call(this,m)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return a},setValue:function(m){a=""+m},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Va(e){if(!e._valueTracker){var t=Xa(e)?"checked":"value";e._valueTracker=Da(e,t,""+e[t])}}function ll(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var a=t.getValue(),n="";return e&&(n=Xa(e)?e.checked?"true":"false":e.value),e=n,e!==a?(t.setValue(e),!0):!1}function sa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var ru=/[\n"\\]/g;function Lt(e){return e.replace(ru,function(t){return"\\"+t.charCodeAt(0).toString(16)+" "})}function Ta(e,t,a,n,o,u,m,g){e.name="",m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"?e.type=m:e.removeAttribute("type"),t!=null?m==="number"?(t===0&&e.value===""||e.value!=t)&&(e.value=""+jt(t)):e.value!==""+jt(t)&&(e.value=""+jt(t)):m!=="submit"&&m!=="reset"||e.removeAttribute("value"),t!=null?rs(e,m,jt(t)):a!=null?rs(e,m,jt(a)):n!=null&&e.removeAttribute("value"),o==null&&u!=null&&(e.defaultChecked=!!u),o!=null&&(e.checked=o&&typeof o!="function"&&typeof o!="symbol"),g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"?e.name=""+jt(g):e.removeAttribute("name")}function ns(e,t,a,n,o,u,m,g){if(u!=null&&typeof u!="function"&&typeof u!="symbol"&&typeof u!="boolean"&&(e.type=u),t!=null||a!=null){if(!(u!=="submit"&&u!=="reset"||t!=null)){Va(e);return}a=a!=null?""+jt(a):"",t=t!=null?""+jt(t):a,g||t===e.value||(e.value=t),e.defaultValue=t}n=n??o,n=typeof n!="function"&&typeof n!="symbol"&&!!n,e.checked=g?e.checked:!!n,e.defaultChecked=!!n,m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(e.name=m),Va(e)}function rs(e,t,a){t==="number"&&sa(e.ownerDocument)===e||e.defaultValue===""+a||(e.defaultValue=""+a)}function h(e,t,a,n){if(e=e.options,t){t={};for(var o=0;o<a.length;o++)t["$"+a[o]]=!0;for(a=0;a<e.length;a++)o=t.hasOwnProperty("$"+e[a].value),e[a].selected!==o&&(e[a].selected=o),o&&n&&(e[a].defaultSelected=!0)}else{for(a=""+jt(a),t=null,o=0;o<e.length;o++){if(e[o].value===a){e[o].selected=!0,n&&(e[o].defaultSelected=!0);return}t!==null||e[o].disabled||(t=e[o])}t!==null&&(t.selected=!0)}}function x(e,t,a){if(t!=null&&(t=""+jt(t),t!==e.value&&(e.value=t),a==null)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=a!=null?""+jt(a):""}function T(e,t,a,n){if(t==null){if(n!=null){if(a!=null)throw Error(c(92));if(ve(n)){if(1<n.length)throw Error(c(93));n=n[0]}a=n}a==null&&(a=""),t=a}a=jt(t),e.defaultValue=a,n=e.textContent,n===a&&n!==""&&n!==null&&(e.value=n),Va(e)}function q(e,t){if(t){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=t;return}}e.textContent=t}var R=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function X(e,t,a){var n=t.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?n?e.setProperty(t,""):t==="float"?e.cssFloat="":e[t]="":n?e.setProperty(t,a):typeof a!="number"||a===0||R.has(t)?t==="float"?e.cssFloat=a:e[t]=(""+a).trim():e[t]=a+"px"}function ue(e,t,a){if(t!=null&&typeof t!="object")throw Error(c(62));if(e=e.style,a!=null){for(var n in a)!a.hasOwnProperty(n)||t!=null&&t.hasOwnProperty(n)||(n.indexOf("--")===0?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="");for(var o in t)n=t[o],t.hasOwnProperty(o)&&a[o]!==n&&X(e,o,n)}else for(var u in t)t.hasOwnProperty(u)&&X(e,u,t[u])}function le(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Fe=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ue=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function St(e){return Ue.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Za(){}var Ni=null;function Ei(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var br=null,jr=null;function su(e){var t=Ya(e);if(t&&(e=t.stateNode)){var a=e[Mt]||null;e:switch(e=t.stateNode,t.type){case"input":if(Ta(e,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),t=a.name,a.type==="radio"&&t!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+Lt(""+t)+'"][type="radio"]'),t=0;t<a.length;t++){var n=a[t];if(n!==e&&n.form===e.form){var o=n[Mt]||null;if(!o)throw Error(c(90));Ta(n,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name)}}for(t=0;t<a.length;t++)n=a[t],n.form===e.form&&ll(n)}break e;case"textarea":x(e,a.value,a.defaultValue);break e;case"select":t=a.value,t!=null&&h(e,!!a.multiple,t,!1)}}}var Ci=!1;function lu(e,t,a){if(Ci)return e(t,a);Ci=!0;try{var n=e(t);return n}finally{if(Ci=!1,(br!==null||jr!==null)&&(Kl(),br&&(t=br,e=jr,jr=br=null,su(t),e)))for(t=0;t<e.length;t++)su(e[t])}}function ss(e,t){var a=e.stateNode;if(a===null)return null;var n=a[Mt]||null;if(n===null)return null;a=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(c(231,t,typeof a));return a}var Ka=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qi=!1;if(Ka)try{var ls={};Object.defineProperty(ls,"passive",{get:function(){qi=!0}}),window.addEventListener("test",ls,ls),window.removeEventListener("test",ls,ls)}catch{qi=!1}var bn=null,Di=null,il=null;function iu(){if(il)return il;var e,t=Di,a=t.length,n,o="value"in bn?bn.value:bn.textContent,u=o.length;for(e=0;e<a&&t[e]===o[e];e++);var m=a-e;for(n=1;n<=m&&t[a-n]===o[u-n];n++);return il=o.slice(e,1<n?1-n:void 0)}function ol(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function cl(){return!0}function ou(){return!1}function Yt(e){function t(a,n,o,u,m){this._reactName=a,this._targetInst=o,this.type=n,this.nativeEvent=u,this.target=m,this.currentTarget=null;for(var g in e)e.hasOwnProperty(g)&&(a=e[g],this[g]=a?a(u):u[g]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?cl:ou,this.isPropagationStopped=ou,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=cl)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=cl)},persist:function(){},isPersistent:cl}),t}var Jn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ul=Yt(Jn),is=M({},Jn,{view:0,detail:0}),fh=Yt(is),Ti,Ai,os,dl=M({},is,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ki,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==os&&(os&&e.type==="mousemove"?(Ti=e.screenX-os.screenX,Ai=e.screenY-os.screenY):Ai=Ti=0,os=e),Ti)},movementY:function(e){return"movementY"in e?e.movementY:Ai}}),cu=Yt(dl),mh=M({},dl,{dataTransfer:0}),hh=Yt(mh),ph=M({},is,{relatedTarget:0}),Oi=Yt(ph),gh=M({},Jn,{animationName:0,elapsedTime:0,pseudoElement:0}),_h=Yt(gh),yh=M({},Jn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),vh=Yt(yh),bh=M({},Jn,{data:0}),uu=Yt(bh),jh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xh={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wh(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=xh[e])?!!t[e]:!1}function ki(){return wh}var Nh=M({},is,{key:function(e){if(e.key){var t=jh[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=ol(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Sh[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ki,charCode:function(e){return e.type==="keypress"?ol(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ol(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Eh=Yt(Nh),Ch=M({},dl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),du=Yt(Ch),qh=M({},is,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ki}),Dh=Yt(qh),Th=M({},Jn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ah=Yt(Th),Oh=M({},dl,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),kh=Yt(Oh),zh=M({},Jn,{newState:0,oldState:0}),Mh=Yt(zh),Rh=[9,13,27,32],zi=Ka&&"CompositionEvent"in window,cs=null;Ka&&"documentMode"in document&&(cs=document.documentMode);var Uh=Ka&&"TextEvent"in window&&!cs,fu=Ka&&(!zi||cs&&8<cs&&11>=cs),mu=" ",hu=!1;function pu(e,t){switch(e){case"keyup":return Rh.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function gu(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Sr=!1;function Hh(e,t){switch(e){case"compositionend":return gu(t);case"keypress":return t.which!==32?null:(hu=!0,mu);case"textInput":return e=t.data,e===mu&&hu?null:e;default:return null}}function Lh(e,t){if(Sr)return e==="compositionend"||!zi&&pu(e,t)?(e=iu(),il=Di=bn=null,Sr=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return fu&&t.locale!=="ko"?null:t.data;default:return null}}var Bh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _u(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Bh[e.type]:t==="textarea"}function yu(e,t,a,n){br?jr?jr.push(n):jr=[n]:br=n,t=ei(t,"onChange"),0<t.length&&(a=new ul("onChange","change",null,a,n),e.push({event:a,listeners:t}))}var us=null,ds=null;function Yh(e){tm(e,0)}function fl(e){var t=Ga(e);if(ll(t))return e}function vu(e,t){if(e==="change")return t}var bu=!1;if(Ka){var Mi;if(Ka){var Ri="oninput"in document;if(!Ri){var ju=document.createElement("div");ju.setAttribute("oninput","return;"),Ri=typeof ju.oninput=="function"}Mi=Ri}else Mi=!1;bu=Mi&&(!document.documentMode||9<document.documentMode)}function Su(){us&&(us.detachEvent("onpropertychange",xu),ds=us=null)}function xu(e){if(e.propertyName==="value"&&fl(ds)){var t=[];yu(t,ds,e,Ei(e)),lu(Yh,t)}}function Gh(e,t,a){e==="focusin"?(Su(),us=t,ds=a,us.attachEvent("onpropertychange",xu)):e==="focusout"&&Su()}function Qh(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return fl(ds)}function Xh(e,t){if(e==="click")return fl(t)}function Vh(e,t){if(e==="input"||e==="change")return fl(t)}function Zh(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Kt=typeof Object.is=="function"?Object.is:Zh;function fs(e,t){if(Kt(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;for(n=0;n<a.length;n++){var o=a[n];if(!mn.call(t,o)||!Kt(e[o],t[o]))return!1}return!0}function wu(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Nu(e,t){var a=wu(e);e=0;for(var n;a;){if(a.nodeType===3){if(n=e+a.textContent.length,e<=t&&n>=t)return{node:a,offset:t-e};e=n}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=wu(a)}}function Eu(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Eu(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Cu(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var t=sa(e.document);t instanceof e.HTMLIFrameElement;){try{var a=typeof t.contentWindow.location.href=="string"}catch{a=!1}if(a)e=t.contentWindow;else break;t=sa(e.document)}return t}function Ui(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}var Kh=Ka&&"documentMode"in document&&11>=document.documentMode,xr=null,Hi=null,ms=null,Li=!1;function qu(e,t,a){var n=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Li||xr==null||xr!==sa(n)||(n=xr,"selectionStart"in n&&Ui(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),ms&&fs(ms,n)||(ms=n,n=ei(Hi,"onSelect"),0<n.length&&(t=new ul("onSelect","select",null,t,a),e.push({event:t,listeners:n}),t.target=xr)))}function Fn(e,t){var a={};return a[e.toLowerCase()]=t.toLowerCase(),a["Webkit"+e]="webkit"+t,a["Moz"+e]="moz"+t,a}var wr={animationend:Fn("Animation","AnimationEnd"),animationiteration:Fn("Animation","AnimationIteration"),animationstart:Fn("Animation","AnimationStart"),transitionrun:Fn("Transition","TransitionRun"),transitionstart:Fn("Transition","TransitionStart"),transitioncancel:Fn("Transition","TransitionCancel"),transitionend:Fn("Transition","TransitionEnd")},Bi={},Du={};Ka&&(Du=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);function Wn(e){if(Bi[e])return Bi[e];if(!wr[e])return e;var t=wr[e],a;for(a in t)if(t.hasOwnProperty(a)&&a in Du)return Bi[e]=t[a];return e}var Tu=Wn("animationend"),Au=Wn("animationiteration"),Ou=Wn("animationstart"),Jh=Wn("transitionrun"),Fh=Wn("transitionstart"),Wh=Wn("transitioncancel"),ku=Wn("transitionend"),zu=new Map,Yi="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Yi.push("scrollEnd");function Sa(e,t){zu.set(e,t),Qa(t,[e])}var ml=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},la=[],Nr=0,Gi=0;function hl(){for(var e=Nr,t=Gi=Nr=0;t<e;){var a=la[t];la[t++]=null;var n=la[t];la[t++]=null;var o=la[t];la[t++]=null;var u=la[t];if(la[t++]=null,n!==null&&o!==null){var m=n.pending;m===null?o.next=o:(o.next=m.next,m.next=o),n.pending=o}u!==0&&Mu(a,o,u)}}function pl(e,t,a,n){la[Nr++]=e,la[Nr++]=t,la[Nr++]=a,la[Nr++]=n,Gi|=n,e.lanes|=n,e=e.alternate,e!==null&&(e.lanes|=n)}function Qi(e,t,a,n){return pl(e,t,a,n),gl(e)}function $n(e,t){return pl(e,null,null,t),gl(e)}function Mu(e,t,a){e.lanes|=a;var n=e.alternate;n!==null&&(n.lanes|=a);for(var o=!1,u=e.return;u!==null;)u.childLanes|=a,n=u.alternate,n!==null&&(n.childLanes|=a),u.tag===22&&(e=u.stateNode,e===null||e._visibility&1||(o=!0)),e=u,u=u.return;return e.tag===3?(u=e.stateNode,o&&t!==null&&(o=31-Dt(a),e=u.hiddenUpdates,n=e[o],n===null?e[o]=[t]:n.push(t),t.lane=a|536870912),u):null}function gl(e){if(50<Ms)throw Ms=0,Io=null,Error(c(185));for(var t=e.return;t!==null;)e=t,t=e.return;return e.tag===3?e.stateNode:null}var Er={};function $h(e,t,a,n){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jt(e,t,a,n){return new $h(e,t,a,n)}function Xi(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Ja(e,t){var a=e.alternate;return a===null?(a=Jt(e.tag,t,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=t,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&65011712,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,t=e.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a.refCleanup=e.refCleanup,a}function Ru(e,t){e.flags&=65011714;var a=e.alternate;return a===null?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=a.childLanes,e.lanes=a.lanes,e.child=a.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,e.updateQueue=a.updateQueue,e.type=a.type,t=a.dependencies,e.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function _l(e,t,a,n,o,u){var m=0;if(n=e,typeof e=="function")Xi(e)&&(m=1);else if(typeof e=="string")m=ag(e,a,Ne.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case Ae:return e=Jt(31,a,t,o),e.elementType=Ae,e.lanes=u,e;case Z:return Pn(a.children,o,u,t);case oe:m=8,o|=24;break;case ee:return e=Jt(12,a,t,o|2),e.elementType=ee,e.lanes=u,e;case Se:return e=Jt(13,a,t,o),e.elementType=Se,e.lanes=u,e;case Me:return e=Jt(19,a,t,o),e.elementType=Me,e.lanes=u,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case de:m=10;break e;case me:m=9;break e;case se:m=11;break e;case Ve:m=14;break e;case Te:m=16,n=null;break e}m=29,a=Error(c(130,e===null?"null":typeof e,"")),n=null}return t=Jt(m,a,t,o),t.elementType=e,t.type=n,t.lanes=u,t}function Pn(e,t,a,n){return e=Jt(7,e,n,t),e.lanes=a,e}function Vi(e,t,a){return e=Jt(6,e,null,t),e.lanes=a,e}function Uu(e){var t=Jt(18,null,null,0);return t.stateNode=e,t}function Zi(e,t,a){return t=Jt(4,e.children!==null?e.children:[],e.key,t),t.lanes=a,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Hu=new WeakMap;function ia(e,t){if(typeof e=="object"&&e!==null){var a=Hu.get(e);return a!==void 0?a:(t={value:e,source:t,stack:pr(t)},Hu.set(e,t),t)}return{value:e,source:t,stack:pr(t)}}var Cr=[],qr=0,yl=null,hs=0,oa=[],ca=0,jn=null,Aa=1,Oa="";function Fa(e,t){Cr[qr++]=hs,Cr[qr++]=yl,yl=e,hs=t}function Lu(e,t,a){oa[ca++]=Aa,oa[ca++]=Oa,oa[ca++]=jn,jn=e;var n=Aa;e=Oa;var o=32-Dt(n)-1;n&=~(1<<o),a+=1;var u=32-Dt(t)+o;if(30<u){var m=o-o%5;u=(n&(1<<m)-1).toString(32),n>>=m,o-=m,Aa=1<<32-Dt(t)+o|a<<o|n,Oa=u+e}else Aa=1<<u|a<<o|n,Oa=e}function Ki(e){e.return!==null&&(Fa(e,1),Lu(e,1,0))}function Ji(e){for(;e===yl;)yl=Cr[--qr],Cr[qr]=null,hs=Cr[--qr],Cr[qr]=null;for(;e===jn;)jn=oa[--ca],oa[ca]=null,Oa=oa[--ca],oa[ca]=null,Aa=oa[--ca],oa[ca]=null}function Bu(e,t){oa[ca++]=Aa,oa[ca++]=Oa,oa[ca++]=jn,Aa=t.id,Oa=t.overflow,jn=e}var At=null,tt=null,ze=!1,Sn=null,ua=!1,Fi=Error(c(519));function xn(e){var t=Error(c(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ps(ia(t,e)),Fi}function Yu(e){var t=e.stateNode,a=e.type,n=e.memoizedProps;switch(t[et]=e,t[Mt]=n,a){case"dialog":De("cancel",t),De("close",t);break;case"iframe":case"object":case"embed":De("load",t);break;case"video":case"audio":for(a=0;a<Us.length;a++)De(Us[a],t);break;case"source":De("error",t);break;case"img":case"image":case"link":De("error",t),De("load",t);break;case"details":De("toggle",t);break;case"input":De("invalid",t),ns(t,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":De("invalid",t);break;case"textarea":De("invalid",t),T(t,n.value,n.defaultValue,n.children)}a=n.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||t.textContent===""+a||n.suppressHydrationWarning===!0||sm(t.textContent,a)?(n.popover!=null&&(De("beforetoggle",t),De("toggle",t)),n.onScroll!=null&&De("scroll",t),n.onScrollEnd!=null&&De("scrollend",t),n.onClick!=null&&(t.onclick=Za),t=!0):t=!1,t||xn(e,!0)}function Gu(e){for(At=e.return;At;)switch(At.tag){case 5:case 31:case 13:ua=!1;return;case 27:case 3:ua=!0;return;default:At=At.return}}function Dr(e){if(e!==At)return!1;if(!ze)return Gu(e),ze=!0,!1;var t=e.tag,a;if((a=t!==3&&t!==27)&&((a=t===5)&&(a=e.type,a=!(a!=="form"&&a!=="button")||hc(e.type,e.memoizedProps)),a=!a),a&&tt&&xn(e),Gu(e),t===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(c(317));tt=hm(e)}else if(t===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(c(317));tt=hm(e)}else t===27?(t=tt,Un(e.type)?(e=vc,vc=null,tt=e):tt=t):tt=At?fa(e.stateNode.nextSibling):null;return!0}function In(){tt=At=null,ze=!1}function Wi(){var e=Sn;return e!==null&&(Vt===null?Vt=e:Vt.push.apply(Vt,e),Sn=null),e}function ps(e){Sn===null?Sn=[e]:Sn.push(e)}var $i=ye(null),er=null,Wa=null;function wn(e,t,a){he($i,t._currentValue),t._currentValue=a}function $a(e){e._currentValue=$i.current,J($i)}function Pi(e,t,a){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===a)break;e=e.return}}function Ii(e,t,a,n){var o=e.child;for(o!==null&&(o.return=e);o!==null;){var u=o.dependencies;if(u!==null){var m=o.child;u=u.firstContext;e:for(;u!==null;){var g=u;u=o;for(var b=0;b<t.length;b++)if(g.context===t[b]){u.lanes|=a,g=u.alternate,g!==null&&(g.lanes|=a),Pi(u.return,a,e),n||(m=null);break e}u=g.next}}else if(o.tag===18){if(m=o.return,m===null)throw Error(c(341));m.lanes|=a,u=m.alternate,u!==null&&(u.lanes|=a),Pi(m,a,e),m=null}else m=o.child;if(m!==null)m.return=o;else for(m=o;m!==null;){if(m===e){m=null;break}if(o=m.sibling,o!==null){o.return=m.return,m=o;break}m=m.return}o=m}}function Tr(e,t,a,n){e=null;for(var o=t,u=!1;o!==null;){if(!u){if((o.flags&524288)!==0)u=!0;else if((o.flags&262144)!==0)break}if(o.tag===10){var m=o.alternate;if(m===null)throw Error(c(387));if(m=m.memoizedProps,m!==null){var g=o.type;Kt(o.pendingProps.value,m.value)||(e!==null?e.push(g):e=[g])}}else if(o===He.current){if(m=o.alternate,m===null)throw Error(c(387));m.memoizedState.memoizedState!==o.memoizedState.memoizedState&&(e!==null?e.push(Gs):e=[Gs])}o=o.return}e!==null&&Ii(t,e,a,n),t.flags|=262144}function vl(e){for(e=e.firstContext;e!==null;){if(!Kt(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function tr(e){er=e,Wa=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Ot(e){return Qu(er,e)}function bl(e,t){return er===null&&tr(e),Qu(e,t)}function Qu(e,t){var a=t._currentValue;if(t={context:t,memoizedValue:a,next:null},Wa===null){if(e===null)throw Error(c(308));Wa=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Wa=Wa.next=t;return a}var Ph=typeof AbortController<"u"?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(a,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(a){return a()})}},Ih=r.unstable_scheduleCallback,ep=r.unstable_NormalPriority,pt={$$typeof:de,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function eo(){return{controller:new Ph,data:new Map,refCount:0}}function gs(e){e.refCount--,e.refCount===0&&Ih(ep,function(){e.controller.abort()})}var _s=null,to=0,Ar=0,Or=null;function tp(e,t){if(_s===null){var a=_s=[];to=0,Ar=sc(),Or={status:"pending",value:void 0,then:function(n){a.push(n)}}}return to++,t.then(Xu,Xu),t}function Xu(){if(--to===0&&_s!==null){Or!==null&&(Or.status="fulfilled");var e=_s;_s=null,Ar=0,Or=null;for(var t=0;t<e.length;t++)(0,e[t])()}}function ap(e,t){var a=[],n={status:"pending",value:null,reason:null,then:function(o){a.push(o)}};return e.then(function(){n.status="fulfilled",n.value=t;for(var o=0;o<a.length;o++)(0,a[o])(t)},function(o){for(n.status="rejected",n.reason=o,o=0;o<a.length;o++)(0,a[o])(void 0)}),n}var Vu=D.S;D.S=function(e,t){Df=vt(),typeof t=="object"&&t!==null&&typeof t.then=="function"&&tp(e,t),Vu!==null&&Vu(e,t)};var ar=ye(null);function ao(){var e=ar.current;return e!==null?e:Ie.pooledCache}function jl(e,t){t===null?he(ar,ar.current):he(ar,t.pool)}function Zu(){var e=ao();return e===null?null:{parent:pt._currentValue,pool:e}}var kr=Error(c(460)),no=Error(c(474)),Sl=Error(c(542)),xl={then:function(){}};function Ku(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Ju(e,t,a){switch(a=e[a],a===void 0?e.push(t):a!==t&&(t.then(Za,Za),t=a),t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Wu(e),e;default:if(typeof t.status=="string")t.then(Za,Za);else{if(e=Ie,e!==null&&100<e.shellSuspendCounter)throw Error(c(482));e=t,e.status="pending",e.then(function(n){if(t.status==="pending"){var o=t;o.status="fulfilled",o.value=n}},function(n){if(t.status==="pending"){var o=t;o.status="rejected",o.reason=n}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw e=t.reason,Wu(e),e}throw rr=t,kr}}function nr(e){try{var t=e._init;return t(e._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(rr=a,kr):a}}var rr=null;function Fu(){if(rr===null)throw Error(c(459));var e=rr;return rr=null,e}function Wu(e){if(e===kr||e===Sl)throw Error(c(483))}var zr=null,ys=0;function wl(e){var t=ys;return ys+=1,zr===null&&(zr=[]),Ju(zr,e,t)}function vs(e,t){t=t.props.ref,e.ref=t!==void 0?t:null}function Nl(e,t){throw t.$$typeof===F?Error(c(525)):(e=Object.prototype.toString.call(t),Error(c(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)))}function $u(e){function t(N,j){if(e){var E=N.deletions;E===null?(N.deletions=[j],N.flags|=16):E.push(j)}}function a(N,j){if(!e)return null;for(;j!==null;)t(N,j),j=j.sibling;return null}function n(N){for(var j=new Map;N!==null;)N.key!==null?j.set(N.key,N):j.set(N.index,N),N=N.sibling;return j}function o(N,j){return N=Ja(N,j),N.index=0,N.sibling=null,N}function u(N,j,E){return N.index=E,e?(E=N.alternate,E!==null?(E=E.index,E<j?(N.flags|=67108866,j):E):(N.flags|=67108866,j)):(N.flags|=1048576,j)}function m(N){return e&&N.alternate===null&&(N.flags|=67108866),N}function g(N,j,E,L){return j===null||j.tag!==6?(j=Vi(E,N.mode,L),j.return=N,j):(j=o(j,E),j.return=N,j)}function b(N,j,E,L){var fe=E.type;return fe===Z?H(N,j,E.props.children,L,E.key):j!==null&&(j.elementType===fe||typeof fe=="object"&&fe!==null&&fe.$$typeof===Te&&nr(fe)===j.type)?(j=o(j,E.props),vs(j,E),j.return=N,j):(j=_l(E.type,E.key,E.props,null,N.mode,L),vs(j,E),j.return=N,j)}function C(N,j,E,L){return j===null||j.tag!==4||j.stateNode.containerInfo!==E.containerInfo||j.stateNode.implementation!==E.implementation?(j=Zi(E,N.mode,L),j.return=N,j):(j=o(j,E.children||[]),j.return=N,j)}function H(N,j,E,L,fe){return j===null||j.tag!==7?(j=Pn(E,N.mode,L,fe),j.return=N,j):(j=o(j,E),j.return=N,j)}function B(N,j,E){if(typeof j=="string"&&j!==""||typeof j=="number"||typeof j=="bigint")return j=Vi(""+j,N.mode,E),j.return=N,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case P:return E=_l(j.type,j.key,j.props,null,N.mode,E),vs(E,j),E.return=N,E;case $:return j=Zi(j,N.mode,E),j.return=N,j;case Te:return j=nr(j),B(N,j,E)}if(ve(j)||U(j))return j=Pn(j,N.mode,E,null),j.return=N,j;if(typeof j.then=="function")return B(N,wl(j),E);if(j.$$typeof===de)return B(N,bl(N,j),E);Nl(N,j)}return null}function A(N,j,E,L){var fe=j!==null?j.key:null;if(typeof E=="string"&&E!==""||typeof E=="number"||typeof E=="bigint")return fe!==null?null:g(N,j,""+E,L);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case P:return E.key===fe?b(N,j,E,L):null;case $:return E.key===fe?C(N,j,E,L):null;case Te:return E=nr(E),A(N,j,E,L)}if(ve(E)||U(E))return fe!==null?null:H(N,j,E,L,null);if(typeof E.then=="function")return A(N,j,wl(E),L);if(E.$$typeof===de)return A(N,j,bl(N,E),L);Nl(N,E)}return null}function O(N,j,E,L,fe){if(typeof L=="string"&&L!==""||typeof L=="number"||typeof L=="bigint")return N=N.get(E)||null,g(j,N,""+L,fe);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case P:return N=N.get(L.key===null?E:L.key)||null,b(j,N,L,fe);case $:return N=N.get(L.key===null?E:L.key)||null,C(j,N,L,fe);case Te:return L=nr(L),O(N,j,E,L,fe)}if(ve(L)||U(L))return N=N.get(E)||null,H(j,N,L,fe,null);if(typeof L.then=="function")return O(N,j,E,wl(L),fe);if(L.$$typeof===de)return O(N,j,E,bl(j,L),fe);Nl(j,L)}return null}function ne(N,j,E,L){for(var fe=null,Be=null,ie=j,xe=j=0,ke=null;ie!==null&&xe<E.length;xe++){ie.index>xe?(ke=ie,ie=null):ke=ie.sibling;var Ye=A(N,ie,E[xe],L);if(Ye===null){ie===null&&(ie=ke);break}e&&ie&&Ye.alternate===null&&t(N,ie),j=u(Ye,j,xe),Be===null?fe=Ye:Be.sibling=Ye,Be=Ye,ie=ke}if(xe===E.length)return a(N,ie),ze&&Fa(N,xe),fe;if(ie===null){for(;xe<E.length;xe++)ie=B(N,E[xe],L),ie!==null&&(j=u(ie,j,xe),Be===null?fe=ie:Be.sibling=ie,Be=ie);return ze&&Fa(N,xe),fe}for(ie=n(ie);xe<E.length;xe++)ke=O(ie,N,xe,E[xe],L),ke!==null&&(e&&ke.alternate!==null&&ie.delete(ke.key===null?xe:ke.key),j=u(ke,j,xe),Be===null?fe=ke:Be.sibling=ke,Be=ke);return e&&ie.forEach(function(Gn){return t(N,Gn)}),ze&&Fa(N,xe),fe}function pe(N,j,E,L){if(E==null)throw Error(c(151));for(var fe=null,Be=null,ie=j,xe=j=0,ke=null,Ye=E.next();ie!==null&&!Ye.done;xe++,Ye=E.next()){ie.index>xe?(ke=ie,ie=null):ke=ie.sibling;var Gn=A(N,ie,Ye.value,L);if(Gn===null){ie===null&&(ie=ke);break}e&&ie&&Gn.alternate===null&&t(N,ie),j=u(Gn,j,xe),Be===null?fe=Gn:Be.sibling=Gn,Be=Gn,ie=ke}if(Ye.done)return a(N,ie),ze&&Fa(N,xe),fe;if(ie===null){for(;!Ye.done;xe++,Ye=E.next())Ye=B(N,Ye.value,L),Ye!==null&&(j=u(Ye,j,xe),Be===null?fe=Ye:Be.sibling=Ye,Be=Ye);return ze&&Fa(N,xe),fe}for(ie=n(ie);!Ye.done;xe++,Ye=E.next())Ye=O(ie,N,xe,Ye.value,L),Ye!==null&&(e&&Ye.alternate!==null&&ie.delete(Ye.key===null?xe:Ye.key),j=u(Ye,j,xe),Be===null?fe=Ye:Be.sibling=Ye,Be=Ye);return e&&ie.forEach(function(mg){return t(N,mg)}),ze&&Fa(N,xe),fe}function Pe(N,j,E,L){if(typeof E=="object"&&E!==null&&E.type===Z&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case P:e:{for(var fe=E.key;j!==null;){if(j.key===fe){if(fe=E.type,fe===Z){if(j.tag===7){a(N,j.sibling),L=o(j,E.props.children),L.return=N,N=L;break e}}else if(j.elementType===fe||typeof fe=="object"&&fe!==null&&fe.$$typeof===Te&&nr(fe)===j.type){a(N,j.sibling),L=o(j,E.props),vs(L,E),L.return=N,N=L;break e}a(N,j);break}else t(N,j);j=j.sibling}E.type===Z?(L=Pn(E.props.children,N.mode,L,E.key),L.return=N,N=L):(L=_l(E.type,E.key,E.props,null,N.mode,L),vs(L,E),L.return=N,N=L)}return m(N);case $:e:{for(fe=E.key;j!==null;){if(j.key===fe)if(j.tag===4&&j.stateNode.containerInfo===E.containerInfo&&j.stateNode.implementation===E.implementation){a(N,j.sibling),L=o(j,E.children||[]),L.return=N,N=L;break e}else{a(N,j);break}else t(N,j);j=j.sibling}L=Zi(E,N.mode,L),L.return=N,N=L}return m(N);case Te:return E=nr(E),Pe(N,j,E,L)}if(ve(E))return ne(N,j,E,L);if(U(E)){if(fe=U(E),typeof fe!="function")throw Error(c(150));return E=fe.call(E),pe(N,j,E,L)}if(typeof E.then=="function")return Pe(N,j,wl(E),L);if(E.$$typeof===de)return Pe(N,j,bl(N,E),L);Nl(N,E)}return typeof E=="string"&&E!==""||typeof E=="number"||typeof E=="bigint"?(E=""+E,j!==null&&j.tag===6?(a(N,j.sibling),L=o(j,E),L.return=N,N=L):(a(N,j),L=Vi(E,N.mode,L),L.return=N,N=L),m(N)):a(N,j)}return function(N,j,E,L){try{ys=0;var fe=Pe(N,j,E,L);return zr=null,fe}catch(ie){if(ie===kr||ie===Sl)throw ie;var Be=Jt(29,ie,null,N.mode);return Be.lanes=L,Be.return=N,Be}finally{}}}var sr=$u(!0),Pu=$u(!1),Nn=!1;function ro(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function so(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function En(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Cn(e,t,a){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,(Qe&2)!==0){var o=n.pending;return o===null?t.next=t:(t.next=o.next,o.next=t),n.pending=t,t=gl(e),Mu(e,null,a),t}return pl(e,n,t,a),gl(e)}function bs(e,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194048)!==0)){var n=t.lanes;n&=e.pendingLanes,a|=n,t.lanes=a,_r(e,a)}}function lo(e,t){var a=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,a===n)){var o=null,u=null;if(a=a.firstBaseUpdate,a!==null){do{var m={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};u===null?o=u=m:u=u.next=m,a=a.next}while(a!==null);u===null?o=u=t:u=u.next=t}else o=u=t;a={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:u,shared:n.shared,callbacks:n.callbacks},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=t:e.next=t,a.lastBaseUpdate=t}var io=!1;function js(){if(io){var e=Or;if(e!==null)throw e}}function Ss(e,t,a,n){io=!1;var o=e.updateQueue;Nn=!1;var u=o.firstBaseUpdate,m=o.lastBaseUpdate,g=o.shared.pending;if(g!==null){o.shared.pending=null;var b=g,C=b.next;b.next=null,m===null?u=C:m.next=C,m=b;var H=e.alternate;H!==null&&(H=H.updateQueue,g=H.lastBaseUpdate,g!==m&&(g===null?H.firstBaseUpdate=C:g.next=C,H.lastBaseUpdate=b))}if(u!==null){var B=o.baseState;m=0,H=C=b=null,g=u;do{var A=g.lane&-536870913,O=A!==g.lane;if(O?(Oe&A)===A:(n&A)===A){A!==0&&A===Ar&&(io=!0),H!==null&&(H=H.next={lane:0,tag:g.tag,payload:g.payload,callback:null,next:null});e:{var ne=e,pe=g;A=t;var Pe=a;switch(pe.tag){case 1:if(ne=pe.payload,typeof ne=="function"){B=ne.call(Pe,B,A);break e}B=ne;break e;case 3:ne.flags=ne.flags&-65537|128;case 0:if(ne=pe.payload,A=typeof ne=="function"?ne.call(Pe,B,A):ne,A==null)break e;B=M({},B,A);break e;case 2:Nn=!0}}A=g.callback,A!==null&&(e.flags|=64,O&&(e.flags|=8192),O=o.callbacks,O===null?o.callbacks=[A]:O.push(A))}else O={lane:A,tag:g.tag,payload:g.payload,callback:g.callback,next:null},H===null?(C=H=O,b=B):H=H.next=O,m|=A;if(g=g.next,g===null){if(g=o.shared.pending,g===null)break;O=g,g=O.next,O.next=null,o.lastBaseUpdate=O,o.shared.pending=null}}while(!0);H===null&&(b=B),o.baseState=b,o.firstBaseUpdate=C,o.lastBaseUpdate=H,u===null&&(o.shared.lanes=0),On|=m,e.lanes=m,e.memoizedState=B}}function Iu(e,t){if(typeof e!="function")throw Error(c(191,e));e.call(t)}function ed(e,t){var a=e.callbacks;if(a!==null)for(e.callbacks=null,e=0;e<a.length;e++)Iu(a[e],t)}var Mr=ye(null),El=ye(0);function td(e,t){e=ln,he(El,e),he(Mr,t),ln=e|t.baseLanes}function oo(){he(El,ln),he(Mr,Mr.current)}function co(){ln=El.current,J(Mr),J(El)}var Ft=ye(null),da=null;function qn(e){var t=e.alternate;he(ct,ct.current&1),he(Ft,e),da===null&&(t===null||Mr.current!==null||t.memoizedState!==null)&&(da=e)}function uo(e){he(ct,ct.current),he(Ft,e),da===null&&(da=e)}function ad(e){e.tag===22?(he(ct,ct.current),he(Ft,e),da===null&&(da=e)):Dn()}function Dn(){he(ct,ct.current),he(Ft,Ft.current)}function Wt(e){J(Ft),da===e&&(da=null),J(ct)}var ct=ye(0);function Cl(e){for(var t=e;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||_c(a)||yc(a)))return t}else if(t.tag===19&&(t.memoizedProps.revealOrder==="forwards"||t.memoizedProps.revealOrder==="backwards"||t.memoizedProps.revealOrder==="unstable_legacy-backwards"||t.memoizedProps.revealOrder==="together")){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Pa=0,je=null,We=null,gt=null,ql=!1,Rr=!1,lr=!1,Dl=0,xs=0,Ur=null,np=0;function st(){throw Error(c(321))}function fo(e,t){if(t===null)return!1;for(var a=0;a<t.length&&a<e.length;a++)if(!Kt(e[a],t[a]))return!1;return!0}function mo(e,t,a,n,o,u){return Pa=u,je=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,D.H=e===null||e.memoizedState===null?Ld:qo,lr=!1,u=a(n,o),lr=!1,Rr&&(u=rd(t,a,n,o)),nd(e),u}function nd(e){D.H=Es;var t=We!==null&&We.next!==null;if(Pa=0,gt=We=je=null,ql=!1,xs=0,Ur=null,t)throw Error(c(300));e===null||_t||(e=e.dependencies,e!==null&&vl(e)&&(_t=!0))}function rd(e,t,a,n){je=e;var o=0;do{if(Rr&&(Ur=null),xs=0,Rr=!1,25<=o)throw Error(c(301));if(o+=1,gt=We=null,e.updateQueue!=null){var u=e.updateQueue;u.lastEffect=null,u.events=null,u.stores=null,u.memoCache!=null&&(u.memoCache.index=0)}D.H=Bd,u=t(a,n)}while(Rr);return u}function rp(){var e=D.H,t=e.useState()[0];return t=typeof t.then=="function"?ws(t):t,e=e.useState()[0],(We!==null?We.memoizedState:null)!==e&&(je.flags|=1024),t}function ho(){var e=Dl!==0;return Dl=0,e}function po(e,t,a){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a}function go(e){if(ql){for(e=e.memoizedState;e!==null;){var t=e.queue;t!==null&&(t.pending=null),e=e.next}ql=!1}Pa=0,gt=We=je=null,Rr=!1,xs=Dl=0,Ur=null}function Bt(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gt===null?je.memoizedState=gt=e:gt=gt.next=e,gt}function ut(){if(We===null){var e=je.alternate;e=e!==null?e.memoizedState:null}else e=We.next;var t=gt===null?je.memoizedState:gt.next;if(t!==null)gt=t,We=e;else{if(e===null)throw je.alternate===null?Error(c(467)):Error(c(310));We=e,e={memoizedState:We.memoizedState,baseState:We.baseState,baseQueue:We.baseQueue,queue:We.queue,next:null},gt===null?je.memoizedState=gt=e:gt=gt.next=e}return gt}function Tl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function ws(e){var t=xs;return xs+=1,Ur===null&&(Ur=[]),e=Ju(Ur,e,t),t=je,(gt===null?t.memoizedState:gt.next)===null&&(t=t.alternate,D.H=t===null||t.memoizedState===null?Ld:qo),e}function Al(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return ws(e);if(e.$$typeof===de)return Ot(e)}throw Error(c(438,String(e)))}function _o(e){var t=null,a=je.updateQueue;if(a!==null&&(t=a.memoCache),t==null){var n=je.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(t={data:n.data.map(function(o){return o.slice()}),index:0})))}if(t==null&&(t={data:[],index:0}),a===null&&(a=Tl(),je.updateQueue=a),a.memoCache=t,a=t.data[t.index],a===void 0)for(a=t.data[t.index]=Array(e),n=0;n<e;n++)a[n]=it;return t.index++,a}function Ia(e,t){return typeof t=="function"?t(e):t}function Ol(e){var t=ut();return yo(t,We,e)}function yo(e,t,a){var n=e.queue;if(n===null)throw Error(c(311));n.lastRenderedReducer=a;var o=e.baseQueue,u=n.pending;if(u!==null){if(o!==null){var m=o.next;o.next=u.next,u.next=m}t.baseQueue=o=u,n.pending=null}if(u=e.baseState,o===null)e.memoizedState=u;else{t=o.next;var g=m=null,b=null,C=t,H=!1;do{var B=C.lane&-536870913;if(B!==C.lane?(Oe&B)===B:(Pa&B)===B){var A=C.revertLane;if(A===0)b!==null&&(b=b.next={lane:0,revertLane:0,gesture:null,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null}),B===Ar&&(H=!0);else if((Pa&A)===A){C=C.next,A===Ar&&(H=!0);continue}else B={lane:0,revertLane:C.revertLane,gesture:null,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null},b===null?(g=b=B,m=u):b=b.next=B,je.lanes|=A,On|=A;B=C.action,lr&&a(u,B),u=C.hasEagerState?C.eagerState:a(u,B)}else A={lane:B,revertLane:C.revertLane,gesture:C.gesture,action:C.action,hasEagerState:C.hasEagerState,eagerState:C.eagerState,next:null},b===null?(g=b=A,m=u):b=b.next=A,je.lanes|=B,On|=B;C=C.next}while(C!==null&&C!==t);if(b===null?m=u:b.next=g,!Kt(u,e.memoizedState)&&(_t=!0,H&&(a=Or,a!==null)))throw a;e.memoizedState=u,e.baseState=m,e.baseQueue=b,n.lastRenderedState=u}return o===null&&(n.lanes=0),[e.memoizedState,n.dispatch]}function vo(e){var t=ut(),a=t.queue;if(a===null)throw Error(c(311));a.lastRenderedReducer=e;var n=a.dispatch,o=a.pending,u=t.memoizedState;if(o!==null){a.pending=null;var m=o=o.next;do u=e(u,m.action),m=m.next;while(m!==o);Kt(u,t.memoizedState)||(_t=!0),t.memoizedState=u,t.baseQueue===null&&(t.baseState=u),a.lastRenderedState=u}return[u,n]}function sd(e,t,a){var n=je,o=ut(),u=ze;if(u){if(a===void 0)throw Error(c(407));a=a()}else a=t();var m=!Kt((We||o).memoizedState,a);if(m&&(o.memoizedState=a,_t=!0),o=o.queue,So(od.bind(null,n,o,e),[e]),o.getSnapshot!==t||m||gt!==null&&gt.memoizedState.tag&1){if(n.flags|=2048,Hr(9,{destroy:void 0},id.bind(null,n,o,a,t),null),Ie===null)throw Error(c(349));u||(Pa&127)!==0||ld(n,t,a)}return a}function ld(e,t,a){e.flags|=16384,e={getSnapshot:t,value:a},t=je.updateQueue,t===null?(t=Tl(),je.updateQueue=t,t.stores=[e]):(a=t.stores,a===null?t.stores=[e]:a.push(e))}function id(e,t,a,n){t.value=a,t.getSnapshot=n,cd(t)&&ud(e)}function od(e,t,a){return a(function(){cd(t)&&ud(e)})}function cd(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!Kt(e,a)}catch{return!0}}function ud(e){var t=$n(e,2);t!==null&&Zt(t,e,2)}function bo(e){var t=Bt();if(typeof e=="function"){var a=e;if(e=a(),lr){te(!0);try{a()}finally{te(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ia,lastRenderedState:e},t}function dd(e,t,a,n){return e.baseState=a,yo(e,We,typeof n=="function"?n:Ia)}function sp(e,t,a,n,o){if(Ml(e))throw Error(c(485));if(e=t.action,e!==null){var u={payload:o,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(m){u.listeners.push(m)}};D.T!==null?a(!0):u.isTransition=!1,n(u),a=t.pending,a===null?(u.next=t.pending=u,fd(t,u)):(u.next=a.next,t.pending=a.next=u)}}function fd(e,t){var a=t.action,n=t.payload,o=e.state;if(t.isTransition){var u=D.T,m={};D.T=m;try{var g=a(o,n),b=D.S;b!==null&&b(m,g),md(e,t,g)}catch(C){jo(e,t,C)}finally{u!==null&&m.types!==null&&(u.types=m.types),D.T=u}}else try{u=a(o,n),md(e,t,u)}catch(C){jo(e,t,C)}}function md(e,t,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(n){hd(e,t,n)},function(n){return jo(e,t,n)}):hd(e,t,a)}function hd(e,t,a){t.status="fulfilled",t.value=a,pd(t),e.state=a,t=e.pending,t!==null&&(a=t.next,a===t?e.pending=null:(a=a.next,t.next=a,fd(e,a)))}function jo(e,t,a){var n=e.pending;if(e.pending=null,n!==null){n=n.next;do t.status="rejected",t.reason=a,pd(t),t=t.next;while(t!==n)}e.action=null}function pd(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function gd(e,t){return t}function _d(e,t){if(ze){var a=Ie.formState;if(a!==null){e:{var n=je;if(ze){if(tt){t:{for(var o=tt,u=ua;o.nodeType!==8;){if(!u){o=null;break t}if(o=fa(o.nextSibling),o===null){o=null;break t}}u=o.data,o=u==="F!"||u==="F"?o:null}if(o){tt=fa(o.nextSibling),n=o.data==="F!";break e}}xn(n)}n=!1}n&&(t=a[0])}}return a=Bt(),a.memoizedState=a.baseState=t,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gd,lastRenderedState:t},a.queue=n,a=Rd.bind(null,je,n),n.dispatch=a,n=bo(!1),u=Co.bind(null,je,!1,n.queue),n=Bt(),o={state:t,dispatch:null,action:e,pending:null},n.queue=o,a=sp.bind(null,je,o,u,a),o.dispatch=a,n.memoizedState=e,[t,a,!1]}function yd(e){var t=ut();return vd(t,We,e)}function vd(e,t,a){if(t=yo(e,t,gd)[0],e=Ol(Ia)[0],typeof t=="object"&&t!==null&&typeof t.then=="function")try{var n=ws(t)}catch(m){throw m===kr?Sl:m}else n=t;t=ut();var o=t.queue,u=o.dispatch;return a!==t.memoizedState&&(je.flags|=2048,Hr(9,{destroy:void 0},lp.bind(null,o,a),null)),[n,u,e]}function lp(e,t){e.action=t}function bd(e){var t=ut(),a=We;if(a!==null)return vd(t,a,e);ut(),t=t.memoizedState,a=ut();var n=a.queue.dispatch;return a.memoizedState=e,[t,n,!1]}function Hr(e,t,a,n){return e={tag:e,create:a,deps:n,inst:t,next:null},t=je.updateQueue,t===null&&(t=Tl(),je.updateQueue=t),a=t.lastEffect,a===null?t.lastEffect=e.next=e:(n=a.next,a.next=e,e.next=n,t.lastEffect=e),e}function jd(){return ut().memoizedState}function kl(e,t,a,n){var o=Bt();je.flags|=e,o.memoizedState=Hr(1|t,{destroy:void 0},a,n===void 0?null:n)}function zl(e,t,a,n){var o=ut();n=n===void 0?null:n;var u=o.memoizedState.inst;We!==null&&n!==null&&fo(n,We.memoizedState.deps)?o.memoizedState=Hr(t,u,a,n):(je.flags|=e,o.memoizedState=Hr(1|t,u,a,n))}function Sd(e,t){kl(8390656,8,e,t)}function So(e,t){zl(2048,8,e,t)}function ip(e){je.flags|=4;var t=je.updateQueue;if(t===null)t=Tl(),je.updateQueue=t,t.events=[e];else{var a=t.events;a===null?t.events=[e]:a.push(e)}}function xd(e){var t=ut().memoizedState;return ip({ref:t,nextImpl:e}),function(){if((Qe&2)!==0)throw Error(c(440));return t.impl.apply(void 0,arguments)}}function wd(e,t){return zl(4,2,e,t)}function Nd(e,t){return zl(4,4,e,t)}function Ed(e,t){if(typeof t=="function"){e=e();var a=t(e);return function(){typeof a=="function"?a():t(null)}}if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Cd(e,t,a){a=a!=null?a.concat([e]):null,zl(4,4,Ed.bind(null,t,e),a)}function xo(){}function qd(e,t){var a=ut();t=t===void 0?null:t;var n=a.memoizedState;return t!==null&&fo(t,n[1])?n[0]:(a.memoizedState=[e,t],e)}function Dd(e,t){var a=ut();t=t===void 0?null:t;var n=a.memoizedState;if(t!==null&&fo(t,n[1]))return n[0];if(n=e(),lr){te(!0);try{e()}finally{te(!1)}}return a.memoizedState=[n,t],n}function wo(e,t,a){return a===void 0||(Pa&1073741824)!==0&&(Oe&261930)===0?e.memoizedState=t:(e.memoizedState=a,e=Af(),je.lanes|=e,On|=e,a)}function Td(e,t,a,n){return Kt(a,t)?a:Mr.current!==null?(e=wo(e,a,n),Kt(e,t)||(_t=!0),e):(Pa&42)===0||(Pa&1073741824)!==0&&(Oe&261930)===0?(_t=!0,e.memoizedState=a):(e=Af(),je.lanes|=e,On|=e,t)}function Ad(e,t,a,n,o){var u=Q.p;Q.p=u!==0&&8>u?u:8;var m=D.T,g={};D.T=g,Co(e,!1,t,a);try{var b=o(),C=D.S;if(C!==null&&C(g,b),b!==null&&typeof b=="object"&&typeof b.then=="function"){var H=ap(b,n);Ns(e,t,H,It(e))}else Ns(e,t,n,It(e))}catch(B){Ns(e,t,{then:function(){},status:"rejected",reason:B},It())}finally{Q.p=u,m!==null&&g.types!==null&&(m.types=g.types),D.T=m}}function op(){}function No(e,t,a,n){if(e.tag!==5)throw Error(c(476));var o=Od(e).queue;Ad(e,o,t,W,a===null?op:function(){return kd(e),a(n)})}function Od(e){var t=e.memoizedState;if(t!==null)return t;t={memoizedState:W,baseState:W,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ia,lastRenderedState:W},next:null};var a={};return t.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ia,lastRenderedState:a},next:null},e.memoizedState=t,e=e.alternate,e!==null&&(e.memoizedState=t),t}function kd(e){var t=Od(e);t.next===null&&(t=e.alternate.memoizedState),Ns(e,t.next.queue,{},It())}function Eo(){return Ot(Gs)}function zd(){return ut().memoizedState}function Md(){return ut().memoizedState}function cp(e){for(var t=e.return;t!==null;){switch(t.tag){case 24:case 3:var a=It();e=En(a);var n=Cn(t,e,a);n!==null&&(Zt(n,t,a),bs(n,t,a)),t={cache:eo()},e.payload=t;return}t=t.return}}function up(e,t,a){var n=It();a={lane:n,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},Ml(e)?Ud(t,a):(a=Qi(e,t,a,n),a!==null&&(Zt(a,e,n),Hd(a,t,n)))}function Rd(e,t,a){var n=It();Ns(e,t,a,n)}function Ns(e,t,a,n){var o={lane:n,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(Ml(e))Ud(t,o);else{var u=e.alternate;if(e.lanes===0&&(u===null||u.lanes===0)&&(u=t.lastRenderedReducer,u!==null))try{var m=t.lastRenderedState,g=u(m,a);if(o.hasEagerState=!0,o.eagerState=g,Kt(g,m))return pl(e,t,o,0),Ie===null&&hl(),!1}catch{}finally{}if(a=Qi(e,t,o,n),a!==null)return Zt(a,e,n),Hd(a,t,n),!0}return!1}function Co(e,t,a,n){if(n={lane:2,revertLane:sc(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},Ml(e)){if(t)throw Error(c(479))}else t=Qi(e,a,n,2),t!==null&&Zt(t,e,2)}function Ml(e){var t=e.alternate;return e===je||t!==null&&t===je}function Ud(e,t){Rr=ql=!0;var a=e.pending;a===null?t.next=t:(t.next=a.next,a.next=t),e.pending=t}function Hd(e,t,a){if((a&4194048)!==0){var n=t.lanes;n&=e.pendingLanes,a|=n,t.lanes=a,_r(e,a)}}var Es={readContext:Ot,use:Al,useCallback:st,useContext:st,useEffect:st,useImperativeHandle:st,useLayoutEffect:st,useInsertionEffect:st,useMemo:st,useReducer:st,useRef:st,useState:st,useDebugValue:st,useDeferredValue:st,useTransition:st,useSyncExternalStore:st,useId:st,useHostTransitionStatus:st,useFormState:st,useActionState:st,useOptimistic:st,useMemoCache:st,useCacheRefresh:st};Es.useEffectEvent=st;var Ld={readContext:Ot,use:Al,useCallback:function(e,t){return Bt().memoizedState=[e,t===void 0?null:t],e},useContext:Ot,useEffect:Sd,useImperativeHandle:function(e,t,a){a=a!=null?a.concat([e]):null,kl(4194308,4,Ed.bind(null,t,e),a)},useLayoutEffect:function(e,t){return kl(4194308,4,e,t)},useInsertionEffect:function(e,t){kl(4,2,e,t)},useMemo:function(e,t){var a=Bt();t=t===void 0?null:t;var n=e();if(lr){te(!0);try{e()}finally{te(!1)}}return a.memoizedState=[n,t],n},useReducer:function(e,t,a){var n=Bt();if(a!==void 0){var o=a(t);if(lr){te(!0);try{a(t)}finally{te(!1)}}}else o=t;return n.memoizedState=n.baseState=o,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:o},n.queue=e,e=e.dispatch=up.bind(null,je,e),[n.memoizedState,e]},useRef:function(e){var t=Bt();return e={current:e},t.memoizedState=e},useState:function(e){e=bo(e);var t=e.queue,a=Rd.bind(null,je,t);return t.dispatch=a,[e.memoizedState,a]},useDebugValue:xo,useDeferredValue:function(e,t){var a=Bt();return wo(a,e,t)},useTransition:function(){var e=bo(!1);return e=Ad.bind(null,je,e.queue,!0,!1),Bt().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,a){var n=je,o=Bt();if(ze){if(a===void 0)throw Error(c(407));a=a()}else{if(a=t(),Ie===null)throw Error(c(349));(Oe&127)!==0||ld(n,t,a)}o.memoizedState=a;var u={value:a,getSnapshot:t};return o.queue=u,Sd(od.bind(null,n,u,e),[e]),n.flags|=2048,Hr(9,{destroy:void 0},id.bind(null,n,u,a,t),null),a},useId:function(){var e=Bt(),t=Ie.identifierPrefix;if(ze){var a=Oa,n=Aa;a=(n&~(1<<32-Dt(n)-1)).toString(32)+a,t="_"+t+"R_"+a,a=Dl++,0<a&&(t+="H"+a.toString(32)),t+="_"}else a=np++,t="_"+t+"r_"+a.toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:Eo,useFormState:_d,useActionState:_d,useOptimistic:function(e){var t=Bt();t.memoizedState=t.baseState=e;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=a,t=Co.bind(null,je,!0,a),a.dispatch=t,[e,t]},useMemoCache:_o,useCacheRefresh:function(){return Bt().memoizedState=cp.bind(null,je)},useEffectEvent:function(e){var t=Bt(),a={impl:e};return t.memoizedState=a,function(){if((Qe&2)!==0)throw Error(c(440));return a.impl.apply(void 0,arguments)}}},qo={readContext:Ot,use:Al,useCallback:qd,useContext:Ot,useEffect:So,useImperativeHandle:Cd,useInsertionEffect:wd,useLayoutEffect:Nd,useMemo:Dd,useReducer:Ol,useRef:jd,useState:function(){return Ol(Ia)},useDebugValue:xo,useDeferredValue:function(e,t){var a=ut();return Td(a,We.memoizedState,e,t)},useTransition:function(){var e=Ol(Ia)[0],t=ut().memoizedState;return[typeof e=="boolean"?e:ws(e),t]},useSyncExternalStore:sd,useId:zd,useHostTransitionStatus:Eo,useFormState:yd,useActionState:yd,useOptimistic:function(e,t){var a=ut();return dd(a,We,e,t)},useMemoCache:_o,useCacheRefresh:Md};qo.useEffectEvent=xd;var Bd={readContext:Ot,use:Al,useCallback:qd,useContext:Ot,useEffect:So,useImperativeHandle:Cd,useInsertionEffect:wd,useLayoutEffect:Nd,useMemo:Dd,useReducer:vo,useRef:jd,useState:function(){return vo(Ia)},useDebugValue:xo,useDeferredValue:function(e,t){var a=ut();return We===null?wo(a,e,t):Td(a,We.memoizedState,e,t)},useTransition:function(){var e=vo(Ia)[0],t=ut().memoizedState;return[typeof e=="boolean"?e:ws(e),t]},useSyncExternalStore:sd,useId:zd,useHostTransitionStatus:Eo,useFormState:bd,useActionState:bd,useOptimistic:function(e,t){var a=ut();return We!==null?dd(a,We,e,t):(a.baseState=e,[e,a.queue.dispatch])},useMemoCache:_o,useCacheRefresh:Md};Bd.useEffectEvent=xd;function Do(e,t,a,n){t=e.memoizedState,a=a(n,t),a=a==null?t:M({},t,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var To={enqueueSetState:function(e,t,a){e=e._reactInternals;var n=It(),o=En(n);o.payload=t,a!=null&&(o.callback=a),t=Cn(e,o,n),t!==null&&(Zt(t,e,n),bs(t,e,n))},enqueueReplaceState:function(e,t,a){e=e._reactInternals;var n=It(),o=En(n);o.tag=1,o.payload=t,a!=null&&(o.callback=a),t=Cn(e,o,n),t!==null&&(Zt(t,e,n),bs(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var a=It(),n=En(a);n.tag=2,t!=null&&(n.callback=t),t=Cn(e,n,a),t!==null&&(Zt(t,e,a),bs(t,e,a))}};function Yd(e,t,a,n,o,u,m){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,u,m):t.prototype&&t.prototype.isPureReactComponent?!fs(a,n)||!fs(o,u):!0}function Gd(e,t,a,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,n),t.state!==e&&To.enqueueReplaceState(t,t.state,null)}function ir(e,t){var a=t;if("ref"in t){a={};for(var n in t)n!=="ref"&&(a[n]=t[n])}if(e=e.defaultProps){a===t&&(a=M({},a));for(var o in e)a[o]===void 0&&(a[o]=e[o])}return a}function Qd(e){ml(e)}function Xd(e){console.error(e)}function Vd(e){ml(e)}function Rl(e,t){try{var a=e.onUncaughtError;a(t.value,{componentStack:t.stack})}catch(n){setTimeout(function(){throw n})}}function Zd(e,t,a){try{var n=e.onCaughtError;n(a.value,{componentStack:a.stack,errorBoundary:t.tag===1?t.stateNode:null})}catch(o){setTimeout(function(){throw o})}}function Ao(e,t,a){return a=En(a),a.tag=3,a.payload={element:null},a.callback=function(){Rl(e,t)},a}function Kd(e){return e=En(e),e.tag=3,e}function Jd(e,t,a,n){var o=a.type.getDerivedStateFromError;if(typeof o=="function"){var u=n.value;e.payload=function(){return o(u)},e.callback=function(){Zd(t,a,n)}}var m=a.stateNode;m!==null&&typeof m.componentDidCatch=="function"&&(e.callback=function(){Zd(t,a,n),typeof o!="function"&&(kn===null?kn=new Set([this]):kn.add(this));var g=n.stack;this.componentDidCatch(n.value,{componentStack:g!==null?g:""})})}function dp(e,t,a,n,o){if(a.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(t=a.alternate,t!==null&&Tr(t,a,o,!0),a=Ft.current,a!==null){switch(a.tag){case 31:case 13:return da===null?Jl():a.alternate===null&&lt===0&&(lt=3),a.flags&=-257,a.flags|=65536,a.lanes=o,n===xl?a.flags|=16384:(t=a.updateQueue,t===null?a.updateQueue=new Set([n]):t.add(n),ac(e,n,o)),!1;case 22:return a.flags|=65536,n===xl?a.flags|=16384:(t=a.updateQueue,t===null?(t={transitions:null,markerInstances:null,retryQueue:new Set([n])},a.updateQueue=t):(a=t.retryQueue,a===null?t.retryQueue=new Set([n]):a.add(n)),ac(e,n,o)),!1}throw Error(c(435,a.tag))}return ac(e,n,o),Jl(),!1}if(ze)return t=Ft.current,t!==null?((t.flags&65536)===0&&(t.flags|=256),t.flags|=65536,t.lanes=o,n!==Fi&&(e=Error(c(422),{cause:n}),ps(ia(e,a)))):(n!==Fi&&(t=Error(c(423),{cause:n}),ps(ia(t,a))),e=e.current.alternate,e.flags|=65536,o&=-o,e.lanes|=o,n=ia(n,a),o=Ao(e.stateNode,n,o),lo(e,o),lt!==4&&(lt=2)),!1;var u=Error(c(520),{cause:n});if(u=ia(u,a),zs===null?zs=[u]:zs.push(u),lt!==4&&(lt=2),t===null)return!0;n=ia(n,a),a=t;do{switch(a.tag){case 3:return a.flags|=65536,e=o&-o,a.lanes|=e,e=Ao(a.stateNode,n,e),lo(a,e),!1;case 1:if(t=a.type,u=a.stateNode,(a.flags&128)===0&&(typeof t.getDerivedStateFromError=="function"||u!==null&&typeof u.componentDidCatch=="function"&&(kn===null||!kn.has(u))))return a.flags|=65536,o&=-o,a.lanes|=o,o=Kd(o),Jd(o,e,a,n),lo(a,o),!1}a=a.return}while(a!==null);return!1}var Oo=Error(c(461)),_t=!1;function kt(e,t,a,n){t.child=e===null?Pu(t,null,a,n):sr(t,e.child,a,n)}function Fd(e,t,a,n,o){a=a.render;var u=t.ref;if("ref"in n){var m={};for(var g in n)g!=="ref"&&(m[g]=n[g])}else m=n;return tr(t),n=mo(e,t,a,m,u,o),g=ho(),e!==null&&!_t?(po(e,t,o),en(e,t,o)):(ze&&g&&Ki(t),t.flags|=1,kt(e,t,n,o),t.child)}function Wd(e,t,a,n,o){if(e===null){var u=a.type;return typeof u=="function"&&!Xi(u)&&u.defaultProps===void 0&&a.compare===null?(t.tag=15,t.type=u,$d(e,t,u,n,o)):(e=_l(a.type,null,n,t,t.mode,o),e.ref=t.ref,e.return=t,t.child=e)}if(u=e.child,!Bo(e,o)){var m=u.memoizedProps;if(a=a.compare,a=a!==null?a:fs,a(m,n)&&e.ref===t.ref)return en(e,t,o)}return t.flags|=1,e=Ja(u,n),e.ref=t.ref,e.return=t,t.child=e}function $d(e,t,a,n,o){if(e!==null){var u=e.memoizedProps;if(fs(u,n)&&e.ref===t.ref)if(_t=!1,t.pendingProps=n=u,Bo(e,o))(e.flags&131072)!==0&&(_t=!0);else return t.lanes=e.lanes,en(e,t,o)}return ko(e,t,a,n,o)}function Pd(e,t,a,n){var o=n.children,u=e!==null?e.memoizedState:null;if(e===null&&t.stateNode===null&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if((t.flags&128)!==0){if(u=u!==null?u.baseLanes|a:a,e!==null){for(n=t.child=e.child,o=0;n!==null;)o=o|n.lanes|n.childLanes,n=n.sibling;n=o&~u}else n=0,t.child=null;return Id(e,t,u,a,n)}if((a&536870912)!==0)t.memoizedState={baseLanes:0,cachePool:null},e!==null&&jl(t,u!==null?u.cachePool:null),u!==null?td(t,u):oo(),ad(t);else return n=t.lanes=536870912,Id(e,t,u!==null?u.baseLanes|a:a,a,n)}else u!==null?(jl(t,u.cachePool),td(t,u),Dn(),t.memoizedState=null):(e!==null&&jl(t,null),oo(),Dn());return kt(e,t,o,a),t.child}function Cs(e,t){return e!==null&&e.tag===22||t.stateNode!==null||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Id(e,t,a,n,o){var u=ao();return u=u===null?null:{parent:pt._currentValue,pool:u},t.memoizedState={baseLanes:a,cachePool:u},e!==null&&jl(t,null),oo(),ad(t),e!==null&&Tr(e,t,n,!0),t.childLanes=o,null}function Ul(e,t){return t=Ll({mode:t.mode,children:t.children},e.mode),t.ref=e.ref,e.child=t,t.return=e,t}function ef(e,t,a){return sr(t,e.child,null,a),e=Ul(t,t.pendingProps),e.flags|=2,Wt(t),t.memoizedState=null,e}function fp(e,t,a){var n=t.pendingProps,o=(t.flags&128)!==0;if(t.flags&=-129,e===null){if(ze){if(n.mode==="hidden")return e=Ul(t,n),t.lanes=536870912,Cs(null,e);if(uo(t),(e=tt)?(e=mm(e,ua),e=e!==null&&e.data==="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:jn!==null?{id:Aa,overflow:Oa}:null,retryLane:536870912,hydrationErrors:null},a=Uu(e),a.return=t,t.child=a,At=t,tt=null)):e=null,e===null)throw xn(t);return t.lanes=536870912,null}return Ul(t,n)}var u=e.memoizedState;if(u!==null){var m=u.dehydrated;if(uo(t),o)if(t.flags&256)t.flags&=-257,t=ef(e,t,a);else if(t.memoizedState!==null)t.child=e.child,t.flags|=128,t=null;else throw Error(c(558));else if(_t||Tr(e,t,a,!1),o=(a&e.childLanes)!==0,_t||o){if(n=Ie,n!==null&&(m=el(n,a),m!==0&&m!==u.retryLane))throw u.retryLane=m,$n(e,m),Zt(n,e,m),Oo;Jl(),t=ef(e,t,a)}else e=u.treeContext,tt=fa(m.nextSibling),At=t,ze=!0,Sn=null,ua=!1,e!==null&&Bu(t,e),t=Ul(t,n),t.flags|=4096;return t}return e=Ja(e.child,{mode:n.mode,children:n.children}),e.ref=t.ref,t.child=e,e.return=t,e}function Hl(e,t){var a=t.ref;if(a===null)e!==null&&e.ref!==null&&(t.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(c(284));(e===null||e.ref!==a)&&(t.flags|=4194816)}}function ko(e,t,a,n,o){return tr(t),a=mo(e,t,a,n,void 0,o),n=ho(),e!==null&&!_t?(po(e,t,o),en(e,t,o)):(ze&&n&&Ki(t),t.flags|=1,kt(e,t,a,o),t.child)}function tf(e,t,a,n,o,u){return tr(t),t.updateQueue=null,a=rd(t,n,a,o),nd(e),n=ho(),e!==null&&!_t?(po(e,t,u),en(e,t,u)):(ze&&n&&Ki(t),t.flags|=1,kt(e,t,a,u),t.child)}function af(e,t,a,n,o){if(tr(t),t.stateNode===null){var u=Er,m=a.contextType;typeof m=="object"&&m!==null&&(u=Ot(m)),u=new a(n,u),t.memoizedState=u.state!==null&&u.state!==void 0?u.state:null,u.updater=To,t.stateNode=u,u._reactInternals=t,u=t.stateNode,u.props=n,u.state=t.memoizedState,u.refs={},ro(t),m=a.contextType,u.context=typeof m=="object"&&m!==null?Ot(m):Er,u.state=t.memoizedState,m=a.getDerivedStateFromProps,typeof m=="function"&&(Do(t,a,m,n),u.state=t.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof u.getSnapshotBeforeUpdate=="function"||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(m=u.state,typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),m!==u.state&&To.enqueueReplaceState(u,u.state,null),Ss(t,n,u,o),js(),u.state=t.memoizedState),typeof u.componentDidMount=="function"&&(t.flags|=4194308),n=!0}else if(e===null){u=t.stateNode;var g=t.memoizedProps,b=ir(a,g);u.props=b;var C=u.context,H=a.contextType;m=Er,typeof H=="object"&&H!==null&&(m=Ot(H));var B=a.getDerivedStateFromProps;H=typeof B=="function"||typeof u.getSnapshotBeforeUpdate=="function",g=t.pendingProps!==g,H||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(g||C!==m)&&Gd(t,u,n,m),Nn=!1;var A=t.memoizedState;u.state=A,Ss(t,n,u,o),js(),C=t.memoizedState,g||A!==C||Nn?(typeof B=="function"&&(Do(t,a,B,n),C=t.memoizedState),(b=Nn||Yd(t,a,b,n,A,C,m))?(H||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount()),typeof u.componentDidMount=="function"&&(t.flags|=4194308)):(typeof u.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=C),u.props=n,u.state=C,u.context=m,n=b):(typeof u.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{u=t.stateNode,so(e,t),m=t.memoizedProps,H=ir(a,m),u.props=H,B=t.pendingProps,A=u.context,C=a.contextType,b=Er,typeof C=="object"&&C!==null&&(b=Ot(C)),g=a.getDerivedStateFromProps,(C=typeof g=="function"||typeof u.getSnapshotBeforeUpdate=="function")||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(m!==B||A!==b)&&Gd(t,u,n,b),Nn=!1,A=t.memoizedState,u.state=A,Ss(t,n,u,o),js();var O=t.memoizedState;m!==B||A!==O||Nn||e!==null&&e.dependencies!==null&&vl(e.dependencies)?(typeof g=="function"&&(Do(t,a,g,n),O=t.memoizedState),(H=Nn||Yd(t,a,H,n,A,O,b)||e!==null&&e.dependencies!==null&&vl(e.dependencies))?(C||typeof u.UNSAFE_componentWillUpdate!="function"&&typeof u.componentWillUpdate!="function"||(typeof u.componentWillUpdate=="function"&&u.componentWillUpdate(n,O,b),typeof u.UNSAFE_componentWillUpdate=="function"&&u.UNSAFE_componentWillUpdate(n,O,b)),typeof u.componentDidUpdate=="function"&&(t.flags|=4),typeof u.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof u.componentDidUpdate!="function"||m===e.memoizedProps&&A===e.memoizedState||(t.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||m===e.memoizedProps&&A===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=O),u.props=n,u.state=O,u.context=b,n=H):(typeof u.componentDidUpdate!="function"||m===e.memoizedProps&&A===e.memoizedState||(t.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||m===e.memoizedProps&&A===e.memoizedState||(t.flags|=1024),n=!1)}return u=n,Hl(e,t),n=(t.flags&128)!==0,u||n?(u=t.stateNode,a=n&&typeof a.getDerivedStateFromError!="function"?null:u.render(),t.flags|=1,e!==null&&n?(t.child=sr(t,e.child,null,o),t.child=sr(t,null,a,o)):kt(e,t,a,o),t.memoizedState=u.state,e=t.child):e=en(e,t,o),e}function nf(e,t,a,n){return In(),t.flags|=256,kt(e,t,a,n),t.child}var zo={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Mo(e){return{baseLanes:e,cachePool:Zu()}}function Ro(e,t,a){return e=e!==null?e.childLanes&~a:0,t&&(e|=Pt),e}function rf(e,t,a){var n=t.pendingProps,o=!1,u=(t.flags&128)!==0,m;if((m=u)||(m=e!==null&&e.memoizedState===null?!1:(ct.current&2)!==0),m&&(o=!0,t.flags&=-129),m=(t.flags&32)!==0,t.flags&=-33,e===null){if(ze){if(o?qn(t):Dn(),(e=tt)?(e=mm(e,ua),e=e!==null&&e.data!=="&"?e:null,e!==null&&(t.memoizedState={dehydrated:e,treeContext:jn!==null?{id:Aa,overflow:Oa}:null,retryLane:536870912,hydrationErrors:null},a=Uu(e),a.return=t,t.child=a,At=t,tt=null)):e=null,e===null)throw xn(t);return yc(e)?t.lanes=32:t.lanes=536870912,null}var g=n.children;return n=n.fallback,o?(Dn(),o=t.mode,g=Ll({mode:"hidden",children:g},o),n=Pn(n,o,a,null),g.return=t,n.return=t,g.sibling=n,t.child=g,n=t.child,n.memoizedState=Mo(a),n.childLanes=Ro(e,m,a),t.memoizedState=zo,Cs(null,n)):(qn(t),Uo(t,g))}var b=e.memoizedState;if(b!==null&&(g=b.dehydrated,g!==null)){if(u)t.flags&256?(qn(t),t.flags&=-257,t=Ho(e,t,a)):t.memoizedState!==null?(Dn(),t.child=e.child,t.flags|=128,t=null):(Dn(),g=n.fallback,o=t.mode,n=Ll({mode:"visible",children:n.children},o),g=Pn(g,o,a,null),g.flags|=2,n.return=t,g.return=t,n.sibling=g,t.child=n,sr(t,e.child,null,a),n=t.child,n.memoizedState=Mo(a),n.childLanes=Ro(e,m,a),t.memoizedState=zo,t=Cs(null,n));else if(qn(t),yc(g)){if(m=g.nextSibling&&g.nextSibling.dataset,m)var C=m.dgst;m=C,n=Error(c(419)),n.stack="",n.digest=m,ps({value:n,source:null,stack:null}),t=Ho(e,t,a)}else if(_t||Tr(e,t,a,!1),m=(a&e.childLanes)!==0,_t||m){if(m=Ie,m!==null&&(n=el(m,a),n!==0&&n!==b.retryLane))throw b.retryLane=n,$n(e,n),Zt(m,e,n),Oo;_c(g)||Jl(),t=Ho(e,t,a)}else _c(g)?(t.flags|=192,t.child=e.child,t=null):(e=b.treeContext,tt=fa(g.nextSibling),At=t,ze=!0,Sn=null,ua=!1,e!==null&&Bu(t,e),t=Uo(t,n.children),t.flags|=4096);return t}return o?(Dn(),g=n.fallback,o=t.mode,b=e.child,C=b.sibling,n=Ja(b,{mode:"hidden",children:n.children}),n.subtreeFlags=b.subtreeFlags&65011712,C!==null?g=Ja(C,g):(g=Pn(g,o,a,null),g.flags|=2),g.return=t,n.return=t,n.sibling=g,t.child=n,Cs(null,n),n=t.child,g=e.child.memoizedState,g===null?g=Mo(a):(o=g.cachePool,o!==null?(b=pt._currentValue,o=o.parent!==b?{parent:b,pool:b}:o):o=Zu(),g={baseLanes:g.baseLanes|a,cachePool:o}),n.memoizedState=g,n.childLanes=Ro(e,m,a),t.memoizedState=zo,Cs(e.child,n)):(qn(t),a=e.child,e=a.sibling,a=Ja(a,{mode:"visible",children:n.children}),a.return=t,a.sibling=null,e!==null&&(m=t.deletions,m===null?(t.deletions=[e],t.flags|=16):m.push(e)),t.child=a,t.memoizedState=null,a)}function Uo(e,t){return t=Ll({mode:"visible",children:t},e.mode),t.return=e,e.child=t}function Ll(e,t){return e=Jt(22,e,null,t),e.lanes=0,e}function Ho(e,t,a){return sr(t,e.child,null,a),e=Uo(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function sf(e,t,a){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),Pi(e.return,t,a)}function Lo(e,t,a,n,o,u){var m=e.memoizedState;m===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:a,tailMode:o,treeForkCount:u}:(m.isBackwards=t,m.rendering=null,m.renderingStartTime=0,m.last=n,m.tail=a,m.tailMode=o,m.treeForkCount=u)}function lf(e,t,a){var n=t.pendingProps,o=n.revealOrder,u=n.tail;n=n.children;var m=ct.current,g=(m&2)!==0;if(g?(m=m&1|2,t.flags|=128):m&=1,he(ct,m),kt(e,t,n,a),n=ze?hs:0,!g&&e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&sf(e,a,t);else if(e.tag===19)sf(e,a,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(o){case"forwards":for(a=t.child,o=null;a!==null;)e=a.alternate,e!==null&&Cl(e)===null&&(o=a),a=a.sibling;a=o,a===null?(o=t.child,t.child=null):(o=a.sibling,a.sibling=null),Lo(t,!1,o,a,u,n);break;case"backwards":case"unstable_legacy-backwards":for(a=null,o=t.child,t.child=null;o!==null;){if(e=o.alternate,e!==null&&Cl(e)===null){t.child=o;break}e=o.sibling,o.sibling=a,a=o,o=e}Lo(t,!0,a,null,u,n);break;case"together":Lo(t,!1,null,null,void 0,n);break;default:t.memoizedState=null}return t.child}function en(e,t,a){if(e!==null&&(t.dependencies=e.dependencies),On|=t.lanes,(a&t.childLanes)===0)if(e!==null){if(Tr(e,t,a,!1),(a&t.childLanes)===0)return null}else return null;if(e!==null&&t.child!==e.child)throw Error(c(153));if(t.child!==null){for(e=t.child,a=Ja(e,e.pendingProps),t.child=a,a.return=t;e.sibling!==null;)e=e.sibling,a=a.sibling=Ja(e,e.pendingProps),a.return=t;a.sibling=null}return t.child}function Bo(e,t){return(e.lanes&t)!==0?!0:(e=e.dependencies,!!(e!==null&&vl(e)))}function mp(e,t,a){switch(t.tag){case 3:ae(t,t.stateNode.containerInfo),wn(t,pt,e.memoizedState.cache),In();break;case 27:case 5:Je(t);break;case 4:ae(t,t.stateNode.containerInfo);break;case 10:wn(t,t.type,t.memoizedProps.value);break;case 31:if(t.memoizedState!==null)return t.flags|=128,uo(t),null;break;case 13:var n=t.memoizedState;if(n!==null)return n.dehydrated!==null?(qn(t),t.flags|=128,null):(a&t.child.childLanes)!==0?rf(e,t,a):(qn(t),e=en(e,t,a),e!==null?e.sibling:null);qn(t);break;case 19:var o=(e.flags&128)!==0;if(n=(a&t.childLanes)!==0,n||(Tr(e,t,a,!1),n=(a&t.childLanes)!==0),o){if(n)return lf(e,t,a);t.flags|=128}if(o=t.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),he(ct,ct.current),n)break;return null;case 22:return t.lanes=0,Pd(e,t,a,t.pendingProps);case 24:wn(t,pt,e.memoizedState.cache)}return en(e,t,a)}function of(e,t,a){if(e!==null)if(e.memoizedProps!==t.pendingProps)_t=!0;else{if(!Bo(e,a)&&(t.flags&128)===0)return _t=!1,mp(e,t,a);_t=(e.flags&131072)!==0}else _t=!1,ze&&(t.flags&1048576)!==0&&Lu(t,hs,t.index);switch(t.lanes=0,t.tag){case 16:e:{var n=t.pendingProps;if(e=nr(t.elementType),t.type=e,typeof e=="function")Xi(e)?(n=ir(e,n),t.tag=1,t=af(null,t,e,n,a)):(t.tag=0,t=ko(null,t,e,n,a));else{if(e!=null){var o=e.$$typeof;if(o===se){t.tag=11,t=Fd(null,t,e,n,a);break e}else if(o===Ve){t.tag=14,t=Wd(null,t,e,n,a);break e}}throw t=ge(e)||e,Error(c(306,t,""))}}return t;case 0:return ko(e,t,t.type,t.pendingProps,a);case 1:return n=t.type,o=ir(n,t.pendingProps),af(e,t,n,o,a);case 3:e:{if(ae(t,t.stateNode.containerInfo),e===null)throw Error(c(387));n=t.pendingProps;var u=t.memoizedState;o=u.element,so(e,t),Ss(t,n,null,a);var m=t.memoizedState;if(n=m.cache,wn(t,pt,n),n!==u.cache&&Ii(t,[pt],a,!0),js(),n=m.element,u.isDehydrated)if(u={element:n,isDehydrated:!1,cache:m.cache},t.updateQueue.baseState=u,t.memoizedState=u,t.flags&256){t=nf(e,t,n,a);break e}else if(n!==o){o=ia(Error(c(424)),t),ps(o),t=nf(e,t,n,a);break e}else{switch(e=t.stateNode.containerInfo,e.nodeType){case 9:e=e.body;break;default:e=e.nodeName==="HTML"?e.ownerDocument.body:e}for(tt=fa(e.firstChild),At=t,ze=!0,Sn=null,ua=!0,a=Pu(t,null,n,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling}else{if(In(),n===o){t=en(e,t,a);break e}kt(e,t,n,a)}t=t.child}return t;case 26:return Hl(e,t),e===null?(a=vm(t.type,null,t.pendingProps,null))?t.memoizedState=a:ze||(a=t.type,e=t.pendingProps,n=ti(ce.current).createElement(a),n[et]=t,n[Mt]=e,zt(n,a,e),ht(n),t.stateNode=n):t.memoizedState=vm(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return Je(t),e===null&&ze&&(n=t.stateNode=gm(t.type,t.pendingProps,ce.current),At=t,ua=!0,o=tt,Un(t.type)?(vc=o,tt=fa(n.firstChild)):tt=o),kt(e,t,t.pendingProps.children,a),Hl(e,t),e===null&&(t.flags|=4194304),t.child;case 5:return e===null&&ze&&((o=n=tt)&&(n=Qp(n,t.type,t.pendingProps,ua),n!==null?(t.stateNode=n,At=t,tt=fa(n.firstChild),ua=!1,o=!0):o=!1),o||xn(t)),Je(t),o=t.type,u=t.pendingProps,m=e!==null?e.memoizedProps:null,n=u.children,hc(o,u)?n=null:m!==null&&hc(o,m)&&(t.flags|=32),t.memoizedState!==null&&(o=mo(e,t,rp,null,null,a),Gs._currentValue=o),Hl(e,t),kt(e,t,n,a),t.child;case 6:return e===null&&ze&&((e=a=tt)&&(a=Xp(a,t.pendingProps,ua),a!==null?(t.stateNode=a,At=t,tt=null,e=!0):e=!1),e||xn(t)),null;case 13:return rf(e,t,a);case 4:return ae(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=sr(t,null,n,a):kt(e,t,n,a),t.child;case 11:return Fd(e,t,t.type,t.pendingProps,a);case 7:return kt(e,t,t.pendingProps,a),t.child;case 8:return kt(e,t,t.pendingProps.children,a),t.child;case 12:return kt(e,t,t.pendingProps.children,a),t.child;case 10:return n=t.pendingProps,wn(t,t.type,n.value),kt(e,t,n.children,a),t.child;case 9:return o=t.type._context,n=t.pendingProps.children,tr(t),o=Ot(o),n=n(o),t.flags|=1,kt(e,t,n,a),t.child;case 14:return Wd(e,t,t.type,t.pendingProps,a);case 15:return $d(e,t,t.type,t.pendingProps,a);case 19:return lf(e,t,a);case 31:return fp(e,t,a);case 22:return Pd(e,t,a,t.pendingProps);case 24:return tr(t),n=Ot(pt),e===null?(o=ao(),o===null&&(o=Ie,u=eo(),o.pooledCache=u,u.refCount++,u!==null&&(o.pooledCacheLanes|=a),o=u),t.memoizedState={parent:n,cache:o},ro(t),wn(t,pt,o)):((e.lanes&a)!==0&&(so(e,t),Ss(t,null,null,a),js()),o=e.memoizedState,u=t.memoizedState,o.parent!==n?(o={parent:n,cache:n},t.memoizedState=o,t.lanes===0&&(t.memoizedState=t.updateQueue.baseState=o),wn(t,pt,n)):(n=u.cache,wn(t,pt,n),n!==o.cache&&Ii(t,[pt],a,!0))),kt(e,t,t.pendingProps.children,a),t.child;case 29:throw t.pendingProps}throw Error(c(156,t.tag))}function tn(e){e.flags|=4}function Yo(e,t,a,n,o){if((t=(e.mode&32)!==0)&&(t=!1),t){if(e.flags|=16777216,(o&335544128)===o)if(e.stateNode.complete)e.flags|=8192;else if(Mf())e.flags|=8192;else throw rr=xl,no}else e.flags&=-16777217}function cf(e,t){if(t.type!=="stylesheet"||(t.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!wm(t))if(Mf())e.flags|=8192;else throw rr=xl,no}function Bl(e,t){t!==null&&(e.flags|=4),e.flags&16384&&(t=e.tag!==22?V():536870912,e.lanes|=t,Gr|=t)}function qs(e,t){if(!ze)switch(e.tailMode){case"hidden":t=e.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var n=null;a!==null;)a.alternate!==null&&(n=a),a=a.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function at(e){var t=e.alternate!==null&&e.alternate.child===e.child,a=0,n=0;if(t)for(var o=e.child;o!==null;)a|=o.lanes|o.childLanes,n|=o.subtreeFlags&65011712,n|=o.flags&65011712,o.return=e,o=o.sibling;else for(o=e.child;o!==null;)a|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=e,o=o.sibling;return e.subtreeFlags|=n,e.childLanes=a,t}function hp(e,t,a){var n=t.pendingProps;switch(Ji(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return at(t),null;case 1:return at(t),null;case 3:return a=t.stateNode,n=null,e!==null&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),$a(pt),we(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(e===null||e.child===null)&&(Dr(t)?tn(t):e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,Wi())),at(t),null;case 26:var o=t.type,u=t.memoizedState;return e===null?(tn(t),u!==null?(at(t),cf(t,u)):(at(t),Yo(t,o,null,n,a))):u?u!==e.memoizedState?(tn(t),at(t),cf(t,u)):(at(t),t.flags&=-16777217):(e=e.memoizedProps,e!==n&&tn(t),at(t),Yo(t,o,e,n,a)),null;case 27:if(Re(t),a=ce.current,o=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==n&&tn(t);else{if(!n){if(t.stateNode===null)throw Error(c(166));return at(t),null}e=Ne.current,Dr(t)?Yu(t):(e=gm(o,n,a),t.stateNode=e,tn(t))}return at(t),null;case 5:if(Re(t),o=t.type,e!==null&&t.stateNode!=null)e.memoizedProps!==n&&tn(t);else{if(!n){if(t.stateNode===null)throw Error(c(166));return at(t),null}if(u=Ne.current,Dr(t))Yu(t);else{var m=ti(ce.current);switch(u){case 1:u=m.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:u=m.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":u=m.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":u=m.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":u=m.createElement("div"),u.innerHTML="<script><\/script>",u=u.removeChild(u.firstChild);break;case"select":u=typeof n.is=="string"?m.createElement("select",{is:n.is}):m.createElement("select"),n.multiple?u.multiple=!0:n.size&&(u.size=n.size);break;default:u=typeof n.is=="string"?m.createElement(o,{is:n.is}):m.createElement(o)}}u[et]=t,u[Mt]=n;e:for(m=t.child;m!==null;){if(m.tag===5||m.tag===6)u.appendChild(m.stateNode);else if(m.tag!==4&&m.tag!==27&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;m=m.return}m.sibling.return=m.return,m=m.sibling}t.stateNode=u;e:switch(zt(u,o,n),o){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&tn(t)}}return at(t),Yo(t,t.type,e===null?null:e.memoizedProps,t.pendingProps,a),null;case 6:if(e&&t.stateNode!=null)e.memoizedProps!==n&&tn(t);else{if(typeof n!="string"&&t.stateNode===null)throw Error(c(166));if(e=ce.current,Dr(t)){if(e=t.stateNode,a=t.memoizedProps,n=null,o=At,o!==null)switch(o.tag){case 27:case 5:n=o.memoizedProps}e[et]=t,e=!!(e.nodeValue===a||n!==null&&n.suppressHydrationWarning===!0||sm(e.nodeValue,a)),e||xn(t,!0)}else e=ti(e).createTextNode(n),e[et]=t,t.stateNode=e}return at(t),null;case 31:if(a=t.memoizedState,e===null||e.memoizedState!==null){if(n=Dr(t),a!==null){if(e===null){if(!n)throw Error(c(318));if(e=t.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(c(557));e[et]=t}else In(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;at(t),e=!1}else a=Wi(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=a),e=!0;if(!e)return t.flags&256?(Wt(t),t):(Wt(t),null);if((t.flags&128)!==0)throw Error(c(558))}return at(t),null;case 13:if(n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(o=Dr(t),n!==null&&n.dehydrated!==null){if(e===null){if(!o)throw Error(c(318));if(o=t.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(c(317));o[et]=t}else In(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;at(t),o=!1}else o=Wi(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=o),o=!0;if(!o)return t.flags&256?(Wt(t),t):(Wt(t),null)}return Wt(t),(t.flags&128)!==0?(t.lanes=a,t):(a=n!==null,e=e!==null&&e.memoizedState!==null,a&&(n=t.child,o=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(o=n.alternate.memoizedState.cachePool.pool),u=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(u=n.memoizedState.cachePool.pool),u!==o&&(n.flags|=2048)),a!==e&&a&&(t.child.flags|=8192),Bl(t,t.updateQueue),at(t),null);case 4:return we(),e===null&&cc(t.stateNode.containerInfo),at(t),null;case 10:return $a(t.type),at(t),null;case 19:if(J(ct),n=t.memoizedState,n===null)return at(t),null;if(o=(t.flags&128)!==0,u=n.rendering,u===null)if(o)qs(n,!1);else{if(lt!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(u=Cl(e),u!==null){for(t.flags|=128,qs(n,!1),e=u.updateQueue,t.updateQueue=e,Bl(t,e),t.subtreeFlags=0,e=a,a=t.child;a!==null;)Ru(a,e),a=a.sibling;return he(ct,ct.current&1|2),ze&&Fa(t,n.treeForkCount),t.child}e=e.sibling}n.tail!==null&&vt()>Vl&&(t.flags|=128,o=!0,qs(n,!1),t.lanes=4194304)}else{if(!o)if(e=Cl(u),e!==null){if(t.flags|=128,o=!0,e=e.updateQueue,t.updateQueue=e,Bl(t,e),qs(n,!0),n.tail===null&&n.tailMode==="hidden"&&!u.alternate&&!ze)return at(t),null}else 2*vt()-n.renderingStartTime>Vl&&a!==536870912&&(t.flags|=128,o=!0,qs(n,!1),t.lanes=4194304);n.isBackwards?(u.sibling=t.child,t.child=u):(e=n.last,e!==null?e.sibling=u:t.child=u,n.last=u)}return n.tail!==null?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.renderingStartTime=vt(),e.sibling=null,a=ct.current,he(ct,o?a&1|2:a&1),ze&&Fa(t,n.treeForkCount),e):(at(t),null);case 22:case 23:return Wt(t),co(),n=t.memoizedState!==null,e!==null?e.memoizedState!==null!==n&&(t.flags|=8192):n&&(t.flags|=8192),n?(a&536870912)!==0&&(t.flags&128)===0&&(at(t),t.subtreeFlags&6&&(t.flags|=8192)):at(t),a=t.updateQueue,a!==null&&Bl(t,a.retryQueue),a=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),n=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),n!==a&&(t.flags|=2048),e!==null&&J(ar),null;case 24:return a=null,e!==null&&(a=e.memoizedState.cache),t.memoizedState.cache!==a&&(t.flags|=2048),$a(pt),at(t),null;case 25:return null;case 30:return null}throw Error(c(156,t.tag))}function pp(e,t){switch(Ji(t),t.tag){case 1:return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return $a(pt),we(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 26:case 27:case 5:return Re(t),null;case 31:if(t.memoizedState!==null){if(Wt(t),t.alternate===null)throw Error(c(340));In()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 13:if(Wt(t),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(c(340));In()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return J(ct),null;case 4:return we(),null;case 10:return $a(t.type),null;case 22:case 23:return Wt(t),co(),e!==null&&J(ar),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 24:return $a(pt),null;case 25:return null;default:return null}}function uf(e,t){switch(Ji(t),t.tag){case 3:$a(pt),we();break;case 26:case 27:case 5:Re(t);break;case 4:we();break;case 31:t.memoizedState!==null&&Wt(t);break;case 13:Wt(t);break;case 19:J(ct);break;case 10:$a(t.type);break;case 22:case 23:Wt(t),co(),e!==null&&J(ar);break;case 24:$a(pt)}}function Ds(e,t){try{var a=t.updateQueue,n=a!==null?a.lastEffect:null;if(n!==null){var o=n.next;a=o;do{if((a.tag&e)===e){n=void 0;var u=a.create,m=a.inst;n=u(),m.destroy=n}a=a.next}while(a!==o)}}catch(g){Ke(t,t.return,g)}}function Tn(e,t,a){try{var n=t.updateQueue,o=n!==null?n.lastEffect:null;if(o!==null){var u=o.next;n=u;do{if((n.tag&e)===e){var m=n.inst,g=m.destroy;if(g!==void 0){m.destroy=void 0,o=t;var b=a,C=g;try{C()}catch(H){Ke(o,b,H)}}}n=n.next}while(n!==u)}}catch(H){Ke(t,t.return,H)}}function df(e){var t=e.updateQueue;if(t!==null){var a=e.stateNode;try{ed(t,a)}catch(n){Ke(e,e.return,n)}}}function ff(e,t,a){a.props=ir(e.type,e.memoizedProps),a.state=e.memoizedState;try{a.componentWillUnmount()}catch(n){Ke(e,t,n)}}function Ts(e,t){try{var a=e.ref;if(a!==null){switch(e.tag){case 26:case 27:case 5:var n=e.stateNode;break;case 30:n=e.stateNode;break;default:n=e.stateNode}typeof a=="function"?e.refCleanup=a(n):a.current=n}}catch(o){Ke(e,t,o)}}function ka(e,t){var a=e.ref,n=e.refCleanup;if(a!==null)if(typeof n=="function")try{n()}catch(o){Ke(e,t,o)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(o){Ke(e,t,o)}else a.current=null}function mf(e){var t=e.type,a=e.memoizedProps,n=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":a.autoFocus&&n.focus();break e;case"img":a.src?n.src=a.src:a.srcSet&&(n.srcset=a.srcSet)}}catch(o){Ke(e,e.return,o)}}function Go(e,t,a){try{var n=e.stateNode;Up(n,e.type,a,t),n[Mt]=t}catch(o){Ke(e,e.return,o)}}function hf(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Un(e.type)||e.tag===4}function Qo(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||hf(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Un(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Xo(e,t,a){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(e,t):(t=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,t.appendChild(e),a=a._reactRootContainer,a!=null||t.onclick!==null||(t.onclick=Za));else if(n!==4&&(n===27&&Un(e.type)&&(a=e.stateNode,t=null),e=e.child,e!==null))for(Xo(e,t,a),e=e.sibling;e!==null;)Xo(e,t,a),e=e.sibling}function Yl(e,t,a){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?a.insertBefore(e,t):a.appendChild(e);else if(n!==4&&(n===27&&Un(e.type)&&(a=e.stateNode),e=e.child,e!==null))for(Yl(e,t,a),e=e.sibling;e!==null;)Yl(e,t,a),e=e.sibling}function pf(e){var t=e.stateNode,a=e.memoizedProps;try{for(var n=e.type,o=t.attributes;o.length;)t.removeAttributeNode(o[0]);zt(t,n,a),t[et]=e,t[Mt]=a}catch(u){Ke(e,e.return,u)}}var an=!1,yt=!1,Vo=!1,gf=typeof WeakSet=="function"?WeakSet:Set,Ct=null;function gp(e,t){if(e=e.containerInfo,fc=oi,e=Cu(e),Ui(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var n=a.getSelection&&a.getSelection();if(n&&n.rangeCount!==0){a=n.anchorNode;var o=n.anchorOffset,u=n.focusNode;n=n.focusOffset;try{a.nodeType,u.nodeType}catch{a=null;break e}var m=0,g=-1,b=-1,C=0,H=0,B=e,A=null;t:for(;;){for(var O;B!==a||o!==0&&B.nodeType!==3||(g=m+o),B!==u||n!==0&&B.nodeType!==3||(b=m+n),B.nodeType===3&&(m+=B.nodeValue.length),(O=B.firstChild)!==null;)A=B,B=O;for(;;){if(B===e)break t;if(A===a&&++C===o&&(g=m),A===u&&++H===n&&(b=m),(O=B.nextSibling)!==null)break;B=A,A=B.parentNode}B=O}a=g===-1||b===-1?null:{start:g,end:b}}else a=null}a=a||{start:0,end:0}}else a=null;for(mc={focusedElem:e,selectionRange:a},oi=!1,Ct=t;Ct!==null;)if(t=Ct,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Ct=e;else for(;Ct!==null;){switch(t=Ct,u=t.alternate,e=t.flags,t.tag){case 0:if((e&4)!==0&&(e=t.updateQueue,e=e!==null?e.events:null,e!==null))for(a=0;a<e.length;a++)o=e[a],o.ref.impl=o.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&u!==null){e=void 0,a=t,o=u.memoizedProps,u=u.memoizedState,n=a.stateNode;try{var ne=ir(a.type,o);e=n.getSnapshotBeforeUpdate(ne,u),n.__reactInternalSnapshotBeforeUpdate=e}catch(pe){Ke(a,a.return,pe)}}break;case 3:if((e&1024)!==0){if(e=t.stateNode.containerInfo,a=e.nodeType,a===9)gc(e);else if(a===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":gc(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(c(163))}if(e=t.sibling,e!==null){e.return=t.return,Ct=e;break}Ct=t.return}}function _f(e,t,a){var n=a.flags;switch(a.tag){case 0:case 11:case 15:rn(e,a),n&4&&Ds(5,a);break;case 1:if(rn(e,a),n&4)if(e=a.stateNode,t===null)try{e.componentDidMount()}catch(m){Ke(a,a.return,m)}else{var o=ir(a.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(o,t,e.__reactInternalSnapshotBeforeUpdate)}catch(m){Ke(a,a.return,m)}}n&64&&df(a),n&512&&Ts(a,a.return);break;case 3:if(rn(e,a),n&64&&(e=a.updateQueue,e!==null)){if(t=null,a.child!==null)switch(a.child.tag){case 27:case 5:t=a.child.stateNode;break;case 1:t=a.child.stateNode}try{ed(e,t)}catch(m){Ke(a,a.return,m)}}break;case 27:t===null&&n&4&&pf(a);case 26:case 5:rn(e,a),t===null&&n&4&&mf(a),n&512&&Ts(a,a.return);break;case 12:rn(e,a);break;case 31:rn(e,a),n&4&&bf(e,a);break;case 13:rn(e,a),n&4&&jf(e,a),n&64&&(e=a.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(a=Np.bind(null,a),Vp(e,a))));break;case 22:if(n=a.memoizedState!==null||an,!n){t=t!==null&&t.memoizedState!==null||yt,o=an;var u=yt;an=n,(yt=t)&&!u?sn(e,a,(a.subtreeFlags&8772)!==0):rn(e,a),an=o,yt=u}break;case 30:break;default:rn(e,a)}}function yf(e){var t=e.alternate;t!==null&&(e.alternate=null,yf(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&yr(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var rt=null,Gt=!1;function nn(e,t,a){for(a=a.child;a!==null;)vf(e,t,a),a=a.sibling}function vf(e,t,a){if(Et&&typeof Et.onCommitFiberUnmount=="function")try{Et.onCommitFiberUnmount(_a,a)}catch{}switch(a.tag){case 26:yt||ka(a,t),nn(e,t,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:yt||ka(a,t);var n=rt,o=Gt;Un(a.type)&&(rt=a.stateNode,Gt=!1),nn(e,t,a),Ls(a.stateNode),rt=n,Gt=o;break;case 5:yt||ka(a,t);case 6:if(n=rt,o=Gt,rt=null,nn(e,t,a),rt=n,Gt=o,rt!==null)if(Gt)try{(rt.nodeType===9?rt.body:rt.nodeName==="HTML"?rt.ownerDocument.body:rt).removeChild(a.stateNode)}catch(u){Ke(a,t,u)}else try{rt.removeChild(a.stateNode)}catch(u){Ke(a,t,u)}break;case 18:rt!==null&&(Gt?(e=rt,dm(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,a.stateNode),Wr(e)):dm(rt,a.stateNode));break;case 4:n=rt,o=Gt,rt=a.stateNode.containerInfo,Gt=!0,nn(e,t,a),rt=n,Gt=o;break;case 0:case 11:case 14:case 15:Tn(2,a,t),yt||Tn(4,a,t),nn(e,t,a);break;case 1:yt||(ka(a,t),n=a.stateNode,typeof n.componentWillUnmount=="function"&&ff(a,t,n)),nn(e,t,a);break;case 21:nn(e,t,a);break;case 22:yt=(n=yt)||a.memoizedState!==null,nn(e,t,a),yt=n;break;default:nn(e,t,a)}}function bf(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{Wr(e)}catch(a){Ke(t,t.return,a)}}}function jf(e,t){if(t.memoizedState===null&&(e=t.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{Wr(e)}catch(a){Ke(t,t.return,a)}}function _p(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return t===null&&(t=e.stateNode=new gf),t;case 22:return e=e.stateNode,t=e._retryCache,t===null&&(t=e._retryCache=new gf),t;default:throw Error(c(435,e.tag))}}function Gl(e,t){var a=_p(e);t.forEach(function(n){if(!a.has(n)){a.add(n);var o=Ep.bind(null,e,n);n.then(o,o)}})}function Qt(e,t){var a=t.deletions;if(a!==null)for(var n=0;n<a.length;n++){var o=a[n],u=e,m=t,g=m;e:for(;g!==null;){switch(g.tag){case 27:if(Un(g.type)){rt=g.stateNode,Gt=!1;break e}break;case 5:rt=g.stateNode,Gt=!1;break e;case 3:case 4:rt=g.stateNode.containerInfo,Gt=!0;break e}g=g.return}if(rt===null)throw Error(c(160));vf(u,m,o),rt=null,Gt=!1,u=o.alternate,u!==null&&(u.return=null),o.return=null}if(t.subtreeFlags&13886)for(t=t.child;t!==null;)Sf(t,e),t=t.sibling}var xa=null;function Sf(e,t){var a=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Qt(t,e),Xt(e),n&4&&(Tn(3,e,e.return),Ds(3,e),Tn(5,e,e.return));break;case 1:Qt(t,e),Xt(e),n&512&&(yt||a===null||ka(a,a.return)),n&64&&an&&(e=e.updateQueue,e!==null&&(n=e.callbacks,n!==null&&(a=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=a===null?n:a.concat(n))));break;case 26:var o=xa;if(Qt(t,e),Xt(e),n&512&&(yt||a===null||ka(a,a.return)),n&4){var u=a!==null?a.memoizedState:null;if(n=e.memoizedState,a===null)if(n===null)if(e.stateNode===null){e:{n=e.type,a=e.memoizedProps,o=o.ownerDocument||o;t:switch(n){case"title":u=o.getElementsByTagName("title")[0],(!u||u[Kn]||u[et]||u.namespaceURI==="http://www.w3.org/2000/svg"||u.hasAttribute("itemprop"))&&(u=o.createElement(n),o.head.insertBefore(u,o.querySelector("head > title"))),zt(u,n,a),u[et]=e,ht(u),n=u;break e;case"link":var m=Sm("link","href",o).get(n+(a.href||""));if(m){for(var g=0;g<m.length;g++)if(u=m[g],u.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&u.getAttribute("rel")===(a.rel==null?null:a.rel)&&u.getAttribute("title")===(a.title==null?null:a.title)&&u.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){m.splice(g,1);break t}}u=o.createElement(n),zt(u,n,a),o.head.appendChild(u);break;case"meta":if(m=Sm("meta","content",o).get(n+(a.content||""))){for(g=0;g<m.length;g++)if(u=m[g],u.getAttribute("content")===(a.content==null?null:""+a.content)&&u.getAttribute("name")===(a.name==null?null:a.name)&&u.getAttribute("property")===(a.property==null?null:a.property)&&u.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&u.getAttribute("charset")===(a.charSet==null?null:a.charSet)){m.splice(g,1);break t}}u=o.createElement(n),zt(u,n,a),o.head.appendChild(u);break;default:throw Error(c(468,n))}u[et]=e,ht(u),n=u}e.stateNode=n}else xm(o,e.type,e.stateNode);else e.stateNode=jm(o,n,e.memoizedProps);else u!==n?(u===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):u.count--,n===null?xm(o,e.type,e.stateNode):jm(o,n,e.memoizedProps)):n===null&&e.stateNode!==null&&Go(e,e.memoizedProps,a.memoizedProps)}break;case 27:Qt(t,e),Xt(e),n&512&&(yt||a===null||ka(a,a.return)),a!==null&&n&4&&Go(e,e.memoizedProps,a.memoizedProps);break;case 5:if(Qt(t,e),Xt(e),n&512&&(yt||a===null||ka(a,a.return)),e.flags&32){o=e.stateNode;try{q(o,"")}catch(ne){Ke(e,e.return,ne)}}n&4&&e.stateNode!=null&&(o=e.memoizedProps,Go(e,o,a!==null?a.memoizedProps:o)),n&1024&&(Vo=!0);break;case 6:if(Qt(t,e),Xt(e),n&4){if(e.stateNode===null)throw Error(c(162));n=e.memoizedProps,a=e.stateNode;try{a.nodeValue=n}catch(ne){Ke(e,e.return,ne)}}break;case 3:if(ri=null,o=xa,xa=ai(t.containerInfo),Qt(t,e),xa=o,Xt(e),n&4&&a!==null&&a.memoizedState.isDehydrated)try{Wr(t.containerInfo)}catch(ne){Ke(e,e.return,ne)}Vo&&(Vo=!1,xf(e));break;case 4:n=xa,xa=ai(e.stateNode.containerInfo),Qt(t,e),Xt(e),xa=n;break;case 12:Qt(t,e),Xt(e);break;case 31:Qt(t,e),Xt(e),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,Gl(e,n)));break;case 13:Qt(t,e),Xt(e),e.child.flags&8192&&e.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(Xl=vt()),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,Gl(e,n)));break;case 22:o=e.memoizedState!==null;var b=a!==null&&a.memoizedState!==null,C=an,H=yt;if(an=C||o,yt=H||b,Qt(t,e),yt=H,an=C,Xt(e),n&8192)e:for(t=e.stateNode,t._visibility=o?t._visibility&-2:t._visibility|1,o&&(a===null||b||an||yt||or(e)),a=null,t=e;;){if(t.tag===5||t.tag===26){if(a===null){b=a=t;try{if(u=b.stateNode,o)m=u.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none";else{g=b.stateNode;var B=b.memoizedProps.style,A=B!=null&&B.hasOwnProperty("display")?B.display:null;g.style.display=A==null||typeof A=="boolean"?"":(""+A).trim()}}catch(ne){Ke(b,b.return,ne)}}}else if(t.tag===6){if(a===null){b=t;try{b.stateNode.nodeValue=o?"":b.memoizedProps}catch(ne){Ke(b,b.return,ne)}}}else if(t.tag===18){if(a===null){b=t;try{var O=b.stateNode;o?fm(O,!0):fm(b.stateNode,!1)}catch(ne){Ke(b,b.return,ne)}}}else if((t.tag!==22&&t.tag!==23||t.memoizedState===null||t===e)&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;a===t&&(a=null),t=t.return}a===t&&(a=null),t.sibling.return=t.return,t=t.sibling}n&4&&(n=e.updateQueue,n!==null&&(a=n.retryQueue,a!==null&&(n.retryQueue=null,Gl(e,a))));break;case 19:Qt(t,e),Xt(e),n&4&&(n=e.updateQueue,n!==null&&(e.updateQueue=null,Gl(e,n)));break;case 30:break;case 21:break;default:Qt(t,e),Xt(e)}}function Xt(e){var t=e.flags;if(t&2){try{for(var a,n=e.return;n!==null;){if(hf(n)){a=n;break}n=n.return}if(a==null)throw Error(c(160));switch(a.tag){case 27:var o=a.stateNode,u=Qo(e);Yl(e,u,o);break;case 5:var m=a.stateNode;a.flags&32&&(q(m,""),a.flags&=-33);var g=Qo(e);Yl(e,g,m);break;case 3:case 4:var b=a.stateNode.containerInfo,C=Qo(e);Xo(e,C,b);break;default:throw Error(c(161))}}catch(H){Ke(e,e.return,H)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function xf(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var t=e;xf(t),t.tag===5&&t.flags&1024&&t.stateNode.reset(),e=e.sibling}}function rn(e,t){if(t.subtreeFlags&8772)for(t=t.child;t!==null;)_f(e,t.alternate,t),t=t.sibling}function or(e){for(e=e.child;e!==null;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:Tn(4,t,t.return),or(t);break;case 1:ka(t,t.return);var a=t.stateNode;typeof a.componentWillUnmount=="function"&&ff(t,t.return,a),or(t);break;case 27:Ls(t.stateNode);case 26:case 5:ka(t,t.return),or(t);break;case 22:t.memoizedState===null&&or(t);break;case 30:or(t);break;default:or(t)}e=e.sibling}}function sn(e,t,a){for(a=a&&(t.subtreeFlags&8772)!==0,t=t.child;t!==null;){var n=t.alternate,o=e,u=t,m=u.flags;switch(u.tag){case 0:case 11:case 15:sn(o,u,a),Ds(4,u);break;case 1:if(sn(o,u,a),n=u,o=n.stateNode,typeof o.componentDidMount=="function")try{o.componentDidMount()}catch(C){Ke(n,n.return,C)}if(n=u,o=n.updateQueue,o!==null){var g=n.stateNode;try{var b=o.shared.hiddenCallbacks;if(b!==null)for(o.shared.hiddenCallbacks=null,o=0;o<b.length;o++)Iu(b[o],g)}catch(C){Ke(n,n.return,C)}}a&&m&64&&df(u),Ts(u,u.return);break;case 27:pf(u);case 26:case 5:sn(o,u,a),a&&n===null&&m&4&&mf(u),Ts(u,u.return);break;case 12:sn(o,u,a);break;case 31:sn(o,u,a),a&&m&4&&bf(o,u);break;case 13:sn(o,u,a),a&&m&4&&jf(o,u);break;case 22:u.memoizedState===null&&sn(o,u,a),Ts(u,u.return);break;case 30:break;default:sn(o,u,a)}t=t.sibling}}function Zo(e,t){var a=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(a=e.memoizedState.cachePool.pool),e=null,t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(e=t.memoizedState.cachePool.pool),e!==a&&(e!=null&&e.refCount++,a!=null&&gs(a))}function Ko(e,t){e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&gs(e))}function wa(e,t,a,n){if(t.subtreeFlags&10256)for(t=t.child;t!==null;)wf(e,t,a,n),t=t.sibling}function wf(e,t,a,n){var o=t.flags;switch(t.tag){case 0:case 11:case 15:wa(e,t,a,n),o&2048&&Ds(9,t);break;case 1:wa(e,t,a,n);break;case 3:wa(e,t,a,n),o&2048&&(e=null,t.alternate!==null&&(e=t.alternate.memoizedState.cache),t=t.memoizedState.cache,t!==e&&(t.refCount++,e!=null&&gs(e)));break;case 12:if(o&2048){wa(e,t,a,n),e=t.stateNode;try{var u=t.memoizedProps,m=u.id,g=u.onPostCommit;typeof g=="function"&&g(m,t.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(b){Ke(t,t.return,b)}}else wa(e,t,a,n);break;case 31:wa(e,t,a,n);break;case 13:wa(e,t,a,n);break;case 23:break;case 22:u=t.stateNode,m=t.alternate,t.memoizedState!==null?u._visibility&2?wa(e,t,a,n):As(e,t):u._visibility&2?wa(e,t,a,n):(u._visibility|=2,Lr(e,t,a,n,(t.subtreeFlags&10256)!==0||!1)),o&2048&&Zo(m,t);break;case 24:wa(e,t,a,n),o&2048&&Ko(t.alternate,t);break;default:wa(e,t,a,n)}}function Lr(e,t,a,n,o){for(o=o&&((t.subtreeFlags&10256)!==0||!1),t=t.child;t!==null;){var u=e,m=t,g=a,b=n,C=m.flags;switch(m.tag){case 0:case 11:case 15:Lr(u,m,g,b,o),Ds(8,m);break;case 23:break;case 22:var H=m.stateNode;m.memoizedState!==null?H._visibility&2?Lr(u,m,g,b,o):As(u,m):(H._visibility|=2,Lr(u,m,g,b,o)),o&&C&2048&&Zo(m.alternate,m);break;case 24:Lr(u,m,g,b,o),o&&C&2048&&Ko(m.alternate,m);break;default:Lr(u,m,g,b,o)}t=t.sibling}}function As(e,t){if(t.subtreeFlags&10256)for(t=t.child;t!==null;){var a=e,n=t,o=n.flags;switch(n.tag){case 22:As(a,n),o&2048&&Zo(n.alternate,n);break;case 24:As(a,n),o&2048&&Ko(n.alternate,n);break;default:As(a,n)}t=t.sibling}}var Os=8192;function Br(e,t,a){if(e.subtreeFlags&Os)for(e=e.child;e!==null;)Nf(e,t,a),e=e.sibling}function Nf(e,t,a){switch(e.tag){case 26:Br(e,t,a),e.flags&Os&&e.memoizedState!==null&&ng(a,xa,e.memoizedState,e.memoizedProps);break;case 5:Br(e,t,a);break;case 3:case 4:var n=xa;xa=ai(e.stateNode.containerInfo),Br(e,t,a),xa=n;break;case 22:e.memoizedState===null&&(n=e.alternate,n!==null&&n.memoizedState!==null?(n=Os,Os=16777216,Br(e,t,a),Os=n):Br(e,t,a));break;default:Br(e,t,a)}}function Ef(e){var t=e.alternate;if(t!==null&&(e=t.child,e!==null)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(e!==null)}}function ks(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var n=t[a];Ct=n,qf(n,e)}Ef(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Cf(e),e=e.sibling}function Cf(e){switch(e.tag){case 0:case 11:case 15:ks(e),e.flags&2048&&Tn(9,e,e.return);break;case 3:ks(e);break;case 12:ks(e);break;case 22:var t=e.stateNode;e.memoizedState!==null&&t._visibility&2&&(e.return===null||e.return.tag!==13)?(t._visibility&=-3,Ql(e)):ks(e);break;default:ks(e)}}function Ql(e){var t=e.deletions;if((e.flags&16)!==0){if(t!==null)for(var a=0;a<t.length;a++){var n=t[a];Ct=n,qf(n,e)}Ef(e)}for(e=e.child;e!==null;){switch(t=e,t.tag){case 0:case 11:case 15:Tn(8,t,t.return),Ql(t);break;case 22:a=t.stateNode,a._visibility&2&&(a._visibility&=-3,Ql(t));break;default:Ql(t)}e=e.sibling}}function qf(e,t){for(;Ct!==null;){var a=Ct;switch(a.tag){case 0:case 11:case 15:Tn(8,a,t);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var n=a.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:gs(a.memoizedState.cache)}if(n=a.child,n!==null)n.return=a,Ct=n;else e:for(a=e;Ct!==null;){n=Ct;var o=n.sibling,u=n.return;if(yf(n),n===a){Ct=null;break e}if(o!==null){o.return=u,Ct=o;break e}Ct=u}}}var yp={getCacheForType:function(e){var t=Ot(pt),a=t.data.get(e);return a===void 0&&(a=e(),t.data.set(e,a)),a},cacheSignal:function(){return Ot(pt).controller.signal}},vp=typeof WeakMap=="function"?WeakMap:Map,Qe=0,Ie=null,qe=null,Oe=0,Ze=0,$t=null,An=!1,Yr=!1,Jo=!1,ln=0,lt=0,On=0,cr=0,Fo=0,Pt=0,Gr=0,zs=null,Vt=null,Wo=!1,Xl=0,Df=0,Vl=1/0,Zl=null,kn=null,xt=0,zn=null,Qr=null,on=0,$o=0,Po=null,Tf=null,Ms=0,Io=null;function It(){return(Qe&2)!==0&&Oe!==0?Oe&-Oe:D.T!==null?sc():tl()}function Af(){if(Pt===0)if((Oe&536870912)===0||ze){var e=gn;gn<<=1,(gn&3932160)===0&&(gn=262144),Pt=e}else Pt=536870912;return e=Ft.current,e!==null&&(e.flags|=32),Pt}function Zt(e,t,a){(e===Ie&&(Ze===2||Ze===9)||e.cancelPendingCommit!==null)&&(Xr(e,0),Mn(e,Oe,Pt,!1)),va(e,a),((Qe&2)===0||e!==Ie)&&(e===Ie&&((Qe&2)===0&&(cr|=a),lt===4&&Mn(e,Oe,Pt,!1)),za(e))}function Of(e,t,a){if((Qe&6)!==0)throw Error(c(327));var n=!a&&(t&127)===0&&(t&e.expiredLanes)===0||Ea(e,t),o=n?Sp(e,t):tc(e,t,!0),u=n;do{if(o===0){Yr&&!n&&Mn(e,t,0,!1);break}else{if(a=e.current.alternate,u&&!bp(a)){o=tc(e,t,!1),u=!1;continue}if(o===2){if(u=t,e.errorRecoveryDisabledLanes&u)var m=0;else m=e.pendingLanes&-536870913,m=m!==0?m:m&536870912?536870912:0;if(m!==0){t=m;e:{var g=e;o=zs;var b=g.current.memoizedState.isDehydrated;if(b&&(Xr(g,m).flags|=256),m=tc(g,m,!1),m!==2){if(Jo&&!b){g.errorRecoveryDisabledLanes|=u,cr|=u,o=4;break e}u=Vt,Vt=o,u!==null&&(Vt===null?Vt=u:Vt.push.apply(Vt,u))}o=m}if(u=!1,o!==2)continue}}if(o===1){Xr(e,0),Mn(e,t,0,!0);break}e:{switch(n=e,u=o,u){case 0:case 1:throw Error(c(345));case 4:if((t&4194048)!==t)break;case 6:Mn(n,t,Pt,!An);break e;case 2:Vt=null;break;case 3:case 5:break;default:throw Error(c(329))}if((t&62914560)===t&&(o=Xl+300-vt(),10<o)){if(Mn(n,t,Pt,!An),Na(n,0,!0)!==0)break e;on=t,n.timeoutHandle=cm(kf.bind(null,n,a,Vt,Zl,Wo,t,Pt,cr,Gr,An,u,"Throttled",-0,0),o);break e}kf(n,a,Vt,Zl,Wo,t,Pt,cr,Gr,An,u,null,-0,0)}}break}while(!0);za(e)}function kf(e,t,a,n,o,u,m,g,b,C,H,B,A,O){if(e.timeoutHandle=-1,B=t.subtreeFlags,B&8192||(B&16785408)===16785408){B={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Za},Nf(t,u,B);var ne=(u&62914560)===u?Xl-vt():(u&4194048)===u?Df-vt():0;if(ne=rg(B,ne),ne!==null){on=u,e.cancelPendingCommit=ne(Yf.bind(null,e,t,u,a,n,o,m,g,b,H,B,null,A,O)),Mn(e,u,m,!C);return}}Yf(e,t,u,a,n,o,m,g,b)}function bp(e){for(var t=e;;){var a=t.tag;if((a===0||a===11||a===15)&&t.flags&16384&&(a=t.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var n=0;n<a.length;n++){var o=a[n],u=o.getSnapshot;o=o.value;try{if(!Kt(u(),o))return!1}catch{return!1}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Mn(e,t,a,n){t&=~Fo,t&=~cr,e.suspendedLanes|=t,e.pingedLanes&=~t,n&&(e.warmLanes|=t),n=e.expirationTimes;for(var o=t;0<o;){var u=31-Dt(o),m=1<<u;n[u]=-1,o&=~m}a!==0&&Is(e,a,t)}function Kl(){return(Qe&6)===0?(Rs(0),!1):!0}function ec(){if(qe!==null){if(Ze===0)var e=qe.return;else e=qe,Wa=er=null,go(e),zr=null,ys=0,e=qe;for(;e!==null;)uf(e.alternate,e),e=e.return;qe=null}}function Xr(e,t){var a=e.timeoutHandle;a!==-1&&(e.timeoutHandle=-1,Bp(a)),a=e.cancelPendingCommit,a!==null&&(e.cancelPendingCommit=null,a()),on=0,ec(),Ie=e,qe=a=Ja(e.current,null),Oe=t,Ze=0,$t=null,An=!1,Yr=Ea(e,t),Jo=!1,Gr=Pt=Fo=cr=On=lt=0,Vt=zs=null,Wo=!1,(t&8)!==0&&(t|=t&32);var n=e.entangledLanes;if(n!==0)for(e=e.entanglements,n&=t;0<n;){var o=31-Dt(n),u=1<<o;t|=e[o],n&=~u}return ln=t,hl(),a}function zf(e,t){je=null,D.H=Es,t===kr||t===Sl?(t=Fu(),Ze=3):t===no?(t=Fu(),Ze=4):Ze=t===Oo?8:t!==null&&typeof t=="object"&&typeof t.then=="function"?6:1,$t=t,qe===null&&(lt=1,Rl(e,ia(t,e.current)))}function Mf(){var e=Ft.current;return e===null?!0:(Oe&4194048)===Oe?da===null:(Oe&62914560)===Oe||(Oe&536870912)!==0?e===da:!1}function Rf(){var e=D.H;return D.H=Es,e===null?Es:e}function Uf(){var e=D.A;return D.A=yp,e}function Jl(){lt=4,An||(Oe&4194048)!==Oe&&Ft.current!==null||(Yr=!0),(On&134217727)===0&&(cr&134217727)===0||Ie===null||Mn(Ie,Oe,Pt,!1)}function tc(e,t,a){var n=Qe;Qe|=2;var o=Rf(),u=Uf();(Ie!==e||Oe!==t)&&(Zl=null,Xr(e,t)),t=!1;var m=lt;e:do try{if(Ze!==0&&qe!==null){var g=qe,b=$t;switch(Ze){case 8:ec(),m=6;break e;case 3:case 2:case 9:case 6:Ft.current===null&&(t=!0);var C=Ze;if(Ze=0,$t=null,Vr(e,g,b,C),a&&Yr){m=0;break e}break;default:C=Ze,Ze=0,$t=null,Vr(e,g,b,C)}}jp(),m=lt;break}catch(H){zf(e,H)}while(!0);return t&&e.shellSuspendCounter++,Wa=er=null,Qe=n,D.H=o,D.A=u,qe===null&&(Ie=null,Oe=0,hl()),m}function jp(){for(;qe!==null;)Hf(qe)}function Sp(e,t){var a=Qe;Qe|=2;var n=Rf(),o=Uf();Ie!==e||Oe!==t?(Zl=null,Vl=vt()+500,Xr(e,t)):Yr=Ea(e,t);e:do try{if(Ze!==0&&qe!==null){t=qe;var u=$t;t:switch(Ze){case 1:Ze=0,$t=null,Vr(e,t,u,1);break;case 2:case 9:if(Ku(u)){Ze=0,$t=null,Lf(t);break}t=function(){Ze!==2&&Ze!==9||Ie!==e||(Ze=7),za(e)},u.then(t,t);break e;case 3:Ze=7;break e;case 4:Ze=5;break e;case 7:Ku(u)?(Ze=0,$t=null,Lf(t)):(Ze=0,$t=null,Vr(e,t,u,7));break;case 5:var m=null;switch(qe.tag){case 26:m=qe.memoizedState;case 5:case 27:var g=qe;if(m?wm(m):g.stateNode.complete){Ze=0,$t=null;var b=g.sibling;if(b!==null)qe=b;else{var C=g.return;C!==null?(qe=C,Fl(C)):qe=null}break t}}Ze=0,$t=null,Vr(e,t,u,5);break;case 6:Ze=0,$t=null,Vr(e,t,u,6);break;case 8:ec(),lt=6;break e;default:throw Error(c(462))}}xp();break}catch(H){zf(e,H)}while(!0);return Wa=er=null,D.H=n,D.A=o,Qe=a,qe!==null?0:(Ie=null,Oe=0,hl(),lt)}function xp(){for(;qe!==null&&!hn();)Hf(qe)}function Hf(e){var t=of(e.alternate,e,ln);e.memoizedProps=e.pendingProps,t===null?Fl(e):qe=t}function Lf(e){var t=e,a=t.alternate;switch(t.tag){case 15:case 0:t=tf(a,t,t.pendingProps,t.type,void 0,Oe);break;case 11:t=tf(a,t,t.pendingProps,t.type.render,t.ref,Oe);break;case 5:go(t);default:uf(a,t),t=qe=Ru(t,ln),t=of(a,t,ln)}e.memoizedProps=e.pendingProps,t===null?Fl(e):qe=t}function Vr(e,t,a,n){Wa=er=null,go(t),zr=null,ys=0;var o=t.return;try{if(dp(e,o,t,a,Oe)){lt=1,Rl(e,ia(a,e.current)),qe=null;return}}catch(u){if(o!==null)throw qe=o,u;lt=1,Rl(e,ia(a,e.current)),qe=null;return}t.flags&32768?(ze||n===1?e=!0:Yr||(Oe&536870912)!==0?e=!1:(An=e=!0,(n===2||n===9||n===3||n===6)&&(n=Ft.current,n!==null&&n.tag===13&&(n.flags|=16384))),Bf(t,e)):Fl(t)}function Fl(e){var t=e;do{if((t.flags&32768)!==0){Bf(t,An);return}e=t.return;var a=hp(t.alternate,t,ln);if(a!==null){qe=a;return}if(t=t.sibling,t!==null){qe=t;return}qe=t=e}while(t!==null);lt===0&&(lt=5)}function Bf(e,t){do{var a=pp(e.alternate,e);if(a!==null){a.flags&=32767,qe=a;return}if(a=e.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!t&&(e=e.sibling,e!==null)){qe=e;return}qe=e=a}while(e!==null);lt=6,qe=null}function Yf(e,t,a,n,o,u,m,g,b){e.cancelPendingCommit=null;do Wl();while(xt!==0);if((Qe&6)!==0)throw Error(c(327));if(t!==null){if(t===e.current)throw Error(c(177));if(u=t.lanes|t.childLanes,u|=Gi,Ps(e,a,u,m,g,b),e===Ie&&(qe=Ie=null,Oe=0),Qr=t,zn=e,on=a,$o=u,Po=o,Tf=n,(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,Cp(ra,function(){return Zf(),null})):(e.callbackNode=null,e.callbackPriority=0),n=(t.flags&13878)!==0,(t.subtreeFlags&13878)!==0||n){n=D.T,D.T=null,o=Q.p,Q.p=2,m=Qe,Qe|=4;try{gp(e,t,a)}finally{Qe=m,Q.p=o,D.T=n}}xt=1,Gf(),Qf(),Xf()}}function Gf(){if(xt===1){xt=0;var e=zn,t=Qr,a=(t.flags&13878)!==0;if((t.subtreeFlags&13878)!==0||a){a=D.T,D.T=null;var n=Q.p;Q.p=2;var o=Qe;Qe|=4;try{Sf(t,e);var u=mc,m=Cu(e.containerInfo),g=u.focusedElem,b=u.selectionRange;if(m!==g&&g&&g.ownerDocument&&Eu(g.ownerDocument.documentElement,g)){if(b!==null&&Ui(g)){var C=b.start,H=b.end;if(H===void 0&&(H=C),"selectionStart"in g)g.selectionStart=C,g.selectionEnd=Math.min(H,g.value.length);else{var B=g.ownerDocument||document,A=B&&B.defaultView||window;if(A.getSelection){var O=A.getSelection(),ne=g.textContent.length,pe=Math.min(b.start,ne),Pe=b.end===void 0?pe:Math.min(b.end,ne);!O.extend&&pe>Pe&&(m=Pe,Pe=pe,pe=m);var N=Nu(g,pe),j=Nu(g,Pe);if(N&&j&&(O.rangeCount!==1||O.anchorNode!==N.node||O.anchorOffset!==N.offset||O.focusNode!==j.node||O.focusOffset!==j.offset)){var E=B.createRange();E.setStart(N.node,N.offset),O.removeAllRanges(),pe>Pe?(O.addRange(E),O.extend(j.node,j.offset)):(E.setEnd(j.node,j.offset),O.addRange(E))}}}}for(B=[],O=g;O=O.parentNode;)O.nodeType===1&&B.push({element:O,left:O.scrollLeft,top:O.scrollTop});for(typeof g.focus=="function"&&g.focus(),g=0;g<B.length;g++){var L=B[g];L.element.scrollLeft=L.left,L.element.scrollTop=L.top}}oi=!!fc,mc=fc=null}finally{Qe=o,Q.p=n,D.T=a}}e.current=t,xt=2}}function Qf(){if(xt===2){xt=0;var e=zn,t=Qr,a=(t.flags&8772)!==0;if((t.subtreeFlags&8772)!==0||a){a=D.T,D.T=null;var n=Q.p;Q.p=2;var o=Qe;Qe|=4;try{_f(e,t.alternate,t)}finally{Qe=o,Q.p=n,D.T=a}}xt=3}}function Xf(){if(xt===4||xt===3){xt=0,pn();var e=zn,t=Qr,a=on,n=Tf;(t.subtreeFlags&10256)!==0||(t.flags&10256)!==0?xt=5:(xt=0,Qr=zn=null,Vf(e,e.pendingLanes));var o=e.pendingLanes;if(o===0&&(kn=null),ts(a),t=t.stateNode,Et&&typeof Et.onCommitFiberRoot=="function")try{Et.onCommitFiberRoot(_a,t,void 0,(t.current.flags&128)===128)}catch{}if(n!==null){t=D.T,o=Q.p,Q.p=2,D.T=null;try{for(var u=e.onRecoverableError,m=0;m<n.length;m++){var g=n[m];u(g.value,{componentStack:g.stack})}}finally{D.T=t,Q.p=o}}(on&3)!==0&&Wl(),za(e),o=e.pendingLanes,(a&261930)!==0&&(o&42)!==0?e===Io?Ms++:(Ms=0,Io=e):Ms=0,Rs(0)}}function Vf(e,t){(e.pooledCacheLanes&=t)===0&&(t=e.pooledCache,t!=null&&(e.pooledCache=null,gs(t)))}function Wl(){return Gf(),Qf(),Xf(),Zf()}function Zf(){if(xt!==5)return!1;var e=zn,t=$o;$o=0;var a=ts(on),n=D.T,o=Q.p;try{Q.p=32>a?32:a,D.T=null,a=Po,Po=null;var u=zn,m=on;if(xt=0,Qr=zn=null,on=0,(Qe&6)!==0)throw Error(c(331));var g=Qe;if(Qe|=4,Cf(u.current),wf(u,u.current,m,a),Qe=g,Rs(0,!1),Et&&typeof Et.onPostCommitFiberRoot=="function")try{Et.onPostCommitFiberRoot(_a,u)}catch{}return!0}finally{Q.p=o,D.T=n,Vf(e,t)}}function Kf(e,t,a){t=ia(a,t),t=Ao(e.stateNode,t,2),e=Cn(e,t,2),e!==null&&(va(e,2),za(e))}function Ke(e,t,a){if(e.tag===3)Kf(e,e,a);else for(;t!==null;){if(t.tag===3){Kf(t,e,a);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(kn===null||!kn.has(n))){e=ia(a,e),a=Kd(2),n=Cn(t,a,2),n!==null&&(Jd(a,n,t,e),va(n,2),za(n));break}}t=t.return}}function ac(e,t,a){var n=e.pingCache;if(n===null){n=e.pingCache=new vp;var o=new Set;n.set(t,o)}else o=n.get(t),o===void 0&&(o=new Set,n.set(t,o));o.has(a)||(Jo=!0,o.add(a),e=wp.bind(null,e,t,a),t.then(e,e))}function wp(e,t,a){var n=e.pingCache;n!==null&&n.delete(t),e.pingedLanes|=e.suspendedLanes&a,e.warmLanes&=~a,Ie===e&&(Oe&a)===a&&(lt===4||lt===3&&(Oe&62914560)===Oe&&300>vt()-Xl?(Qe&2)===0&&Xr(e,0):Fo|=a,Gr===Oe&&(Gr=0)),za(e)}function Jf(e,t){t===0&&(t=V()),e=$n(e,t),e!==null&&(va(e,t),za(e))}function Np(e){var t=e.memoizedState,a=0;t!==null&&(a=t.retryLane),Jf(e,a)}function Ep(e,t){var a=0;switch(e.tag){case 31:case 13:var n=e.stateNode,o=e.memoizedState;o!==null&&(a=o.retryLane);break;case 19:n=e.stateNode;break;case 22:n=e.stateNode._retryCache;break;default:throw Error(c(314))}n!==null&&n.delete(t),Jf(e,a)}function Cp(e,t){return Qn(e,t)}var $l=null,Zr=null,nc=!1,Pl=!1,rc=!1,Rn=0;function za(e){e!==Zr&&e.next===null&&(Zr===null?$l=Zr=e:Zr=Zr.next=e),Pl=!0,nc||(nc=!0,Dp())}function Rs(e,t){if(!rc&&Pl){rc=!0;do for(var a=!1,n=$l;n!==null;){if(e!==0){var o=n.pendingLanes;if(o===0)var u=0;else{var m=n.suspendedLanes,g=n.pingedLanes;u=(1<<31-Dt(42|e)+1)-1,u&=o&~(m&~g),u=u&201326741?u&201326741|1:u?u|2:0}u!==0&&(a=!0,Pf(n,u))}else u=Oe,u=Na(n,n===Ie?u:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),(u&3)===0||Ea(n,u)||(a=!0,Pf(n,u));n=n.next}while(a);rc=!1}}function qp(){Ff()}function Ff(){Pl=nc=!1;var e=0;Rn!==0&&Lp()&&(e=Rn);for(var t=vt(),a=null,n=$l;n!==null;){var o=n.next,u=Wf(n,t);u===0?(n.next=null,a===null?$l=o:a.next=o,o===null&&(Zr=a)):(a=n,(e!==0||(u&3)!==0)&&(Pl=!0)),n=o}xt!==0&&xt!==5||Rs(e),Rn!==0&&(Rn=0)}function Wf(e,t){for(var a=e.suspendedLanes,n=e.pingedLanes,o=e.expirationTimes,u=e.pendingLanes&-62914561;0<u;){var m=31-Dt(u),g=1<<m,b=o[m];b===-1?((g&a)===0||(g&n)!==0)&&(o[m]=mt(g,t)):b<=t&&(e.expiredLanes|=g),u&=~g}if(t=Ie,a=Oe,a=Na(e,e===t?a:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),n=e.callbackNode,a===0||e===t&&(Ze===2||Ze===9)||e.cancelPendingCommit!==null)return n!==null&&n!==null&&Ra(n),e.callbackNode=null,e.callbackPriority=0;if((a&3)===0||Ea(e,a)){if(t=a&-a,t===e.callbackPriority)return t;switch(n!==null&&Ra(n),ts(a)){case 2:case 8:a=Vn;break;case 32:a=ra;break;case 268435456:a=bt;break;default:a=ra}return n=$f.bind(null,e),a=Qn(a,n),e.callbackPriority=t,e.callbackNode=a,t}return n!==null&&n!==null&&Ra(n),e.callbackPriority=2,e.callbackNode=null,2}function $f(e,t){if(xt!==0&&xt!==5)return e.callbackNode=null,e.callbackPriority=0,null;var a=e.callbackNode;if(Wl()&&e.callbackNode!==a)return null;var n=Oe;return n=Na(e,e===Ie?n:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),n===0?null:(Of(e,n,t),Wf(e,vt()),e.callbackNode!=null&&e.callbackNode===a?$f.bind(null,e):null)}function Pf(e,t){if(Wl())return null;Of(e,t,!0)}function Dp(){Yp(function(){(Qe&6)!==0?Qn(Xn,qp):Ff()})}function sc(){if(Rn===0){var e=Ar;e===0&&(e=ya,ya<<=1,(ya&261888)===0&&(ya=256)),Rn=e}return Rn}function If(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:St(""+e)}function em(e,t){var a=t.ownerDocument.createElement("input");return a.name=t.name,a.value=t.value,e.id&&a.setAttribute("form",e.id),t.parentNode.insertBefore(a,t),e=new FormData(e),a.parentNode.removeChild(a),e}function Tp(e,t,a,n,o){if(t==="submit"&&a&&a.stateNode===o){var u=If((o[Mt]||null).action),m=n.submitter;m&&(t=(t=m[Mt]||null)?If(t.formAction):m.getAttribute("formAction"),t!==null&&(u=t,m=null));var g=new ul("action","action",null,n,o);e.push({event:g,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(Rn!==0){var b=m?em(o,m):new FormData(o);No(a,{pending:!0,data:b,method:o.method,action:u},null,b)}}else typeof u=="function"&&(g.preventDefault(),b=m?em(o,m):new FormData(o),No(a,{pending:!0,data:b,method:o.method,action:u},u,b))},currentTarget:o}]})}}for(var lc=0;lc<Yi.length;lc++){var ic=Yi[lc],Ap=ic.toLowerCase(),Op=ic[0].toUpperCase()+ic.slice(1);Sa(Ap,"on"+Op)}Sa(Tu,"onAnimationEnd"),Sa(Au,"onAnimationIteration"),Sa(Ou,"onAnimationStart"),Sa("dblclick","onDoubleClick"),Sa("focusin","onFocus"),Sa("focusout","onBlur"),Sa(Jh,"onTransitionRun"),Sa(Fh,"onTransitionStart"),Sa(Wh,"onTransitionCancel"),Sa(ku,"onTransitionEnd"),Ut("onMouseEnter",["mouseout","mouseover"]),Ut("onMouseLeave",["mouseout","mouseover"]),Ut("onPointerEnter",["pointerout","pointerover"]),Ut("onPointerLeave",["pointerout","pointerover"]),Qa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Qa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Qa("onBeforeInput",["compositionend","keypress","textInput","paste"]),Qa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Qa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Qa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Us="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kp=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Us));function tm(e,t){t=(t&4)!==0;for(var a=0;a<e.length;a++){var n=e[a],o=n.event;n=n.listeners;e:{var u=void 0;if(t)for(var m=n.length-1;0<=m;m--){var g=n[m],b=g.instance,C=g.currentTarget;if(g=g.listener,b!==u&&o.isPropagationStopped())break e;u=g,o.currentTarget=C;try{u(o)}catch(H){ml(H)}o.currentTarget=null,u=b}else for(m=0;m<n.length;m++){if(g=n[m],b=g.instance,C=g.currentTarget,g=g.listener,b!==u&&o.isPropagationStopped())break e;u=g,o.currentTarget=C;try{u(o)}catch(H){ml(H)}o.currentTarget=null,u=b}}}}function De(e,t){var a=t[qa];a===void 0&&(a=t[qa]=new Set);var n=e+"__bubble";a.has(n)||(am(t,e,2,!1),a.add(n))}function oc(e,t,a){var n=0;t&&(n|=4),am(a,e,n,t)}var Il="_reactListening"+Math.random().toString(36).slice(2);function cc(e){if(!e[Il]){e[Il]=!0,vr.forEach(function(a){a!=="selectionchange"&&(kp.has(a)||oc(a,!1,e),oc(a,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Il]||(t[Il]=!0,oc("selectionchange",!1,t))}}function am(e,t,a,n){switch(Am(t)){case 2:var o=ig;break;case 8:o=og;break;default:o=wc}a=o.bind(null,t,a,e),o=void 0,!qi||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(o=!0),n?o!==void 0?e.addEventListener(t,a,{capture:!0,passive:o}):e.addEventListener(t,a,!0):o!==void 0?e.addEventListener(t,a,{passive:o}):e.addEventListener(t,a,!1)}function uc(e,t,a,n,o){var u=n;if((t&1)===0&&(t&2)===0&&n!==null)e:for(;;){if(n===null)return;var m=n.tag;if(m===3||m===4){var g=n.stateNode.containerInfo;if(g===o)break;if(m===4)for(m=n.return;m!==null;){var b=m.tag;if((b===3||b===4)&&m.stateNode.containerInfo===o)return;m=m.return}for(;g!==null;){if(m=Tt(g),m===null)return;if(b=m.tag,b===5||b===6||b===26||b===27){n=u=m;continue e}g=g.parentNode}}n=n.return}lu(function(){var C=u,H=Ei(a),B=[];e:{var A=zu.get(e);if(A!==void 0){var O=ul,ne=e;switch(e){case"keypress":if(ol(a)===0)break e;case"keydown":case"keyup":O=Eh;break;case"focusin":ne="focus",O=Oi;break;case"focusout":ne="blur",O=Oi;break;case"beforeblur":case"afterblur":O=Oi;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":O=cu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":O=hh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":O=Dh;break;case Tu:case Au:case Ou:O=_h;break;case ku:O=Ah;break;case"scroll":case"scrollend":O=fh;break;case"wheel":O=kh;break;case"copy":case"cut":case"paste":O=vh;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":O=du;break;case"toggle":case"beforetoggle":O=Mh}var pe=(t&4)!==0,Pe=!pe&&(e==="scroll"||e==="scrollend"),N=pe?A!==null?A+"Capture":null:A;pe=[];for(var j=C,E;j!==null;){var L=j;if(E=L.stateNode,L=L.tag,L!==5&&L!==26&&L!==27||E===null||N===null||(L=ss(j,N),L!=null&&pe.push(Hs(j,L,E))),Pe)break;j=j.return}0<pe.length&&(A=new O(A,ne,null,a,H),B.push({event:A,listeners:pe}))}}if((t&7)===0){e:{if(A=e==="mouseover"||e==="pointerover",O=e==="mouseout"||e==="pointerout",A&&a!==Ni&&(ne=a.relatedTarget||a.fromElement)&&(Tt(ne)||ne[_n]))break e;if((O||A)&&(A=H.window===H?H:(A=H.ownerDocument)?A.defaultView||A.parentWindow:window,O?(ne=a.relatedTarget||a.toElement,O=C,ne=ne?Tt(ne):null,ne!==null&&(Pe=f(ne),pe=ne.tag,ne!==Pe||pe!==5&&pe!==27&&pe!==6)&&(ne=null)):(O=null,ne=C),O!==ne)){if(pe=cu,L="onMouseLeave",N="onMouseEnter",j="mouse",(e==="pointerout"||e==="pointerover")&&(pe=du,L="onPointerLeave",N="onPointerEnter",j="pointer"),Pe=O==null?A:Ga(O),E=ne==null?A:Ga(ne),A=new pe(L,j+"leave",O,a,H),A.target=Pe,A.relatedTarget=E,L=null,Tt(H)===C&&(pe=new pe(N,j+"enter",ne,a,H),pe.target=E,pe.relatedTarget=Pe,L=pe),Pe=L,O&&ne)t:{for(pe=zp,N=O,j=ne,E=0,L=N;L;L=pe(L))E++;L=0;for(var fe=j;fe;fe=pe(fe))L++;for(;0<E-L;)N=pe(N),E--;for(;0<L-E;)j=pe(j),L--;for(;E--;){if(N===j||j!==null&&N===j.alternate){pe=N;break t}N=pe(N),j=pe(j)}pe=null}else pe=null;O!==null&&nm(B,A,O,pe,!1),ne!==null&&Pe!==null&&nm(B,Pe,ne,pe,!0)}}e:{if(A=C?Ga(C):window,O=A.nodeName&&A.nodeName.toLowerCase(),O==="select"||O==="input"&&A.type==="file")var Be=vu;else if(_u(A))if(bu)Be=Vh;else{Be=Qh;var ie=Gh}else O=A.nodeName,!O||O.toLowerCase()!=="input"||A.type!=="checkbox"&&A.type!=="radio"?C&&le(C.elementType)&&(Be=vu):Be=Xh;if(Be&&(Be=Be(e,C))){yu(B,Be,a,H);break e}ie&&ie(e,A,C),e==="focusout"&&C&&A.type==="number"&&C.memoizedProps.value!=null&&rs(A,"number",A.value)}switch(ie=C?Ga(C):window,e){case"focusin":(_u(ie)||ie.contentEditable==="true")&&(xr=ie,Hi=C,ms=null);break;case"focusout":ms=Hi=xr=null;break;case"mousedown":Li=!0;break;case"contextmenu":case"mouseup":case"dragend":Li=!1,qu(B,a,H);break;case"selectionchange":if(Kh)break;case"keydown":case"keyup":qu(B,a,H)}var xe;if(zi)e:{switch(e){case"compositionstart":var ke="onCompositionStart";break e;case"compositionend":ke="onCompositionEnd";break e;case"compositionupdate":ke="onCompositionUpdate";break e}ke=void 0}else Sr?pu(e,a)&&(ke="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(ke="onCompositionStart");ke&&(fu&&a.locale!=="ko"&&(Sr||ke!=="onCompositionStart"?ke==="onCompositionEnd"&&Sr&&(xe=iu()):(bn=H,Di="value"in bn?bn.value:bn.textContent,Sr=!0)),ie=ei(C,ke),0<ie.length&&(ke=new uu(ke,e,null,a,H),B.push({event:ke,listeners:ie}),xe?ke.data=xe:(xe=gu(a),xe!==null&&(ke.data=xe)))),(xe=Uh?Hh(e,a):Lh(e,a))&&(ke=ei(C,"onBeforeInput"),0<ke.length&&(ie=new uu("onBeforeInput","beforeinput",null,a,H),B.push({event:ie,listeners:ke}),ie.data=xe)),Tp(B,e,C,a,H)}tm(B,t)})}function Hs(e,t,a){return{instance:e,listener:t,currentTarget:a}}function ei(e,t){for(var a=t+"Capture",n=[];e!==null;){var o=e,u=o.stateNode;if(o=o.tag,o!==5&&o!==26&&o!==27||u===null||(o=ss(e,a),o!=null&&n.unshift(Hs(e,o,u)),o=ss(e,t),o!=null&&n.push(Hs(e,o,u))),e.tag===3)return n;e=e.return}return[]}function zp(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function nm(e,t,a,n,o){for(var u=t._reactName,m=[];a!==null&&a!==n;){var g=a,b=g.alternate,C=g.stateNode;if(g=g.tag,b!==null&&b===n)break;g!==5&&g!==26&&g!==27||C===null||(b=C,o?(C=ss(a,u),C!=null&&m.unshift(Hs(a,C,b))):o||(C=ss(a,u),C!=null&&m.push(Hs(a,C,b)))),a=a.return}m.length!==0&&e.push({event:t,listeners:m})}var Mp=/\r\n?/g,Rp=/\u0000|\uFFFD/g;function rm(e){return(typeof e=="string"?e:""+e).replace(Mp,`
`).replace(Rp,"")}function sm(e,t){return t=rm(t),rm(e)===t}function $e(e,t,a,n,o,u){switch(a){case"children":typeof n=="string"?t==="body"||t==="textarea"&&n===""||q(e,n):(typeof n=="number"||typeof n=="bigint")&&t!=="body"&&q(e,""+n);break;case"className":ja(e,"class",n);break;case"tabIndex":ja(e,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":ja(e,a,n);break;case"style":ue(e,n,u);break;case"data":if(t!=="object"){ja(e,"data",n);break}case"src":case"href":if(n===""&&(t!=="a"||a!=="href")){e.removeAttribute(a);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){e.removeAttribute(a);break}n=St(""+n),e.setAttribute(a,n);break;case"action":case"formAction":if(typeof n=="function"){e.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof u=="function"&&(a==="formAction"?(t!=="input"&&$e(e,t,"name",o.name,o,null),$e(e,t,"formEncType",o.formEncType,o,null),$e(e,t,"formMethod",o.formMethod,o,null),$e(e,t,"formTarget",o.formTarget,o,null)):($e(e,t,"encType",o.encType,o,null),$e(e,t,"method",o.method,o,null),$e(e,t,"target",o.target,o,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){e.removeAttribute(a);break}n=St(""+n),e.setAttribute(a,n);break;case"onClick":n!=null&&(e.onclick=Za);break;case"onScroll":n!=null&&De("scroll",e);break;case"onScrollEnd":n!=null&&De("scrollend",e);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(c(61));if(a=n.__html,a!=null){if(o.children!=null)throw Error(c(60));e.innerHTML=a}}break;case"multiple":e.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":e.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){e.removeAttribute("xlink:href");break}a=St(""+n),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,""+n):e.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,""):e.removeAttribute(a);break;case"capture":case"download":n===!0?e.setAttribute(a,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?e.setAttribute(a,n):e.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?e.setAttribute(a,n):e.removeAttribute(a);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?e.removeAttribute(a):e.setAttribute(a,n);break;case"popover":De("beforetoggle",e),De("toggle",e),ba(e,"popover",n);break;case"xlinkActuate":Ht(e,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":Ht(e,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":Ht(e,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":Ht(e,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":Ht(e,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":Ht(e,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":Ht(e,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":Ht(e,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":Ht(e,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":ba(e,"is",n);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=Fe.get(a)||a,ba(e,a,n))}}function dc(e,t,a,n,o,u){switch(a){case"style":ue(e,n,u);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(c(61));if(a=n.__html,a!=null){if(o.children!=null)throw Error(c(60));e.innerHTML=a}}break;case"children":typeof n=="string"?q(e,n):(typeof n=="number"||typeof n=="bigint")&&q(e,""+n);break;case"onScroll":n!=null&&De("scroll",e);break;case"onScrollEnd":n!=null&&De("scrollend",e);break;case"onClick":n!=null&&(e.onclick=Za);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!nl.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(o=a.endsWith("Capture"),t=a.slice(2,o?a.length-7:void 0),u=e[Mt]||null,u=u!=null?u[a]:null,typeof u=="function"&&e.removeEventListener(t,u,o),typeof n=="function")){typeof u!="function"&&u!==null&&(a in e?e[a]=null:e.hasAttribute(a)&&e.removeAttribute(a)),e.addEventListener(t,n,o);break e}a in e?e[a]=n:n===!0?e.setAttribute(a,""):ba(e,a,n)}}}function zt(e,t,a){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":De("error",e),De("load",e);var n=!1,o=!1,u;for(u in a)if(a.hasOwnProperty(u)){var m=a[u];if(m!=null)switch(u){case"src":n=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(c(137,t));default:$e(e,t,u,m,a,null)}}o&&$e(e,t,"srcSet",a.srcSet,a,null),n&&$e(e,t,"src",a.src,a,null);return;case"input":De("invalid",e);var g=u=m=o=null,b=null,C=null;for(n in a)if(a.hasOwnProperty(n)){var H=a[n];if(H!=null)switch(n){case"name":o=H;break;case"type":m=H;break;case"checked":b=H;break;case"defaultChecked":C=H;break;case"value":u=H;break;case"defaultValue":g=H;break;case"children":case"dangerouslySetInnerHTML":if(H!=null)throw Error(c(137,t));break;default:$e(e,t,n,H,a,null)}}ns(e,u,g,b,C,m,o,!1);return;case"select":De("invalid",e),n=m=u=null;for(o in a)if(a.hasOwnProperty(o)&&(g=a[o],g!=null))switch(o){case"value":u=g;break;case"defaultValue":m=g;break;case"multiple":n=g;default:$e(e,t,o,g,a,null)}t=u,a=m,e.multiple=!!n,t!=null?h(e,!!n,t,!1):a!=null&&h(e,!!n,a,!0);return;case"textarea":De("invalid",e),u=o=n=null;for(m in a)if(a.hasOwnProperty(m)&&(g=a[m],g!=null))switch(m){case"value":n=g;break;case"defaultValue":o=g;break;case"children":u=g;break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(c(91));break;default:$e(e,t,m,g,a,null)}T(e,n,o,u);return;case"option":for(b in a)if(a.hasOwnProperty(b)&&(n=a[b],n!=null))switch(b){case"selected":e.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:$e(e,t,b,n,a,null)}return;case"dialog":De("beforetoggle",e),De("toggle",e),De("cancel",e),De("close",e);break;case"iframe":case"object":De("load",e);break;case"video":case"audio":for(n=0;n<Us.length;n++)De(Us[n],e);break;case"image":De("error",e),De("load",e);break;case"details":De("toggle",e);break;case"embed":case"source":case"link":De("error",e),De("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(C in a)if(a.hasOwnProperty(C)&&(n=a[C],n!=null))switch(C){case"children":case"dangerouslySetInnerHTML":throw Error(c(137,t));default:$e(e,t,C,n,a,null)}return;default:if(le(t)){for(H in a)a.hasOwnProperty(H)&&(n=a[H],n!==void 0&&dc(e,t,H,n,a,void 0));return}}for(g in a)a.hasOwnProperty(g)&&(n=a[g],n!=null&&$e(e,t,g,n,a,null))}function Up(e,t,a,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var o=null,u=null,m=null,g=null,b=null,C=null,H=null;for(O in a){var B=a[O];if(a.hasOwnProperty(O)&&B!=null)switch(O){case"checked":break;case"value":break;case"defaultValue":b=B;default:n.hasOwnProperty(O)||$e(e,t,O,null,n,B)}}for(var A in n){var O=n[A];if(B=a[A],n.hasOwnProperty(A)&&(O!=null||B!=null))switch(A){case"type":u=O;break;case"name":o=O;break;case"checked":C=O;break;case"defaultChecked":H=O;break;case"value":m=O;break;case"defaultValue":g=O;break;case"children":case"dangerouslySetInnerHTML":if(O!=null)throw Error(c(137,t));break;default:O!==B&&$e(e,t,A,O,n,B)}}Ta(e,m,g,b,C,H,u,o);return;case"select":O=m=g=A=null;for(u in a)if(b=a[u],a.hasOwnProperty(u)&&b!=null)switch(u){case"value":break;case"multiple":O=b;default:n.hasOwnProperty(u)||$e(e,t,u,null,n,b)}for(o in n)if(u=n[o],b=a[o],n.hasOwnProperty(o)&&(u!=null||b!=null))switch(o){case"value":A=u;break;case"defaultValue":g=u;break;case"multiple":m=u;default:u!==b&&$e(e,t,o,u,n,b)}t=g,a=m,n=O,A!=null?h(e,!!a,A,!1):!!n!=!!a&&(t!=null?h(e,!!a,t,!0):h(e,!!a,a?[]:"",!1));return;case"textarea":O=A=null;for(g in a)if(o=a[g],a.hasOwnProperty(g)&&o!=null&&!n.hasOwnProperty(g))switch(g){case"value":break;case"children":break;default:$e(e,t,g,null,n,o)}for(m in n)if(o=n[m],u=a[m],n.hasOwnProperty(m)&&(o!=null||u!=null))switch(m){case"value":A=o;break;case"defaultValue":O=o;break;case"children":break;case"dangerouslySetInnerHTML":if(o!=null)throw Error(c(91));break;default:o!==u&&$e(e,t,m,o,n,u)}x(e,A,O);return;case"option":for(var ne in a)if(A=a[ne],a.hasOwnProperty(ne)&&A!=null&&!n.hasOwnProperty(ne))switch(ne){case"selected":e.selected=!1;break;default:$e(e,t,ne,null,n,A)}for(b in n)if(A=n[b],O=a[b],n.hasOwnProperty(b)&&A!==O&&(A!=null||O!=null))switch(b){case"selected":e.selected=A&&typeof A!="function"&&typeof A!="symbol";break;default:$e(e,t,b,A,n,O)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var pe in a)A=a[pe],a.hasOwnProperty(pe)&&A!=null&&!n.hasOwnProperty(pe)&&$e(e,t,pe,null,n,A);for(C in n)if(A=n[C],O=a[C],n.hasOwnProperty(C)&&A!==O&&(A!=null||O!=null))switch(C){case"children":case"dangerouslySetInnerHTML":if(A!=null)throw Error(c(137,t));break;default:$e(e,t,C,A,n,O)}return;default:if(le(t)){for(var Pe in a)A=a[Pe],a.hasOwnProperty(Pe)&&A!==void 0&&!n.hasOwnProperty(Pe)&&dc(e,t,Pe,void 0,n,A);for(H in n)A=n[H],O=a[H],!n.hasOwnProperty(H)||A===O||A===void 0&&O===void 0||dc(e,t,H,A,n,O);return}}for(var N in a)A=a[N],a.hasOwnProperty(N)&&A!=null&&!n.hasOwnProperty(N)&&$e(e,t,N,null,n,A);for(B in n)A=n[B],O=a[B],!n.hasOwnProperty(B)||A===O||A==null&&O==null||$e(e,t,B,A,n,O)}function lm(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Hp(){if(typeof performance.getEntriesByType=="function"){for(var e=0,t=0,a=performance.getEntriesByType("resource"),n=0;n<a.length;n++){var o=a[n],u=o.transferSize,m=o.initiatorType,g=o.duration;if(u&&g&&lm(m)){for(m=0,g=o.responseEnd,n+=1;n<a.length;n++){var b=a[n],C=b.startTime;if(C>g)break;var H=b.transferSize,B=b.initiatorType;H&&lm(B)&&(b=b.responseEnd,m+=H*(b<g?1:(g-C)/(b-C)))}if(--n,t+=8*(u+m)/(o.duration/1e3),e++,10<e)break}}if(0<e)return t/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var fc=null,mc=null;function ti(e){return e.nodeType===9?e:e.ownerDocument}function im(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function om(e,t){if(e===0)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&t==="foreignObject"?0:e}function hc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.children=="bigint"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var pc=null;function Lp(){var e=window.event;return e&&e.type==="popstate"?e===pc?!1:(pc=e,!0):(pc=null,!1)}var cm=typeof setTimeout=="function"?setTimeout:void 0,Bp=typeof clearTimeout=="function"?clearTimeout:void 0,um=typeof Promise=="function"?Promise:void 0,Yp=typeof queueMicrotask=="function"?queueMicrotask:typeof um<"u"?function(e){return um.resolve(null).then(e).catch(Gp)}:cm;function Gp(e){setTimeout(function(){throw e})}function Un(e){return e==="head"}function dm(e,t){var a=t,n=0;do{var o=a.nextSibling;if(e.removeChild(a),o&&o.nodeType===8)if(a=o.data,a==="/$"||a==="/&"){if(n===0){e.removeChild(o),Wr(t);return}n--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")n++;else if(a==="html")Ls(e.ownerDocument.documentElement);else if(a==="head"){a=e.ownerDocument.head,Ls(a);for(var u=a.firstChild;u;){var m=u.nextSibling,g=u.nodeName;u[Kn]||g==="SCRIPT"||g==="STYLE"||g==="LINK"&&u.rel.toLowerCase()==="stylesheet"||a.removeChild(u),u=m}}else a==="body"&&Ls(e.ownerDocument.body);a=o}while(a);Wr(t)}function fm(e,t){var a=e;e=0;do{var n=a.nextSibling;if(a.nodeType===1?t?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(t?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),n&&n.nodeType===8)if(a=n.data,a==="/$"){if(e===0)break;e--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||e++;a=n}while(a)}function gc(e){var t=e.firstChild;for(t&&t.nodeType===10&&(t=t.nextSibling);t;){var a=t;switch(t=t.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":gc(a),yr(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}e.removeChild(a)}}function Qp(e,t,a,n){for(;e.nodeType===1;){var o=a;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!n&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(n){if(!e[Kn])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(u=e.getAttribute("rel"),u==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(u!==o.rel||e.getAttribute("href")!==(o.href==null||o.href===""?null:o.href)||e.getAttribute("crossorigin")!==(o.crossOrigin==null?null:o.crossOrigin)||e.getAttribute("title")!==(o.title==null?null:o.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(u=e.getAttribute("src"),(u!==(o.src==null?null:o.src)||e.getAttribute("type")!==(o.type==null?null:o.type)||e.getAttribute("crossorigin")!==(o.crossOrigin==null?null:o.crossOrigin))&&u&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(t==="input"&&e.type==="hidden"){var u=o.name==null?null:""+o.name;if(o.type==="hidden"&&e.getAttribute("name")===u)return e}else return e;if(e=fa(e.nextSibling),e===null)break}return null}function Xp(e,t,a){if(t==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!a||(e=fa(e.nextSibling),e===null))return null;return e}function mm(e,t){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!t||(e=fa(e.nextSibling),e===null))return null;return e}function _c(e){return e.data==="$?"||e.data==="$~"}function yc(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function Vp(e,t){var a=e.ownerDocument;if(e.data==="$~")e._reactRetry=t;else if(e.data!=="$?"||a.readyState!=="loading")t();else{var n=function(){t(),a.removeEventListener("DOMContentLoaded",n)};a.addEventListener("DOMContentLoaded",n),e._reactRetry=n}}function fa(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?"||t==="$~"||t==="&"||t==="F!"||t==="F")break;if(t==="/$"||t==="/&")return null}}return e}var vc=null;function hm(e){e=e.nextSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"||a==="/&"){if(t===0)return fa(e.nextSibling);t--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||t++}e=e.nextSibling}return null}function pm(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(t===0)return e;t--}else a!=="/$"&&a!=="/&"||t++}e=e.previousSibling}return null}function gm(e,t,a){switch(t=ti(a),e){case"html":if(e=t.documentElement,!e)throw Error(c(452));return e;case"head":if(e=t.head,!e)throw Error(c(453));return e;case"body":if(e=t.body,!e)throw Error(c(454));return e;default:throw Error(c(451))}}function Ls(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);yr(e)}var ma=new Map,_m=new Set;function ai(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var cn=Q.d;Q.d={f:Zp,r:Kp,D:Jp,C:Fp,L:Wp,m:$p,X:Ip,S:Pp,M:eg};function Zp(){var e=cn.f(),t=Kl();return e||t}function Kp(e){var t=Ya(e);t!==null&&t.tag===5&&t.type==="form"?kd(t):cn.r(e)}var Kr=typeof document>"u"?null:document;function ym(e,t,a){var n=Kr;if(n&&typeof t=="string"&&t){var o=Lt(t);o='link[rel="'+e+'"][href="'+o+'"]',typeof a=="string"&&(o+='[crossorigin="'+a+'"]'),_m.has(o)||(_m.add(o),e={rel:e,crossOrigin:a,href:t},n.querySelector(o)===null&&(t=n.createElement("link"),zt(t,"link",e),ht(t),n.head.appendChild(t)))}}function Jp(e){cn.D(e),ym("dns-prefetch",e,null)}function Fp(e,t){cn.C(e,t),ym("preconnect",e,t)}function Wp(e,t,a){cn.L(e,t,a);var n=Kr;if(n&&e&&t){var o='link[rel="preload"][as="'+Lt(t)+'"]';t==="image"&&a&&a.imageSrcSet?(o+='[imagesrcset="'+Lt(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(o+='[imagesizes="'+Lt(a.imageSizes)+'"]')):o+='[href="'+Lt(e)+'"]';var u=o;switch(t){case"style":u=Jr(e);break;case"script":u=Fr(e)}ma.has(u)||(e=M({rel:"preload",href:t==="image"&&a&&a.imageSrcSet?void 0:e,as:t},a),ma.set(u,e),n.querySelector(o)!==null||t==="style"&&n.querySelector(Bs(u))||t==="script"&&n.querySelector(Ys(u))||(t=n.createElement("link"),zt(t,"link",e),ht(t),n.head.appendChild(t)))}}function $p(e,t){cn.m(e,t);var a=Kr;if(a&&e){var n=t&&typeof t.as=="string"?t.as:"script",o='link[rel="modulepreload"][as="'+Lt(n)+'"][href="'+Lt(e)+'"]',u=o;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":u=Fr(e)}if(!ma.has(u)&&(e=M({rel:"modulepreload",href:e},t),ma.set(u,e),a.querySelector(o)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(Ys(u)))return}n=a.createElement("link"),zt(n,"link",e),ht(n),a.head.appendChild(n)}}}function Pp(e,t,a){cn.S(e,t,a);var n=Kr;if(n&&e){var o=yn(n).hoistableStyles,u=Jr(e);t=t||"default";var m=o.get(u);if(!m){var g={loading:0,preload:null};if(m=n.querySelector(Bs(u)))g.loading=5;else{e=M({rel:"stylesheet",href:e,"data-precedence":t},a),(a=ma.get(u))&&bc(e,a);var b=m=n.createElement("link");ht(b),zt(b,"link",e),b._p=new Promise(function(C,H){b.onload=C,b.onerror=H}),b.addEventListener("load",function(){g.loading|=1}),b.addEventListener("error",function(){g.loading|=2}),g.loading|=4,ni(m,t,n)}m={type:"stylesheet",instance:m,count:1,state:g},o.set(u,m)}}}function Ip(e,t){cn.X(e,t);var a=Kr;if(a&&e){var n=yn(a).hoistableScripts,o=Fr(e),u=n.get(o);u||(u=a.querySelector(Ys(o)),u||(e=M({src:e,async:!0},t),(t=ma.get(o))&&jc(e,t),u=a.createElement("script"),ht(u),zt(u,"link",e),a.head.appendChild(u)),u={type:"script",instance:u,count:1,state:null},n.set(o,u))}}function eg(e,t){cn.M(e,t);var a=Kr;if(a&&e){var n=yn(a).hoistableScripts,o=Fr(e),u=n.get(o);u||(u=a.querySelector(Ys(o)),u||(e=M({src:e,async:!0,type:"module"},t),(t=ma.get(o))&&jc(e,t),u=a.createElement("script"),ht(u),zt(u,"link",e),a.head.appendChild(u)),u={type:"script",instance:u,count:1,state:null},n.set(o,u))}}function vm(e,t,a,n){var o=(o=ce.current)?ai(o):null;if(!o)throw Error(c(446));switch(e){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(t=Jr(a.href),a=yn(o).hoistableStyles,n=a.get(t),n||(n={type:"style",instance:null,count:0,state:null},a.set(t,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){e=Jr(a.href);var u=yn(o).hoistableStyles,m=u.get(e);if(m||(o=o.ownerDocument||o,m={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,m),(u=o.querySelector(Bs(e)))&&!u._p&&(m.instance=u,m.state.loading=5),ma.has(e)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},ma.set(e,a),u||tg(o,e,a,m.state))),t&&n===null)throw Error(c(528,""));return m}if(t&&n!==null)throw Error(c(529,""));return null;case"script":return t=a.async,a=a.src,typeof a=="string"&&t&&typeof t!="function"&&typeof t!="symbol"?(t=Fr(a),a=yn(o).hoistableScripts,n=a.get(t),n||(n={type:"script",instance:null,count:0,state:null},a.set(t,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(c(444,e))}}function Jr(e){return'href="'+Lt(e)+'"'}function Bs(e){return'link[rel="stylesheet"]['+e+"]"}function bm(e){return M({},e,{"data-precedence":e.precedence,precedence:null})}function tg(e,t,a,n){e.querySelector('link[rel="preload"][as="style"]['+t+"]")?n.loading=1:(t=e.createElement("link"),n.preload=t,t.addEventListener("load",function(){return n.loading|=1}),t.addEventListener("error",function(){return n.loading|=2}),zt(t,"link",a),ht(t),e.head.appendChild(t))}function Fr(e){return'[src="'+Lt(e)+'"]'}function Ys(e){return"script[async]"+e}function jm(e,t,a){if(t.count++,t.instance===null)switch(t.type){case"style":var n=e.querySelector('style[data-href~="'+Lt(a.href)+'"]');if(n)return t.instance=n,ht(n),n;var o=M({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return n=(e.ownerDocument||e).createElement("style"),ht(n),zt(n,"style",o),ni(n,a.precedence,e),t.instance=n;case"stylesheet":o=Jr(a.href);var u=e.querySelector(Bs(o));if(u)return t.state.loading|=4,t.instance=u,ht(u),u;n=bm(a),(o=ma.get(o))&&bc(n,o),u=(e.ownerDocument||e).createElement("link"),ht(u);var m=u;return m._p=new Promise(function(g,b){m.onload=g,m.onerror=b}),zt(u,"link",n),t.state.loading|=4,ni(u,a.precedence,e),t.instance=u;case"script":return u=Fr(a.src),(o=e.querySelector(Ys(u)))?(t.instance=o,ht(o),o):(n=a,(o=ma.get(u))&&(n=M({},a),jc(n,o)),e=e.ownerDocument||e,o=e.createElement("script"),ht(o),zt(o,"link",n),e.head.appendChild(o),t.instance=o);case"void":return null;default:throw Error(c(443,t.type))}else t.type==="stylesheet"&&(t.state.loading&4)===0&&(n=t.instance,t.state.loading|=4,ni(n,a.precedence,e));return t.instance}function ni(e,t,a){for(var n=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),o=n.length?n[n.length-1]:null,u=o,m=0;m<n.length;m++){var g=n[m];if(g.dataset.precedence===t)u=g;else if(u!==o)break}u?u.parentNode.insertBefore(e,u.nextSibling):(t=a.nodeType===9?a.head:a,t.insertBefore(e,t.firstChild))}function bc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.title==null&&(e.title=t.title)}function jc(e,t){e.crossOrigin==null&&(e.crossOrigin=t.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=t.referrerPolicy),e.integrity==null&&(e.integrity=t.integrity)}var ri=null;function Sm(e,t,a){if(ri===null){var n=new Map,o=ri=new Map;o.set(a,n)}else o=ri,n=o.get(a),n||(n=new Map,o.set(a,n));if(n.has(e))return n;for(n.set(e,null),a=a.getElementsByTagName(e),o=0;o<a.length;o++){var u=a[o];if(!(u[Kn]||u[et]||e==="link"&&u.getAttribute("rel")==="stylesheet")&&u.namespaceURI!=="http://www.w3.org/2000/svg"){var m=u.getAttribute(t)||"";m=e+m;var g=n.get(m);g?g.push(u):n.set(m,[u])}}return n}function xm(e,t,a){e=e.ownerDocument||e,e.head.insertBefore(a,t==="title"?e.querySelector("head > title"):null)}function ag(e,t,a){if(a===1||t.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof t.precedence!="string"||typeof t.href!="string"||t.href==="")break;return!0;case"link":if(typeof t.rel!="string"||typeof t.href!="string"||t.href===""||t.onLoad||t.onError)break;switch(t.rel){case"stylesheet":return e=t.disabled,typeof t.precedence=="string"&&e==null;default:return!0}case"script":if(t.async&&typeof t.async!="function"&&typeof t.async!="symbol"&&!t.onLoad&&!t.onError&&t.src&&typeof t.src=="string")return!0}return!1}function wm(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function ng(e,t,a,n){if(a.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var o=Jr(n.href),u=t.querySelector(Bs(o));if(u){t=u._p,t!==null&&typeof t=="object"&&typeof t.then=="function"&&(e.count++,e=si.bind(e),t.then(e,e)),a.state.loading|=4,a.instance=u,ht(u);return}u=t.ownerDocument||t,n=bm(n),(o=ma.get(o))&&bc(n,o),u=u.createElement("link"),ht(u);var m=u;m._p=new Promise(function(g,b){m.onload=g,m.onerror=b}),zt(u,"link",n),a.instance=u}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(a,t),(t=a.state.preload)&&(a.state.loading&3)===0&&(e.count++,a=si.bind(e),t.addEventListener("load",a),t.addEventListener("error",a))}}var Sc=0;function rg(e,t){return e.stylesheets&&e.count===0&&ii(e,e.stylesheets),0<e.count||0<e.imgCount?function(a){var n=setTimeout(function(){if(e.stylesheets&&ii(e,e.stylesheets),e.unsuspend){var u=e.unsuspend;e.unsuspend=null,u()}},6e4+t);0<e.imgBytes&&Sc===0&&(Sc=62500*Hp());var o=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&ii(e,e.stylesheets),e.unsuspend)){var u=e.unsuspend;e.unsuspend=null,u()}},(e.imgBytes>Sc?50:800)+t);return e.unsuspend=a,function(){e.unsuspend=null,clearTimeout(n),clearTimeout(o)}}:null}function si(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ii(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var li=null;function ii(e,t){e.stylesheets=null,e.unsuspend!==null&&(e.count++,li=new Map,t.forEach(sg,e),li=null,si.call(e))}function sg(e,t){if(!(t.state.loading&4)){var a=li.get(e);if(a)var n=a.get(null);else{a=new Map,li.set(e,a);for(var o=e.querySelectorAll("link[data-precedence],style[data-precedence]"),u=0;u<o.length;u++){var m=o[u];(m.nodeName==="LINK"||m.getAttribute("media")!=="not all")&&(a.set(m.dataset.precedence,m),n=m)}n&&a.set(null,n)}o=t.instance,m=o.getAttribute("data-precedence"),u=a.get(m)||n,u===n&&a.set(null,o),a.set(m,o),this.count++,n=si.bind(this),o.addEventListener("load",n),o.addEventListener("error",n),u?u.parentNode.insertBefore(o,u.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(o,e.firstChild)),t.state.loading|=4}}var Gs={$$typeof:de,Provider:null,Consumer:null,_currentValue:W,_currentValue2:W,_threadCount:0};function lg(e,t,a,n,o,u,m,g,b){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Rt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Rt(0),this.hiddenUpdates=Rt(null),this.identifierPrefix=n,this.onUncaughtError=o,this.onCaughtError=u,this.onRecoverableError=m,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=b,this.incompleteTransitions=new Map}function Nm(e,t,a,n,o,u,m,g,b,C,H,B){return e=new lg(e,t,a,m,b,C,H,B,g),t=1,u===!0&&(t|=24),u=Jt(3,null,null,t),e.current=u,u.stateNode=e,t=eo(),t.refCount++,e.pooledCache=t,t.refCount++,u.memoizedState={element:n,isDehydrated:a,cache:t},ro(u),e}function Em(e){return e?(e=Er,e):Er}function Cm(e,t,a,n,o,u){o=Em(o),n.context===null?n.context=o:n.pendingContext=o,n=En(t),n.payload={element:a},u=u===void 0?null:u,u!==null&&(n.callback=u),a=Cn(e,n,t),a!==null&&(Zt(a,e,t),bs(a,e,t))}function qm(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<t?a:t}}function xc(e,t){qm(e,t),(e=e.alternate)&&qm(e,t)}function Dm(e){if(e.tag===13||e.tag===31){var t=$n(e,67108864);t!==null&&Zt(t,e,67108864),xc(e,67108864)}}function Tm(e){if(e.tag===13||e.tag===31){var t=It();t=es(t);var a=$n(e,t);a!==null&&Zt(a,e,t),xc(e,t)}}var oi=!0;function ig(e,t,a,n){var o=D.T;D.T=null;var u=Q.p;try{Q.p=2,wc(e,t,a,n)}finally{Q.p=u,D.T=o}}function og(e,t,a,n){var o=D.T;D.T=null;var u=Q.p;try{Q.p=8,wc(e,t,a,n)}finally{Q.p=u,D.T=o}}function wc(e,t,a,n){if(oi){var o=Nc(n);if(o===null)uc(e,t,n,ci,a),Om(e,n);else if(ug(o,e,t,a,n))n.stopPropagation();else if(Om(e,n),t&4&&-1<cg.indexOf(e)){for(;o!==null;){var u=Ya(o);if(u!==null)switch(u.tag){case 3:if(u=u.stateNode,u.current.memoizedState.isDehydrated){var m=ft(u.pendingLanes);if(m!==0){var g=u;for(g.pendingLanes|=2,g.entangledLanes|=2;m;){var b=1<<31-Dt(m);g.entanglements[1]|=b,m&=~b}za(u),(Qe&6)===0&&(Vl=vt()+500,Rs(0))}}break;case 31:case 13:g=$n(u,2),g!==null&&Zt(g,u,2),Kl(),xc(u,2)}if(u=Nc(n),u===null&&uc(e,t,n,ci,a),u===o)break;o=u}o!==null&&n.stopPropagation()}else uc(e,t,n,null,a)}}function Nc(e){return e=Ei(e),Ec(e)}var ci=null;function Ec(e){if(ci=null,e=Tt(e),e!==null){var t=f(e);if(t===null)e=null;else{var a=t.tag;if(a===13){if(e=p(t),e!==null)return e;e=null}else if(a===31){if(e=y(t),e!==null)return e;e=null}else if(a===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return ci=e,null}function Am(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ua()){case Xn:return 2;case Vn:return 8;case ra:case Ha:return 32;case bt:return 268435456;default:return 32}default:return 32}}var Cc=!1,Hn=null,Ln=null,Bn=null,Qs=new Map,Xs=new Map,Yn=[],cg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Om(e,t){switch(e){case"focusin":case"focusout":Hn=null;break;case"dragenter":case"dragleave":Ln=null;break;case"mouseover":case"mouseout":Bn=null;break;case"pointerover":case"pointerout":Qs.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xs.delete(t.pointerId)}}function Vs(e,t,a,n,o,u){return e===null||e.nativeEvent!==u?(e={blockedOn:t,domEventName:a,eventSystemFlags:n,nativeEvent:u,targetContainers:[o]},t!==null&&(t=Ya(t),t!==null&&Dm(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,o!==null&&t.indexOf(o)===-1&&t.push(o),e)}function ug(e,t,a,n,o){switch(t){case"focusin":return Hn=Vs(Hn,e,t,a,n,o),!0;case"dragenter":return Ln=Vs(Ln,e,t,a,n,o),!0;case"mouseover":return Bn=Vs(Bn,e,t,a,n,o),!0;case"pointerover":var u=o.pointerId;return Qs.set(u,Vs(Qs.get(u)||null,e,t,a,n,o)),!0;case"gotpointercapture":return u=o.pointerId,Xs.set(u,Vs(Xs.get(u)||null,e,t,a,n,o)),!0}return!1}function km(e){var t=Tt(e.target);if(t!==null){var a=f(t);if(a!==null){if(t=a.tag,t===13){if(t=p(a),t!==null){e.blockedOn=t,al(e.priority,function(){Tm(a)});return}}else if(t===31){if(t=y(a),t!==null){e.blockedOn=t,al(e.priority,function(){Tm(a)});return}}else if(t===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function ui(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var a=Nc(e.nativeEvent);if(a===null){a=e.nativeEvent;var n=new a.constructor(a.type,a);Ni=n,a.target.dispatchEvent(n),Ni=null}else return t=Ya(a),t!==null&&Dm(t),e.blockedOn=a,!1;t.shift()}return!0}function zm(e,t,a){ui(e)&&a.delete(t)}function dg(){Cc=!1,Hn!==null&&ui(Hn)&&(Hn=null),Ln!==null&&ui(Ln)&&(Ln=null),Bn!==null&&ui(Bn)&&(Bn=null),Qs.forEach(zm),Xs.forEach(zm)}function di(e,t){e.blockedOn===t&&(e.blockedOn=null,Cc||(Cc=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,dg)))}var fi=null;function Mm(e){fi!==e&&(fi=e,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){fi===e&&(fi=null);for(var t=0;t<e.length;t+=3){var a=e[t],n=e[t+1],o=e[t+2];if(typeof n!="function"){if(Ec(n||a)===null)continue;break}var u=Ya(a);u!==null&&(e.splice(t,3),t-=3,No(u,{pending:!0,data:o,method:a.method,action:n},n,o))}}))}function Wr(e){function t(b){return di(b,e)}Hn!==null&&di(Hn,e),Ln!==null&&di(Ln,e),Bn!==null&&di(Bn,e),Qs.forEach(t),Xs.forEach(t);for(var a=0;a<Yn.length;a++){var n=Yn[a];n.blockedOn===e&&(n.blockedOn=null)}for(;0<Yn.length&&(a=Yn[0],a.blockedOn===null);)km(a),a.blockedOn===null&&Yn.shift();if(a=(e.ownerDocument||e).$$reactFormReplay,a!=null)for(n=0;n<a.length;n+=3){var o=a[n],u=a[n+1],m=o[Mt]||null;if(typeof u=="function")m||Mm(a);else if(m){var g=null;if(u&&u.hasAttribute("formAction")){if(o=u,m=u[Mt]||null)g=m.formAction;else if(Ec(o)!==null)continue}else g=m.action;typeof g=="function"?a[n+1]=g:(a.splice(n,3),n-=3),Mm(a)}}}function Rm(){function e(u){u.canIntercept&&u.info==="react-transition"&&u.intercept({handler:function(){return new Promise(function(m){return o=m})},focusReset:"manual",scroll:"manual"})}function t(){o!==null&&(o(),o=null),n||setTimeout(a,20)}function a(){if(!n&&!navigation.transition){var u=navigation.currentEntry;u&&u.url!=null&&navigation.navigate(u.url,{state:u.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,o=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(a,100),function(){n=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),o!==null&&(o(),o=null)}}}function qc(e){this._internalRoot=e}mi.prototype.render=qc.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(c(409));var a=t.current,n=It();Cm(a,n,e,t,null,null)},mi.prototype.unmount=qc.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Cm(e.current,2,null,e,null,null),Kl(),t[_n]=null}};function mi(e){this._internalRoot=e}mi.prototype.unstable_scheduleHydration=function(e){if(e){var t=tl();e={blockedOn:null,target:e,priority:t};for(var a=0;a<Yn.length&&t!==0&&t<Yn[a].priority;a++);Yn.splice(a,0,e),a===0&&km(e)}};var Um=l.version;if(Um!=="19.2.0")throw Error(c(527,Um,"19.2.0"));Q.findDOMNode=function(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(c(188)):(e=Object.keys(e).join(","),Error(c(268,e)));return e=z(t),e=e!==null?k(e):null,e=e===null?null:e.stateNode,e};var fg={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hi.isDisabled&&hi.supportsFiber)try{_a=hi.inject(fg),Et=hi}catch{}}return Js.createRoot=function(e,t){if(!d(e))throw Error(c(299));var a=!1,n="",o=Qd,u=Xd,m=Vd;return t!=null&&(t.unstable_strictMode===!0&&(a=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onUncaughtError!==void 0&&(o=t.onUncaughtError),t.onCaughtError!==void 0&&(u=t.onCaughtError),t.onRecoverableError!==void 0&&(m=t.onRecoverableError)),t=Nm(e,1,!1,null,null,a,n,null,o,u,m,Rm),e[_n]=t.current,cc(e),new qc(t)},Js.hydrateRoot=function(e,t,a){if(!d(e))throw Error(c(299));var n=!1,o="",u=Qd,m=Xd,g=Vd,b=null;return a!=null&&(a.unstable_strictMode===!0&&(n=!0),a.identifierPrefix!==void 0&&(o=a.identifierPrefix),a.onUncaughtError!==void 0&&(u=a.onUncaughtError),a.onCaughtError!==void 0&&(m=a.onCaughtError),a.onRecoverableError!==void 0&&(g=a.onRecoverableError),a.formState!==void 0&&(b=a.formState)),t=Nm(e,1,!0,t,a??null,n,o,b,u,m,g,Rm),t.context=Em(null),a=t.current,n=It(),n=es(n),o=En(n),o.callback=null,Cn(a,o,n),a=n,t.current.lanes=a,va(t,a),za(t),e[_n]=t.current,cc(e),new mi(t)},Js.version="19.2.0",Js}var Zm;function Gg(){if(Zm)return Mc.exports;Zm=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(l){console.error(l)}}return r(),Mc.exports=Yg(),Mc.exports}var Qg=Gg();const Xg=Rg(Qg),Vg="fieldsync-offline",Zg=2,Ge={PROJECTS:"projects",AREAS:"areas",CREW_CHECKINS:"crew_checkins",TM_TICKETS:"tm_tickets",DAILY_REPORTS:"daily_reports",MESSAGES:"messages",PENDING_ACTIONS:"pending_actions",CACHED_DATA:"cached_data"};let mr=null;const fn=()=>new Promise((r,l)=>{if(mr){r(mr);return}const i=indexedDB.open(Vg,Zg);i.onerror=()=>{console.error("Failed to open offline database"),l(i.error)},i.onsuccess=()=>{mr=i.result,r(mr)},i.onupgradeneeded=c=>{const d=c.target.result;if(d.objectStoreNames.contains(Ge.PROJECTS)||d.createObjectStore(Ge.PROJECTS,{keyPath:"id"}).createIndex("company_id","company_id",{unique:!1}),d.objectStoreNames.contains(Ge.AREAS)||d.createObjectStore(Ge.AREAS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Ge.CREW_CHECKINS)||d.createObjectStore(Ge.CREW_CHECKINS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Ge.TM_TICKETS)||d.createObjectStore(Ge.TM_TICKETS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Ge.DAILY_REPORTS)||d.createObjectStore(Ge.DAILY_REPORTS,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),d.objectStoreNames.contains(Ge.MESSAGES)||d.createObjectStore(Ge.MESSAGES,{keyPath:"id"}).createIndex("project_id","project_id",{unique:!1}),!d.objectStoreNames.contains(Ge.PENDING_ACTIONS)){const f=d.createObjectStore(Ge.PENDING_ACTIONS,{keyPath:"id",autoIncrement:!0});f.createIndex("type","type",{unique:!1}),f.createIndex("created_at","created_at",{unique:!1})}d.objectStoreNames.contains(Ge.CACHED_DATA)||d.createObjectStore(Ge.CACHED_DATA,{keyPath:"key"})}}),hr=(r,l="readonly")=>{if(!mr)throw new Error("Database not initialized");return mr.transaction(r,l).objectStore(r)},$s=async(r,l)=>(await fn(),new Promise((i,c)=>{const f=hr(r,"readwrite").put(l);f.onsuccess=()=>i(f.result),f.onerror=()=>c(f.error)})),nh=async(r,l)=>(await fn(),new Promise((i,c)=>{const d=mr.transaction(r,"readwrite"),f=d.objectStore(r);l.forEach(p=>f.put(p)),d.oncomplete=()=>i(),d.onerror=()=>c(d.error)})),Kg=async(r,l)=>(await fn(),new Promise((i,c)=>{const f=hr(r).get(l);f.onsuccess=()=>i(f.result),f.onerror=()=>c(f.error)})),rh=async r=>(await fn(),new Promise((l,i)=>{const d=hr(r).getAll();d.onsuccess=()=>l(d.result||[]),d.onerror=()=>i(d.error)})),Ic=async(r,l,i)=>(await fn(),new Promise((c,d)=>{const y=hr(r).index(l).getAll(i);y.onsuccess=()=>c(y.result||[]),y.onerror=()=>d(y.error)})),Jg=async(r,l)=>(await fn(),new Promise((i,c)=>{const f=hr(r,"readwrite").delete(l);f.onsuccess=()=>i(),f.onerror=()=>c(f.error)})),qt={UPDATE_AREA_STATUS:"UPDATE_AREA_STATUS",CREATE_TM_TICKET:"CREATE_TM_TICKET",SAVE_CREW_CHECKIN:"SAVE_CREW_CHECKIN",SUBMIT_DAILY_REPORT:"SUBMIT_DAILY_REPORT",SEND_MESSAGE:"SEND_MESSAGE",CREATE_MATERIAL_REQUEST:"CREATE_MATERIAL_REQUEST"},ha=async(r,l,i={})=>{await fn();const c={type:r,payload:l,metadata:i,created_at:new Date().toISOString(),attempts:0,last_error:null};return new Promise((d,f)=>{const y=hr(Ge.PENDING_ACTIONS,"readwrite").add(c);y.onsuccess=()=>{d(y.result)},y.onerror=()=>f(y.error)})},sh=async()=>rh(Ge.PENDING_ACTIONS),vi=async()=>(await sh()).length,Fg=async r=>Jg(Ge.PENDING_ACTIONS,r),Wg=async(r,l)=>(await fn(),new Promise((i,c)=>{const d=hr(Ge.PENDING_ACTIONS,"readwrite"),f=d.get(r);f.onsuccess=()=>{const p=f.result;if(p){const y={...p,...l},S=d.put(y);S.onsuccess=()=>i(y),S.onerror=()=>c(S.error)}else c(new Error("Action not found"))},f.onerror=()=>c(f.error)})),$g=async r=>nh(Ge.PROJECTS,r),Km=async r=>r?Ic(Ge.PROJECTS,"company_id",r):rh(Ge.PROJECTS),Pg=async r=>nh(Ge.AREAS,r),Jm=async r=>Ic(Ge.AREAS,"project_id",r),Hc=async(r,l)=>{const i=await Kg(Ge.AREAS,r);return i&&(i.status=l,i.updated_at=new Date().toISOString(),await $s(Ge.AREAS,i)),i},Lc=async r=>$s(Ge.CREW_CHECKINS,r),Fm=async r=>$s(Ge.TM_TICKETS,r),ea=()=>{const r=new Uint8Array(6);crypto.getRandomValues(r);const l=Array.from(r,i=>i.toString(36)).join("");return`temp_${Date.now()}_${l}`},$r=async r=>$s(Ge.DAILY_REPORTS,r),Ig=async(r,l)=>(await Ic(Ge.DAILY_REPORTS,"project_id",r)).find(c=>c.report_date===l)||null,Wm=async r=>$s(Ge.MESSAGES,r);let eu=typeof navigator<"u"?navigator.onLine:!0;const Zc=new Set,tu=r=>(Zc.add(r),()=>Zc.delete(r)),pa=()=>eu,$m=r=>{eu=r,Zc.forEach(l=>l(r))};typeof window<"u"&&(window.addEventListener("online",()=>{$m(!0)}),window.addEventListener("offline",()=>{$m(!1)}));let Bc=!1;const lh=async r=>{if(Bc||!eu)return{synced:0,failed:0};Bc=!0;const l={synced:0,failed:0};try{const i=await sh();for(const c of i)try{await e_(c,r),await Fg(c.id),l.synced++}catch(d){console.error(`Failed to sync action ${c.type}:`,d),l.failed++,await Wg(c.id,{attempts:(c.attempts||0)+1,last_error:d.message,last_attempt:new Date().toISOString()})}}finally{Bc=!1}return l},e_=async(r,l)=>{const{type:i,payload:c}=r;switch(i){case qt.UPDATE_AREA_STATUS:return l.updateAreaStatus(c.areaId,c.status);case qt.CREATE_TM_TICKET:const d=await l.createTMTicket(c.ticket);return c.workers?.length>0&&await l.addTMWorkers(d.id,c.workers),c.items?.length>0&&await l.addTMItems(d.id,c.items),d;case qt.SAVE_CREW_CHECKIN:return l.saveCrewCheckin(c.projectId,c.workers,c.checkInDate);case qt.SUBMIT_DAILY_REPORT:return await l.saveDailyReport(c.projectId,c.reportData),l.submitDailyReport(c.projectId,c.submittedBy);case qt.SEND_MESSAGE:return l.sendMessage(c.projectId,c.senderType,c.senderName,c.content);case qt.CREATE_MATERIAL_REQUEST:return l.createMaterialRequest(c.projectId,c.items,c.requestedBy,c.neededBy,c.priority,c.notes);default:throw new Error(`Unknown action type: ${i}`)}},ih="https://cegifnrcwdilromcyouq.supabase.co",au="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNlZ2lmbnJjd2RpbHJvbWN5b3VxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NTQ5OTAsImV4cCI6MjA4MDIzMDk5MH0.qAiBG5XaB0C1E0U2tQbQkrhpm1iUhM6A2MXngEHhX4A",v=!!au,_=v?ah(ih,au):null,gi={slowQueryThreshold:200,enableSupabase:v},Ce={query(r,l){const i={type:"query",operation:r,duration_ms:l.duration,rows_returned:l.rows,company_id:l.company_id||null,project_id:l.project_id||null,user_id:l.user_id||null,timestamp:new Date().toISOString()};gi.enableSupabase&&l.duration>=gi.slowQueryThreshold&&Yc("query",i)},error(r,l){const i={type:"error",category:r,severity:l.severity||"error",error_code:l.code||null,message:l.message,company_id:l.company_id||null,user_id:l.user_id||null,project_id:l.project_id||null,operation:l.operation||null,context:l.extra||{},timestamp:new Date().toISOString()};gi.enableSupabase&&Yc("error",i)},storage(r,l){const i={type:"storage",operation:r,company_id:l.company_id||null,project_id:l.project_id||null,file_size_bytes:l.size||0,duration_ms:l.duration||0,success:l.success!==!1,error_message:l.error||null,timestamp:new Date().toISOString()};gi.enableSupabase&&(!i.success||i.duration_ms>5e3)&&Yc("storage",i)},activity(r,l){}};async function Yc(r,l){if(_)try{r==="error"?await _.rpc("log_error",{p_severity:l.severity,p_category:l.category,p_message:l.message,p_company_id:l.company_id,p_user_id:l.user_id,p_project_id:l.project_id,p_operation:l.operation,p_error_code:l.error_code,p_context:l.context||{}}):r==="query"&&await _.rpc("log_query_metric",{p_operation:l.operation,p_duration_ms:l.duration_ms,p_rows_returned:l.rows_returned,p_company_id:l.company_id,p_project_id:l.project_id,p_user_id:l.user_id,p_context:{}})}catch{}}Ce.wrapQuery=function(r,l){return async function(...i){const c=performance.now();try{const d=await l.apply(this,i),p={duration:Math.round(performance.now()-c),rows:Array.isArray(d)?d.length:void 0};return Ce.query(r,p),d}catch(d){const f=Math.round(performance.now()-c);throw Ce.error("database",{message:d.message,operation:r,severity:"error",extra:{duration:f}}),d}}};Ce.time=async function(r,l){const i=performance.now();try{const c=await l(),d=Math.round(performance.now()-i);return Ce.query(r,{duration:d}),c}catch(c){throw Ce.error("general",{message:c.message,operation:r}),c}};typeof window<"u"&&fn().catch(r=>console.error("Failed to init offline DB:",r));const Kc="fieldsync_field_session";let Ws=null;const nu=()=>{if(Ws)return Ws;try{const r=sessionStorage.getItem(Kc);if(r)return Ws=JSON.parse(r),Ws}catch{}return null},Jc=r=>{Ws=r,r?sessionStorage.setItem(Kc,JSON.stringify(r)):sessionStorage.removeItem(Kc)},oh=async()=>{const r=nu();if(r?.token&&v)try{await _.rpc("invalidate_field_session",{p_session_token:r.token})}catch{}Jc(null)};let Fs=null;const ch=()=>{const r=nu();return!r?.token||!v?_:((!Fs||Fs._sessionToken!==r.token)&&(Fs=ah(ih,au,{global:{headers:{"x-field-session":r.token}}}),Fs._sessionToken=r.token),Fs)},ta=()=>v?nu()?.token?ch():_:null,Fc="fieldsync_data",Si="fieldsync_user",t_=()=>{const r="fieldsync_device_id";let l=localStorage.getItem(r);return l||(l=crypto.randomUUID(),localStorage.setItem(r,l)),l},Pm={projects:[],areas:[],users:[],assignments:[]},I=()=>{try{const r=localStorage.getItem(Fc);return r?JSON.parse(r):Pm}catch{return localStorage.removeItem(Fc),Pm}},Ee=r=>{localStorage.setItem(Fc,JSON.stringify(r))},_i=()=>{try{const r=localStorage.getItem(Si);return r?JSON.parse(r):null}catch{return localStorage.removeItem(Si),null}},yi=r=>{r?localStorage.setItem(Si,JSON.stringify(r)):localStorage.removeItem(Si)},Wc={async signUp(r,l,i,c){if(v){const{data:d,error:f}=await _.auth.signUp({email:r,password:l,options:{data:{name:i,role:c}}});if(f)throw f;return d}else{const d=I(),f={id:crypto.randomUUID(),email:r,name:i,role:c,created_at:new Date().toISOString()};return d.users.push(f),Ee(d),yi(f),{user:f}}},async signIn(r,l){if(v){const{data:i,error:c}=await _.auth.signInWithPassword({email:r,password:l});if(c)throw c;return i}else{const c=I().users.find(d=>d.email===r);if(!c)throw new Error("User not found");return yi(c),{user:c}}},async signOut(){if(v){const{error:r}=await _.auth.signOut();if(r)throw r}else yi(null)},async getUser(){if(v){const{data:{user:r}}=await _.auth.getUser();return r}else return _i()},async getProfile(){if(v){const{data:{user:r}}=await _.auth.getUser();if(!r)return null;const{data:l,error:i}=await _.from("users").select("*").eq("id",r.id).single();return i?{id:r.id,email:r.email,name:r.user_metadata?.name||"",role:r.user_metadata?.role||"foreman"}:l}else return _i()},async updateRole(r,l){if(v){const{data:i,error:c}=await _.from("users").update({role:l}).eq("id",r).select().single();if(c)throw c;return i}else{const i=I(),c=i.users.find(d=>d.id===r);return c&&(c.role=l,Ee(i),_i()?.id===r&&yi(c)),c}},onAuthStateChange(r){if(v)return _.auth.onAuthStateChange(r);{const l=_i();return r(l?"SIGNED_IN":"SIGNED_OUT",{user:l}),{data:{subscription:{unsubscribe:()=>{}}}}}}},_e={async getProjects(r=null,l=!1){if(v){if(!pa()){const c=await Km(r);return l?c:c.filter(d=>d.status!=="archived")}const i=performance.now();try{let c=_.from("projects").select("*").order("created_at",{ascending:!1});r&&(c=c.eq("company_id",r)),l||(c=c.eq("status","active"));const{data:d,error:f}=await c,p=Math.round(performance.now()-i);if(Ce.query("getProjects",{duration:p,rows:d?.length,company_id:r}),f){Ce.error("database",{message:f.message,operation:"getProjects",company_id:r});const y=await Km(r);if(y.length>0)return y;throw f}return d?.length>0&&$g(d).catch(y=>console.error("Failed to cache projects:",y)),d}catch(c){throw Ce.error("database",{message:c.message,operation:"getProjects",company_id:r}),c}}else{const i=I().projects;return l?i:i.filter(c=>c.status!=="archived")}},async getProjectsPaginated(r,{page:l=0,limit:i=25,status:c="active"}={}){if(v){const p=performance.now();try{let y=_.from("projects").select("*",{count:"exact"}).eq("company_id",r).order("created_at",{ascending:!1}).range(l*i,(l+1)*i-1);c!=="all"&&(y=y.eq("status",c));const{data:S,error:z,count:k}=await y,M=Math.round(performance.now()-p);if(Ce.query("getProjectsPaginated",{duration:M,rows:S?.length,page:l,company_id:r}),z)throw z;return{projects:S||[],totalCount:k||0,hasMore:(l+1)*i<(k||0),page:l,limit:i}}catch(y){throw Ce.error("database",{message:y.message,operation:"getProjectsPaginated",company_id:r}),y}}const d=I().projects.filter(p=>p.company_id===r&&(c==="all"||p.status===c)),f=l*i;return{projects:d.slice(f,f+i),totalCount:d.length,hasMore:f+i<d.length,page:l,limit:i}},async getProjectsWithSummary(r){if(v){const l=performance.now();try{const{data:i,error:c}=await _.from("projects").select(`
            *,
            areas:areas(count),
            tickets:t_and_m_tickets(count),
            pending_tickets:t_and_m_tickets(count),
            daily_reports:daily_reports(count)
          `).eq("company_id",r).eq("status","active").eq("pending_tickets.status","pending").order("created_at",{ascending:!1}),d=Math.round(performance.now()-l);if(Ce.query("getProjectsWithSummary",{duration:d,rows:i?.length,company_id:r}),c)throw c;return(i||[]).map(f=>({...f,areaCount:f.areas?.[0]?.count||0,ticketCount:f.tickets?.[0]?.count||0,pendingTicketCount:f.pending_tickets?.[0]?.count||0,reportCount:f.daily_reports?.[0]?.count||0,areas:void 0,tickets:void 0,pending_tickets:void 0,daily_reports:void 0}))}catch(i){return Ce.error("database",{message:i.message,operation:"getProjectsWithSummary",company_id:r}),this.getProjects(r)}}return I().projects.filter(l=>l.company_id===r&&l.status==="active")},async getProjectDashboardSummary(r){if(v){const l=performance.now();try{const{data:i,error:c}=await _.rpc("get_project_dashboard_summary",{p_company_id:r}),d=Math.round(performance.now()-l);if(Ce.query("getProjectDashboardSummary",{duration:d,rows:i?.length,company_id:r}),c){if(c.message?.includes("function")||c.code==="42883")return this.getProjectsWithSummary(r);throw c}return(i||[]).map(f=>({id:f.project_id,name:f.project_name,status:f.project_status,job_number:f.project_number,address:f.project_address,pin:f.project_pin,created_at:f.created_at,start_date:f.start_date,end_date:f.end_date,contract_value:Number(f.contract_value)||0,work_type:f.work_type||"demolition",job_type:f.job_type||"standard",general_contractor:f.general_contractor||"",areaCount:Number(f.total_areas)||0,completedAreas:Number(f.completed_areas)||0,inProgressAreas:Number(f.in_progress_areas)||0,pendingAreas:Number(f.pending_areas)||0,ticketCount:Number(f.total_tickets)||0,pendingTicketCount:Number(f.pending_tickets)||0,submittedTicketCount:Number(f.submitted_tickets)||0,approvedTicketCount:Number(f.approved_tickets)||0,totalLaborHours:Number(f.total_labor_hours)||0,todayLaborHours:Number(f.today_labor_hours)||0,todayWorkerCount:Number(f.today_worker_count)||0,lastActivityAt:f.last_activity_at,dailyReportsThisWeek:Number(f.daily_reports_this_week)||0,corCount:Number(f.cor_count)||0,pendingCorCount:Number(f.pending_cor_count)||0,disposalLoadsToday:Number(f.disposal_loads_today)||0}))}catch(i){return Ce.error("database",{message:i.message,operation:"getProjectDashboardSummary",company_id:r}),this.getProjectsWithSummary(r)}}return I().projects.filter(l=>l.company_id===r&&l.status==="active")},async getArchivedProjects(r){if(v){const{data:l,error:i}=await _.from("projects").select("*").eq("company_id",r).eq("status","archived").order("archived_at",{ascending:!1});if(i)throw i;return l}else return I().projects.filter(l=>l.status==="archived")},async getProjectCount(r){if(v){const{count:l,error:i}=await _.from("projects").select("*",{count:"exact",head:!0}).eq("company_id",r).in("status",["active","archived"]);if(i)throw i;return l||0}else return I().projects.filter(i=>i.company_id===r&&i.status!=="deleted").length},async archiveProject(r){if(v){const{data:l,error:i}=await _.from("projects").update({status:"archived",archived_at:new Date().toISOString()}).eq("id",r).select().single();if(i)throw i;return l}else{const l=I(),i=l.projects.find(c=>c.id===r);return i&&(i.status="archived",i.archived_at=new Date().toISOString(),Ee(l)),i}},async getProjectStorageStats(r){if(!v)return{photoCount:0,estimatedMB:0};const{data:l,error:i}=await _.from("t_and_m_tickets").select("photos").eq("project_id",r);if(i)throw i;let c=0;const d=[];l?.forEach(p=>{p.photos&&Array.isArray(p.photos)&&(c+=p.photos.length,d.push(...p.photos))});const f=c*1.5;return{photoCount:c,estimatedMB:f,photoUrls:d}},async archiveProjectDeep(r,l){if(!v)return null;const{photoUrls:i}=await this.getProjectStorageStats(r);if(i.length>0){const f=i.map(p=>{try{const S=new URL(p).pathname.match(/\/tm-photos\/(.+)$/);return S?S[1]:null}catch{return null}}).filter(Boolean);if(f.length>0)for(let p=0;p<f.length;p+=100){const y=f.slice(p,p+100);await _.storage.from("tm-photos").remove(y)}}await _.from("t_and_m_tickets").update({photos:[]}).eq("project_id",r);const{data:c,error:d}=await _.from("projects").update({status:"archived",archived_at:new Date().toISOString(),photos:[],storage_cleaned:!0}).eq("id",r).select().single();if(d)throw d;return{...c,photosDeleted:i.length}},async restoreProject(r){if(v){const{data:l,error:i}=await _.from("projects").update({status:"active",archived_at:null}).eq("id",r).select().single();if(i)throw i;return l}else{const l=I(),i=l.projects.find(c=>c.id===r);return i&&(i.status="active",i.archived_at=null,Ee(l)),i}},async getProject(r){if(v){const{data:l,error:i}=await _.from("projects").select("*").eq("id",r).single();if(i)throw i;return l}else return I().projects.find(l=>l.id===r)},async createProject(r){if(v){const{data:l,error:i}=await _.from("projects").insert({...r,status:"active"}).select().single();if(i)throw console.error("Supabase createProject error:",i.message,i.details,i.hint),i;return l}else{const l=I(),i={...r,id:crypto.randomUUID(),status:"active",created_at:new Date().toISOString()};return l.projects.push(i),Ee(l),i}},async getProjectByPin(r){if(v){const{data:l,error:i}=await _.from("projects").select("*").eq("pin",r).eq("status","active").single();return i?null:l}else return I().projects.find(i=>i.pin===r&&i.status==="active")||null},async getProjectByPinAndCompany(r,l){if(console.log("[PIN Auth Fallback] Trying direct lookup",{pin:"****",companyId:l}),v){const{data:i,error:c}=await _.from("projects").select("*").eq("pin",r).eq("company_id",l).eq("status","active").single();return console.log("[PIN Auth Fallback] Result:",{data:i,error:c}),c?null:i}else return I().projects.find(c=>c.pin===r&&c.company_id===l&&c.status==="active")||null},async getProjectByPinSecure(r,l){if(v){const i=t_();console.log("[PIN Auth] Starting secure PIN validation",{pin:"****",companyCode:l,deviceId:i});const{data:c,error:d}=await _.rpc("validate_pin_and_create_session",{p_pin:r,p_company_code:l,p_device_id:i,p_ip_address:null});if(console.log("[PIN Auth] RPC response:",{data:c,error:d}),d)return console.error("[PIN Auth] RPC error:",d),{success:!1,rateLimited:!1,project:null,error:d.message};if(!c||c.length===0)return console.warn("[PIN Auth] RPC returned empty data"),{success:!1,rateLimited:!1,project:null};const f=c[0];if(console.log("[PIN Auth] RPC result:",f),f.error_code==="RATE_LIMITED")return console.warn("[PIN Auth] Rate limited"),{success:!1,rateLimited:!0,project:null};if(f.error_code==="INVALID_COMPANY"||f.error_code==="INVALID_PIN")return console.warn("[PIN Auth] Invalid company or PIN:",f.error_code),{success:!1,rateLimited:!1,project:null};if(!f.success||!f.project_id)return console.warn("[PIN Auth] Validation failed:",{success:f.success,project_id:f.project_id}),{success:!1,rateLimited:!1,project:null};console.log("[PIN Auth] Validation successful, creating session"),Jc({token:f.session_token,projectId:f.project_id,companyId:f.company_id,projectName:f.project_name,companyName:f.company_name,createdAt:new Date().toISOString()});const p=ch(),{data:y,error:S}=await p.from("projects").select("*").eq("id",f.project_id).single();return console.log("[PIN Auth] Project fetch result:",{projectData:y,projectError:S}),{success:!0,rateLimited:!1,sessionToken:f.session_token,project:y||{id:f.project_id,name:f.project_name,company_id:f.company_id,status:"active"}}}else{const i=I(),d=(i.companies||[]).find(p=>p.code===l);if(!d)return{success:!1,rateLimited:!1,project:null};const f=i.projects.find(p=>p.pin===r&&p.company_id===d.id&&p.status==="active");if(f){const p=`demo_${Date.now()}_${Math.random().toString(36).slice(2)}`;Jc({token:p,projectId:f.id,companyId:d.id,projectName:f.name,companyName:d.name,createdAt:new Date().toISOString()})}return{success:!!f,rateLimited:!1,project:f||null}}},async isPinAvailable(r,l=null){if(v){let i=_.from("projects").select("id").eq("pin",r);l&&(i=i.neq("id",l));const{data:c,error:d}=await i;if(d)throw d;return c.length===0}else return!I().projects.some(c=>c.pin===r&&c.id!==l)},async updateProjectPin(r,l){if(v){const{data:i,error:c}=await _.from("projects").update({pin:l}).eq("id",r).select().single();if(c)throw c;return i}else{const i=I(),c=i.projects.find(d=>d.id===r);return c&&(c.pin=l,Ee(i)),c}},async updateProject(r,l){if(v){const{data:i,error:c}=await _.from("projects").update(l).eq("id",r).select().single();if(c)throw console.error("Error updating project:",c),c;return i}else{const i=I(),c=i.projects.find(d=>d.id===r);return c&&(Object.assign(c,l),Ee(i)),c}},async deleteProject(r){if(v){const{error:l}=await _.from("projects").delete().eq("id",r);if(l)throw l}else{const l=I();l.projects=l.projects.filter(i=>i.id!==r),l.areas=l.areas.filter(i=>i.project_id!==r),Ee(l)}},async getAreas(r){if(v){if(!pa())return Jm(r);const l=ta(),{data:i,error:c}=await l.from("areas").select("*").eq("project_id",r).order("sort_order",{ascending:!0});if(c){const d=await Jm(r);if(d.length>0)return d;throw c}return i?.length>0&&Pg(i).catch(d=>console.error("Failed to cache areas:",d)),i}else return I().areas.filter(l=>l.project_id===r)},async createArea(r){if(v){const l=ta(),{data:i,error:c}=await l.from("areas").insert(r).select().single();if(c)throw c;return i}else{const l=I(),i={...r,id:crypto.randomUUID(),created_at:new Date().toISOString()};return l.areas.push(i),Ee(l),i}},async updateAreaStatus(r,l){if(v){if(!pa()){const f=await Hc(r,l);return await ha(qt.UPDATE_AREA_STATUS,{areaId:r,status:l}),f}const i=ta(),{data:c,error:d}=await i.from("areas").update({status:l}).eq("id",r).select().single();if(d){if(d.message?.includes("fetch")||d.message?.includes("network")){const f=await Hc(r,l);return await ha(qt.UPDATE_AREA_STATUS,{areaId:r,status:l}),f}throw d}return c&&Hc(r,l).catch(f=>console.error("Failed to update cached area:",f)),c}else{const i=I(),c=i.areas.find(d=>d.id===r);return c&&(c.status=l,c.updated_at=new Date().toISOString()),Ee(i),c}},async updateArea(r,l){if(v){const{data:i,error:c}=await _.from("areas").update(l).eq("id",r).select().single();if(c)throw c;return i}else{const i=I(),c=i.areas.find(d=>d.id===r);return c&&(Object.assign(c,l),c.updated_at=new Date().toISOString()),Ee(i),c}},async deleteArea(r){if(v){const{error:l}=await _.from("areas").delete().eq("id",r);if(l)throw l}else{const l=I();l.areas=l.areas.filter(i=>i.id!==r),Ee(l)}},subscribeToAreas(r,l){return v?_.channel(`areas:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"areas",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMessages(r,l){return v?_.channel(`messages:${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToMaterialRequests(r,l){return v?_.channel(`material_requests:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"material_requests",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToDailyReports(r,l){return v?_.channel(`daily_reports:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"daily_reports",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCrewCheckins(r,l){return v?_.channel(`crew_checkins:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"crew_checkins",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToInjuryReports(r,l){return v?_.channel(`injury_reports:${r}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${r}`},l).subscribe():null},subscribeToTMTickets(r,l){return v?_.channel(`tm_tickets:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCompanyActivity(r,l,i){if(!v||!l||l.length===0)return null;const c=_.channel(`company_activity:${r}`);return l.forEach(d=>{c.on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`project_id=eq.${d}`},f=>i.onMessage?.(f)),c.on("postgres_changes",{event:"INSERT",schema:"public",table:"material_requests",filter:`project_id=eq.${d}`},f=>i.onMaterialRequest?.(f)),c.on("postgres_changes",{event:"INSERT",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${d}`},f=>i.onTMTicket?.(f)),c.on("postgres_changes",{event:"UPDATE",schema:"public",table:"t_and_m_tickets",filter:`project_id=eq.${d}`},f=>i.onTMTicket?.(f)),c.on("postgres_changes",{event:"INSERT",schema:"public",table:"crew_checkins",filter:`project_id=eq.${d}`},f=>i.onCrewCheckin?.(f)),c.on("postgres_changes",{event:"UPDATE",schema:"public",table:"crew_checkins",filter:`project_id=eq.${d}`},f=>i.onCrewCheckin?.(f)),c.on("postgres_changes",{event:"UPDATE",schema:"public",table:"areas",filter:`project_id=eq.${d}`},f=>i.onAreaUpdate?.(f)),c.on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${d}`},f=>i.onCORChange?.(f))}),c.on("postgres_changes",{event:"INSERT",schema:"public",table:"injury_reports",filter:`company_id=eq.${r}`},d=>i.onInjuryReport?.(d)),c.subscribe()},unsubscribe(r){r&&v&&_.removeChannel(r)},async getAssignedProjects(r){if(v){const{data:l,error:i}=await _.from("project_assignments").select(`
          project_id,
          projects (*)
        `).eq("user_id",r);if(i)throw i;return l.map(c=>c.projects)}else{const l=I();return(l.assignments?.filter(c=>c.user_id===r)||[]).map(c=>l.projects.find(d=>d.id===c.project_id)).filter(Boolean)}},async assignUserToProject(r,l,i){if(v){const{data:c,error:d}=await _.from("project_assignments").insert({project_id:r,user_id:l,assigned_by:i}).select().single();if(d)throw d;return c}else{const c=I();c.assignments||(c.assignments=[]);const d={id:crypto.randomUUID(),project_id:r,user_id:l,assigned_by:i,assigned_at:new Date().toISOString()};return c.assignments.push(d),Ee(c),d}},async removeUserFromProject(r,l){if(v){const{error:i}=await _.from("project_assignments").delete().eq("project_id",r).eq("user_id",l);if(i)throw i}else{const i=I();i.assignments=i.assignments?.filter(c=>!(c.project_id===r&&c.user_id===l))||[],Ee(i)}},async getProjectAssignments(r){if(v){const{data:l,error:i}=await _.from("project_assignments").select(`
          user_id,
          users (id, email, name, role)
        `).eq("project_id",r);if(i)throw i;return l.map(c=>c.users)}else{const l=I();return(l.assignments?.filter(c=>c.project_id===r)||[]).map(c=>l.users.find(d=>d.id===c.user_id)).filter(Boolean)}},async getAllUsers(){if(v){const{data:r,error:l}=await _.from("users").select("*").order("name");if(l)throw l;return r}else return I().users||[]},async getForemen(){if(v){const{data:r,error:l}=await _.from("users").select("*").eq("role","foreman").order("name");if(l)throw l;return r}else return(I().users||[]).filter(r=>r.role==="foreman")},async logActivity(r,l,i,c,d,f){if(v){const{error:p}=await _.from("activity_log").insert({user_id:r,project_id:l,area_id:i,action:c,old_value:d,new_value:f});p&&console.error("Error logging activity:",p)}},async getProjectActivity(r,l=50){if(v){const{data:i,error:c}=await _.from("activity_log").select(`
          *,
          users (name, email),
          areas (name)
        `).eq("project_id",r).order("created_at",{ascending:!1}).limit(l);if(c)throw c;return i}return[]},async getMaterialsEquipment(r){if(v){const{data:l,error:i}=await _.from("materials_equipment").select("*").eq("company_id",r).eq("active",!0).order("category").order("name");if(i)throw i;return l}return[]},async getMaterialsEquipmentByCategory(r,l){if(v){const{data:i,error:c}=await _.from("materials_equipment").select("*").eq("company_id",r).eq("category",l).eq("active",!0).order("name");if(c)throw c;return i}return[]},async getAllMaterialsEquipment(r){if(v){const{data:l,error:i}=await _.from("materials_equipment").select("*").eq("company_id",r).order("category").order("name");if(i)throw i;return l}return[]},async createMaterialEquipment(r){if(v){const{data:l,error:i}=await _.from("materials_equipment").insert(r).select().single();if(i)throw i;return l}return null},async updateMaterialEquipment(r,l){if(v){const{data:i,error:c}=await _.from("materials_equipment").update(l).eq("id",r).select().single();if(c)throw c;return i}return null},async deleteMaterialEquipment(r){if(v){const{error:l}=await _.from("materials_equipment").update({active:!1}).eq("id",r);if(l)throw l}},async getLaborCategories(r){if(v){const{data:l,error:i}=await _.from("labor_categories").select("*").eq("company_id",r).eq("active",!0).order("sort_order").order("name");if(i)throw i;return l||[]}return[]},async createLaborCategory(r,l,i=0){if(v){const{data:c,error:d}=await _.from("labor_categories").insert({company_id:r,name:l,sort_order:i}).select().single();if(d)throw d;return c}return null},async updateLaborCategory(r,l){if(v){const{data:i,error:c}=await _.from("labor_categories").update(l).eq("id",r).select().single();if(c)throw c;return i}return null},async deleteLaborCategory(r){if(v){const{error:l}=await _.from("labor_categories").update({active:!1}).eq("id",r);if(l)throw l}},async getLaborClasses(r){if(v){const{data:l,error:i}=await _.from("labor_classes").select(`
          *,
          labor_categories (id, name)
        `).eq("company_id",r).eq("active",!0).order("sort_order").order("name");if(i)throw i;return l||[]}return[]},async getLaborClassesWithCategories(r){if(v){const[l,i]=await Promise.all([_.from("labor_categories").select("*").eq("company_id",r).eq("active",!0).order("sort_order").order("name"),_.from("labor_classes").select("*").eq("company_id",r).eq("active",!0).order("sort_order").order("name")]);if(l.error)throw l.error;if(i.error)throw i.error;return{categories:l.data||[],classes:i.data||[]}}return{categories:[],classes:[]}},async getLaborClassesForField(r){if(v){const{data:l,error:i}=await _.rpc("get_labor_classes_for_field",{p_company_id:r});if(i){console.error("Error loading field labor classes:",i);const[f,p]=await Promise.all([_.from("labor_categories").select("id, name").eq("company_id",r).eq("active",!0).order("name"),_.from("labor_classes").select("id, name, category_id").eq("company_id",r).eq("active",!0).order("name")]);return{categories:f.data||[],classes:p.data||[]}}const c=new Map,d=[];for(const f of l||[])f.category_id&&f.category_name&&!c.has(f.category_id)&&c.set(f.category_id,{id:f.category_id,name:f.category_name}),d.push({id:f.id,name:f.name,category_id:f.category_id});return{categories:Array.from(c.values()),classes:d}}return{categories:[],classes:[]}},async createLaborClass(r,l,i,c=0){if(v){const{data:d,error:f}=await _.from("labor_classes").insert({company_id:r,category_id:l,name:i,sort_order:c}).select().single();if(f)throw f;return d}return null},async updateLaborClass(r,l){if(v){const{data:i,error:c}=await _.from("labor_classes").update(l).eq("id",r).select().single();if(c)throw c;return i}return null},async deleteLaborClass(r){if(v){const{error:l}=await _.from("labor_classes").update({active:!1}).eq("id",r);if(l)throw l}},async getLaborClassRates(r){if(v){const{data:l,error:i}=await _.from("labor_class_rates").select("*").eq("labor_class_id",r);if(i)throw i;return l||[]}return[]},async getAllLaborClassRates(r){if(v){const{data:l,error:i}=await _.from("labor_classes").select(`
          id,
          name,
          labor_class_rates (*)
        `).eq("company_id",r).eq("active",!0);if(i)throw i;return l||[]}return[]},async saveLaborClassRates(r,l){if(v){const i=l.map(d=>({...d,labor_class_id:r})),{error:c}=await _.from("labor_class_rates").upsert(i,{onConflict:"labor_class_id,work_type,job_type"});if(c)throw c}},async getLaborClassRate(r,l,i){if(v){const{data:c,error:d}=await _.from("labor_class_rates").select("regular_rate, overtime_rate").eq("labor_class_id",r).eq("work_type",l).eq("job_type",i).single();if(d&&d.code!=="PGRST116")throw d;return c||null}return null},async getTMTickets(r){if(v){const l=performance.now(),i=ta();try{const{data:c,error:d}=await i.from("t_and_m_tickets").select(`
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          `).eq("project_id",r).order("created_at",{ascending:!1}),f=Math.round(performance.now()-l);if(Ce.query("getTMTickets",{duration:f,rows:c?.length,project_id:r}),d)throw d;return c}catch(c){throw Ce.error("database",{message:c.message,operation:"getTMTickets",project_id:r}),c}}return[]},async getTMTicketsPaginated(r,{page:l=0,limit:i=25,status:c=null}={}){if(v){const d=performance.now(),f=ta();try{let p=f.from("t_and_m_tickets").select(`
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          `,{count:"exact"}).eq("project_id",r).order("created_at",{ascending:!1}).range(l*i,(l+1)*i-1);c&&(p=p.eq("status",c));const{data:y,error:S,count:z}=await p,k=Math.round(performance.now()-d);if(Ce.query("getTMTicketsPaginated",{duration:k,rows:y?.length,page:l,project_id:r}),S)throw S;return{tickets:y||[],totalCount:z||0,hasMore:(l+1)*i<(z||0),page:l,limit:i}}catch(p){throw Ce.error("database",{message:p.message,operation:"getTMTicketsPaginated",project_id:r}),p}}return{tickets:[],totalCount:0,hasMore:!1,page:0,limit:25}},async getChangeOrderTotals(r){if(v){const{data:l,error:i}=await _.from("t_and_m_tickets").select("ce_pco_number, change_order_value, status").eq("project_id",r).not("ce_pco_number","is",null).neq("ce_pco_number","");if(i)throw i;const c={};let d=0,f=0;return l?.forEach(p=>{const y=p.ce_pco_number;if(c[y]||(c[y]={approved:0,pending:0,count:0}),c[y].count++,p.status==="approved"||p.status==="billed"){const S=parseFloat(p.change_order_value)||0;c[y].approved+=S,d+=S}else p.status==="pending"&&f++}),{changeOrders:c,totalApprovedValue:d,pendingCount:f}}return{changeOrders:{},totalApprovedValue:0,pendingCount:0}},async getTMTicketsByStatus(r,l){if(v){const{data:i,error:c}=await _.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).eq("status",l).order("created_at",{ascending:!1});if(c)throw c;return i}return[]},async getCORTickets(r){if(v){const{data:l,error:i}=await _.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("assigned_cor_id",r).order("work_date",{ascending:!0});if(i)throw i;return l||[]}return[]},async createTMTicket(r){if(v){if(!pa()){const c={id:ea(),project_id:r.project_id,work_date:r.work_date,ce_pco_number:r.ce_pco_number||null,assigned_cor_id:r.assigned_cor_id||null,notes:r.notes,photos:r.photos||[],status:"pending_sync",created_by_name:r.created_by_name||"Field User",created_at:new Date().toISOString(),_offline:!0};return await Fm(c),await ha(qt.CREATE_TM_TICKET,{ticket:c,workers:r._workers||[],items:r._items||[]}),c}const{data:l,error:i}=await _.from("t_and_m_tickets").insert({project_id:r.project_id,work_date:r.work_date,ce_pco_number:r.ce_pco_number||null,assigned_cor_id:r.assigned_cor_id||null,notes:r.notes,photos:r.photos||[],status:"pending",created_by_name:r.created_by_name||"Field User"}).select().single();if(i){if(i.message?.includes("fetch")||i.message?.includes("network")){const c={id:ea(),...r,status:"pending_sync",_offline:!0};return await Fm(c),await ha(qt.CREATE_TM_TICKET,{ticket:c,workers:r._workers||[],items:r._items||[]}),c}throw i}return l}return null},async addTMWorkers(r,l){if(v){const i=l.map(d=>({ticket_id:r,name:d.name,hours:d.hours,overtime_hours:d.overtime_hours||0,time_started:d.time_started||null,time_ended:d.time_ended||null,role:d.role||"Laborer"})),{error:c}=await _.from("t_and_m_workers").insert(i);if(c)throw c}},async addTMItems(r,l){if(v){const i=l.map(d=>({ticket_id:r,material_equipment_id:d.material_equipment_id||null,custom_name:d.custom_name||null,custom_category:d.custom_category||null,quantity:d.quantity})),{error:c}=await _.from("t_and_m_items").insert(i);if(c)throw c}},async getPreviousTicketCrew(r,l){if(!v)return null;const{data:i,error:c}=await _.from("t_and_m_tickets").select(`
        id,
        work_date,
        t_and_m_workers (*)
      `).eq("project_id",r).lt("work_date",l).order("work_date",{ascending:!1}).limit(1).maybeSingle();if(c||!i)return null;const d=i.t_and_m_workers||[],f=d.some(k=>k.labor_class_id),p={};f&&d.forEach(k=>{k.labor_class_id&&(p[k.labor_class_id]||(p[k.labor_class_id]=[]),p[k.labor_class_id].push({name:k.name,hours:k.hours?.toString()||"",overtimeHours:k.overtime_hours?.toString()||"",timeStarted:k.time_started||"",timeEnded:k.time_ended||""}))});const y=d.filter(k=>["Foreman","General Foreman","Superintendent"].includes(k.role)).map(k=>({name:k.name,hours:k.hours?.toString()||"",overtimeHours:k.overtime_hours?.toString()||"",timeStarted:k.time_started||"",timeEnded:k.time_ended||"",role:k.role})),S=d.filter(k=>k.role==="Operator").map(k=>({name:k.name,hours:k.hours?.toString()||"",overtimeHours:k.overtime_hours?.toString()||"",timeStarted:k.time_started||"",timeEnded:k.time_ended||""})),z=d.filter(k=>k.role==="Laborer").map(k=>({name:k.name,hours:k.hours?.toString()||"",overtimeHours:k.overtime_hours?.toString()||"",timeStarted:k.time_started||"",timeEnded:k.time_ended||""}));return{workDate:i.work_date,supervision:y.length>0?y:null,operators:S.length>0?S:null,laborers:z.length>0?z:null,dynamicWorkers:Object.keys(p).length>0?p:null,totalWorkers:d.length}},async updateTMTicketStatus(r,l){if(v){const{data:i,error:c}=await _.from("t_and_m_tickets").update({status:l}).eq("id",r).select().single();if(c)throw c;return i}return null},async approveTMTicket(r,l,i,c=null){if(v){const d={status:"approved",approved_by_user_id:l,approved_by_name:i,approved_at:new Date().toISOString(),rejected_by_user_id:null,rejected_by_name:null,rejected_at:null,rejection_reason:null};c!==null&&(d.change_order_value=parseFloat(c)||0);const{data:f,error:p}=await _.from("t_and_m_tickets").update(d).eq("id",r).select().single();if(p)throw p;return f}return null},async rejectTMTicket(r,l,i,c=""){if(v){const{data:d,error:f}=await _.from("t_and_m_tickets").update({status:"rejected",rejected_by_user_id:l,rejected_by_name:i,rejected_at:new Date().toISOString(),rejection_reason:c,approved_by_user_id:null,approved_by_name:null,approved_at:null}).eq("id",r).select().single();if(f)throw f;return d}return null},canApproveTickets(r){return["owner","admin","manager"].includes(r)},async updateTMTicketPhotos(r,l){if(v){const{data:i,error:c}=await _.from("t_and_m_tickets").update({photos:l}).eq("id",r).select().single();if(c)throw c;return i}return null},async saveTMClientSignature(r,l){if(v){const{data:i,error:c}=await _.from("t_and_m_tickets").update({client_signature_data:l.signature,client_signature_name:l.signerName,client_signature_title:l.signerTitle,client_signature_company:l.signerCompany,client_signature_date:l.signedAt,client_signature_ip:null,status:"client_signed"}).eq("id",r).select().single();if(c)throw c;return i}return null},async deleteTMTicket(r){if(v){const{error:l}=await _.from("t_and_m_tickets").delete().eq("id",r);if(l)throw l}},async isTicketEditable(r){if(!r?.assigned_cor_id)return{editable:!0};if(v)try{const{data:l,error:i}=await _.from("change_orders").select("id, status, cor_number").eq("id",r.assigned_cor_id).single();if(i||!l)return{editable:!0};const d=["draft","pending_approval"].includes(l.status);return{editable:d,lockedBy:d?null:l,reason:d?null:`This ticket is linked to ${l.cor_number} which has been ${l.status==="approved"?"approved":l.status}`}}catch(l){return console.error("Error checking ticket editability:",l),{editable:!0}}return{editable:!0}},async getCompanyByCode(r){if(console.log("[Company Lookup] Looking up company by code:",r),v){const{data:l,error:i}=await _.from("companies").select("*").eq("code",r).single();return console.log("[Company Lookup] Result:",{data:l?{id:l.id,name:l.name,code:l.code}:null,error:i}),i?null:l}return null},async getCompany(r){if(v){const{data:l,error:i}=await _.from("companies").select("*").eq("id",r).single();if(i)throw i;return l}return null},async getUserCompanies(r){if(v){const{data:l,error:i}=await _.from("user_companies").select(`
          id,
          access_level,
          company_id,
          status,
          companies (
            id,
            name,
            code
          )
        `).eq("user_id",r).eq("status","active").order("created_at",{ascending:!0});return i?(console.error("Error fetching user companies:",i),[]):l.map(c=>({id:c.companies.id,name:c.companies.name,code:c.companies.code,access_level:c.access_level}))}return[]},async getUserPendingMemberships(r){if(v){const{count:l,error:i}=await _.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",r).eq("status","pending");return i?(console.error("Error fetching pending memberships:",i),0):l||0}return 0},async getCompanyMemberships(r){if(v){const{data:l,error:i}=await _.from("user_companies").select(`
          id,
          access_level,
          company_role,
          status,
          created_at,
          approved_at,
          approved_by,
          removed_at,
          removed_by,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",r).order("created_at",{ascending:!1});return i?(console.error("Error fetching company memberships:",i),[]):l||[]}return[]},async approveMembership(r,l){if(v){const{error:i}=await _.from("user_companies").update({status:"active",approved_at:new Date().toISOString(),approved_by:l}).eq("id",r);if(i)throw i}},async approveMembershipWithRole(r,l,i="member"){if(v){const{error:c}=await _.rpc("approve_membership_with_role",{membership_id:r,approved_by_user:l,new_access_level:i});if(c)throw c}},async rejectMembership(r){if(v){const{error:l}=await _.from("user_companies").delete().eq("id",r);if(l)throw l}},async removeMember(r,l){if(v){const{error:i}=await _.from("user_companies").update({status:"removed",removed_at:new Date().toISOString(),removed_by:l}).eq("id",r);if(i)throw i}},async getProjectTeam(r){if(v){const{data:l,error:i}=await _.from("project_users").select(`
          id,
          project_role,
          assigned_at,
          notes,
          users!project_users_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("project_id",r).order("assigned_at",{ascending:!0});return i?(console.error("Error fetching project team:",i),[]):l||[]}return[]},async getCompanyMembers(r){if(v){const{data:l,error:i}=await _.from("user_companies").select(`
          id,
          access_level,
          users!user_companies_user_id_fkey (
            id,
            name,
            email
          )
        `).eq("company_id",r).eq("status","active").order("created_at",{ascending:!0});return i?(console.error("Error fetching company members:",i),[]):l||[]}return[]},async addProjectMember(r,l,i,c){if(v){const{data:d,error:f}=await _.from("project_users").insert({project_id:r,user_id:l,project_role:i,assigned_by:c}).select().single();if(f)throw f;return d}return null},async updateProjectMemberRole(r,l,i){if(v){const{error:c}=await _.from("project_users").update({project_role:i}).eq("project_id",r).eq("user_id",l);if(c)throw c}},async removeProjectMember(r,l){if(v){const{error:i}=await _.from("project_users").delete().eq("project_id",r).eq("user_id",l);if(i)throw i}},async updateMemberAccessLevel(r,l){if(v){const{error:i}=await _.from("user_companies").update({access_level:l}).eq("id",r);if(i)throw i}},async updateMemberCompanyRole(r,l){if(v){const{error:i}=await _.from("user_companies").update({company_role:l}).eq("id",r);if(i)throw i}},async repairLegacyUser(r,l,i="member"){if(!v||!r||!l)return!1;try{const{data:c,error:d}=await _.rpc("repair_legacy_user",{p_user_id:r,p_company_id:l,p_role:i});return d?(console.error("RPC repair_legacy_user failed:",d),!1):c===!0}catch(c){return console.error("Error repairing legacy user:",c),!1}},async isLegacyUser(r){if(!v)return!1;try{const{data:l}=await _.from("users").select("company_id, role").eq("id",r).single();if(!l?.company_id)return!1;const{count:i}=await _.from("user_companies").select("*",{count:"exact",head:!0}).eq("user_id",r);return i===0}catch(l){return console.error("Error checking legacy user:",l),!1}},DISPOSAL_LOAD_TYPES:[{value:"concrete",label:"Concrete"},{value:"trash",label:"Trash"},{value:"metals",label:"Metals"},{value:"hazardous_waste",label:"Hazardous Waste"}],async getDisposalLoads(r,l){if(!v)return[];const i=performance.now();try{const{data:c,error:d}=await _.from("disposal_loads").select("*").eq("project_id",r).eq("work_date",l).order("created_at",{ascending:!1}),f=Math.round(performance.now()-i);if(Ce.query("getDisposalLoads",{duration:f,rows:c?.length,project_id:r}),d)throw d;return c||[]}catch(c){throw Ce.error("database",{message:c.message,operation:"getDisposalLoads",project_id:r}),c}},async getDisposalLoadsHistory(r,l=14){if(!v)return[];const i=performance.now();try{const c=new Date,d=new Date;d.setDate(d.getDate()-l);const{data:f,error:p}=await _.from("disposal_loads").select("*").eq("project_id",r).gte("work_date",d.toISOString().split("T")[0]).lte("work_date",c.toISOString().split("T")[0]).order("work_date",{ascending:!1}),y=Math.round(performance.now()-i);if(Ce.query("getDisposalLoadsHistory",{duration:y,rows:f?.length,project_id:r}),p)throw p;return(f||[]).map(S=>({...S,load_date:S.work_date}))}catch(c){throw Ce.error("database",{message:c.message,operation:"getDisposalLoadsHistory",project_id:r}),c}},async addDisposalLoad(r,l,i,c,d,f=null){if(!v)return null;const{data:p,error:y}=await _.from("disposal_loads").insert({project_id:r,user_id:l,work_date:i,load_type:c,load_count:d,notes:f}).select().single();if(y)throw Ce.error("database",{message:y.message,operation:"addDisposalLoad",project_id:r}),y;return p},async updateDisposalLoad(r,l,i,c=null){if(!v)return null;const{data:d,error:f}=await _.from("disposal_loads").update({load_type:l,load_count:i,notes:c}).eq("id",r).select().single();if(f)throw Ce.error("database",{message:f.message,operation:"updateDisposalLoad"}),f;return d},async deleteDisposalLoad(r){if(!v)return!1;const{error:l}=await _.from("disposal_loads").delete().eq("id",r);if(l)throw Ce.error("database",{message:l.message,operation:"deleteDisposalLoad"}),l;return!0},async getDisposalSummary(r,l=null,i=null){if(!v)return[];const c=performance.now();try{const{data:d,error:f}=await _.rpc("get_disposal_summary",{p_project_id:r,p_start_date:l,p_end_date:i}),p=Math.round(performance.now()-c);if(Ce.query("getDisposalSummary",{duration:p,rows:d?.length,project_id:r}),f)throw f;return d||[]}catch(d){return Ce.error("database",{message:d.message,operation:"getDisposalSummary",project_id:r}),this.getDisposalSummaryFallback(r,l,i)}},async getDisposalSummaryFallback(r,l,i){let c=_.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",r);l&&(c=c.gte("work_date",l)),i&&(c=c.lte("work_date",i));const{data:d,error:f}=await c;if(f)throw f;const p={};return d?.forEach(y=>{p[y.load_type]||(p[y.load_type]={load_type:y.load_type,total_loads:0,days:new Set}),p[y.load_type].total_loads+=y.load_count,p[y.load_type].days.add(y.work_date)}),Object.values(p).map(y=>({load_type:y.load_type,total_loads:y.total_loads,days_with_activity:y.days.size}))},async getWeeklyDisposalSummary(r,l=4){if(!v)return[];const i=new Date,c=new Date;c.setDate(c.getDate()-l*7);const{data:d,error:f}=await _.from("disposal_loads").select("load_type, load_count, work_date").eq("project_id",r).gte("work_date",c.toISOString().split("T")[0]).lte("work_date",i.toISOString().split("T")[0]).order("work_date",{ascending:!0});if(f)throw f;const p={};return d?.forEach(y=>{const S=new Date(y.work_date),z=new Date(S);z.setDate(S.getDate()-S.getDay());const k=z.toISOString().split("T")[0];p[k]||(p[k]={week:k,concrete:0,trash:0,metals:0,hazardous_waste:0}),p[k][y.load_type]+=y.load_count}),Object.values(p).sort((y,S)=>y.week.localeCompare(S.week))},async uploadPhoto(r,l,i,c){if(!v)return null;const d=performance.now(),f=c.size||0,p=Date.now(),y=new Uint8Array(6);crypto.getRandomValues(y);const S=Array.from(y,F=>F.toString(36)).join(""),z=c.name?.split(".").pop()||"jpg",k=`${p}-${S}.${z}`,M=`${r}/${l}/${i}/${k}`;try{const{data:F,error:P}=await _.storage.from("tm-photos").upload(M,c,{cacheControl:"3600",upsert:!1}),$=Math.round(performance.now()-d);if(Ce.storage("upload",{company_id:r,project_id:l,size:f,duration:$,success:!P}),P)throw P;const{data:Z}=_.storage.from("tm-photos").getPublicUrl(M);return Z.publicUrl}catch(F){throw Ce.error("storage",{message:F.message,operation:"uploadPhoto",company_id:r,project_id:l}),F}},async uploadPhotoBase64(r,l,i,c,d="photo.jpg"){if(!v)return null;const p=await(await fetch(c)).blob(),y=Date.now(),S=new Uint8Array(6);crypto.getRandomValues(S);const z=Array.from(S,oe=>oe.toString(36)).join(""),k=d.split(".").pop()||"jpg",M=`${y}-${z}.${k}`,F=`${r}/${l}/${i}/${M}`,{data:P,error:$}=await _.storage.from("tm-photos").upload(F,p,{cacheControl:"3600",upsert:!1,contentType:p.type});if($)throw $;const{data:Z}=_.storage.from("tm-photos").getPublicUrl(F);return Z.publicUrl},async deletePhoto(r){if(!v)return;const i=new URL(r).pathname.match(/\/tm-photos\/(.+)$/);if(!i)return;const c=i[1],{error:d}=await _.storage.from("tm-photos").remove([c]);if(d)throw d},async verifyPhotoAccessible(r){if(!v||!r)return{accessible:!1,error:"Invalid URL"};try{const l=await fetch(r,{method:"HEAD"});return{accessible:l.ok,status:l.status,error:l.ok?null:`HTTP ${l.status}`}}catch(l){return{accessible:!1,error:l.message||"Network error"}}},async verifyTicketPhotos(r){if(!v)return{verified:!1,issues:[]};try{const{data:l,error:i}=await _.from("t_and_m_tickets").select("photos").eq("id",r).single();if(i)throw i;if(!l?.photos||l.photos.length===0)return await _.from("t_and_m_tickets").update({photos_verified_at:new Date().toISOString(),photos_verification_status:"empty",photos_issue_count:0}).eq("id",r),{verified:!0,status:"empty",issues:[]};const c=[];for(const f of l.photos){const p=await this.verifyPhotoAccessible(f);p.accessible||c.push({url:f,error:p.error})}const d=c.length===0?"verified":"issues";return await _.from("t_and_m_tickets").update({photos_verified_at:new Date().toISOString(),photos_verification_status:d,photos_issue_count:c.length}).eq("id",r),{verified:c.length===0,status:d,totalPhotos:l.photos.length,issues:c}}catch(l){return console.error("Error verifying ticket photos:",l),{verified:!1,error:l.message,issues:[]}}},async queuePhotoUpload(r,l,i,c){if(!v)return null;const{data:d,error:f}=await _.from("photo_upload_queue").insert({ticket_id:r,temp_id:l,file_name:i,file_size_bytes:c,status:"pending"}).select().single();return f?(console.error("Error queueing photo upload:",f),null):d},async confirmQueuedUpload(r,l,i){if(!v)return!1;const{data:c,error:d}=await _.rpc("confirm_photo_upload",{p_queue_id:r,p_uploaded_url:l,p_storage_path:i});return d?(console.error("Error confirming photo upload:",d),!1):c===!0},async markQueuedUploadFailed(r,l){if(!v)return!1;const{data:i,error:c}=await _.rpc("mark_photo_upload_failed",{p_queue_id:r,p_error:l});return c?(console.error("Error marking photo upload failed:",c),!1):i===!0},async getPendingPhotoUploads(r){if(!v)return[];const{data:l,error:i}=await _.rpc("get_pending_photo_uploads",{p_ticket_id:r});return i?(console.error("Error getting pending photo uploads:",i),[]):l||[]},async logPhotoOperation(r,l,i={}){if(v)try{await _.from("photo_audit_log").insert({ticket_id:r,cor_id:i.corId||null,operation:l,photo_url:i.photoUrl||null,storage_path:i.storagePath||null,details:i.metadata?i.metadata:null,error_message:i.error||null,triggered_by:i.triggeredBy||"system"})}catch(c){console.error("Error logging photo operation:",c)}},async saveExportSnapshot(r,l,i={}){if(!v)return null;const{exportType:c="pdf",exportReason:d=null,clientEmail:f=null,clientName:p=null}=i;try{const{data:y,error:S}=await _.from("cor_export_snapshots").insert({cor_id:r,export_type:c,export_reason:d,cor_data:l.cor_data,tickets_data:l.tickets_data,photos_manifest:l.photos_manifest,totals_snapshot:l.totals_snapshot,checksum:l.checksum,client_email:f,client_name:p}).select().single();if(S)throw S;return y}catch(y){return console.error("Error saving export snapshot:",y),null}},async getExportSnapshots(r){if(!v)return[];const{data:l,error:i}=await _.from("cor_export_snapshots").select("id, exported_at, export_type, export_reason, client_name, client_email, checksum").eq("cor_id",r).order("exported_at",{ascending:!1});return i?(console.error("Error fetching export snapshots:",i),[]):l||[]},async getExportSnapshot(r){if(!v)return null;const{data:l,error:i}=await _.from("cor_export_snapshots").select("*").eq("id",r).single();return i?(console.error("Error fetching export snapshot:",i),null):l},async requestCORExport(r,l,i={}){if(!v)return null;try{const c=await _.auth.getUser(),{data:d,error:f}=await _.rpc("request_cor_export",{p_cor_id:r,p_idempotency_key:l,p_options:i,p_requested_by:c?.data?.user?.id||null});if(f)throw f;return d?.[0]||null}catch(c){throw Ce.error("database",{message:c.message,operation:"requestCORExport",extra:{corId:r}}),c}},async getExportJob(r){if(!v)return null;const{data:l,error:i}=await _.from("cor_export_jobs").select("*").eq("id",r).single();return i?(console.error("Error fetching export job:",i),null):l},async getExportJobs(r,l=10){if(!v)return[];const{data:i,error:c}=await _.from("cor_export_jobs").select("*").eq("cor_id",r).order("created_at",{ascending:!1}).limit(l);return c?(console.error("Error fetching export jobs:",c),[]):i||[]},async updateExportJobStatus(r,l,i={}){if(!v)return null;try{const{data:c,error:d}=await _.rpc("update_export_job_status",{p_job_id:r,p_status:l,p_snapshot_id:i.snapshotId||null,p_pdf_url:i.pdfUrl||null,p_error:i.error||null,p_error_details:i.errorDetails||null,p_metrics:i.metrics||null});if(d)throw d;return c}catch(c){throw Ce.error("database",{message:c.message,operation:"updateExportJobStatus",extra:{jobId:r,status:l}}),c}},async getCurrentCORSnapshot(r){if(!v)return null;const{data:l}=await _.from("change_orders").select("version, last_snapshot_version").eq("id",r).single();if(!l||l.version!==l.last_snapshot_version)return null;const{data:i}=await _.from("cor_export_snapshots").select("*").eq("cor_id",r).eq("is_current",!0).single();return i||null},async saveCORSnapshot(r,l){if(!v)return null;try{await _.from("cor_export_snapshots").update({is_current:!1}).eq("cor_id",r.corId);const i=await _.auth.getUser(),{data:c,error:d}=await _.from("cor_export_snapshots").insert({id:r.snapshotId,cor_id:r.corId,job_id:l,cor_version:r.corVersion,cor_data:r.corData,tickets_data:r.ticketsData,photos_manifest:r.photoManifest,totals_snapshot:r.totals,checksum:r.checksum,is_current:!0,exported_by:i?.data?.user?.id||null}).select().single();if(d)throw d;return await _.from("change_orders").update({last_snapshot_version:r.corVersion}).eq("id",r.corId),c}catch(i){throw Ce.error("database",{message:i.message,operation:"saveCORSnapshot",extra:{corId:r.corId}}),i}},async updateCORAggregatedStats(r){if(v)try{await _.rpc("update_cor_aggregated_stats",{p_cor_id:r})}catch(l){console.error("Error updating COR aggregated stats:",l)}},async getCrewCheckin(r,l=null){if(!v)return null;const i=l||new Date().toISOString().split("T")[0],c=ta(),{data:d,error:f}=await c.from("crew_checkins").select("*").eq("project_id",r).eq("check_in_date",i).maybeSingle();return f&&console.error("Error fetching crew checkin:",f),d},async saveCrewCheckin(r,l,i=null,c=null){if(!v)return null;const d=c||new Date().toISOString().split("T")[0];if(!pa()){const S={id:ea(),project_id:r,check_in_date:d,workers:l,created_by:i,updated_at:new Date().toISOString(),_offline:!0};return await Lc(S),await ha(qt.SAVE_CREW_CHECKIN,{projectId:r,workers:l,checkInDate:d}),S}const f=ta(),{data:p,error:y}=await f.from("crew_checkins").upsert({project_id:r,check_in_date:d,workers:l,created_by:i,updated_at:new Date().toISOString()},{onConflict:"project_id,check_in_date"}).select().single();if(y){if(y.message?.includes("fetch")||y.message?.includes("network")){const S={id:ea(),project_id:r,check_in_date:d,workers:l,_offline:!0};return await Lc(S),await ha(qt.SAVE_CREW_CHECKIN,{projectId:r,workers:l,checkInDate:d}),S}throw console.error("Error saving crew checkin:",y),y}return p&&Lc(p).catch(S=>console.error("Failed to cache checkin:",S)),p},async addCrewMember(r,l,i=null){if(!v)return null;const c=await this.getCrewCheckin(r),d=c?.workers||[];return d.find(f=>f.name.toLowerCase()===l.name.toLowerCase())?c:(d.push(l),await this.saveCrewCheckin(r,d,i))},async removeCrewMember(r,l){if(!v)return null;const i=await this.getCrewCheckin(r);if(!i)return null;const c=i.workers.filter(d=>d.name.toLowerCase()!==l.toLowerCase());return await this.saveCrewCheckin(r,c,i.created_by)},async getCrewCheckinHistory(r,l=30){if(!v)return[];const{data:i,error:c}=await _.from("crew_checkins").select("*").eq("project_id",r).order("check_in_date",{ascending:!1}).limit(l);return c?(console.error("Error fetching crew history:",c),[]):i||[]},async getLaborRates(r,l=null,i=null){if(!v)return[];let c=_.from("labor_rates").select("*").eq("company_id",r);l&&(c=c.eq("work_type",l)),i&&(c=c.eq("job_type",i));const{data:d,error:f}=await c;return f?(console.error("Error fetching labor rates:",f),[]):d||[]},async calculateManDayCosts(r,l,i,c){if(!v)return{totalCost:0,totalManDays:0,breakdown:[]};const d=await this.getCrewCheckinHistory(r,365),f=await this.getLaborRates(l,i,c),p={};f.forEach(M=>{p[M.role.toLowerCase()]=parseFloat(M.regular_rate)||0});let y=0,S=0;const z={},k=[];return d.forEach(M=>{const F=M.workers||[];let P=0;const $={};F.forEach(Z=>{const oe=(Z.role||"laborer").toLowerCase(),ee=p[oe]||0;$[oe]||($[oe]={count:0,cost:0}),$[oe].count++,$[oe].cost+=ee,P+=ee,z[oe]||(z[oe]={count:0,cost:0,rate:ee}),z[oe].count++,z[oe].cost+=ee}),y+=P,S+=F.length,k.push({date:M.check_in_date,workers:F.length,cost:P,breakdown:$})}),{totalCost:y,totalManDays:S,byRole:z,byDate:k,daysWorked:d.length}},async getDailyReport(r,l=null){if(!v)return null;const i=l||new Date().toISOString().split("T")[0],c=ta(),{data:d,error:f}=await c.from("daily_reports").select("*").eq("project_id",r).eq("report_date",i).maybeSingle();return f&&console.error("Error fetching daily report:",f),d},async compileDailyReport(r,l=null){if(!v)return null;const i=l||new Date().toISOString().split("T")[0],c=ta(),d=await this.getCrewCheckin(r,i),{data:f}=await c.from("areas").select("*").eq("project_id",r),p=f?.filter(z=>z.status==="done"&&z.completed_at?.startsWith(i))||[],{data:y}=await c.from("t_and_m_tickets").select("*").eq("project_id",r).eq("work_date",i),S=y?.reduce((z,k)=>z+(k.photos?.length||0),0)||0;return{crew_count:d?.workers?.length||0,crew_list:d?.workers||[],tasks_completed:p.length,tasks_total:f?.length||0,completed_tasks:p.map(z=>({name:z.name,group:z.group_name})),tm_tickets_count:y?.length||0,photos_count:S}},async saveDailyReport(r,l,i=null){if(!v)return null;const c=i||new Date().toISOString().split("T")[0];if(!pa()){const y={id:ea(),project_id:r,report_date:c,...l,updated_at:new Date().toISOString(),_offline:!0};return await $r(y),y}const d=ta(),{data:f,error:p}=await d.from("daily_reports").upsert({project_id:r,report_date:c,...l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(p){if(p.message?.includes("fetch")||p.message?.includes("network")){const y={id:ea(),project_id:r,report_date:c,...l,_offline:!0};return await $r(y),y}throw console.error("Error saving daily report:",p),p}return f&&$r(f).catch(y=>console.error("Failed to cache report:",y)),f},async submitDailyReport(r,l,i=null){if(!v)return null;const c=i||new Date().toISOString().split("T")[0];if(!pa()){const y=await Ig(r,c),S={id:ea(),project_id:r,report_date:c,...y||{},status:"pending_sync",submitted_by:l,submitted_at:new Date().toISOString(),_offline:!0};return await $r(S),await ha(qt.SUBMIT_DAILY_REPORT,{projectId:r,reportData:y||{},submittedBy:l}),S}const d=await this.compileDailyReport(r,c),{data:f,error:p}=await _.from("daily_reports").upsert({project_id:r,report_date:c,...d,status:"submitted",submitted_at:new Date().toISOString(),submitted_by:l,updated_at:new Date().toISOString()},{onConflict:"project_id,report_date"}).select().single();if(p){if(p.message?.includes("fetch")||p.message?.includes("network")){const y={id:ea(),project_id:r,report_date:c,...d,status:"pending_sync",submitted_by:l,_offline:!0};return await $r(y),await ha(qt.SUBMIT_DAILY_REPORT,{projectId:r,reportData:d,submittedBy:l}),y}throw console.error("Error submitting daily report:",p),p}return f&&$r(f).catch(y=>console.error("Failed to cache report:",y)),f},async getDailyReports(r,l=30){if(!v)return[];const{data:i,error:c}=await _.from("daily_reports").select("*").eq("project_id",r).order("report_date",{ascending:!1}).limit(l);return c?(console.error("Error fetching daily reports:",c),[]):i||[]},async sendMessage(r,l,i,c,d=null,f=null,p="general",y=null){if(!v)return null;if(!pa()){const k={id:ea(),project_id:r,sender_type:i,sender_name:c,sender_user_id:d,message:l,photo_url:f,message_type:p,parent_message_id:y,created_at:new Date().toISOString(),_offline:!0};return await Wm(k),await ha(qt.SEND_MESSAGE,{projectId:r,senderType:i,senderName:c,content:l}),k}const{data:S,error:z}=await _.from("messages").insert({project_id:r,sender_type:i,sender_name:c,sender_user_id:d,message:l,photo_url:f,message_type:p,parent_message_id:y}).select().single();if(z){if(z.message?.includes("fetch")||z.message?.includes("network")){const k={id:ea(),project_id:r,sender_type:i,sender_name:c,message:l,created_at:new Date().toISOString(),_offline:!0};return await Wm(k),await ha(qt.SEND_MESSAGE,{projectId:r,senderType:i,senderName:c,content:l}),k}throw console.error("Error sending message:",z),z}return S},async getMessages(r,l=50){if(!v)return[];const i=ta(),{data:c,error:d}=await i.from("messages").select("*").eq("project_id",r).order("created_at",{ascending:!1}).limit(l);return d?[]:c||[]},async getUnreadCount(r,l){if(!v)return 0;const i=ta(),c=l==="field"?"office":"field",{count:d,error:f}=await i.from("messages").select("*",{count:"exact",head:!0}).eq("project_id",r).eq("sender_type",c).eq("is_read",!1);return f?0:d||0},async markMessagesRead(r,l){if(!v)return;const i=ta(),c=l==="field"?"office":"field";await i.from("messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("project_id",r).eq("sender_type",c).eq("is_read",!1)},async createMaterialRequest(r,l,i,c=null,d="normal",f=null){if(!v)return null;if(!pa()){const S={id:ea(),project_id:r,items:l,requested_by:i,needed_by:c,priority:d,notes:f,status:"pending_sync",created_at:new Date().toISOString(),_offline:!0};return await ha(qt.CREATE_MATERIAL_REQUEST,{projectId:r,items:l,requestedBy:i,neededBy:c,priority:d,notes:f}),S}const{data:p,error:y}=await _.from("material_requests").insert({project_id:r,items:l,requested_by:i,needed_by:c,priority:d,notes:f}).select().single();if(y){if(y.message?.includes("fetch")||y.message?.includes("network")){const S={id:ea(),project_id:r,items:l,requested_by:i,status:"pending_sync",_offline:!0};return await ha(qt.CREATE_MATERIAL_REQUEST,{projectId:r,items:l,requestedBy:i,neededBy:c,priority:d,notes:f}),S}throw console.error("Error creating material request:",y),y}return p},async getMaterialRequests(r,l=null){if(!v)return[];let i=_.from("material_requests").select("*").eq("project_id",r).order("created_at",{ascending:!1});l&&(i=i.eq("status",l));const{data:c,error:d}=await i;return d?(console.error("Error fetching material requests:",d),[]):c||[]},async getPendingRequestsCount(r){if(!v)return 0;const{count:l,error:i}=await _.from("material_requests").select("*",{count:"exact",head:!0}).eq("project_id",r).eq("status","pending");return i?0:l||0},async updateMaterialRequest(r,l,i,c=null,d=null){if(!v)return null;const f={status:l,responded_by:i,responded_at:new Date().toISOString(),response_notes:c,updated_at:new Date().toISOString()};d&&(f.expected_delivery=d),l==="delivered"&&(f.delivered_at=new Date().toISOString());const{data:p,error:y}=await _.from("material_requests").update(f).eq("id",r).select().single();if(y)throw console.error("Error updating material request:",y),y;return p},generateShareToken(){const r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",l=new Uint8Array(12);return crypto.getRandomValues(l),Array.from(l,i=>r[i%r.length]).join("")},async createProjectShare(r,l,i,c=null){if(!v){const S=I();S.projectShares||(S.projectShares=[]);const z={id:crypto.randomUUID(),project_id:r,share_token:this.generateShareToken(),created_by:l,expires_at:c,is_active:!0,permissions:i,view_count:0,last_viewed_at:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return S.projectShares.push(z),Ee(S),z}const{data:d,error:f}=await _.rpc("generate_share_token");if(f)throw console.error("Error generating share token:",f),f;const{data:p,error:y}=await _.from("project_shares").insert({project_id:r,share_token:d,created_by:l,expires_at:c,permissions:i}).select().single();if(y)throw console.error("Error creating project share:",y),y;return p},async getShareByToken(r){if(!v){const c=I();if(!c.projectShares)return null;const d=c.projectShares.find(f=>f.share_token===r&&f.is_active&&(!f.expires_at||new Date(f.expires_at)>new Date));return d&&(d.view_count++,d.last_viewed_at=new Date().toISOString(),Ee(c)),d}const{data:l,error:i}=await _.from("project_shares").select("*, projects(*)").eq("share_token",r).eq("is_active",!0).single();return i?(console.error("Error fetching share by token:",i),null):l.expires_at&&new Date(l.expires_at)<new Date?null:(await _.rpc("increment_share_view_count",{token:r}),l)},async getProjectShares(r){if(!v){const c=I();return c.projectShares?c.projectShares.filter(d=>d.project_id===r):[]}const{data:l,error:i}=await _.from("project_shares").select("*, users(name, email)").eq("project_id",r).order("created_at",{ascending:!1});return i?(console.error("Error fetching project shares:",i),[]):l||[]},async updateProjectShare(r,l){if(!v){const d=I();if(!d.projectShares)return null;const f=d.projectShares.findIndex(p=>p.id===r);return f===-1?null:(d.projectShares[f]={...d.projectShares[f],...l,updated_at:new Date().toISOString()},Ee(d),d.projectShares[f])}const{data:i,error:c}=await _.from("project_shares").update(l).eq("id",r).select().single();if(c)throw console.error("Error updating project share:",c),c;return i},async revokeProjectShare(r){return this.updateProjectShare(r,{is_active:!1})},async deleteProjectShare(r){if(!v){const i=I();if(!i.projectShares)return;i.projectShares=i.projectShares.filter(c=>c.id!==r),Ee(i);return}const{error:l}=await _.from("project_shares").delete().eq("id",r);if(l)throw console.error("Error deleting project share:",l),l},async getPublicProjectData(r){const l=await this.getShareByToken(r);if(!l)return null;const i=l.project_id||l.projects?.id;if(!v){const f=I(),p=f.projects.find(M=>M.id===i);if(!p)return null;const y=f.areas.filter(M=>M.project_id===i),S=y.reduce((M,F)=>M+parseFloat(F.weight||0),0),z=y.filter(M=>M.status==="done").reduce((M,F)=>M+parseFloat(F.weight||0),0),k=S>0?Math.round(z/S*100):0;return{share:l,project:p,progress:k,areas:l.permissions.progress?y:[],photos:[],dailyReports:[],tmTickets:[]}}const c=l.projects||await this.getProject(i);if(!c)return null;const d={share:l,project:c,areas:[],photos:[],dailyReports:[],tmTickets:[]};if(l.permissions.progress){d.areas=await this.getAreas(i);const f=d.areas.reduce((y,S)=>y+parseFloat(S.weight||0),0),p=d.areas.filter(y=>y.status==="done").reduce((y,S)=>y+parseFloat(S.weight||0),0);d.progress=f>0?Math.round(p/f*100):0}if(l.permissions.photos){const{data:f}=await _.from("t_and_m_tickets").select("photos, work_date").eq("project_id",i).not("photos","is",null).order("work_date",{ascending:!1}).limit(20);d.photos=f?.flatMap(p=>(p.photos||[]).map(y=>({url:y,date:p.work_date})))||[]}if(l.permissions.daily_reports){const{data:f}=await _.from("daily_reports").select("*").eq("project_id",i).order("report_date",{ascending:!1}).limit(10);d.dailyReports=f||[]}return l.permissions.tm_tickets&&(d.tmTickets=await this.getTMTickets(i)),d},async createInjuryReport(r){if(!v){const c=I();c.injuryReports||(c.injuryReports=[]);const d={id:crypto.randomUUID(),...r,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return c.injuryReports.push(d),Ee(c),d}const{data:l,error:i}=await _.from("injury_reports").insert(r).select().single();if(i)throw console.error("Error creating injury report:",i),i;return l},async getInjuryReports(r){if(!v){const c=I();return c.injuryReports?c.injuryReports.filter(d=>d.project_id===r).sort((d,f)=>new Date(f.incident_date)-new Date(d.incident_date)):[]}const{data:l,error:i}=await _.from("injury_reports").select("*").eq("project_id",r).order("incident_date",{ascending:!1});return i?(console.error("Error fetching injury reports:",i),[]):l||[]},async getCompanyInjuryReports(r,l=null){if(!v){const f=I();if(!f.injuryReports)return[];let p=f.injuryReports.filter(y=>y.company_id===r);return l&&(p=p.filter(y=>y.status===l)),p.sort((y,S)=>new Date(S.incident_date)-new Date(y.incident_date))}let i=_.from("injury_reports").select("*, projects(name)").eq("company_id",r).order("incident_date",{ascending:!1});l&&(i=i.eq("status",l));const{data:c,error:d}=await i;return d?(console.error("Error fetching company injury reports:",d),[]):c||[]},async getInjuryReport(r){if(!v){const c=I();return c.injuryReports?c.injuryReports.find(d=>d.id===r):null}const{data:l,error:i}=await _.from("injury_reports").select("*, projects(name, pin), users(name, email)").eq("id",r).single();return i?(console.error("Error fetching injury report:",i),null):l},async updateInjuryReport(r,l){if(!v){const d=I();if(!d.injuryReports)return null;const f=d.injuryReports.findIndex(p=>p.id===r);return f===-1?null:(d.injuryReports[f]={...d.injuryReports[f],...l,updated_at:new Date().toISOString()},Ee(d),d.injuryReports[f])}const{data:i,error:c}=await _.from("injury_reports").update(l).eq("id",r).select().single();if(c)throw console.error("Error updating injury report:",c),c;return i},async closeInjuryReport(r,l){return this.updateInjuryReport(r,{status:"closed",closed_at:new Date().toISOString(),closed_by:l})},async deleteInjuryReport(r){if(!v){const i=I();if(!i.injuryReports)return;i.injuryReports=i.injuryReports.filter(c=>c.id!==r),Ee(i);return}const{error:l}=await _.from("injury_reports").delete().eq("id",r);if(l)throw console.error("Error deleting injury report:",l),l},async getInjuryStatistics(r,l=null,i=null){if(!v){const f=I();if(!f.injuryReports)return{total_incidents:0,minor_injuries:0,serious_injuries:0,critical_injuries:0,near_misses:0,osha_recordable:0,total_days_away:0,total_restricted_days:0};let p=f.injuryReports.filter(y=>y.company_id===r);return l&&(p=p.filter(y=>new Date(y.incident_date)>=new Date(l))),i&&(p=p.filter(y=>new Date(y.incident_date)<=new Date(i))),{total_incidents:p.length,minor_injuries:p.filter(y=>y.injury_type==="minor").length,serious_injuries:p.filter(y=>y.injury_type==="serious").length,critical_injuries:p.filter(y=>y.injury_type==="critical").length,near_misses:p.filter(y=>y.injury_type==="near_miss").length,osha_recordable:p.filter(y=>y.osha_recordable).length,total_days_away:p.reduce((y,S)=>y+(S.days_away_from_work||0),0),total_restricted_days:p.reduce((y,S)=>y+(S.restricted_work_days||0),0)}}const{data:c,error:d}=await _.rpc("get_injury_statistics",{comp_id:r,start_date:l,end_date:i});return d?(console.error("Error fetching injury statistics:",d),null):c[0]||null},async addWitness(r,l){if(!v){const d=I();if(!d.injuryReports)return null;const f=d.injuryReports.findIndex(S=>S.id===r);if(f===-1)return null;const p=d.injuryReports[f],y=p.witnesses||[];return y.push(l),d.injuryReports[f]={...p,witnesses:y,updated_at:new Date().toISOString()},Ee(d),d.injuryReports[f]}const i=await this.getInjuryReport(r);if(!i)return null;const c=i.witnesses||[];return c.push(l),this.updateInjuryReport(r,{witnesses:c})},async removeWitness(r,l){if(!v){const d=I();if(!d.injuryReports)return null;const f=d.injuryReports.findIndex(S=>S.id===r);if(f===-1)return null;const p=d.injuryReports[f],y=p.witnesses||[];return y.splice(l,1),d.injuryReports[f]={...p,witnesses:y,updated_at:new Date().toISOString()},Ee(d),d.injuryReports[f]}const i=await this.getInjuryReport(r);if(!i)return null;const c=i.witnesses||[];return c.splice(l,1),this.updateInjuryReport(r,{witnesses:c})},async getCompanyUsers(r){if(v){const{data:l,error:i}=await _.from("user_companies").select(`
          user_id,
          role,
          users (
            id,
            name,
            email
          )
        `).eq("company_id",r);return i?(console.error("Error fetching company users:",i),[]):l?.map(c=>({id:c.user_id,name:c.users?.name||c.users?.email,email:c.users?.email,role:c.role}))||[]}return[]},async getProjectNotificationPreferences(r){if(v){const{data:i,error:c}=await _.from("notification_preferences").select(`
          *,
          users (
            id,
            name,
            email
          )
        `).eq("project_id",r);return c?(console.error("Error fetching notification preferences:",c),[]):i||[]}const l=I();return l.notificationPreferences?l.notificationPreferences.filter(i=>i.project_id===r):[]},async getUserNotificationPreferences(r){if(v){const{data:i,error:c}=await _.from("notification_preferences").select(`
          *,
          projects (
            id,
            name
          )
        `).eq("user_id",r);return c?(console.error("Error fetching user notification preferences:",c),[]):i||[]}const l=I();return l.notificationPreferences?l.notificationPreferences.filter(i=>i.user_id===r):[]},async setNotificationPreference(r,l,i){if(v){const{data:p,error:y}=await _.from("notification_preferences").upsert({project_id:r,user_id:l,notification_types:i,updated_at:new Date().toISOString()},{onConflict:"project_id,user_id"}).select().single();if(y)throw console.error("Error setting notification preference:",y),y;return p}const c=I();c.notificationPreferences||(c.notificationPreferences=[]);const d=c.notificationPreferences.findIndex(p=>p.project_id===r&&p.user_id===l),f={id:d>=0?c.notificationPreferences[d].id:crypto.randomUUID(),project_id:r,user_id:l,notification_types:i,created_at:d>=0?c.notificationPreferences[d].created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return d>=0?c.notificationPreferences[d]=f:c.notificationPreferences.push(f),Ee(c),f},async removeNotificationPreference(r,l){if(v){const{error:c}=await _.from("notification_preferences").delete().eq("project_id",r).eq("user_id",l);if(c)throw console.error("Error removing notification preference:",c),c;return!0}const i=I();return i.notificationPreferences&&(i.notificationPreferences=i.notificationPreferences.filter(c=>!(c.project_id===r&&c.user_id===l)),Ee(i)),!0},async setProjectNotificationPreferences(r,l){const i=[];for(const c of l)if(c.notificationTypes&&c.notificationTypes.length>0){const d=await this.setNotificationPreference(r,c.userId,c.notificationTypes);i.push(d)}else await this.removeNotificationPreference(r,c.userId);return i},async getNotificationPresets(r){if(v){const{data:i,error:c}=await _.from("notification_presets").select("*").eq("company_id",r).order("name");return c?(console.error("Error fetching notification presets:",c),[]):i||[]}const l=I();return l.notificationPresets?l.notificationPresets.filter(i=>i.company_id===r):[{id:"preset-1",name:"Project Manager",notification_types:["message","material_request","injury_report","tm_ticket"],company_id:r},{id:"preset-2",name:"Safety Officer",notification_types:["injury_report"],company_id:r},{id:"preset-3",name:"Purchasing",notification_types:["material_request"],company_id:r},{id:"preset-4",name:"Accounting",notification_types:["tm_ticket"],company_id:r}]},async createNotificationPreset(r,l,i){if(v){const{data:f,error:p}=await _.from("notification_presets").insert({company_id:r,name:l,notification_types:i}).select().single();if(p)throw console.error("Error creating notification preset:",p),p;return f}const c=I();c.notificationPresets||(c.notificationPresets=[]);const d={id:crypto.randomUUID(),company_id:r,name:l,notification_types:i,created_at:new Date().toISOString()};return c.notificationPresets.push(d),Ee(c),d},async updateNotificationPreset(r,l,i){if(v){const{data:f,error:p}=await _.from("notification_presets").update({name:l,notification_types:i,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(p)throw console.error("Error updating notification preset:",p),p;return f}const c=I();if(!c.notificationPresets)return null;const d=c.notificationPresets.findIndex(f=>f.id===r);return d===-1?null:(c.notificationPresets[d]={...c.notificationPresets[d],name:l,notification_types:i,updated_at:new Date().toISOString()},Ee(c),c.notificationPresets[d])},async deleteNotificationPreset(r){if(v){const{error:i}=await _.from("notification_presets").delete().eq("id",r);if(i)throw console.error("Error deleting notification preset:",i),i;return!0}const l=I();return l.notificationPresets&&(l.notificationPresets=l.notificationPresets.filter(i=>i.id!==r),Ee(l)),!0},async getDumpSites(r){if(v){const{data:i,error:c}=await _.from("dump_sites").select(`
          *,
          dump_site_rates (*)
        `).eq("company_id",r).eq("active",!0).order("name");return c?(console.error("Error fetching dump sites:",c),[]):i||[]}return(I().dumpSites||[]).filter(i=>i.company_id===r&&i.active)},async createDumpSite(r,l,i="",c=""){if(v){const{data:p,error:y}=await _.from("dump_sites").insert({company_id:r,name:l,address:i,notes:c,active:!0}).select().single();if(y)throw console.error("Error creating dump site:",y),y;return p}const d=I();d.dumpSites||(d.dumpSites=[]);const f={id:crypto.randomUUID(),company_id:r,name:l,address:i,notes:c,active:!0,created_at:new Date().toISOString(),dump_site_rates:[]};return d.dumpSites.push(f),Ee(d),f},async updateDumpSite(r,l){if(v){const{data:d,error:f}=await _.from("dump_sites").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(f)throw console.error("Error updating dump site:",f),f;return d}const i=I();if(!i.dumpSites)return null;const c=i.dumpSites.findIndex(d=>d.id===r);return c===-1?null:(i.dumpSites[c]={...i.dumpSites[c],...l},Ee(i),i.dumpSites[c])},async deleteDumpSite(r){return this.updateDumpSite(r,{active:!1})},async setDumpSiteRate(r,l,i,c="load"){if(v){const{data:y}=await _.from("dump_site_rates").select("id").eq("dump_site_id",r).eq("waste_type",l).maybeSingle();if(y){const{data:S,error:z}=await _.from("dump_site_rates").update({estimated_cost_per_load:i,unit:c}).eq("id",y.id).select().single();if(z)throw console.error("Error updating dump site rate:",z),z;return S}else{const{data:S,error:z}=await _.from("dump_site_rates").insert({dump_site_id:r,waste_type:l,estimated_cost_per_load:i,unit:c}).select().single();if(z)throw console.error("Error inserting dump site rate:",z),z;return S}}const d=I();d.dumpSiteRates||(d.dumpSiteRates=[]);const f=d.dumpSiteRates.findIndex(y=>y.dump_site_id===r&&y.waste_type===l),p={id:f>=0?d.dumpSiteRates[f].id:crypto.randomUUID(),dump_site_id:r,waste_type:l,estimated_cost_per_load:i,unit:c,created_at:new Date().toISOString()};return f>=0?d.dumpSiteRates[f]=p:d.dumpSiteRates.push(p),Ee(d),p},async getDumpSiteRates(r){if(v){const{data:i,error:c}=await _.from("dump_site_rates").select("*").eq("dump_site_id",r);return c?(console.error("Error fetching dump site rates:",c),[]):i||[]}return(I().dumpSiteRates||[]).filter(i=>i.dump_site_id===r)},async getHaulOffs(r){if(v){const{data:i,error:c}=await _.from("haul_offs").select(`
          *,
          dump_sites (name)
        `).eq("project_id",r).order("work_date",{ascending:!1});return c?(console.error("Error fetching haul-offs:",c),[]):i||[]}return(I().haulOffs||[]).filter(i=>i.project_id===r).sort((i,c)=>new Date(c.work_date)-new Date(i.work_date))},async createHaulOff(r,l){const i={project_id:r,dump_site_id:l.dumpSiteId,waste_type:l.wasteType,loads:l.loads,hauling_company:l.haulingCompany||"",work_date:l.workDate,notes:l.notes||"",estimated_cost:l.estimatedCost||0,created_by:l.createdBy||""};if(v){const{data:f,error:p}=await _.from("haul_offs").insert(i).select().single();if(p)throw console.error("Error creating haul-off:",p),p;return f}const c=I();c.haulOffs||(c.haulOffs=[]);const d={...i,id:crypto.randomUUID(),created_at:new Date().toISOString()};return c.haulOffs.push(d),Ee(c),d},async calculateHaulOffCosts(r){const l=await this.getHaulOffs(r);let i=0,c=0;const d={},f=[],p={};l.forEach(S=>{const z=parseFloat(S.estimated_cost)||0,k=parseInt(S.loads)||0;i+=z,c+=k,d[S.waste_type]||(d[S.waste_type]={loads:0,cost:0}),d[S.waste_type].loads+=k,d[S.waste_type].cost+=z,p[S.work_date]||(p[S.work_date]={date:S.work_date,loads:0,cost:0}),p[S.work_date].loads+=k,p[S.work_date].cost+=z}),Object.values(p).sort((S,z)=>new Date(z.date)-new Date(S.date)).forEach(S=>f.push(S));const y=f.length;return{totalCost:i,totalLoads:c,byWasteType:d,byDate:f,daysWithHaulOff:y,avgDailyHaulOffCost:y>0?i/y:0}},subscribeToHaulOffs(r,l){return v?_.channel(`haul_offs:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"haul_offs",filter:`project_id=eq.${r}`},l).subscribe():null},async createCOR(r,l=0){if(v){let i=r.cor_number;l>0&&(i=await this.getNextCORNumber(r.project_id));const{data:c,error:d}=await _.from("change_orders").insert({company_id:r.company_id,project_id:r.project_id,area_id:r.area_id||null,cor_number:i,title:r.title,description:r.description||"",scope_of_work:r.scope_of_work,period_start:r.period_start,period_end:r.period_end,status:"draft",labor_markup_percent:r.labor_markup_percent??1500,materials_markup_percent:r.materials_markup_percent??1500,equipment_markup_percent:r.equipment_markup_percent??1500,subcontractors_markup_percent:r.subcontractors_markup_percent??500,liability_insurance_percent:r.liability_insurance_percent??144,bond_percent:r.bond_percent??100,license_fee_percent:r.license_fee_percent??10,created_by:r.created_by||null}).select().single();if((d?.code==="23505"||d?.code==="PGRST116"||d?.status===409||d?.message?.includes("duplicate")||d?.message?.includes("unique_cor_number"))&&l<3)return console.warn(`COR number conflict, retrying with fresh number (attempt ${l+1})`),this.createCOR(r,l+1);if(d)throw d;return c}return null},async updateCOR(r,l){if(v){const{data:i,error:c}=await _.from("change_orders").update({...l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw c;return i}return null},async deleteCOR(r){if(v){const{error:l}=await _.from("change_orders").delete().eq("id",r);if(l)throw l}},async bulkUpdateCORGroup(r,l){if(v){const{error:i}=await _.from("change_orders").update({group_name:l,updated_at:new Date().toISOString()}).in("id",r);if(i)throw i.message?.includes("group_name")||i.code==="PGRST204"?new Error("COR grouping requires a database migration. Please run database/migration_cor_enhancements.sql in Supabase SQL Editor."):i}},async getCORs(r,l={}){if(v){let i=_.from("change_orders").select(`
          *,
          areas (id, name),
          labor_count:change_order_labor(count),
          materials_count:change_order_materials(count),
          equipment_count:change_order_equipment(count),
          subcontractors_count:change_order_subcontractors(count),
          tickets_count:change_order_ticket_associations(count)
        `).eq("project_id",r);l.status&&(i=i.eq("status",l.status)),l.area_id&&(i=i.eq("area_id",l.area_id)),l.date_start&&(i=i.gte("period_start",l.date_start)),l.date_end&&(i=i.lte("period_end",l.date_end)),i=i.order("created_at",{ascending:!1});const{data:c,error:d}=await i;if(d)throw d;return c}return[]},async getCORById(r){if(v){const{data:l,error:i}=await _.from("change_orders").select(`
          *,
          areas (id, name),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*),
          change_order_ticket_associations (
            *,
            t_and_m_tickets (
              *,
              t_and_m_workers (*),
              t_and_m_items (
                *,
                materials_equipment (name, unit, cost_per_unit, category)
              )
            )
          )
        `).eq("id",r).single();if(i)throw i;return l}return null},async getCORsByArea(r,l){if(v){const{data:i,error:c}=await _.from("change_orders").select("*").eq("project_id",r).eq("area_id",l).order("created_at",{ascending:!1});if(c)throw c;return i}return[]},async getAssignableCORs(r){if(v){const{data:l,error:i}=await _.from("change_orders").select("id, cor_number, title, status, cor_total").eq("project_id",r).in("status",["draft","pending_approval","approved"]).order("cor_number",{ascending:!0});if(i)throw i;return l||[]}return[]},async getNextCORNumber(r){if(v){const{data:l,error:i}=await _.from("change_orders").select("cor_number").eq("project_id",r);if(i)throw i;if(l&&l.length>0){let c=0;for(const d of l){const f=d.cor_number?.match(/COR #(\d+)/);if(f){const p=parseInt(f[1]);p>c&&(c=p)}}return`COR #${c+1}`}return"COR #1"}return"COR #1"},async addCORLaborItem(r,l){if(v){const i=Math.round(l.regular_hours*l.regular_rate),c=Math.round(l.overtime_hours*l.overtime_rate),d=i+c,{data:f,error:p}=await _.from("change_order_labor").insert({change_order_id:r,labor_class:l.labor_class,wage_type:l.wage_type||"standard",regular_hours:l.regular_hours||0,overtime_hours:l.overtime_hours||0,regular_rate:l.regular_rate||0,overtime_rate:l.overtime_rate||0,regular_total:i,overtime_total:c,total:d,sort_order:l.sort_order||0,source_ticket_id:l.source_ticket_id||null}).select().single();if(p)throw p;return f}return null},async updateCORLaborItem(r,l){if(v){let i={...l};if(l.regular_hours!==void 0||l.regular_rate!==void 0||l.overtime_hours!==void 0||l.overtime_rate!==void 0){const{data:f}=await _.from("change_order_labor").select("regular_hours, overtime_hours, regular_rate, overtime_rate").eq("id",r).single(),p=l.regular_hours??f?.regular_hours??0,y=l.overtime_hours??f?.overtime_hours??0,S=l.regular_rate??f?.regular_rate??0,z=l.overtime_rate??f?.overtime_rate??0;i.regular_total=Math.round(p*S),i.overtime_total=Math.round(y*z),i.total=i.regular_total+i.overtime_total}const{data:c,error:d}=await _.from("change_order_labor").update(i).eq("id",r).select().single();if(d)throw d;return c}return null},async deleteCORLaborItem(r){if(v){const{error:l}=await _.from("change_order_labor").delete().eq("id",r);if(l)throw l}},async addCORMaterialItem(r,l){if(v){const c=["backup_sheet","invoice","mobilization","custom","field_ticket","rental"].includes(l.source_type)?l.source_type:"custom",d=Math.round(Number(l.unit_cost)||0),f=Number(l.quantity)||1,p=Math.round(f*d),{data:y,error:S}=await _.from("change_order_materials").insert({change_order_id:r,description:l.description||"",quantity:f,unit:l.unit||"each",unit_cost:d,total:p,source_type:c,source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(S)throw S;return y}return null},async updateCORMaterialItem(r,l){if(v){let i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:f}=await _.from("change_order_materials").select("quantity, unit_cost").eq("id",r).single(),p=l.quantity??f?.quantity??1,y=l.unit_cost??f?.unit_cost??0;i.total=Math.round(p*y)}const{data:c,error:d}=await _.from("change_order_materials").update(i).eq("id",r).select().single();if(d)throw d;return c}return null},async deleteCORMaterialItem(r){if(v){const{error:l}=await _.from("change_order_materials").delete().eq("id",r);if(l)throw l}},async addCOREquipmentItem(r,l){if(v){const c=["backup_sheet","invoice","custom","field_ticket","rental"].includes(l.source_type)?l.source_type:"custom",d=Math.round(Number(l.unit_cost)||0),f=Number(l.quantity)||1,p=Math.round(f*d),{data:y,error:S}=await _.from("change_order_equipment").insert({change_order_id:r,description:l.description||"",quantity:f,unit:l.unit||"day",unit_cost:d,total:p,source_type:c,source_reference:l.source_reference||null,source_ticket_id:l.source_ticket_id||null,sort_order:l.sort_order||0}).select().single();if(S)throw S;return y}return null},async updateCOREquipmentItem(r,l){if(v){let i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:f}=await _.from("change_order_equipment").select("quantity, unit_cost").eq("id",r).single(),p=l.quantity??f?.quantity??1,y=l.unit_cost??f?.unit_cost??0;i.total=Math.round(p*y)}const{data:c,error:d}=await _.from("change_order_equipment").update(i).eq("id",r).select().single();if(d)throw d;return c}return null},async deleteCOREquipmentItem(r){if(v){const{error:l}=await _.from("change_order_equipment").delete().eq("id",r);if(l)throw l}},async addCORSubcontractorItem(r,l){if(v){const i=Math.round(l.quantity*l.unit_cost),{data:c,error:d}=await _.from("change_order_subcontractors").insert({change_order_id:r,description:l.description,quantity:l.quantity||1,unit:l.unit||"lump sum",unit_cost:l.unit_cost||0,total:i,source_type:l.source_type||"custom",source_reference:l.source_reference||null,sort_order:l.sort_order||0}).select().single();if(d)throw d;return c}return null},async updateCORSubcontractorItem(r,l){if(v){let i={...l};if(l.quantity!==void 0||l.unit_cost!==void 0){const{data:f}=await _.from("change_order_subcontractors").select("quantity, unit_cost").eq("id",r).single(),p=l.quantity??f?.quantity??1,y=l.unit_cost??f?.unit_cost??0;i.total=Math.round(p*y)}const{data:c,error:d}=await _.from("change_order_subcontractors").update(i).eq("id",r).select().single();if(d)throw d;return c}return null},async deleteCORSubcontractorItem(r){if(v){const{error:l}=await _.from("change_order_subcontractors").delete().eq("id",r);if(l)throw l}},async addBulkLaborItems(r,l){if(v&&l.length>0){const i=l.map((f,p)=>{const y=Math.round(f.regular_hours*f.regular_rate),S=Math.round(f.overtime_hours*f.overtime_rate);return{change_order_id:r,labor_class:f.labor_class,wage_type:f.wage_type||"standard",regular_hours:f.regular_hours||0,overtime_hours:f.overtime_hours||0,regular_rate:f.regular_rate||0,overtime_rate:f.overtime_rate||0,regular_total:y,overtime_total:S,total:y+S,sort_order:f.sort_order??p,source_ticket_id:f.source_ticket_id||null}}),{data:c,error:d}=await _.from("change_order_labor").insert(i).select();if(d)throw d;return c}return[]},async addBulkMaterialItems(r,l){if(v&&l.length>0){const i=["backup_sheet","invoice","mobilization","custom","field_ticket","rental"],c=l.map((p,y)=>{const S=i.includes(p.source_type)?p.source_type:"custom",z=Math.round(Number(p.unit_cost)||0),k=Number(p.quantity)||1;return{change_order_id:r,description:p.description||"",quantity:k,unit:p.unit||"each",unit_cost:z,total:Math.round(k*z),source_type:S,source_reference:p.source_reference||null,source_ticket_id:p.source_ticket_id||null,sort_order:p.sort_order??y}}),{data:d,error:f}=await _.from("change_order_materials").insert(c).select();if(f)throw f;return d}return[]},async addBulkEquipmentItems(r,l){if(v&&l.length>0){const i=["backup_sheet","invoice","custom","field_ticket","rental"],c=l.map((p,y)=>{const S=i.includes(p.source_type)?p.source_type:"custom",z=Math.round(Number(p.unit_cost)||0),k=Number(p.quantity)||1;return{change_order_id:r,description:p.description||"",quantity:k,unit:p.unit||"day",unit_cost:z,total:Math.round(k*z),source_type:S,source_reference:p.source_reference||null,source_ticket_id:p.source_ticket_id||null,sort_order:p.sort_order??y}}),{data:d,error:f}=await _.from("change_order_equipment").insert(c).select();if(f)throw f;return d}return[]},async addBulkSubcontractorItems(r,l){if(v&&l.length>0){const i=l.map((f,p)=>({change_order_id:r,company_name:f.company_name||"",description:f.description||"",quantity:f.quantity||1,unit:f.unit||"lump sum",unit_cost:f.unit_cost||f.total||f.amount||0,total:f.total||f.amount||0,source_type:f.source_type||"invoice",source_reference:f.source_reference||null,sort_order:f.sort_order??p})),{data:c,error:d}=await _.from("change_order_subcontractors").insert(i).select();if(d)throw d;return c}return[]},async clearCORLineItems(r){v&&(await _.from("change_order_labor").delete().eq("change_order_id",r),await _.from("change_order_materials").delete().eq("change_order_id",r),await _.from("change_order_equipment").delete().eq("change_order_id",r),await _.from("change_order_subcontractors").delete().eq("change_order_id",r))},async saveCORLineItems(r,{laborItems:l,materialItems:i,equipmentItems:c,subcontractorItems:d}){if(v){await this.clearCORLineItems(r);const f=await Promise.all([l?.length>0?this.addBulkLaborItems(r,l):[],i?.length>0?this.addBulkMaterialItems(r,i):[],c?.length>0?this.addBulkEquipmentItems(r,c):[],d?.length>0?this.addBulkSubcontractorItems(r,d):[]]);return{labor:f[0],materials:f[1],equipment:f[2],subcontractors:f[3]}}return null},async assignTicketToCOR(r,l){if(v){const{error:i}=await _.rpc("assign_ticket_to_cor",{p_ticket_id:r,p_cor_id:l});if(i)throw Ce.error("database",{message:i.message,operation:"assignTicketToCOR",extra:{ticketId:r,corId:l}}),i;return{ticket_id:r,change_order_id:l}}return null},async unassignTicketFromCOR(r,l){if(v){const{error:i}=await _.rpc("unassign_ticket_from_cor",{p_ticket_id:r,p_cor_id:l});if(i)throw Ce.error("database",{message:i.message,operation:"unassignTicketFromCOR",extra:{ticketId:r,corId:l}}),i}},async checkTicketCORIntegrity(){if(v){const{data:r,error:l}=await _.rpc("check_ticket_cor_integrity");if(l)throw l;return r||[]}return[]},async fixTicketCORIntegrity(){if(v){const{data:r,error:l}=await _.rpc("fix_ticket_cor_integrity");if(l)throw l;return r}return 0},async getTicketsForCOR(r){if(v){const{data:l,error:i}=await _.from("change_order_ticket_associations").select(`
          *,
          t_and_m_tickets (
            *,
            t_and_m_workers (*),
            t_and_m_items (
              *,
              materials_equipment (name, unit, cost_per_unit, category)
            )
          )
        `).eq("change_order_id",r);if(i)throw i;return l}return[]},async getUnassignedTickets(r){if(v){const{data:l,error:i}=await _.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("project_id",r).is("assigned_cor_id",null).order("work_date",{ascending:!1});if(i)throw i;return l}return[]},async importTicketDataToCOR(r,l,i,c,d){if(v){const{data:f,error:p}=await _.from("t_and_m_tickets").select(`
          *,
          t_and_m_workers (*),
          t_and_m_items (
            *,
            materials_equipment (name, unit, cost_per_unit, category)
          )
        `).eq("id",r).single();if(p)throw p;const{data:y,error:S}=await _.from("labor_rates").select("*").eq("company_id",i).eq("work_type",c||"demolition").eq("job_type",d||"standard");if(S)throw S;const z={};y?.forEach(Z=>{z[Z.role.toLowerCase()]=Z});const k={};f.t_and_m_workers?.forEach(Z=>{const oe=(Z.role||"laborer").toLowerCase();k[oe]||(k[oe]={regular_hours:0,overtime_hours:0}),k[oe].regular_hours+=parseFloat(Z.hours)||0,k[oe].overtime_hours+=parseFloat(Z.overtime_hours)||0});const M=Object.entries(k).map(([Z,oe])=>{const ee=z[Z]||{regular_rate:0,overtime_rate:0},me=Math.round((parseFloat(ee.regular_rate)||0)*100),de=Math.round((parseFloat(ee.overtime_rate)||0)*100);return{labor_class:Z.charAt(0).toUpperCase()+Z.slice(1),wage_type:d||"standard",regular_hours:oe.regular_hours,overtime_hours:oe.overtime_hours,regular_rate:me,overtime_rate:de,source_ticket_id:r}});M.length>0&&await this.addBulkLaborItems(l,M);const F=[],P=[];f.t_and_m_items?.forEach(Z=>{const oe=Z.custom_name||Z.materials_equipment?.name||"Unknown Item",ee=Z.custom_category||Z.materials_equipment?.category||"Other",me=Z.materials_equipment?.unit||"each",de=Math.round((parseFloat(Z.materials_equipment?.cost_per_unit)||0)*100),se={description:oe,quantity:Z.quantity||1,unit:me,unit_cost:de,source_type:"backup_sheet",source_ticket_id:r};ee==="Equipment"?P.push(se):F.push(se)}),F.length>0&&await this.addBulkMaterialItems(l,F),P.length>0&&await this.addBulkEquipmentItems(l,P);const{error:$}=await _.from("change_order_ticket_associations").update({data_imported:!0,imported_at:new Date().toISOString(),import_status:"completed",import_failed_at:null,import_error:null}).eq("change_order_id",l).eq("ticket_id",r);if($)throw $;return Ce.activity("cor_import_success",{ticket_id:r,cor_id:l,labor_count:M.length,material_count:F.length,equipment_count:P.length}),{laborItems:M,materialItems:F,equipmentItems:P}}return null},async reimportTicketDataToCOR(r,l,i,c,d){return v?(await _.from("change_order_labor").delete().eq("change_order_id",l).eq("source_ticket_id",r),await _.from("change_order_materials").delete().eq("change_order_id",l).eq("source_ticket_id",r),await _.from("change_order_equipment").delete().eq("change_order_id",l).eq("source_ticket_id",r),this.importTicketDataToCOR(r,l,i,c,d)):null},async markImportFailed(r,l,i="Import failed"){if(v){const{error:c}=await _.from("change_order_ticket_associations").update({import_status:"failed",import_failed_at:new Date().toISOString(),import_error:i}).eq("change_order_id",l).eq("ticket_id",r);if(c)throw Ce.error("database",{message:c.message,operation:"markImportFailed",extra:{ticketId:r,corId:l}}),c;Ce.error("cor_import_failed",{ticket_id:r,cor_id:l,error:i})}},async getTicketsNeedingImport(r){if(v){const{data:l,error:i}=await _.from("t_and_m_tickets").select(`
          id,
          work_date,
          ce_pco_number,
          assigned_cor_id,
          change_order_ticket_associations!inner (
            change_order_id,
            import_status,
            import_failed_at,
            import_error
          )
        `).eq("project_id",r).eq("change_order_ticket_associations.import_status","failed");if(i)throw i;return l||[]}return[]},async getTicketImportStatus(r,l){if(v){const{data:i,error:c}=await _.from("change_order_ticket_associations").select("import_status, import_failed_at, import_error, data_imported").eq("ticket_id",r).eq("change_order_id",l).single();if(c&&c.code!=="PGRST116")throw c;return i}return null},async recalculateCOR(r){if(v){const{error:l}=await _.rpc("recalculate_cor_totals",{cor_id:r});if(l)throw l;return this.getCORById(r)}return null},async updateCORMarkupPercentages(r,l){if(v){const i={};l.labor!==void 0&&(i.labor_markup_percent=l.labor),l.materials!==void 0&&(i.materials_markup_percent=l.materials),l.equipment!==void 0&&(i.equipment_markup_percent=l.equipment),l.subcontractors!==void 0&&(i.subcontractors_markup_percent=l.subcontractors);const{data:c,error:d}=await _.from("change_orders").update(i).eq("id",r).select().single();if(d)throw d;return c}return null},async updateCORFeePercentages(r,l){if(v){const i={};l.liabilityInsurance!==void 0&&(i.liability_insurance_percent=l.liabilityInsurance),l.bond!==void 0&&(i.bond_percent=l.bond),l.licenseFee!==void 0&&(i.license_fee_percent=l.licenseFee);const{data:c,error:d}=await _.from("change_orders").update(i).eq("id",r).select().single();if(d)throw d;return c}return null},async submitCORForApproval(r){if(v){const{data:l,error:i}=await _.from("change_orders").update({status:"pending_approval",submitted_at:new Date().toISOString()}).eq("id",r).select().single();if(i)throw i;return l}return null},async approveCOR(r,l){if(v){const{data:i,error:c}=await _.from("change_orders").update({status:"approved",approved_by:l,approved_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw c;return i}return null},async rejectCOR(r,l=null){if(v){const{data:i,error:c}=await _.from("change_orders").update({status:"rejected",rejection_reason:l}).eq("id",r).select().single();if(c)throw c;return i}return null},async markCORAsBilled(r){if(v){const{data:l,error:i}=await _.from("change_orders").update({status:"billed"}).eq("id",r).select().single();if(i)throw i;return l}return null},async closeCOR(r){if(v){const{data:l,error:i}=await _.from("change_orders").update({status:"closed"}).eq("id",r).select().single();if(i)throw i;return l}return null},async saveCORSignature(r,l,i){if(v){const{data:c,error:d}=await _.from("change_orders").update({gc_signature_data:l,gc_signature_name:i,gc_signature_date:new Date().toISOString(),status:"approved"}).eq("id",r).select().single();if(d)throw d;return c}return null},async getCORStats(r){if(v){const{data:l,error:i}=await _.from("change_orders").select("status, cor_total").eq("project_id",r);if(i)throw i;const c={total_cors:l.length,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0};return l.forEach(d=>{switch(d.status){case"draft":c.draft_count++;break;case"pending_approval":c.pending_count++,c.total_pending_value+=d.cor_total||0;break;case"approved":c.approved_count++,c.total_approved_value+=d.cor_total||0;break;case"rejected":c.rejected_count++;break;case"billed":case"closed":c.billed_count++,c.total_billed_value+=d.cor_total||0;break}}),c}return{total_cors:0,draft_count:0,pending_count:0,approved_count:0,rejected_count:0,billed_count:0,total_approved_value:0,total_pending_value:0,total_billed_value:0}},subscribeToCORs(r,l){return v?_.channel(`change_orders:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"change_orders",filter:`project_id=eq.${r}`},l).subscribe():null},subscribeToCorTickets(r,l){return v?_.channel(`cor-tickets:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"change_order_ticket_associations",filter:`change_order_id=eq.${r}`},l).subscribe():null},async getCORLog(r){if(v){const{data:l,error:i}=await _.from("cor_log_entries").select(`
          id,
          log_number,
          date_sent_to_client,
          ce_number,
          comments,
          created_at,
          updated_at,
          change_order:change_orders (
            id,
            cor_number,
            title,
            cor_total,
            status,
            created_at,
            approved_at,
            approved_by
          )
        `).eq("project_id",r).order("log_number",{ascending:!0});if(i)throw console.error("Error fetching COR log:",i),i;return(l||[]).map(c=>({id:c.id,logNumber:c.log_number,dateSentToClient:c.date_sent_to_client,ceNumber:c.ce_number,comments:c.comments,createdAt:c.created_at,updatedAt:c.updated_at,changeOrder:{id:c.change_order?.id,corNumber:c.change_order?.cor_number,title:c.change_order?.title,corTotal:c.change_order?.cor_total,status:c.change_order?.status,createdAt:c.change_order?.created_at,approvedAt:c.change_order?.approved_at,approvedBy:c.change_order?.approved_by}}))}return[]},async updateCORLogEntry(r,l){if(v){const i={updated_at:new Date().toISOString()};l.dateSentToClient!==void 0&&(i.date_sent_to_client=l.dateSentToClient||null),l.ceNumber!==void 0&&(i.ce_number=l.ceNumber||null),l.comments!==void 0&&(i.comments=l.comments||null);const{data:c,error:d}=await _.from("cor_log_entries").update(i).eq("id",r).select().single();if(d)throw console.error("Error updating COR log entry:",d),d;return c}return null},async updateChangeOrderStatus(r,l){if(v){const{data:i,error:c}=await _.from("change_orders").update({status:l,updated_at:new Date().toISOString()}).eq("id",r).select().single();if(c)throw console.error("Error updating change order status:",c),c;return i}return null},subscribeToCORLog(r,l){return v?_.channel(`cor-log:${r}`).on("postgres_changes",{event:"*",schema:"public",table:"cor_log_entries",filter:`project_id=eq.${r}`},l).subscribe():null},async createSignatureRequest(r,l,i,c,d=null,f=null){if(v){const{data:p,error:y}=await _.rpc("generate_signature_token");if(y)throw y;const{data:S,error:z}=await _.from("signature_requests").insert({document_type:r,document_id:l,company_id:i,project_id:c,signature_token:p,expires_at:f,created_by:d}).select().single();if(z)throw z;return S}return null},async getSignatureRequestByToken(r){if(v){await _.rpc("increment_signature_view_count",{token:r});const{data:l,error:i}=await _.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("signature_token",r).single();if(i)throw i;return l}return null},async getSignatureRequestsForDocument(r,l){if(v){const{data:i,error:c}=await _.from("signature_requests").select(`
          *,
          signatures (*)
        `).eq("document_type",r).eq("document_id",l).order("created_at",{ascending:!1});if(c)throw c;return i||[]}return[]},async addSignature(r,l,i){if(v){const{data:c,error:d}=await _.from("signatures").insert({signature_request_id:r,signature_slot:l,signature_image:i.signature,signer_name:i.signerName,signer_title:i.signerTitle||null,signer_company:i.signerCompany||null,signed_at:i.signedAt||new Date().toISOString(),ip_address:i.ipAddress||null,user_agent:i.userAgent||null}).select().single();if(d)throw d;return c}return null},async syncSignatureToDocument(r,l){if(!v)return null;const{document_type:i,document_id:c}=l,d=r.signature_slot,f={};d===1?(f.gc_signature_data=r.signature_image,f.gc_signature_name=r.signer_name,f.gc_signature_title=r.signer_title,f.gc_signature_company=r.signer_company,f.gc_signature_date=r.signed_at,f.gc_signature_ip=r.ip_address):d===2&&(f.client_signature_data=r.signature_image,f.client_signature_name=r.signer_name,f.client_signature_title=r.signer_title,f.client_signature_company=r.signer_company,f.client_signature_date=r.signed_at,f.client_signature_ip=r.ip_address);const p=i==="cor"?"change_orders":"t_and_m_tickets",{data:y,error:S}=await _.from(p).update(f).eq("id",c).select().single();if(S)throw S;return y},async revokeSignatureRequest(r){if(v){const{data:l,error:i}=await _.from("signature_requests").update({status:"revoked"}).eq("id",r).select().single();if(i)throw i;return l}return null},async getDocumentForSigning(r,l){if(!v)return null;if(r==="cor"){const{data:i,error:c}=await _.from("change_orders").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          change_order_labor (*),
          change_order_materials (*),
          change_order_equipment (*),
          change_order_subcontractors (*)
        `).eq("id",l).single();if(c)throw c;return i}else if(r==="tm_ticket"){const{data:i,error:c}=await _.from("t_and_m_tickets").select(`
          *,
          projects (
            id,
            name,
            job_number,
            companies (
              id,
              name,
              logo_url
            )
          ),
          t_and_m_workers (*),
          t_and_m_items (*)
        `).eq("id",l).single();if(c)throw c;return i}return null},async getProjectCosts(r){if(v){const{data:i,error:c}=await _.from("project_costs").select("*").eq("project_id",r).order("cost_date",{ascending:!1});return c?(console.error("Error fetching project costs:",c),[]):i||[]}return(I().projectCosts||[]).filter(i=>i.project_id===r).sort((i,c)=>new Date(c.cost_date)-new Date(i.cost_date))},async addProjectCost(r,l,i){const c={project_id:r,company_id:l,category:i.category,description:i.description,amount:parseFloat(i.amount),cost_date:i.cost_date||new Date().toISOString().split("T")[0],notes:i.notes||null,created_by:i.created_by||null};if(v){const{data:p,error:y}=await _.from("project_costs").insert(c).select().single();if(y)throw console.error("Error adding project cost:",y),y;return p}const d=I();d.projectCosts||(d.projectCosts=[]);const f={...c,id:crypto.randomUUID(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return d.projectCosts.push(f),Ee(d),f},async updateProjectCost(r,l){const i={category:l.category,description:l.description,amount:parseFloat(l.amount),cost_date:l.cost_date,notes:l.notes||null,updated_at:new Date().toISOString()};if(v){const{data:f,error:p}=await _.from("project_costs").update(i).eq("id",r).select().single();if(p)throw console.error("Error updating project cost:",p),p;return f}const c=I();if(!c.projectCosts)return null;const d=c.projectCosts.findIndex(f=>f.id===r);return d===-1?null:(c.projectCosts[d]={...c.projectCosts[d],...i},Ee(c),c.projectCosts[d])},async deleteProjectCost(r){if(v){const{error:i}=await _.from("project_costs").delete().eq("id",r);if(i)throw console.error("Error deleting project cost:",i),i;return!0}const l=I();return l.projectCosts&&(l.projectCosts=l.projectCosts.filter(i=>i.id!==r),Ee(l)),!0},async getProjectCostsSummary(r){const l=await this.getProjectCosts(r),i={};let c=0;return l.forEach(d=>{const f=parseFloat(d.amount)||0;c+=f,i[d.category]||(i[d.category]={category:d.category,total:0,count:0,items:[]}),i[d.category].total+=f,i[d.category].count++,i[d.category].items.push(d)}),Object.values(i).forEach(d=>{d.percentage=c>0?d.total/c*100:0}),{totalCost:c,byCategory:i,itemCount:l.length}},async getNextInvoiceNumber(r){if(v){const{data:l,error:i}=await _.rpc("get_next_invoice_number",{p_company_id:r});return i?(console.error("Error getting next invoice number:",i),this._generateLocalInvoiceNumber(r)):l}return this._generateLocalInvoiceNumber(r)},async _generateLocalInvoiceNumber(r){const i=(await this.getCompanyInvoices(r)).reduce((c,d)=>{const f=d.invoice_number?.match(/^INV-(\d+)$/);if(f){const p=parseInt(f[1],10);return p>c?p:c}return c},0);return`INV-${String(i+1).padStart(4,"0")}`},async getBillableItems(r){if(v){const{data:l,error:i}=await _.from("change_orders").select("id, cor_number, title, cor_total, status, approved_at").eq("project_id",r).eq("status","approved").order("cor_number",{ascending:!0});i&&console.error("Error fetching billable CORs:",i);const{data:c,error:d}=await _.from("t_and_m_tickets").select("id, work_date, ce_pco_number, change_order_value, status, client_signature_date").eq("project_id",r).eq("status","approved").not("client_signature_data","is",null).order("work_date",{ascending:!0});return d&&console.error("Error fetching billable T&M tickets:",d),{cors:l||[],tickets:c||[]}}return{cors:[],tickets:[]}},async getProjectInvoices(r){if(v){const{data:i,error:c}=await _.from("invoices").select(`
          *,
          invoice_items (*)
        `).eq("project_id",r).order("invoice_date",{ascending:!1});if(c)throw console.error("Error fetching project invoices:",c),c;return i||[]}return(I().invoices||[]).filter(i=>i.project_id===r)},async getCompanyInvoices(r){if(v){const{data:i,error:c}=await _.from("invoices").select("*").eq("company_id",r).order("invoice_date",{ascending:!1});if(c)throw console.error("Error fetching company invoices:",c),c;return i||[]}return(I().invoices||[]).filter(i=>i.company_id===r)},async createInvoice(r,l){if(v){const{data:d,error:f}=await _.from("invoices").insert({project_id:r.project_id,company_id:r.company_id,invoice_number:r.invoice_number,invoice_date:r.invoice_date,due_date:r.due_date,status:r.status||"draft",retention_percent:r.retention_percent||0,bill_to_name:r.bill_to_name,bill_to_address:r.bill_to_address,bill_to_contact:r.bill_to_contact,notes:r.notes,terms:r.terms||"Net 30",created_by:r.created_by}).select().single();if(f)throw console.error("Error creating invoice:",f),f;if(l&&l.length>0){const p=l.map((S,z)=>({invoice_id:d.id,item_type:S.item_type,reference_id:S.reference_id,reference_number:S.reference_number,description:S.description,amount:S.amount,sort_order:z})),{error:y}=await _.from("invoice_items").insert(p);if(y)throw console.error("Error creating invoice items:",y),await _.from("invoices").delete().eq("id",d.id),y}return this.getInvoice(d.id)}const i=I();i.invoices||(i.invoices=[]);const c={...r,id:ea(),created_at:new Date().toISOString(),invoice_items:l||[]};return i.invoices.push(c),Ee(i),c},async getInvoice(r){if(v){const{data:i,error:c}=await _.from("invoices").select(`
          *,
          invoice_items (*)
        `).eq("id",r).single();if(c)throw console.error("Error fetching invoice:",c),c;return i}return(I().invoices||[]).find(i=>i.id===r)},async updateInvoice(r,l){if(v){const{data:d,error:f}=await _.from("invoices").update(l).eq("id",r).select().single();if(f)throw console.error("Error updating invoice:",f),f;return d}const i=I(),c=(i.invoices||[]).findIndex(d=>d.id===r);return c>=0?(i.invoices[c]={...i.invoices[c],...l},Ee(i),i.invoices[c]):null},async markInvoiceSent(r){return this.updateInvoice(r,{status:"sent",sent_at:new Date().toISOString()})},async recordInvoicePayment(r,l){const i=await this.getInvoice(r);if(!i)throw new Error("Invoice not found");const c=(i.amount_paid||0)+l,d=c>=i.total;return this.updateInvoice(r,{amount_paid:c,status:d?"paid":"partial",paid_at:d?new Date().toISOString():null})},async deleteInvoice(r){if(v){const{error:i}=await _.from("invoices").delete().eq("id",r).eq("status","draft");if(i)throw console.error("Error deleting invoice:",i),i;return!0}const l=I();return l.invoices=(l.invoices||[]).filter(i=>i.id!==r),Ee(l),!0},async markItemsBilled(r=[],l=[]){if(v){if(r.length>0){const{error:i}=await _.from("change_orders").update({status:"billed"}).in("id",r);i&&console.error("Error marking CORs as billed:",i)}if(l.length>0){const{error:i}=await _.from("t_and_m_tickets").update({status:"billed"}).in("id",l);i&&console.error("Error marking T&M tickets as billed:",i)}}}},a_={async getCompanyEquipment(r,l=!0){if(!v)return console.warn("Supabase not configured"),[];let i=_.from("equipment").select("*").eq("company_id",r).order("name");l&&(i=i.eq("is_active",!0));const{data:c,error:d}=await i;return d?(console.error("Error fetching company equipment:",d),[]):c||[]},async createEquipment(r){if(!v)return console.warn("Supabase not configured"),null;const{data:l,error:i}=await _.from("equipment").insert(r).select().single();if(i)throw console.error("Error creating equipment:",i),i;return l},async updateEquipment(r,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:c}=await _.from("equipment").update(l).eq("id",r).select().single();if(c)throw console.error("Error updating equipment:",c),c;return i},async deactivateEquipment(r){return this.updateEquipment(r,{is_active:!1})},async getProjectEquipment(r){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await _.from("project_equipment").select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).eq("project_id",r).order("start_date",{ascending:!1});return i?(console.error("Error fetching project equipment:",i),[]):l||[]},async getActiveProjectEquipment(r){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await _.from("project_equipment").select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).eq("project_id",r).is("end_date",null).order("start_date",{ascending:!1});return i?(console.error("Error fetching active project equipment:",i),[]):l||[]},async addEquipmentToProject(r){if(!v)return console.warn("Supabase not configured"),null;const{data:l,error:i}=await _.from("project_equipment").insert(r).select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).single();if(i)throw console.error("Error adding equipment to project:",i),i;return l},async updateProjectEquipment(r,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:c}=await _.from("project_equipment").update(l).eq("id",r).select(`
        *,
        equipment:equipment_id (
          id,
          name,
          description,
          is_owned
        )
      `).single();if(c)throw console.error("Error updating project equipment:",c),c;return i},async markEquipmentReturned(r,l=null){return this.updateProjectEquipment(r,{end_date:l||new Date().toISOString().split("T")[0]})},async removeEquipmentFromProject(r){if(!v)return console.warn("Supabase not configured"),!1;const{error:l}=await _.from("project_equipment").delete().eq("id",r);if(l)throw console.error("Error removing project equipment:",l),l;return!0},calculateProjectEquipmentCost(r){const l=new Date;return l.setHours(0,0,0,0),r.reduce((i,c)=>{const d=new Date(c.start_date);d.setHours(0,0,0,0);let f;c.end_date?(f=new Date(c.end_date),f.setHours(0,0,0,0)):f=l;const p=Math.max(1,Math.floor((f-d)/(1e3*60*60*24))+1);return i+c.daily_rate*p},0)},calculateDaysOnSite(r,l=null){const i=new Date(r);i.setHours(0,0,0,0);let c;return l?c=new Date(l):c=new Date,c.setHours(0,0,0,0),Math.max(1,Math.floor((c-i)/(1e3*60*60*24))+1)}},n_={async getNextDrawNumber(r){if(!v)return console.warn("Supabase not configured"),1;const{data:l,error:i}=await _.from("draw_requests").select("draw_number").eq("project_id",r).order("draw_number",{ascending:!1}).limit(1).single();return i&&i.code!=="PGRST116"&&console.error("Error getting next draw number:",i),(l?.draw_number||0)+1},async getPreviousBillingTotals(r){if(!v)return console.warn("Supabase not configured"),{totalBilled:0,totalRetention:0};const{data:l,error:i}=await _.from("draw_requests").select("current_billing, retention_held").eq("project_id",r).in("status",["submitted","approved","paid"]);if(i)return console.error("Error getting previous billing totals:",i),{totalBilled:0,totalRetention:0};const c=(l||[]).reduce((f,p)=>f+(p.current_billing||0),0),d=l?.length>0?Math.max(...l.map(f=>f.retention_held||0)):0;return{totalBilled:c,totalRetention:d}},async getProjectDrawRequests(r){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await _.from("draw_requests").select("*").eq("project_id",r).order("draw_number",{ascending:!1});return i?(console.error("Error fetching draw requests:",i),[]):l||[]},async getDrawRequest(r){if(!v)return console.warn("Supabase not configured"),null;const{data:l,error:i}=await _.from("draw_requests").select(`
        *,
        draw_request_items (
          *
        )
      `).eq("id",r).single();return i?(console.error("Error fetching draw request:",i),null):l},async createDrawRequest(r,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:c}=await _.from("draw_requests").insert(r).select().single();if(c)throw console.error("Error creating draw request:",c),c;if(l&&l.length>0){const d=l.map((p,y)=>({...p,draw_request_id:i.id,sort_order:y})),{error:f}=await _.from("draw_request_items").insert(d);f&&console.error("Error creating draw request items:",f)}return this.getDrawRequest(i.id)},async updateDrawRequest(r,l){if(!v)return console.warn("Supabase not configured"),null;const{data:i,error:c}=await _.from("draw_requests").update(l).eq("id",r).select().single();if(c)throw console.error("Error updating draw request:",c),c;return i},async updateDrawRequestStatus(r,l){const i={status:l};return l==="submitted"?i.submitted_at=new Date().toISOString():l==="approved"?i.approved_at=new Date().toISOString():l==="paid"&&(i.paid_at=new Date().toISOString()),this.updateDrawRequest(r,i)},async updateDrawRequestItems(r,l){if(!v)return console.warn("Supabase not configured"),!1;const{error:i}=await _.from("draw_request_items").delete().eq("draw_request_id",r);if(i)throw console.error("Error deleting old draw request items:",i),i;if(l&&l.length>0){const c=l.map((f,p)=>({...f,draw_request_id:r,sort_order:p})),{error:d}=await _.from("draw_request_items").insert(c);if(d)throw console.error("Error inserting draw request items:",d),d}return!0},async deleteDrawRequest(r){if(!v)return console.warn("Supabase not configured"),!1;const{error:l}=await _.from("draw_requests").delete().eq("id",r);if(l)throw console.error("Error deleting draw request:",l),l;return!0},async getScheduleOfValues(r){if(!v)return console.warn("Supabase not configured"),[];const{data:l,error:i}=await _.from("areas").select("id, name, square_footage, price_per_sqft").eq("project_id",r).order("created_at");return i?(console.error("Error fetching schedule of values:",i),[]):(l||[]).map((c,d)=>({area_id:c.id,item_number:String(d+1),description:c.name,scheduled_value:Math.round((c.square_footage||0)*(c.price_per_sqft||0)*100)}))},async getPreviousDrawItems(r){if(!v)return console.warn("Supabase not configured"),{};const{data:l,error:i}=await _.from("draw_requests").select("id").eq("project_id",r).in("status",["submitted","approved","paid"]).order("draw_number",{ascending:!1}).limit(1).single();if(i&&i.code!=="PGRST116")return console.error("Error fetching latest draw:",i),{};if(!l)return{};const{data:c,error:d}=await _.from("draw_request_items").select("area_id, total_percent, total_amount").eq("draw_request_id",l.id);return d?(console.error("Error fetching previous draw items:",d),{}):(c||[]).reduce((f,p)=>(p.area_id&&(f[p.area_id]={previous_percent:p.total_percent||0,previous_amount:p.total_amount||0}),f),{})},calculatePercentFromAmount(r,l){return!l||l===0?0:Math.round(r/l*1e4)},calculateAmountFromPercent(r,l){return Math.round(r/1e4*l)}};tu(async r=>{if(r&&v)try{await lh(_e)}catch(l){console.error("Error syncing pending actions:",l)}});const A_=Object.freeze(Object.defineProperty({__proto__:null,auth:Wc,clearFieldSession:oh,db:_e,drawRequestOps:n_,equipmentOps:a_,getConnectionStatus:pa,getPendingActionCount:vi,isSupabaseConfigured:v,onConnectionChange:tu,supabase:_,syncPendingActions:lh},Symbol.toStringTag,{value:"Module"})),uh=w.createContext(),aa={logo_url:null,favicon_url:null,login_background_url:null,primary_color:"#3B82F6",secondary_color:"#1E40AF",custom_app_name:"FieldSync",hide_fieldsync_branding:!1,email_from_name:"FieldSync",email_from_address:null,custom_domain:null,domain_verified:!1};function ur({children:r,companyId:l}){const[i,c]=w.useState(aa),[d,f]=w.useState(!0);w.useEffect(()=>{l?p(l):y()},[l]),w.useEffect(()=>{k(i)},[i]);const p=async P=>{try{if(f(!0),!v){c(aa),f(!1);return}const{data:$,error:Z}=await _.from("company_branding").select("*").eq("company_id",P).single();Z?(Z.code==="PGRST116"?await S(P):console.error("Error loading branding:",Z),c(aa)):c({...aa,...$})}catch($){console.error("Error in loadBranding:",$),c(aa)}finally{f(!1)}},y=async()=>{try{f(!0);const P=window.location.hostname;if(P==="localhost"||P==="127.0.0.1"){c(aa),f(!1);return}if(!v){c(aa),f(!1);return}const{data:$,error:Z}=await _.rpc("get_branding_by_domain",{domain_name:P});Z||!$||$.length===0?c(aa):c({...aa,...$[0]})}catch(P){console.error("Error loading branding by domain:",P),c(aa)}finally{f(!1)}},S=async P=>{try{const{data:$,error:Z}=await _.from("company_branding").insert({company_id:P,...aa}).select().single();Z&&console.error("Error creating default branding:",Z)}catch($){console.error("Error in createDefaultBranding:",$)}},z=async P=>{try{if(!v)return c(se=>({...se,...P})),{success:!0};if(!l)return{success:!1,error:"No company ID"};const $={},Z=["logo_url","favicon_url","login_background_url","primary_color","secondary_color","custom_app_name","hide_fieldsync_branding","email_from_name","email_from_address","custom_domain","domain_verified"];for(const se of Z)P[se]!==void 0&&($[se]=P[se]);const{data:oe,error:ee}=await _.from("company_branding").select("id").eq("company_id",l).single();if(ee&&ee.code==="PGRST116"){const{data:se,error:Se}=await _.from("company_branding").insert({company_id:l,...$}).select().single();return Se?(console.error("Error creating branding:",Se),{success:!1,error:Se.message}):(c({...aa,...se}),{success:!0,data:se})}const{data:me,error:de}=await _.from("company_branding").update($).eq("company_id",l).select().single();return de?(console.error("Error updating branding:",de),{success:!1,error:de.message}):(c({...aa,...me}),{success:!0,data:me})}catch($){return console.error("Error in updateBranding:",$),{success:!1,error:$.message}}},k=P=>{const $=document.documentElement;if($.style.setProperty("--primary-color",P.primary_color),$.style.setProperty("--secondary-color",P.secondary_color),P.favicon_url){let Z=document.querySelector("link[rel*='icon']");Z||(Z=document.createElement("link"),Z.rel="icon",document.head.appendChild(Z)),Z.href=P.favicon_url}document.title=P.custom_app_name||"FieldSync"},F={branding:i,loading:d,updateBranding:z,uploadBrandingImage:async(P,$)=>{try{if(!v)return{success:!0,url:URL.createObjectURL(P)};const Z=P.name.split(".").pop(),ee=`branding/${`${l}/${$}-${Date.now()}.${Z}`}`,{data:me,error:de}=await _.storage.from("public").upload(ee,P,{cacheControl:"3600",upsert:!0});if(de)return console.error("Error uploading image:",de),{success:!1,error:de.message};const{data:{publicUrl:se}}=_.storage.from("public").getPublicUrl(ee);return{success:!0,url:se}}catch(Z){return console.error("Error in uploadBrandingImage:",Z),{success:!1,error:Z.message}}},refreshBranding:()=>l?p(l):y()};return s.jsx(uh.Provider,{value:F,children:r})}function r_(){const r=w.useContext(uh);if(!r)throw new Error("useBranding must be used within a BrandingProvider");return r}const dh=w.createContext();function dr({children:r}){const[l,i]=w.useState(()=>{const d=localStorage.getItem("fieldsync-theme");return d==="light"||d==="dark"?d:window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"});w.useEffect(()=>{document.documentElement.setAttribute("data-theme",l),localStorage.setItem("fieldsync-theme",l)},[l]),w.useEffect(()=>{const d=window.matchMedia("(prefers-color-scheme: light)"),f=p=>{localStorage.getItem("fieldsync-theme")||i(p.matches?"light":"dark")};return d.addEventListener("change",f),()=>d.removeEventListener("change",f)},[]);const c=()=>{i(d=>d==="dark"?"light":"dark")};return s.jsx(dh.Provider,{value:{theme:l,setTheme:i,toggleTheme:c},children:r})}function s_(){const r=w.useContext(dh);if(!r)throw new Error("useTheme must be used within a ThemeProvider");return r}function ga({className:r="",showPoweredBy:l=!1}){const{branding:i}=r_();return s.jsxs("div",{className:`app-logo ${r}`,children:[i.logo_url?s.jsx("img",{src:i.logo_url,alt:i.custom_app_name||"Logo",className:"custom-logo"}):s.jsxs("div",{className:"logo",children:[i.custom_app_name||"Field",s.jsx("span",{children:"Sync"})]}),l&&!i.hide_fieldsync_branding&&s.jsx("div",{className:"powered-by",children:"Powered by FieldSync"})]})}function l_({onForemanAccess:r,onOfficeLogin:l,onShowToast:i}){const[c,d]=w.useState(null),[f,p]=w.useState(""),[y,S]=w.useState(null),[z,k]=w.useState(""),[M,F]=w.useState(!1),[P,$]=w.useState(""),[Z,oe]=w.useState(""),[ee,me]=w.useState(""),[de,se]=w.useState(1),[Se,Me]=w.useState(null),[Ve,Te]=w.useState(""),[Ae,it]=w.useState(""),[Le,U]=w.useState(""),[re,ge]=w.useState(""),ve=K=>{const ce=K.toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0,20);p(ce)},D=async()=>{if(f.length<2){i("Enter company code","error");return}F(!0);try{const K=await _e.getCompanyByCode(f);K?S(K):(i("Invalid company code","error"),p(""))}catch{i("Error checking code","error")}finally{F(!1)}},Q=async K=>{if(K.length===4){F(!0),$("");try{const ce=await _e.getProjectByPinSecure(K,y.code);if(ce.rateLimited){$("error"),i("Too many attempts. Please wait 15 minutes.","error"),setTimeout(()=>{k(""),$("")},800);return}if(ce.success&&ce.project){r(ce.project);return}if(ce.error){console.warn("Secure PIN validation failed, trying fallback:",ce.error);const He=await _e.getProjectByPinAndCompany(K,y.id);if(He){r(He);return}}i("Invalid PIN","error"),k("")}catch(ce){console.error("PIN validation error:",ce);try{const He=await _e.getProjectByPinAndCompany(K,y.id);if(He){r(He);return}}catch(He){console.error("Fallback PIN validation also failed:",He)}i("Error checking PIN","error"),k("")}finally{F(!1)}}},W=K=>{if(z.length<4&&!M){const ce=z+K;k(ce),$(""),ce.length===4&&setTimeout(()=>Q(ce),150)}},be=()=>{M||(k(K=>K.slice(0,-1)),$(""))},Y=()=>{S(null),k(""),$("")},ye=()=>{if(!Z.trim()||!ee.trim()){i("Enter email and password","error");return}l(Z,ee)},J=async()=>{if(f.length<2){i("Enter company code","error");return}F(!0);try{const K=await _e.getCompanyByCode(f);K?(Me(K),se(2)):(i("Invalid company code","error"),p(""))}catch{i("Error checking code","error")}finally{F(!1)}},he=async()=>{if(!Ve.trim()){i("Enter office code","error");return}F(!0);try{const{data:K,error:ce}=await _.rpc("verify_office_code",{company_id:Se.id,code:Ve.trim()});if(ce)throw ce;K===!0?se(3):(i("Invalid office code","error"),Te(""))}catch{i("Error verifying code","error")}finally{F(!1)}},Ne=async()=>{if(!Ae.trim()){i("Enter your name","error");return}if(!Le.trim()||!Le.includes("@")){i("Enter valid email","error");return}if(re.length<6){i("Password must be 6+ characters","error");return}F(!0);try{const K=Le.toLowerCase().trim(),{data:ce,error:He}=await _.auth.signUp({email:K,password:re});let ae;if(He?.message?.includes("already registered")||ce?.user&&ce.user.identities?.length===0){const{data:Je,error:Re}=await _.auth.signInWithPassword({email:K,password:re});if(Re){i("Account exists with different password. Use your existing password.","error"),F(!1);return}ae=Je.user.id;const{data:nt}=await _.from("user_companies").select("id, status").eq("user_id",ae).eq("company_id",Se.id).maybeSingle();if(nt){nt.status==="active"?(i("You already belong to this company. Logging you in...","success"),setTimeout(()=>window.location.reload(),1e3)):nt.status==="pending"?(i("Your request is still pending approval.","error"),await _.auth.signOut()):(i("Your membership was removed. Contact the company admin.","error"),await _.auth.signOut());return}const{error:wt}=await _.from("user_companies").insert({user_id:ae,company_id:Se.id,role:"member",status:"pending"});if(wt)throw console.error("Error adding to user_companies:",wt),await _.auth.signOut(),new Error("Failed to submit join request");await _.auth.signOut(),i("Request to join submitted! Awaiting admin approval.","success")}else{if(He)throw He;{if(ae=ce.user?.id,!ae)throw new Error("Failed to create user");const{error:Je}=await _.from("users").insert({id:ae,email:K,password_hash:"managed_by_supabase_auth",name:Ae.trim(),company_id:Se.id,role:"member",is_active:!0});if(Je)throw Je;const{error:Re}=await _.from("user_companies").insert({user_id:ae,company_id:Se.id,role:"member",status:"pending"});if(Re)throw console.error("Error adding to user_companies:",Re),new Error("Failed to submit join request");await _.auth.signOut(),i("Account created! Awaiting admin approval.","success")}}}catch(K){console.error("Join error:",K),i(K.message||"Error creating account","error")}finally{F(!1)}};if(c===null)return s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx(ga,{className:"entry-logo",showPoweredBy:!1}),s.jsxs("div",{className:"entry-buttons",children:[s.jsxs("button",{className:"entry-mode-btn foreman",onClick:()=>d("foreman"),children:[s.jsx("span",{className:"entry-mode-icon",children:s.jsx(un,{size:32})}),s.jsx("span",{className:"entry-mode-title",children:"Foreman"}),s.jsx("span",{className:"entry-mode-desc",children:"Enter project PIN"})]}),s.jsxs("button",{className:"entry-mode-btn office",onClick:()=>d("office"),children:[s.jsx("span",{className:"entry-mode-icon",children:s.jsx(hg,{size:32})}),s.jsx("span",{className:"entry-mode-title",children:"Office"}),s.jsx("span",{className:"entry-mode-desc",children:"Sign in to dashboard"})]})]})]})});if(c==="foreman")return y?s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:Y,children:""}),s.jsx(ga,{className:"entry-logo",showPoweredBy:!1}),s.jsx("div",{className:"entry-company-badge",children:y.name}),s.jsx("p",{className:"entry-subtitle",children:"Enter project PIN"}),s.jsx("div",{className:`pin-display ${P==="error"?"shake":""}`,children:[0,1,2,3].map(K=>s.jsx("div",{className:`pin-dot ${z.length>K?"filled":""} ${P}`,children:z.length>K?"":""},K))}),s.jsxs("div",{className:"number-pad",children:[[1,2,3,4,5,6,7,8,9].map(K=>s.jsx("button",{className:"num-btn",onClick:()=>W(K.toString()),disabled:M,children:K},K)),s.jsx("button",{className:"num-btn empty",disabled:!0}),s.jsx("button",{className:"num-btn",onClick:()=>W("0"),disabled:M,children:"0"}),s.jsx("button",{className:"num-btn backspace",onClick:be,disabled:M||z.length===0,children:""})]}),M&&s.jsx("div",{className:"entry-loading",children:s.jsx("div",{className:"spinner"})})]})}):s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>d(null),children:""}),s.jsx(ga,{className:"entry-logo",showPoweredBy:!1}),s.jsx("p",{className:"entry-subtitle",children:"Enter company code"}),s.jsxs("div",{className:"entry-input-group",children:[s.jsx("input",{type:"text",value:f,onChange:K=>ve(K.target.value),placeholder:"Company Code",disabled:M,autoFocus:!0,onKeyDown:K=>{K.key==="Enter"&&D()}}),s.jsx("button",{className:"entry-submit-btn",onClick:D,disabled:M||f.length<2,children:M?"...":""})]})]})});if(c==="office")return s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>d(null),children:""}),s.jsx(ga,{className:"entry-logo",showPoweredBy:!1}),s.jsx("p",{className:"entry-subtitle",children:"Sign in to your account"}),s.jsxs("div",{className:"entry-form",children:[s.jsx("input",{type:"email",value:Z,onChange:K=>oe(K.target.value),placeholder:"Email",autoFocus:!0,onKeyDown:K=>{K.key==="Enter"&&ye()}}),s.jsx("input",{type:"password",value:ee,onChange:K=>me(K.target.value),placeholder:"Password",onKeyDown:K=>{K.key==="Enter"&&ye()}}),s.jsx("button",{className:"entry-login-btn",onClick:ye,children:"Sign In"})]}),s.jsxs("div",{className:"entry-signup-hint",children:[s.jsx("p",{children:"New employee?"}),s.jsx("button",{className:"entry-join-link",onClick:()=>d("join"),children:"Join your company"})]})]})});if(c==="join")return de===1?s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>d("office"),children:""}),s.jsx(ga,{className:"entry-logo",showPoweredBy:!1}),s.jsx("p",{className:"entry-subtitle",children:"Enter your company code"}),s.jsx("p",{className:"entry-hint",children:"Ask your manager or admin for the code"}),s.jsxs("div",{className:"entry-input-group",children:[s.jsx("input",{type:"text",value:f,onChange:K=>ve(K.target.value),placeholder:"Company Code",disabled:M,autoFocus:!0,onKeyDown:K=>{K.key==="Enter"&&J()}}),s.jsx("button",{className:"entry-submit-btn",onClick:J,disabled:M||f.length<2,children:M?"...":""})]})]})}):de===2?s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>{se(1),Me(null),Te("")},children:""}),s.jsx(ga,{className:"entry-logo",showPoweredBy:!1}),s.jsx("div",{className:"entry-company-badge",children:Se?.name}),s.jsx("p",{className:"entry-subtitle",children:"Enter office code"}),s.jsx("p",{className:"entry-hint",children:"This code is only for office staff"}),s.jsxs("div",{className:"entry-input-group",children:[s.jsx("input",{type:"password",value:Ve,onChange:K=>Te(K.target.value),placeholder:"Office Code",disabled:M,autoFocus:!0,onKeyDown:K=>{K.key==="Enter"&&he()}}),s.jsx("button",{className:"entry-submit-btn",onClick:he,disabled:M||!Ve.trim(),children:M?"...":""})]})]})}):s.jsx("div",{className:"entry-container",children:s.jsxs("div",{className:"entry-card",children:[s.jsx("button",{className:"entry-back",onClick:()=>{se(2),Te("")},children:""}),s.jsx(ga,{className:"entry-logo",showPoweredBy:!1}),s.jsx("div",{className:"entry-company-badge",children:Se?.name}),s.jsx("p",{className:"entry-subtitle",children:"Create your account"}),s.jsxs("div",{className:"entry-form",children:[s.jsx("input",{type:"text",value:Ae,onChange:K=>it(K.target.value),placeholder:"Your Name",autoFocus:!0}),s.jsx("input",{type:"email",value:Le,onChange:K=>U(K.target.value),placeholder:"Email"}),s.jsx("input",{type:"password",value:re,onChange:K=>ge(K.target.value),placeholder:"Password (6+ characters)",onKeyDown:K=>{K.key==="Enter"&&Ne()}}),s.jsx("button",{className:"entry-login-btn",onClick:Ne,disabled:M,children:M?"Creating...":"Join Company"})]}),s.jsx("p",{className:"entry-join-note",children:"You'll join as a team member. Your admin can update your role."})]})})}function fr({message:r,type:l="",onClose:i}){return w.useEffect(()=>{const c=setTimeout(i,3e3);return()=>clearTimeout(c)},[i]),s.jsx("div",{className:"toast-container",children:s.jsx("div",{className:`toast ${l}`,children:r})})}function $c({compact:r=!1}){const{theme:l,toggleTheme:i}=s_();return s.jsx("button",{className:`theme-toggle ${r?"theme-toggle-compact":""}`,onClick:i,title:`Switch to ${l==="dark"?"light":"dark"} mode`,"aria-label":`Switch to ${l==="dark"?"light":"dark"} mode`,children:l==="dark"?s.jsxs(s.Fragment,{children:[s.jsx(pg,{size:r?18:16}),!r&&s.jsx("span",{children:"Light"})]}):s.jsxs(s.Fragment,{children:[s.jsx(gg,{size:r?18:16}),!r&&s.jsx("span",{children:"Dark"})]})})}class Pr extends w.Component{constructor(l){super(l),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(l){return{hasError:!0}}componentDidCatch(l,i){this.setState({error:l,errorInfo:i}),console.error("ErrorBoundary caught an error:",l,i)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleReload=()=>{window.location.reload()};render(){return this.state.hasError?s.jsx("div",{className:"error-boundary",children:s.jsxs("div",{className:"error-boundary-content",children:[s.jsx("div",{className:"error-icon",children:s.jsx(Pc,{size:48})}),s.jsx("h2",{children:"Something went wrong"}),s.jsx("p",{children:"We're sorry, but something unexpected happened. Please try again."}),s.jsxs("div",{className:"error-actions",children:[s.jsx("button",{className:"btn btn-primary",onClick:this.handleRetry,children:"Try Again"}),s.jsx("button",{className:"btn btn-secondary",onClick:this.handleReload,children:"Reload Page"})]}),!1]})}):this.props.children}}function Im(){const[r,l]=w.useState(pa()),[i,c]=w.useState(0),[d,f]=w.useState(!1),[p,y]=w.useState(!1);return w.useEffect(()=>{const S=tu(async k=>{l(k),k&&p&&(f(!0),setTimeout(()=>f(!1),3e3)),k||y(!0);const M=await vi();c(M)});vi().then(c);const z=setInterval(async()=>{if(!pa()){const k=await vi();c(k)}},5e3);return()=>{S(),clearInterval(z)}},[p]),r&&i===0&&!d?null:s.jsxs("div",{className:`offline-indicator ${r?"online":"offline"} ${d?"synced":""}`,children:[s.jsx("div",{className:"offline-indicator-content",children:r?d?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"online-icon",children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})})}),s.jsx("span",{className:"offline-text",children:"Changes synced!"})]}):i>0?s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"syncing-icon",children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("polyline",{points:"23 4 23 10 17 10"}),s.jsx("polyline",{points:"1 20 1 14 7 14"}),s.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),s.jsxs("span",{className:"offline-text",children:["Syncing ",i,"..."]})]}):null:s.jsxs(s.Fragment,{children:[s.jsx("span",{className:"offline-icon",children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),s.jsx("path",{d:"M16.72 11.06A10.94 10.94 0 0 1 19 12.55"}),s.jsx("path",{d:"M5 12.55a10.94 10.94 0 0 1 5.17-2.39"}),s.jsx("path",{d:"M10.71 5.05A16 16 0 0 1 22.58 9"}),s.jsx("path",{d:"M1.42 9a15.91 15.91 0 0 1 4.7-2.88"}),s.jsx("path",{d:"M8.53 16.11a6 6 0 0 1 6.95 0"}),s.jsx("line",{x1:"12",y1:"20",x2:"12.01",y2:"20"})]})}),s.jsxs("span",{className:"offline-text",children:["Offline",i>0&&s.jsxs("span",{className:"pending-badge",children:[i," pending"]})]})]})}),s.jsx("style",{children:`
        .offline-indicator {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 9999;
          padding: 10px 16px;
          border-radius: 24px;
          font-size: 14px;
          font-weight: 500;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
          from {
            transform: translateX(-50%) translateY(20px);
            opacity: 0;
          }
          to {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
          }
        }

        .offline-indicator.offline {
          background: #1f2937;
          color: #fbbf24;
        }

        .offline-indicator.online {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator.synced {
          background: #065f46;
          color: #d1fae5;
        }

        .offline-indicator-content {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .offline-icon,
        .online-icon,
        .syncing-icon {
          display: flex;
          align-items: center;
        }

        .syncing-icon svg {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        .offline-text {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .pending-badge {
          background: rgba(251, 191, 36, 0.2);
          padding: 2px 8px;
          border-radius: 12px;
          font-size: 12px;
        }

        @media (max-width: 480px) {
          .offline-indicator {
            bottom: 70px; /* Above mobile nav */
            left: 16px;
            right: 16px;
            transform: none;
          }
        }
      `})]})}function O_(r){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(r)}function i_(r){if(!r||r.length===0)return 0;let l=0;return r.forEach(i=>{i.status==="done"&&(l+=i.weight||0)}),Math.round(l)}function k_(r){if(!r||r.length===0)return{progress:0,earnedValue:0,totalValue:0,isValueBased:!1};if(r.some(c=>c.scheduled_value>0)){const c=r.reduce((p,y)=>p+(y.scheduled_value||0),0),d=r.filter(p=>p.status==="done").reduce((p,y)=>p+(y.scheduled_value||0),0);return{progress:c>0?Math.round(d/c*100):0,earnedValue:d,totalValue:c,isValueBased:!0}}const i=r.filter(c=>c.status==="done").reduce((c,d)=>c+(d.weight||0),0);return{progress:Math.round(i),earnedValue:0,totalValue:0,isValueBased:!1}}function o_(r){if(!r||r.length===0)return"not_started";const l=r.some(d=>d.status==="working"),i=r.some(d=>d.status==="done");return r.every(d=>d.status==="done")?"done":l||i?"working":"not_started"}function z_(r){const l=o_(r);return l==="done"?"Complete":l==="working"?"In Progress":"Not Started"}function M_(r,l=0){const i=new Date;i.setHours(0,0,0,0);const c={scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1};if(r.start_date&&r.end_date){const d=new Date(r.start_date),f=new Date(r.end_date);d.setHours(0,0,0,0),f.setHours(0,0,0,0);const p=Math.max(1,Math.ceil((f-d)/(1e3*60*60*24))),y=Math.max(0,Math.ceil((i-d)/(1e3*60*60*24))),S=Math.min(100,y/p*100),k=(r.progress||0)-S;c.scheduleVariance=Math.round(k),c.hasScheduleData=!0,k>5?(c.scheduleStatus="ahead",c.scheduleLabel=`Ahead of Schedule (+${c.scheduleVariance}%)`):k<-5?(c.scheduleStatus="behind",c.scheduleLabel=`Behind Schedule (${c.scheduleVariance}%)`):(c.scheduleStatus="on_track",c.scheduleLabel="On Track")}if(r.planned_man_days&&r.planned_man_days>0){const f=(r.progress||0)/100*r.planned_man_days;if(f>0&&l>0){const p=(l-f)/f*100;c.laborVariance=Math.round(p),c.hasLaborData=!0,p>10?(c.laborStatus="over",c.laborLabel=`Over Planned (+${c.laborVariance}% man-days)`):p<-10?(c.laborStatus="under",c.laborLabel=`Under Planned (${c.laborVariance}% man-days)`):(c.laborStatus="on_track",c.laborLabel="Labor On Track")}else l>0&&(c.hasLaborData=!0,c.laborLabel=`${l} man-days used`)}return c}function R_(r,l=30){if(r.status==="archived"||r.progress<100)return!1;const i=r.areas||[];if(i.length===0||!i.every(p=>p.status==="done"))return!1;const d=i.reduce((p,y)=>{const S=new Date(y.updated_at);return S>p?S:p},new Date(0));return d.getTime()===0?!1:Math.floor((Date.now()-d.getTime())/(1e3*60*60*24))>=l}const U_=r=>{const l=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return l?[parseInt(l[1],16),parseInt(l[2],16),parseInt(l[3],16)]:[59,130,246]},H_=(r,l=5e3)=>new Promise(i=>{if(!r){i(null);return}const c=new Image;c.crossOrigin="anonymous";const d=setTimeout(()=>{c.src="",i(null)},l);c.onload=()=>{clearTimeout(d);try{const f=document.createElement("canvas");f.width=c.width,f.height=c.height,f.getContext("2d").drawImage(c,0,0),i(f.toDataURL("image/png"))}catch{i(null)}},c.onerror=()=>{clearTimeout(d),i(null)},c.src=r});async function eh(r,l=1920,i=.8){return!r.type.startsWith("image/")||r.size<500*1024?r:new Promise(c=>{const d=document.createElement("canvas"),f=d.getContext("2d"),p=new Image;p.onload=()=>{let{width:y,height:S}=p;y>l&&(S=Math.round(S*l/y),y=l);const z=1920;S>z&&(y=Math.round(y*z/S),S=z),d.width=y,d.height=S,f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.drawImage(p,0,0,y,S),d.toBlob(k=>{if(k){const M=r.name.replace(/\.[^/.]+$/,""),F=new File([k],`${M}.jpg`,{type:"image/jpeg",lastModified:Date.now()});c(F)}else console.warn("Image compression failed, using original"),c(r)},"image/jpeg",i),URL.revokeObjectURL(p.src)},p.onerror=()=>{console.warn("Failed to load image for compression, using original"),URL.revokeObjectURL(p.src),c(r)},p.src=URL.createObjectURL(r)})}const c_=w.lazy(()=>dn(()=>import("./SignatureLinkGenerator-BZ7lrPvF.js"),__vite__mapDeps([0,1,2,3,4]))),u_=w.lazy(()=>dn(()=>import("./TMClientSignature-DK3rvw9b.js"),__vite__mapDeps([5,1,2,3,4]))),th=()=>{const r=new Uint8Array(6);return crypto.getRandomValues(r),Array.from(r,l=>l.toString(36)).join("")},Gc=["Containment","PPE","Disposal","Equipment"],d_={en:{workInfo:"Work Details",crewHours:"Crew & Hours",materialsEquipment:"Materials",evidence:"Evidence",review:"Review",quickActions:"Quick Actions",sameAsYesterday:"Same as Yesterday",setCrewHours:"Set Crew Hours",loading:"Loading...",supervision:"Supervision",operators:"Operators",laborers:"Laborers",addSupervision:"+ Add Supervision",addOperator:"+ Add Operator",addLaborer:"+ Add Laborer",foreman:"Foreman",superintendent:"Superintendent",firstLastName:"First & Last Name",start:"Start",end:"End",regHrs:"Reg Hrs",otHrs:"OT Hrs",selectCategory:"Select a category:",addCustomItem:"+ Add Custom Item",customItem:"Custom Item",itemName:"Item Name",category:"Category",quantity:"Quantity",addItem:"Add Item",cancel:"Cancel",noItemsCategory:"No items in this category yet",workDate:"Work Date",ceNumber:"CE/PCO #",optional:"optional",linkedCOR:"Link to Change Order",selectCOR:"Select COR (optional)",noCORs:"No pending CORs",laborSummary:"Labor Summary",worker:"worker",workers_plural:"workers",totalHours:"Total Hours",regular:"Regular",overtime:"Overtime",materials:"Materials",item:"item",items_plural:"items",noMaterials:"No materials added",notes:"Notes",addNotes:"Add notes about the work performed...",photos:"Photos",addPhotos:"Add Photos",maxPhotos:"max",noPhotos:"No photos added",certification:"Certification",certifyStatement:"I certify that this T&M ticket accurately reflects the work performed.",foremanSignature:"Foreman's Name (Signature)",yourName:"Your name",describeWork:"Describe the work performed",descriptionRequired:"Description is required",whatWorkPerformed:"What work was performed today?",searchMaterials:"Search materials & equipment...",noSearchResults:"No items found",orBrowse:"Or browse by category:",back:"Back",next:"Next",nextCrew:"Next: Crew",nextMaterials:"Next: Materials",reviewItems:"Review",skipNoMaterials:"Skip (no materials)",submitTM:"Submit T&M",submitting:"Submitting...",applySameHours:"Apply Same Hours",batchDescription:"Set start/end time and hours for all workers with names entered.",timeStarted:"Time Started",timeEnded:"Time Ended",regularHours:"Regular Hours",overtimeHours:"Overtime Hours",willApplyTo:"Will apply to",applyToAll:"Apply to All",preset8hr:"8hr Day",preset10hr:"10hr Day",preset4hr:"4hr Day",loadedWorkers:"Loaded {count} workers from {date}",noPreviousCrew:"No previous crew found for this project",appliedHours:"Applied hours to {count} worker(s)",assignedToCOR:"Assigned to COR"},es:{workInfo:"Info del Trabajo",crewHours:"Cuadrilla y Horas",materialsEquipment:"Materiales",evidence:"Evidencia",review:"Revisar",quickActions:"Acciones Rapidas",sameAsYesterday:"Igual que Ayer",setCrewHours:"Poner Horas",loading:"Cargando...",supervision:"Supervision",operators:"Operadores",laborers:"Trabajadores",addSupervision:"+ Agregar Supervision",addOperator:"+ Agregar Operador",addLaborer:"+ Agregar Trabajador",foreman:"Capataz",superintendent:"Superintendente",firstLastName:"Nombre y Apellido",start:"Inicio",end:"Fin",regHrs:"Hrs Reg",otHrs:"Hrs Extra",selectCategory:"Seleccione una categoria:",addCustomItem:"+ Agregar Articulo",customItem:"Articulo Personalizado",itemName:"Nombre del Articulo",category:"Categoria",quantity:"Cantidad",addItem:"Agregar",cancel:"Cancelar",noItemsCategory:"No hay articulos en esta categoria",workDate:"Fecha de Trabajo",ceNumber:"CE/PCO #",optional:"opcional",linkedCOR:"Vincular a Orden de Cambio",selectCOR:"Seleccionar COR (opcional)",noCORs:"No hay CORs pendientes",laborSummary:"Resumen de Mano de Obra",worker:"trabajador",workers_plural:"trabajadores",totalHours:"Horas Totales",regular:"Regular",overtime:"Extra",materials:"Materiales",item:"articulo",items_plural:"articulos",noMaterials:"No se agregaron materiales",notes:"Notas",addNotes:"Agregar notas sobre el trabajo realizado...",photos:"Fotos",addPhotos:"Agregar Fotos",maxPhotos:"max",noPhotos:"No se agregaron fotos",certification:"Certificacion",certifyStatement:"Certifico que este ticket T&M refleja con precision el trabajo realizado.",foremanSignature:"Nombre del Capataz (Firma)",yourName:"Su nombre",describeWork:"Describir el trabajo realizado",descriptionRequired:"Descripcion es requerida",whatWorkPerformed:"Que trabajo se realizo hoy?",searchMaterials:"Buscar materiales y equipo...",noSearchResults:"No se encontraron articulos",orBrowse:"O navegar por categoria:",back:"Atras",next:"Siguiente",nextCrew:"Siguiente: Cuadrilla",nextMaterials:"Siguiente: Materiales",reviewItems:"Revisar",skipNoMaterials:"Saltar (sin materiales)",submitTM:"Enviar T&M",submitting:"Enviando...",applySameHours:"Aplicar Mismas Horas",batchDescription:"Establezca hora de inicio/fin y horas para todos los trabajadores.",timeStarted:"Hora de Inicio",timeEnded:"Hora de Fin",regularHours:"Horas Regulares",overtimeHours:"Horas Extra",willApplyTo:"Se aplicara a",applyToAll:"Aplicar a Todos",preset8hr:"Dia 8hr",preset10hr:"Dia 10hr",preset4hr:"Dia 4hr",loadedWorkers:"Se cargaron {count} trabajadores del {date}",noPreviousCrew:"No se encontro equipo anterior para este proyecto",appliedHours:"Horas aplicadas a {count} trabajador(es)",assignedToCOR:"Asignado a COR"}};function f_({project:r,companyId:l,maxPhotos:i=10,onSubmit:c,onCancel:d,onShowToast:f}){const[p,y]=w.useState(1),[S,z]=w.useState(new Date().toISOString().split("T")[0]),[k,M]=w.useState(null),[F,P]=w.useState(!1),[$,Z]=w.useState(!1),[oe,ee]=w.useState(!1),[me,de]=w.useState(""),[se,Se]=w.useState(""),[Me,Ve]=w.useState(""),[Te,Ae]=w.useState([]),[it,Le]=w.useState(!1),[U,re]=w.useState(!1),[ge,ve]=w.useState({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),[D,Q]=w.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}]),[W,be]=w.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[Y,ye]=w.useState([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]),[J,he]=w.useState([]),[Ne,K]=w.useState(""),[ce,He]=w.useState([]),[ae,we]=w.useState(!1),[Je,Re]=w.useState(""),[nt,wt]=w.useState([]),[Xe,na]=w.useState(!1),[ot,Nt]=w.useState(null),[pr,mn]=w.useState([]),[Qn,Ra]=w.useState(!1),[hn,pn]=w.useState(""),[vt,Ua]=w.useState([]),[Xn,Vn]=w.useState([]),[ra,Ha]=w.useState(!1),[bt,La]=w.useState({name:"",category:"",quantity:""}),Zn=w.useRef(null),[_a,Et]=w.useState(!1),[te,Dt]=w.useState("en"),G=h=>d_[te][h]||h,[Ir,gr]=w.useState([]),[ya,gn]=w.useState([]),[dt,ft]=w.useState({}),[Na,Ea]=w.useState(!0),mt=ya.length>0,V=(h,x)=>{if(!h||!x)return null;const[T,q]=h.split(":").map(Number),[R,X]=x.split(":").map(Number);let ue=R*60+X-(T*60+q);ue<0&&(ue+=1440);const le=ue/60,Fe=Math.min(le,8),Ue=Math.max(0,le-8);return{hours:Fe.toFixed(1),overtimeHours:Ue>0?Ue.toFixed(1):""}},Rt=h=>{if(!h)return"empty";const x=h.name&&h.name.trim()!=="",T=parseFloat(h.hours)>0||parseFloat(h.overtimeHours)>0;return x?T?"complete":"incomplete":"empty"},va=h=>{let x,T,q,R;switch(h){case"full":x="07:00",T="15:30",q="8",R="";break;case"10hr":x="06:00",T="16:30",q="8",R="2";break;case"half":x="07:00",T="11:00",q="4",R="";break;default:return}ve({timeStarted:x,timeEnded:T,hours:q,overtimeHours:R})};w.useEffect(()=>{el(),Ps()},[r.id]),w.useEffect(()=>{(async()=>{if(!l){Ea(!1);return}try{const x=await _e.getLaborClassesForField(l);if(gr(x.categories||[]),gn(x.classes||[]),x.classes&&x.classes.length>0){const T={};x.classes.forEach(q=>{T[q.id]=[{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]}),ft(T)}}catch(x){console.error("Error loading labor classes:",x)}finally{Ea(!1)}})()},[l]);const Ps=async()=>{Le(!0);try{const h=await _e.getAssignableCORs(r.id);Ae(h||[])}catch(h){console.error("Error loading assignable CORs:",h)}finally{Le(!1)}},Is=()=>{const{timeStarted:h,timeEnded:x,hours:T,overtimeHours:q}=ge;let R=0;if(mt){const X={};Object.entries(dt).forEach(([ue,le])=>{X[ue]=le.map(Fe=>Fe&&Fe.name&&Fe.name.trim()?(R++,{...Fe,timeStarted:h,timeEnded:x,hours:T,overtimeHours:q}):Fe)}),ft(X)}else Q(D.map(X=>X&&X.name&&X.name.trim()?(R++,{...X,timeStarted:h,timeEnded:x,hours:T,overtimeHours:q}):X)),be(W.map(X=>X&&X.name&&X.name.trim()?(R++,{...X,timeStarted:h,timeEnded:x,hours:T,overtimeHours:q}):X)),ye(Y.map(X=>X&&X.name&&X.name.trim()?(R++,{...X,timeStarted:h,timeEnded:x,hours:T,overtimeHours:q}):X));re(!1),ve({timeStarted:"",timeEnded:"",hours:"",overtimeHours:""}),R>0?f(G("appliedHours").replace("{count}",R),"success"):f(te==="en"?"Add workers first":"Agregue trabajadores primero","info")},_r=h=>{let x,T,q,R;switch(h){case"8hr":x="07:00",T="15:30",q="8",R="";break;case"10hr":x="06:00",T="16:30",q="8",R="2";break;case"4hr":x="07:00",T="11:00",q="4",R="";break;default:return}let X=0;if(mt){const ue={};Object.entries(dt).forEach(([le,Fe])=>{ue[le]=Fe.map(Ue=>Ue&&Ue.name&&Ue.name.trim()?(X++,{...Ue,timeStarted:x,timeEnded:T,hours:q,overtimeHours:R}):Ue)}),ft(ue)}else Q(ue=>ue.map(le=>le&&le.name&&le.name.trim()?(X++,{...le,timeStarted:x,timeEnded:T,hours:q,overtimeHours:R}):le)),be(ue=>ue.map(le=>le&&le.name&&le.name.trim()?(X++,{...le,timeStarted:x,timeEnded:T,hours:q,overtimeHours:R}):le)),ye(ue=>ue.map(le=>le&&le.name&&le.name.trim()?(X++,{...le,timeStarted:x,timeEnded:T,hours:q,overtimeHours:R}):le));X>0?f(G("appliedHours").replace("{count}",X),"success"):f(te==="en"?"Add workers first":"Agregue trabajadores primero","info")},el=async()=>{try{const h=await _e.getCrewCheckin(r.id);h?.workers&&wt(h.workers)}catch(h){console.error("Error loading crew:",h)}};w.useEffect(()=>{ot&&l&&es(ot)},[ot,l]),w.useEffect(()=>{p===3&&Zn.current&&!ot&&setTimeout(()=>{Zn.current?.focus()},100)},[p,ot]);const es=async h=>{Ra(!0);try{const x=await _e.getMaterialsEquipmentByCategory(l,h);mn(x)}catch(x){console.error("Error loading items:",x),f("Error loading items","error")}finally{Ra(!1)}},ts=async()=>{if(!(Xn.length>0))try{const h=[];for(const x of Gc){const T=await _e.getMaterialsEquipmentByCategory(l,x);h.push(...T.map(q=>({...q,category:x})))}Vn(h)}catch(h){console.error("Error loading all materials:",h)}},tl=h=>{if(pn(h),!h.trim()){Ua([]);return}const x=h.toLowerCase(),T=Xn.filter(q=>q.name.toLowerCase().includes(x)||q.category.toLowerCase().includes(x));Ua(T.slice(0,10))},al=async()=>{Et(!0);try{const h=await _e.getPreviousTicketCrew(r.id,S);if(!h||h.totalWorkers===0){f(G("noPreviousCrew"),"info");return}mt&&h.dynamicWorkers?ft(h.dynamicWorkers):(h.supervision&&Q(h.supervision),h.operators&&be(h.operators),h.laborers&&ye(h.laborers));const x=new Date(h.workDate).toLocaleDateString();f(G("loadedWorkers").replace("{count}",h.totalWorkers).replace("{date}",x),"success")}catch(h){console.error("Error loading previous crew:",h),f(te==="en"?"Error loading previous crew":"Error cargando equipo anterior","error")}finally{Et(!1)}},Ca=()=>{Q([...D,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},et=(h,x,T)=>{Q(D.map((q,R)=>{if(R!==h)return q;const X={...q,[x]:T};if(x==="timeStarted"||x==="timeEnded"){const ue=x==="timeStarted"?T:q.timeStarted,le=x==="timeEnded"?T:q.timeEnded,Fe=V(ue,le);Fe&&(X.hours=Fe.hours,X.overtimeHours=Fe.overtimeHours)}return X}))},Mt=h=>{D.length>1?Q(D.filter((x,T)=>T!==h)):Q([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:"Foreman"}])},_n=()=>{ye([...Y,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},qa=(h,x,T)=>{ye(Y.map((q,R)=>{if(R!==h)return q;const X={...q,[x]:T};if(x==="timeStarted"||x==="timeEnded"){const ue=x==="timeStarted"?T:q.timeStarted,le=x==="timeEnded"?T:q.timeEnded,Fe=V(ue,le);Fe&&(X.hours=Fe.hours,X.overtimeHours=Fe.overtimeHours)}return X}))},xi=h=>{Y.length>1?ye(Y.filter((x,T)=>T!==h)):ye([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},wi=()=>{be([...W,{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},Ba=(h,x,T)=>{be(W.map((q,R)=>{if(R!==h)return q;const X={...q,[x]:T};if(x==="timeStarted"||x==="timeEnded"){const ue=x==="timeStarted"?T:q.timeStarted,le=x==="timeEnded"?T:q.timeEnded,Fe=V(ue,le);Fe&&(X.hours=Fe.hours,X.overtimeHours=Fe.overtimeHours)}return X}))},Kn=h=>{W.length>1?be(W.filter((x,T)=>T!==h)):be([{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])},yr=h=>{ft(x=>({...x,[h]:[...x[h]||[],{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]}))},Tt=(h,x,T,q)=>{ft(R=>({...R,[h]:(R[h]||[]).map((X,ue)=>{if(ue!==x)return X;const le={...X,[T]:q};if(T==="timeStarted"||T==="timeEnded"){const Fe=T==="timeStarted"?q:X.timeStarted,Ue=T==="timeEnded"?q:X.timeEnded,St=V(Fe,Ue);St&&(le.hours=St.hours,le.overtimeHours=St.overtimeHours)}return le})}))},Ya=(h,x)=>{ft(T=>{const q=T[h]||[];return q.length>1?{...T,[h]:q.filter((R,X)=>X!==x)}:{...T,[h]:[{name:"",hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]}})},Ga=()=>{if(!dt||typeof dt!="object")return[];const h=[];return Object.entries(dt).forEach(([x,T])=>{if(!Array.isArray(T))return;const q=ya.find(R=>R.id===x);T.forEach(R=>{R&&R.name&&R.name.trim()&&(parseFloat(R.hours)>0||parseFloat(R.overtimeHours)>0)&&h.push({name:R.name.trim(),hours:parseFloat(R.hours)||0,overtime_hours:parseFloat(R.overtimeHours)||0,time_started:R.timeStarted||null,time_ended:R.timeEnded||null,role:q?.name||"Worker",labor_class_id:x})})}),h},yn=h=>{const x=J.findIndex(T=>T.material_equipment_id===h.id);x>=0?he(J.map((T,q)=>q===x?{...T,quantity:T.quantity+1}:T)):he([...J,{material_equipment_id:h.id,name:h.name,unit:h.unit,category:h.category,quantity:1,isCustom:!1}]),f(`Added ${h.name}`,"success")},ht=()=>{if(!bt.name||!bt.category||!bt.quantity){f("Fill in all fields","error");return}he([...J,{material_equipment_id:null,custom_name:bt.name,custom_category:bt.category,name:bt.name,category:bt.category,quantity:parseFloat(bt.quantity),unit:"each",isCustom:!0}]),La({name:"",category:"",quantity:""}),Ha(!1),Nt(null),f("Custom item added","success")},vr=(h,x)=>{const T=parseFloat(x)||0;T<=0?nl(h):he(J.map((q,R)=>R===h?{...q,quantity:T}:q))},nl=h=>{he(J.filter((x,T)=>T!==h))},Qa=h=>{const x=Array.from(h.target.files);if(x.length===0)return;const T=i===-1?1/0:i-ce.length;if(T<=0){f(`Photo limit reached (${i} max)`,"error"),h.target.value="";return}const q=x.slice(0,T);q.length<x.length&&f(`Only ${q.length} photo(s) added (${i} max)`,"error");const R=10*1024*1024;q.forEach(X=>{if(!X.type.startsWith("image/")){f("Please select an image file","error");return}if(X.size>R){f(`Photo too large: ${X.name} (max 10MB)`,"error");return}const ue=URL.createObjectURL(X),le=`photo-${Date.now()}-${th()}`;He(Fe=>[...Fe,{id:`${Date.now()}-${th()}`,tempId:le,file:X,previewUrl:ue,name:X.name,status:"pending",attempts:0,error:null,uploadedUrl:null}])}),h.target.value=""},Ut=(h,x)=>{He(T=>T.map(q=>q.id===h?{...q,...x}:q))},rl=async(h,x)=>{const T=ce.find(q=>q.id===h);if(!(!T||T.status!=="failed")){Ut(h,{status:"compressing",error:null});try{let q=T.file;try{q=await eh(T.file)}catch(X){console.warn("Compression failed, using original:",X)}Ut(h,{status:"uploading"});const R=await _e.uploadPhoto(l,r.id,x,q);Ut(h,{status:"confirmed",uploadedUrl:R,attempts:T.attempts+1}),await _e.updateTMTicketPhotos(x,[...ce.filter(X=>X.uploadedUrl).map(X=>X.uploadedUrl),R]),f("Photo uploaded successfully","success")}catch(q){console.error("Retry failed:",q),Ut(h,{status:"failed",error:q.message||"Upload failed",attempts:T.attempts+1}),f("Photo retry failed","error")}}},sl=h=>{const x=ce.find(T=>T.id===h);x?.previewUrl&&URL.revokeObjectURL(x.previewUrl),He(ce.filter(T=>T.id!==h))},as=()=>{if(p===1)return Ne.trim().length>0;if(p===2){if(mt)return Ga().length>0;{const h=D.some(q=>q&&q.name&&q.name.trim()&&(parseFloat(q.hours)>0||parseFloat(q.overtimeHours)>0)),x=W.some(q=>q&&q.name&&q.name.trim()&&(parseFloat(q.hours)>0||parseFloat(q.overtimeHours)>0)),T=Y.some(q=>q&&q.name&&q.name.trim()&&(parseFloat(q.hours)>0||parseFloat(q.overtimeHours)>0));return h||x||T}}return!0},vn=D.filter(h=>h&&h.name&&h.name.trim()&&(parseFloat(h.hours)>0||parseFloat(h.overtimeHours)>0)),ba=W.filter(h=>h&&h.name&&h.name.trim()&&(parseFloat(h.hours)>0||parseFloat(h.overtimeHours)>0)),ja=Y.filter(h=>h&&h.name&&h.name.trim()&&(parseFloat(h.hours)>0||parseFloat(h.overtimeHours)>0)),Ht=Ga(),jt=mt?Ht.length:vn.length+ba.length+ja.length,Xa=mt?Ht.reduce((h,x)=>h+(x.hours||0),0):[...vn,...ba,...ja].reduce((h,x)=>h+parseFloat(x.hours||0),0),Da=mt?Ht.reduce((h,x)=>h+(x.overtime_hours||0),0):[...vn,...ba,...ja].reduce((h,x)=>h+parseFloat(x.overtimeHours||0),0);J.reduce((h,x)=>h+x.quantity,0);const Va=mt?Object.values(dt||{}).flat().filter(h=>h&&h.name&&h.name.trim()):[...D.filter(h=>h&&h.name&&h.name.trim()),...W.filter(h=>h&&h.name&&h.name.trim()),...Y.filter(h=>h&&h.name&&h.name.trim())],ll=jt,sa=Va.length-ll,Lt=(()=>{const h=[];return p===1&&(Ne.trim()||h.push(te==="en"?"Description recommended":"Descripcin recomendada")),p===2&&sa>0&&h.push(te==="en"?`${sa} worker(s) have no hours entered`:`${sa} trabajador(es) sin horas`),p===5&&(se.trim()||h.push(te==="en"?"Name required to submit":"Nombre requerido")),h})(),Ta=()=>{p<5&&y(p+1)},ns=()=>{ot?(Nt(null),Ha(!1)):ra?Ha(!1):p>1?y(p-1):d()},rs=async()=>{if(!se.trim()){f("Enter your name to submit","error");return}let h=[];if(mt){if(h=Ga(),h.length===0){f("Add at least one worker","error");return}}else{const x=D.filter(R=>R&&R.name&&R.name.trim()&&(parseFloat(R.hours)>0||parseFloat(R.overtimeHours)>0)),T=W.filter(R=>R&&R.name&&R.name.trim()&&(parseFloat(R.hours)>0||parseFloat(R.overtimeHours)>0)),q=Y.filter(R=>R&&R.name&&R.name.trim()&&(parseFloat(R.hours)>0||parseFloat(R.overtimeHours)>0));if(x.length===0&&T.length===0&&q.length===0){f("Add at least one worker","error");return}h=[...x.map(R=>({name:R.name.trim(),hours:parseFloat(R.hours)||0,overtime_hours:parseFloat(R.overtimeHours)||0,time_started:R.timeStarted||null,time_ended:R.timeEnded||null,role:R.role})),...T.map(R=>({name:R.name.trim(),hours:parseFloat(R.hours)||0,overtime_hours:parseFloat(R.overtimeHours)||0,time_started:R.timeStarted||null,time_ended:R.timeEnded||null,role:"Operator"})),...q.map(R=>({name:R.name.trim(),hours:parseFloat(R.hours)||0,overtime_hours:parseFloat(R.overtimeHours)||0,time_started:R.timeStarted||null,time_ended:R.timeEnded||null,role:"Laborer"}))]}we(!0),Re("Creating ticket...");try{const x=await _e.createTMTicket({project_id:r.id,work_date:S,ce_pco_number:me.trim()||null,assigned_cor_id:Me||null,notes:Ne.trim()||null,photos:[],created_by_name:se.trim()});let T=[];const q=ce.filter(R=>R.status==="pending");if(q.length>0){Re(`Compressing ${q.length} photo${q.length>1?"s":""}...`),q.forEach(Ue=>Ut(Ue.id,{status:"compressing"}));const R=await Promise.all(q.map(async Ue=>{try{const St=await eh(Ue.file);return{...Ue,file:St}}catch(St){return console.warn(`Failed to compress photo ${Ue.name}, using original:`,St),Ue}}));Re(`Uploading ${q.length} photo${q.length>1?"s":""}...`),q.forEach(Ue=>Ut(Ue.id,{status:"uploading"}));let X=0,ue=0;const le=R.map(async Ue=>{try{const St=await _e.uploadPhoto(l,r.id,x.id,Ue.file);return X++,Re(`Uploading ${X}/${q.length} photos...`),Ut(Ue.id,{status:"confirmed",uploadedUrl:St,attempts:(Ue.attempts||0)+1}),{id:Ue.id,url:St}}catch(St){return console.error(`Photo ${Ue.name} upload failed:`,St),ue++,Ut(Ue.id,{status:"failed",error:St.message||"Upload failed",attempts:(Ue.attempts||0)+1}),{id:Ue.id,url:null,error:St.message}}});T=(await Promise.all(le)).filter(Ue=>Ue.url!==null).map(Ue=>Ue.url),ue>0&&T.length>0?f(`${T.length}/${q.length} photos uploaded. ${ue} failed - can retry later.`,"warning"):ue>0&&T.length===0&&f(`All ${ue} photos failed to upload - can retry after submission.`,"error")}if(T.length>0&&(Re("Saving photos..."),await _e.updateTMTicketPhotos(x.id,T)),Re("Saving workers..."),await _e.addTMWorkers(x.id,h),J.length>0&&(Re("Saving materials..."),await _e.addTMItems(x.id,J.map(R=>({material_equipment_id:R.material_equipment_id,custom_name:R.custom_name||null,custom_category:R.custom_category||null,quantity:R.quantity})))),Me){Re("Importing to COR...");try{await _e.importTicketDataToCOR(x.id,Me,l,r.work_type||"demolition",r.job_type||"standard")}catch(R){console.error("Error importing to COR:",R);try{await _e.markImportFailed(x.id,Me,R?.message||"Import failed")}catch(X){console.error("Error marking import failed:",X)}f("T&M saved. COR data sync failed - retry from ticket list.","warning")}}ce.forEach(R=>{R.previewUrl&&URL.revokeObjectURL(R.previewUrl)}),M(x),f("T&M submitted!","success"),y(6)}catch(x){console.error("Error submitting T&M:",x),f("Error submitting T&M","error")}finally{we(!1),Re("")}};return p===3&&(ot||ra)?s.jsxs("div",{className:"tm-wizard",children:[s.jsxs("div",{className:"tm-wizard-header",children:[s.jsx("button",{className:"tm-back-btn",onClick:ns,children:""}),s.jsx("h2",{children:ra?"Add Custom Item":ot}),s.jsxs("div",{className:"tm-item-count",children:[J.length," items"]})]}),ra?s.jsxs("div",{className:"tm-custom-form",children:[s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:"Item Name"}),s.jsx("input",{type:"text",placeholder:"What did you use?",value:bt.name,onChange:h=>La({...bt,name:h.target.value}),autoFocus:!0})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:"Category"}),s.jsx("div",{className:"tm-category-select",children:Gc.map(h=>s.jsx("button",{className:`tm-cat-chip ${bt.category===h?"active":""}`,onClick:()=>La({...bt,category:h}),children:h},h))})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:"Quantity"}),s.jsx("input",{type:"number",placeholder:"How many?",value:bt.quantity,onChange:h=>La({...bt,quantity:h.target.value})})]}),s.jsx("button",{className:"tm-big-btn primary",onClick:ht,children:"Add Custom Item"})]}):s.jsx("div",{className:"tm-item-grid",children:Qn?s.jsx("div",{className:"tm-loading",children:"Loading..."}):s.jsxs(s.Fragment,{children:[pr.map(h=>{const x=J.find(T=>T.material_equipment_id===h.id);return s.jsxs("button",{className:`tm-item-card ${x?"added":""}`,onClick:()=>yn(h),children:[s.jsx("span",{className:"tm-item-name",children:h.name}),s.jsx("span",{className:"tm-item-unit",children:h.unit}),x&&s.jsx("span",{className:"tm-item-badge",children:x.quantity})]},h.id)}),s.jsxs("button",{className:"tm-item-card custom",onClick:()=>Ha(!0),children:[s.jsx("span",{className:"tm-item-name",children:"+ Add Other"}),s.jsx("span",{className:"tm-item-unit",children:"Not on list"})]})]})}),!ra&&J.length>0&&s.jsx("div",{className:"tm-wizard-footer",children:s.jsxs("button",{className:"tm-big-btn primary",onClick:()=>Nt(null),children:["Done Adding (",J.length," items)"]})})]}):s.jsxs("div",{className:"tm-wizard",children:[s.jsxs("div",{className:"tm-wizard-header",children:[p<5?s.jsx("button",{className:"tm-back-btn",onClick:ns,children:""}):s.jsx("div",{className:"tm-success-check",children:s.jsx(Dc,{size:24})}),s.jsxs("h2",{children:[p===1&&G("workInfo"),p===2&&G("crewHours"),p===3&&G("materialsEquipment"),p===4&&G("evidence"),p===5&&G("review"),p===6&&(te==="en"?"Submitted":"Enviado")]}),s.jsxs("div",{className:"tm-header-right",children:[p<5&&s.jsxs("button",{className:"tm-lang-toggle",onClick:()=>Dt(te==="en"?"es":"en"),title:te==="en"?"Cambiar a Espaol":"Switch to English",children:[s.jsx(_g,{size:16}),te==="en"?"ES":"EN"]}),p<6&&s.jsxs("div",{className:"tm-step-dots",children:[s.jsx("span",{className:`tm-dot ${p>=1?"active":""}`}),s.jsx("span",{className:`tm-dot ${p>=2?"active":""}`}),s.jsx("span",{className:`tm-dot ${p>=3?"active":""}`}),s.jsx("span",{className:`tm-dot ${p>=4?"active":""}`}),s.jsx("span",{className:`tm-dot ${p>=5?"active":""}`})]})]})]}),p===1&&s.jsxs("div",{className:"tm-step-content",children:[s.jsxs("div",{className:"tm-project-info",children:[r.job_number&&s.jsxs("div",{className:"tm-project-detail",children:[s.jsx("span",{className:"tm-project-label",children:"Job #"}),s.jsx("span",{className:"tm-project-value",children:r.job_number})]}),s.jsxs("div",{className:"tm-project-detail",children:[s.jsx("span",{className:"tm-project-label",children:"Project"}),s.jsx("span",{className:"tm-project-value",children:r.name})]}),r.address&&s.jsxs("div",{className:"tm-project-detail",children:[s.jsx("span",{className:"tm-project-label",children:"Address"}),s.jsx("span",{className:"tm-project-value",children:r.address})]}),r.general_contractor&&s.jsxs("div",{className:"tm-project-detail",children:[s.jsx("span",{className:"tm-project-label",children:"GC"}),s.jsx("span",{className:"tm-project-value",children:r.general_contractor})]})]}),s.jsxs("div",{className:"tm-field-row",children:[s.jsxs("div",{className:"tm-field tm-field-half",children:[s.jsx("label",{children:"Date"}),s.jsx("input",{type:"date",value:S,onChange:h=>z(h.target.value),className:"tm-date"})]}),s.jsxs("div",{className:"tm-field tm-field-half",children:[s.jsx("label",{children:"CE / PCO #"}),s.jsx("input",{type:"text",placeholder:"Change Event / PCO",value:me,onChange:h=>de(h.target.value),className:"tm-input"})]})]}),s.jsxs("div",{className:"tm-field tm-description-field",children:[s.jsxs("label",{children:[s.jsx(ji,{size:16,className:"inline-icon"}),G("describeWork")," ",s.jsx("span",{className:"tm-required",children:"*"})]}),s.jsx("textarea",{placeholder:G("whatWorkPerformed"),value:Ne,onChange:h=>K(h.target.value),rows:4,className:`tm-description ${Ne.trim()?"":"tm-field-required"}`})]})]}),p===2&&s.jsxs("div",{className:"tm-step-content",children:[s.jsxs("div",{className:"tm-crew-summary-pill",children:[s.jsxs("span",{className:"pill-stat",children:[Va.length," ",Va.length===1?G("worker"):G("workers_plural")]}),s.jsxs("span",{className:"pill-stat",children:[Xa+Da,"h ","total"]}),sa>0&&s.jsxs("span",{className:"pill-warning",children:[s.jsx(pi,{size:14}),sa," ",te==="en"?"need hours":"sin horas"]})]}),nt.length>0&&s.jsxs("div",{className:"tm-crew-picker",children:[s.jsxs("button",{className:"tm-crew-picker-btn",onClick:()=>na(!Xe),children:[s.jsx(un,{size:16})," ",Xe?"Hide":"Select from"," Today's Crew (",nt.length,")"]}),Xe&&s.jsx("div",{className:"tm-crew-list",children:nt.map((h,x)=>{const T=D.some(X=>X.name.toLowerCase()===h.name.toLowerCase())||W.some(X=>X.name.toLowerCase()===h.name.toLowerCase())||Y.some(X=>X.name.toLowerCase()===h.name.toLowerCase()),q=Object.values(dt).some(X=>X.some(ue=>ue.name.toLowerCase()===h.name.toLowerCase())),R=T||q;return s.jsxs("button",{className:`tm-crew-item ${R?"added":""}`,onClick:()=>{if(!R){if(h.labor_class_id&&mt&&dt[h.labor_class_id]){const X=dt[h.labor_class_id]||[],ue=X.findIndex(le=>!le||!le.name||!le.name.trim());if(ue>=0){const le=[...X];le[ue]={...le[ue],name:h.name},ft({...dt,[h.labor_class_id]:le})}else ft({...dt,[h.labor_class_id]:[...X,{name:h.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}]})}else{const X=(h.role||"").toLowerCase();if(X.includes("foreman")||X.includes("supervisor")||X.includes("superintendent")){const ue=D.findIndex(le=>!le||!le.name||!le.name.trim());ue>=0?(et(ue,"name",h.name),et(ue,"role",X.includes("superintendent")?"Superintendent":"Foreman")):Q([...D,{name:h.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:"",role:X.includes("superintendent")?"Superintendent":"Foreman"}])}else if(X.includes("operator")){const ue=W.findIndex(le=>!le||!le.name||!le.name.trim());ue>=0?Ba(ue,"name",h.name):be([...W,{name:h.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}else{const ue=Y.findIndex(le=>!le||!le.name||!le.name.trim());ue>=0?qa(ue,"name",h.name):ye([...Y,{name:h.name,hours:"",overtimeHours:"",timeStarted:"",timeEnded:""}])}}f(`Added ${h.name}`,"success")}},disabled:R,children:[s.jsx("span",{className:"tm-crew-item-name",children:h.name}),s.jsx("span",{className:`tm-crew-item-role ${(h.role||"laborer").toLowerCase()}`,children:h.role||"Laborer"}),R&&s.jsx("span",{className:"tm-crew-item-check",children:""})]},x)})})]}),s.jsxs("div",{className:"tm-quick-actions-panel",children:[s.jsxs("div",{className:"tm-batch-hours-header",children:[s.jsx(Xc,{size:18}),s.jsx("span",{children:G("quickActions")})]}),s.jsxs("div",{className:"tm-quick-actions-buttons",children:[s.jsxs("button",{type:"button",className:"tm-quick-action-btn primary",onClick:al,disabled:_a,children:[s.jsx(yg,{size:16}),G(_a?"loading":"sameAsYesterday")]}),s.jsxs("button",{type:"button",className:"tm-quick-action-btn",onClick:()=>re(!0),children:[s.jsx(Tc,{size:16}),G("setCrewHours")]})]})]}),s.jsxs("div",{className:"tm-inline-presets",children:[s.jsx("span",{className:"tm-inline-presets-label",children:te==="en"?"Apply to all:":"Aplicar a todos:"}),s.jsxs("div",{className:"tm-inline-presets-buttons",children:[s.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>_r("8hr"),children:G("preset8hr")}),s.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>_r("10hr"),children:G("preset10hr")}),s.jsx("button",{type:"button",className:"tm-preset-chip",onClick:()=>_r("4hr"),children:G("preset4hr")})]})]}),s.jsxs("div",{className:`tm-running-total ${jt>0?"has-data":""}`,children:[s.jsxs("div",{className:"tm-running-total-workers",children:[s.jsx(un,{size:18}),s.jsx("span",{className:"tm-running-total-count",children:Va.length}),s.jsx("span",{className:"tm-running-total-label",children:Va.length===1?G("worker"):G("workers_plural")}),sa>0&&s.jsxs("span",{className:"tm-running-total-warning",children:["(",sa," ",te==="en"?"need hours":"sin horas",")"]})]}),s.jsxs("div",{className:"tm-running-total-hours",children:[s.jsx(Tc,{size:18}),s.jsx("span",{className:"tm-running-total-count",children:Xa+Da}),s.jsx("span",{className:"tm-running-total-label",children:te==="en"?"total hrs":"hrs total"}),Da>0&&s.jsxs("span",{className:"tm-running-total-ot",children:["(",Da," OT)"]})]})]}),mt&&!Na&&s.jsxs(s.Fragment,{children:[Ir.map(h=>{const x=ya.filter(T=>T.category_id===h.id);return x.length===0?null:s.jsxs("div",{className:"tm-labor-category-section",children:[s.jsx("div",{className:"tm-category-header",children:h.name}),x.map(T=>s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:T.name}),s.jsx("div",{className:"tm-workers-list",children:(dt[T.id]||[]).map((q,R)=>{const X=Rt(q);return s.jsxs("div",{className:`tm-worker-card-expanded ${X!=="empty"?`worker-${X}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[X==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(Ma,{size:14})}),s.jsx("input",{type:"text",placeholder:G("firstLastName"),value:q.name,onChange:ue=>Tt(T.id,R,"name",ue.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>Ya(T.id,R),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("start")}),s.jsx("input",{type:"time",value:q.timeStarted,onChange:ue=>Tt(T.id,R,"timeStarted",ue.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("end")}),s.jsx("input",{type:"time",value:q.timeEnded,onChange:ue=>Tt(T.id,R,"timeEnded",ue.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:q.hours,onChange:ue=>Tt(T.id,R,"hours",ue.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:q.overtimeHours,onChange:ue=>Tt(T.id,R,"overtimeHours",ue.target.value)})]})]})]},R)})}),s.jsxs("button",{className:"tm-add-btn",onClick:()=>yr(T.id),children:["+ ",te==="en"?"Add":"Agregar"," ",T.name]})]},T.id))]},h.id)}),ya.filter(h=>!h.category_id).map(h=>s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:h.name}),s.jsx("div",{className:"tm-workers-list",children:(dt[h.id]||[]).map((x,T)=>{const q=Rt(x);return s.jsxs("div",{className:`tm-worker-card-expanded ${q!=="empty"?`worker-${q}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[q==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(Ma,{size:14})}),s.jsx("input",{type:"text",placeholder:G("firstLastName"),value:x.name,onChange:R=>Tt(h.id,T,"name",R.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>Ya(h.id,T),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("start")}),s.jsx("input",{type:"time",value:x.timeStarted,onChange:R=>Tt(h.id,T,"timeStarted",R.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("end")}),s.jsx("input",{type:"time",value:x.timeEnded,onChange:R=>Tt(h.id,T,"timeEnded",R.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:x.hours,onChange:R=>Tt(h.id,T,"hours",R.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:x.overtimeHours,onChange:R=>Tt(h.id,T,"overtimeHours",R.target.value)})]})]})]},T)})}),s.jsxs("button",{className:"tm-add-btn",onClick:()=>yr(h.id),children:["+ ",te==="en"?"Add":"Agregar"," ",h.name]})]},h.id))]}),Na&&s.jsxs("div",{className:"tm-loading-labor-classes",children:[s.jsx(Zs,{size:20,className:"tm-spinner"}),s.jsx("span",{children:te==="en"?"Loading labor classes...":"Cargando clases de trabajo..."})]}),!mt&&!Na&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:G("supervision")}),s.jsx("div",{className:"tm-workers-list",children:D.map((h,x)=>{const T=Rt(h);return s.jsxs("div",{className:`tm-worker-card-expanded ${T!=="empty"?`worker-${T}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[T==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(Ma,{size:14})}),s.jsx("div",{className:"tm-role-select",children:s.jsxs("select",{value:h.role,onChange:q=>et(x,"role",q.target.value),children:[s.jsx("option",{value:"Foreman",children:G("foreman")}),s.jsx("option",{value:"Superintendent",children:G("superintendent")})]})}),s.jsx("input",{type:"text",placeholder:G("firstLastName"),value:h.name,onChange:q=>et(x,"name",q.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>Mt(x),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("start")}),s.jsx("input",{type:"time",value:h.timeStarted,onChange:q=>et(x,"timeStarted",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("end")}),s.jsx("input",{type:"time",value:h.timeEnded,onChange:q=>et(x,"timeEnded",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:h.hours,onChange:q=>et(x,"hours",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:h.overtimeHours,onChange:q=>et(x,"overtimeHours",q.target.value)})]})]})]},x)})}),s.jsx("button",{className:"tm-add-btn",onClick:Ca,children:G("addSupervision")})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:G("operators")}),s.jsx("div",{className:"tm-workers-list",children:W.map((h,x)=>{const T=Rt(h);return s.jsxs("div",{className:`tm-worker-card-expanded ${T!=="empty"?`worker-${T}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[T==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(Ma,{size:14})}),s.jsx("input",{type:"text",placeholder:G("firstLastName"),value:h.name,onChange:q=>Ba(x,"name",q.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>Kn(x),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("start")}),s.jsx("input",{type:"time",value:h.timeStarted,onChange:q=>Ba(x,"timeStarted",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("end")}),s.jsx("input",{type:"time",value:h.timeEnded,onChange:q=>Ba(x,"timeEnded",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:h.hours,onChange:q=>Ba(x,"hours",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:h.overtimeHours,onChange:q=>Ba(x,"overtimeHours",q.target.value)})]})]})]},x)})}),s.jsx("button",{className:"tm-add-btn",onClick:wi,children:G("addOperator")})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:G("laborers")}),s.jsx("div",{className:"tm-workers-list",children:Y.map((h,x)=>{const T=Rt(h);return s.jsxs("div",{className:`tm-worker-card-expanded ${T!=="empty"?`worker-${T}`:""}`,children:[s.jsxs("div",{className:"tm-worker-row-top",children:[T==="complete"&&s.jsx("span",{className:"tm-worker-check",children:s.jsx(Ma,{size:14})}),s.jsx("input",{type:"text",placeholder:G("firstLastName"),value:h.name,onChange:q=>qa(x,"name",q.target.value),className:"tm-worker-input"}),s.jsx("button",{className:"tm-remove",onClick:()=>xi(x),children:""})]}),s.jsxs("div",{className:"tm-worker-row-bottom",children:[s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("start")}),s.jsx("input",{type:"time",value:h.timeStarted,onChange:q=>qa(x,"timeStarted",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("end")}),s.jsx("input",{type:"time",value:h.timeEnded,onChange:q=>qa(x,"timeEnded",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("regHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:h.hours,onChange:q=>qa(x,"hours",q.target.value)})]}),s.jsxs("div",{className:"tm-time-group",children:[s.jsx("label",{children:G("otHrs")}),s.jsx("input",{type:"number",placeholder:"0",value:h.overtimeHours,onChange:q=>qa(x,"overtimeHours",q.target.value)})]})]})]},x)})}),s.jsx("button",{className:"tm-add-btn",onClick:_n,children:G("addLaborer")})]})]})]}),p===3&&!ot&&s.jsxs("div",{className:"tm-step-content",children:[s.jsxs("div",{className:"tm-field tm-search-field",children:[s.jsxs("div",{className:"tm-search-input-wrapper",children:[s.jsx(vg,{size:18,className:"tm-search-icon"}),s.jsx("input",{ref:Zn,type:"text",placeholder:G("searchMaterials"),value:hn,onChange:h=>tl(h.target.value),onFocus:()=>ts(),className:"tm-search-input"}),hn&&s.jsx("button",{className:"tm-search-clear",onClick:()=>{pn(""),Ua([])},children:""})]}),hn&&vt.length>0&&s.jsx("div",{className:"tm-search-results",children:vt.map((h,x)=>{const T=J.find(q=>q.id===h.id);return s.jsxs("button",{className:`tm-search-result-item ${T?"added":""}`,onClick:()=>{T?vr(J.indexOf(T),T.quantity+1):he([...J,{...h,quantity:1,isCustom:!1}]),pn(""),Ua([])},children:[s.jsx("span",{className:"tm-search-result-name",children:h.name}),s.jsx("span",{className:"tm-search-result-category",children:h.category}),T&&s.jsxs("span",{className:"tm-search-result-qty",children:["",T.quantity]})]},x)})}),hn&&vt.length===0&&s.jsx("div",{className:"tm-search-no-results",children:G("noSearchResults")})]}),s.jsxs("div",{className:"tm-field",children:[s.jsx("label",{children:G("orBrowse")}),s.jsx("div",{className:"tm-category-grid",children:Gc.map(h=>{const x=J.filter(T=>T.category===h);return s.jsxs("button",{className:"tm-category-card",onClick:()=>Nt(h),children:[s.jsx("span",{className:"tm-cat-name",children:h}),x.length>0&&s.jsx("span",{className:"tm-cat-count",children:x.length})]},h)})})]}),J.length>0&&s.jsxs("div",{className:"tm-field",children:[s.jsxs("label",{children:["Added Items (",J.length,")"]}),s.jsx("div",{className:"tm-added-list",children:J.map((h,x)=>s.jsxs("div",{className:"tm-added-item",children:[s.jsxs("div",{className:"tm-added-info",children:[h.isCustom&&s.jsx("span",{className:"tm-custom-badge",children:"Custom"}),s.jsx("span",{className:"tm-added-name",children:h.name})]}),s.jsxs("div",{className:"tm-added-qty",children:[s.jsx("button",{onClick:()=>vr(x,h.quantity-1),children:""}),s.jsx("span",{children:h.quantity}),s.jsx("button",{onClick:()=>vr(x,h.quantity+1),children:"+"})]})]},x))})]})]}),p===4&&s.jsxs("div",{className:"tm-step-content",children:[s.jsxs("div",{className:"tm-evidence-section",children:[s.jsxs("h3",{children:[s.jsx(Ac,{size:18})," ",G("photos")]}),ce.length>0&&s.jsx("div",{className:"tm-photo-grid",children:ce.map(h=>s.jsxs("div",{className:`tm-photo-item ${h.status?`photo-${h.status}`:""}`,children:[s.jsx("img",{src:h.previewUrl,alt:h.name}),h.status==="compressing"&&s.jsxs("div",{className:"tm-photo-status compressing",children:[s.jsx(Zs,{size:20,className:"tm-spinner"}),s.jsx("span",{children:te==="en"?"Compressing":"Comprimiendo"})]}),h.status==="uploading"&&s.jsxs("div",{className:"tm-photo-status uploading",children:[s.jsx(Zs,{size:20,className:"tm-spinner"}),s.jsx("span",{children:te==="en"?"Uploading":"Subiendo"})]}),h.status==="confirmed"&&s.jsx("div",{className:"tm-photo-status confirmed",children:s.jsx(Ma,{size:20})}),h.status==="failed"&&s.jsxs("div",{className:"tm-photo-status failed",title:h.error||"Upload failed",children:[s.jsx(pi,{size:20}),s.jsx("span",{children:te==="en"?"Failed":"Error"})]}),(!h.status||h.status==="pending"||h.status==="failed")&&s.jsx("button",{className:"tm-photo-remove",onClick:()=>sl(h.id),children:""})]},h.id))}),(i===-1||ce.length<i)&&s.jsxs("label",{className:"tm-photo-btn",children:[s.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:Qa,style:{display:"none"}}),s.jsx(Ac,{size:16,className:"inline-icon"})," ",ce.length>0?te==="en"?"Add More Photos":"Ms Fotos":G("addPhotos")]}),i!==-1&&s.jsxs("p",{className:"tm-photo-hint",children:[ce.length,"/",i," ",G("maxPhotos")]})]}),s.jsxs("div",{className:"tm-evidence-section",children:[s.jsxs("h3",{children:[s.jsx(bg,{size:18})," ",G("linkedCOR")]}),s.jsxs("div",{className:"tm-cor-row",children:[s.jsxs("select",{value:Me,onChange:h=>Ve(h.target.value),className:"tm-input tm-select",children:[s.jsxs("option",{value:"",children:["-- ",te==="en"?"No COR":"Sin COR"," --"]}),Te.map(h=>s.jsxs("option",{value:h.id,children:[h.cor_number,": ",h.title||"Untitled"," (",h.status,")"]},h.id))]}),s.jsx("button",{type:"button",className:"tm-refresh-btn",onClick:Ps,disabled:it,title:te==="en"?"Refresh COR list":"Actualizar lista",children:s.jsx(jg,{size:16,className:it?"spinning":""})})]}),Te.length===0&&!it&&s.jsx("p",{className:"tm-cor-hint",children:G("noCORs")})]})]}),p===5&&s.jsxs("div",{className:"tm-step-content",children:[s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[" ",G("workDate")]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>y(1),children:te==="en"?"Edit":"Editar"})]}),s.jsxs("div",{className:"tm-review-row",children:[s.jsx("span",{children:new Date(S).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),me&&s.jsxs("span",{children:["CE/PCO: ",me]})]})]}),Ne&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(ji,{size:16,className:"inline-icon"})," ",G("notes")]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>y(1),children:te==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-notes",children:Ne})]}),ce.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(Ac,{size:16,className:"inline-icon"})," ",G("photos")," (",ce.length,")"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>y(4),children:te==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-photos",children:ce.map(h=>s.jsx("img",{src:h.previewUrl,alt:h.name},h.id))})]}),Me&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[" ",G("linkedCOR")]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>y(4),children:te==="en"?"Edit":"Editar"})]}),s.jsxs("div",{className:"tm-review-cor",children:[Te.find(h=>h.id===Me)?.cor_number,": ",Te.find(h=>h.id===Me)?.title||"Untitled"]})]}),mt&&Ht.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(un,{size:16,className:"inline-icon"})," ",te==="en"?"Workers":"Trabajadores"," (",Xa+Da," hrs)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>y(2),children:te==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:Ht.map((h,x)=>s.jsxs("div",{className:"tm-review-row-detailed",children:[s.jsxs("div",{className:"tm-review-worker-name",children:[s.jsx("span",{className:"tm-role-badge",children:h.role})," ",h.name]}),s.jsxs("div",{className:"tm-review-worker-details",children:[h.time_started&&h.time_ended&&s.jsxs("span",{className:"tm-review-time",children:[h.time_started," - ",h.time_ended]}),s.jsxs("span",{className:"tm-review-hours",children:[h.hours||0," reg",h.overtime_hours>0?` + ${h.overtime_hours} OT`:""]})]})]},x))})]}),!mt&&vn.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(Sg,{size:16,className:"inline-icon"})," Supervision (",vn.reduce((h,x)=>h+parseFloat(x.hours||0)+parseFloat(x.overtimeHours||0),0)," hrs)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>y(2),children:te==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:vn.map((h,x)=>s.jsxs("div",{className:"tm-review-row-detailed",children:[s.jsxs("div",{className:"tm-review-worker-name",children:[s.jsx("span",{className:"tm-role-badge",children:h.role})," ",h.name]}),s.jsxs("div",{className:"tm-review-worker-details",children:[h.timeStarted&&h.timeEnded&&s.jsxs("span",{className:"tm-review-time",children:[h.timeStarted," - ",h.timeEnded]}),s.jsxs("span",{className:"tm-review-hours",children:[h.hours||0," reg",parseFloat(h.overtimeHours)>0?` + ${h.overtimeHours} OT`:""]})]})]},x))})]}),!mt&&ba.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[" Operators (",ba.reduce((h,x)=>h+parseFloat(x.hours||0)+parseFloat(x.overtimeHours||0),0)," hrs)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>y(2),children:te==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:ba.map((h,x)=>s.jsxs("div",{className:"tm-review-row-detailed",children:[s.jsx("div",{className:"tm-review-worker-name",children:h.name}),s.jsxs("div",{className:"tm-review-worker-details",children:[h.timeStarted&&h.timeEnded&&s.jsxs("span",{className:"tm-review-time",children:[h.timeStarted," - ",h.timeEnded]}),s.jsxs("span",{className:"tm-review-hours",children:[h.hours||0," reg",parseFloat(h.overtimeHours)>0?` + ${h.overtimeHours} OT`:""]})]})]},x))})]}),!mt&&ja.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(un,{size:16,className:"inline-icon"})," Laborers (",ja.reduce((h,x)=>h+parseFloat(x.hours||0)+parseFloat(x.overtimeHours||0),0)," hrs)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>y(2),children:te==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:ja.map((h,x)=>s.jsxs("div",{className:"tm-review-row-detailed",children:[s.jsx("div",{className:"tm-review-worker-name",children:h.name}),s.jsxs("div",{className:"tm-review-worker-details",children:[h.timeStarted&&h.timeEnded&&s.jsxs("span",{className:"tm-review-time",children:[h.timeStarted," - ",h.timeEnded]}),s.jsxs("span",{className:"tm-review-hours",children:[h.hours||0," reg",parseFloat(h.overtimeHours)>0?` + ${h.overtimeHours} OT`:""]})]})]},x))})]}),J.length>0&&s.jsxs("div",{className:"tm-review-section",children:[s.jsxs("div",{className:"tm-review-section-header",children:[s.jsxs("h4",{children:[s.jsx(xg,{size:16,className:"inline-icon"})," Materials & Equipment (",J.length," items)"]}),s.jsx("button",{className:"tm-edit-link",onClick:()=>y(3),children:te==="en"?"Edit":"Editar"})]}),s.jsx("div",{className:"tm-review-list",children:J.map((h,x)=>s.jsxs("div",{className:"tm-review-row",children:[s.jsxs("span",{children:[h.isCustom&&s.jsxs(s.Fragment,{children:[s.jsx(Xc,{size:14,className:"inline-icon"})," "]}),h.name]}),s.jsxs("span",{children:[h.quantity," ",h.unit]})]},x))})]}),s.jsxs("div",{className:"tm-review-section tm-certification",children:[s.jsx("div",{className:"tm-review-header",children:s.jsxs("span",{children:[s.jsx(Oc,{size:16,className:"inline-icon"})," Submitted By"]})}),s.jsx("input",{type:"text",className:"tm-certification-input",placeholder:"Enter your name",value:se,onChange:h=>Se(h.target.value)}),s.jsx("p",{className:"tm-certification-note",children:"By submitting, you certify this T&M is accurate."})]})]}),p===6&&k&&s.jsxs("div",{className:"tm-step-content tm-success-step",children:[s.jsxs("div",{className:"tm-success-header",children:[s.jsx("div",{className:"tm-success-icon",children:s.jsx(Dc,{size:48})}),s.jsx("h2",{children:te==="en"?"T&M Ticket Submitted!":"Ticket T&M Enviado!"}),s.jsx("p",{className:"tm-success-subtitle",children:te==="en"?"Your ticket has been saved and is ready for client signature.":"Su ticket ha sido guardado y est listo para la firma del cliente."})]}),s.jsxs("div",{className:"tm-success-summary",children:[s.jsxs("div",{className:"tm-success-stat",children:[s.jsx("span",{className:"tm-success-stat-value",children:jt}),s.jsx("span",{className:"tm-success-stat-label",children:te==="en"?"Workers":"Trabajadores"})]}),s.jsxs("div",{className:"tm-success-stat",children:[s.jsx("span",{className:"tm-success-stat-value",children:Xa+Da}),s.jsx("span",{className:"tm-success-stat-label",children:te==="en"?"Total Hours":"Horas Total"})]}),s.jsxs("div",{className:"tm-success-stat",children:[s.jsx("span",{className:"tm-success-stat-value",children:new Date(S).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),s.jsx("span",{className:"tm-success-stat-label",children:te==="en"?"Work Date":"Fecha"})]})]}),ce.some(h=>h.status==="failed")&&s.jsxs("div",{className:"tm-failed-photos-section",children:[s.jsxs("div",{className:"tm-failed-photos-header",children:[s.jsx(pi,{size:18}),s.jsx("span",{children:te==="en"?`${ce.filter(h=>h.status==="failed").length} photo(s) failed to upload`:`${ce.filter(h=>h.status==="failed").length} foto(s) no se subieron`})]}),s.jsx("div",{className:"tm-failed-photos-grid",children:ce.filter(h=>h.status==="failed").map(h=>s.jsxs("div",{className:"tm-failed-photo-item",children:[s.jsx("img",{src:h.previewUrl,alt:h.name}),s.jsx("div",{className:"tm-failed-photo-overlay",children:s.jsx("button",{className:"tm-retry-photo-btn",onClick:()=>rl(h.id,k.id),disabled:h.status==="uploading"||h.status==="compressing",children:h.status==="uploading"||h.status==="compressing"?s.jsx(Zs,{size:16,className:"tm-spinner"}):s.jsxs(s.Fragment,{children:[s.jsx(Hm,{size:16}),s.jsx("span",{children:te==="en"?"Retry":"Reintentar"})]})})}),h.error&&s.jsxs("div",{className:"tm-failed-photo-error",title:h.error,children:[h.error.substring(0,20),h.error.length>20?"...":""]})]},h.id))}),s.jsxs("button",{className:"tm-retry-all-btn",onClick:async()=>{const h=ce.filter(x=>x.status==="failed");for(const x of h)await rl(x.id,k.id)},children:[s.jsx(Hm,{size:16}),te==="en"?"Retry All Failed Photos":"Reintentar Todas las Fotos"]})]}),ce.length>0&&ce.every(h=>h.status==="confirmed")&&s.jsxs("div",{className:"tm-photos-success",children:[s.jsx(Ma,{size:16}),s.jsx("span",{children:te==="en"?`All ${ce.length} photo(s) uploaded successfully`:`${ce.length} foto(s) subidas exitosamente`})]}),s.jsxs("div",{className:"tm-signature-options",children:[s.jsx("h3",{children:te==="en"?"Get Client Signature":"Obtener Firma del Cliente"}),s.jsx("p",{className:"tm-signature-description",children:te==="en"?"Have the client sign this T&M ticket to verify the work performed.":"Haga que el cliente firme este ticket T&M para verificar el trabajo realizado."}),oe?s.jsxs("div",{className:"tm-signed-confirmation",children:[s.jsx(Dc,{size:32,className:"tm-signed-icon"}),s.jsx("span",{children:te==="en"?"Client signature collected!":"Firma del cliente recopilada!"})]}):s.jsxs("div",{className:"tm-signature-buttons",children:[s.jsxs("button",{className:"tm-signature-option-btn primary",onClick:()=>Z(!0),children:[s.jsx("div",{className:"tm-signature-option-icon",children:s.jsx(Oc,{size:24})}),s.jsxs("div",{className:"tm-signature-option-text",children:[s.jsx("span",{className:"tm-signature-option-title",children:te==="en"?"Sign Now (On-Site)":"Firmar Ahora"}),s.jsx("span",{className:"tm-signature-option-desc",children:te==="en"?"Client signs on this device":"Cliente firma en este dispositivo"})]})]}),s.jsxs("button",{className:"tm-signature-option-btn",onClick:()=>P(!0),children:[s.jsx("div",{className:"tm-signature-option-icon",children:s.jsx(wg,{size:24})}),s.jsxs("div",{className:"tm-signature-option-text",children:[s.jsx("span",{className:"tm-signature-option-title",children:te==="en"?"Send Signature Link":"Enviar Enlace"}),s.jsx("span",{className:"tm-signature-option-desc",children:te==="en"?"Client signs later via link":"Cliente firma despus va enlace"})]})]})]})]})]}),F&&k&&s.jsx(w.Suspense,{fallback:s.jsx("div",{className:"loading",children:"Loading..."}),children:s.jsx(c_,{documentType:"tm_ticket",documentId:k.id,companyId:l,projectId:r.id,documentTitle:`T&M - ${new Date(S).toLocaleDateString()}`,onClose:()=>P(!1),onShowToast:f})}),$&&k&&s.jsx(w.Suspense,{fallback:s.jsx("div",{className:"loading",children:"Loading..."}),children:s.jsx(u_,{ticketId:k.id,ticketSummary:{workDate:S,workerCount:jt,totalHours:Xa+Da},lang:te,onSave:()=>{Z(!1),ee(!0)},onClose:()=>Z(!1),onShowToast:f})}),p<6&&s.jsxs("div",{className:"tm-wizard-footer",children:[Lt.length>0&&s.jsxs("div",{className:"tm-validation-summary",children:[s.jsx(pi,{size:16}),s.jsx("span",{children:Lt[0]})]}),p===1&&s.jsx("button",{className:"tm-big-btn primary",onClick:Ta,disabled:!as(),children:G("nextCrew")}),p===2&&s.jsx(s.Fragment,{children:s.jsxs("button",{className:"tm-big-btn primary",onClick:Ta,disabled:!as(),children:[G("nextMaterials")," (",jt," ",G(jt===1?"worker":"workers_plural"),", ",Xa+Da," hrs)"]})}),p===3&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{className:"tm-big-btn primary",onClick:Ta,children:[te==="en"?"Next: Evidence":"Siguiente: Evidencia"," (",J.length," ",J.length===1?G("item"):G("items_plural"),")"]}),s.jsx("button",{className:"tm-skip-btn",onClick:Ta,children:G("skipNoMaterials")})]}),p===4&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{className:"tm-big-btn primary",onClick:Ta,children:[G("reviewItems")," (",ce.length," ",te==="en"?"photos":"fotos",")"]}),s.jsx("button",{className:"tm-skip-btn",onClick:Ta,children:te==="en"?"Skip (no photos)":"Saltar (sin fotos)"})]}),p===5&&s.jsx("button",{className:`tm-big-btn submit ${ae?"submitting":""} ${se.trim()?"ready":"needs-name"}`,onClick:rs,disabled:ae||!se.trim(),children:ae?s.jsxs(s.Fragment,{children:[s.jsx(Zs,{size:20,className:"tm-spinner"}),s.jsx("span",{className:"tm-submit-text",children:Je||G("submitting")})]}):se.trim()?s.jsxs(s.Fragment,{children:[s.jsx(Ma,{size:20}),s.jsx("span",{children:G("submitTM")})]}):s.jsxs(s.Fragment,{children:[s.jsx(Oc,{size:18}),s.jsx("span",{children:te==="en"?"Enter name to submit":"Ingrese nombre"})]})})]}),p===6&&s.jsxs("div",{className:"tm-wizard-footer",children:[s.jsxs("button",{className:"tm-big-btn primary",onClick:c,children:[s.jsx(Ma,{size:20}),s.jsx("span",{children:te==="en"?"Done":"Listo"})]}),s.jsx("button",{className:"tm-skip-btn",onClick:c,children:te==="en"?"Skip signature for now":"Saltar firma por ahora"})]}),U&&s.jsx("div",{className:"tm-modal-overlay",onClick:()=>re(!1),children:s.jsxs("div",{className:"tm-batch-modal",onClick:h=>h.stopPropagation(),children:[s.jsxs("h3",{children:[s.jsx(Tc,{size:18})," ",G("applySameHours")]}),s.jsx("p",{className:"tm-batch-description",children:G("batchDescription")}),s.jsxs("div",{className:"tm-time-presets",children:[s.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>va("full"),children:G("preset8hr")}),s.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>va("10hr"),children:G("preset10hr")}),s.jsx("button",{type:"button",className:"tm-preset-btn",onClick:()=>va("half"),children:G("preset4hr")})]}),s.jsxs("div",{className:"tm-batch-form",children:[s.jsxs("div",{className:"tm-batch-row",children:[s.jsxs("div",{className:"tm-batch-field",children:[s.jsx("label",{children:G("timeStarted")}),s.jsx("input",{type:"time",value:ge.timeStarted,onChange:h=>{const x=h.target.value,T=V(x,ge.timeEnded);ve({...ge,timeStarted:x,...T||{}})}})]}),s.jsxs("div",{className:"tm-batch-field",children:[s.jsx("label",{children:G("timeEnded")}),s.jsx("input",{type:"time",value:ge.timeEnded,onChange:h=>{const x=h.target.value,T=V(ge.timeStarted,x);ve({...ge,timeEnded:x,...T||{}})}})]})]}),s.jsxs("div",{className:"tm-batch-row",children:[s.jsxs("div",{className:"tm-batch-field",children:[s.jsx("label",{children:G("regularHours")}),s.jsx("input",{type:"number",placeholder:"8",value:ge.hours,onChange:h=>ve({...ge,hours:h.target.value})})]}),s.jsxs("div",{className:"tm-batch-field",children:[s.jsx("label",{children:G("overtimeHours")}),s.jsx("input",{type:"number",placeholder:"0",value:ge.overtimeHours,onChange:h=>ve({...ge,overtimeHours:h.target.value})})]})]})]}),s.jsxs("div",{className:"tm-batch-preview",children:[s.jsxs("strong",{children:[G("willApplyTo"),":"]}),s.jsxs("span",{children:[[...D.filter(h=>h&&h.name&&h.name.trim()),...W.filter(h=>h&&h.name&&h.name.trim()),...Y.filter(h=>h&&h.name&&h.name.trim())].length," ",G("workers_plural")]})]}),s.jsxs("div",{className:"tm-batch-actions",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>re(!1),children:G("cancel")}),s.jsx("button",{type:"button",className:"btn btn-primary",onClick:Is,disabled:!ge.hours&&!ge.overtimeHours,children:G("applyToAll")})]})]})})]})}function m_({project:r,companyId:l,onShowToast:i}){const[c,d]=w.useState([]),[f,p]=w.useState(!0),[y,S]=w.useState(!1),[z,k]=w.useState(!1),[M,F]=w.useState({name:"",role:"",labor_class_id:null}),[P,$]=w.useState([]),[Z,oe]=w.useState([]),[ee,me]=w.useState(!0),de=["Foreman","Laborer","Supervisor","Operator"];w.useEffect(()=>{Se(),l?se():me(!1)},[r.id,l]);const se=async()=>{try{const U=await _e.getLaborClassesForField(l);$(U.categories||[]),oe(U.classes||[]),U.classes&&U.classes.length>0&&F(re=>({...re,role:U.classes[0].name,labor_class_id:U.classes[0].id}))}catch(U){console.error("Error loading labor classes:",U)}finally{me(!1)}},Se=async()=>{try{const U=await _e.getCrewCheckin(r.id);U?.workers&&d(U.workers)}catch(U){console.error("Error loading crew:",U)}finally{p(!1)}},Me=U=>{const re=Z.find(ge=>ge.id===U);F(re?{...M,role:re.name,labor_class_id:re.id}:{...M,role:U,labor_class_id:null})},Ve=async()=>{if(!M.name.trim()){i("Enter worker name","error");return}if(!M.role){i("Select a role","error");return}if(c.find(U=>U.name.toLowerCase()===M.name.trim().toLowerCase())){i("Worker already added","error");return}S(!0);try{const U=[...c,{name:M.name.trim(),role:M.role,labor_class_id:M.labor_class_id}];await _e.saveCrewCheckin(r.id,U),d(U),F({...M,name:""}),k(!1),i("Crew member added","success")}catch(U){console.error("Error adding worker:",U),i("Error adding crew member","error")}finally{S(!1)}},Te=async U=>{S(!0);try{const re=c.filter(ge=>ge.name.toLowerCase()!==U.toLowerCase());await _e.saveCrewCheckin(r.id,re),d(re),i("Crew member removed","success")}catch(re){console.error("Error removing worker:",re),i("Error removing crew member","error")}finally{S(!1)}},Ae=new Date().toLocaleDateString("en-US",{weekday:"long",month:"short",day:"numeric"}),it=()=>{const U={};P.forEach(ge=>{U[ge.id]={name:ge.name,classes:Z.filter(ve=>ve.category_id===ge.id)}});const re=Z.filter(ge=>!ge.category_id);return re.length>0&&(U.uncategorized={name:"Other",classes:re}),U},Le=Z.length>0;return f||ee?s.jsxs("div",{className:"crew-checkin",children:[s.jsxs("div",{className:"crew-header",children:[s.jsxs("h3",{children:[s.jsx(un,{size:18,className:"inline-icon"})," Today's Crew"]}),s.jsx("span",{className:"crew-date",children:Ae})]}),s.jsx("div",{className:"crew-loading",children:"Loading..."})]}):s.jsxs("div",{className:"crew-checkin",children:[s.jsxs("div",{className:"crew-header",children:[s.jsxs("h3",{children:[s.jsx(un,{size:18,className:"inline-icon"})," Today's Crew"]}),s.jsx("span",{className:"crew-date",children:Ae})]}),c.length===0?s.jsxs("div",{className:"crew-empty",children:[s.jsx("p",{children:"No crew checked in yet"}),s.jsx("p",{className:"crew-empty-hint",children:"Add your crew for the day"})]}):s.jsx("div",{className:"crew-list",children:c.map(U=>s.jsxs("div",{className:"crew-member",children:[s.jsxs("div",{className:"crew-member-info",children:[s.jsx("span",{className:"crew-member-name",children:U.name}),s.jsx("span",{className:`crew-member-role ${(U.role||"laborer").toLowerCase().replace(/\s+/g,"-")}`,children:U.role})]}),s.jsx("button",{className:"crew-remove-btn",onClick:()=>Te(U.name),disabled:y,children:""})]},U.name))}),z?s.jsxs("div",{className:"crew-add-form",children:[s.jsx("input",{type:"text",value:M.name,onChange:U=>F({...M,name:U.target.value}),placeholder:"Name",autoFocus:!0}),s.jsx("select",{value:M.labor_class_id||M.role,onChange:U=>Me(U.target.value),children:Le?Object.entries(it()).map(([U,re])=>s.jsx("optgroup",{label:re.name,children:re.classes.map(ge=>s.jsx("option",{value:ge.id,children:ge.name},ge.id))},U)):de.map(U=>s.jsx("option",{value:U,children:U},U))}),s.jsxs("div",{className:"crew-add-buttons",children:[s.jsx("button",{className:"crew-add-confirm",onClick:Ve,disabled:y,children:y?"...":"Add"}),s.jsx("button",{className:"crew-add-cancel",onClick:()=>{k(!1),F({name:"",role:Z[0]?.name||"Laborer",labor_class_id:Z[0]?.id||null})},children:"Cancel"})]})]}):s.jsx("button",{className:"crew-add-btn",onClick:()=>k(!0),children:"+ Add Crew Member"}),s.jsxs("div",{className:"crew-count",children:[c.length," ",c.length===1?"person":"people"," on site"]})]})}function h_({project:r,onShowToast:l,onClose:i}){const[c,d]=w.useState(!0),[f,p]=w.useState(!1),[y,S]=w.useState(null),[z,k]=w.useState(""),[M,F]=w.useState("");w.useEffect(()=>{P()},[r.id]);const P=async()=>{try{const ee=await _e.getDailyReport(r.id);if(ee)S(ee),k(ee.field_notes||""),F(ee.issues||"");else{const me=await _e.compileDailyReport(r.id);S({...me,status:"draft"})}}catch(ee){console.error("Error loading report:",ee),l("Error loading report","error")}finally{d(!1)}},$=async()=>{if(!v){l("Demo Mode: Report saved locally only - won't reach office","info"),i();return}p(!0);try{await _e.saveDailyReport(r.id,{field_notes:z,issues:M}),await _e.submitDailyReport(r.id,"Field")?(l("Daily report submitted!","success"),i()):l("Report not sent - check connection","error")}catch(ee){console.error("Error submitting report:",ee),l("Error submitting report","error")}finally{p(!1)}},Z=new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"});if(c)return s.jsxs("div",{className:"daily-report",children:[s.jsxs("div",{className:"daily-report-header",children:[s.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),s.jsx("h2",{children:"Daily Report"})]}),s.jsx("div",{className:"daily-report-loading",children:"Compiling report..."})]});const oe=y?.status==="submitted";return s.jsxs("div",{className:"daily-report",children:[s.jsxs("div",{className:"daily-report-header",children:[s.jsx("button",{className:"back-btn-simple",onClick:i,children:""}),s.jsxs("div",{children:[s.jsx("h2",{children:"Daily Report"}),s.jsx("p",{className:"daily-report-date",children:Z})]})]}),oe&&s.jsxs("div",{className:"daily-report-submitted-banner",children:[" Submitted ",new Date(y.submitted_at).toLocaleTimeString()]}),s.jsxs("div",{className:"daily-report-content",children:[s.jsxs("div",{className:"daily-report-summary",children:[s.jsxs("div",{className:"daily-report-card",children:[s.jsx("div",{className:"daily-report-card-value",children:y.crew_count||0}),s.jsx("div",{className:"daily-report-card-label",children:"Crew on Site"})]}),s.jsxs("div",{className:"daily-report-card",children:[s.jsx("div",{className:"daily-report-card-value",children:y.tasks_completed||0}),s.jsx("div",{className:"daily-report-card-label",children:"Tasks Done"})]}),s.jsxs("div",{className:"daily-report-card",children:[s.jsx("div",{className:"daily-report-card-value",children:y.tm_tickets_count||0}),s.jsx("div",{className:"daily-report-card-label",children:"T&M Tickets"})]}),s.jsxs("div",{className:"daily-report-card",children:[s.jsx("div",{className:"daily-report-card-value",children:y.photos_count||0}),s.jsx("div",{className:"daily-report-card-label",children:"Photos"})]})]}),y.crew_list?.length>0&&s.jsxs("div",{className:"daily-report-section",children:[s.jsxs("h3",{children:[s.jsx(un,{size:18,className:"inline-icon"})," Crew"]}),s.jsx("div",{className:"daily-report-crew",children:y.crew_list.map((ee,me)=>s.jsxs("div",{className:"daily-report-crew-item",children:[s.jsx("span",{children:ee.name}),s.jsx("span",{className:"daily-report-crew-role",children:ee.role})]},me))})]}),y.completed_tasks?.length>0&&s.jsxs("div",{className:"daily-report-section",children:[s.jsxs("h3",{children:[s.jsx(Ng,{size:18,className:"inline-icon"})," Completed Today"]}),s.jsx("ul",{className:"daily-report-tasks",children:y.completed_tasks.map((ee,me)=>s.jsxs("li",{children:[ee.name,ee.group&&s.jsx("span",{className:"daily-report-task-group",children:ee.group})]},me))})]}),s.jsxs("div",{className:"daily-report-section",children:[s.jsxs("h3",{children:[s.jsx(ji,{size:18,className:"inline-icon"})," Notes"]}),s.jsx("textarea",{value:z,onChange:ee=>k(ee.target.value),placeholder:"Any notes about today's work...",rows:3,disabled:oe})]}),s.jsxs("div",{className:"daily-report-section",children:[s.jsxs("h3",{children:[s.jsx(Pc,{size:18,className:"inline-icon"})," Issues / Concerns"]}),s.jsx("textarea",{value:M,onChange:ee=>F(ee.target.value),placeholder:"Any problems, delays, or concerns...",rows:3,disabled:oe})]})]}),!oe&&s.jsxs("div",{className:"daily-report-footer",children:[s.jsx("button",{className:"btn btn-primary daily-report-submit",onClick:$,disabled:f,children:f?"Submitting...":s.jsxs(s.Fragment,{children:[s.jsx(Eg,{size:16,className:"inline-icon"})," Submit Report"]})}),s.jsx("p",{className:"daily-report-hint",children:"This will be sent to the office"})]})]})}function p_({project:r,companyId:l,user:i,onClose:c,onReportCreated:d}){const[f,p]=w.useState(!1),[y,S]=w.useState(null),[z,k]=w.useState(1),[M,F]=w.useState(new Date().toISOString().split("T")[0]),[P,$]=w.useState(new Date().toTimeString().split(" ")[0].substring(0,5)),[Z,oe]=w.useState(""),[ee,me]=w.useState(""),[de,se]=w.useState("minor"),[Se,Me]=w.useState(""),[Ve,Te]=w.useState(""),[Ae,it]=w.useState(""),[Le,U]=w.useState(""),[re,ge]=w.useState(""),[ve,D]=w.useState(""),[Q,W]=w.useState(""),[be,Y]=w.useState(i?.name||""),[ye,J]=w.useState(""),[he,Ne]=w.useState(""),[K,ce]=w.useState(i?.email||""),[He,ae]=w.useState([]),[we,Je]=w.useState(""),[Re,nt]=w.useState(""),[wt,Xe]=w.useState(""),[na,ot]=w.useState(""),[Nt,pr]=w.useState(!1),[mn,Qn]=w.useState(""),[Ra,hn]=w.useState(""),[pn,vt]=w.useState(!1),[Ua,Xn]=w.useState(""),[Vn,ra]=w.useState(""),[Ha,bt]=w.useState(""),[La,Zn]=w.useState(""),[_a,Et]=w.useState(!1),[te,Dt]=w.useState(!1),[G,Ir]=w.useState(0),[gr,ya]=w.useState(0),gn=()=>{if(!we.trim()){S({type:"error",message:"Please enter witness name"});return}const V={name:we,phone:Re,email:wt,testimony:na};ae([...He,V]),Je(""),nt(""),Xe(""),ot(""),S({type:"success",message:"Witness added"})},dt=V=>{ae(He.filter((Rt,va)=>va!==V))},ft=V=>{switch(V){case 1:if(!Z.trim()||!ee.trim())return S({type:"error",message:"Please fill in all incident details"}),!1;break;case 2:if(!Ve.trim()||!ve.trim())return S({type:"error",message:"Please fill in employee name and job title"}),!1;break;case 3:if(!be.trim()||!ye.trim())return S({type:"error",message:"Please fill in supervisor name and title"}),!1;break}return!0},Na=()=>{ft(z)&&k(z+1)},Ea=()=>{k(z-1)},mt=async()=>{if(ft(z)){if(!v){S({type:"info",message:"Demo Mode: Report saved locally only - won't reach office"}),setTimeout(()=>{c()},1500);return}p(!0);try{const V={project_id:r.id,company_id:l,incident_date:M,incident_time:P,incident_location:Z,incident_description:ee,injury_type:de,body_part_affected:Se||null,employee_name:Ve,employee_phone:Ae||null,employee_email:Le||null,employee_address:re||null,employee_job_title:ve,employee_hire_date:Q||null,medical_treatment_required:Nt,medical_facility_name:mn||null,medical_facility_address:Ra||null,hospitalized:pn,reported_by_name:be,reported_by_title:ye,reported_by_phone:he||null,reported_by_email:K||null,witnesses:He,immediate_actions_taken:Ua||null,corrective_actions_planned:Vn||null,safety_equipment_used:Ha||null,safety_equipment_failed:La||null,osha_recordable:_a,workers_comp_claim:te,days_away_from_work:parseInt(G)||0,restricted_work_days:parseInt(gr)||0,status:"reported",created_by:i?.id},Rt=await _e.createInjuryReport(V);S({type:"success",message:"Injury report submitted successfully"}),d&&d(Rt),setTimeout(()=>{c()},1500)}catch(V){console.error("Error submitting injury report:",V),S({type:"error",message:"Failed to submit injury report"})}finally{p(!1)}}};return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"modal-overlay",onClick:c,children:s.jsxs("div",{className:"modal-content injury-report-modal",onClick:V=>V.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h2",{children:"Workplace Injury/Incident Report"}),s.jsx("button",{className:"close-btn",onClick:c,children:""})]}),s.jsxs("div",{className:"progress-steps",children:[s.jsx("div",{className:`step ${z>=1?"active":""}`,children:"1. Incident"}),s.jsx("div",{className:`step ${z>=2?"active":""}`,children:"2. Employee"}),s.jsx("div",{className:`step ${z>=3?"active":""}`,children:"3. Supervisor"}),s.jsx("div",{className:`step ${z>=4?"active":""}`,children:"4. Witnesses"}),s.jsx("div",{className:`step ${z>=5?"active":""}`,children:"5. Medical & Safety"})]}),s.jsxs("div",{className:"modal-body",children:[z===1&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Incident Details"}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Date of Incident *"}),s.jsx("input",{type:"date",value:M,onChange:V=>F(V.target.value),max:new Date().toISOString().split("T")[0]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Time of Incident *"}),s.jsx("input",{type:"time",value:P,onChange:V=>$(V.target.value)})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Location on Site *"}),s.jsx("input",{type:"text",value:Z,onChange:V=>oe(V.target.value),placeholder:"e.g., Floor 2, near elevator shaft"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Incident Description *"}),s.jsx("textarea",{value:ee,onChange:V=>me(V.target.value),rows:4,placeholder:"Describe what happened in detail..."})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Injury Type *"}),s.jsxs("select",{value:de,onChange:V=>se(V.target.value),children:[s.jsx("option",{value:"minor",children:"Minor Injury"}),s.jsx("option",{value:"serious",children:"Serious Injury"}),s.jsx("option",{value:"critical",children:"Critical Injury"}),s.jsx("option",{value:"near_miss",children:"Near Miss (No Injury)"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Body Part Affected"}),s.jsx("input",{type:"text",value:Se,onChange:V=>Me(V.target.value),placeholder:"e.g., Left hand, lower back"})]})]})]}),z===2&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Injured Employee Information"}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Full Name *"}),s.jsx("input",{type:"text",value:Ve,onChange:V=>Te(V.target.value),placeholder:"First and last name"})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Phone Number"}),s.jsx("input",{type:"tel",value:Ae,onChange:V=>it(V.target.value),placeholder:"(555) 123-4567"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Email Address"}),s.jsx("input",{type:"email",value:Le,onChange:V=>U(V.target.value),placeholder:"email@example.com"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Home Address"}),s.jsx("input",{type:"text",value:re,onChange:V=>ge(V.target.value),placeholder:"Street address, city, state, zip"})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Job Title *"}),s.jsx("input",{type:"text",value:ve,onChange:V=>D(V.target.value),placeholder:"e.g., Carpenter, Electrician"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Hire Date"}),s.jsx("input",{type:"date",value:Q,onChange:V=>W(V.target.value)})]})]})]}),z===3&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Foreman/Supervisor Making Report"}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Your Name *"}),s.jsx("input",{type:"text",value:be,onChange:V=>Y(V.target.value),placeholder:"Full name"})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Your Title *"}),s.jsx("input",{type:"text",value:ye,onChange:V=>J(V.target.value),placeholder:"e.g., Site Foreman, Project Manager"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Your Phone Number"}),s.jsx("input",{type:"tel",value:he,onChange:V=>Ne(V.target.value),placeholder:"(555) 123-4567"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Your Email Address"}),s.jsx("input",{type:"email",value:K,onChange:V=>ce(V.target.value),placeholder:"email@example.com"})]})]}),z===4&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Witness Testimonies (Optional)"}),He.length>0&&s.jsx("div",{className:"witnesses-list",children:He.map((V,Rt)=>s.jsxs("div",{className:"witness-item",children:[s.jsxs("div",{className:"witness-info",children:[s.jsx("strong",{children:V.name}),V.phone&&s.jsxs("span",{children:["  ",V.phone]}),V.testimony&&s.jsxs("p",{className:"witness-testimony",children:['"',V.testimony,'"']})]}),s.jsx("button",{className:"btn-danger btn-small",onClick:()=>dt(Rt),children:"Remove"})]},Rt))}),s.jsxs("div",{className:"add-witness-form",children:[s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Witness Name"}),s.jsx("input",{type:"text",value:we,onChange:V=>Je(V.target.value),placeholder:"Full name"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Phone Number"}),s.jsx("input",{type:"tel",value:Re,onChange:V=>nt(V.target.value),placeholder:"(555) 123-4567"})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Email Address"}),s.jsx("input",{type:"email",value:wt,onChange:V=>Xe(V.target.value),placeholder:"email@example.com"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Witness Testimony"}),s.jsx("textarea",{value:na,onChange:V=>ot(V.target.value),rows:3,placeholder:"What did the witness see or hear?"})]}),s.jsx("button",{className:"btn-secondary",onClick:gn,children:"+ Add Witness"})]})]}),z===5&&s.jsxs("div",{className:"form-step",children:[s.jsx("h3",{children:"Medical Treatment & Safety"}),s.jsx("div",{className:"form-group checkbox-group",children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:Nt,onChange:V=>pr(V.target.checked)}),"Medical treatment required"]})}),Nt&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Medical Facility Name"}),s.jsx("input",{type:"text",value:mn,onChange:V=>Qn(V.target.value),placeholder:"Hospital or clinic name"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Medical Facility Address"}),s.jsx("input",{type:"text",value:Ra,onChange:V=>hn(V.target.value),placeholder:"Street address"})]}),s.jsx("div",{className:"form-group checkbox-group",children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:pn,onChange:V=>vt(V.target.checked)}),"Employee was hospitalized"]})})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Immediate Actions Taken"}),s.jsx("textarea",{value:Ua,onChange:V=>Xn(V.target.value),rows:2,placeholder:"What was done immediately after the incident?"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Corrective Actions Planned"}),s.jsx("textarea",{value:Vn,onChange:V=>ra(V.target.value),rows:2,placeholder:"What will be done to prevent this in the future?"})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Safety Equipment Used"}),s.jsx("input",{type:"text",value:Ha,onChange:V=>bt(V.target.value),placeholder:"e.g., Hard hat, gloves, harness"})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Safety Equipment Failed"}),s.jsx("input",{type:"text",value:La,onChange:V=>Zn(V.target.value),placeholder:"Equipment that failed, if any"})]})]}),s.jsxs("div",{className:"form-row",children:[s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Days Away From Work"}),s.jsx("input",{type:"number",min:"0",value:G,onChange:V=>Ir(V.target.value)})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{children:"Restricted Work Days"}),s.jsx("input",{type:"number",min:"0",value:gr,onChange:V=>ya(V.target.value)})]})]}),s.jsx("div",{className:"form-group checkbox-group",children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:_a,onChange:V=>Et(V.target.checked)}),"OSHA Recordable Incident"]})}),s.jsx("div",{className:"form-group checkbox-group",children:s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:te,onChange:V=>Dt(V.target.checked)}),"Workers' Compensation Claim Filed"]})})]})]}),s.jsx("div",{className:"modal-footer",children:s.jsxs("div",{className:"form-actions",children:[z>1&&s.jsx("button",{className:"btn-secondary",onClick:Ea,children:" Back"}),s.jsx("button",{className:"btn-secondary",onClick:c,children:"Cancel"}),z<5?s.jsx("button",{className:"btn-primary",onClick:Na,children:"Next "}):s.jsx("button",{className:"btn-primary",onClick:mt,disabled:f,children:f?"Submitting...":"Submit Report"})]})})]})}),y&&s.jsx(fr,{message:y.message,type:y.type,onClose:()=>S(null)}),s.jsx("style",{children:`
        .injury-report-modal {
          max-width: 800px;
          max-height: 90vh;
          overflow-y: auto;
        }

        .progress-steps {
          display: flex;
          justify-content: space-between;
          padding: 1rem 1.5rem;
          border-bottom: 1px solid var(--border-color);
          background-color: var(--bg-elevated);
          overflow-x: auto;
        }

        .progress-steps .step {
          font-size: 0.875rem;
          color: var(--text-muted);
          font-weight: 500;
          white-space: nowrap;
          padding: 0.5rem;
        }

        .progress-steps .step.active {
          color: var(--accent-primary);
          font-weight: 600;
        }

        .form-step h3 {
          margin-top: 0;
          margin-bottom: 1.5rem;
          color: var(--text-primary);
          font-size: 1.25rem;
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1rem;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .form-group label {
          display: block;
          margin-bottom: 0.5rem;
          font-weight: 500;
          color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
          width: 100%;
          padding: 0.5rem;
          border: 1px solid var(--border-color);
          border-radius: 4px;
          font-size: 1rem;
          background: var(--bg-card);
          color: var(--text-primary);
        }

        .form-group textarea {
          resize: vertical;
        }

        .checkbox-group label {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-weight: normal;
          cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
          width: auto;
          margin: 0;
        }

        .witnesses-list {
          margin-bottom: 1.5rem;
        }

        .witness-item {
          border: 1px solid var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          margin-bottom: 0.5rem;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
        }

        .witness-info {
          flex: 1;
          color: var(--text-primary);
        }

        .witness-testimony {
          margin-top: 0.5rem;
          color: var(--text-secondary);
          font-style: italic;
          font-size: 0.875rem;
        }

        .add-witness-form {
          border: 2px dashed var(--border-color);
          border-radius: 6px;
          padding: 1rem;
          background-color: var(--bg-elevated);
        }

        .modal-footer {
          border-top: 1px solid var(--border-color);
          padding: 1rem 1.5rem;
        }

        .form-actions {
          display: flex;
          justify-content: space-between;
          gap: 0.5rem;
        }

        .btn-primary,
        .btn-secondary,
        .btn-danger {
          padding: 0.5rem 1rem;
          border-radius: 6px;
          font-weight: 500;
          cursor: pointer;
          border: none;
        }

        .btn-primary {
          background-color: var(--primary-color, #3b82f6);
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          opacity: 0.9;
        }

        .btn-primary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .btn-secondary {
          background-color: var(--bg-elevated);
          color: var(--text-primary);
          border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
          background-color: var(--bg-tertiary);
        }

        .btn-danger {
          background-color: #ef4444;
          color: white;
        }

        .btn-danger:hover {
          background-color: #dc2626;
        }

        .btn-small {
          padding: 0.25rem 0.75rem;
          font-size: 0.875rem;
        }

        @media (max-width: 768px) {
          .injury-report-modal {
            max-width: 100%;
            height: 100vh;
            max-height: 100vh;
            border-radius: 0;
          }

          .form-row {
            grid-template-columns: 1fr;
          }

          .progress-steps .step {
            font-size: 0.75rem;
            padding: 0.25rem;
          }
        }
      `})]})}const bi=[{value:"concrete",label:"Concrete",icon:""},{value:"trash",label:"Trash",icon:""},{value:"metals",label:"Metals",icon:""},{value:"hazardous_waste",label:"Hazardous",icon:""}],g_=r=>bi.find(l=>l.value===r)||{label:r,icon:""};function __({project:r,user:l=null,date:i,onShowToast:c}){const[d,f]=w.useState([]),[p,y]=w.useState([]),[S,z]=w.useState(!0),[k,M]=w.useState(!1),[F,P]=w.useState(!1),[$,Z]=w.useState(!1),[oe,ee]=w.useState({type:"concrete",count:1}),me=new Date(i).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});w.useEffect(()=>{de(),se()},[r.id,i]);const de=async()=>{try{z(!0);const U=await _e.getDisposalLoads(r.id,i);f(U||[])}catch(U){console.error("Error loading disposal loads:",U)}finally{z(!1)}},se=async()=>{try{const re=(await _e.getDisposalLoadsHistory(r.id,14)||[]).filter(ve=>ve.load_date!==i).reduce((ve,D)=>(ve[D.load_date]||(ve[D.load_date]=[]),ve[D.load_date].push(D),ve),{}),ge=Object.entries(re).map(([ve,D])=>({date:ve,loads:D,totalLoads:D.reduce((Q,W)=>Q+W.load_count,0)})).sort((ve,D)=>new Date(D.date)-new Date(ve.date));y(ge)}catch(U){console.error("Error loading disposal history:",U)}},Se=async()=>{if(!(oe.count<1)){M(!0);try{await _e.addDisposalLoad(r.id,l?.id||null,i,oe.type,oe.count),await de(),ee({type:"concrete",count:1}),P(!1),c?.("Disposal load added","success")}catch(U){console.error("Error adding disposal load:",U),c?.("Error adding load","error")}finally{M(!1)}}},Me=async U=>{M(!0);try{await _e.deleteDisposalLoad(U),await de(),c?.("Load removed","success")}catch(re){console.error("Error deleting disposal load:",re),c?.("Error removing load","error")}finally{M(!1)}},Ve=async U=>{M(!0);try{await _e.addDisposalLoad(r.id,l?.id||null,i,U,1),await de(),c?.("Load added","success")}catch(re){console.error("Error adding disposal load:",re),c?.("Error adding load","error")}finally{M(!1)}},Te=async U=>{M(!0);try{await _e.updateDisposalLoad(U.id,U.load_type,U.load_count+1),await de()}catch(re){console.error("Error updating load:",re),c?.("Error updating load","error")}finally{M(!1)}},Ae=async U=>{if(U.load_count<=1){await Me(U.id);return}M(!0);try{await _e.updateDisposalLoad(U.id,U.load_type,U.load_count-1),await de()}catch(re){console.error("Error updating load:",re),c?.("Error updating load","error")}finally{M(!1)}},it=d.reduce((U,re)=>(U[re.load_type]||(U[re.load_type]={items:[],total:0}),U[re.load_type].items.push(re),U[re.load_type].total+=re.load_count,U),{}),Le=d.reduce((U,re)=>U+re.load_count,0);return S?s.jsxs("div",{className:"disposal-load-input",children:[s.jsxs("div",{className:"disposal-header",children:[s.jsx(Vc,{size:20}),s.jsx("span",{children:"Disposal Loads"})]}),s.jsx("div",{className:"disposal-loading",children:"Loading..."})]}):s.jsxs("div",{className:"disposal-load-input",children:[s.jsxs("div",{className:"disposal-header",children:[s.jsxs("div",{className:"disposal-title",children:[s.jsx(Vc,{size:20}),s.jsx("span",{children:"Disposal Loads"}),Le>0&&s.jsx("span",{className:"disposal-badge",children:Le})]}),s.jsx("span",{className:"disposal-date",children:me})]}),s.jsx("div",{className:"disposal-quick-add",children:bi.map(U=>s.jsxs("button",{className:"quick-add-btn",onClick:()=>Ve(U.value),disabled:k,children:[s.jsx("span",{className:"quick-add-icon",children:U.icon}),s.jsxs("span",{className:"quick-add-label",children:["+ ",U.label]})]},U.value))}),Object.keys(it).length>0?s.jsx("div",{className:"disposal-loads-list",children:bi.map(U=>{const re=it[U.value];return re?s.jsxs("div",{className:"disposal-load-row",children:[s.jsxs("div",{className:"load-info",children:[s.jsx("span",{className:"load-icon",children:U.icon}),s.jsx("span",{className:"load-label",children:U.label})]}),s.jsxs("div",{className:"load-controls",children:[s.jsx("button",{className:"load-btn decrement",onClick:()=>Ae(re.items[0]),disabled:k,children:s.jsx(Lm,{size:16})}),s.jsx("span",{className:"load-count",children:re.total}),s.jsx("button",{className:"load-btn increment",onClick:()=>Te(re.items[0]),disabled:k,children:s.jsx(kc,{size:16})})]})]},U.value):null})}):s.jsxs("div",{className:"disposal-empty",children:[s.jsxs("p",{children:["No disposal loads recorded for ",me]}),s.jsx("p",{className:"disposal-hint",children:"Tap a button above to add loads"})]}),F&&s.jsxs("div",{className:"disposal-add-form",children:[s.jsxs("div",{className:"add-form-row",children:[s.jsx("select",{value:oe.type,onChange:U=>ee({...oe,type:U.target.value}),className:"load-type-select",children:bi.map(U=>s.jsxs("option",{value:U.value,children:[U.icon," ",U.label]},U.value))}),s.jsxs("div",{className:"count-input-group",children:[s.jsx("button",{className:"count-btn",onClick:()=>ee({...oe,count:Math.max(1,oe.count-1)}),children:s.jsx(Lm,{size:16})}),s.jsx("input",{type:"number",min:"1",value:oe.count,onChange:U=>ee({...oe,count:parseInt(U.target.value)||1}),className:"count-input"}),s.jsx("button",{className:"count-btn",onClick:()=>ee({...oe,count:oe.count+1}),children:s.jsx(kc,{size:16})})]})]}),s.jsxs("div",{className:"add-form-actions",children:[s.jsxs("button",{className:"btn btn-secondary btn-small",onClick:()=>P(!1),children:[s.jsx(Cg,{size:16})," Cancel"]}),s.jsxs("button",{className:"btn btn-primary btn-small",onClick:Se,disabled:k,children:[s.jsx(Ma,{size:16})," Add"]})]})]}),!F&&s.jsxs("button",{className:"disposal-add-custom",onClick:()=>P(!0),children:[s.jsx(kc,{size:16}),"Add multiple loads"]}),Le>0&&s.jsxs("div",{className:"disposal-summary",children:[s.jsx("strong",{children:Le})," total load",Le!==1?"s":""," today"]}),p.length>0&&s.jsxs("div",{className:"disposal-history-section",children:[s.jsxs("button",{className:"disposal-history-toggle",onClick:()=>Z(!$),children:[s.jsx(qg,{size:16}),s.jsxs("span",{children:["View History (",p.length," days)"]}),$?s.jsx(Dg,{size:16}):s.jsx(Tg,{size:16})]}),$&&s.jsx("div",{className:"disposal-history-list",children:p.map(U=>{const re=new Date(U.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),ge=U.loads.reduce((ve,D)=>(ve[D.load_type]||(ve[D.load_type]=0),ve[D.load_type]+=D.load_count,ve),{});return s.jsxs("div",{className:"disposal-history-day",children:[s.jsxs("div",{className:"disposal-history-header",children:[s.jsx("span",{className:"disposal-history-date",children:re}),s.jsxs("span",{className:"disposal-history-total",children:[U.totalLoads," load",U.totalLoads!==1?"s":""]})]}),s.jsx("div",{className:"disposal-history-types",children:Object.entries(ge).map(([ve,D])=>{const Q=g_(ve);return s.jsxs("span",{className:"disposal-history-type",children:[Q.icon," ",D," ",Q.label]},ve)})})]},U.date)})})]})]})}function y_({project:r,companyId:l,onShowToast:i,onExit:c}){const[d,f]=w.useState([]),[p,y]=w.useState(!0),[S,z]=w.useState(null),[k,M]=w.useState({}),[F,P]=w.useState(!1),[$,Z]=w.useState(!1),[oe,ee]=w.useState(!1),[me,de]=w.useState(!1),[se,Se]=w.useState(!1),[Me,Ve]=w.useState(!1),[Te,Ae]=w.useState("actions");w.useEffect(()=>{it()},[r.id]);const it=async()=>{try{const Y=await _e.getAreas(r.id);f(Y);const ye=[...new Set(Y.map(he=>he.group_name||"General"))],J={};ye.forEach(he=>J[he]=!1),M(J)}catch(Y){console.error("Error loading areas:",Y),i("Error loading areas","error")}finally{y(!1)}},Le=async(Y,ye)=>{const J=d.find(Ne=>Ne.id===Y);if(!J)return;const he=J.status===ye?"not_started":ye;z(Y);try{await _e.updateAreaStatus(Y,he),f(Ne=>Ne.map(K=>K.id===Y?{...K,status:he}:K)),i("Updated","success")}catch(Ne){console.error("Error updating status:",Ne),i("Error updating","error")}finally{z(null)}},U=Y=>{M(ye=>({...ye,[Y]:!ye[Y]}))};if(p)return s.jsx("div",{className:"foreman-container",children:s.jsxs("div",{className:"loading",children:[s.jsx("div",{className:"spinner"}),"Loading..."]})});if(F)return s.jsx("div",{className:"foreman-container",children:s.jsx(f_,{project:r,companyId:l,onSubmit:()=>P(!1),onCancel:()=>P(!1),onShowToast:i})});if(me)return s.jsx(h_,{project:r,onShowToast:i,onClose:()=>de(!1)});if(se)return s.jsx("div",{className:"foreman-container",children:s.jsx(p_,{project:r,companyId:l,onClose:()=>Se(!1),onReportCreated:()=>{Se(!1),i("Injury report submitted","success")}})});if($)return s.jsxs("div",{className:"foreman-container",children:[s.jsxs("div",{className:"foreman-view-header",children:[s.jsx("button",{className:"back-btn-simple",onClick:()=>Z(!1),children:""}),s.jsx("h2",{children:"Crew Check-in"})]}),s.jsx(m_,{project:r,companyId:l,onShowToast:i})]});if(oe)return s.jsxs("div",{className:"foreman-container",children:[s.jsxs("div",{className:"foreman-view-header",children:[s.jsx("button",{className:"back-btn-simple",onClick:()=>ee(!1),children:""}),s.jsx("h2",{children:"Disposal Loads"})]}),s.jsx(__,{project:r,date:new Date().toISOString().split("T")[0],onShowToast:i})]});const re=i_(d),ge=d.reduce((Y,ye)=>{const J=ye.group_name||"General";return Y[J]||(Y[J]=[]),Y[J].push(ye),Y},{}),ve=Object.keys(ge).length>1||Object.keys(ge).length===1&&!ge.General,D=Y=>`${Y.filter(J=>J.status==="done").length}/${Y.length}`,Q=d.filter(Y=>Y.status==="done").length,W=d.filter(Y=>Y.status==="working").length,be=d.length-Q;return s.jsxs("div",{className:"foreman-container",children:[s.jsxs("div",{className:"foreman-header",children:[s.jsx("button",{className:"back-btn-simple",onClick:c,children:""}),s.jsxs("div",{className:"foreman-header-info",children:[s.jsx("div",{className:"foreman-project-name",children:r.name}),s.jsxs("div",{className:"foreman-progress",children:[re,"% Complete"]})]}),s.jsxs("div",{className:"foreman-header-actions",children:[s.jsx($c,{compact:!0}),s.jsx("button",{className:"foreman-info-btn",onClick:()=>Ve(!Me),children:s.jsx(Ag,{size:20})})]})]}),Me&&s.jsxs("div",{className:"foreman-project-info",children:[r.job_number&&s.jsxs("div",{className:"foreman-info-row",children:[s.jsx("span",{className:"foreman-info-label",children:"Job #"}),s.jsx("span",{className:"foreman-info-value",children:r.job_number})]}),r.address&&s.jsxs("div",{className:"foreman-info-row",children:[s.jsx("span",{className:"foreman-info-label",children:"Address"}),s.jsx("span",{className:"foreman-info-value",children:r.address})]}),r.general_contractor&&s.jsxs("div",{className:"foreman-info-row",children:[s.jsx("span",{className:"foreman-info-label",children:"GC / Client"}),s.jsx("span",{className:"foreman-info-value",children:r.general_contractor})]}),r.client_contact&&s.jsxs("div",{className:"foreman-info-row",children:[s.jsx("span",{className:"foreman-info-label",children:"Contact"}),s.jsx("span",{className:"foreman-info-value",children:r.client_contact})]}),r.client_phone&&s.jsxs("div",{className:"foreman-info-row",children:[s.jsx("span",{className:"foreman-info-label",children:"Phone"}),s.jsx("a",{href:`tel:${r.client_phone}`,className:"foreman-info-value foreman-info-link",children:r.client_phone})]})]}),s.jsxs("div",{className:"foreman-stats",children:[s.jsxs("div",{className:"foreman-stat",children:[s.jsx("div",{className:"foreman-stat-value working",children:W}),s.jsx("div",{className:"foreman-stat-label",children:"Working"})]}),s.jsxs("div",{className:"foreman-stat",children:[s.jsx("div",{className:"foreman-stat-value done",children:Q}),s.jsx("div",{className:"foreman-stat-label",children:"Done"})]}),s.jsxs("div",{className:"foreman-stat",children:[s.jsx("div",{className:"foreman-stat-value remaining",children:be}),s.jsx("div",{className:"foreman-stat-label",children:"Remaining"})]})]}),s.jsxs("div",{className:"foreman-tabs",children:[s.jsxs("button",{className:`foreman-tab ${Te==="actions"?"active":""}`,onClick:()=>Ae("actions"),children:[s.jsx(Xc,{size:18}),"Actions"]}),s.jsxs("button",{className:`foreman-tab ${Te==="progress"?"active":""}`,onClick:()=>Ae("progress"),children:[s.jsx(Og,{size:18}),"Progress"]})]}),Te==="actions"&&s.jsxs("div",{className:"field-actions",children:[s.jsxs("button",{className:"field-action-btn",onClick:()=>Z(!0),children:[s.jsx(un,{size:22}),"Crew Check-in"]}),s.jsxs("button",{className:"field-action-btn",onClick:()=>P(!0),children:[s.jsx(ji,{size:22}),"T&M Ticket"]}),s.jsxs("button",{className:"field-action-btn",onClick:()=>ee(!0),children:[s.jsx(Vc,{size:22}),"Disposal Loads"]}),s.jsxs("button",{className:"field-action-btn",onClick:()=>de(!0),children:[s.jsx(Bm,{size:22}),"Daily Report"]}),s.jsxs("button",{className:"field-action-btn danger",onClick:()=>Se(!0),children:[s.jsx(Pc,{size:22}),"Report Injury"]})]}),Te==="progress"&&s.jsxs("div",{className:"foreman-areas",children:[ve?Object.entries(ge).map(([Y,ye])=>s.jsxs("div",{className:"foreman-group",children:[s.jsxs("div",{className:"foreman-group-header",onClick:()=>U(Y),children:[s.jsxs("div",{className:"foreman-group-title",children:[s.jsx("span",{className:"foreman-group-arrow",children:k[Y]?"":""}),s.jsx("span",{className:"foreman-group-name",children:Y})]}),s.jsx("span",{className:"foreman-group-progress",children:D(ye)})]}),k[Y]&&s.jsx("div",{className:"foreman-group-tasks",children:ye.map(J=>s.jsxs("div",{className:`foreman-area-card ${J.status}`,children:[s.jsx("div",{className:"foreman-area-name",children:J.name}),s.jsxs("div",{className:"foreman-area-buttons",children:[s.jsx("button",{className:`foreman-btn working ${J.status==="working"?"active":""}`,onClick:()=>Le(J.id,"working"),disabled:S===J.id,children:S===J.id?"...":"Working"}),s.jsx("button",{className:`foreman-btn done ${J.status==="done"?"active":""}`,onClick:()=>Le(J.id,"done"),disabled:S===J.id,children:S===J.id?"...":"Done"})]})]},J.id))})]},Y)):d.map(Y=>s.jsxs("div",{className:`foreman-area-card ${Y.status}`,children:[s.jsx("div",{className:"foreman-area-name",children:Y.name}),s.jsxs("div",{className:"foreman-area-buttons",children:[s.jsx("button",{className:`foreman-btn working ${Y.status==="working"?"active":""}`,onClick:()=>Le(Y.id,"working"),disabled:S===Y.id,children:S===Y.id?"...":"Working"}),s.jsx("button",{className:`foreman-btn done ${Y.status==="done"?"active":""}`,onClick:()=>Le(Y.id,"done"),disabled:S===Y.id,children:S===Y.id?"...":"Done"})]})]},Y.id)),d.length===0&&s.jsxs("div",{className:"foreman-empty",children:[s.jsx(Bm,{size:48,className:"foreman-empty-icon"}),s.jsx("div",{className:"foreman-empty-text",children:"No areas yet"}),s.jsx("div",{className:"foreman-empty-subtext",children:"Office needs to add areas to this project"})]})]})]})}const v_=w.lazy(()=>dn(()=>import("./Dashboard--rMfOrwH.js"),__vite__mapDeps([6,1,2,0,3,4,7,8]))),b_=w.lazy(()=>dn(()=>import("./Setup-B9tx7_z2.js"),__vite__mapDeps([9,1,2,7,3,4]))),j_=w.lazy(()=>dn(()=>import("./BrandingSettings-CacmWlwj.js"),__vite__mapDeps([10,1,2,3,4]))),S_=w.lazy(()=>dn(()=>import("./PricingManager-Djx3V_Iy.js"),__vite__mapDeps([11,1,2,3,4]))),x_=w.lazy(()=>dn(()=>import("./PublicView-DpuF1TC1.js"),__vite__mapDeps([12,1,2,3,4]))),w_=w.lazy(()=>dn(()=>import("./SignaturePage-CyUCLw_n.js"),__vite__mapDeps([13,1,2,8,3,4]))),N_=w.lazy(()=>dn(()=>import("./MembershipManager-oTgnc-E1.js"),__vite__mapDeps([14,1,2,3,4])));function Qc(){return s.jsxs("div",{className:"page-loader",children:[s.jsx(ga,{className:"loading-logo"}),s.jsx("div",{className:"spinner"})]})}function E_(){const[r,l]=w.useState("entry"),[i,c]=w.useState(null),[d,f]=w.useState(null),[p,y]=w.useState([]),[S,z]=w.useState([]),[k,M]=w.useState(null),[F,P]=w.useState(null),[$,Z]=w.useState(null),[oe,ee]=w.useState(!0),[me,de]=w.useState("dashboard"),[se,Se]=w.useState(null),[Me,Ve]=w.useState(!1),[Te,Ae]=w.useState(!1),[it,Le]=w.useState(null),[U,re]=w.useState(0);w.useEffect(()=>{const ae=window.location.pathname,we=ae.match(/^\/view\/([a-zA-Z0-9_-]+)$/),Je=ae.match(/^\/sign\/([a-zA-Z0-9_-]+)$/);we?(P(we[1]),l("public"),ee(!1)):Je?(Z(Je[1]),l("signature"),ee(!1)):ge()},[]),w.useEffect(()=>{if(!v)return;const{data:{subscription:ae}}=_.auth.onAuthStateChange(async(we,Je)=>{we==="SIGNED_OUT"||we==="USER_DELETED"?(c(null),f(null),y([]),l("entry")):we==="TOKEN_REFRESHED"||we==="SIGNED_IN"&&!i&&ge()});return()=>{ae?.unsubscribe()}},[i]);const ge=async()=>{try{if(!v){ee(!1);return}const{data:{user:ae}}=await _.auth.getUser();if(!ae){ee(!1);return}const{data:we,error:Je}=await _.from("users").select("*").eq("id",ae.id).single();if(we){c(we);let Re=await _e.getUserCompanies(ae.id);if(Re.length===0&&we.company_id&&await _e.repairLegacyUser(ae.id,we.company_id,we.role||"member")&&(Re=await _e.getUserCompanies(ae.id)),y(Re),Re.length===0){if(await _e.getUserPendingMemberships(ae.id)>0){l("pending");return}Y("No company access. Join a company to continue.","error"),await Wc.signOut();return}const nt=localStorage.getItem("selectedCompanyId");let wt=null;if(nt&&Re.find(Xe=>Xe.id===nt)?wt=Re.find(Xe=>Xe.id===nt):Re.length>0&&(wt=Re[0]),wt){const{data:Xe}=await _.from("companies").select("*").eq("id",wt.id).single();f(Xe),l("office")}}}catch(ae){console.error("Auth check error:",ae)}finally{ee(!1)}},ve=ae=>{M(ae),l("foreman")},D=async(ae,we)=>{try{const{data:Je,error:Re}=await _.auth.signInWithPassword({email:ae,password:we});if(Re){Y(Re.message||"Invalid credentials","error");return}const{data:nt,error:wt}=await _.from("users").select("*").eq("id",Je.user.id).single();if(wt){console.error("User fetch error:",wt),Y("Error loading profile","error");return}if(nt){c(nt);let Xe=await _e.getUserCompanies(Je.user.id);Xe.length===0&&nt.company_id&&await _e.repairLegacyUser(Je.user.id,nt.company_id,nt.role||"member")&&(Xe=await _e.getUserCompanies(Je.user.id)),y(Xe);const na=localStorage.getItem("selectedCompanyId");let ot=null;if(na&&Xe.find(Nt=>Nt.id===na)?ot=Xe.find(Nt=>Nt.id===na):Xe.length>0&&(ot=Xe[0]),ot){const{data:Nt}=await _.from("companies").select("*").eq("id",ot.id).single();f(Nt),l("office")}else await _e.getUserPendingMemberships(Je.user.id)>0?l("pending"):Y("No company access. Please contact admin.","error")}else Y("Profile not found. Please contact admin.","error")}catch(Je){console.error("Login error:",Je),Y("Login failed","error")}},Q=async ae=>{try{const{data:we}=await _.from("companies").select("*").eq("id",ae).single();we&&(f(we),localStorage.setItem("selectedCompanyId",ae),Ve(!1),de("dashboard"),Y(`Switched to ${we.name}`,"success"))}catch(we){console.error("Switch company error:",we),Y("Error switching company","error")}},W=async()=>{try{await Wc.signOut(),c(null),f(null),y([]),l("entry"),de("dashboard"),localStorage.removeItem("selectedCompanyId")}catch(ae){console.error("Logout error:",ae),Y("Error signing out","error")}},be=async()=>{await oh(),M(null),l("entry")},Y=w.useCallback((ae,we="")=>{Se({message:ae,type:we})},[]),ye=()=>{de("dashboard"),d?.id&&J()},J=async()=>{if(d?.id)try{const ae=await _e.getProjects(d.id);z(ae)}catch(ae){console.error("Error loading projects:",ae)}};w.useEffect(()=>{d?.id&&r==="office"&&(J(),he())},[d?.id,r]);const he=async()=>{if(d?.id)try{const we=(await _e.getCompanyMemberships(d.id)).filter(Je=>Je.status==="pending").length;re(we)}catch(ae){console.error("Error loading pending count:",ae)}},Ne=w.useCallback(()=>{Le(null)},[]);if(oe)return s.jsx(dr,{children:s.jsx(ur,{companyId:d?.id,children:s.jsxs("div",{className:"loading-screen",children:[s.jsx(ga,{className:"loading-logo"}),s.jsx("div",{className:"spinner"})]})})});if(r==="entry")return s.jsx(dr,{children:s.jsxs(ur,{children:[s.jsx(Pr,{children:s.jsx(l_,{onForemanAccess:ve,onOfficeLogin:D,onShowToast:Y})}),se&&s.jsx(fr,{message:se.message,type:se.type,onClose:()=>Se(null)})]})});if(r==="public"&&F)return s.jsx(dr,{children:s.jsxs(ur,{children:[s.jsx(Pr,{children:s.jsx(w.Suspense,{fallback:s.jsx(Qc,{}),children:s.jsx(x_,{shareToken:F})})}),se&&s.jsx(fr,{message:se.message,type:se.type,onClose:()=>Se(null)})]})});if(r==="signature"&&$)return s.jsx(dr,{children:s.jsxs(ur,{children:[s.jsx(Pr,{children:s.jsx(w.Suspense,{fallback:s.jsx(Qc,{}),children:s.jsx(w_,{signatureToken:$})})}),se&&s.jsx(fr,{message:se.message,type:se.type,onClose:()=>Se(null)})]})});if(r==="pending")return s.jsx(dr,{children:s.jsxs(ur,{children:[s.jsx(Pr,{children:s.jsxs("div",{className:"pending-approval-screen",children:[s.jsx(ga,{className:"pending-logo"}),s.jsx("h2",{children:"Awaiting Approval"}),s.jsx("p",{children:"Your membership request has been submitted."}),s.jsx("p",{children:"A company admin will review your request."}),s.jsxs("div",{className:"pending-actions",children:[s.jsx("button",{className:"btn btn-secondary",onClick:W,children:"Sign Out"}),s.jsx("button",{className:"btn btn-primary",onClick:ge,children:"Check Status"})]})]})}),se&&s.jsx(fr,{message:se.message,type:se.type,onClose:()=>Se(null)})]})});if(r==="foreman"&&k)return s.jsx(dr,{children:s.jsxs(ur,{companyId:k.company_id,children:[s.jsx(Pr,{children:s.jsx(y_,{project:k,companyId:k.company_id,onShowToast:Y,onExit:be})}),s.jsx(Im,{}),se&&s.jsx(fr,{message:se.message,type:se.type,onClose:()=>Se(null)})]})});const He=p.find(ae=>ae.id===d?.id)?.access_level==="administrator"||d?.owner_user_id===i?.id;return s.jsx(dr,{children:s.jsx(ur,{companyId:d?.id,children:s.jsxs("div",{children:[!v&&s.jsx("div",{className:"demo-banner",children:"Demo Mode - Data saved locally in your browser"}),s.jsx("nav",{className:"nav",children:s.jsxs("div",{className:"nav-content",children:[s.jsx(ga,{}),s.jsxs("div",{className:"nav-tabs nav-tabs-desktop",children:[s.jsx("button",{className:`nav-tab ${me==="dashboard"?"active":""}`,onClick:()=>de("dashboard"),children:"Dashboard"}),s.jsx("button",{className:`nav-tab ${me==="setup"?"active":""}`,onClick:()=>de("setup"),children:"+ New Project"}),s.jsx("button",{className:`nav-tab ${me==="pricing"?"active":""}`,onClick:()=>de("pricing"),children:"Pricing"}),He&&s.jsx("button",{className:`nav-tab ${me==="branding"?"active":""}`,onClick:()=>de("branding"),children:"Branding"}),He&&s.jsxs("button",{className:`nav-tab ${me==="team"?"active":""}`,onClick:()=>de("team"),children:["Team",U>0&&s.jsx("span",{className:"nav-tab-badge",children:U})]})]}),s.jsxs("div",{className:"nav-user nav-user-desktop",children:[s.jsx($c,{compact:!0}),s.jsxs("div",{className:"mobile-menu",children:[s.jsx("button",{className:"mobile-menu-btn",onClick:()=>Ae(!Te),"aria-label":"User menu",children:""}),Te&&s.jsxs("div",{className:"mobile-menu-dropdown",children:[s.jsxs("div",{className:"mobile-menu-info",children:[s.jsx("div",{className:"mobile-menu-user",children:i?.name||i?.email}),d&&s.jsx("div",{className:"mobile-menu-company",children:d.name})]}),s.jsx("button",{className:"mobile-menu-logout",onClick:()=>{Ae(!1),W()},children:"Sign Out"})]})]}),p.length>1&&s.jsxs("div",{className:"company-switcher",children:[s.jsxs("button",{className:"company-switcher-btn",onClick:()=>Ve(!Me),children:[d?.name||"Select Company",s.jsx("span",{className:"switcher-arrow",children:""})]}),Me&&s.jsx("div",{className:"company-dropdown",children:p.map(ae=>s.jsxs("button",{className:`company-option ${ae.id===d?.id?"active":""}`,onClick:()=>Q(ae.id),children:[ae.name,ae.id===d?.id&&s.jsx("span",{className:"check",children:""})]},ae.id))})]}),p.length<=1&&d&&s.jsx("span",{className:"nav-company-name",children:d.name}),s.jsx("span",{className:"nav-user-name",children:i?.name||i?.email}),s.jsx("button",{className:"nav-logout",onClick:W,children:"Sign Out"})]}),s.jsx("button",{className:"mobile-menu-btn",onClick:()=>Ae(!0),"aria-label":"Open menu",children:s.jsxs("span",{className:"hamburger-icon",children:[s.jsx("span",{}),s.jsx("span",{}),s.jsx("span",{})]})})]})}),Te&&s.jsx("div",{className:"mobile-drawer-overlay",onClick:()=>Ae(!1),children:s.jsxs("div",{className:"mobile-drawer",onClick:ae=>ae.stopPropagation(),children:[s.jsxs("div",{className:"mobile-drawer-header",children:[s.jsx(ga,{}),s.jsx("button",{className:"mobile-drawer-close",onClick:()=>Ae(!1),"aria-label":"Close menu",children:""})]}),s.jsxs("div",{className:"mobile-drawer-user",children:[s.jsx("div",{className:"mobile-user-avatar",children:(i?.name||i?.email||"U")[0].toUpperCase()}),s.jsxs("div",{className:"mobile-user-info",children:[s.jsx("span",{className:"mobile-user-name",children:i?.name||i?.email}),s.jsx("span",{className:"mobile-user-company",children:d?.name})]})]}),p.length>1&&s.jsxs("div",{className:"mobile-drawer-section",children:[s.jsx("div",{className:"mobile-section-title",children:"Switch Company"}),s.jsx("div",{className:"mobile-company-list",children:p.map(ae=>s.jsxs("button",{className:`mobile-company-option ${ae.id===d?.id?"active":""}`,onClick:()=>{Q(ae.id),Ae(!1)},children:[s.jsx("span",{className:"mobile-company-name",children:ae.name}),ae.id===d?.id&&s.jsx("span",{className:"mobile-company-check",children:""})]},ae.id))})]}),s.jsxs("div",{className:"mobile-drawer-section",children:[s.jsx("div",{className:"mobile-section-title",children:"Navigation"}),s.jsxs("div",{className:"mobile-nav-list",children:[s.jsx("button",{className:`mobile-nav-item ${me==="dashboard"?"active":""}`,onClick:()=>{de("dashboard"),Ae(!1)},children:"Dashboard"}),s.jsx("button",{className:`mobile-nav-item ${me==="setup"?"active":""}`,onClick:()=>{de("setup"),Ae(!1)},children:"+ New Project"}),s.jsx("button",{className:`mobile-nav-item ${me==="pricing"?"active":""}`,onClick:()=>{de("pricing"),Ae(!1)},children:"Pricing"}),He&&s.jsx("button",{className:`mobile-nav-item ${me==="branding"?"active":""}`,onClick:()=>{de("branding"),Ae(!1)},children:"Branding"}),He&&s.jsxs("button",{className:`mobile-nav-item ${me==="team"?"active":""}`,onClick:()=>{de("team"),Ae(!1)},children:["Team",U>0&&s.jsx("span",{className:"mobile-nav-badge",children:U})]})]})]}),s.jsxs("div",{className:"mobile-drawer-section",children:[s.jsx("div",{className:"mobile-section-title",children:"Appearance"}),s.jsx("div",{className:"mobile-theme-toggle",children:s.jsx($c,{})})]}),s.jsx("div",{className:"mobile-drawer-footer",children:s.jsx("button",{className:"mobile-logout-btn",onClick:()=>{W(),Ae(!1)},children:"Sign Out"})})]})}),s.jsx(Pr,{children:s.jsx(w.Suspense,{fallback:s.jsx(Qc,{}),children:s.jsxs("div",{className:"container",children:[me==="dashboard"&&s.jsx(v_,{company:d,user:i,isAdmin:He,onShowToast:Y,navigateToProjectId:it,onProjectNavigated:Ne}),me==="setup"&&s.jsx(b_,{company:d,user:i,onProjectCreated:ye,onShowToast:Y}),me==="pricing"&&s.jsx(S_,{company:d,onShowToast:Y}),me==="branding"&&s.jsx(j_,{company:d,onShowToast:Y}),me==="team"&&He&&s.jsx(N_,{company:d,user:i,onShowToast:Y})]},d?.id)})}),s.jsx(Im,{}),se&&s.jsx(fr,{message:se.message,type:se.type,onClose:()=>Se(null)})]})})})}Xg.createRoot(document.getElementById("root")).render(s.jsx(kg.StrictMode,{children:s.jsx(E_,{})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(r=>{setInterval(()=>{r.update().catch(()=>{})},3e5)}).catch(()=>{})});export{p_ as I,ga as L,fr as T,n_ as a,M_ as b,k_ as c,_e as d,a_ as e,O_ as f,R_ as g,U_ as h,o_ as i,s as j,z_ as k,H_ as l,A_ as m,Ce as o,_ as s,r_ as u};
//# sourceMappingURL=index-q3-km2tx.js.map
