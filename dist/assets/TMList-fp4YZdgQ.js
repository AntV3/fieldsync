import{j as e,u as Da,d as Z,k as At,l as Ma}from"./index-CIwxO8rl.js";import{r as c,t as wt,c as Ba,Q as za,a0 as Ra,a as La,j as Vt,F as dt,K as $a,ah as Ot,f as Et,T as Ha,H as Wa,W as qa,g as Ka,ai as Va,R as Ua,a5 as Ga,aj as Ya,w as Za,y as Ja,q as Xa,x as Ft,X as Qa}from"./icons-_xHNNQgF.js";import es from"./SignatureLinkGenerator-BxK2WO4a.js";import{i as ts,a as We,g as it,b as lt,c as as,d as Dt,S as ss,e as de,s as rs,f as ns,h as ke,j as is,k as ve,l as ye,m as xe,n as _e,o as Ut,p as Gt,q as Yt,r as ls,t as os,u as Mt,v as cs,w as Bt,x as ds,L as Re,y as us,z as ms,D as ut,A as Zt,R as hs,B as ps,C as vs,Z as mt,E as Jt,F as xs,G as gs,H as fs,I as bs,J as Xt,K as Le,M as Qt,N as js,O as ys,P as _s,Q as ks,T as zt,U as ea,V as ta,W as aa,X as sa,Y as Ns,_ as ra,$ as Cs,a0 as Ss,a1 as ce,a2 as Ts,a3 as Is,a4 as Ps,a5 as As,a6 as ws,a7 as Rt,a8 as Os,a9 as Es,aa as rt,ab as Fs,ac as Ds,ad as nt,ae as Ms,af as Lt,ag as $t,ah as Bs,ai as zs,aj as na,ak as Rs}from"./Dashboard-XcnGyZ-w.js";import{utils as pe,writeFile as Ls}from"./xlsx-BvJTHLik.js";import{E as $s,a as Ht}from"./pdf-ChZ1zkDw.js";import"./react-DXGY7bZi.js";import"./supabase-VuevzHjS.js";import"./corCalculations-D9qkkIbo.js";var Wt=(t,a,s)=>{var n=s??t;if(!We(n))return it(n,a,0)},Hs=(t,a,s)=>{var n={},o=t.filter(ts),l=t.filter(x=>x.stackId==null),d=o.reduce((x,_)=>(x[_.stackId]||(x[_.stackId]=[]),x[_.stackId].push(_),x),n),m=Object.entries(d).map(x=>{var[_,N]=x,C=N.map(w=>w.dataKey),y=Wt(a,s,N[0].barSize);return{stackId:_,dataKeys:C,barSize:y}}),g=l.map(x=>{var _=[x.dataKey].filter(C=>C!=null),N=Wt(a,s,x.barSize);return{stackId:void 0,dataKeys:_,barSize:N}});return[...m,...g]};function qt(t,a){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);a&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),s.push.apply(s,n)}return s}function ze(t){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?arguments[a]:{};a%2?qt(Object(s),!0).forEach(function(n){Ws(t,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):qt(Object(s)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(s,n))})}return t}function Ws(t,a,s){return(a=qs(a))in t?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s,t}function qs(t){var a=Ks(t,"string");return typeof a=="symbol"?a:a+""}function Ks(t,a){if(typeof t!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var n=s.call(t,a);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}function Vs(t,a,s,n,o){var l=n.length;if(!(l<1)){var d=it(t,s,0,!0),m,g=[];if(lt(n[0].barSize)){var x=!1,_=s/l,N=n.reduce((f,k)=>f+(k.barSize||0),0);N+=(l-1)*d,N>=s&&(N-=(l-1)*d,d=0),N>=s&&_>0&&(x=!0,_*=.9,N=l*_);var C=(s-N)/2>>0,y={offset:C-d,size:0};m=n.reduce((f,k)=>{var L,A={stackId:k.stackId,dataKeys:k.dataKeys,position:{offset:y.offset+y.size+d,size:x?_:(L=k.barSize)!==null&&L!==void 0?L:0}},B=[...f,A];return y=B[B.length-1].position,B},g)}else{var w=it(a,s,0,!0);s-2*w-(l-1)*d<=0&&(d=0);var P=(s-2*w-(l-1)*d)/l;P>1&&(P>>=0);var F=lt(o)?Math.min(P,o):P;m=n.reduce((f,k,L)=>[...f,{stackId:k.stackId,dataKeys:k.dataKeys,position:{offset:w+(P+d)*L+(P-F)/2,size:F}}],g)}return m}}var Us=(t,a,s,n,o,l,d)=>{var m=We(d)?a:d,g=Vs(s,n,o!==l?o:l,t,m);return o!==l&&g!=null&&(g=g.map(x=>ze(ze({},x),{},{position:ze(ze({},x.position),{},{offset:x.position.offset-o/2})}))),g},Gs=(t,a)=>{var s=as(a);if(!(!t||s==null||a==null)){var{stackId:n}=a;if(n!=null){var o=t[n];if(o){var{stackedData:l}=o;if(l)return l.find(d=>d.key===s)}}}};function Ys(t,a){return t&&typeof t=="object"&&"zIndex"in t&&typeof t.zIndex=="number"&&lt(t.zIndex)?t.zIndex:a}var Zs=["children"];function Js(t,a){if(t==null)return{};var s,n,o=Xs(t,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)s=l[n],a.indexOf(s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(o[s]=t[s])}return o}function Xs(t,a){if(t==null)return{};var s={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(a.indexOf(n)!==-1)continue;s[n]=t[n]}return s}var Qs={data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0},er=c.createContext(Qs);function tr(t){var{children:a}=t,s=Js(t,Zs);return c.createElement(er.Provider,{value:s},a)}var ar="Invariant failed";function sr(t,a){throw new Error(ar)}function ot(){return ot=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var n in s)({}).hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},ot.apply(null,arguments)}function $e(t){return c.createElement(ss,ot({shapeType:"rectangle",activeClassName:"recharts-active-bar"},t))}var rr=function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return(n,o)=>{if(Dt(a))return a;var l=Dt(n)||We(n);return l?a(n,o):(l||sr(),s)}},nr=(t,a,s)=>s,ir=(t,a)=>a,Oe=de([Gt,ir],(t,a)=>t.filter(s=>s.type==="bar").find(s=>s.id===a)),lr=de([Oe],t=>t?.maxBarSize),or=(t,a,s,n)=>n,cr=de([ke,Gt,ve,xe,nr],(t,a,s,n,o)=>a.filter(l=>t==="horizontal"?l.xAxisId===s:l.yAxisId===n).filter(l=>l.isPanorama===o).filter(l=>l.hide===!1).filter(l=>l.type==="bar")),dr=(t,a,s)=>{var n=ke(t),o=ve(t,a),l=xe(t,a);if(!(o==null||l==null))return n==="horizontal"?Mt(t,"yAxis",l,s):Mt(t,"xAxis",o,s)},ur=(t,a)=>{var s=ke(t),n=ve(t,a),o=xe(t,a);if(!(n==null||o==null))return s==="horizontal"?Bt(t,"xAxis",n):Bt(t,"yAxis",o)},mr=de([cr,cs,ur],Hs),hr=(t,a,s)=>{var n,o,l=Oe(t,a);if(l!=null){var d=ve(t,a),m=xe(t,a);if(!(d==null||m==null)){var g=ke(t),x=Yt(t),{maxBarSize:_}=l,N=We(_)?x:_,C,y;return g==="horizontal"?(C=ye(t,"xAxis",d,s),y=_e(t,"xAxis",d,s)):(C=ye(t,"yAxis",m,s),y=_e(t,"yAxis",m,s)),(n=(o=Ut(C,y,!0))!==null&&o!==void 0?o:N)!==null&&n!==void 0?n:0}}},ia=(t,a,s)=>{var n=ke(t),o=ve(t,a),l=xe(t,a);if(!(o==null||l==null)){var d,m;return n==="horizontal"?(d=ye(t,"xAxis",o,s),m=_e(t,"xAxis",o,s)):(d=ye(t,"yAxis",l,s),m=_e(t,"yAxis",l,s)),Ut(d,m)}},pr=de([mr,Yt,ls,os,hr,ia,lr],Us),vr=(t,a,s)=>{var n=ve(t,a);if(n!=null)return ye(t,"xAxis",n,s)},xr=(t,a,s)=>{var n=xe(t,a);if(n!=null)return ye(t,"yAxis",n,s)},gr=(t,a,s)=>{var n=ve(t,a);if(n!=null)return _e(t,"xAxis",n,s)},fr=(t,a,s)=>{var n=xe(t,a);if(n!=null)return _e(t,"yAxis",n,s)},br=de([pr,Oe],(t,a)=>{if(!(t==null||a==null)){var s=t.find(n=>n.stackId===a.stackId&&a.dataKey!=null&&n.dataKeys.includes(a.dataKey));if(s!=null)return s.position}}),jr=de([dr,Oe],Gs),yr=de([rs,ns,vr,xr,gr,fr,br,ke,is,ia,jr,Oe,or],(t,a,s,n,o,l,d,m,g,x,_,N,C)=>{var{chartData:y,dataStartIndex:w,dataEndIndex:P}=g;if(!(N==null||d==null||a==null||m!=="horizontal"&&m!=="vertical"||s==null||n==null||o==null||l==null||x==null)){var{data:F}=N,f;if(F!=null&&F.length>0?f=F:f=y?.slice(w,P+1),f!=null)return Zr({layout:m,barSettings:N,pos:d,parentViewBox:a,bandSize:x,xAxis:s,yAxis:n,xAxisTicks:o,yAxisTicks:l,stackedData:_,displayedData:f,offset:t,cells:C,dataStartIndex:w})}}),_r=["index"];function ct(){return ct=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var n in s)({}).hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},ct.apply(null,arguments)}function kr(t,a){if(t==null)return{};var s,n,o=Nr(t,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)s=l[n],a.indexOf(s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(o[s]=t[s])}return o}function Nr(t,a){if(t==null)return{};var s={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(a.indexOf(n)!==-1)continue;s[n]=t[n]}return s}var la=c.createContext(void 0),Cr=t=>{var a=c.useContext(la);if(a!=null)return a.stackId;if(t!=null)return ds(t)},Sr=(t,a)=>"recharts-bar-stack-clip-path-".concat(t,"-").concat(a),Tr=t=>{var a=c.useContext(la);if(a!=null){var{stackId:s}=a;return"url(#".concat(Sr(s,t),")")}},Ir=t=>{var{index:a}=t,s=kr(t,_r),n=Tr(a);return c.createElement(Re,ct({className:"recharts-bar-stack-layer",clipPath:n},s))},Pr=["onMouseEnter","onMouseLeave","onClick"],Ar=["value","background","tooltipPosition"],wr=["id"],Or=["onMouseEnter","onClick","onMouseLeave"];function re(){return re=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var n in s)({}).hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},re.apply(null,arguments)}function Kt(t,a){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);a&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),s.push.apply(s,n)}return s}function G(t){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?arguments[a]:{};a%2?Kt(Object(s),!0).forEach(function(n){Er(t,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Kt(Object(s)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(s,n))})}return t}function Er(t,a,s){return(a=Fr(a))in t?Object.defineProperty(t,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[a]=s,t}function Fr(t){var a=Dr(t,"string");return typeof a=="symbol"?a:a+""}function Dr(t,a){if(typeof t!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var n=s.call(t,a);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(t)}function He(t,a){if(t==null)return{};var s,n,o=Mr(t,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(n=0;n<l.length;n++)s=l[n],a.indexOf(s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(o[s]=t[s])}return o}function Mr(t,a){if(t==null)return{};var s={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(a.indexOf(n)!==-1)continue;s[n]=t[n]}return s}var Br=t=>{var{dataKey:a,name:s,fill:n,legendType:o,hide:l}=t;return[{inactive:l,dataKey:a,type:o,color:n,value:Jt(s,a),payload:t}]},zr=c.memo(t=>{var{dataKey:a,stroke:s,strokeWidth:n,fill:o,name:l,hide:d,unit:m,tooltipType:g,id:x}=t,_={dataDefinedOnItem:void 0,positions:void 0,settings:{stroke:s,strokeWidth:n,fill:o,dataKey:a,nameKey:void 0,name:Jt(l,a),hide:d,type:g,color:o,unit:m,graphicalItemId:x}};return c.createElement(xs,{tooltipEntrySettings:_})});function Rr(t){var a=Le(ea),{data:s,dataKey:n,background:o,allOtherBarProps:l}=t,{onMouseEnter:d,onMouseLeave:m,onClick:g}=l,x=He(l,Pr),_=ta(d,n,l.id),N=aa(m),C=sa(g,n,l.id);if(!o||s==null)return null;var y=Ns(o);return c.createElement(mt,{zIndex:Ys(o,ut.barBackground)},s.map((w,P)=>{var{value:F,background:f,tooltipPosition:k}=w,L=He(w,Ar);if(!f)return null;var A=_(w,P),B=N(w,P),h=C(w,P),q=G(G(G(G(G({option:o,isActive:String(P)===a},L),{},{fill:"#eee"},f),y),ra(x,w,P)),{},{onMouseEnter:A,onMouseLeave:B,onClick:h,dataKey:n,index:P,className:"recharts-bar-background-rectangle"});return c.createElement($e,re({key:"background-bar-".concat(P)},q))}))}function Lr(t){var{showLabels:a,children:s,rects:n}=t,o=n?.map(l=>{var d={x:l.x,y:l.y,width:l.width,lowerWidth:l.width,upperWidth:l.width,height:l.height};return G(G({},d),{},{value:l.value,payload:l.payload,parentViewBox:l.parentViewBox,viewBox:d,fill:l.fill})});return c.createElement(Is,{value:a?o:void 0},s)}function $r(t){var{shape:a,activeBar:s,baseProps:n,entry:o,index:l,dataKey:d}=t,m=Le(ea),g=Le(As),x=s&&String(l)===m&&(g==null||d===g),_=x?s:a;return x?c.createElement(mt,{zIndex:ut.activeBar},c.createElement($e,re({},n,{name:String(n.name)},o,{isActive:x,option:_,index:l,dataKey:d}))):c.createElement($e,re({},n,{name:String(n.name)},o,{isActive:x,option:_,index:l,dataKey:d}))}function Hr(t){var{shape:a,baseProps:s,entry:n,index:o,dataKey:l}=t;return c.createElement($e,re({},s,{name:String(s.name)},n,{isActive:!1,option:a,index:o,dataKey:l}))}function Wr(t){var a,{data:s,props:n}=t,o=(a=Ps(n))!==null&&a!==void 0?a:{},{id:l}=o,d=He(o,wr),{shape:m,dataKey:g,activeBar:x}=n,{onMouseEnter:_,onClick:N,onMouseLeave:C}=n,y=He(n,Or),w=ta(_,g,l),P=aa(C),F=sa(N,g,l);return s?c.createElement(c.Fragment,null,s.map((f,k)=>c.createElement(Ir,re({index:k,key:"rectangle-".concat(f?.x,"-").concat(f?.y,"-").concat(f?.value,"-").concat(k),className:"recharts-bar-rectangle"},ra(y,f,k),{onMouseEnter:w(f,k),onMouseLeave:P(f,k),onClick:F(f,k)}),x?c.createElement($r,{shape:m,activeBar:x,baseProps:d,entry:f,index:k,dataKey:g}):c.createElement(Hr,{shape:m,baseProps:d,entry:f,index:k,dataKey:g})))):null}function qr(t){var{props:a,previousRectanglesRef:s}=t,{data:n,layout:o,isAnimationActive:l,animationBegin:d,animationDuration:m,animationEasing:g,onAnimationEnd:x,onAnimationStart:_}=a,N=s.current,C=Cs(a,"recharts-bar-"),[y,w]=c.useState(!1),P=!y,F=c.useCallback(()=>{typeof x=="function"&&x(),w(!1)},[x]),f=c.useCallback(()=>{typeof _=="function"&&_(),w(!0)},[_]);return c.createElement(Lr,{showLabels:P,rects:n},c.createElement(Ss,{animationId:C,begin:d,duration:m,isActive:l,easing:g,onAnimationEnd:F,onAnimationStart:f,key:C},k=>{var L=k===1?n:n?.map((A,B)=>{var h=N&&N[B];if(h)return G(G({},A),{},{x:ce(h.x,A.x,k),y:ce(h.y,A.y,k),width:ce(h.width,A.width,k),height:ce(h.height,A.height,k)});if(o==="horizontal"){var q=ce(0,A.height,k),V=ce(A.stackedBarStart,A.y,k);return G(G({},A),{},{y:V,height:q})}var R=ce(0,A.width,k),M=ce(A.stackedBarStart,A.x,k);return G(G({},A),{},{width:R,x:M})});return k>0&&(s.current=L??null),L==null?null:c.createElement(Re,null,c.createElement(Wr,{props:a,data:L}))}),c.createElement(Ts,{label:a.label}),a.children)}function Kr(t){var a=c.useRef(null);return c.createElement(qr,{previousRectanglesRef:a,props:t})}var oa=0,Vr=(t,a)=>{var s=Array.isArray(t.value)?t.value[1]:t.value;return{x:t.x,y:t.y,value:s,errorVal:Qt(t,a)}};class Ur extends c.PureComponent{render(){var{hide:a,data:s,dataKey:n,className:o,xAxisId:l,yAxisId:d,needClip:m,background:g,id:x}=this.props;if(a||s==null)return null;var _=js("recharts-bar",o),N=x;return c.createElement(Re,{className:_,id:x},m&&c.createElement("defs",null,c.createElement(ys,{clipPathId:N,xAxisId:l,yAxisId:d})),c.createElement(Re,{className:"recharts-bar-rectangles",clipPath:m?"url(#clipPath-".concat(N,")"):void 0},c.createElement(Rr,{data:s,dataKey:n,background:g,allOtherBarProps:this.props}),c.createElement(Kr,this.props)))}}var Gr={activeBar:!1,animationBegin:0,animationDuration:400,animationEasing:"ease",background:!1,hide:!1,isAnimationActive:"auto",label:!1,legendType:"rect",minPointSize:oa,xAxisId:0,yAxisId:0,zIndex:ut.bar};function Yr(t){var{xAxisId:a,yAxisId:s,hide:n,legendType:o,minPointSize:l,activeBar:d,animationBegin:m,animationDuration:g,animationEasing:x,isAnimationActive:_}=t,{needClip:N}=gs(a,s),C=fs(),y=Zt(),w=bs(t.children,Xt),P=Le(k=>yr(k,t.id,y,w));if(C!=="vertical"&&C!=="horizontal")return null;var F,f=P?.[0];return f==null||f.height==null||f.width==null?F=0:F=C==="vertical"?f.height/2:f.width/2,c.createElement(tr,{xAxisId:a,yAxisId:s,data:P,dataPointFormatter:Vr,errorBarOffset:F},c.createElement(Ur,re({},t,{layout:C,needClip:N,data:P,xAxisId:a,yAxisId:s,hide:n,legendType:o,minPointSize:l,activeBar:d,animationBegin:m,animationDuration:g,animationEasing:x,isAnimationActive:_})))}function Zr(t){var{layout:a,barSettings:{dataKey:s,minPointSize:n},pos:o,bandSize:l,xAxis:d,yAxis:m,xAxisTicks:g,yAxisTicks:x,stackedData:_,displayedData:N,offset:C,cells:y,parentViewBox:w,dataStartIndex:P}=t,F=a==="horizontal"?m:d,f=_?F.scale.domain():null,k=_s({numericAxis:F}),L=F.scale(k);return N.map((A,B)=>{var h,q,V,R,M,ae;if(_){var b=_[B+P];if(b==null)return null;h=ks(b,f)}else h=Qt(A,s),Array.isArray(h)||(h=[k,h]);var T=rr(n,oa)(h[1],B);if(a==="horizontal"){var D,[H,E]=[m.scale(h[0]),m.scale(h[1])];q=zt({axis:d,ticks:g,bandSize:l,offset:o.offset,entry:A,index:B}),V=(D=E??H)!==null&&D!==void 0?D:void 0,R=o.size;var K=H-E;if(M=ws(K)?0:K,ae={x:q,y:C.top,width:R,height:C.height},Math.abs(T)>0&&Math.abs(M)<Math.abs(T)){var ne=Rt(M||T)*(Math.abs(T)-Math.abs(M));V-=ne,M+=ne}}else{var[ie,ue]=[d.scale(h[0]),d.scale(h[1])];if(q=ie,V=zt({axis:m,ticks:x,bandSize:l,offset:o.offset,entry:A,index:B}),R=ue-ie,M=o.size,ae={x:C.left,y:V,width:C.width,height:M},Math.abs(T)>0&&Math.abs(R)<Math.abs(T)){var qe=Rt(R||T)*(Math.abs(T)-Math.abs(R));R+=qe}}if(q==null||V==null||R==null||M==null)return null;var Ne=G(G({},A),{},{stackedBarStart:L,x:q,y:V,width:R,height:M,value:_?h:h[1],payload:A,background:ae,tooltipPosition:{x:q+R/2,y:V+M/2},parentViewBox:w},y&&y[B]&&y[B].props);return Ne}).filter(Boolean)}function Jr(t){var a=ms(t,Gr),s=Cr(a.stackId),n=Zt();return c.createElement(hs,{id:a.id,type:"bar"},o=>c.createElement(c.Fragment,null,c.createElement(ps,{legendPayload:Br(a)}),c.createElement(zr,{dataKey:a.dataKey,stroke:a.stroke,strokeWidth:a.strokeWidth,fill:a.fill,name:a.name,hide:a.hide,unit:a.unit,tooltipType:a.tooltipType,id:o}),c.createElement(vs,{type:"bar",id:o,data:void 0,xAxisId:a.xAxisId,yAxisId:a.yAxisId,zAxisId:0,dataKey:a.dataKey,stackId:s,hide:a.hide,barSize:a.barSize,minPointSize:a.minPointSize,maxBarSize:a.maxBarSize,isPanorama:n}),c.createElement(mt,{zIndex:a.zIndex},c.createElement(Yr,re({},a,{id:o})))))}var ca=c.memo(Jr,us);ca.displayName="Bar";var Xr=["axis","item"],Qr=c.forwardRef((t,a)=>c.createElement(Os,{chartName:"BarChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:Xr,tooltipPayloadSearcher:Es,categoricalChartProps:t,ref:a}));function en({tickets:t=[],laborRates:a={}}){const s=c.useMemo(()=>{if(!t.length)return{total:0,pending:0,approved:0,billed:0,rejected:0,totalHours:0,regularHours:0,overtimeHours:0,materialsCost:0,uniqueWorkers:0,avgHoursPerTicket:0,approvalRate:0,pendingValue:0,approvedValue:0,billedValue:0,workersByRole:{},topWorkers:[],byMonth:[],byStatus:[]};const l=t.filter(b=>b.status==="pending").length,d=t.filter(b=>b.status==="approved").length,m=t.filter(b=>b.status==="billed").length,g=t.filter(b=>b.status==="rejected").length;let x=0,_=0,N=0;const C={},y={Foreman:0,Superintendent:0,Operator:0,Laborer:0};t.forEach(b=>{b.t_and_m_workers&&b.t_and_m_workers.forEach(T=>{const D=parseFloat(T.hours)||0,H=parseFloat(T.overtime_hours)||0;_+=D,N+=H,x+=D+H;const E=T.name||"Unknown";C[E]||(C[E]={name:E,hours:0,role:T.role||"Laborer"}),C[E].hours+=D+H;const K=T.role||"Laborer";y[K]!==void 0?y[K]+=D+H:y[K]=D+H})});let w=0;t.forEach(b=>{b.t_and_m_items&&b.t_and_m_items.forEach(T=>{const D=T.materials_equipment?.cost_per_unit||0;w+=T.quantity*D})});const P=Object.keys(C).length,F=Object.values(C).sort((b,T)=>T.hours-b.hours).slice(0,5),f=d+m+g,k=f>0?Math.round((d+m)/f*100):0,A={...{Foreman:85,Superintendent:95,Operator:75,Laborer:55},...a},B=b=>{let T=0,D=0;return b.t_and_m_workers&&b.t_and_m_workers.forEach(H=>{const E=H.role||"Laborer",K=A[E]||A.Laborer,ne=parseFloat(H.hours)||0,ie=parseFloat(H.overtime_hours)||0;T+=ne*K+ie*K*1.5}),b.t_and_m_items&&b.t_and_m_items.forEach(H=>{const E=H.materials_equipment?.cost_per_unit||0;D+=H.quantity*E}),T+D},h=t.filter(b=>b.status==="pending").reduce((b,T)=>b+B(T),0),q=t.filter(b=>b.status==="approved").reduce((b,T)=>b+B(T),0),V=t.filter(b=>b.status==="billed").reduce((b,T)=>b+B(T),0),R={};t.forEach(b=>{const T=new Date(b.work_date),D=`${T.getFullYear()}-${String(T.getMonth()+1).padStart(2,"0")}`,H=T.toLocaleDateString("en-US",{month:"short",year:"2-digit"});R[D]||(R[D]={month:H,monthKey:D,tickets:0,hours:0,cost:0,value:0}),R[D].tickets+=1,R[D].cost+=B(b)-w,b.t_and_m_workers&&b.t_and_m_workers.forEach(E=>{const K=parseFloat(E.hours)||0,ne=parseFloat(E.overtime_hours)||0;R[D].hours+=K+ne}),b.t_and_m_items&&b.t_and_m_items.forEach(E=>{const K=E.materials_equipment?.cost_per_unit||0;R[D].value+=E.quantity*K})});const M=Object.values(R).sort((b,T)=>b.monthKey.localeCompare(T.monthKey)).slice(-6),ae=[{name:"Pending",value:l,color:"#f59e0b"},{name:"Approved",value:d,color:"#10b981"},{name:"Billed",value:m,color:"#3b82f6"},{name:"Rejected",value:g,color:"#ef4444"}].filter(b=>b.value>0);return{total:t.length,pending:l,approved:d,billed:m,rejected:g,totalHours:x,regularHours:_,overtimeHours:N,materialsCost:w,uniqueWorkers:P,avgHoursPerTicket:t.length>0?x/t.length:0,approvalRate:k,pendingValue:h,approvedValue:q,billedValue:V,workersByRole:y,topWorkers:F,byMonth:M,byStatus:ae}},[t,a]),n=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(l),o=({active:l,payload:d,label:m})=>l&&d&&d.length?e.jsxs("div",{className:"tm-chart-tooltip",children:[e.jsx("p",{className:"tm-tooltip-label",children:m}),d.map((g,x)=>e.jsxs("p",{style:{color:g.color},children:[g.name,": ",g.name.includes("Cost")||g.name.includes("Value")?n(g.value):g.value.toFixed(1)]},x))]}):null;return t.length===0?e.jsxs("div",{className:"tm-dashboard tm-dashboard-empty",children:[e.jsx("div",{className:"tm-empty-icon",children:e.jsx(wt,{size:48})}),e.jsx("p",{children:"No T&M tickets yet"}),e.jsx("p",{className:"tm-empty-hint",children:"Create tickets to see analytics and trends"})]}):e.jsxs("div",{className:"tm-dashboard",children:[e.jsxs("div",{className:"tm-summary-cards",children:[e.jsxs("div",{className:"tm-summary-card",children:[e.jsx("div",{className:"tm-card-icon tickets",children:e.jsx(wt,{size:20})}),e.jsxs("div",{className:"tm-card-content",children:[e.jsx("span",{className:"tm-card-value",children:s.total}),e.jsx("span",{className:"tm-card-label",children:"Total Tickets"})]})]}),e.jsxs("div",{className:"tm-summary-card",children:[e.jsx("div",{className:"tm-card-icon hours",children:e.jsx(Ba,{size:20})}),e.jsxs("div",{className:"tm-card-content",children:[e.jsx("span",{className:"tm-card-value",children:s.totalHours.toFixed(1)}),e.jsx("span",{className:"tm-card-label",children:"Total Hours"}),s.overtimeHours>0&&e.jsxs("span",{className:"tm-card-detail",children:[s.overtimeHours.toFixed(1)," OT"]})]})]}),e.jsxs("div",{className:"tm-summary-card",children:[e.jsx("div",{className:"tm-card-icon workers",children:e.jsx(za,{size:20})}),e.jsxs("div",{className:"tm-card-content",children:[e.jsx("span",{className:"tm-card-value",children:s.uniqueWorkers}),e.jsx("span",{className:"tm-card-label",children:"Workers"})]})]}),e.jsxs("div",{className:"tm-summary-card",children:[e.jsx("div",{className:"tm-card-icon materials",children:e.jsx(Ra,{size:20})}),e.jsxs("div",{className:"tm-card-content",children:[e.jsx("span",{className:"tm-card-value",children:n(s.materialsCost)}),e.jsx("span",{className:"tm-card-label",children:"Materials"})]})]})]}),e.jsxs("div",{className:"tm-status-cards",children:[e.jsxs("div",{className:"tm-status-card pending",children:[e.jsxs("div",{className:"tm-status-header",children:[e.jsx(La,{size:16}),e.jsx("span",{children:"Pending"})]}),e.jsx("div",{className:"tm-status-count",children:s.pending}),e.jsx("div",{className:"tm-status-value",children:n(s.pendingValue)})]}),e.jsxs("div",{className:"tm-status-card approved",children:[e.jsxs("div",{className:"tm-status-header",children:[e.jsx(Vt,{size:16}),e.jsx("span",{children:"Approved"})]}),e.jsx("div",{className:"tm-status-count",children:s.approved}),e.jsx("div",{className:"tm-status-value",children:n(s.approvedValue)})]}),e.jsxs("div",{className:"tm-status-card billed",children:[e.jsxs("div",{className:"tm-status-header",children:[e.jsx(dt,{size:16}),e.jsx("span",{children:"Billed"})]}),e.jsx("div",{className:"tm-status-count",children:s.billed}),e.jsx("div",{className:"tm-status-value",children:n(s.billedValue)})]}),e.jsxs("div",{className:"tm-status-card rate",children:[e.jsxs("div",{className:"tm-status-header",children:[e.jsx($a,{size:16}),e.jsx("span",{children:"Approval Rate"})]}),e.jsxs("div",{className:"tm-status-count",children:[s.approvalRate,"%"]}),e.jsxs("div",{className:"tm-status-value",children:[s.approved+s.billed," / ",s.total-s.pending]})]})]}),e.jsxs("div",{className:"tm-charts-row",children:[s.byStatus.length>0&&e.jsxs("div",{className:"tm-chart-card",children:[e.jsx("h4",{className:"tm-chart-title",children:"Status Distribution"}),e.jsx("div",{className:"tm-chart-container",children:e.jsx(rt,{width:"100%",height:200,children:e.jsxs(Fs,{children:[e.jsx(Ds,{data:s.byStatus,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",label:({name:l,percent:d})=>`${l} ${(d*100).toFixed(0)}%`,labelLine:!1,children:s.byStatus.map((l,d)=>e.jsx(Xt,{fill:l.color},`cell-${d}`))}),e.jsx(nt,{})]})})}),e.jsx("div",{className:"tm-chart-legend",children:s.byStatus.map((l,d)=>e.jsxs("div",{className:"tm-legend-item",children:[e.jsx("span",{className:"tm-legend-color",style:{background:l.color}}),e.jsx("span",{className:"tm-legend-label",children:l.name}),e.jsx("span",{className:"tm-legend-value",children:l.value})]},d))})]}),s.byMonth.length>0&&e.jsxs("div",{className:"tm-chart-card wide",children:[e.jsx("h4",{className:"tm-chart-title",children:"Hours by Month"}),e.jsx("div",{className:"tm-chart-container",children:e.jsx(rt,{width:"100%",height:200,children:e.jsxs(Qr,{data:s.byMonth,children:[e.jsx(Ms,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Lt,{dataKey:"month",tick:{fill:"var(--text-secondary)",fontSize:12},axisLine:{stroke:"var(--border-color)"}}),e.jsx($t,{tick:{fill:"var(--text-secondary)",fontSize:12},axisLine:{stroke:"var(--border-color)"}}),e.jsx(nt,{content:e.jsx(o,{})}),e.jsx(ca,{dataKey:"hours",name:"Hours",fill:"var(--primary-color)",radius:[4,4,0,0]})]})})})]})]}),e.jsxs("div",{className:"tm-charts-row",children:[e.jsxs("div",{className:"tm-chart-card",children:[e.jsx("h4",{className:"tm-chart-title",children:"Hours by Role"}),e.jsx("div",{className:"tm-role-breakdown",children:Object.entries(s.workersByRole).filter(([,l])=>l>0).sort((l,d)=>d[1]-l[1]).map(([l,d])=>{const m=d/s.totalHours*100;return e.jsxs("div",{className:"tm-role-bar",children:[e.jsxs("div",{className:"tm-role-info",children:[e.jsx("span",{className:"tm-role-name",children:l}),e.jsxs("span",{className:"tm-role-hours",children:[d.toFixed(1)," hrs"]})]}),e.jsx("div",{className:"tm-role-track",children:e.jsx("div",{className:"tm-role-fill",style:{width:`${m}%`}})})]},l)})})]}),s.topWorkers.length>0&&e.jsxs("div",{className:"tm-chart-card",children:[e.jsx("h4",{className:"tm-chart-title",children:"Top Workers"}),e.jsx("div",{className:"tm-top-workers",children:s.topWorkers.map((l,d)=>e.jsxs("div",{className:"tm-worker-row",children:[e.jsxs("span",{className:"tm-worker-rank",children:["#",d+1]}),e.jsxs("div",{className:"tm-worker-info",children:[e.jsx("span",{className:"tm-worker-name",children:l.name}),e.jsx("span",{className:"tm-worker-role",children:l.role})]}),e.jsxs("span",{className:"tm-worker-hours",children:[l.hours.toFixed(1)," hrs"]})]},l.name))})]}),s.byMonth.length>1&&e.jsxs("div",{className:"tm-chart-card",children:[e.jsx("h4",{className:"tm-chart-title",children:"Ticket Volume"}),e.jsx("div",{className:"tm-chart-container",children:e.jsx(rt,{width:"100%",height:150,children:e.jsxs(Bs,{data:s.byMonth,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"ticketGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--primary-color)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--primary-color)",stopOpacity:0})]})}),e.jsx(Lt,{dataKey:"month",tick:{fill:"var(--text-secondary)",fontSize:10},axisLine:!1,tickLine:!1}),e.jsx($t,{hide:!0}),e.jsx(nt,{content:e.jsx(o,{})}),e.jsx(zs,{type:"monotone",dataKey:"tickets",name:"Tickets",stroke:"var(--primary-color)",fill:"url(#ticketGradient)",strokeWidth:2})]})})})]})]}),e.jsxs("div",{className:"tm-quick-stats",children:[e.jsxs("div",{className:"tm-quick-stat",children:[e.jsx("span",{className:"tm-quick-label",children:"Avg Hours/Ticket"}),e.jsx("span",{className:"tm-quick-value",children:s.avgHoursPerTicket.toFixed(1)})]}),e.jsxs("div",{className:"tm-quick-stat",children:[e.jsx("span",{className:"tm-quick-label",children:"Regular Hours"}),e.jsx("span",{className:"tm-quick-value",children:s.regularHours.toFixed(1)})]}),e.jsxs("div",{className:"tm-quick-stat",children:[e.jsx("span",{className:"tm-quick-label",children:"Overtime Hours"}),e.jsx("span",{className:"tm-quick-value",children:s.overtimeHours.toFixed(1)})]}),e.jsxs("div",{className:"tm-quick-stat",children:[e.jsx("span",{className:"tm-quick-label",children:"Total Est. Value"}),e.jsx("span",{className:"tm-quick-value",children:n(s.pendingValue+s.approvedValue+s.billedValue)})]})]})]})}const tn=c.memo(function({ticket:a,isExpanded:s,isSelected:n,isLocked:o,lockInfo:l,hasFailedImport:d,isRetrying:m,onToggleExpand:g,onToggleSelect:x,onApprove:_,onUpdateStatus:N,onDelete:C,onOpenCorAssign:y,onRetryImport:w,onShowSignatureLink:P,formatDate:F,calculateTotalHours:f,calculateTicketTotal:k}){const L=f(a),A=k(a),B=h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),g(a.id))};return e.jsxs("div",{className:`tm-ticket-card hover-lift animate-fade-in-up ${a.status} ${n?"selected":""} ${o?"locked":""}`,role:"article","aria-label":`T&M Ticket for ${F(a.work_date)}, ${L} hours, $${A.toFixed(2)}, status: ${a.status}`,children:[e.jsxs("div",{className:"tm-ticket-header",onClick:()=>g(a.id),onKeyDown:B,role:"button",tabIndex:0,"aria-expanded":s,"aria-label":`${s?"Collapse":"Expand"} ticket details`,children:[e.jsx("input",{type:"checkbox",checked:n,onChange:h=>x(a.id,h),onClick:h=>h.stopPropagation(),className:"tm-checkbox","aria-label":`Select ticket for ${F(a.work_date)}`}),e.jsxs("div",{className:"tm-ticket-info",children:[e.jsx("span",{className:"tm-ticket-date",children:F(a.work_date)}),a.ce_pco_number&&e.jsx("span",{className:"tm-ce-badge",children:a.ce_pco_number}),a.assigned_cor_id&&l?.lockedBy&&e.jsxs("span",{className:`tm-cor-badge ${o?"locked":""}`,title:l?.reason,children:[o&&e.jsx(Ot,{size:10}),l.lockedBy.cor_number]}),a.photos?.length>0&&e.jsx(na,{count:a.photos.length,icon:Et,size:"small",variant:"default"}),d&&e.jsxs("span",{className:"tm-import-failed-badge",title:"COR data import failed - retry needed",children:[e.jsx(Ha,{size:12})," Import Failed"]}),a.client_signature_data&&e.jsxs("span",{className:"tm-verified-badge",title:`Verified by ${a.client_signature_name||"client"}${a.client_signature_date?` on ${F(a.client_signature_date)}`:""}`,children:[e.jsx(Vt,{size:12})," Verified"]}),e.jsx("span",{className:`tm-ticket-status ${a.status}`,children:a.status})]}),e.jsxs("div",{className:"tm-ticket-summary",children:[e.jsxs("span",{className:"tm-ticket-hours",children:[L," hrs"]}),e.jsxs("span",{className:"tm-ticket-total",children:["$",A.toFixed(2)]}),e.jsx("span",{className:"tm-expand-arrow","aria-hidden":"true",children:s?"▼":"▶"})]})]}),s&&e.jsxs("div",{className:"tm-ticket-details",children:[a.t_and_m_workers?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Wa,{size:16,className:"inline-icon"})," Workers"]}),e.jsx("div",{className:"tm-detail-list",children:a.t_and_m_workers.map(h=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsxs("span",{children:[h.role&&h.role!=="Laborer"&&e.jsx("span",{className:"tm-role-badge",children:h.role}),h.name]}),e.jsxs("span",{children:[h.hours," hrs",parseFloat(h.overtime_hours)>0&&e.jsxs("span",{className:"tm-ot-badge",children:[" +",h.overtime_hours," OT"]})]})]},h.id))})]}),a.t_and_m_items?.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(qa,{size:16,className:"inline-icon"})," Materials & Equipment"]}),e.jsx("div",{className:"tm-detail-list",children:a.t_and_m_items.map(h=>e.jsxs("div",{className:"tm-detail-row",children:[e.jsx("span",{children:h.custom_name?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"tm-custom-badge",children:"Custom"})," ",h.custom_name]}):h.materials_equipment?.name}),e.jsxs("span",{className:"tm-detail-qty",children:[h.quantity," ",h.materials_equipment?.unit||"each",h.materials_equipment?.cost_per_unit>0&&e.jsxs("span",{className:"tm-item-cost",children:["$",(h.quantity*h.materials_equipment.cost_per_unit).toFixed(2)]})]})]},h.id))})]}),a.notes&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(dt,{size:16,className:"inline-icon"})," Description"]}),e.jsx("p",{className:"tm-notes-text",children:a.notes})]}),a.photos&&a.photos.length>0&&e.jsxs("div",{className:"tm-detail-section",children:[e.jsxs("h4",{children:[e.jsx(Et,{size:16,className:"inline-icon"})," Photos (",a.photos.length,")"]}),e.jsx("div",{className:"tm-photos-grid",children:a.photos.map((h,q)=>e.jsx("a",{href:h,target:"_blank",rel:"noopener noreferrer",className:"tm-photo-thumb",children:e.jsx("img",{src:h,alt:`Photo ${q+1}`,onError:V=>{V.target.onerror=null,V.target.classList.add("photo-error"),V.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHJ4PSIyIiByeT0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg=="}})},q))})]}),a.ce_pco_number&&a.change_order_value>0&&e.jsxs("div",{className:"tm-change-order-value",children:[e.jsx("span",{className:"tm-co-label",children:"Change Order Value:"}),e.jsxs("span",{className:"tm-co-amount",children:["$",a.change_order_value.toLocaleString()]})]}),o&&e.jsxs("div",{className:"tm-lock-notice",children:[e.jsx(Ot,{size:14}),e.jsx("span",{children:l?.reason||"This ticket is locked (COR approved)"})]}),e.jsxs("div",{className:"tm-ticket-actions",role:"group","aria-label":"Ticket actions",children:[a.status==="pending"&&!o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-success btn-small",onClick:h=>{h.stopPropagation(),_(a)},"aria-label":"Approve this ticket",children:"Approve"}),e.jsx("button",{className:"btn btn-warning btn-small",onClick:h=>{h.stopPropagation(),N(a.id,"rejected")},"aria-label":"Reject this ticket",children:"Reject"})]}),a.status==="approved"&&!o&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-primary btn-small",onClick:h=>{h.stopPropagation(),N(a.id,"billed")},"aria-label":"Mark ticket as billed",children:"Mark Billed"}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:h=>{h.stopPropagation(),P(a)},"aria-label":"Get signature link for this ticket",children:[e.jsx(Ka,{size:14,"aria-hidden":"true"})," Signature Link"]})]}),a.status==="rejected"&&!o&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:h=>{h.stopPropagation(),N(a.id,"pending")},"aria-label":"Restore rejected ticket to pending",children:"Restore"}),!o&&e.jsxs("button",{className:`btn btn-small ${a.assigned_cor_id?"btn-ghost":"btn-secondary"}`,onClick:h=>{h.stopPropagation(),y(a)},"aria-label":a.assigned_cor_id?"Change COR link":"Link to Change Order",children:[e.jsx(Va,{size:14,"aria-hidden":"true"})," ",a.assigned_cor_id?"COR":"Link COR"]}),d&&!o&&e.jsxs("button",{className:"btn btn-warning btn-small",onClick:h=>w(a,h),disabled:m,"aria-label":"Retry syncing data to COR","aria-busy":m,children:[e.jsx(Ua,{size:14,className:m?"spin":"","aria-hidden":"true"})," ",m?"Syncing...":"Retry Sync"]}),!o&&e.jsx("button",{className:"btn btn-danger btn-small",onClick:h=>{h.stopPropagation(),C(a.id)},"aria-label":"Delete this ticket",children:"Delete"})]})]})]})});function hn({project:t,company:a,onShowToast:s,compact:n=!1,previewMode:o=!1,onViewAll:l}){const{branding:d}=Da(),[m,g]=c.useState([]),[x,_]=c.useState(!0),[N,C]=c.useState(!1),[y,w]=c.useState("all"),[P,F]=c.useState(null),[f,k]=c.useState(new Set),[L,A]=c.useState(0),[B,h]=c.useState(!0),[q,V]=c.useState(0),R=25,[M,ae]=c.useState("recent"),[b,T]=c.useState(()=>{const i=localStorage.getItem("fieldsync-tm-default-view");return i==="list"||i==="dashboard"?i:"dashboard"}),[D,H]=c.useState(new Set),[E,K]=c.useState({start:"",end:""}),[ne,ie]=c.useState(!1),[ue,qe]=c.useState(null),[Ne,ht]=c.useState(""),[da,pt]=c.useState(!1),[Ce,vt]=c.useState(null),[ua,Se]=c.useState(!1),[ee,xt]=c.useState(null),[Ee,ma]=c.useState([]),[Te,Ke]=c.useState(""),[gt,ft]=c.useState(!1),[J,ha]=c.useState({}),[pa,bt]=c.useState({}),[va,jt]=c.useState(null);c.useEffect(()=>{g([]),A(0),h(!0),ge(0,!0);const i=Z.subscribeToTMTickets?.(t.id,()=>{ge(0,!0)});return()=>{i&&Z.unsubscribe?.(i)}},[t.id]),c.useEffect(()=>{n||localStorage.setItem("fieldsync-tm-default-view",b)},[b,n]),c.useEffect(()=>{if(!n){const i=localStorage.getItem("fieldsync-tm-default-view");T(i==="list"||i==="dashboard"?i:"dashboard")}},[n]);const ge=async(i=0,r=!1)=>{try{r?_(!0):C(!0);const p=await Z.getTMTicketsPaginated(t.id,{page:i,limit:R,status:y!=="all"?y:null});g(r?p.tickets:u=>[...u,...p.tickets]),A(i),h(p.hasMore),V(p.totalCount);const I=p.tickets.filter(u=>u.assigned_cor_id);if(I.length>0){const u={},v={};await Promise.all(I.map(async O=>{const z=await Z.isTicketEditable(O);z.editable||(u[O.id]=z);try{const Q=await Z.getTicketImportStatus(O.id,O.assigned_cor_id);Q?.import_status==="failed"&&(v[O.id]=Q)}catch{}})),ha(O=>r?u:{...O,...u}),bt(O=>r?v:{...O,...v})}}catch{s("Error loading T&M tickets","error")}finally{_(!1),C(!1)}},xa=()=>{!N&&B&&ge(L+1,!1)};c.useEffect(()=>{t?.id&&(g([]),A(0),h(!0),ge(0,!0))},[y]);const Ve=c.useCallback(async(i,r)=>{if(J[i]){s(J[i].reason||"This ticket is locked (COR approved)","error");return}try{await Z.updateTMTicketStatus(i,r),g(p=>p.map(I=>I.id===i?{...I,status:r}:I)),s(`Ticket ${r}`,"success")}catch(p){console.error("Error updating status:",p),s("Error updating status","error")}},[J]),ga=c.useCallback(i=>{if(J[i.id]){s(J[i.id].reason||"This ticket is locked (COR approved)","error");return}Ve(i.id,"approved")},[J,Ve]),fa=async()=>{if(ue)try{const i=parseFloat(Ne)||0;await Z.approveTMTicket(ue.id,null,null,i),g(m.map(r=>r.id===ue.id?{...r,status:"approved",change_order_value:i}:r)),s(`Ticket approved with $${i.toLocaleString()} change order`,"success"),ie(!1),qe(null),ht("")}catch(i){console.error("Error approving ticket:",i),s("Error approving ticket","error")}},ba=c.useCallback(async i=>{if(J[i]){s(J[i].reason||"This ticket is locked (COR approved)","error");return}if(confirm("Delete this T&M ticket?"))try{await Z.deleteTMTicket(i),g(r=>r.filter(p=>p.id!==i)),s("Ticket deleted","success")}catch(r){console.error("Error deleting ticket:",r),s("Error deleting ticket","error")}},[J]),ja=c.useCallback(async i=>{xt(i),Ke(i.assigned_cor_id||""),Se(!0),ft(!0);try{const r=await Z.getAssignableCORs(t.id);ma(r||[])}catch(r){console.error("Error loading CORs:",r),s("Error loading change orders","error")}finally{ft(!1)}},[t.id]),ya=async()=>{if(ee)try{if(Te){await Z.assignTicketToCOR(ee.id,Te);const i=Ee.find(r=>r.id===Te);s(`Ticket linked to ${i?.cor_number||"COR"}`,"success")}else ee.assigned_cor_id&&(await Z.unassignTicketFromCOR(ee.id,ee.assigned_cor_id),s("Ticket unlinked from COR","success"));ge(),Se(!1),xt(null),Ke("")}catch(i){console.error("Error updating COR association:",i),s("Error updating COR link","error")}},_a=c.useCallback(async(i,r)=>{if(r?.stopPropagation(),!!i.assigned_cor_id){jt(i.id);try{await Z.importTicketDataToCOR(i.id,i.assigned_cor_id,a.id,t.work_type||"demolition",t.job_type||"standard"),s("COR data import successful!","success"),bt(p=>{const I={...p};return delete I[i.id],I}),ge()}catch(p){console.error("Error retrying import:",p),s("Import retry failed. Please try again.","error")}finally{jt(null)}}},[a.id,t.work_type,t.job_type]),Ie=i=>{let r=0;return i.t_and_m_items&&i.t_and_m_items.forEach(p=>{p.materials_equipment?.cost_per_unit&&(r+=p.quantity*p.materials_equipment.cost_per_unit)}),r},Pe=i=>i.t_and_m_workers?i.t_and_m_workers.reduce((r,p)=>{const I=parseFloat(p.hours)||0,u=parseFloat(p.overtime_hours)||0;return r+I+u},0):0,Fe=i=>new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),ka=c.useCallback((i,r)=>{r?.stopPropagation(),k(p=>{const I=new Set(p);return I.has(i)?I.delete(i):I.add(i),I})},[]),Na=c.useCallback(i=>{F(r=>r===i?null:i)},[]),Ca=c.useCallback(i=>{vt(i),pt(!0)},[]),yt=()=>{const i=y==="all"?m:m.filter(p=>p.status===y),r=i.every(p=>f.has(p.id));k(r?new Set:new Set(i.map(p=>p.id)))},_t=()=>{k(new Set)},kt=()=>{const i=y==="all"?m:m.filter(r=>r.status===y);return f.size>0?i.filter(r=>f.has(r.id)):i},Sa=()=>{const i=kt();if(i.length===0){s("No tickets to export","error");return}const r=[],p=[],I=[];i.forEach(z=>{const Q=Fe(z.work_date),me=z.status;z.t_and_m_workers&&z.t_and_m_workers.forEach(U=>{const be=parseFloat(U.hours)||0,je=parseFloat(U.overtime_hours)||0;r.push({Date:Q,Status:me,"Worker Name":U.name,Role:U.role||"Laborer","Regular Hours":be,"OT Hours":je,"Total Hours":be+je})}),z.t_and_m_items&&z.t_and_m_items.forEach(U=>{const be=U.custom_name||U.materials_equipment?.name||"Unknown",je=U.custom_category||U.materials_equipment?.category||"Unknown",De=U.materials_equipment?.unit||"each",Me=U.materials_equipment?.cost_per_unit||0,he=U.quantity*Me;p.push({Date:Q,Status:me,Category:je,Item:be,Quantity:U.quantity,Unit:De,"Cost/Unit":Me,Total:he})}),I.push({Date:Q,Status:me,Workers:z.t_and_m_workers?.length||0,"Total Hours":Pe(z),Items:z.t_and_m_items?.length||0,"Materials Cost":Ie(z),Notes:z.notes||""})});const u=pe.book_new(),v=pe.json_to_sheet(I);if(pe.book_append_sheet(u,v,"Summary"),r.length>0){const z=pe.json_to_sheet(r);pe.book_append_sheet(u,z,"Workers")}if(p.length>0){const z=pe.json_to_sheet(p);pe.book_append_sheet(u,z,"Materials & Equipment")}const O=`${t.name}_TM_${new Date().toISOString().split("T")[0]}.xlsx`;Ls(u,O),s("Export downloaded!","success")},Ta=async()=>{const i=kt();if(i.length===0){s("No tickets to export","error");return}s("Generating PDF...","info");const r=new $s,p=r.internal.pageSize.getWidth(),I=r.internal.pageSize.getHeight(),u=20;let v=u;const O=At(d?.primary_color||"#3B82F6"),z=At(d?.secondary_color||"#1E40AF");r.setFillColor(...O),r.rect(0,0,p,45,"F"),r.setFillColor(...z),r.rect(0,42,p,3,"F");let Q=u;if(d?.logo_url)try{const j=await Ma(d.logo_url);j&&(r.addImage(j,"PNG",u,7,30,30),Q=u+30+10)}catch(j){console.error("Error adding logo:",j)}r.setTextColor(255,255,255),r.setFontSize(22),r.setFont("helvetica","bold"),r.text(a?.name||"Company Name",Q,20),r.setFontSize(10),r.setFont("helvetica","normal"),r.text("TIME & MATERIALS REPORT",Q,30),r.setFontSize(9),r.text(`Report Date: ${new Date().toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`,p-u,18,{align:"right"}),t.job_number&&r.text(`Job #: ${t.job_number}`,p-u,26,{align:"right"}),r.text(`Status: ${y.charAt(0).toUpperCase()+y.slice(1)}`,p-u,34,{align:"right"}),v=55,r.setFillColor(248,250,252),r.rect(u,v-5,p-u*2,30,"F"),r.setDrawColor(...O),r.setLineWidth(.5),r.rect(u,v-5,p-u*2,30,"S"),r.setTextColor(...O),r.setFontSize(14),r.setFont("helvetica","bold"),r.text(`Project: ${t.name}`,u+5,v+7),r.setFontSize(10),r.setFont("helvetica","normal"),r.setTextColor(51,65,85);const me=i.map(j=>new Date(j.work_date)).sort((j,S)=>j-S),U=me[0]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),be=me[me.length-1]?.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});r.text(`Date Range: ${U} - ${be}`,u+5,v+17),r.text(`Total Tickets: ${i.length}`,p-u-5,v+7,{align:"right"}),v+=40;const je=i.reduce((j,S)=>j+Pe(S),0),De=i.reduce((j,S)=>j+Ie(S),0),Me=new Set(i.flatMap(j=>j.t_and_m_workers?.map(S=>S.name)||[])).size;r.setTextColor(...O),r.setFontSize(12),r.setFont("helvetica","bold"),r.text("SUMMARY",u,v),v+=8;const he=(p-u*2-20)/3,Oa=[{label:"Total Labor Hours",value:je.toFixed(1)},{label:"Unique Workers",value:Me.toString()},{label:"Materials Cost",value:`$${De.toFixed(2)}`}],Ea=O.map(j=>Math.min(255,j+180));Oa.forEach((j,S)=>{const $=u+S*(he+10);r.setFillColor(...Ea),r.rect($,v,he,25,"F"),r.setDrawColor(...O),r.setLineWidth(.5),r.rect($,v,he,25,"S"),r.setTextColor(...O),r.setFontSize(16),r.setFont("helvetica","bold"),r.text(j.value,$+he/2,v+12,{align:"center"}),r.setTextColor(100,116,139),r.setFontSize(8),r.setFont("helvetica","normal"),r.text(j.label,$+he/2,v+20,{align:"center"})}),v+=35;const Ge=[],Ye=[],Ze=[];let Je=0,Xe=0,Qe=0,et=0,tt=0,at=0;i.forEach(j=>{j.t_and_m_workers&&j.t_and_m_workers.forEach(S=>{const $=parseFloat(S.hours)||0,W=parseFloat(S.overtime_hours)||0,oe=S.role||"Laborer",se=[Fe(j.work_date),S.name,$.toString(),W>0?W.toString():"-",($+W).toString()];oe==="Foreman"||oe==="Superintendent"?(Ge.push(se),Je+=$,Xe+=W):oe==="Operator"?(Ye.push(se),Qe+=$,et+=W):(Ze.push(se),tt+=$,at+=W)})});const st=(j,S,$,W)=>{S.length!==0&&(v>I-80&&(r.addPage(),v=u),r.setTextColor(...O),r.setFontSize(11),r.setFont("helvetica","bold"),r.text(j,u,v),v+=5,Ht(r,{startY:v,head:[["Date","Name","Reg Hrs","OT Hrs","Total"]],body:S,margin:{left:u,right:u},headStyles:{fillColor:O,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{0:{cellWidth:30},2:{halign:"center",cellWidth:22},3:{halign:"center",cellWidth:22},4:{halign:"center",cellWidth:22}},foot:[["","SUBTOTAL:",$.toString(),W>0?W.toString():"-",($+W).toString()]],footStyles:{fillColor:z,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),v=r.lastAutoTable.finalY+10)};if(Ge.length>0||Ye.length>0||Ze.length>0){r.setTextColor(...O),r.setFontSize(12),r.setFont("helvetica","bold"),r.text("LABOR",u,v),v+=8,st("SUPERVISION",Ge,Je,Xe),st("OPERATORS",Ye,Qe,et),st("LABORERS",Ze,tt,at);const j=Je+Qe+tt,S=Xe+et+at;r.setFillColor(...O),r.rect(u,v,p-u*2,12,"F"),r.setTextColor(255,255,255),r.setFontSize(10),r.setFont("helvetica","bold"),r.text("LABOR TOTAL:",u+5,v+8),r.text(`${j} Reg + ${S} OT = ${j+S} Hours`,p-u-5,v+8,{align:"right"}),v+=20}v>I-100&&(r.addPage(),v=u);const le={},Be={},St=["Containment","PPE","Disposal","Equipment","Other"];i.forEach(j=>{j.t_and_m_items&&j.t_and_m_items.forEach(S=>{const $=S.custom_name||S.materials_equipment?.name||"Unknown",W=S.custom_category||S.materials_equipment?.category||"Other",oe=S.materials_equipment?.unit||"each",se=S.materials_equipment?.cost_per_unit||0,Ae=S.quantity*se;le[W]||(le[W]=[],Be[W]=0),le[W].push([Fe(j.work_date),$,S.quantity.toString(),oe,`$${se.toFixed(2)}`,`$${Ae.toFixed(2)}`]),Be[W]+=Ae})});const Tt=(j,S,$)=>{!S||S.length===0||(v>I-80&&(r.addPage(),v=u),r.setTextColor(...O),r.setFontSize(11),r.setFont("helvetica","bold"),r.text(j.toUpperCase(),u,v),v+=5,Ht(r,{startY:v,head:[["Date","Item","Qty","Unit","Rate","Total"]],body:S,margin:{left:u,right:u},headStyles:{fillColor:O,textColor:[255,255,255],fontStyle:"bold",fontSize:9},bodyStyles:{fontSize:9,textColor:[51,65,85]},alternateRowStyles:{fillColor:[248,250,252]},columnStyles:{2:{halign:"center",cellWidth:20},3:{halign:"center",cellWidth:25},4:{halign:"right",cellWidth:25},5:{halign:"right",cellWidth:30}},foot:[["","","","","Subtotal:",`$${$.toFixed(2)}`]],footStyles:{fillColor:z,textColor:[255,255,255],fontStyle:"bold",fontSize:9}}),v=r.lastAutoTable.finalY+10)};Object.keys(le).length>0&&(r.setTextColor(...O),r.setFontSize(12),r.setFont("helvetica","bold"),r.text("MATERIALS & EQUIPMENT",u,v),v+=8,St.forEach(j=>{le[j]&&Tt(j,le[j],Be[j])}),Object.keys(le).forEach(j=>{St.includes(j)||Tt(j,le[j],Be[j])}),r.setFillColor(...O),r.rect(u,v,p-u*2,12,"F"),r.setTextColor(255,255,255),r.setFontSize(10),r.setFont("helvetica","bold"),r.text("MATERIALS TOTAL:",u+5,v+8),r.text(`$${De.toFixed(2)}`,p-u-5,v+8,{align:"right"}),v+=20),v>I-80&&(r.addPage(),v=u),v+=10,r.setDrawColor(...O),r.setLineWidth(1),r.line(u,v,p-u,v),v+=15,r.setTextColor(...O),r.setFontSize(12),r.setFont("helvetica","bold"),r.text("AUTHORIZATION",u,v),v+=10,r.setFontSize(10),r.setFont("helvetica","normal"),r.setTextColor(71,85,105),r.text("I hereby authorize the above time and materials charges as accurate and approved for billing.",u,v),v+=20;const te=i[0]||{},It=(j,S,$,W,oe,se,Ae)=>{r.setFont("helvetica","bold"),r.setFontSize(8),r.setTextColor(...O),r.text(S,u,j),r.setFont("helvetica","normal"),r.setFontSize(9),r.setTextColor(100,116,139);const Y=j+18;if(r.setDrawColor(...z),r.setLineWidth(.5),r.line(u,Y,u+70,Y),r.text("Signature",u,Y+8),r.line(u+85,Y,u+145,Y),r.text("Title / Company",u+85,Y+8),r.line(p-u-40,Y,p-u,Y),r.text("Date",p-u-40,Y+8),$)try{if(r.addImage($,"PNG",u,Y-16,60,16),W&&(r.setFontSize(8),r.text(W,u,Y+15)),oe||se){const we=[oe,se].filter(Boolean).join(" - ");r.text(we,u+85,Y-5)}if(Ae){const we=new Date(Ae).toLocaleDateString();r.text(we,p-u-40,Y-5)}}catch(we){console.error("Error adding signature to PDF:",we)}return Y+25};v=It(v,"GC AUTHORIZATION",te.gc_signature_data,te.gc_signature_name,te.gc_signature_title,te.gc_signature_company,te.gc_signature_date),v+=8,v=It(v,"CLIENT AUTHORIZATION",te.client_signature_data,te.client_signature_name,te.client_signature_title,te.client_signature_company,te.client_signature_date);const Pt=r.internal.getNumberOfPages();for(let j=1;j<=Pt;j++){r.setPage(j);const S=I-15;r.setFontSize(8),r.setTextColor(148,163,184),r.text(`${a?.name||"Company"} - T&M Report - ${t.name}`,u,S),r.text(`Page ${j} of ${Pt}`,p-u,S,{align:"right"})}const Fa=`${t.name}_TM_Report_${new Date().toISOString().split("T")[0]}.pdf`;r.save(Fa),s("PDF exported!","success")},X=c.useMemo(()=>{let i=y==="all"?[...m]:m.filter(r=>r.status===y);if(E.start){const r=new Date(E.start);r.setHours(0,0,0,0),i=i.filter(p=>new Date(p.work_date)>=r)}if(E.end){const r=new Date(E.end);r.setHours(23,59,59,999),i=i.filter(p=>new Date(p.work_date)<=r)}if(o){const r=new Date,p=r.getMonth(),I=r.getFullYear();i=i.filter(u=>{const v=new Date(u.work_date);return v.getMonth()===p&&v.getFullYear()===I})}else if(M==="recent"){const r=new Date;r.setDate(r.getDate()-7),r.setHours(0,0,0,0),i=i.filter(p=>new Date(p.work_date)>=r)}return i},[m,y,M,E,o]),fe=c.useMemo(()=>{if(M!=="all")return null;const i={};return X.forEach(r=>{const p=new Date(r.work_date),I=`${p.getFullYear()}-${String(p.getMonth()+1).padStart(2,"0")}`,u=p.toLocaleDateString("en-US",{month:"long",year:"numeric"});i[I]||(i[I]={label:u,tickets:[],hours:0,cost:0}),i[I].tickets.push(r),i[I].hours+=Pe(r),i[I].cost+=Ie(r)}),Object.entries(i).sort((r,p)=>p[0].localeCompare(r[0]))},[X,M]);c.useEffect(()=>{if(fe&&fe.length>0){const i=fe[0][0];H(new Set([i]))}},[fe]);const Ia=i=>{const r=new Set(D);r.has(i)?r.delete(i):r.add(i),H(r)},Pa=X.reduce((i,r)=>i+Pe(r),0),Aa=X.reduce((i,r)=>i+Ie(r),0),Nt=y==="all"?m.length:m.filter(i=>i.status===y).length;if(x)return e.jsx("div",{className:`tm-list ${n?"tm-list-compact":""}`,children:e.jsx("div",{className:"tm-loading-skeletons",children:[1,2,3].map(i=>e.jsx(Rs,{},i))})});const wa=X.length>0&&X.every(i=>f.has(i.id)),Ue=f.size>0,Ct=i=>e.jsx(tn,{ticket:i,isExpanded:P===i.id,isSelected:f.has(i.id),isLocked:!!J[i.id],lockInfo:J[i.id],hasFailedImport:!!pa[i.id],isRetrying:va===i.id,onToggleExpand:Na,onToggleSelect:ka,onApprove:ga,onUpdateStatus:Ve,onDelete:ba,onOpenCorAssign:ja,onRetryImport:_a,onShowSignatureLink:Ca,formatDate:Fe,calculateTotalHours:Pe,calculateTicketTotal:Ie},i.id);return e.jsxs("div",{className:`tm-list ${n?"tm-list-compact":""}`,children:[e.jsx("div",{className:"tm-list-header",children:e.jsxs("div",{className:"tm-list-title",children:[e.jsx("h3",{children:"T&M Tickets"}),e.jsxs("div",{className:"tm-header-controls",children:[!n&&e.jsxs("div",{className:"tm-display-toggle",children:[e.jsxs("button",{className:`tm-display-btn ${b==="dashboard"?"active":""}`,onClick:()=>T("dashboard"),title:"Dashboard View",children:[e.jsx(Ga,{size:16})," Dashboard"]}),e.jsxs("button",{className:`tm-display-btn ${b==="list"?"active":""}`,onClick:()=>T("list"),title:"List View",children:[e.jsx(Ya,{size:16})," List"]})]}),e.jsxs("div",{className:"tm-export-buttons",children:[!n&&Ue&&e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:_t,children:["Clear (",f.size,")"]}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:Sa,disabled:m.length===0,children:[e.jsx(Za,{size:14})," Excel ",!n&&Ue?`(${f.size})`:""]}),e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:Ta,disabled:m.length===0,children:[e.jsx(dt,{size:14})," PDF ",!n&&Ue?`(${f.size})`:""]})]})]})]})}),!n&&e.jsxs("div",{className:"tm-list-filters",children:[e.jsx("div",{className:"tm-filter-tabs",children:["all","pending","approved","billed","rejected"].map(i=>e.jsxs("button",{className:`tm-filter-tab ${y===i?"active":""}`,onClick:()=>{w(i),_t()},children:[i.charAt(0).toUpperCase()+i.slice(1),e.jsx("span",{className:"tm-filter-count",children:i==="all"?m.length:m.filter(r=>r.status===i).length})]},i))}),e.jsxs("div",{className:"view-mode-bar",children:[e.jsxs("div",{className:"view-mode-tabs",children:[e.jsx("button",{className:`view-mode-tab ${M==="recent"?"active":""}`,onClick:()=>{ae("recent"),K({start:"",end:""})},children:"Recent (7 days)"}),e.jsxs("button",{className:`view-mode-tab ${M==="all"?"active":""}`,onClick:()=>ae("all"),children:["All (",Nt,")"]})]}),M==="all"&&e.jsxs("div",{className:"date-filter",children:[e.jsx(Ja,{size:16}),e.jsx("input",{type:"date",value:E.start,onChange:i=>K(r=>({...r,start:i.target.value})),placeholder:"Start date"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"date",value:E.end,onChange:i=>K(r=>({...r,end:i.target.value})),placeholder:"End date"}),(E.start||E.end)&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:()=>K({start:"",end:""}),children:"Clear"})]})]})]}),!n&&b==="dashboard"&&e.jsx(en,{tickets:m}),b==="list"&&e.jsxs(e.Fragment,{children:[!n&&X.length>0&&e.jsxs("div",{className:"tm-summary-bar",children:[e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Tickets"}),e.jsx("span",{className:"tm-summary-value",children:X.length})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Total Hours"}),e.jsx("span",{className:"tm-summary-value",children:Pa.toFixed(1)})]}),e.jsxs("div",{className:"tm-summary-stat",children:[e.jsx("span",{className:"tm-summary-label",children:"Materials Cost"}),e.jsxs("span",{className:"tm-summary-value",children:["$",Aa.toFixed(2)]})]})]}),X.length===0?e.jsxs("div",{className:"tm-empty-state",children:[e.jsxs("p",{children:["No ",y==="all"?"":y," T&M tickets",M==="recent"?" in the last 7 days":""]}),M==="recent"&&Nt>0&&e.jsx("button",{className:"btn btn-secondary btn-small",onClick:()=>ae("all"),children:"View All Tickets"})]}):e.jsxs("div",{className:"tm-tickets stagger-children",children:[e.jsx("div",{className:"tm-select-all-row",children:e.jsxs("label",{className:"tm-checkbox-label",onClick:yt,children:[e.jsx("input",{type:"checkbox",checked:wa,onChange:yt,className:"tm-checkbox"}),e.jsxs("span",{children:["Select All (",X.length,")"]})]})}),M==="all"&&fe?fe.map(([i,r])=>e.jsxs("div",{className:"month-group animate-fade-in",children:[e.jsxs("div",{className:"month-header",onClick:()=>Ia(i),children:[e.jsxs("div",{className:"month-header-left",children:[D.has(i)?e.jsx(Xa,{size:18}):e.jsx(Ft,{size:18}),e.jsx("span",{className:"month-label",children:r.label}),e.jsx(na,{count:r.tickets.length,label:"tickets",size:"small"})]}),e.jsxs("div",{className:"month-header-right",children:[e.jsxs("span",{className:"month-stat",children:[r.hours.toFixed(1)," hrs"]}),e.jsxs("span",{className:"month-stat",children:["$",r.cost.toFixed(2)]})]})]}),D.has(i)&&e.jsx("div",{className:"month-tickets stagger-children",children:r.tickets.map(p=>Ct(p))})]},i)):X.map(i=>Ct(i))]}),!o&&B&&!x&&m.length>0&&e.jsx("div",{className:"tm-load-more",children:e.jsx("button",{className:"btn btn-secondary",onClick:xa,disabled:N,children:N?"Loading...":`Load More (${m.length} of ${q})`})}),o&&m.length>0&&e.jsxs("button",{className:"tm-see-all-btn",onClick:l,children:["See all ",q||m.length," T&M tickets",e.jsx(Ft,{size:16})]})]}),ne&&ue&&e.jsx("div",{className:"modal-overlay",onClick:()=>ie(!1),children:e.jsxs("div",{className:"modal change-order-modal",onClick:i=>i.stopPropagation(),children:[e.jsx("h3",{children:"Approve Change Order Work"}),e.jsxs("p",{className:"modal-subtitle",children:["This T&M ticket is associated with ",e.jsx("strong",{children:ue.ce_pco_number})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Change Order Value ($)"}),e.jsx("input",{type:"number",value:Ne,onChange:i=>ht(i.target.value),placeholder:"Enter the change order amount",autoFocus:!0}),e.jsx("p",{className:"form-help",children:"This amount will be added to the project's total contract value."})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>ie(!1),children:"Cancel"}),e.jsxs("button",{className:"btn btn-success",onClick:fa,children:["Approve with $",parseFloat(Ne||0).toLocaleString()]})]})]})}),da&&Ce&&e.jsx(es,{documentType:"tm_ticket",documentId:Ce.id,companyId:a?.id,projectId:t?.id,documentTitle:`T&M Ticket - ${new Date(Ce.work_date).toLocaleDateString()}${Ce.ce_pco_number?` (${Ce.ce_pco_number})`:""}`,onClose:()=>{pt(!1),vt(null)},onShowToast:s}),ua&&ee&&e.jsx("div",{className:"modal-overlay",onClick:()=>Se(!1),children:e.jsxs("div",{className:"modal cor-assign-modal",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Link Ticket to Change Order"}),e.jsx("button",{className:"close-btn",onClick:()=>Se(!1),children:e.jsx(Qa,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{className:"modal-subtitle",children:["Ticket: ",e.jsx("strong",{children:new Date(ee.work_date).toLocaleDateString()}),ee.ce_pco_number&&` (${ee.ce_pco_number})`]}),gt?e.jsx("div",{className:"loading",children:"Loading change orders..."}):Ee.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"No change orders found for this project."}),e.jsx("p",{className:"text-muted",children:"Create a COR first, then link tickets to it."})]}):e.jsxs("div",{className:"cor-select-wrapper",children:[e.jsx("label",{children:"Select Change Order:"}),e.jsxs("select",{value:Te,onChange:i=>Ke(i.target.value),className:"cor-select",children:[e.jsx("option",{value:"",children:"-- No COR (unlink) --"}),Ee.map(i=>e.jsxs("option",{value:i.id,children:[i.cor_number," - ",i.title||"Untitled"," (",i.status,")"]},i.id))]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>Se(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:ya,disabled:gt||Ee.length===0,children:ee.assigned_cor_id&&!Te?"Unlink from COR":"Link to COR"})]})]})})]})}export{hn as default};
//# sourceMappingURL=TMList-fp4YZdgQ.js.map
