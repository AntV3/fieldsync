const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/TMList-BvVcNwxK.js","assets/pdf-aQqpMATS.js","assets/index-CCJihOTb.js","assets/icons-B-oSmWeD.js","assets/react-DXGY7bZi.js","assets/supabase-VuevzHjS.js","assets/index-BSzkIGa9.css","assets/SignatureLinkGenerator-D2X-QvME.js","assets/corCalculations-D9qkkIbo.js","assets/ShareModal-5RGcemOi.js","assets/InjuryReportsList-Bpjm4-mk.js","assets/NotificationSettings-TOYoOaJ1.js","assets/DailyReportsList-DTu-TlIw.js","assets/CORList-CW1F-Pbk.js","assets/CORForm-fs4tC1Yh.js","assets/CORDetail-zDDz2y84.js","assets/BillingCenter-jK_S0Pe8.js","assets/DrawRequestModal-B7ozY2At.js","assets/EquipmentModal-CHo4ZCr4.js","assets/AddCostModal-DFFw0FUY.js","assets/DocumentsTab-5abI5i8P.js"])))=>i.map(i=>d[i]);
import{_ as Z}from"./pdf-aQqpMATS.js";import{r as ze,c as La,a as _n,S as Pn,b as On,u as Ce,s as An,d as Rn,e as Mn,f as In,g as Tn,h as Ln,i as $n,j as be,k as $a,l as qn,m as Es,n as Vn,o as Fn,p as zn,D as Ys,q as qa,t as Bn,v as Wn,w as Kn,x as Ss,y as Un,z as Hn,A as Xs,Z as Js,L as Le,C as Gn,B as Yn,E as he,F as _s,G as Va,H as Xn,I as xa,J as Fa,K as Zs,M as Qs,N as Jn,O as Zn,P as za,Q as Ba,R as Qn,T as er,U as et,V as Ps,W as ar,X as sr,Y as tr,_ as nr,$ as rr,a0 as ir,a1 as at,a2 as lr,a3 as cr,a4 as or,a5 as dr,a6 as ur,a7 as mr,a8 as hr,a9 as pr,aa as Os,ab as As,ac as Rs,ad as vr,ae as xr,af as fr,ag as ye,ah as jr,ai as gr,aj as br,ak as st,al as Pa,am as yr,an as Nr,ao as wr,ap as Cr,aq as kr,ar as T,as as e,at as Dr,au as Ne,av as tt,aw as Er,ax as Sr,ay as _r,az as nt,aA as Pr,aB as Or,aC as Ar,aD as Ms,aE as U,aF as Rr,aG as Mr,aH as Ir,aI as Tr}from"./index-CCJihOTb.js";import{r as i,e as rt,X as Be,a4 as Lr,Y as Ia,y as $e,F as qe,s as ie,N as Ve,a2 as da,T as ua,a5 as $r,a6 as qr,H as ma,z as Vr,n as Fe,l as Te,p as fa,q as We,O as Fr,R as zr,a7 as Br,a8 as it,a9 as Wr,aa as ja,m as Wa,K as ga,ab as Kr,ac as Ur,W as Hr,j as Gr,a as Ke,i as Yr,ad as Xr,ae as Oa,af as Jr,c as Is,d as Zr,Q as oa,ag as lt,ah as Qr,ai as ei,aj as ai,ak as si,al as Ts,am as ti,an as ni,ao as ri,ap as ii}from"./icons-B-oSmWeD.js";import{f as ee}from"./corCalculations-D9qkkIbo.js";function ha(){return ha=Object.assign?Object.assign.bind():function(a){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var t in n)({}).hasOwnProperty.call(n,t)&&(a[t]=n[t])}return a},ha.apply(null,arguments)}function Ls(a,s){var n=Object.keys(a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);s&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable})),n.push.apply(n,t)}return n}function li(a){for(var s=1;s<arguments.length;s++){var n=arguments[s]!=null?arguments[s]:{};s%2?Ls(Object(n),!0).forEach(function(t){ci(a,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(n)):Ls(Object(n)).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(n,t))})}return a}function ci(a,s,n){return(s=oi(s))in a?Object.defineProperty(a,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[s]=n,a}function oi(a){var s=di(a,"string");return typeof s=="symbol"?s:s+""}function di(a,s){if(typeof a!="object"||!a)return a;var n=a[Symbol.toPrimitive];if(n!==void 0){var t=n.call(a,s);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(a)}var Q=32,ui={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function mi(a){var{data:s,iconType:n,inactiveColor:t}=a,r=Q/2,c=Q/6,o=Q/3,d=s.inactive?t:s.color,h=n??s.type;if(h==="none")return null;if(h==="plainline"){var m;return i.createElement("line",{strokeWidth:4,fill:"none",stroke:d,strokeDasharray:(m=s.payload)===null||m===void 0?void 0:m.strokeDasharray,x1:0,y1:r,x2:Q,y2:r,className:"recharts-legend-icon"})}if(h==="line")return i.createElement("path",{strokeWidth:4,fill:"none",stroke:d,d:"M0,".concat(r,"h").concat(o,`
            A`).concat(c,",").concat(c,",0,1,1,").concat(2*o,",").concat(r,`
            H`).concat(Q,"M").concat(2*o,",").concat(r,`
            A`).concat(c,",").concat(c,",0,1,1,").concat(o,",").concat(r),className:"recharts-legend-icon"});if(h==="rect")return i.createElement("path",{stroke:"none",fill:d,d:"M0,".concat(Q/8,"h").concat(Q,"v").concat(Q*3/4,"h").concat(-Q,"z"),className:"recharts-legend-icon"});if(i.isValidElement(s.legendIcon)){var l=li({},s);return delete l.legendIcon,i.cloneElement(s.legendIcon,l)}return i.createElement(On,{fill:d,cx:r,cy:r,size:Q,sizeType:"diameter",type:h})}function hi(a){var{payload:s,iconSize:n,layout:t,formatter:r,inactiveColor:c,iconType:o}=a,d={x:0,y:0,width:Q,height:Q},h={display:t==="horizontal"?"inline-block":"block",marginRight:10},m={display:"inline-block",verticalAlign:"middle",marginRight:4};return s.map((l,f)=>{var j=l.formatter||r,b=La({"recharts-legend-item":!0,["legend-item-".concat(f)]:!0,inactive:l.inactive});if(l.type==="none")return null;var u=l.inactive?c:l.color,x=j?j(l.value,l,f):l.value;return i.createElement("li",ha({className:b,style:h,key:"legend-item-".concat(f)},_n(a,l,f)),i.createElement(Pn,{width:n,height:n,viewBox:d,style:m,"aria-label":"".concat(x," legend icon")},i.createElement(mi,{data:l,iconType:o,inactiveColor:c})),i.createElement("span",{className:"recharts-legend-item-text",style:{color:u}},x))})}var pi=a=>{var s=ze(a,ui),{payload:n,layout:t,align:r}=s;if(!n||!n.length)return null;var c={padding:0,margin:0,textAlign:t==="horizontal"?r:"left"};return i.createElement("ul",{className:"recharts-default-legend",style:c},i.createElement(hi,ha({},s,{payload:n})))};function vi(){return Ce(An)}var xi=["contextPayload"];function Ta(){return Ta=Object.assign?Object.assign.bind():function(a){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var t in n)({}).hasOwnProperty.call(n,t)&&(a[t]=n[t])}return a},Ta.apply(null,arguments)}function $s(a,s){var n=Object.keys(a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);s&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable})),n.push.apply(n,t)}return n}function De(a){for(var s=1;s<arguments.length;s++){var n=arguments[s]!=null?arguments[s]:{};s%2?$s(Object(n),!0).forEach(function(t){fi(a,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(n)):$s(Object(n)).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(n,t))})}return a}function fi(a,s,n){return(s=ji(s))in a?Object.defineProperty(a,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[s]=n,a}function ji(a){var s=gi(a,"string");return typeof s=="symbol"?s:s+""}function gi(a,s){if(typeof a!="object"||!a)return a;var n=a[Symbol.toPrimitive];if(n!==void 0){var t=n.call(a,s);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(a)}function bi(a,s){if(a==null)return{};var n,t,r=yi(a,s);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(a);for(t=0;t<c.length;t++)n=c[t],s.indexOf(n)===-1&&{}.propertyIsEnumerable.call(a,n)&&(r[n]=a[n])}return r}function yi(a,s){if(a==null)return{};var n={};for(var t in a)if({}.hasOwnProperty.call(a,t)){if(s.indexOf(t)!==-1)continue;n[t]=a[t]}return n}function Ni(a){return a.value}function wi(a){var{contextPayload:s}=a,n=bi(a,xi),t=Vn(s,a.payloadUniqBy,Ni),r=De(De({},n),{},{payload:t});return i.isValidElement(a.content)?i.cloneElement(a.content,r):typeof a.content=="function"?i.createElement(a.content,r):i.createElement(pi,r)}function Ci(a,s,n,t,r,c){var{layout:o,align:d,verticalAlign:h}=s,m,l;return(!a||(a.left===void 0||a.left===null)&&(a.right===void 0||a.right===null))&&(d==="center"&&o==="vertical"?m={left:((t||0)-c.width)/2}:m=d==="right"?{right:n&&n.right||0}:{left:n&&n.left||0}),(!a||(a.top===void 0||a.top===null)&&(a.bottom===void 0||a.bottom===null))&&(h==="middle"?l={top:((r||0)-c.height)/2}:l=h==="bottom"?{bottom:n&&n.bottom||0}:{top:n&&n.top||0}),De(De({},m),l)}function ki(a){var s=$a();return i.useEffect(()=>{s(qn(a))},[s,a]),null}function Di(a){var s=$a();return i.useEffect(()=>(s(Es(a)),()=>{s(Es({width:0,height:0}))}),[s,a]),null}function Ei(a,s,n,t){return a==="vertical"&&be(s)?{height:s}:a==="horizontal"?{width:n||t}:null}var Si={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function Ka(a){var s=ze(a,Si),n=vi(),t=Rn(),r=Mn(),{width:c,height:o,wrapperStyle:d,portal:h}=s,[m,l]=In([n]),f=Tn(),j=Ln();if(f==null||j==null)return null;var b=f-(r?.left||0)-(r?.right||0),u=Ei(s.layout,o,c,b),x=h?d:De(De({position:"absolute",width:u?.width||c||"auto",height:u?.height||o||"auto"},Ci(d,s,r,f,j,m)),d),C=h??t;if(C==null||n==null)return null;var S=i.createElement("div",{className:"recharts-legend-wrapper",style:x,ref:l},i.createElement(ki,{layout:s.layout,align:s.align,verticalAlign:s.verticalAlign,itemSorter:s.itemSorter}),!h&&i.createElement(Di,{width:m.width,height:m.height}),i.createElement(wi,Ta({},s,u,{margin:r,chartWidth:f,chartHeight:j,contextPayload:n})));return $n.createPortal(S,C)}Ka.displayName="Legend";function qs(a,s){var n=Object.keys(a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);s&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable})),n.push.apply(n,t)}return n}function Vs(a){for(var s=1;s<arguments.length;s++){var n=arguments[s]!=null?arguments[s]:{};s%2?qs(Object(n),!0).forEach(function(t){_i(a,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(n)):qs(Object(n)).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(n,t))})}return a}function _i(a,s,n){return(s=Pi(s))in a?Object.defineProperty(a,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[s]=n,a}function Pi(a){var s=Oi(a,"string");return typeof s=="symbol"?s:s+""}function Oi(a,s){if(typeof a!="object"||!a)return a;var n=a[Symbol.toPrimitive];if(n!==void 0){var t=n.call(a,s);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(a)}function pa(){return pa=Object.assign?Object.assign.bind():function(a){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var t in n)({}).hasOwnProperty.call(n,t)&&(a[t]=n[t])}return a},pa.apply(null,arguments)}var Ai=(a,s)=>{var n;if(i.isValidElement(a))n=i.cloneElement(a,s);else if(typeof a=="function")n=a(s);else{if(!he(s.x1)||!he(s.y1)||!he(s.x2)||!he(s.y2))return null;n=i.createElement("line",pa({},s,{className:"recharts-reference-line-line"}))}return n},Ri=(a,s,n,t,r,c)=>{var{x:o,width:d}=c,h=r.y.apply(a,{position:n});if(Va(h)||s==="discard"&&!r.y.isInRange(h))return null;var m=[{x:o+d,y:h},{x:o,y:h}];return t==="left"?m.reverse():m},Mi=(a,s,n,t,r,c)=>{var{y:o,height:d}=c,h=r.x.apply(a,{position:n});if(Va(h)||s==="discard"&&!r.x.isInRange(h))return null;var m=[{x:h,y:o+d},{x:h,y:o}];return t==="top"?m.reverse():m},Ii=(a,s,n,t)=>{var r=a.map(c=>t.apply(c,{position:n}));return s==="discard"&&r.some(c=>!t.isInRange(c))?null:r},Ti=(a,s,n,t,r,c)=>{var{x:o,y:d,segment:h,ifOverflow:m}=c,l=_s(o),f=_s(d);return f?Ri(d,m,n,r,a,s):l?Mi(o,m,n,t,a,s):h!=null&&h.length===2?Ii(h,m,n,a):null};function Li(a){var s=$a();return i.useEffect(()=>(s(Fn(a)),()=>{s(zn(a))})),null}function $i(a){var{xAxisId:s,yAxisId:n,shape:t,className:r,ifOverflow:c}=a,o=qa(),d=Bn(),h=Ce(R=>Wn(R,s)),m=Ce(R=>Kn(R,n)),l=Ce(R=>Ss(R,"xAxis",s,o)),f=Ce(R=>Ss(R,"yAxis",n,o)),j=Un();if(!d||!j||h==null||m==null||l==null||f==null)return null;var b=Hn({x:l,y:f}),u=Ti(b,j,a.position,h.orientation,m.orientation,a);if(!u)return null;var[{x,y:C},{x:S,y:p}]=u,E=c==="hidden"?"url(#".concat(d,")"):void 0,g=Vs(Vs({clipPath:E},Xs(a)),{},{x1:x,y1:C,x2:S,y2:p}),N=Xn({x1:x,y1:C,x2:S,y2:p});return i.createElement(Js,{zIndex:a.zIndex},i.createElement(Le,{className:La("recharts-reference-line",r)},Ai(t,g),i.createElement(Gn,pa({},N,{lowerWidth:N.width,upperWidth:N.width}),i.createElement(Yn,{label:a.label}),a.children)))}var qi={ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle",zIndex:Ys.line};function ct(a){var s=ze(a,qi);return i.createElement(i.Fragment,null,i.createElement(Li,{yAxisId:s.yAxisId,xAxisId:s.xAxisId,ifOverflow:s.ifOverflow,x:s.x,y:s.y,segment:s.segment}),i.createElement($i,s))}ct.displayName="ReferenceLine";var ot=(a,s,n)=>Zs(a,"xAxis",za(a,s),n),dt=(a,s,n)=>Qs(a,"xAxis",za(a,s),n),ut=(a,s,n)=>Zs(a,"yAxis",Ba(a,s),n),mt=(a,s,n)=>Qs(a,"yAxis",Ba(a,s),n),Vi=xa([Fa,ot,ut,dt,mt],(a,s,n,t,r)=>et(a,"xAxis")?Ps(s,t,!1):Ps(n,r,!1)),Fi=(a,s)=>s,ht=xa([ar,Fi],(a,s)=>a.filter(n=>n.type==="area").find(n=>n.id===s)),pt=a=>{var s=Fa(a),n=et(s,"xAxis");return n?"yAxis":"xAxis"},zi=(a,s)=>{var n=pt(a);return n==="yAxis"?Ba(a,s):za(a,s)},Bi=(a,s,n)=>Qn(a,pt(a),zi(a,s),n),Wi=xa([ht,Bi],(a,s)=>{var n;if(!(a==null||s==null)){var{stackId:t}=a,r=er(a);if(!(t==null||r==null)){var c=(n=s[t])===null||n===void 0?void 0:n.stackedData,o=c?.find(d=>d.key===r);if(o!=null)return o.map(d=>[d[0],d[1]])}}}),Ki=xa([Fa,ot,ut,dt,mt,Wi,Jn,Vi,ht,Zn],(a,s,n,t,r,c,o,d,h,m)=>{var{chartData:l,dataStartIndex:f,dataEndIndex:j}=o;if(!(h==null||a!=="horizontal"&&a!=="vertical"||s==null||n==null||t==null||r==null||t.length===0||r.length===0||d==null)){var{data:b}=h,u;if(b&&b.length>0?u=b:u=l?.slice(f,j+1),u!=null)return dl({layout:a,xAxis:s,yAxis:n,xAxisTicks:t,yAxisTicks:r,dataStartIndex:f,areaSettings:h,stackedData:c,displayedData:u,chartBaseValue:m,bandSize:d})}}),Ui=["id"],Hi=["activeDot","animationBegin","animationDuration","animationEasing","connectNulls","dot","fill","fillOpacity","hide","isAnimationActive","legendType","stroke","xAxisId","yAxisId"];function ge(){return ge=Object.assign?Object.assign.bind():function(a){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var t in n)({}).hasOwnProperty.call(n,t)&&(a[t]=n[t])}return a},ge.apply(null,arguments)}function vt(a,s){if(a==null)return{};var n,t,r=Gi(a,s);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(a);for(t=0;t<c.length;t++)n=c[t],s.indexOf(n)===-1&&{}.propertyIsEnumerable.call(a,n)&&(r[n]=a[n])}return r}function Gi(a,s){if(a==null)return{};var n={};for(var t in a)if({}.hasOwnProperty.call(a,t)){if(s.indexOf(t)!==-1)continue;n[t]=a[t]}return n}function Fs(a,s){var n=Object.keys(a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);s&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable})),n.push.apply(n,t)}return n}function ke(a){for(var s=1;s<arguments.length;s++){var n=arguments[s]!=null?arguments[s]:{};s%2?Fs(Object(n),!0).forEach(function(t){Yi(a,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(n)):Fs(Object(n)).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(n,t))})}return a}function Yi(a,s,n){return(s=Xi(s))in a?Object.defineProperty(a,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):a[s]=n,a}function Xi(a){var s=Ji(a,"string");return typeof s=="symbol"?s:s+""}function Ji(a,s){if(typeof a!="object"||!a)return a;var n=a[Symbol.toPrimitive];if(n!==void 0){var t=n.call(a,s);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(a)}function va(a,s){return a&&a!=="none"?a:s}var Zi=a=>{var{dataKey:s,name:n,stroke:t,fill:r,legendType:c,hide:o}=a;return[{inactive:o,dataKey:s,type:c,color:va(t,r),value:at(n,s),payload:a}]},Qi=i.memo(a=>{var{dataKey:s,data:n,stroke:t,strokeWidth:r,fill:c,name:o,hide:d,unit:h,tooltipType:m,id:l}=a,f={dataDefinedOnItem:n,positions:void 0,settings:{stroke:t,strokeWidth:r,fill:c,dataKey:s,nameKey:void 0,name:at(o,s),hide:d,type:m,color:va(t,c),unit:h,graphicalItemId:l}};return i.createElement(lr,{tooltipEntrySettings:f})});function el(a){var{clipPathId:s,points:n,props:t}=a,{needClip:r,dot:c,dataKey:o}=t,d=st(t);return i.createElement(yr,{points:n,dot:c,className:"recharts-area-dots",dotClassName:"recharts-area-dot",dataKey:o,baseProps:d,needClip:r,clipPathId:s})}function al(a){var{showLabels:s,children:n,points:t}=a,r=t.map(c=>{var o,d,h={x:(o=c.x)!==null&&o!==void 0?o:0,y:(d=c.y)!==null&&d!==void 0?d:0,width:0,lowerWidth:0,upperWidth:0,height:0};return ke(ke({},h),{},{value:c.value,payload:c.payload,parentViewBox:void 0,viewBox:h,fill:void 0})});return i.createElement(br,{value:s?r:void 0},n)}function zs(a){var{points:s,baseLine:n,needClip:t,clipPathId:r,props:c}=a,{layout:o,type:d,stroke:h,connectNulls:m,isRange:l}=c,{id:f}=c,j=vt(c,Ui),b=st(j),u=Xs(j);return i.createElement(i.Fragment,null,s?.length>1&&i.createElement(Le,{clipPath:t?"url(#clipPath-".concat(r,")"):void 0},i.createElement(Pa,ge({},u,{id:f,points:s,connectNulls:m,type:d,baseLine:n,layout:o,stroke:"none",className:"recharts-area-area"})),h!=="none"&&i.createElement(Pa,ge({},b,{className:"recharts-area-curve",layout:o,type:d,connectNulls:m,fill:"none",points:s})),h!=="none"&&l&&i.createElement(Pa,ge({},b,{className:"recharts-area-curve",layout:o,type:d,connectNulls:m,fill:"none",points:n}))),i.createElement(el,{points:s,props:j,clipPathId:r}))}function sl(a){var s,n,{alpha:t,baseLine:r,points:c,strokeWidth:o}=a,d=(s=c[0])===null||s===void 0?void 0:s.y,h=(n=c[c.length-1])===null||n===void 0?void 0:n.y;if(!he(d)||!he(h))return null;var m=t*Math.abs(d-h),l=Math.max(...c.map(f=>f.x||0));return be(r)?l=Math.max(r,l):r&&Array.isArray(r)&&r.length&&(l=Math.max(...r.map(f=>f.x||0),l)),be(l)?i.createElement("rect",{x:0,y:d<h?d:d-m,width:l+(o?parseInt("".concat(o),10):1),height:Math.floor(m)}):null}function tl(a){var s,n,{alpha:t,baseLine:r,points:c,strokeWidth:o}=a,d=(s=c[0])===null||s===void 0?void 0:s.x,h=(n=c[c.length-1])===null||n===void 0?void 0:n.x;if(!he(d)||!he(h))return null;var m=t*Math.abs(d-h),l=Math.max(...c.map(f=>f.y||0));return be(r)?l=Math.max(r,l):r&&Array.isArray(r)&&r.length&&(l=Math.max(...r.map(f=>f.y||0),l)),be(l)?i.createElement("rect",{x:d<h?d:d-m,y:0,width:m,height:Math.floor(l+(o?parseInt("".concat(o),10):1))}):null}function nl(a){var{alpha:s,layout:n,points:t,baseLine:r,strokeWidth:c}=a;return n==="vertical"?i.createElement(sl,{alpha:s,points:t,baseLine:r,strokeWidth:c}):i.createElement(tl,{alpha:s,points:t,baseLine:r,strokeWidth:c})}function rl(a){var{needClip:s,clipPathId:n,props:t,previousPointsRef:r,previousBaselineRef:c}=a,{points:o,baseLine:d,isAnimationActive:h,animationBegin:m,animationDuration:l,animationEasing:f,onAnimationStart:j,onAnimationEnd:b}=t,u=i.useMemo(()=>({points:o,baseLine:d}),[o,d]),x=vr(u,"recharts-area-"),C=xr(),[S,p]=i.useState(!1),E=!S,g=i.useCallback(()=>{typeof b=="function"&&b(),p(!1)},[b]),N=i.useCallback(()=>{typeof j=="function"&&j(),p(!0)},[j]);if(C==null)return null;var R=r.current,F=c.current;return i.createElement(al,{showLabels:E,points:o},t.children,i.createElement(fr,{animationId:x,begin:m,duration:l,isActive:h,easing:f,onAnimationEnd:g,onAnimationStart:N,key:x},k=>{if(R){var y=R.length/o.length,O=k===1?o:o.map((z,G)=>{var Y=Math.floor(G*y);if(R[Y]){var le=R[Y];return ke(ke({},z),{},{x:ye(le.x,z.x,k),y:ye(le.y,z.y,k)})}return z}),M;return be(d)?M=ye(F,d,k):jr(d)||Va(d)?M=ye(F,0,k):M=d.map((z,G)=>{var Y=Math.floor(G*y);if(Array.isArray(F)&&F[Y]){var le=F[Y];return ke(ke({},z),{},{x:ye(le.x,z.x,k),y:ye(le.y,z.y,k)})}return z}),k>0&&(r.current=O,c.current=M),i.createElement(zs,{points:O,baseLine:M,needClip:s,clipPathId:n,props:t})}return k>0&&(r.current=o,c.current=d),i.createElement(Le,null,h&&i.createElement("defs",null,i.createElement("clipPath",{id:"animationClipPath-".concat(n)},i.createElement(nl,{alpha:k,points:o,baseLine:d,layout:C,strokeWidth:t.strokeWidth}))),i.createElement(Le,{clipPath:"url(#animationClipPath-".concat(n,")")},i.createElement(zs,{points:o,baseLine:d,needClip:s,clipPathId:n,props:t})))}),i.createElement(gr,{label:t.label}))}function il(a){var{needClip:s,clipPathId:n,props:t}=a,r=i.useRef(null),c=i.useRef();return i.createElement(rl,{needClip:s,clipPathId:n,props:t,previousPointsRef:r,previousBaselineRef:c})}class ll extends i.PureComponent{render(){var{hide:s,dot:n,points:t,className:r,top:c,left:o,needClip:d,xAxisId:h,yAxisId:m,width:l,height:f,id:j,baseLine:b,zIndex:u}=this.props;if(s)return null;var x=La("recharts-area",r),C=j,{r:S,strokeWidth:p}=mr(n),E=hr(n),g=S*2+p,N=d?"url(#clipPath-".concat(E?"":"dots-").concat(C,")"):void 0;return i.createElement(Js,{zIndex:u},i.createElement(Le,{className:x},d&&i.createElement("defs",null,i.createElement(pr,{clipPathId:C,xAxisId:h,yAxisId:m}),!E&&i.createElement("clipPath",{id:"clipPath-dots-".concat(C)},i.createElement("rect",{x:o-g/2,y:c-g/2,width:l+g,height:f+g}))),i.createElement(il,{needClip:d,clipPathId:C,props:this.props})),i.createElement(Os,{points:t,mainColor:va(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:N}),this.props.isRange&&Array.isArray(b)&&i.createElement(Os,{points:b,mainColor:va(this.props.stroke,this.props.fill),itemDataKey:this.props.dataKey,activeDot:this.props.activeDot,clipPath:N}))}}var xt={activeDot:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",connectNulls:!1,dot:!1,fill:"#3182bd",fillOpacity:.6,hide:!1,isAnimationActive:"auto",legendType:"line",stroke:"#3182bd",strokeWidth:1,type:"linear",label:!1,xAxisId:0,yAxisId:0,zIndex:Ys.area};function cl(a){var s,n=ze(a,xt),{activeDot:t,animationBegin:r,animationDuration:c,animationEasing:o,connectNulls:d,dot:h,fill:m,fillOpacity:l,hide:f,isAnimationActive:j,legendType:b,stroke:u,xAxisId:x,yAxisId:C}=n,S=vt(n,Hi),p=cr(),E=or(),{needClip:g}=dr(x,C),N=qa(),{points:R,isRange:F,baseLine:k}=(s=Ce(Y=>Ki(Y,a.id,N)))!==null&&s!==void 0?s:{},y=ur();if(p!=="horizontal"&&p!=="vertical"||y==null||E!=="AreaChart"&&E!=="ComposedChart")return null;var{height:O,width:M,x:z,y:G}=y;return!R||!R.length?null:i.createElement(ll,ge({},S,{activeDot:t,animationBegin:r,animationDuration:c,animationEasing:o,baseLine:k,connectNulls:d,dot:h,fill:m,fillOpacity:l,height:O,hide:f,layout:p,isAnimationActive:j==="auto"?!Nr.isSsr:j,isRange:F,legendType:b,needClip:g,points:R,stroke:u,width:M,left:z,top:G,xAxisId:x,yAxisId:C}))}var ol=(a,s,n,t,r)=>{var c=n??s;if(be(c))return c;var o=a==="horizontal"?r:t,d=o.scale.domain();if(o.type==="number"){var h=Math.max(d[0],d[1]),m=Math.min(d[0],d[1]);return c==="dataMin"?m:c==="dataMax"||h<0?h:Math.max(Math.min(d[0],d[1]),0)}return c==="dataMin"?d[0]:c==="dataMax"?d[1]:d[0]};function dl(a){var{areaSettings:{connectNulls:s,baseValue:n,dataKey:t},stackedData:r,layout:c,chartBaseValue:o,xAxis:d,yAxis:h,displayedData:m,dataStartIndex:l,xAxisTicks:f,yAxisTicks:j,bandSize:b}=a,u=r&&r.length,x=ol(c,o,n,d,h),C=c==="horizontal",S=!1,p=m.map((g,N)=>{var R,F,k;if(u)k=r[l+N];else{var y=As(g,t);Array.isArray(y)?(k=y,S=!0):k=[x,y]}var O=(R=(F=k)===null||F===void 0?void 0:F[1])!==null&&R!==void 0?R:null,M=O==null||u&&!s&&As(g,t)==null;return C?{x:Rs({axis:d,ticks:f,bandSize:b,entry:g,index:N}),y:M?null:h.scale(O),value:k,payload:g}:{x:M?null:d.scale(O),y:Rs({axis:h,ticks:j,bandSize:b,entry:g,index:N}),value:k,payload:g}}),E;return u||S?E=p.map(g=>{var N=Array.isArray(g.value)?g.value[0]:null;return C?{x:g.x,y:N!=null&&g.y!=null?h.scale(N):null,payload:g.payload}:{x:N!=null?d.scale(N):null,y:g.y,payload:g.payload}}):E=C?h.scale(x):d.scale(x),{points:p,baseLine:E,isRange:S}}function ul(a){var s=ze(a,xt),n=qa();return i.createElement(tr,{id:s.id,type:"area"},t=>i.createElement(i.Fragment,null,i.createElement(nr,{legendPayload:Zi(s)}),i.createElement(Qi,{dataKey:s.dataKey,data:s.data,stroke:s.stroke,strokeWidth:s.strokeWidth,fill:s.fill,name:s.name,hide:s.hide,unit:s.unit,tooltipType:s.tooltipType,id:t}),i.createElement(rr,{type:"area",id:t,data:s.data,dataKey:s.dataKey,xAxisId:s.xAxisId,yAxisId:s.yAxisId,zAxisId:0,stackId:ir(s.stackId),hide:s.hide,barSize:void 0,baseValue:s.baseValue,isPanorama:n,connectNulls:s.connectNulls}),i.createElement(cl,ge({},s,{id:t}))))}var Me=i.memo(ul,sr);Me.displayName="Area";var ml=["axis"],hl=i.forwardRef((a,s)=>i.createElement(wr,{chartName:"AreaChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:ml,tooltipPayloadSearcher:Cr,categoricalChartProps:a,ref:s}));const Bs={WARNING:"warning",ERROR:"error"},ae={DATABASE:"database",NETWORK:"network",AUTH:"auth",VALIDATION:"validation",STORAGE:"storage",SYNC:"sync",GENERAL:"general"};function pl(a){const s=a?.message?.toLowerCase()||"",n=a?.code?.toLowerCase()||"";return s.includes("fetch")||s.includes("network")||s.includes("offline")?ae.NETWORK:s.includes("auth")||s.includes("unauthorized")||n.includes("auth")?ae.AUTH:s.includes("storage")||s.includes("bucket")||s.includes("upload")?ae.STORAGE:s.includes("validation")||s.includes("invalid")||s.includes("required")?ae.VALIDATION:s.includes("sync")||s.includes("conflict")?ae.SYNC:a?.code||s.includes("database")||s.includes("supabase")?ae.DATABASE:ae.GENERAL}function vl(a,s,n){return n?.userMessage?n.userMessage:s===ae.NETWORK?"Network connection issue. Your changes will sync when back online.":s===ae.AUTH?"Session expired. Please sign in again.":s===ae.STORAGE?"Failed to upload file. Please try again.":s===ae.VALIDATION?a?.message||"Please check your input and try again.":s===ae.SYNC?"Sync conflict detected. Please refresh and try again.":n?.operation?`Failed to ${n.operation.replace(/([A-Z])/g," $1").toLowerCase().trim()}. Please try again.`:"Something went wrong. Please try again."}function xl(a,s={}){const{operation:n="unknown",category:t=pl(a),severity:r=Bs.ERROR,showToast:c,userMessage:o,companyId:d,projectId:h,userId:m,silent:l=!1,rethrow:f=!1}=s;if(kr.error(t,{message:a?.message||"Unknown error",code:a?.code,severity:r,operation:n,company_id:d,project_id:h,user_id:m,extra:{stack:a?.stack,name:a?.name}}),!l&&c){const j=vl(a,t,{operation:n,userMessage:o}),b=r===Bs.WARNING?"warning":"error";c(j,b)}if(f)throw a;return null}async function re(a,s={}){const{fallback:n=null,context:t={},showToast:r,silent:c=!0}=s;try{return await a()}catch(o){return xl(o,{...t,showToast:r,silent:c}),n}}const Ee={budget:{healthy:.6,warning:.75,critical:.85},schedule:{healthy:.05,warning:.15,critical:.25},corExposure:{healthy:.05,warning:.15,critical:.25},activity:{healthy:1,warning:3,critical:5},safety:{healthy:0,warning:1,critical:2}},fl={budget:.3,schedule:.25,corExposure:.2,activity:.15,safety:.1};function Ue(a,s){if(a<=s.healthy)return 0;if(a>=s.critical)return 100;const n=s.critical-s.healthy;return(a-s.healthy)/n*100}function He(a){return a<=25?"healthy":a<=60?"warning":"critical"}function jl(a,s,n=Ee.budget){if(!s||s<=0)return{score:0,status:"healthy",ratio:0,label:"No revenue yet"};const t=a/s,r=Ue(t,n),c=He(r);let o;return t<n.healthy?o=`Costs at ${(t*100).toFixed(0)}% of revenue`:t<n.warning?o=`Costs at ${(t*100).toFixed(0)}% - monitor closely`:o=`Costs at ${(t*100).toFixed(0)}% - review immediately`,{score:r,status:c,ratio:t,label:o}}function gl(a,s,n=Ee.schedule){if(!s||s<=0)return{score:0,status:"healthy",variance:0,label:"No schedule baseline"};const t=(s-a)/s,r=Math.max(0,t),c=Ue(r,n),o=He(c);let d;return t<=0?d=a>=100?"Complete":"On or ahead of schedule":t<n.warning?d=`${(t*100).toFixed(0)}% behind schedule`:d=`${(t*100).toFixed(0)}% behind - needs attention`,{score:c,status:o,variance:t,label:d}}function bl(a,s,n=Ee.corExposure){if(!s||s<=0)return{score:0,status:"healthy",exposure:0,label:"No contract value"};const t=a/s,r=Ue(t,n),c=He(r);let o;return t<n.healthy?o=a>0?`$${Aa(a)} pending`:"No pending CORs":t<n.warning?o=`$${Aa(a)} pending (${(t*100).toFixed(0)}% of contract)`:o=`High exposure: $${Aa(a)} (${(t*100).toFixed(0)}%)`,{score:r,status:c,exposure:t,label:o}}function yl(a,s=Ee.activity){if(!a)return{score:100,status:"critical",daysSince:null,label:"No reports filed"};const n=new Date(a),r=Math.floor((new Date-n)/(1e3*60*60*24)),c=Ue(r,s),o=He(c);let d;return r===0?d="Report filed today":r===1?d="Report filed yesterday":r<=s.warning?d=`Last report ${r} days ago`:d=`No report in ${r} days - may be stalled`,{score:c,status:o,daysSince:r,label:d}}function Nl(a,s=Ee.safety){const n=a||0,t=Ue(n,s),r=He(t);let c;return n===0?c="No incidents":n===1?c="1 incident in last 30 days":c=`${n} incidents - safety review needed`,{score:t,status:r,count:n,label:c}}function wl(a,s={}){const n={...Ee,...s.thresholds},t={...fl,...s.weights},r=jl(a.totalCosts,a.earnedRevenue,n.budget),c=gl(a.actualProgress,a.expectedProgress,n.schedule),o=bl(a.pendingCORValue,a.contractValue,n.corExposure),d=yl(a.lastReportDate,n.activity),h=Nl(a.recentInjuryCount,n.safety),m=Math.round(r.score*t.budget+c.score*t.schedule+o.score*t.corExposure+d.score*t.activity+h.score*t.safety);let l;m<=25?l="healthy":m<=60?l="warning":l="critical";let f;return l==="healthy"?f="Project is on track":l==="warning"?f="Some factors need attention":f="Immediate review recommended",{score:m,status:l,label:f,factors:{budget:{...r,weight:t.budget},schedule:{...c,weight:t.schedule},corExposure:{...o,weight:t.corExposure},activity:{...d,weight:t.activity},safety:{...h,weight:t.safety}}}}function Cl(a,s){const n=[],{factors:t}=a;t.budget.status==="critical"&&n.push({type:"critical",title:"Budget Alert",description:t.budget.label,action:"Review costs immediately",actionTarget:"financials",projectId:s.id}),t.activity.status==="critical"&&n.push({type:"critical",title:"Activity Alert",description:t.activity.label,action:"Check project status",actionTarget:"overview",projectId:s.id}),t.safety.status==="critical"&&n.push({type:"critical",title:"Safety Alert",description:t.safety.label,action:"Review safety reports",actionTarget:"reports",projectId:s.id}),t.budget.status==="warning"&&n.push({type:"warning",title:"Budget Watch",description:t.budget.label,action:"Monitor costs",actionTarget:"financials",projectId:s.id}),(t.schedule.status==="critical"||t.schedule.status==="warning")&&n.push({type:t.schedule.status==="critical"?"critical":"warning",title:"Schedule Alert",description:t.schedule.label,action:"Review progress",actionTarget:"overview",projectId:s.id}),(t.corExposure.status==="warning"||t.corExposure.status==="critical")&&n.push({type:t.corExposure.status==="critical"?"critical":"warning",title:"COR Exposure",description:t.corExposure.label,action:"Review pending CORs",actionTarget:"cors",projectId:s.id}),t.activity.status==="warning"&&n.push({type:"info",title:"Activity Notice",description:t.activity.label,action:"File daily report",actionTarget:"reports",projectId:s.id});const r={critical:0,warning:1,info:2};return n.sort((c,o)=>r[c.type]-r[o.type]),n}function kl(a){const{actualProgress:s,totalCosts:n,earnedRevenue:t,contractValue:r}=a;if(!s||s<=0)return{estimatedCompletionCost:null,estimatedFinalMargin:null,estimatedCompletionDate:null};const c=n/s,o=Math.round(c*100),d=r>0?(r-o)/r*100:0;let h=null;if(a.startDate&&s>0&&s<100){const m=new Date(a.startDate),l=new Date,f=Math.max(1,(l-m)/(1e3*60*60*24)),j=s/f,u=(100-s)/j;h=new Date(l.getTime()+u*24*60*60*1e3)}return{estimatedCompletionCost:o,estimatedFinalMargin:d,estimatedCompletionDate:h,costPerPercent:c}}function Aa(a){return a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(0)+"K":a.toFixed(0)}function Dl({isOpen:a,onClose:s,companyId:n,onSelectProject:t,onSelectTicket:r,onSelectCOR:c,onShowToast:o}){const[d,h]=i.useState(""),[m,l]=i.useState({projects:[],tickets:[],cors:[],workers:[]}),[f,j]=i.useState(!1),[b,u]=i.useState(0),x=i.useRef(null),C=i.useRef(null),S=i.useRef(null);i.useEffect(()=>()=>{C.current&&clearTimeout(C.current),S.current&&clearTimeout(S.current)},[]),i.useEffect(()=>{a&&(h(""),l({projects:[],tickets:[],cors:[],workers:[]}),u(0),S.current=setTimeout(()=>x.current?.focus(),50))},[a]);const p=i.useCallback(async y=>{if(!y.trim()||y.length<2){l({projects:[],tickets:[],cors:[],workers:[]});return}j(!0);try{const O=await T.universalSearch(n,y.trim());l(O),u(0)}catch(O){console.error("Search error:",O),o?.("Search failed","error")}finally{j(!1)}},[n,o]),E=y=>{const O=y.target.value;h(O),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{p(O)},200)},N=(()=>{const y=[];return m.projects.forEach(O=>y.push({type:"project",data:O})),m.tickets.forEach(O=>y.push({type:"ticket",data:O})),m.cors.forEach(O=>y.push({type:"cor",data:O})),m.workers.forEach(O=>y.push({type:"worker",data:O})),y})(),R=N.length>0,F=y=>{y.key==="Escape"?s():y.key==="ArrowDown"?(y.preventDefault(),u(O=>Math.min(O+1,N.length-1))):y.key==="ArrowUp"?(y.preventDefault(),u(O=>Math.max(O-1,0))):y.key==="Enter"&&R&&(y.preventDefault(),k(N[b]))},k=y=>{if(y){switch(y.type){case"project":t?.(y.data);break;case"ticket":r?.(y.data);break;case"cor":c?.(y.data);break;case"worker":y.data.lastProject&&t?.(y.data.lastProject);break}s()}};return a?e.jsx("div",{className:"universal-search-overlay",onClick:s,children:e.jsxs("div",{className:"universal-search-modal",onClick:y=>y.stopPropagation(),children:[e.jsxs("div",{className:"universal-search-input-wrapper",children:[e.jsx(rt,{size:20,className:"universal-search-icon"}),e.jsx("input",{ref:x,type:"text",value:d,onChange:E,onKeyDown:F,placeholder:"Search projects, tickets, CORs, workers...",className:"universal-search-input",autoComplete:"off",autoCorrect:"off",spellCheck:"false"}),d&&e.jsx("button",{className:"universal-search-clear",onClick:()=>h(""),children:e.jsx(Be,{size:16})}),e.jsx("div",{className:"universal-search-shortcut",children:e.jsx("span",{children:"esc"})})]}),e.jsx("div",{className:"universal-search-results",children:f?e.jsxs("div",{className:"universal-search-loading",children:[e.jsx("div",{className:"spinner-small"}),e.jsx("span",{children:"Searching..."})]}):d.trim()?R?e.jsxs(e.Fragment,{children:[m.projects.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(Ia,{size:14}),e.jsx("span",{children:"Projects"})]}),m.projects.map((y,O)=>{const M=O;return e.jsxs("button",{className:`universal-search-item ${b===M?"selected":""}`,onClick:()=>k({type:"project",data:y}),onMouseEnter:()=>u(M),children:[e.jsx(Ia,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:y.name}),y.job_number&&e.jsxs("span",{className:"universal-search-item-meta",children:["#",y.job_number]})]}),e.jsx($e,{size:16,className:"universal-search-item-arrow"})]},y.id)})]}),m.tickets.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(qe,{size:14}),e.jsx("span",{children:"T&M Tickets"})]}),m.tickets.map((y,O)=>{const M=m.projects.length+O;return e.jsxs("button",{className:`universal-search-item ${b===M?"selected":""}`,onClick:()=>k({type:"ticket",data:y}),onMouseEnter:()=>u(M),children:[e.jsx(qe,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[y.description?.substring(0,50)||"T&M Ticket",y.description?.length>50&&"..."]}),e.jsxs("span",{className:"universal-search-item-meta",children:[y.projectName," • ",y.work_date]})]}),e.jsx("span",{className:`universal-search-item-badge ${y.status}`,children:y.status})]},y.id)})]}),m.cors.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(ie,{size:14}),e.jsx("span",{children:"Change Orders"})]}),m.cors.map((y,O)=>{const M=m.projects.length+m.tickets.length+O;return e.jsxs("button",{className:`universal-search-item ${b===M?"selected":""}`,onClick:()=>k({type:"cor",data:y}),onMouseEnter:()=>u(M),children:[e.jsx(ie,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsxs("span",{className:"universal-search-item-title",children:[y.cor_number?`COR #${y.cor_number}: `:"",y.title]}),e.jsx("span",{className:"universal-search-item-meta",children:y.projectName})]}),e.jsx("span",{className:`universal-search-item-badge ${y.status}`,children:y.status})]},y.id)})]}),m.workers.length>0&&e.jsxs("div",{className:"universal-search-section",children:[e.jsxs("div",{className:"universal-search-section-header",children:[e.jsx(Ve,{size:14}),e.jsx("span",{children:"Workers"})]}),m.workers.map((y,O)=>{const M=m.projects.length+m.tickets.length+m.cors.length+O;return e.jsxs("button",{className:`universal-search-item ${b===M?"selected":""}`,onClick:()=>k({type:"worker",data:y}),onMouseEnter:()=>u(M),children:[e.jsx(Ve,{size:18}),e.jsxs("div",{className:"universal-search-item-content",children:[e.jsx("span",{className:"universal-search-item-title",children:y.name}),e.jsxs("span",{className:"universal-search-item-meta",children:[y.role," • ",y.projectName]})]}),e.jsx($e,{size:16,className:"universal-search-item-arrow"})]},`${y.name}-${O}`)})]})]}):e.jsx("div",{className:"universal-search-no-results",children:e.jsxs("span",{children:['No results for "',d,'"']})}):e.jsxs("div",{className:"universal-search-empty",children:[e.jsxs("div",{className:"universal-search-tip",children:[e.jsx(Lr,{size:14}),e.jsx("span",{children:"Type to search across all data"})]}),e.jsxs("div",{className:"universal-search-hints",children:[e.jsx("span",{children:"Projects"}),e.jsx("span",{children:"T&M Tickets"}),e.jsx("span",{children:"Change Orders"}),e.jsx("span",{children:"Workers"})]})]})}),e.jsxs("div",{className:"universal-search-footer",children:[e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↑↓"})," navigate"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"↵"})," select"]}),e.jsxs("div",{className:"universal-search-footer-hint",children:[e.jsx("span",{className:"key",children:"esc"})," close"]})]})]})}):null}function El(){const[a,s]=i.useState(!1);return i.useEffect(()=>{const n=t=>{(t.metaKey||t.ctrlKey)&&t.key==="k"&&(t.preventDefault(),s(r=>!r))};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[]),{isOpen:a,setIsOpen:s,open:()=>s(!0),close:()=>s(!1)}}function Sl({alerts:a=[],onAction:s,onDismiss:n,maxVisible:t=3,className:r=""}){const[c,o]=i.useState(new Set),d=a.filter(m=>!c.has(m.id||`${m.projectId}-${m.type}-${m.title}`)).slice(0,t),h=i.useCallback(m=>{const l=m.id||`${m.projectId}-${m.type}-${m.title}`;o(f=>new Set([...f,l])),n?.(m)},[n]);return d.length===0?null:e.jsxs("div",{className:`smart-alerts ${r}`,role:"region","aria-label":"Project alerts","aria-live":"polite",children:[d.map((m,l)=>e.jsx(_l,{alert:m,onAction:s,onDismiss:()=>h(m)},m.id||`${m.projectId}-${m.type}-${l}`)),a.length>t&&e.jsx("div",{className:"smart-alerts__overflow",children:e.jsxs("span",{className:"smart-alerts__overflow-text",children:["+",a.length-t," more alerts"]})})]})}function _l({alert:a,onAction:s,onDismiss:n}){const{type:t="info",title:r,description:c,action:o,actionTarget:d,projectId:h,projectName:m}=a,f={critical:$r,warning:ua,info:da}[t]||da,j=()=>{s?.({target:d,projectId:h,alert:a})};return e.jsxs("div",{className:`smart-alert smart-alert--${t}`,role:"alert","aria-live":t==="critical"?"assertive":"polite",children:[e.jsx(f,{className:"smart-alert__icon","aria-hidden":"true"}),e.jsxs("div",{className:"smart-alert__content",children:[e.jsxs("div",{className:"smart-alert__title",children:[m&&e.jsxs("span",{className:"smart-alert__project",children:[m,": "]}),r]}),c&&e.jsx("div",{className:"smart-alert__description",children:c}),o&&e.jsx("div",{className:"smart-alert__action",children:e.jsxs("button",{type:"button",className:"smart-alert__action-btn",onClick:j,children:[o,e.jsx(qr,{size:14,"aria-hidden":"true"})]})})]}),n&&e.jsx("button",{type:"button",className:"smart-alert__dismiss",onClick:n,"aria-label":"Dismiss alert",children:e.jsx(Be,{size:18,"aria-hidden":"true"})})]})}function Pl({project:a,company:s,onShowToast:n}){const[t,r]=i.useState(null),[c,o]=i.useState(!0),[d,h]=i.useState(!1);i.useEffect(()=>{if(a?.id&&s?.id){m();const u=T.subscribeToCrewCheckins?.(a.id,()=>{m()});return()=>{u&&T.unsubscribe?.(u)}}},[a?.id,s?.id]);const m=async()=>{try{const u=await T.calculateManDayCosts(a.id,s.id,a.work_type||"demolition",a.job_type||"standard");r(u)}catch(u){console.error("Error loading man day costs:",u)}finally{o(!1)}},l=u=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(u),f=u=>new Date(u).toLocaleDateString("en-US",{month:"short",day:"numeric"}),j=u=>({foreman:"Foreman",supervisor:"Supervisor",operator:"Operator",laborer:"Laborer"})[u]||u.charAt(0).toUpperCase()+u.slice(1);if(c)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsx("div",{className:"loading",children:"Loading..."})]});if(!t||t.totalManDays===0)return e.jsxs("div",{className:"man-day-costs card",children:[e.jsx("div",{className:"man-day-header",children:e.jsx("h3",{children:"Man Day Costs"})}),e.jsxs("div",{className:"man-day-empty",children:[e.jsx("span",{className:"empty-icon",children:e.jsx(ma,{size:32})}),e.jsx("p",{children:"No crew check-ins yet"}),e.jsx("small",{children:"Costs will appear as crew checks in from the field"})]})]});const b=Object.entries(t.byRole||{});return e.jsxs("div",{className:"man-day-costs card",children:[e.jsxs("div",{className:"man-day-header",onClick:()=>h(!d),children:[e.jsxs("div",{className:"man-day-title-row",children:[e.jsx("h3",{children:"Man Day Costs"}),e.jsx("span",{className:"man-day-total",children:l(t.totalCost)})]}),e.jsx("button",{className:"man-day-toggle",children:d?"▼ Collapse":"▶ Details"})]}),e.jsxs("div",{className:"man-day-summary",children:[e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.daysWorked}),e.jsx("span",{className:"stat-label",children:"Days Worked"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.totalManDays}),e.jsx("span",{className:"stat-label",children:"Total Man Days"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:l(t.totalCost)}),e.jsx("span",{className:"stat-label",children:"Total Labor Cost"})]}),e.jsxs("div",{className:"man-day-stat",children:[e.jsx("span",{className:"stat-value",children:t.daysWorked>0?l(t.totalCost/t.daysWorked):"$0"}),e.jsx("span",{className:"stat-label",children:"Avg Cost/Day"})]})]}),d&&e.jsxs("div",{className:"man-day-details",children:[b.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"By Role"}),e.jsx("div",{className:"man-day-role-list",children:b.map(([u,x])=>e.jsxs("div",{className:"man-day-role-row",children:[e.jsxs("div",{className:"role-info",children:[e.jsx("span",{className:"role-name",children:j(u)}),e.jsxs("span",{className:"role-rate",children:[l(x.rate),"/day"]})]}),e.jsxs("div",{className:"role-stats",children:[e.jsxs("span",{className:"role-count",children:[x.count," days"]}),e.jsx("span",{className:"role-cost",children:l(x.cost)})]})]},u))})]}),t.byDate?.length>0&&e.jsxs("div",{className:"man-day-section",children:[e.jsx("h4",{children:"Recent Activity"}),e.jsx("div",{className:"man-day-date-list",children:t.byDate.slice(0,7).map((u,x)=>e.jsxs("div",{className:"man-day-date-row",children:[e.jsx("span",{className:"date-label",children:f(u.date)}),e.jsxs("span",{className:"date-workers",children:[u.workers," crew"]}),e.jsx("span",{className:"date-cost",children:l(u.cost)})]},x))}),t.byDate.length>7&&e.jsxs("p",{className:"man-day-more",children:["+ ",t.byDate.length-7," more days"]})]})]})]})}const Ol=i.memo(function({project:s,areas:n=[],corStats:t={},onCreateDraw:r,onViewDraw:c,onShowToast:o}){const[d,h]=i.useState([]),[m,l]=i.useState(!0),f=i.useMemo(()=>n.reduce((g,N)=>{const R=(N.square_footage||0)*(N.price_per_sqft||0);return g+Math.round(R*100)},0),[n]),j=i.useMemo(()=>t?.approvedTotal||0,[t?.approvedTotal]),b=f+j,u=i.useCallback(async()=>{if(s?.id)try{l(!0);const g=await Dr.getProjectDrawRequests(s.id);h(g||[])}catch(g){console.error("Error loading draw requests:",g)}finally{l(!1)}},[s?.id]);i.useEffect(()=>{u()},[u]);const x=i.useMemo(()=>{const g=d.filter(k=>["submitted","approved","paid"].includes(k.status)),N=g.reduce((k,y)=>k+(y.previous_billings||0)+(y.current_billing||0),0),F=g[0]?.retention_held||0;return{billedToDate:N,retentionHeld:F}},[d]),C=b>0?Math.round(x.billedToDate/b*100):0,S=d.length>0?Math.max(...d.map(g=>g.draw_number))+1:1,p=g=>g?new Date(g).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",E=g=>{switch(g){case"draft":return e.jsx("span",{className:"badge badge-muted",children:"Draft"});case"submitted":return e.jsx("span",{className:"badge badge-warning",children:"Submitted"});case"approved":return e.jsx("span",{className:"badge badge-success",children:"Approved"});case"paid":return e.jsx("span",{className:"badge badge-info",children:"Paid"});case"rejected":return e.jsx("span",{className:"badge badge-danger",children:"Rejected"});default:return null}};return e.jsxs("div",{className:"progress-billing-card",children:[e.jsxs("div",{className:"progress-billing-header",children:[e.jsxs("div",{className:"progress-billing-title",children:[e.jsx(Vr,{size:18}),e.jsx("h3",{children:"Progress Billing"})]}),e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>r?.(),disabled:f===0,title:f===0?"Add areas with contract values first":`Create Draw #${S}`,children:[e.jsx(Fe,{size:14}),e.jsxs("span",{children:["Draw #",S]})]})]}),e.jsxs("div",{className:"progress-billing-contract",children:[e.jsxs("div",{className:"contract-row",children:[e.jsx("span",{className:"contract-label",children:"Original Contract"}),e.jsx("span",{className:"contract-value",children:ee(f)})]}),j>0&&e.jsxs("div",{className:"contract-row co",children:[e.jsx("span",{className:"contract-label",children:"Approved COs"}),e.jsxs("span",{className:"contract-value positive",children:["+",ee(j)]})]}),e.jsxs("div",{className:"contract-row revised",children:[e.jsx("span",{className:"contract-label",children:"Revised Contract"}),e.jsx("span",{className:"contract-value",children:ee(b)})]})]}),e.jsxs("div",{className:"progress-billing-status",children:[e.jsx("div",{className:"billing-progress-bar",children:e.jsx("div",{className:"billing-progress-fill",style:{width:`${Math.min(C,100)}%`}})}),e.jsxs("div",{className:"billing-stats",children:[e.jsxs("div",{className:"billing-stat",children:[e.jsx("span",{className:"billing-stat-value",children:ee(x.billedToDate)}),e.jsxs("span",{className:"billing-stat-label",children:["Billed to Date (",C,"%)"]})]}),x.retentionHeld>0&&e.jsxs("div",{className:"billing-stat retention",children:[e.jsxs("span",{className:"billing-stat-value",children:["-",ee(x.retentionHeld)]}),e.jsx("span",{className:"billing-stat-label",children:"Retention Held"})]}),e.jsxs("div",{className:"billing-stat remaining",children:[e.jsx("span",{className:"billing-stat-value",children:ee(b-x.billedToDate)}),e.jsx("span",{className:"billing-stat-label",children:"Balance to Finish"})]})]})]}),m?e.jsx("div",{className:"progress-billing-loading",children:e.jsx("div",{className:"loading-spinner small"})}):d.length===0?e.jsxs("div",{className:"progress-billing-empty",children:[e.jsx("p",{children:"No draw requests yet"}),f>0&&e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>r?.(),children:[e.jsx(Fe,{size:14}),"Create First Draw Request"]})]}):e.jsxs("div",{className:"progress-billing-draws",children:[e.jsx("div",{className:"draws-header",children:e.jsx("span",{children:"Recent Draws"})}),e.jsx("div",{className:"draws-list",children:d.slice(0,3).map(g=>e.jsxs("button",{className:"draw-item",onClick:()=>c?.(g),children:[e.jsxs("div",{className:"draw-item-info",children:[e.jsxs("span",{className:"draw-number",children:["Draw #",g.draw_number]}),e.jsx("span",{className:"draw-date",children:p(g.period_end||g.created_at)})]}),e.jsx("div",{className:"draw-item-amount",children:ee(g.current_billing||0)}),E(g.status),e.jsx($e,{size:16,className:"draw-item-arrow"})]},g.id))}),d.length>3&&e.jsxs("button",{className:"btn btn-sm btn-ghost view-all-draws",children:["View all ",d.length," draws"]})]})]})}),Ra=a=>a?new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",Al=i.memo(function({project:s,onAddEquipment:n,onEditEquipment:t,onShowToast:r}){const[c,o]=i.useState([]),[d,h]=i.useState(!0),[m,l]=i.useState(!0),[f,j]=i.useState(0),b=i.useCallback(async()=>{if(s?.id)try{h(!0);const p=await Ne.getProjectEquipment(s.id);o(p||[]);const E=Ne.calculateProjectEquipmentCost(p||[]);j(E)}catch(p){console.error("Error loading equipment:",p),r?.("Failed to load equipment","error")}finally{h(!1)}},[s?.id]);i.useEffect(()=>{b()},[b]);const u=i.useCallback(async p=>{try{await Ne.markEquipmentReturned(p.id),r?.(`${p.equipment_name} marked as returned`,"success"),b()}catch(E){console.error("Error marking equipment returned:",E),r?.("Failed to update equipment","error")}},[b]),x=i.useCallback(async p=>{if(confirm(`Remove ${p.equipment_name} from this project?`))try{await Ne.removeEquipmentFromProject(p.id),r?.("Equipment removed","success"),b()}catch(E){console.error("Error removing equipment:",E),r?.("Failed to remove equipment","error")}},[b]),C=i.useMemo(()=>c.filter(p=>!p.end_date),[c]),S=i.useMemo(()=>c.filter(p=>p.end_date),[c]);return e.jsxs("div",{className:"project-equipment-card",children:[e.jsxs("div",{className:"project-equipment-header",children:[e.jsxs("div",{className:"project-equipment-title",children:[e.jsx(Te,{size:18}),e.jsx("h3",{children:"Equipment on Site"}),c.length>0&&e.jsxs("span",{className:"equipment-count",children:[C.length," active"]})]}),e.jsxs("div",{className:"project-equipment-actions",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>n?.(),title:"Add equipment",children:[e.jsx(Fe,{size:14}),e.jsx("span",{children:"Add"})]}),c.length>0&&e.jsx("button",{className:"btn btn-sm btn-ghost",onClick:()=>l(!m),children:m?e.jsx(fa,{size:16}):e.jsx(We,{size:16})})]})]}),d?e.jsx("div",{className:"equipment-loading",children:e.jsx("div",{className:"loading-spinner small"})}):c.length===0?e.jsxs("div",{className:"equipment-empty",children:[e.jsx("p",{children:"No equipment tracked on this project"}),e.jsxs("button",{className:"btn btn-sm btn-outline",onClick:()=>n?.(),children:[e.jsx(Fe,{size:14}),"Track Equipment"]})]}):m?e.jsxs(e.Fragment,{children:[C.length>0&&e.jsx("div",{className:"equipment-list",children:C.map(p=>{const E=Ne.calculateDaysOnSite(p.start_date,p.end_date),g=p.daily_rate*E;return e.jsxs("div",{className:"equipment-item active",children:[e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:p.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[e.jsx(Fr,{size:12}),"On-site since ",Ra(p.start_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-rate",children:[ee(p.daily_rate),"/day"]}),e.jsxs("span",{className:"equipment-days",children:[E," days"]}),e.jsx("span",{className:"equipment-total",children:ee(g)})]})]}),e.jsxs("div",{className:"equipment-item-actions",children:[e.jsxs("button",{className:"btn btn-xs btn-outline",onClick:()=>u(p),title:"Mark as returned",children:[e.jsx(zr,{size:12}),"Returned"]}),e.jsx("button",{className:"btn btn-xs btn-ghost",onClick:()=>t?.(p),title:"Edit",children:e.jsx(Br,{size:12})}),e.jsx("button",{className:"btn btn-xs btn-ghost text-danger",onClick:()=>x(p),title:"Remove",children:e.jsx(it,{size:12})})]})]},p.id)})}),S.length>0&&e.jsxs("details",{className:"equipment-returned-section",children:[e.jsx("summary",{className:"equipment-returned-toggle",children:e.jsxs("span",{children:["Returned Equipment (",S.length,")"]})}),e.jsx("div",{className:"equipment-list returned",children:S.map(p=>{const E=Ne.calculateDaysOnSite(p.start_date,p.end_date),g=p.daily_rate*E;return e.jsx("div",{className:"equipment-item returned",children:e.jsxs("div",{className:"equipment-item-main",children:[e.jsxs("div",{className:"equipment-item-info",children:[e.jsx("span",{className:"equipment-name",children:p.equipment_name}),e.jsxs("span",{className:"equipment-meta",children:[Ra(p.start_date)," - ",Ra(p.end_date)]})]}),e.jsxs("div",{className:"equipment-item-cost",children:[e.jsxs("span",{className:"equipment-days",children:[E," days"]}),e.jsx("span",{className:"equipment-total",children:ee(g)})]})]})},p.id)})})]}),e.jsxs("div",{className:"equipment-total-row",children:[e.jsx("span",{children:"Total Equipment Cost"}),e.jsx("span",{className:"equipment-grand-total",children:ee(f)})]})]}):e.jsxs("div",{className:"equipment-summary-collapsed",children:[e.jsxs("span",{children:[C.length," active, ",S.length," returned"]}),e.jsx("span",{className:"equipment-grand-total",children:ee(f)})]})]})}),me=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a||0),Rl=a=>new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric"});function Ml({dailyBurn:a,totalBurn:s,daysWorked:n,laborCost:t,materialsEquipmentCost:r=0,progress:c,contractValue:o,laborByDate:d=[],materialsEquipmentByDate:h=[]}){const[m,l]=i.useState(!1),f=o*(c/100)*.6,j=s<=f?"on-budget":s<=f*1.2?"warning":"over-budget",b={"on-budget":"On Budget",warning:"Watch Closely","over-budget":"Over Budget"}[j],u=j==="on-budget"?ja:j==="warning"?Wa:ga,C=c>0?s/(c/100):0,S=[],p={};d.forEach(g=>{p[g.date]||(p[g.date]={date:g.date,labor:0,materialsEquipment:0,total:0}),p[g.date].labor=g.cost||0,p[g.date].total+=g.cost||0}),h.forEach(g=>{p[g.date]||(p[g.date]={date:g.date,labor:0,materialsEquipment:0,total:0}),p[g.date].materialsEquipment=g.cost||0,p[g.date].total+=g.cost||0}),Object.values(p).sort((g,N)=>new Date(N.date)-new Date(g.date)).slice(0,10).forEach(g=>S.push(g));const E=Math.max(...S.map(g=>g.total),1);return e.jsxs("div",{className:"burn-rate-card",children:[e.jsxs("div",{className:"burn-rate-header",children:[e.jsxs("div",{className:"burn-rate-title",children:[e.jsx(Wr,{size:18,className:"burn-icon"}),e.jsx("h3",{children:"Burn Rate"})]}),e.jsxs("div",{className:`burn-status ${j}`,children:[e.jsx(u,{size:14}),e.jsx("span",{children:b})]})]}),e.jsxs("div",{className:"burn-rate-hero",children:[e.jsxs("div",{className:"burn-rate-main",children:[e.jsx("span",{className:"burn-rate-value",children:me(a)}),e.jsx("span",{className:"burn-rate-unit",children:"/day"})]}),n>0&&e.jsxs("div",{className:"burn-rate-context",children:["Based on ",n," work day",n!==1?"s":""]})]}),e.jsxs("div",{className:"burn-rate-summary",children:[e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Total Spent"}),e.jsx("span",{className:"burn-summary-value",children:me(s)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Labor"}),e.jsx("span",{className:"burn-summary-value",children:me(t)})]}),e.jsx("div",{className:"burn-summary-divider"}),e.jsxs("div",{className:"burn-summary-item",children:[e.jsx("span",{className:"burn-summary-label",children:"Materials"}),e.jsx("span",{className:"burn-summary-value",children:me(r)})]})]}),c>0&&e.jsxs("div",{className:"burn-projection",children:[e.jsx("span",{className:"projection-label",children:"Projected at completion:"}),e.jsx("span",{className:`projection-value ${C>o*.7?"warning":""}`,children:me(C)})]}),S.length>0&&e.jsxs("button",{className:"burn-rate-expand",onClick:()=>l(!m),children:[m?e.jsx(fa,{size:16}):e.jsx(We,{size:16}),e.jsxs("span",{children:[m?"Hide":"View"," Daily Breakdown"]})]}),m&&S.length>0&&e.jsxs("div",{className:"burn-rate-details",children:[e.jsxs("div",{className:"burn-details-header",children:[e.jsx("span",{children:"Date"}),e.jsx("span",{children:"Labor"}),e.jsx("span",{children:"Materials"}),e.jsx("span",{children:"Total"})]}),S.map(g=>e.jsxs("div",{className:"burn-details-row",children:[e.jsx("span",{className:"burn-date",children:Rl(g.date)}),e.jsx("span",{className:"burn-labor",children:g.labor>0?me(g.labor):"-"}),e.jsx("span",{className:"burn-materials",children:g.materialsEquipment>0?me(g.materialsEquipment):"-"}),e.jsxs("span",{className:"burn-total",children:[e.jsx("span",{className:"burn-bar",style:{width:`${g.total/E*100}%`}}),e.jsx("span",{className:"burn-amount",children:me(g.total)})]})]},g.date))]})]})}const V={contract:"#3b82f6",revenue:"#10b981",costs:"#f59e0b",profit:"#22c55e",loss:"#ef4444",tmValue:"#8b5cf6",corValue:"#14b8a6",labor:"#6366f1",disposal:"#14b8a6",equipment:"#f97316",materials:"#a855f7",subcontractor:"#ec4899",other:"#6b7280"},Ie={duration:800},Ws={labor:{label:"Labor",color:V.labor,icon:"HardHat"},disposal:{label:"Disposal",color:V.disposal,icon:"Trash2"},equipment:{label:"Equipment",color:V.equipment,icon:"Truck"},materials:{label:"Materials",color:V.materials,icon:"Package"},subcontractor:{label:"Subcontractor",color:V.subcontractor,icon:"Users"},other:{label:"Other",color:V.other,icon:"MoreHorizontal"}},Ks=[{id:"7d",label:"7D",days:7},{id:"30d",label:"30D",days:30},{id:"90d",label:"90D",days:90},{id:"all",label:"All",days:null}],je=a=>a>=1e6?`$${(a/1e6).toFixed(1)}M`:a>=1e3?`$${(a/1e3).toFixed(0)}K`:`$${a.toFixed(0)}`,ft=a=>new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric"}),Il={revenue:{id:"revenueGradient",color:V.revenue,startOpacity:.3,endOpacity:0},costs:{id:"costsGradient",color:V.costs,startOpacity:.3,endOpacity:0},tmValue:{id:"tmValueGradient",color:V.tmValue,startOpacity:.2,endOpacity:0}};function Tl(a,s,n=[],t=null,r=[]){const c=s?.contract_value||0,o=a?.laborByDate||[],d=a?.haulOffByDate||[],h=a?.materialsEquipmentByDate||[],m=a?.customCosts||[],l=new Set;o.forEach(N=>l.add(N.date)),d.forEach(N=>l.add(N.date)),h.forEach(N=>l.add(N.date)),m.forEach(N=>{N.cost_date&&l.add(N.cost_date)}),n.forEach(N=>{N.work_date&&l.add(N.work_date),N.ticket_date&&l.add(N.ticket_date),N.created_at&&l.add(N.created_at.split("T")[0])}),r.forEach(N=>{N.status==="done"&&N.updated_at&&l.add(N.updated_at.split("T")[0])});const f=[...l].sort((N,R)=>new Date(N)-new Date(R));if(f.length===0)return[];const j={},b=r.reduce((N,R)=>N+(parseFloat(R.weight)||0),0);r.forEach(N=>{if(N.status==="done"&&N.updated_at){const R=N.updated_at.split("T")[0],F=parseFloat(N.weight)||0,k=N.scheduled_value?parseFloat(N.scheduled_value):b>0?F/b*c:0;j[R]||(j[R]=0),j[R]+=k}});let u=0,x=0;const C={};n.forEach(N=>{const R=N.work_date||N.ticket_date||N.created_at?.split("T")[0];if(!R)return;let F=0;const k=N.t_and_m_workers||N.workers||[];Array.isArray(k)&&k.forEach(O=>{const M=parseFloat(O.hours)||parseFloat(O.regular_hours)||0,z=parseFloat(O.overtime_hours)||0,G=parseFloat(O.regular_rate)||parseFloat(O.rate)||65,Y=parseFloat(O.overtime_rate)||G*1.5;F+=M*G+z*Y});const y=N.t_and_m_items||N.items||[];Array.isArray(y)&&y.forEach(O=>{const M=parseFloat(O.quantity)||1,z=parseFloat(O.unit_cost)||parseFloat(O.materials_equipment?.cost_per_unit)||0;F+=M*z}),C[R]||(C[R]=0),C[R]+=F});const S={};m.forEach(N=>{const R=N.cost_date;R&&(S[R]||(S[R]=0),S[R]+=parseFloat(N.amount)||0)});const p={};h.forEach(N=>{N.date&&(p[N.date]=N.cost||0)});let E=0;return f.map(N=>{const F=o.find(ve=>ve.date===N)?.cost||0,y=d.find(ve=>ve.date===N)?.cost||0,O=p[N]||0,M=S[N]||0,z=F+O+y+M;u+=z;const G=C[N]||0;x+=G;const Y=j[N]||0;E+=Y;const pe=Object.keys(j).length>0?E:a?.billable||0;return{date:N,contract:c,revenue:Math.round(pe),costs:Math.round(u),tmValue:Math.round(x),corValue:Math.round(t?.total_approved_value||0),profit:Math.round(pe-u),dailyLabor:Math.round(F),dailyRevenue:Math.round(Y),dailyMaterials:Math.round(O),dailyHaulOff:Math.round(y),dailyCustom:Math.round(M),dailyTM:Math.round(G),dailyTotal:Math.round(z)}})}function Ll(a,s){if(!s||!a.length)return a;const n=new Date,t=new Date;return t.setDate(n.getDate()-s),a.filter(r=>new Date(r.date)>=t)}function $l(a=0,s=0,n=[]){const t=[];a>0&&t.push({name:"Labor",value:a,color:V.labor,category:"labor"}),s>0&&t.push({name:"Disposal",value:s,color:V.disposal,category:"disposal"});const r={};n.forEach(o=>{const d=o.category||"other";r[d]||(r[d]={items:[],total:0}),r[d].items.push(o),r[d].total+=parseFloat(o.amount)||0}),Object.entries(r).forEach(([o,d])=>{if(d.total>0){const h=Ws[o]||Ws.other;t.push({name:h.label,value:d.total,color:h.color,category:o,items:d.items})}});const c=t.reduce((o,d)=>o+d.value,0);return t.forEach(o=>{o.percentage=c>0?Math.round(o.value/c*100):0}),t.sort((o,d)=>d.value-o.value),t}function Us(a,s){if(!a||a.length<2)return{direction:"flat",percentage:0};const n=a.slice(-7);if(n.length<2)return{direction:"flat",percentage:0};const t=n[0][s]||0,r=n[n.length-1][s]||0;if(t===0)return{direction:r>0?"up":"flat",percentage:0};const c=(r-t)/t*100;return{direction:c>5?"up":c<-5?"down":"flat",percentage:Math.abs(Math.round(c))}}function ql({active:a,payload:s,label:n}){if(!a||!s||!s.length)return null;const t=c=>c>=1e6?`$${(c/1e6).toFixed(2)}M`:c>=1e3?`$${(c/1e3).toFixed(1)}K`:`$${c.toFixed(0)}`,r=s[0]?.payload||{};return e.jsxs("div",{className:"chart-tooltip",children:[e.jsx("div",{className:"chart-tooltip-date",children:ft(n)}),e.jsxs("div",{className:"chart-tooltip-rows",children:[r.contract!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:V.contract}}),"Contract"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.contract)})]}),r.revenue!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:V.revenue}}),"Revenue"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.revenue)})]}),r.costs!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:V.costs}}),"Costs"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.costs)})]}),r.tmValue!==void 0&&r.tmValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:V.tmValue}}),"T&M Value"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.tmValue)})]}),r.corValue!==void 0&&r.corValue>0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:V.corValue}}),"COR Approved"]}),e.jsx("span",{className:"chart-tooltip-value",children:t(r.corValue)})]}),r.profit!==void 0&&e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:r.profit>=0?V.profit:V.loss}}),r.profit>=0?"Profit":"Loss"]}),e.jsx("span",{className:"chart-tooltip-value",style:{color:r.profit>=0?V.profit:V.loss},children:t(Math.abs(r.profit))})]})]}),(r.dailyRevenue>0||r.dailyLabor>0||r.dailyMaterials>0||r.dailyHaulOff>0||r.dailyTM>0)&&e.jsxs("div",{className:"chart-tooltip-daily",children:[e.jsx("div",{className:"chart-tooltip-daily-label",children:"Today's Activity"}),r.dailyRevenue>0&&e.jsx("div",{className:"chart-tooltip-daily-row earned",children:e.jsxs("span",{style:{color:V.revenue},children:["Areas Completed: ",t(r.dailyRevenue)]})}),r.dailyLabor>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Labor: ",t(r.dailyLabor)]}),r.dailyMaterials>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Materials: ",t(r.dailyMaterials)]}),r.dailyHaulOff>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["Disposal: ",t(r.dailyHaulOff)]}),r.dailyTM>0&&e.jsxs("div",{className:"chart-tooltip-daily-row",children:["T&M Added: ",t(r.dailyTM)]}),r.dailyTotal>0&&e.jsx("div",{className:"chart-tooltip-daily-row total",children:e.jsxs("strong",{children:["Day Costs: ",t(r.dailyTotal)]})})]}),e.jsx("div",{className:"chart-tooltip-hint",children:"Click to see details"})]})}function Vl({projectData:a,project:s,tmTickets:n=[],corStats:t=null,areas:r=[],onDrillDown:c}){const[o,d]=i.useState("30d"),[h,m]=i.useState(null),l=i.useMemo(()=>{const x=Tl(a,s,n,t,r),C=Ks.find(S=>S.id===o);return Ll(x,C?.days)},[a,s,n,t,r,o]),f=i.useMemo(()=>Us(l,"costs"),[l]),j=i.useMemo(()=>Us(l,"revenue"),[l]),b=x=>{if(x?.activePayload?.[0]){const C=x.activePayload[0].payload;c?.(C.date,C)}},u=({trend:x})=>x.direction==="up"?e.jsx(ga,{size:14,className:"trend-icon up"}):x.direction==="down"?e.jsx(ja,{size:14,className:"trend-icon down"}):e.jsx(Wa,{size:14,className:"trend-icon flat"});return l.length?e.jsxs("div",{className:"financial-trend-chart",children:[e.jsxs("div",{className:"chart-header",children:[e.jsxs("div",{className:"chart-title-section",children:[e.jsx("h3",{children:"Financial Trend"}),e.jsxs("div",{className:"chart-trend-indicators",children:[e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:V.revenue},children:"Revenue"}),e.jsx(u,{trend:j}),j.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[j.percentage,"%"]})]}),e.jsxs("span",{className:"trend-badge",children:[e.jsx("span",{style:{color:V.costs},children:"Costs"}),e.jsx(u,{trend:f}),f.percentage>0&&e.jsxs("span",{className:"trend-pct",children:[f.percentage,"%"]})]})]})]}),e.jsx("div",{className:"time-range-selector",children:Ks.map(x=>e.jsx("button",{className:o===x.id?"active":"",onClick:()=>d(x.id),children:x.label},x.id))})]}),e.jsx("div",{className:"chart-container",children:e.jsx(tt,{width:"100%",height:300,children:e.jsxs(hl,{data:l,onClick:b,margin:{top:10,right:10,left:0,bottom:0},children:[e.jsx("defs",{children:Object.values(Il).map(x=>e.jsxs("linearGradient",{id:x.id,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:x.color,stopOpacity:x.startOpacity}),e.jsx("stop",{offset:"95%",stopColor:x.color,stopOpacity:x.endOpacity})]},x.id))}),e.jsx(Er,{strokeDasharray:"3 3",stroke:"var(--border-color)",vertical:!1}),e.jsx(Sr,{dataKey:"date",tickFormatter:ft,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:{stroke:"var(--border-color)"}}),e.jsx(_r,{tickFormatter:je,stroke:"var(--text-secondary)",tick:{fontSize:11},tickLine:!1,axisLine:!1,width:60}),e.jsx(nt,{content:e.jsx(ql,{})}),e.jsx(Ka,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,formatter:x=>e.jsx("span",{style:{color:"var(--text-secondary)",fontSize:"12px"},children:x})}),l[0]?.contract>0&&e.jsx(ct,{y:l[0].contract,stroke:V.contract,strokeDasharray:"5 5",strokeWidth:2,label:{value:"Contract",position:"right",fill:V.contract,fontSize:11}}),e.jsx(Me,{type:"monotone",dataKey:"revenue",name:"Revenue",stroke:V.revenue,strokeWidth:2,fill:"url(#revenueGradient)",animationDuration:Ie.duration,onMouseEnter:()=>m("revenue"),onMouseLeave:()=>m(null),style:{opacity:h&&h!=="revenue"?.3:1}}),e.jsx(Me,{type:"monotone",dataKey:"costs",name:"Costs",stroke:V.costs,strokeWidth:2,fill:"url(#costsGradient)",animationDuration:Ie.duration,onMouseEnter:()=>m("costs"),onMouseLeave:()=>m(null),style:{opacity:h&&h!=="costs"?.3:1}}),l.some(x=>x.tmValue>0)&&e.jsx(Me,{type:"monotone",dataKey:"tmValue",name:"T&M Value",stroke:V.tmValue,strokeWidth:2,fill:"url(#tmValueGradient)",animationDuration:Ie.duration,onMouseEnter:()=>m("tmValue"),onMouseLeave:()=>m(null),style:{opacity:h&&h!=="tmValue"?.3:1}}),l.some(x=>x.corValue>0)&&e.jsx(Me,{type:"monotone",dataKey:"corValue",name:"COR Approved",stroke:V.corValue,strokeWidth:2,strokeDasharray:"4 2",fill:"transparent",animationDuration:Ie.duration,onMouseEnter:()=>m("corValue"),onMouseLeave:()=>m(null),style:{opacity:h&&h!=="corValue"?.3:1}})]})})}),e.jsxs("div",{className:"chart-quick-stats",children:[e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Current Revenue"}),e.jsx("span",{className:"stat-value",style:{color:V.revenue},children:je(l[l.length-1]?.revenue||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Total Costs"}),e.jsx("span",{className:"stat-value",style:{color:V.costs},children:je(l[l.length-1]?.costs||0)})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"Margin"}),e.jsx("span",{className:"stat-value",style:{color:(l[l.length-1]?.profit||0)>=0?V.profit:V.loss},children:(()=>{const x=l[l.length-1];return!x||!x.revenue?"0%":`${((x.revenue-x.costs)/x.revenue*100).toFixed(1)}%`})()})]}),l[l.length-1]?.tmValue>0&&e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-label",children:"T&M Pending"}),e.jsx("span",{className:"stat-value",style:{color:V.tmValue},children:je(l[l.length-1]?.tmValue||0)})]})]})]}):e.jsx("div",{className:"financial-trend-chart empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No financial data available yet."}),e.jsx("span",{children:"Start tracking labor and costs to see trends."})]})})}function Fl({laborCost:a=0,haulOffCost:s=0,customCosts:n=[],onSegmentClick:t}){const[r,c]=i.useState(null),o=i.useMemo(()=>$l(a,s,n),[a,s,n]),d=i.useMemo(()=>o.reduce((b,u)=>b+u.value,0),[o]),h=(b,u)=>{c(u)},m=()=>{c(null)},l=(b,u)=>{t&&t(o[u])},f=({active:b,payload:u})=>{if(!b||!u||!u.length)return null;const x=u[0].payload;return e.jsxs("div",{className:"chart-tooltip donut-tooltip",children:[e.jsxs("div",{className:"chart-tooltip-row",children:[e.jsxs("span",{className:"chart-tooltip-label",children:[e.jsx("span",{className:"chart-tooltip-dot",style:{backgroundColor:x.color}}),x.name]}),e.jsx("span",{className:"chart-tooltip-value",children:je(x.value)})]}),e.jsxs("div",{className:"donut-tooltip-pct",children:[x.percentage,"% of total costs"]}),x.items&&x.items.length>0&&e.jsx("div",{className:"donut-tooltip-items",children:e.jsxs("div",{className:"donut-tooltip-items-label",children:[x.items.length," item",x.items.length>1?"s":""]})}),t&&e.jsx("div",{className:"chart-tooltip-hint",children:"Click to view details"})]})},j=b=>{const{payload:u}=b;return e.jsx("div",{className:"donut-legend",children:u.map((x,C)=>e.jsxs("div",{className:`donut-legend-item ${r===C?"active":""}`,onMouseEnter:()=>c(C),onMouseLeave:()=>c(null),onClick:()=>l(null,C),children:[e.jsx("span",{className:"donut-legend-color",style:{backgroundColor:x.payload.color}}),e.jsx("span",{className:"donut-legend-name",children:x.value}),e.jsx("span",{className:"donut-legend-value",children:je(x.payload.value)})]},`legend-${C}`))})};return!o.length||d===0?e.jsx("div",{className:"cost-donut empty",children:e.jsxs("div",{className:"chart-empty-state",children:[e.jsx("p",{children:"No cost data available."}),e.jsx("span",{children:"Add labor, disposal, or custom costs to see breakdown."})]})}):e.jsx("div",{className:"cost-donut",children:e.jsxs("div",{className:"donut-chart-container",children:[e.jsx(tt,{width:"100%",height:200,children:e.jsxs(Pr,{children:[e.jsx(Or,{data:o,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",onMouseEnter:h,onMouseLeave:m,onClick:l,animationDuration:Ie.duration,animationEasing:"ease-out",children:o.map((b,u)=>e.jsx(Ar,{fill:b.color,stroke:"var(--card-bg)",strokeWidth:2,style:{filter:r===u?"brightness(1.1)":"none",cursor:t?"pointer":"default",transform:r===u?"scale(1.05)":"scale(1)",transformOrigin:"center",transition:"all 0.2s ease"}},`cell-${u}`))}),e.jsx(nt,{content:e.jsx(f,{})}),e.jsx(Ka,{content:j})]})}),e.jsxs("div",{className:"donut-center-label",children:[e.jsx("span",{className:"donut-center-value",children:je(d)}),e.jsx("span",{className:"donut-center-text",children:"Total"})]})]})})}const Ma=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a||0),la={labor:{label:"Labor",Icon:ma,color:"#3b82f6"},disposal:{label:"Disposal",Icon:Te,color:"#10b981"},equipment:{label:"Equipment",Icon:Hr,color:"#f59e0b"},materials:{label:"Materials",Icon:Ur,color:"#8b5cf6"},subcontractor:{label:"Subcontractor",Icon:Ve,color:"#ec4899"},other:{label:"Other",Icon:Kr,color:"#6b7280"}};function zl({laborCost:a=0,haulOffCost:s=0,customCosts:n=[],onAddCost:t,onDeleteCost:r}){const[c,o]=i.useState(!0),[d,h]=i.useState(null),m=[];a>0&&m.push({category:"labor",label:"Labor",amount:a,source:"auto",description:"From crew check-ins"}),s>0&&m.push({category:"disposal",label:"Disposal",amount:s,source:"auto",description:"From haul-off logs"});const l={};n.forEach(u=>{l[u.category]||(l[u.category]={category:u.category,items:[],total:0}),l[u.category].items.push(u),l[u.category].total+=parseFloat(u.amount)||0}),Object.values(l).forEach(u=>{const x=la[u.category]||la.other;m.push({category:u.category,label:x.label,amount:u.total,source:"manual",items:u.items})});const f=m.reduce((u,x)=>u+x.amount,0);m.forEach(u=>{u.percentage=f>0?u.amount/f*100:0}),m.sort((u,x)=>x.amount-u.amount);const j=u=>{h(d===u?null:u)},b=u=>{u.items&&u.items.length>0&&(o(!1),h(u.category))};return e.jsxs("div",{className:"cost-contributors-card",children:[e.jsxs("div",{className:"cost-contributors-header",children:[e.jsxs("div",{className:"cost-contributors-title",children:[e.jsx("h3",{children:"Cost Contributors"}),e.jsx("span",{className:"cost-total",children:Ma(f)})]}),m.length>0&&e.jsxs("div",{className:"cost-view-toggle",children:[e.jsx("button",{className:c?"active":"",onClick:()=>o(!0),children:"Chart"}),e.jsx("button",{className:c?"":"active",onClick:()=>o(!1),children:"List"})]})]}),m.length===0?e.jsxs("div",{className:"cost-empty",children:[e.jsx("p",{children:"No costs recorded yet"}),e.jsx("small",{children:"Costs will appear as crew checks in and haul-offs are logged"})]}):c?e.jsx(Fl,{laborCost:a,haulOffCost:s,customCosts:n,onSegmentClick:b}):e.jsx("div",{className:"cost-breakdown",children:m.map(u=>{const x=la[u.category]||la.other,C=x.Icon,S=u.items&&u.items.length>0,p=d===u.category;return e.jsxs("div",{className:"cost-category",children:[e.jsxs("div",{className:`cost-category-row ${S?"expandable":""}`,onClick:()=>S&&j(u.category),children:[e.jsx("div",{className:"cost-category-bar-container",children:e.jsx("div",{className:"cost-category-bar",style:{width:`${Math.max(u.percentage,2)}%`,backgroundColor:x.color}})}),e.jsxs("div",{className:"cost-category-info",children:[e.jsxs("div",{className:"cost-category-label",children:[e.jsx(C,{size:14,style:{color:x.color}}),e.jsx("span",{children:u.label}),u.source==="auto"&&e.jsx("span",{className:"cost-auto-badge",children:"Auto"}),S&&(p?e.jsx(fa,{size:14}):e.jsx(We,{size:14}))]}),e.jsxs("div",{className:"cost-category-values",children:[e.jsx("span",{className:"cost-amount",children:Ma(u.amount)}),e.jsxs("span",{className:"cost-percent",children:[Math.round(u.percentage),"%"]})]})]})]}),p&&S&&e.jsx("div",{className:"cost-category-items",children:u.items.map(E=>e.jsxs("div",{className:"cost-item",children:[e.jsxs("div",{className:"cost-item-info",children:[e.jsx("span",{className:"cost-item-desc",children:E.description}),e.jsx("span",{className:"cost-item-date",children:new Date(E.cost_date).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]}),e.jsxs("div",{className:"cost-item-actions",children:[e.jsx("span",{className:"cost-item-amount",children:Ma(E.amount)}),r&&e.jsx("button",{className:"cost-item-delete",onClick:g=>{g.stopPropagation(),confirm("Delete this cost entry?")&&r(E.id)},children:e.jsx(it,{size:14})})]})]},E.id))})]},u.category)})}),t&&e.jsxs("button",{className:"cost-add-btn",onClick:t,children:[e.jsx(Fe,{size:16}),e.jsx("span",{children:"Add Cost"})]})]})}const fe=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a||0);function Bl({revenue:a,totalCosts:s,contractValue:n,progress:t}){const r=a-s,c=a>0?r/a*100:0,o=n,d=t>0?s/(t/100):s,h=o-d,m=o>0?h/o*100:0,l=c>=20,f=c>=0&&c<20,j=c<0,b=l?"healthy":f?"warning":"loss",u=l?"On Track":f?"Watch Margin":"Over Cost",x=l?Gr:f?Ke:ja;return e.jsxs("div",{className:`profitability-card ${b}`,children:[e.jsxs("div",{className:"profitability-header",children:[e.jsx("h3",{children:"Profitability"}),e.jsxs("div",{className:`profitability-status ${b}`,children:[e.jsx(x,{size:14}),e.jsx("span",{children:u})]})]}),e.jsxs("div",{className:"profitability-metrics",children:[e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Current Margin"}),e.jsxs("span",{className:`profit-metric-value ${c<0?"negative":""}`,children:[Math.round(c),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${c<0?"negative":c<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(c),100)}%`}})})]}),t>10&&e.jsxs("div",{className:"profit-metric",children:[e.jsxs("div",{className:"profit-metric-header",children:[e.jsx("span",{className:"profit-metric-label",children:"Projected Final"}),e.jsxs("span",{className:`profit-metric-value ${m<0?"negative":""}`,children:[Math.round(m),"%"]})]}),e.jsx("div",{className:"profit-bar-container",children:e.jsx("div",{className:`profit-bar ${m<0?"negative":m<20?"warning":"healthy"}`,style:{width:`${Math.min(Math.abs(m),100)}%`}})})]})]}),e.jsxs("div",{className:"profitability-summary",children:[e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Revenue Earned"}),e.jsx("span",{className:"profit-value",children:fe(a)})]}),e.jsxs("div",{className:"profit-row",children:[e.jsx("span",{className:"profit-label",children:"Total Costs"}),e.jsxs("span",{className:"profit-value negative",children:["- ",fe(s)]})]}),e.jsxs("div",{className:"profit-row profit-total",children:[e.jsx("span",{className:"profit-label",children:"Current Profit"}),e.jsxs("span",{className:`profit-value ${r<0?"negative":"positive"}`,children:[r>=0?"":"-",fe(Math.abs(r))]})]})]}),t>10&&e.jsxs("div",{className:"profitability-insight",children:[l&&e.jsxs("p",{children:["At ",Math.round(t),"% complete, you're at ",fe(r)," profit.",h>0&&` Projected final profit: ${fe(h)}`]}),f&&e.jsxs("p",{children:["Margins are thin. Consider reviewing costs or scope.",h<0&&` Trending toward ${fe(h)} loss.`]}),j&&e.jsxs("p",{children:["Currently over cost by ",fe(Math.abs(r)),". Immediate review recommended."]})]})]})}const jt=[{value:"concrete",label:"Concrete",icon:"🧱"},{value:"trash",label:"Trash",icon:"🗑️"},{value:"metals",label:"Metals",icon:"🔩"},{value:"hazardous_waste",label:"Hazardous",icon:"☣️"}],Wl=a=>jt.find(s=>s.value===a)||{label:a,icon:"📦"};function Kl({project:a,period:s="week"}){const[n,t]=i.useState([]),[r,c]=i.useState(!0),[o,d]=i.useState(!1);i.useEffect(()=>{a?.id&&h()},[a?.id,s]);const h=async()=>{try{c(!0);const u=s==="week"?7:s==="month"?30:14,x=await T.getDisposalLoadsHistory(a.id,u);t(x||[])}catch(u){console.error("Error loading disposal summary:",u)}finally{c(!1)}},m=n.reduce((u,x)=>{const C=x.load_type;return u[C]||(u[C]=0),u[C]+=x.load_count,u},{}),l=n.reduce((u,x)=>{const C=x.load_date||x.work_date;return u[C]||(u[C]={date:C,loads:[],total:0}),u[C].loads.push(x),u[C].total+=x.load_count,u},{}),f=Object.values(l).sort((u,x)=>new Date(x.date)-new Date(u.date)).slice(0,7),j=n.reduce((u,x)=>u+x.load_count,0),b=j>0;return r?e.jsxs("div",{className:"disposal-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"header-left",children:[e.jsx(Te,{size:18}),e.jsx("span",{children:"Disposal Loads"})]})}),e.jsx("div",{className:"card-loading",children:"Loading..."})]}):e.jsxs("div",{className:"disposal-summary-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx(Te,{size:18}),e.jsx("span",{children:"Disposal Loads"})]}),e.jsx("span",{className:"period-badge",children:s==="week"?"Last 7 days":s==="month"?"Last 30 days":"Last 14 days"})]}),b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"disposal-total",children:[e.jsx("span",{className:"disposal-total-value",children:j}),e.jsx("span",{className:"disposal-total-label",children:"Total Loads"})]}),e.jsx("div",{className:"disposal-breakdown",children:jt.map(u=>{const x=m[u.value]||0;if(x===0)return null;const C=Math.round(x/j*100);return e.jsxs("div",{className:"disposal-type-row",children:[e.jsxs("div",{className:"disposal-type-info",children:[e.jsx("span",{className:"disposal-type-icon",children:u.icon}),e.jsx("span",{className:"disposal-type-label",children:u.label})]}),e.jsxs("div",{className:"disposal-type-stats",children:[e.jsx("span",{className:"disposal-type-count",children:x}),e.jsx("div",{className:"disposal-type-bar",children:e.jsx("div",{className:"disposal-type-bar-fill",style:{width:`${C}%`}})})]})]},u.value)})}),f.length>0&&e.jsxs("button",{className:"disposal-expand-btn",onClick:()=>d(!o),children:[o?e.jsx(fa,{size:16}):e.jsx(We,{size:16}),e.jsxs("span",{children:[o?"Hide":"View"," Daily Breakdown"]})]}),o&&f.length>0&&e.jsx("div",{className:"disposal-daily-breakdown",children:f.map(u=>{const x=new Date(u.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),C=u.loads.reduce((S,p)=>(S[p.load_type]||(S[p.load_type]=0),S[p.load_type]+=p.load_count,S),{});return e.jsxs("div",{className:"disposal-daily-row",children:[e.jsxs("div",{className:"disposal-daily-header",children:[e.jsx("span",{className:"disposal-daily-date",children:x}),e.jsxs("span",{className:"disposal-daily-total",children:[u.total," loads"]})]}),e.jsx("div",{className:"disposal-daily-types",children:Object.entries(C).map(([S,p])=>{const E=Wl(S);return e.jsxs("span",{className:"disposal-daily-type",children:[E.icon," ",p]},S)})})]},u.date)})})]}):e.jsxs("div",{className:"disposal-empty-state",children:[e.jsx(Te,{size:32}),e.jsx("p",{children:"No disposal loads recorded"}),e.jsx("span",{className:"text-muted",children:"Loads will appear here when logged by field crews"})]})]})}const Hs=["Project Manager","Superintendent","Foreman","Office Support","Engineer","Inspector","Team Member"];function Ul({project:a,company:s,user:n,isAdmin:t,onShowToast:r}){const[c,o]=i.useState([]),[d,h]=i.useState([]),[m,l]=i.useState(!0),[f,j]=i.useState(!1),[b,u]=i.useState(""),[x,C]=i.useState("Team Member"),[S,p]=i.useState(null);i.useEffect(()=>{a?.id&&E()},[a?.id]),i.useEffect(()=>{f&&s?.id&&g()},[f,s?.id]);const E=async()=>{try{l(!0);const k=await T.getProjectTeam(a.id);o(k)}catch(k){console.error("Error loading project team:",k)}finally{l(!1)}},g=async()=>{try{const k=await T.getCompanyMembers(s.id),y=c.map(M=>M.users?.id),O=k.filter(M=>!y.includes(M.users?.id));h(O)}catch(k){console.error("Error loading company members:",k)}},N=async()=>{if(!b){r("Select a team member","error");return}try{p("add"),await T.addProjectMember(a.id,b,x,n.id),r("Team member added","success"),j(!1),u(""),C("Team Member"),E()}catch(k){console.error("Error adding team member:",k),r("Error adding team member","error")}finally{p(null)}},R=async(k,y)=>{try{p(k.id),await T.updateProjectMemberRole(a.id,k.users?.id,y),r("Role updated","success"),E()}catch(O){console.error("Error updating role:",O),r("Error updating role","error")}finally{p(null)}},F=async k=>{try{p(k.id),await T.removeProjectMember(a.id,k.users?.id),r("Team member removed","success"),E()}catch(y){console.error("Error removing team member:",y),r("Error removing team member","error")}finally{p(null)}};return m?e.jsxs("div",{className:"project-team",children:[e.jsx("div",{className:"project-team-header",children:e.jsxs("h3",{children:[e.jsx(Ve,{size:18})," Project Team"]})}),e.jsx("div",{className:"loading-small",children:"Loading..."})]}):e.jsxs("div",{className:"project-team",children:[e.jsxs("div",{className:"project-team-header",children:[e.jsxs("h3",{children:[e.jsx(Ve,{size:18})," Project Team"]}),t&&e.jsxs("button",{className:"btn btn-small btn-primary",onClick:()=>j(!0),children:[e.jsx(Yr,{size:14})," Add"]})]}),c.length===0?e.jsxs("div",{className:"project-team-empty",children:["No team members assigned yet",t&&e.jsx("p",{children:'Click "Add" to assign team members to this project'})]}):e.jsx("div",{className:"project-team-list",children:c.map(k=>e.jsxs("div",{className:"project-team-member",children:[e.jsxs("div",{className:"team-member-info",children:[e.jsx("div",{className:"team-member-name",children:k.users?.name||"Unknown"}),e.jsx("div",{className:"team-member-email",children:k.users?.email})]}),e.jsx("div",{className:"team-member-role",children:t?e.jsxs("div",{className:"role-selector compact",children:[e.jsx("select",{value:k.project_role,onChange:y=>R(k,y.target.value),disabled:S===k.id,className:"role-select",children:Hs.map(y=>e.jsx("option",{value:y,children:y},y))}),e.jsx(We,{size:12,className:"role-select-icon"})]}):e.jsx("span",{className:"role-badge",children:k.project_role})}),t&&e.jsx("button",{className:"btn-icon btn-danger-subtle",onClick:()=>F(k),disabled:S===k.id,title:"Remove from project",children:e.jsx(Xr,{size:14})})]},k.id))}),f&&e.jsx("div",{className:"modal-overlay",onClick:()=>j(!1),children:e.jsxs("div",{className:"modal-content small",onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Team Member"}),e.jsx("button",{className:"modal-close",onClick:()=>j(!1),children:e.jsx(Be,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Team Member"}),e.jsxs("select",{value:b,onChange:k=>u(k.target.value),className:"form-select",children:[e.jsx("option",{value:"",children:"Choose a team member..."}),d.map(k=>e.jsx("option",{value:k.users?.id,children:k.users?.name||k.users?.email},k.users?.id))]}),d.length===0&&e.jsx("p",{className:"form-hint",children:"All company members are already assigned to this project"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Role"}),e.jsx("select",{value:x,onChange:k=>C(k.target.value),className:"form-select",children:Hs.map(k=>e.jsx("option",{value:k,children:k},k))}),e.jsx("p",{className:"form-hint",children:"This is for visibility only - it doesn't affect permissions"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>j(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:N,disabled:!b||S==="add",children:S==="add"?"Adding...":"Add to Project"})]})]})})]})}const B=i.memo(function({width:s,height:n,borderRadius:t="8px",className:r="",variant:c="default"}){const d=(()=>{switch(c){case"text":return{height:"1em",borderRadius:"4px"};case"circular":return{borderRadius:"50%"};case"rectangular":return{borderRadius:"0"};default:return{borderRadius:t}}})();return e.jsx("div",{className:`skeleton ${r}`,style:{width:s||"100%",height:n||d.height||"1rem",borderRadius:d.borderRadius},"aria-hidden":"true"})});i.memo(function({showProgress:s=!1}){return e.jsxs("div",{className:"metric-skeleton",children:[e.jsx(B,{width:"60%",height:"0.75rem",className:"skeleton-label"}),e.jsx(B,{width:"80%",height:"1.75rem",className:"skeleton-value"}),s&&e.jsx(B,{width:"100%",height:"6px",className:"skeleton-progress"})]})});const jc=i.memo(function({lines:s=3,showHeader:n=!0,showAction:t=!1}){return e.jsxs("div",{className:"card-skeleton","aria-busy":"true","aria-label":"Loading content",children:[n&&e.jsxs("div",{className:"card-skeleton-header",children:[e.jsx(B,{width:"40%",height:"1.25rem"}),t&&e.jsx(B,{width:"80px",height:"32px"})]}),e.jsx("div",{className:"card-skeleton-body",children:Array.from({length:s}).map((r,c)=>e.jsx(B,{width:`${100-c*15}%`,height:"1rem",className:"skeleton-line"},c))})]})});i.memo(function({count:s=3,showAvatar:n=!1,showAction:t=!1}){return e.jsx("div",{className:"list-skeleton","aria-busy":"true","aria-label":"Loading list",children:Array.from({length:s}).map((r,c)=>e.jsxs("div",{className:"list-item-skeleton",children:[n&&e.jsx(B,{width:"40px",height:"40px",variant:"circular"}),e.jsxs("div",{className:"list-item-skeleton-content",children:[e.jsx(B,{width:"60%",height:"1rem"}),e.jsx(B,{width:"40%",height:"0.75rem"})]}),t&&e.jsx(B,{width:"60px",height:"28px"})]},c))})});i.memo(function(){return e.jsx("div",{className:"financial-row-skeleton","aria-busy":"true","aria-label":"Loading financial data",children:[1,2,3].map(s=>e.jsxs("div",{className:"financial-card-skeleton",children:[e.jsxs("div",{className:"financial-card-skeleton-header",children:[e.jsx(B,{width:"24px",height:"24px",variant:"circular"}),e.jsx(B,{width:"60%",height:"1rem"})]}),e.jsx(B,{width:"50%",height:"2rem",className:"skeleton-hero-value"}),e.jsxs("div",{className:"financial-card-skeleton-details",children:[e.jsx(B,{width:"100%",height:"0.875rem"}),e.jsx(B,{width:"80%",height:"0.875rem"})]})]},s))})});i.memo(function({height:s="200px"}){return e.jsxs("div",{className:"chart-skeleton",style:{height:s},"aria-busy":"true","aria-label":"Loading chart",children:[e.jsx("div",{className:"chart-skeleton-bars",children:[40,65,45,80,55,70,50,75,60,85].map((n,t)=>e.jsx("div",{className:"chart-skeleton-bar",style:{height:`${n}%`}},t))}),e.jsx(B,{width:"100%",height:"1px",className:"chart-skeleton-axis"})]})});const we=i.memo(function({count:s=3}){return e.jsx("div",{className:"ticket-skeleton-list","aria-busy":"true","aria-label":"Loading tickets",children:Array.from({length:s}).map((n,t)=>e.jsxs("div",{className:"ticket-skeleton-item",children:[e.jsxs("div",{className:"ticket-skeleton-header",children:[e.jsx(B,{width:"100px",height:"0.875rem"}),e.jsx(B,{width:"80px",height:"24px",borderRadius:"12px"})]}),e.jsx(B,{width:"90%",height:"1rem"}),e.jsxs("div",{className:"ticket-skeleton-footer",children:[e.jsx(B,{width:"60px",height:"0.75rem"}),e.jsx(B,{width:"60px",height:"0.75rem"}),e.jsx(B,{width:"60px",height:"0.75rem"})]})]},t))})}),Hl=i.memo(function(){return e.jsx("div",{className:"hero-metrics-skeleton","aria-busy":"true","aria-label":"Loading metrics",children:[1,2,3,4].map(s=>e.jsxs("div",{className:"hero-metric-skeleton",children:[e.jsx(B,{width:"80px",height:"0.75rem",className:"skeleton-label"}),e.jsx(B,{width:"120px",height:"1.75rem",className:"skeleton-value"}),e.jsx(B,{width:"100%",height:"4px",className:"skeleton-bar"})]},s))})}),gc=i.memo(function({title:s="Unable to load data",message:n="Something went wrong. Please try again.",error:t=null,onRetry:r=null,retryLabel:c="Try Again",variant:o="default",icon:d=null}){const m=d||(t?.message?.includes("network")||t?.message?.includes("offline")?Jr:ua);return o==="compact"?e.jsxs("div",{className:"error-state error-state-compact",role:"alert",children:[e.jsx(m,{size:16,className:"error-state-icon","aria-hidden":"true"}),e.jsx("span",{className:"error-state-message",children:n}),r&&e.jsx("button",{className:"btn btn-ghost btn-small",onClick:r,"aria-label":c,children:e.jsx(Oa,{size:14})})]}):o==="inline"?e.jsxs("div",{className:"error-state error-state-inline",role:"alert",children:[e.jsxs("div",{className:"error-state-content",children:[e.jsx(m,{size:20,className:"error-state-icon","aria-hidden":"true"}),e.jsxs("div",{className:"error-state-text",children:[e.jsx("span",{className:"error-state-title",children:s}),e.jsx("span",{className:"error-state-message",children:n})]})]}),r&&e.jsxs("button",{className:"btn btn-secondary btn-small",onClick:r,children:[e.jsx(Oa,{size:14})," ",c]})]}):e.jsxs("div",{className:"error-state",role:"alert","aria-live":"polite",children:[e.jsx("div",{className:"error-state-icon-wrapper",children:e.jsx(m,{size:32,className:"error-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"error-state-title",children:s}),e.jsx("p",{className:"error-state-message",children:n}),!1,r&&e.jsxs("button",{className:"btn btn-primary",onClick:r,children:[e.jsx(Oa,{size:16})," ",c]})]})}),bc=i.memo(function({title:s="No data yet",message:n="Items will appear here once added.",icon:t=null,action:r=null,actionLabel:c="Get Started",onAction:o=null}){return e.jsxs("div",{className:"empty-state",role:"status",children:[t&&e.jsx("div",{className:"empty-state-icon-wrapper",children:e.jsx(t,{size:32,className:"empty-state-icon","aria-hidden":"true"})}),e.jsx("h4",{className:"empty-state-title",children:s}),e.jsx("p",{className:"empty-state-message",children:n}),o&&e.jsx("button",{className:"btn btn-primary btn-small",onClick:o,children:c}),r&&!o&&r]})});i.memo(function({label:s,error:n,required:t=!1,hint:r,children:c,className:o=""}){return e.jsxs("div",{className:`form-field ${n?"has-error":""} ${o}`,children:[s&&e.jsxs("label",{className:"form-field-label",children:[s,t&&e.jsx("span",{className:"form-field-required",children:"*"})]}),e.jsx("div",{className:"form-field-input",children:c}),n&&e.jsxs("div",{className:"form-field-error",role:"alert",children:[e.jsx(Ke,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:n})]}),r&&!n&&e.jsx("div",{className:"form-field-hint",children:r})]})});i.memo(function({type:s="text",value:n,onChange:t,onBlur:r,error:c,placeholder:o,disabled:d,min:h,max:m,step:l,pattern:f,required:j,autoComplete:b,name:u,id:x,className:C="","aria-label":S,"aria-describedby":p}){const E=x||u,g=c?`${E}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:s,id:E,name:u,value:n,onChange:t,onBlur:r,placeholder:o,disabled:d,min:h,max:m,step:l,pattern:f,required:j,autoComplete:b,className:`validated-input ${c?"has-error":""} ${C}`,"aria-label":S,"aria-invalid":!!c,"aria-describedby":c?g:p}),c&&e.jsxs("div",{id:g,className:"input-error-inline",role:"alert",children:[e.jsx(Ke,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:c})]})]})});i.memo(function({value:s,onChange:n,onBlur:t,error:r,disabled:c,required:o,name:d,id:h,className:m="",children:l,"aria-label":f}){const j=h||d,b=r?`${j}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("select",{id:j,name:d,value:s,onChange:n,onBlur:t,disabled:c,required:o,className:`validated-select ${r?"has-error":""} ${m}`,"aria-label":f,"aria-invalid":!!r,"aria-describedby":r?b:void 0,children:l}),r&&e.jsxs("div",{id:b,className:"input-error-inline",role:"alert",children:[e.jsx(Ke,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:r})]})]})});i.memo(function({value:s,onChange:n,onBlur:t,error:r,placeholder:c,disabled:o,required:d,rows:h=3,maxLength:m,name:l,id:f,className:j="","aria-label":b}){const u=f||l,x=r?`${u}-error`:void 0;return e.jsxs(e.Fragment,{children:[e.jsx("textarea",{id:u,name:l,value:s,onChange:n,onBlur:t,placeholder:c,disabled:o,required:d,rows:h,maxLength:m,className:`validated-textarea ${r?"has-error":""} ${j}`,"aria-label":b,"aria-invalid":!!r,"aria-describedby":r?x:void 0}),m&&e.jsxs("div",{className:"textarea-counter",children:[s?.length||0," / ",m]}),r&&e.jsxs("div",{id:x,className:"input-error-inline",role:"alert",children:[e.jsx(Ke,{size:12,"aria-hidden":"true"}),e.jsx("span",{children:r})]})]})});const Gl=i.memo(function({count:s,label:n,variant:t="default",size:r="medium",pulse:c=!1,icon:o}){const[d,h]=i.useState(s),[m,l]=i.useState(!1);return i.useEffect(()=>{if(s!==d){l(!0);const f=setTimeout(()=>{l(!1),h(s)},400);return()=>clearTimeout(f)}},[s,d]),e.jsxs("span",{className:`count-badge count-badge-${t} count-badge-${r} ${c?"badge-new":""} ${m?"animate-count-up":""}`,title:n,children:[o&&e.jsx(o,{size:r==="small"?12:r==="large"?18:14}),e.jsx("span",{className:"count-badge-value",children:s}),n&&e.jsx("span",{className:"count-badge-label",children:n})]})}),Yl=i.memo(function({value:s,max:n=100,showLabel:t=!1,size:r="medium",variant:c="default",animated:o=!0}){const d=Math.min(100,Math.max(0,s/n*100)),h=r==="small"?"4px":r==="large"?"8px":"6px",m=c==="default"?d>=80?"danger":d>=60?"warning":"success":c;return e.jsxs("div",{className:`mini-progress mini-progress-${r}`,children:[e.jsx("div",{className:"mini-progress-track",style:{height:h},children:e.jsx("div",{className:`mini-progress-fill mini-progress-${m} ${o?"progress-animate":""}`,style:{width:`${d}%`}})}),t&&e.jsxs("span",{className:"mini-progress-label",children:[Math.round(d),"%"]})]})}),Xl=i.memo(function({value:s,previousValue:n,format:t="percent",inverted:r=!1,showValue:c=!0}){const o=s-n,d=n!==0?o/n*100:0;let h=o===0?"neutral":o>0?"up":"down",m="neutral";o!==0&&(r?m=o>0?"negative":"positive":m=o>0?"positive":"negative");const l=h==="up"?ga:h==="down"?ja:Wa,f=()=>{const j=Math.abs(o);switch(t){case"percent":return`${Math.abs(d).toFixed(1)}%`;case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(j);default:return j.toLocaleString()}};return e.jsxs("span",{className:`trend-indicator trend-${m}`,children:[e.jsx(l,{size:14}),c&&e.jsx("span",{className:"trend-value",children:f()})]})});i.memo(function({status:s="default",label:n,size:t="medium",pulse:r=!1}){return e.jsxs("span",{className:`status-dot-container status-dot-${t}`,children:[e.jsx("span",{className:`status-dot status-dot-${s} ${r?"status-dot-pulse":""}`}),n&&e.jsx("span",{className:"status-dot-label",children:n})]})});i.memo(function({data:s=[],width:n=80,height:t=24,strokeWidth:r=2,color:c="var(--accent-blue)",showArea:o=!0}){if(!s.length)return null;const d=Math.max(...s),h=Math.min(...s),m=d-h||1,l=s.map((j,b)=>{const u=b/(s.length-1)*n,x=t-(j-h)/m*(t-r*2)-r;return`${u},${x}`}).join(" "),f=`0,${t} ${l} ${n},${t}`;return e.jsxs("svg",{width:n,height:t,className:"sparkline",viewBox:`0 0 ${n} ${t}`,children:[o&&e.jsx("polygon",{points:f,fill:c,fillOpacity:"0.15"}),e.jsx("polyline",{points:l,fill:"none",stroke:c,strokeWidth:r,strokeLinecap:"round",strokeLinejoin:"round"})]})});i.memo(function({items:s=[]}){return e.jsx("div",{className:"quick-stats",children:s.map((n,t)=>e.jsxs("span",{className:"quick-stat-item",children:[n.icon&&e.jsx(n.icon,{size:12}),e.jsx("span",{className:"quick-stat-value",children:n.value}),n.label&&e.jsx("span",{className:"quick-stat-label",children:n.label})]},t))})});i.memo(function({status:s,label:n,size:t="medium"}){const r={success:Zr,warning:ua,danger:ua,info:Is,pending:Is},c=r[s]||r.info;return e.jsxs("span",{className:`status-indicator status-indicator-${s} status-indicator-${t}`,children:[e.jsx(c,{size:t==="small"?12:t==="large"?18:14}),n&&e.jsx("span",{className:"status-indicator-label",children:n})]})});i.memo(function({current:s,previous:n,format:t="number",label:r,inverted:c=!1}){const o=s-n,d=c?o<0:o>0,h=c?o>0:o<0,m=l=>{switch(t){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(Math.abs(l));case"percent":return`${Math.abs(l).toFixed(1)}%`;default:return Math.abs(l).toLocaleString()}};return e.jsxs("div",{className:`metric-delta ${d?"positive":h?"negative":"neutral"}`,children:[e.jsx("span",{className:"metric-delta-arrow",children:o>0?"↑":o<0?"↓":"→"}),e.jsx("span",{className:"metric-delta-value",children:m(o)}),r&&e.jsx("span",{className:"metric-delta-label",children:r})]})});i.memo(function({value:s,max:n=100,size:t=40,strokeWidth:r=4,showValue:c=!0,color:o="var(--accent-blue)"}){const d=Math.min(100,Math.max(0,s/n*100)),h=(t-r)/2,m=h*2*Math.PI,l=m-d/100*m;return e.jsxs("div",{className:"circular-progress",style:{width:t,height:t},children:[e.jsxs("svg",{width:t,height:t,viewBox:`0 0 ${t} ${t}`,children:[e.jsx("circle",{className:"circular-progress-track",cx:t/2,cy:t/2,r:h,fill:"none",strokeWidth:r}),e.jsx("circle",{className:"circular-progress-fill",cx:t/2,cy:t/2,r:h,fill:"none",stroke:o,strokeWidth:r,strokeDasharray:m,strokeDashoffset:l,strokeLinecap:"round",transform:`rotate(-90 ${t/2} ${t/2})`,style:{transition:"stroke-dashoffset 0.5s ease"}})]}),c&&e.jsxs("span",{className:"circular-progress-value",children:[Math.round(d),"%"]})]})});i.memo(function({isOpen:s,onClose:n,title:t,children:r,size:c="medium",className:o="",showCloseButton:d=!0,closeOnOverlayClick:h=!0,closeOnEscape:m=!0,footer:l,ariaDescribedBy:f}){const j=i.useRef(null),b=i.useRef(null),u=i.useRef(`modal-title-${Math.random().toString(36).substr(2,9)}`);i.useEffect(()=>{if(s){b.current=document.activeElement;const p=setTimeout(()=>{j.current?.focus()},10);return()=>clearTimeout(p)}},[s]),i.useEffect(()=>{!s&&b.current&&b.current.focus()},[s]),i.useEffect(()=>{if(!s||!m)return;const p=E=>{E.key==="Escape"&&(E.preventDefault(),n())};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[s,m,n]),i.useEffect(()=>{if(s){const p=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=p}}},[s]);const x=i.useCallback(p=>{if(p.key!=="Tab")return;const E=j.current?.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(!E||E.length===0)return;const g=E[0],N=E[E.length-1];p.shiftKey?document.activeElement===g&&(p.preventDefault(),N.focus()):document.activeElement===N&&(p.preventDefault(),g.focus())},[]),C=p=>{h&&p.target===p.currentTarget&&n()};if(!s)return null;const S={small:"modal-small",medium:"modal-medium",large:"modal-large",full:"modal-full"};return e.jsx("div",{className:"modal-overlay",onClick:C,role:"presentation",children:e.jsxs("div",{ref:j,className:`modal-content ${S[c]||""} ${o}`,role:"dialog","aria-modal":"true","aria-labelledby":t?u.current:void 0,"aria-describedby":f,tabIndex:-1,onKeyDown:x,onClick:p=>p.stopPropagation(),children:[t&&e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{id:u.current,children:t}),d&&e.jsx("button",{className:"close-btn",onClick:n,"aria-label":"Close modal",type:"button",children:e.jsx(Be,{size:20})})]}),e.jsx("div",{className:"modal-body",children:r}),l&&e.jsx("div",{className:"modal-footer",children:l})]})})});const Re=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(a||0),ca=i.memo(function({icon:s,label:n,value:t,formattedValue:r,subLabel:c,progress:o,progressLabel:d,variant:h="default",trend:m,previousValue:l}){const f={default:"var(--accent-blue)",success:"var(--accent-green)",warning:"var(--accent-amber)",danger:"var(--accent-red)"};return e.jsxs("div",{className:"hero-metric-card hover-lift animate-fade-in-up",children:[e.jsxs("div",{className:"hero-metric-header",children:[e.jsx("div",{className:"hero-metric-icon",style:{color:f[h]},children:e.jsx(s,{size:18})}),e.jsx("span",{className:"hero-metric-label",children:n})]}),e.jsxs("div",{className:"hero-metric-value-row",children:[e.jsx("span",{className:`hero-metric-value hero-metric-${h}`,children:r}),m!==void 0&&l!==void 0&&e.jsx(Xl,{value:t,previousValue:l,format:"currency",inverted:n.toLowerCase().includes("cost")})]}),c&&e.jsx("span",{className:"hero-metric-sublabel",children:c}),o!==void 0&&e.jsxs("div",{className:"hero-metric-progress",children:[e.jsx(Yl,{value:o,max:100,size:"small",variant:h,showLabel:!0}),d&&e.jsx("span",{className:"hero-metric-progress-label",children:d})]})]})}),Jl=i.memo(function({contractValue:s=0,earnedRevenue:n=0,totalCosts:t=0,profit:r=0,progress:c=0,corApprovedValue:o=0,loading:d=!1,previousData:h}){const m=s+o,l=n>0?r/n*100:0,f=n>0?t/n*100:0,j=m>0?n/m*100:0,b=m>0?t/m*100:0,u=i.useMemo(()=>l>=20?"success":l>=10?"warning":l<0?"danger":"default",[l]),x=i.useMemo(()=>f<=60?"success":f<=80?"warning":"danger",[f]);return d?e.jsx(Hl,{}):e.jsxs("div",{className:"hero-metrics stagger-children",children:[e.jsx(ca,{icon:oa,label:"Contract Value",value:m,formattedValue:Re(m),subLabel:o>0?`+${Re(o)} CORs`:null,variant:"default"}),e.jsx(ca,{icon:ga,label:"Earned Revenue",value:n,formattedValue:Re(n),progress:j,progressLabel:`${Math.round(j)}% of contract`,variant:"success",previousValue:h?.earnedRevenue,trend:h?n:void 0}),e.jsx(ca,{icon:lt,label:"Total Costs",value:t,formattedValue:Re(t),progress:b,progressLabel:`${Math.round(f)}% of revenue`,variant:x,previousValue:h?.totalCosts,trend:h?t:void 0}),e.jsx(ca,{icon:Qr,label:"Profit",value:r,formattedValue:Re(r),subLabel:`${l>=0?"+":""}${l.toFixed(1)}% margin`,variant:u,previousValue:h?.profit,trend:h?r:void 0})]})}),Gs=[{id:"overview",label:"Overview",shortLabel:"Overview",icon:si,description:"Metrics & trends",step:null},{id:"cors",label:"Change Orders",shortLabel:"CORs",icon:qe,description:"CORs & approvals",step:1},{id:"tickets",label:"T&M Tickets",shortLabel:"Tickets",icon:ie,description:"Field data",step:2},{id:"billing",label:"Billing",shortLabel:"Billing",icon:lt,description:"Invoices & billing",step:3}],Zl=i.memo(function({activeSection:s="overview",onSectionChange:n,collapsed:t=!1,onToggleCollapse:r,onMobileClose:c,stats:o={}}){const{corCount:d=0,ticketCount:h=0,corPending:m=0,ticketPending:l=0,billableCount:f=0,invoiceCount:j=0}=o,b=u=>u==="cors"&&d>0?{count:d,variant:m>0?"warning":"default",pending:m}:u==="tickets"&&h>0?{count:h,variant:l>0?"warning":"default",pending:l}:u==="billing"&&f>0?{count:f,variant:"success",pending:f}:null;return e.jsxs("nav",{className:`financials-nav ${t?"collapsed":""}`,"aria-label":"Financials sections",children:[c&&e.jsxs("div",{className:"financials-nav-mobile-header",children:[e.jsx("span",{className:"financials-nav-mobile-title",children:"Financials"}),e.jsx("button",{className:"financials-nav-mobile-close",onClick:c,"aria-label":"Close menu",children:e.jsx(Be,{size:20})})]}),e.jsxs("button",{className:"financials-nav-toggle",onClick:r,"aria-label":t?"Expand sidebar":"Collapse sidebar",title:t?"Expand sidebar":"Collapse sidebar",children:[t?e.jsx(ei,{size:18}):e.jsx(ai,{size:18}),!t&&e.jsx("span",{children:"Collapse"})]}),e.jsx("div",{className:"financials-nav-items",children:Gs.map((u,x)=>{const C=s===u.id,S=u.icon,p=b(u.id),E=x<Gs.length-1&&u.step!==null;return e.jsxs("div",{className:"financials-nav-item-wrapper",children:[e.jsxs("button",{className:`financials-nav-item ${C?"active":""}`,onClick:()=>n?.(u.id),"aria-current":C?"page":void 0,title:`${u.label}${p?` (${p.count})`:""}`,children:[u.step&&!t&&e.jsx("span",{className:"financials-nav-step",children:u.step}),e.jsxs("div",{className:"financials-nav-icon",children:[e.jsx(S,{size:t?22:20}),p&&p.pending>0&&e.jsx("span",{className:"financials-nav-dot"})]}),t&&e.jsx("span",{className:"financials-nav-short-label",children:u.shortLabel}),!t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"financials-nav-content",children:[e.jsx("span",{className:"financials-nav-label",children:u.label}),e.jsx("span",{className:"financials-nav-desc",children:u.description})]}),p&&e.jsx(Gl,{count:p.count,size:"small",variant:p.variant}),e.jsx($e,{size:16,className:"financials-nav-arrow"})]})]}),E&&!t&&e.jsx("div",{className:"financials-nav-connector",children:e.jsx("div",{className:"connector-line"})})]},u.id)})}),t&&e.jsxs("button",{className:"financials-nav-expand-btn",onClick:r,"aria-label":"Expand sidebar",children:[e.jsx($e,{size:14}),e.jsx("span",{children:"Expand"})]})]})}),Ql=i.lazy(()=>Z(()=>import("./TMList-BvVcNwxK.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),ec=i.lazy(()=>Z(()=>import("./ShareModal-5RGcemOi.js"),__vite__mapDeps([9,2,3,4,1,5,6]))),ac=i.lazy(()=>Z(()=>import("./InjuryReportsList-Bpjm4-mk.js"),__vite__mapDeps([10,1,2,3,4,5,6,8]))),sc=i.lazy(()=>Z(()=>import("./NotificationSettings-TOYoOaJ1.js"),__vite__mapDeps([11,2,3,4,1,5,6]))),tc=i.lazy(()=>Z(()=>import("./DailyReportsList-DTu-TlIw.js"),__vite__mapDeps([12,1,2,3,4,5,6,8]))),nc=i.lazy(()=>Z(()=>import("./CORList-CW1F-Pbk.js"),__vite__mapDeps([13,1,2,3,4,5,6,8]))),rc=i.lazy(()=>Z(()=>import("./CORForm-fs4tC1Yh.js"),__vite__mapDeps([14,2,3,4,1,5,6,8]))),ic=i.lazy(()=>Z(()=>import("./CORDetail-zDDz2y84.js"),__vite__mapDeps([15,2,3,4,1,5,6,8,7]))),lc=i.lazy(()=>Z(()=>import("./BillingCenter-jK_S0Pe8.js"),__vite__mapDeps([16,2,3,4,1,5,6,8]))),cc=i.lazy(()=>Z(()=>import("./DrawRequestModal-B7ozY2At.js"),__vite__mapDeps([17,2,3,4,1,5,6,8]))),oc=i.lazy(()=>Z(()=>import("./EquipmentModal-CHo4ZCr4.js"),__vite__mapDeps([18,2,3,4,1,5,6]))),dc=i.lazy(()=>Z(()=>import("./AddCostModal-DFFw0FUY.js"),__vite__mapDeps([19,2,3,4,1,5,6]))),uc=i.lazy(()=>Z(()=>import("./DocumentsTab-5abI5i8P.js"),__vite__mapDeps([20,2,3,4,1,5,6])));function mc({company:a,user:s,isAdmin:n,onShowToast:t,navigateToProjectId:r,onProjectNavigated:c}){const[o,d]=i.useState([]),[h,m]=i.useState([]),[l,f]=i.useState(null),[j,b]=i.useState([]),[u,x]=i.useState(!0),[C,S]=i.useState(!1),[p,E]=i.useState(null),[g,N]=i.useState(!1),[R,F]=i.useState(!1),[k,y]=i.useState(!1),[O,M]=i.useState("overview"),[z,G]=i.useState("overview"),[Y,le]=i.useState(!0),[pe,ve]=i.useState(!1),[Ua,Ha]=i.useState("preview"),[Ga,gt]=i.useState("list"),[ba,ya]=i.useState("preview"),[Ya,bt]=i.useState([]),[yt,Se]=i.useState(!1),[Nt,_e]=i.useState(null),[wt,Ge]=i.useState(!1),[Xa,Ye]=i.useState(null),[Ct,Ja]=i.useState(0),[kt,Na]=i.useState(!1),[Dt,Za]=i.useState(!1),[Et,Xe]=i.useState(!1),[Qa,Je]=i.useState(null),[St,_t]=i.useState(0),[Pt,Ze]=i.useState(!1),[es,Qe]=i.useState(null),[Ot,At]=i.useState(0),{isOpen:Rt,setIsOpen:Mt,close:It}=El(),Pe=i.useRef(null),ea=i.useRef(!1),wa=i.useRef(!1),Ca=i.useRef(new Map),as=300*1e3,J=i.useCallback((v={})=>{const{refreshAreas:D=!1,refreshCOR:w=!1,projectId:_=null}=v;D&&_&&(ea.current=_),w&&(wa.current=!0),Pe.current&&clearTimeout(Pe.current),Pe.current=setTimeout(async()=>{ea.current&&(await ka(ea.current),ea.current=!1),wa.current&&(Ja(I=>I+1),wa.current=!1),await Oe()},150)},[]);i.useEffect(()=>()=>{Pe.current&&clearTimeout(Pe.current)},[]),i.useEffect(()=>{a?.id&&(Oe(),$t())},[a?.id]);const Tt=i.useRef([]),Lt=o.map(v=>v.id).sort().join(",");i.useEffect(()=>{if(!a?.id||o.length===0)return;const v=o.map(w=>w.id).sort();Tt.current=v;const D=T.subscribeToCompanyActivity?.(a.id,v,{onMessage:()=>J(),onMaterialRequest:()=>J(),onTMTicket:()=>J(),onCrewCheckin:()=>J(),onAreaUpdate:()=>J(),onCORChange:()=>J({refreshCOR:!0}),onInjuryReport:()=>J()});return()=>{D&&T.unsubscribe?.(D)}},[a?.id,Lt,J]),i.useEffect(()=>(pe?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[pe]);const $t=async()=>{try{const v=await T.getDumpSites(a.id);bt(v||[])}catch(v){console.error("Error loading dump sites:",v)}},ss=i.useRef(null);i.useEffect(()=>{if(r&&r!==ss.current&&o.length>0){const v=o.find(D=>D.id===r);v&&(ss.current=r,f(v),c?.())}},[r,o,c]),i.useEffect(()=>{if(l){ka(l.id);const v=[],D=l.id,w=T.subscribeToAreas?.(D,()=>{J({refreshAreas:!0,projectId:D})});w&&v.push(w);const _=T.subscribeToDailyReports?.(D,()=>{J()});_&&v.push(_);const I=T.subscribeToCrewCheckins?.(D,()=>{J()});I&&v.push(I);const q=T.subscribeToHaulOffs?.(D,()=>{J()});q&&v.push(q);const L=T.subscribeToCORs?.(D,()=>{J({refreshCOR:!0})});return L&&v.push(L),()=>{v.forEach(W=>T.unsubscribe?.(W))}}},[l,J]),i.useEffect(()=>{z==="tickets"&&ya("full")},[z]);const qt=async(v,D=!1)=>{const w=v.id,_=Ca.current.get(w);if(_&&!D&&Date.now()-_.timestamp<as)return _.data;try{const[I,q,L,W,H,K,xe,sa,ce]=await Promise.all([re(()=>T.getAreas(v.id),{fallback:[],context:{operation:"getAreas",projectId:v.id}}),re(()=>T.getTMTickets(v.id),{fallback:[],context:{operation:"getTMTickets",projectId:v.id}}),re(()=>T.getChangeOrderTotals(v.id),{fallback:null,context:{operation:"getChangeOrderTotals",projectId:v.id}}),re(()=>T.getDailyReports(v.id,100),{fallback:[],context:{operation:"getDailyReports",projectId:v.id}}),re(()=>T.getInjuryReports(v.id),{fallback:[],context:{operation:"getInjuryReports",projectId:v.id}}),re(()=>T.calculateManDayCosts(v.id,a?.id,v.work_type||"demolition",v.job_type||"standard"),{fallback:null,context:{operation:"calculateManDayCosts",projectId:v.id}}),re(()=>T.calculateHaulOffCosts(v.id),{fallback:null,context:{operation:"calculateHaulOffCosts",projectId:v.id}}),re(()=>T.getProjectCosts(v.id),{fallback:[],context:{operation:"getProjectCosts",projectId:v.id}}),re(()=>T.getCORStats(v.id),{fallback:null,context:{operation:"getCORStats",projectId:v.id}})]),oe=Ms(I),P=oe.progress,$=L?.totalApprovedValue||0,te=v.contract_value+$,de=oe.isValueBased?oe.earnedValue:P/100*te,yn=q.filter(X=>X.status==="pending").length,Da=new Date;Da.setDate(Da.getDate()-7);const Nn=W.filter(X=>new Date(X.report_date)>=Da).length,bs=sa.reduce((X,ne)=>{const ra=parseFloat(ne.amount);return X+(isNaN(ra)?0:ra)},0);let ta=0;const na={};q.forEach(X=>{const ne=X.work_date||X.ticket_date||X.created_at?.split("T")[0],ra=X.t_and_m_items||X.items||[];let ia=0;ra.forEach(_a=>{const En=parseFloat(_a.quantity)||1,Sn=parseFloat(_a.unit_cost)||parseFloat(_a.materials_equipment?.cost_per_unit)||0;ia+=En*Sn}),ia>0&&ne&&(ta+=ia,na[ne]||(na[ne]={date:ne,cost:0}),na[ne].cost+=ia)});const ys=Object.values(na).sort((X,ne)=>new Date(ne.date)-new Date(X.date)),Ea=K?.totalCost||0,wn=xe?.totalCost||0,Ns=Ea+ta+bs,ws=de-Ns,Cn=de>0?ws/de*100:0,Cs=K?.byDate?.length||0,kn=ys.length,Sa=Math.max(Cs,kn),ks=Ea+ta,Dn=Sa>0?ks/Sa:0,ue=Tr({...v,progress:P},K?.totalManDays||0),Ds={...v,areas:I,progress:P,billable:de,changeOrderValue:$,revisedContractValue:te,changeOrderPending:L?.pendingCount||0,totalTickets:q.length,pendingTickets:yn,approvedTickets:q.filter(X=>X.status==="approved").length,tmTickets:q,dailyReportsCount:W.length,recentDailyReports:Nn,injuryReportsCount:H.length,lastDailyReport:W[0]?.report_date||null,isValueBased:oe.isValueBased,earnedValue:oe.earnedValue,totalSOVValue:oe.totalValue,laborCost:Ea,laborDaysWorked:Cs,laborManDays:K?.totalManDays||0,laborByDate:K?.byDate||[],dailyBurn:Dn,materialsEquipmentCost:ta,materialsEquipmentByDate:ys,haulOffCost:wn,haulOffLoads:xe?.totalLoads||0,haulOffDays:xe?.daysWithHaulOff||0,haulOffByType:xe?.byWasteType||{},haulOffByDate:xe?.byDate||[],customCosts:sa,customCostTotal:bs,totalBurn:ks,totalBurnDays:Sa,allCostsTotal:Ns,currentProfit:ws,profitMargin:Cn,corPendingValue:ce?.total_pending_value||0,corPendingCount:ce?.pending_count||0,corApprovedValue:ce?.total_approved_value||0,corBilledValue:ce?.total_billed_value||0,corTotalCount:ce?.total_cors||0,corStats:ce,scheduleStatus:ue.scheduleStatus,scheduleVariance:ue.scheduleVariance,scheduleLabel:ue.scheduleLabel,laborStatus:ue.laborStatus,laborVariance:ue.laborVariance,laborLabel:ue.laborLabel,hasScheduleData:ue.hasScheduleData,hasLaborData:ue.hasLaborData,actualManDays:K?.totalManDays||0,hasError:!1,_detailsLoaded:!0};return Ca.current.set(w,{data:Ds,timestamp:Date.now()}),Ds}catch(I){return console.error(`Error loading details for project ${v.id}:`,I),{...v,hasError:!0,_detailsLoaded:!1}}},Oe=async()=>{try{const v=await T.getProjectDashboardSummary(a?.id);d(v);const D=v.map(w=>{const _=Ca.current.get(w.id);if(_&&Date.now()-_.timestamp<as)return _.data;const I=w.areaCount||0,q=w.completedAreas||0,L=I>0?Math.round(q/I*100):0;return{...w,progress:L,areas:[],totalTickets:w.ticketCount||0,pendingTickets:w.pendingTicketCount||0,approvedTickets:w.approvedTicketCount||0,dailyReportsCount:w.dailyReportsThisWeek||0,recentDailyReports:w.dailyReportsThisWeek||0,corTotalCount:w.corCount||0,billable:0,changeOrderValue:0,revisedContractValue:w.contract_value||0,changeOrderPending:0,tmTickets:[],injuryReportsCount:0,lastDailyReport:null,isValueBased:!1,earnedValue:0,totalSOVValue:0,laborCost:0,laborDaysWorked:0,laborManDays:0,laborByDate:[],dailyBurn:0,materialsEquipmentCost:0,materialsEquipmentByDate:[],haulOffCost:0,haulOffLoads:0,haulOffDays:0,haulOffByType:{},haulOffByDate:[],customCosts:[],customCostTotal:0,totalBurn:0,totalBurnDays:0,allCostsTotal:0,currentProfit:0,profitMargin:0,corPendingValue:0,corPendingCount:0,corApprovedValue:0,corBilledValue:0,corStats:null,scheduleStatus:"on_track",scheduleVariance:0,scheduleLabel:"On Track",laborStatus:"on_track",laborVariance:0,laborLabel:null,hasScheduleData:!1,hasLaborData:!1,actualManDays:0,hasError:!1,_detailsLoaded:!1}});m(D)}catch(v){console.error("Error loading projects:",v),t("Error loading projects","error")}finally{x(!1)}},ka=async v=>{try{const D=await T.getAreas(v);b(D)}catch(D){console.error("Error loading areas:",D)}},aa=async v=>{if(f(v),!v._detailsLoaded){const D=await qt(v);m(w=>w.map(_=>_.id===v.id?D:_)),f(D)}},ts=()=>{f(null),b([]),S(!1),E(null),M("overview"),Oe()},ns=()=>{E({name:l.name,job_number:l.job_number||"",address:l.address||"",general_contractor:l.general_contractor||"",client_contact:l.client_contact||"",client_phone:l.client_phone||"",contract_value:l.contract_value,work_type:l.work_type||"demolition",job_type:l.job_type||"standard",pin:l.pin||"",default_dump_site_id:l.default_dump_site_id||"",areas:j.map(v=>({id:v.id,name:v.name,weight:v.weight,isNew:!1}))}),S(!0)},Vt=()=>{S(!1),E(null)},se=(v,D)=>{E(w=>({...w,[v]:D}))},rs=(v,D,w)=>{E(_=>({..._,areas:_.areas.map((I,q)=>q===v?{...I,[D]:w}:I)}))},Ft=()=>{E(v=>({...v,areas:[...v.areas,{id:null,name:"",weight:"",isNew:!0}]}))},zt=v=>{p.areas.length>1&&E(D=>({...D,areas:D.areas.filter((w,_)=>_!==v)}))},Bt=async()=>{if(!p.name.trim()){t("Please enter a project name","error");return}const v=parseFloat(p.contract_value);if(!v||v<=0){t("Please enter a valid contract value","error");return}if(p.pin&&p.pin.length!==4){t("PIN must be 4 digits","error");return}if(p.pin&&p.pin!==l.pin&&!await T.isPinAvailable(p.pin,l.id)){t("This PIN is already in use","error");return}const D=p.areas.filter(_=>_.name.trim()&&parseFloat(_.weight)>0);if(D.length===0){t("Please add at least one area","error");return}if(D.reduce((_,I)=>_+parseFloat(I.weight),0)!==100){t("Area weights must total 100%","error");return}N(!0);try{await T.updateProject(l.id,{name:p.name.trim(),job_number:p.job_number?.trim()||null,address:p.address?.trim()||null,general_contractor:p.general_contractor?.trim()||null,client_contact:p.client_contact?.trim()||null,client_phone:p.client_phone?.trim()||null,contract_value:v,work_type:p.work_type||"demolition",job_type:p.job_type||"standard",pin:p.pin||null,default_dump_site_id:p.default_dump_site_id||null},a?.id);const _=j.map(L=>L.id),I=p.areas.filter(L=>L.id).map(L=>L.id);for(const L of _)I.includes(L)||await T.deleteArea(L);for(let L=0;L<D.length;L++){const W=D[L];W.id?await T.updateArea(W.id,{name:W.name.trim(),weight:parseFloat(W.weight),sort_order:L}):await T.createArea({project_id:l.id,name:W.name.trim(),weight:parseFloat(W.weight),status:"not_started",sort_order:L})}const q=await T.getProject(l.id);f(q),await ka(l.id),S(!1),E(null),t("Project updated!","success")}catch(_){console.error("Error saving project:",_?.message||_),t(_?.message||"Error saving changes","error")}finally{N(!1)}},Wt=async()=>{if(confirm("Are you sure you want to delete this project? This cannot be undone."))try{await T.deleteProject(l.id),t("Project deleted","success"),ts()}catch(v){console.error("Error deleting project:",v),t("Error deleting project","error")}},A=i.useMemo(()=>l?h.find(v=>v.id===l.id):null,[l,h]),Kt=i.useMemo(()=>{if(!l)return{progress:0,billable:0,isValueBased:!1,earnedValue:0,totalSOVValue:0,changeOrderValue:0,revisedContractValue:0};const v=Ms(j),D=v.progress,w=A?.changeOrderValue||0,_=l.contract_value+w,I=v.isValueBased?v.earnedValue:D/100*_;return{progress:D,billable:I,changeOrderValue:w,revisedContractValue:_,isValueBased:v.isValueBased,earnedValue:v.earnedValue,totalSOVValue:v.totalValue}},[l,j,A]),Ut=i.useMemo(()=>{const v=h.reduce((H,K)=>H+(K.contract_value||0),0),D=h.reduce((H,K)=>H+(K.changeOrderValue||0),0),w=v+D,_=h.reduce((H,K)=>H+(K.billable||0),0),I=w-_,q=w>0?Math.round(_/w*100):0,L=h.reduce((H,K)=>H+(K.corPendingValue||0),0),W=h.reduce((H,K)=>H+(K.corPendingCount||0),0);return{totalOriginalContract:v,totalChangeOrders:D,totalPortfolioValue:w,totalEarned:_,totalRemaining:I,weightedCompletion:q,totalPendingCORValue:L,totalPendingCORCount:W}},[h]),Ht=i.useMemo(()=>{let v=0,D=0,w=0,_=0,I=0;for(const q of h){const L=q.revisedContractValue||q.contract_value;q.progress>=100&&v++,q.progress<100&&q.billable<=L*(q.progress/100)*1.1&&D++,q.billable>L*.9&&q.progress<90&&w++,q.billable>L&&_++,(q.changeOrderValue||0)>0&&I++}return{projectsComplete:v,projectsOnTrack:D,projectsAtRisk:w,projectsOverBudget:_,projectsWithChangeOrders:I}},[h]),Gt=i.useMemo(()=>{let v=0,D=0,w=0,_=0,I=0,q=0;for(const L of h)L.hasScheduleData&&(L.scheduleStatus==="ahead"?v++:L.scheduleStatus==="behind"?w++:D++),L.hasLaborData&&(L.laborStatus==="over"?_++:L.laborStatus==="under"?I++:q++);return{scheduleAhead:v,scheduleOnTrack:D,scheduleBehind:w,laborOver:_,laborUnder:I,laborOnTrack:q,hasAnyScheduleData:v+D+w>0,hasAnyLaborData:_+I+q>0}},[h]),Ae=i.useMemo(()=>{const v=h.map(w=>{const _={id:w.id,name:w.name,totalCosts:w.totalCosts||0,earnedRevenue:w.billable||0,actualProgress:w.progress||0,expectedProgress:w.expectedProgress||w.progress,pendingCORValue:w.corPendingValue||0,contractValue:w.revisedContractValue||w.contract_value||0,lastReportDate:w.lastDailyReport,recentInjuryCount:w.recentInjuryCount||0,startDate:w.start_date},I=wl(_),q=Cl(I,{..._,name:w.name}),L=kl(_),W=q.map(H=>({...H,projectName:w.name,projectId:w.id}));return{projectId:w.id,projectName:w.name,riskScore:I.score,riskStatus:I.status,riskLabel:I.label,factors:I.factors,alerts:W,projections:L}}),D=v.flatMap(w=>w.alerts).sort((w,_)=>{const I={critical:0,warning:1,info:2};return I[w.type]-I[_.type]});return{projectRisks:v,allAlerts:D,criticalCount:D.filter(w=>w.type==="critical").length,warningCount:D.filter(w=>w.type==="warning").length}},[h]),Yt=i.useCallback(({target:v,projectId:D,alert:w})=>{const _=o.find(I=>I.id===D);_&&(f(_),v==="financials"?M("financials"):v==="reports"?M("reports"):v==="cors"?(M("financials"),G("cors")):M("overview"))},[o]);i.useEffect(()=>{const v=async()=>{for(const D of h)if(Rr(D,30))try{await T.archiveProject(D.id),t(`Project "${D.name}" has been auto-archived after 30 days of completion`,"info")}catch(w){console.error("Failed to auto-archive project:",w)}};h.length>0&&v()},[]);const Xt=i.useCallback(()=>{Je(null),Xe(!0)},[]),Jt=i.useCallback(v=>{Je(v),Xe(!0)},[]),Zt=i.useCallback(()=>{Qe(null),Ze(!0)},[]),Qt=i.useCallback(v=>{Qe(v),Ze(!0)},[]),en=i.useCallback(()=>{ya("full")},[]),an=i.useCallback(()=>{le(v=>!v)},[]),sn=i.useCallback(()=>{ve(v=>!v)},[]),is=i.useCallback(()=>{ve(!1)},[]),tn=i.useCallback(()=>{Ha("full")},[]),nn=i.useCallback(()=>{ya("preview")},[]),rn=i.useCallback(()=>{Ha("preview")},[]),ln=i.useCallback(()=>{_e(null),Se(!0)},[]),cn=i.useCallback(v=>{Ye(v),Ge(!0)},[]),on=i.useCallback(v=>{_e(v),Se(!0)},[]),dn=i.useCallback(()=>{Na(!0)},[]),un=i.useCallback(async v=>{try{await T.deleteProjectCost(v),Oe(),t?.("Cost deleted","success")}catch{t?.("Error deleting cost","error")}},[]),mn=i.useMemo(()=>({corCount:A?.corStats?.total||0,ticketCount:A?.totalTickets||0,corPending:A?.corStats?.pending||0,ticketPending:A?.pendingTickets||0}),[A?.corStats?.total,A?.totalTickets,A?.corStats?.pending,A?.pendingTickets]),{totalOriginalContract:hn,totalChangeOrders:ls,totalPortfolioValue:pn,totalEarned:vn,totalRemaining:xn,weightedCompletion:fn,totalPendingCORValue:jn,totalPendingCORCount:cs}=Ut,{projectsComplete:os,projectsOnTrack:ds,projectsAtRisk:us,projectsOverBudget:ms,projectsWithChangeOrders:hs}=Ht,{scheduleAhead:ps,scheduleOnTrack:vs,scheduleBehind:xs,laborOver:fs,laborUnder:js,laborOnTrack:gs,hasAnyScheduleData:gn,hasAnyLaborData:bn}=Gt;if(u)return e.jsxs("div",{className:"loading",children:[e.jsx("div",{className:"spinner"}),"Loading projects..."]});if(l){const{progress:v,billable:D,changeOrderValue:w,revisedContractValue:_,isValueBased:I,earnedValue:q,totalSOVValue:L}=Kt;if(C&&p){const P=p.areas.reduce(($,te)=>$+(parseFloat(te.weight)||0),0);return e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary btn-small",onClick:Vt,style:{marginBottom:"1.5rem"},children:"← Cancel"}),e.jsx("h1",{children:"Edit Project"}),e.jsx("p",{className:"subtitle",children:"Update project details"}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Basic Info"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsx("label",{children:"Project Name *"}),e.jsx("input",{type:"text",value:p.name,onChange:$=>se("name",$.target.value),placeholder:"e.g., Downtown Office Demolition"})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Job Number"}),e.jsx("input",{type:"text",value:p.job_number,onChange:$=>se("job_number",$.target.value),placeholder:"e.g., 2024-001"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Project Address"}),e.jsx("input",{type:"text",value:p.address,onChange:$=>se("address",$.target.value),placeholder:"123 Main St, City, State 12345"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Client & Contractor"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"General Contractor"}),e.jsx("input",{type:"text",value:p.general_contractor,onChange:$=>se("general_contractor",$.target.value),placeholder:"e.g., ABC Construction"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Contact"}),e.jsx("input",{type:"text",value:p.client_contact,onChange:$=>se("client_contact",$.target.value),placeholder:"Contact name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Client Phone"}),e.jsx("input",{type:"tel",value:p.client_phone,onChange:$=>se("client_phone",$.target.value),placeholder:"(555) 123-4567"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Financials & Settings"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contract Value ($) *"}),e.jsx("input",{type:"number",value:p.contract_value,onChange:$=>se("contract_value",$.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Foreman PIN"}),e.jsx("input",{type:"text",value:p.pin,onChange:$=>se("pin",$.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"4 digits",maxLength:4}),e.jsx("span",{className:"form-hint",children:"Used for field crew access"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Work Type"}),e.jsxs("select",{value:p.work_type,onChange:$=>se("work_type",$.target.value),children:[e.jsx("option",{value:"demolition",children:"Demolition"}),e.jsx("option",{value:"environmental",children:"Environmental"})]}),e.jsx("span",{className:"form-hint",children:"Affects labor rate calculations"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Job Type"}),e.jsxs("select",{value:p.job_type,onChange:$=>se("job_type",$.target.value),children:[e.jsx("option",{value:"standard",children:"Standard"}),e.jsx("option",{value:"prevailing_wage",children:"Prevailing Wage"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Default Dump Site"}),e.jsxs("select",{value:p.default_dump_site_id,onChange:$=>se("default_dump_site_id",$.target.value),children:[e.jsx("option",{value:"",children:"-- Select Dump Site --"}),Ya.map($=>e.jsx("option",{value:$.id,children:$.name},$.id))]}),e.jsx("span",{className:"form-hint",children:"Used for haul-off tracking and cost estimates"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{children:"Areas"}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginBottom:"1rem"},children:"Weights must total 100%."}),p.areas.map(($,te)=>e.jsxs("div",{className:"area-row",children:[e.jsx("input",{type:"text",placeholder:"Area name",value:$.name,onChange:de=>rs(te,"name",de.target.value)}),e.jsx("input",{type:"number",placeholder:"%",value:$.weight,onChange:de=>rs(te,"weight",de.target.value)}),e.jsx("button",{className:"remove-btn",onClick:()=>zt(te),children:"×"})]},te)),e.jsxs("div",{className:"weight-total",children:[e.jsx("span",{className:"weight-total-label",children:"Total Weight:"}),e.jsxs("span",{className:`weight-total-value ${P===100?"valid":"invalid"}`,children:[P,"%"]})]}),e.jsx("button",{className:"btn btn-secondary",onClick:Ft,children:"+ Add Area"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:e.jsx("button",{className:"btn btn-primary",onClick:Bt,disabled:g,style:{flex:1},children:g?"Saving...":"Save Changes"})}),e.jsx("button",{className:"btn btn-danger btn-full",onClick:Wt,children:"Delete Project"})]})}const W=j.filter(P=>P.status==="done").length,H=j.filter(P=>P.status==="working").length,K=j.filter(P=>P.status==="not_started").length,xe=_>0?Math.round(D/_*100):0,sa=w>0,ce=(A?.pendingTickets||0)+(A?.changeOrderPending||0),oe=[{id:"overview",label:"Overview",Icon:Ts},{id:"financials",label:"Financials",Icon:oa,badge:ce},{id:"reports",label:"Reports",Icon:ie},{id:"documents",label:"Documents",Icon:Ia},{id:"info",label:"Info",Icon:da}];return e.jsxs("div",{className:"project-view tabbed",children:[e.jsxs("div",{className:"pv-sticky-header",children:[e.jsxs("div",{className:"pv-header-row",children:[e.jsxs("button",{className:"pv-back",onClick:ts,children:[e.jsx("span",{children:"←"}),e.jsx("span",{children:"Back"})]}),e.jsxs("div",{className:"pv-actions",children:[e.jsx("button",{className:"pv-action",onClick:()=>F(!0),children:"Share"}),e.jsx("button",{className:"pv-action",onClick:()=>y(!0),children:"Alerts"}),e.jsx("button",{className:"pv-action",onClick:ns,children:"Edit"})]})]}),e.jsxs("div",{className:"pv-header-title",children:[e.jsx("h1",{children:l.name}),(l.job_number||l.work_type)&&e.jsxs("span",{className:"pv-header-meta",children:[l.job_number&&`Job #${l.job_number}`,l.job_number&&l.work_type&&" • ",l.work_type]})]}),e.jsxs("div",{className:"pv-metrics-bar",children:[e.jsxs("div",{className:"pv-metric",children:[e.jsxs("span",{className:"pv-metric-value",children:[v,"%"]}),e.jsx("span",{className:"pv-metric-label",children:"Complete"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value",children:U(D)}),e.jsx("span",{className:"pv-metric-label",children:"Billed"})]}),e.jsx("div",{className:"pv-metric-divider"}),e.jsxs("div",{className:"pv-metric",children:[e.jsx("span",{className:"pv-metric-value highlight",children:U(_-D)}),e.jsx("span",{className:"pv-metric-label",children:"Remaining"})]})]}),e.jsx("div",{className:"pv-tabs",children:oe.map(P=>e.jsxs("button",{className:`pv-tab ${O===P.id?"active":""} ${P.badge>0?"has-badge":""}`,onClick:()=>M(P.id),children:[e.jsx(P.Icon,{size:16,className:"pv-tab-icon"}),e.jsx("span",{className:"pv-tab-label",children:P.label}),P.badge>0&&e.jsx("span",{className:"pv-tab-badge",children:P.badge})]},P.id))})]}),e.jsxs("div",{className:"pv-tab-content",children:[O==="overview"&&e.jsxs("div",{className:"pv-tab-panel overview-tab",children:[e.jsx("div",{className:"overview-hero",children:e.jsxs("div",{className:"overview-hero-grid",children:[e.jsxs("div",{className:"overview-metric primary",children:[e.jsxs("div",{className:"overview-metric-value",children:[v,"%"]}),e.jsx("div",{className:"overview-metric-label",children:"Complete"}),e.jsx("div",{className:"overview-metric-bar",children:e.jsx("div",{className:"overview-metric-fill",style:{width:`${v}%`}})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsxs("div",{className:"overview-metric-value",children:[W,"/",j.length]}),e.jsx("div",{className:"overview-metric-label",children:"Areas Done"}),e.jsx("div",{className:"overview-metric-detail",children:H>0&&e.jsxs("span",{className:"working",children:[H," active"]})})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value",children:U(_)}),e.jsx("div",{className:"overview-metric-label",children:"Contract"}),sa&&e.jsxs("div",{className:"overview-metric-detail green",children:["+",U(w)," COs"]})]}),e.jsxs("div",{className:"overview-metric",children:[e.jsx("div",{className:"overview-metric-value green",children:U(D)}),e.jsx("div",{className:"overview-metric-label",children:"Earned"}),e.jsx("div",{className:"overview-metric-detail",children:I?e.jsxs("span",{children:["of ",U(L)," SOV"]}):e.jsxs("span",{children:[xe,"% billed"]})})]})]})}),(A?.pendingTickets>0||A?.changeOrderPending>0)&&e.jsxs("div",{className:"overview-attention-card",children:[e.jsxs("div",{className:"attention-header",children:[e.jsx("h3",{children:"Needs Attention"}),e.jsxs("span",{className:"attention-count",children:[(A?.pendingTickets||0)+(A?.changeOrderPending||0)," items"]})]}),e.jsxs("div",{className:"attention-items",children:[A?.pendingTickets>0&&e.jsxs("div",{className:"attention-item",onClick:()=>M("financials"),children:[e.jsx("div",{className:"attention-item-icon warning",children:e.jsx(ie,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[A.pendingTickets," T&M ticket",A.pendingTickets!==1?"s":""," awaiting approval"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:"→"})]}),A?.changeOrderPending>0&&e.jsxs("div",{className:"attention-item",onClick:()=>M("financials"),children:[e.jsx("div",{className:"attention-item-icon info",children:e.jsx(qe,{size:16})}),e.jsxs("div",{className:"attention-item-content",children:[e.jsxs("span",{className:"attention-item-title",children:[A.changeOrderPending," change order",A.changeOrderPending!==1?"s":""," pending"]}),e.jsx("span",{className:"attention-item-action",children:"Review in Financials"})]}),e.jsx("span",{className:"attention-item-arrow",children:"→"})]})]})]}),e.jsxs("div",{className:"overview-section-card",children:[e.jsxs("div",{className:"section-card-header",children:[e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"section-card-badges",children:[W>0&&e.jsxs("span",{className:"section-badge done",children:[W," Complete"]}),H>0&&e.jsxs("span",{className:"section-badge working",children:[H," Active"]}),K>0&&e.jsxs("span",{className:"section-badge pending",children:[K," Pending"]})]})]}),e.jsx("div",{className:"work-areas-list",children:j.map(P=>e.jsxs("div",{className:`work-area-item ${P.status}`,children:[e.jsxs("div",{className:"work-area-status",children:[P.status==="done"&&e.jsx("span",{className:"status-icon done",children:"✓"}),P.status==="working"&&e.jsx("span",{className:"status-icon working",children:"●"}),P.status==="not_started"&&e.jsx("span",{className:"status-icon pending",children:"○"})]}),e.jsxs("div",{className:"work-area-info",children:[e.jsx("span",{className:"work-area-name",children:P.name}),e.jsx("span",{className:"work-area-weight",children:P.scheduled_value?U(P.scheduled_value):`${P.weight}%`})]}),e.jsx("div",{className:"work-area-bar",children:e.jsx("div",{className:`work-area-fill ${P.status}`,style:{width:P.status==="done"?"100%":P.status==="working"?"50%":"0%"}})})]},P.id))})]}),e.jsxs("div",{className:"overview-stats-row",children:[e.jsxs("div",{className:"quick-stat-card",onClick:()=>M("reports"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(ie,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:A?.dailyReportsCount||0}),e.jsx("span",{className:"quick-stat-label",children:"Daily Reports"})]}),e.jsx("span",{className:"quick-stat-arrow",children:"→"})]}),e.jsxs("div",{className:"quick-stat-card",onClick:()=>M("financials"),children:[e.jsx("div",{className:"quick-stat-icon",children:e.jsx(oa,{size:20})}),e.jsxs("div",{className:"quick-stat-content",children:[e.jsx("span",{className:"quick-stat-value",children:A?.totalTickets||0}),e.jsx("span",{className:"quick-stat-label",children:"T&M Tickets"})]}),e.jsx("span",{className:"quick-stat-arrow",children:"→"})]})]})]}),O==="financials"&&e.jsxs("div",{className:"pv-tab-panel financials-tab",children:[e.jsx(Jl,{contractValue:l?.contract_value||0,earnedRevenue:D,totalCosts:A?.allCostsTotal||0,profit:A?.currentProfit||0,progress:v,corApprovedValue:w,loading:!A}),e.jsxs("div",{className:`financials-layout ${Y?"sidebar-collapsed":""}`,children:[e.jsxs("button",{className:"financials-mobile-menu-toggle",onClick:sn,"aria-label":"Open navigation menu",title:"Open navigation menu",children:[e.jsx(ti,{size:20}),e.jsx("span",{children:"Menu"})]}),pe&&e.jsx("div",{className:"financials-sidebar-overlay",onClick:is,"aria-hidden":"true"}),e.jsx("div",{className:`financials-sidebar ${Y?"collapsed":""} ${pe?"mobile-open":""}`,children:e.jsx(Zl,{activeSection:z,onSectionChange:P=>{G(P),ve(!1)},collapsed:Y,onToggleCollapse:an,onMobileClose:is,stats:mn})}),e.jsxs("div",{className:"financials-main",children:[z==="overview"&&e.jsxs("div",{className:"financials-overview animate-fade-in",children:[e.jsx(Vl,{projectData:A,project:l,tmTickets:A?.tmTickets||[],corStats:A?.corStats,areas:j}),e.jsxs("div",{className:"financials-analysis-row stagger-children",children:[e.jsx(Ml,{dailyBurn:A?.dailyBurn||0,totalBurn:A?.totalBurn||0,daysWorked:A?.totalBurnDays||0,laborCost:A?.laborCost||0,materialsEquipmentCost:A?.materialsEquipmentCost||0,progress:v,contractValue:_,laborByDate:A?.laborByDate||[],materialsEquipmentByDate:A?.materialsEquipmentByDate||[]}),e.jsx(Bl,{revenue:D,totalCosts:A?.allCostsTotal||0,contractValue:_,progress:v})]}),e.jsxs("div",{className:"cost-disposal-row",children:[e.jsx(zl,{laborCost:A?.laborCost||0,haulOffCost:A?.haulOffCost||0,customCosts:A?.customCosts||[],onAddCost:dn,onDeleteCost:un}),e.jsx(Kl,{project:l,period:"week"})]}),e.jsx(Al,{project:l,onAddEquipment:Xt,onEditEquipment:Jt,onShowToast:t},St),e.jsx(Ol,{project:l,areas:j,corStats:A?.corStats,onCreateDraw:Zt,onViewDraw:Qt,onShowToast:t},Ot),e.jsxs("details",{className:"financials-details",children:[e.jsxs("summary",{className:"financials-details-summary",children:[e.jsx(ma,{size:16}),e.jsx("span",{children:"Labor Details"}),e.jsx("span",{className:"financials-details-value",children:U(A?.laborCost||0)})]}),e.jsx("div",{className:"financials-details-content",children:e.jsx(Pl,{project:l,company:a,onShowToast:t})})]})]}),z==="cors"&&e.jsx("div",{className:"financials-cors animate-fade-in",children:e.jsxs("div",{className:"financials-section cor-section-primary",children:[Ua==="full"&&Ga!=="log"&&e.jsx("button",{className:"section-back-btn",onClick:rn,children:"← Back to summary"}),e.jsx(i.Suspense,{fallback:e.jsx(we,{}),children:e.jsx(nc,{project:l,company:a,areas:j,refreshKey:Ct,onShowToast:t,previewMode:Ua==="preview"&&Ga!=="log",previewLimit:5,onViewAll:tn,onDisplayModeChange:gt,onCreateCOR:ln,onViewCOR:cn,onEditCOR:on})})]})}),z==="tickets"&&e.jsx("div",{className:"financials-tickets animate-fade-in",children:e.jsxs("div",{className:"financials-section tm-section",children:[ba==="full"&&e.jsx("button",{className:"section-back-btn",onClick:nn,children:"← Back to summary"}),e.jsx(i.Suspense,{fallback:e.jsx(we,{}),children:e.jsx(Ql,{project:l,company:a,onShowToast:t,compact:ba==="preview",previewMode:ba==="preview",onViewAll:en})})]})}),z==="billing"&&e.jsx("div",{className:"financials-billing animate-fade-in",children:e.jsx(i.Suspense,{fallback:e.jsx(we,{}),children:e.jsx(lc,{project:l,company:a,user:s,onShowToast:t})})})]})]})]}),O==="reports"&&e.jsxs("div",{className:"pv-tab-panel reports-tab",children:[e.jsx("div",{className:"reports-hero",children:e.jsxs("div",{className:"reports-hero-grid",children:[e.jsxs("div",{className:"reports-metric primary",children:[e.jsx("div",{className:"reports-metric-icon",children:e.jsx(ie,{size:24})}),e.jsxs("div",{className:"reports-metric-content",children:[e.jsx("div",{className:"reports-metric-value",children:A?.dailyReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Daily Reports"})]})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value",children:A?.recentDailyReports||0}),e.jsx("div",{className:"reports-metric-label",children:"This Week"}),e.jsx("div",{className:"reports-metric-bar",children:e.jsx("div",{className:"reports-metric-fill",style:{width:`${Math.min((A?.recentDailyReports||0)/7*100,100)}%`}})})]}),e.jsxs("div",{className:`reports-metric ${(A?.injuryReportsCount||0)>0?"warning":"success"}`,children:[e.jsx("div",{className:"reports-metric-value",children:A?.injuryReportsCount||0}),e.jsx("div",{className:"reports-metric-label",children:"Injuries"}),e.jsx("div",{className:"reports-metric-status",children:(A?.injuryReportsCount||0)===0?"No incidents":"Review required"})]}),e.jsxs("div",{className:"reports-metric",children:[e.jsx("div",{className:"reports-metric-value small",children:A?.lastDailyReport?new Date(A.lastDailyReport).toLocaleDateString("en-US",{month:"short",day:"numeric"}):"None"}),e.jsx("div",{className:"reports-metric-label",children:"Last Filed"}),A?.lastDailyReport&&e.jsxs("div",{className:"reports-metric-detail",children:[Math.floor((new Date-new Date(A.lastDailyReport))/(1e3*60*60*24))," days ago"]})]})]})}),e.jsxs("div",{className:"reports-section-card",children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx(ie,{size:18}),e.jsx("h3",{children:"Daily Reports"})]}),e.jsxs("span",{className:"reports-section-count",children:[A?.dailyReportsCount||0," total"]})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(i.Suspense,{fallback:e.jsx(we,{}),children:e.jsx(tc,{project:l,company:a,onShowToast:t})})})]}),e.jsxs("div",{className:`reports-section-card ${(A?.injuryReportsCount||0)>0?"has-warning":""}`,children:[e.jsxs("div",{className:"reports-section-header",children:[e.jsxs("div",{className:"reports-section-title",children:[e.jsx("span",{className:`reports-section-icon ${(A?.injuryReportsCount||0)>0?"warning":"success"}`,children:(A?.injuryReportsCount||0)>0?"⚠":"✓"}),e.jsx("h3",{children:"Safety & Injury Reports"})]}),e.jsx("span",{className:`reports-section-badge ${(A?.injuryReportsCount||0)>0?"warning":"success"}`,children:(A?.injuryReportsCount||0)>0?`${A.injuryReportsCount} incident${A.injuryReportsCount!==1?"s":""}`:"No incidents"})]}),e.jsx("div",{className:"reports-section-content",children:e.jsx(i.Suspense,{fallback:e.jsx(we,{}),children:e.jsx(ac,{project:l,companyId:a?.id||l?.company_id,company:a,user:s,onShowToast:t})})})]})]}),O==="documents"&&e.jsx("div",{className:"pv-tab-panel documents-tab",children:e.jsx(i.Suspense,{fallback:e.jsx(we,{}),children:e.jsx(uc,{project:l,companyId:a?.id||l?.company_id,onShowToast:t,userRole:s?.access_level||"office"})})}),O==="info"&&e.jsxs("div",{className:"pv-tab-panel info-tab",children:[e.jsxs("div",{className:"info-hero",children:[e.jsxs("div",{className:"info-hero-content",children:[e.jsxs("div",{className:"info-hero-main",children:[e.jsx("h2",{className:"info-hero-title",children:l.name}),l.job_number&&e.jsxs("span",{className:"info-hero-job",children:["Job #",l.job_number]})]}),e.jsx("button",{className:"btn btn-primary btn-with-icon",onClick:ns,children:e.jsx("span",{children:"Edit Project"})})]}),l.address&&e.jsxs("div",{className:"info-hero-address",children:[e.jsx(ni,{size:14}),e.jsx("span",{children:l.address})]})]}),e.jsxs("div",{className:"info-quick-grid",children:[e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(ma,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:l.work_type==="environmental"?"Environmental":"Demolition"}),e.jsx("span",{className:"info-quick-label",children:"Work Type"})]})]}),e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(qe,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:l.job_type==="prevailing_wage"?"Prevailing Wage":"Standard"}),e.jsx("span",{className:"info-quick-label",children:"Job Type"})]})]}),e.jsxs("div",{className:"info-quick-card highlight",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx(oa,{size:20})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value",children:U(_)}),e.jsx("span",{className:"info-quick-label",children:w>0?`Incl. +${U(w)} COs`:"Contract Value"})]})]}),l.pin&&e.jsxs("div",{className:"info-quick-card",children:[e.jsx("div",{className:"info-quick-icon",children:e.jsx("span",{className:"info-pin-icon",children:"#"})}),e.jsxs("div",{className:"info-quick-content",children:[e.jsx("span",{className:"info-quick-value mono",children:l.pin}),e.jsx("span",{className:"info-quick-label",children:"Foreman PIN"})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(ri,{size:18}),e.jsx("h3",{children:"Client & Contractor"})]}),e.jsxs("div",{className:"info-section-content",children:[l.general_contractor?e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"General Contractor"}),e.jsx("span",{className:"info-detail-value",children:l.general_contractor})]}):e.jsx("div",{className:"info-detail-row empty",children:e.jsx("span",{className:"info-detail-value",children:"No general contractor specified"})}),l.client_contact&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Client Contact"}),e.jsx("span",{className:"info-detail-value",children:l.client_contact})]}),l.client_phone&&e.jsxs("div",{className:"info-detail-row clickable",children:[e.jsxs("span",{className:"info-detail-label",children:[e.jsx(ii,{size:14}),"Phone"]}),e.jsx("a",{href:`tel:${l.client_phone}`,className:"info-detail-value link",children:l.client_phone})]})]})]}),e.jsxs("div",{className:"info-section-card",children:[e.jsxs("div",{className:"info-section-header",children:[e.jsx(Ts,{size:18}),e.jsx("h3",{children:"Work Areas"}),e.jsxs("div",{className:"info-section-badges",children:[W>0&&e.jsxs("span",{className:"info-badge done",children:[W," Done"]}),H>0&&e.jsxs("span",{className:"info-badge working",children:[H," Active"]}),K>0&&e.jsxs("span",{className:"info-badge pending",children:[K," Pending"]})]})]}),e.jsx("div",{className:"info-areas-list",children:j.map(P=>e.jsxs("div",{className:`info-area-item ${P.status}`,children:[e.jsxs("div",{className:"info-area-status",children:[P.status==="done"&&e.jsx("span",{className:"status-dot done",children:"✓"}),P.status==="working"&&e.jsx("span",{className:"status-dot working",children:"●"}),P.status==="not_started"&&e.jsx("span",{className:"status-dot pending",children:"○"})]}),e.jsxs("div",{className:"info-area-details",children:[e.jsx("span",{className:"info-area-name",children:P.name}),e.jsx("span",{className:`info-area-status-label ${P.status}`,children:P.status==="done"?"Complete":P.status==="working"?"In Progress":"Not Started"})]}),e.jsxs("span",{className:"info-area-weight",children:[P.weight,"%"]})]},P.id))})]}),e.jsx(Ul,{project:l,company:a,user:s,isAdmin:n,onShowToast:t}),e.jsxs("details",{className:"info-details-section",children:[e.jsxs("summary",{className:"info-details-summary",children:[e.jsx(da,{size:16}),e.jsx("span",{children:"Additional Settings"})]}),e.jsxs("div",{className:"info-details-content",children:[e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Original Contract"}),e.jsx("span",{className:"info-detail-value",children:U(l.contract_value)})]}),w>0&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Approved Change Orders"}),e.jsxs("span",{className:"info-detail-value positive",children:["+",U(w)]})]}),l.default_dump_site_id&&e.jsxs("div",{className:"info-detail-row",children:[e.jsx("span",{className:"info-detail-label",children:"Default Dump Site"}),e.jsx("span",{className:"info-detail-value",children:Ya.find(P=>P.id===l.default_dump_site_id)?.name||"Unknown"})]})]})]})]})]}),R&&e.jsx(i.Suspense,{fallback:null,children:e.jsx(ec,{project:l,user:s,onClose:()=>F(!1),onShareCreated:P=>{t("Share link created successfully!","success")}})}),k&&e.jsx("div",{className:"notification-settings-modal",children:e.jsx(i.Suspense,{fallback:null,children:e.jsx(sc,{project:l,company:a,onShowToast:t,onClose:()=>y(!1)})})}),yt&&e.jsx(i.Suspense,{fallback:null,children:e.jsx(rc,{project:l,company:a,areas:j,existingCOR:Nt,onClose:()=>{Se(!1),_e(null)},onSaved:()=>{Se(!1),_e(null),Ja(P=>P+1)},onShowToast:t})}),wt&&Xa&&e.jsx(i.Suspense,{fallback:null,children:e.jsx(ic,{cor:Xa,project:l,company:a,areas:j,onClose:()=>{Ge(!1),Ye(null)},onEdit:P=>{Ge(!1),Ye(null),_e(P),Se(!0)},onShowToast:t,onStatusChange:()=>{}})}),kt&&e.jsx(i.Suspense,{fallback:null,children:e.jsx(dc,{onClose:()=>Na(!1),saving:Dt,onSave:async P=>{try{Za(!0),await T.addProjectCost(l.id,a.id,P),Na(!1),Oe(),t("Cost added successfully","success")}catch($){console.error("Error adding cost:",$),t("Error adding cost","error")}finally{Za(!1)}}})}),Et&&e.jsx(i.Suspense,{fallback:null,children:e.jsx(oc,{project:l,company:a,user:s,editItem:Qa,onSave:()=>{Xe(!1),Je(null),_t(P=>P+1),t(Qa?"Equipment updated":"Equipment added","success")},onClose:()=>{Xe(!1),Je(null)}})}),Pt&&e.jsx(i.Suspense,{fallback:null,children:e.jsx(cc,{project:l,company:a,areas:j,corStats:h.find(P=>P.id===l?.id)?.corStats,editDrawRequest:es,onSave:()=>{Ze(!1),Qe(null),At(P=>P+1),t(es?"Draw request updated":"Draw request created","success")},onClose:()=>{Ze(!1),Qe(null)}})})]})}return o.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(ie,{size:48,className:"empty-state-icon"}),e.jsx("h3",{children:"No Projects Yet"}),e.jsx("p",{children:"Create your first project to get started"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"business-overview",children:[e.jsxs("div",{className:"bo-header",children:[e.jsx("h2",{className:"bo-title",children:"Portfolio Overview"}),e.jsxs("button",{className:"search-trigger-btn",onClick:()=>Mt(!0),children:[e.jsx(rt,{size:16}),e.jsx("span",{children:"Search"}),e.jsx("span",{className:"shortcut",children:"⌘K"})]}),e.jsxs("div",{className:"bo-project-count",children:[o.length," Active Project",o.length!==1?"s":""]})]}),e.jsxs("div",{className:"bo-financial",children:[e.jsx("div",{className:"bo-progress-bar",children:e.jsx("div",{className:"bo-progress-fill",style:{width:`${Math.min(fn,100)}%`}})}),e.jsxs("div",{className:"bo-financial-row",children:[e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:U(vn)}),e.jsx("span",{className:"bo-metric-label",children:"Earned Revenue"})]}),e.jsx("div",{className:"bo-metric-separator",children:"of"}),e.jsxs("div",{className:"bo-metric primary",children:[e.jsx("span",{className:"bo-metric-value",children:U(pn)}),e.jsx("span",{className:"bo-metric-label",children:"Total Portfolio"})]}),e.jsxs("div",{className:"bo-metric highlight",children:[e.jsx("span",{className:"bo-metric-value",children:U(xn)}),e.jsx("span",{className:"bo-metric-label",children:"Remaining to Bill"})]})]}),ls>0&&e.jsxs("div",{className:"bo-change-orders",children:[e.jsxs("div",{className:"bo-co-item",children:[e.jsx("span",{className:"bo-co-label",children:"Original Contracts"}),e.jsx("span",{className:"bo-co-value",children:U(hn)})]}),e.jsxs("div",{className:"bo-co-item bo-co-added",children:[e.jsxs("span",{className:"bo-co-label",children:["+ Change Orders (",hs," project",hs!==1?"s":"",")"]}),e.jsxs("span",{className:"bo-co-value",children:["+",U(ls)]})]})]}),cs>0&&e.jsx("div",{className:"bo-pending-cors",children:e.jsxs("div",{className:"bo-pending-cor-item",children:[e.jsx("span",{className:"bo-pending-cor-icon",children:"!"}),e.jsx("span",{className:"bo-pending-cor-label",children:"Pending CORs"}),e.jsx("span",{className:"bo-pending-cor-value",children:U(jn)}),e.jsxs("span",{className:"bo-pending-cor-count",children:["(",cs," pending)"]})]})})]}),e.jsxs("div",{className:"bo-health",children:[e.jsx("div",{className:"bo-health-title",children:"Project Health"}),e.jsxs("div",{className:"bo-health-pills",children:[os>0&&e.jsxs("div",{className:"bo-pill complete",children:[e.jsx("span",{className:"bo-pill-count",children:os}),e.jsx("span",{className:"bo-pill-label",children:"Complete"})]}),ds>0&&e.jsxs("div",{className:"bo-pill on-track",children:[e.jsx("span",{className:"bo-pill-count",children:ds}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),us>0&&e.jsxs("div",{className:"bo-pill at-risk",children:[e.jsx("span",{className:"bo-pill-count",children:us}),e.jsx("span",{className:"bo-pill-label",children:"At Risk"})]}),ms>0&&e.jsxs("div",{className:"bo-pill over-budget",children:[e.jsx("span",{className:"bo-pill-count",children:ms}),e.jsx("span",{className:"bo-pill-label",children:"Over Budget"})]})]})]}),gn&&e.jsxs("div",{className:"bo-schedule",children:[e.jsx("div",{className:"bo-schedule-title",children:"Schedule Performance"}),e.jsxs("div",{className:"bo-schedule-pills",children:[ps>0&&e.jsxs("div",{className:"bo-pill ahead",children:[e.jsx("span",{className:"bo-pill-count",children:ps}),e.jsx("span",{className:"bo-pill-label",children:"Ahead"})]}),vs>0&&e.jsxs("div",{className:"bo-pill schedule-on-track",children:[e.jsx("span",{className:"bo-pill-count",children:vs}),e.jsx("span",{className:"bo-pill-label",children:"On Track"})]}),xs>0&&e.jsxs("div",{className:"bo-pill behind",children:[e.jsx("span",{className:"bo-pill-count",children:xs}),e.jsx("span",{className:"bo-pill-label",children:"Behind"})]})]}),bn&&e.jsxs("div",{className:"bo-labor-summary",children:[e.jsx("span",{className:"bo-labor-label",children:"Man-Days:"}),js>0&&e.jsxs("span",{className:"bo-labor-badge under",children:[js," under"]}),gs>0&&e.jsxs("span",{className:"bo-labor-badge on-track",children:[gs," on track"]}),fs>0&&e.jsxs("span",{className:"bo-labor-badge over",children:[fs," over"]})]})]})]}),Ae.allAlerts.length>0&&e.jsxs("div",{className:"smart-alerts-section",style:{marginBottom:"var(--space-lg, 1.5rem)"},children:[e.jsx("div",{className:"smart-alerts-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"var(--space-sm, 0.5rem)"},children:e.jsxs("h3",{style:{fontSize:"var(--font-size-md, 1rem)",fontWeight:"var(--font-weight-semibold, 600)",color:"var(--text-primary)",margin:0},children:["Needs Attention",Ae.criticalCount>0&&e.jsxs("span",{style:{marginLeft:"0.5rem",padding:"2px 8px",fontSize:"0.75rem",fontWeight:600,borderRadius:"9999px",background:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"},children:[Ae.criticalCount," critical"]})]})}),e.jsx(Sl,{alerts:Ae.allAlerts,onAction:Yt,maxVisible:3})]}),e.jsxs("div",{className:"dashboard-header",children:[e.jsx("h2",{children:"Projects"}),e.jsxs("span",{className:"project-count",children:[o.length," active"]})]}),e.jsx("div",{className:"project-list",children:h.map(v=>{const D=Ae.projectRisks.find(w=>w.projectId===v.id);return e.jsx(hc,{project:v,riskScore:D?.riskScore,riskStatus:D?.riskStatus,onClick:()=>aa(v)},v.id)})}),e.jsx(Dl,{isOpen:Rt,onClose:It,companyId:a?.id,onSelectProject:v=>{aa(v)},onSelectTicket:v=>{const D=o.find(w=>w.id===v.project_id);D&&(aa(D),M("financials"),G("tickets"))},onSelectCOR:v=>{const D=o.find(w=>w.id===v.project_id);D&&(aa(D),M("financials"),G("cors"),Ye(v),Ge(!0))},onShowToast:t})]})}function hc({project:a,riskScore:s,riskStatus:n,onClick:t}){const r=Mr(a.areas||[]),c=Ir(a.areas||[]),o=a.contract_value-a.billable,d=a.billable>a.contract_value*.9&&a.progress<90,h={healthy:{bg:"var(--status-success-bg, #064e3b)",color:"var(--status-success, #059669)"},warning:{bg:"var(--status-warning-bg, #78350f)",color:"var(--status-warning, #d97706)"},critical:{bg:"var(--status-danger-bg, #7f1d1d)",color:"var(--status-danger, #dc2626)"}},m=h[n]||h.healthy;return e.jsxs("div",{className:`project-card enhanced ${d?"at-risk":""}`,onClick:t,children:[e.jsxs("div",{className:"project-card-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[typeof s=="number"&&e.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"32px",height:"32px",borderRadius:"50%",fontSize:"0.75rem",fontWeight:700,background:m.bg,color:m.color},title:`Risk Score: ${s}`,"aria-label":`Risk score ${s}, ${n}`,children:s}),e.jsxs("div",{children:[e.jsx("div",{className:"project-card-name",children:a.name}),e.jsx("div",{className:"project-card-value",children:U(a.contract_value)})]})]}),e.jsx("span",{className:`status-badge ${r}`,children:c})]}),e.jsxs("div",{className:"project-stats-row",children:[e.jsxs("div",{className:"project-stat",children:[e.jsxs("span",{className:"stat-value",children:[a.progress,"%"]}),e.jsx("span",{className:"stat-label",children:"Complete"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:"stat-value",children:U(a.billable)}),e.jsx("span",{className:"stat-label",children:"Billable"})]}),e.jsxs("div",{className:"project-stat",children:[e.jsx("span",{className:`stat-value ${o<0?"negative":""}`,children:U(Math.abs(o))}),e.jsx("span",{className:"stat-label",children:o>=0?"Remaining":"Over Budget"})]})]}),e.jsx("div",{className:"mini-progress-bar",children:e.jsx("div",{className:"mini-progress-fill",style:{width:`${a.progress}%`}})}),(a.pendingTickets>0||a.totalTickets>0)&&e.jsxs("div",{className:"project-badges",children:[a.pendingTickets>0&&e.jsxs("span",{className:"badge pending",children:[a.pendingTickets," Pending T&M"]}),a.approvedTickets>0&&e.jsxs("span",{className:"badge approved",children:[a.approvedTickets," Approved T&M"]})]}),a.hasScheduleData&&e.jsxs("div",{className:"project-schedule-badge",children:[e.jsx("span",{className:`schedule-indicator ${a.scheduleStatus}`,children:a.scheduleLabel}),a.hasLaborData&&a.laborLabel&&e.jsx("span",{className:`labor-indicator ${a.laborStatus}`,children:a.laborLabel})]})]})}const yc=Object.freeze(Object.defineProperty({__proto__:null,default:mc},Symbol.toStringTag,{value:"Module"}));export{hl as A,Gl as C,yc as D,gc as E,we as T,Me as a,bc as b,jc as c};
//# sourceMappingURL=Dashboard-B_3NDSH5.js.map
