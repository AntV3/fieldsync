import{c as X,r as i,j as e,X as Y,B as I,x as L,b as U,h as W}from"./index-C5HwCNiJ.js";import{U as A}from"./user-Cs4Co42N.js";import{P as G}from"./pen-Ciasju_K.js";import"./react-DXGY7bZi.js";import"./pdf-ChZ1zkDw.js";import"./supabase-VuevzHjS.js";const _=[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]],J=X("building",_);function ee({ticketId:w,ticketSummary:o,lang:S="en",onSave:M,onClose:g,onShowToast:m}){const n=i.useRef(null),[l,T]=i.useState(""),[u,P]=i.useState(""),[h,D]=i.useState(""),[d,j]=i.useState(!1),[R,f]=i.useState(!1),[x,y]=i.useState(!1),N={en:{title:"Client Signature",subtitle:"Sign to verify the work performed",signerName:"Your Name",signerNamePlaceholder:"Full name",signerTitle:"Title",signerTitlePlaceholder:"e.g. Project Manager",signerCompany:"Company",signerCompanyPlaceholder:"Company name",signBelow:"Sign below",signHere:"Sign here",clear:"Clear",cancel:"Cancel",saveSignature:"Submit Signature",saving:"Saving...",workDate:"Work Date",workers:"Workers",hours:"Total Hours",certification:"By signing, I acknowledge that the work described in this T&M ticket was performed as documented.",nameRequired:"Please enter your name",signatureRequired:"Please sign above",signatureSaved:"Signature saved successfully",signatureError:"Error saving signature"},es:{title:"Firma del Cliente",subtitle:"Firme para verificar el trabajo realizado",signerName:"Su Nombre",signerNamePlaceholder:"Nombre completo",signerTitle:"Titulo",signerTitlePlaceholder:"ej. Gerente de Proyecto",signerCompany:"Empresa",signerCompanyPlaceholder:"Nombre de la empresa",signBelow:"Firme abajo",signHere:"Firme aqui",clear:"Borrar",cancel:"Cancelar",saveSignature:"Enviar Firma",saving:"Guardando...",workDate:"Fecha",workers:"Trabajadores",hours:"Horas Total",certification:"Al firmar, reconozco que el trabajo descrito en este ticket T&M fue realizado como se documenta.",nameRequired:"Por favor ingrese su nombre",signatureRequired:"Por favor firme arriba",signatureSaved:"Firma guardada exitosamente",signatureError:"Error al guardar la firma"}},r=N[S]||N.en,v=()=>{const s=n.current;return s?s.getContext("2d"):null},b=s=>{const a=n.current;if(!a)return{x:0,y:0};const t=a.getBoundingClientRect(),c=a.width/t.width,F=a.height/t.height,q=s.touches?s.touches[0].clientX:s.clientX,H=s.touches?s.touches[0].clientY:s.clientY;return{x:(q-t.left)*c,y:(H-t.top)*F}},C=s=>{s.preventDefault();const a=v();if(!a)return;const{x:t,y:c}=b(s);a.beginPath(),a.moveTo(t,c),f(!0),j(!0)},k=s=>{if(!R)return;s.preventDefault();const a=v();if(!a)return;const{x:t,y:c}=b(s);a.lineTo(t,c),a.stroke()},p=()=>{f(!1)},z=()=>{const s=n.current,a=v();!s||!a||(a.clearRect(0,0,s.width,s.height),j(!1))},E=s=>{if(!s)return;n.current=s;const a=s.getContext("2d");a.strokeStyle="#1e293b",a.lineWidth=2,a.lineCap="round",a.lineJoin="round"},B=async()=>{if(!l.trim()){m?.(r.nameRequired,"error");return}if(!d){m?.(r.signatureRequired,"error");return}const s=n.current;if(s){y(!0);try{const a=s.toDataURL("image/png");await W.saveTMClientSignature(w,{signature:a,signerName:l.trim(),signerTitle:u.trim()||null,signerCompany:h.trim()||null,signedAt:new Date().toISOString()}),m?.(r.signatureSaved,"success"),M?.({signerName:l.trim(),signerTitle:u.trim(),signerCompany:h.trim()})}catch(a){console.error("Error saving signature:",a),m?.(r.signatureError,"error")}finally{y(!1)}}};return e.jsx("div",{className:"tm-modal-overlay",onClick:g,children:e.jsxs("div",{className:"tm-client-signature-modal",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"tm-sig-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:r.title}),e.jsx("p",{className:"tm-sig-subtitle",children:r.subtitle})]}),e.jsx("button",{className:"tm-sig-close",onClick:g,children:e.jsx(Y,{size:20})})]}),e.jsxs("div",{className:"tm-sig-body",children:[o&&e.jsxs("div",{className:"tm-sig-summary",children:[e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:r.workDate}),e.jsx("span",{className:"tm-sig-summary-value",children:new Date(o.workDate).toLocaleDateString()})]}),e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:r.workers}),e.jsx("span",{className:"tm-sig-summary-value",children:o.workerCount})]}),e.jsxs("div",{className:"tm-sig-summary-item",children:[e.jsx("span",{className:"tm-sig-summary-label",children:r.hours}),e.jsx("span",{className:"tm-sig-summary-value",children:o.totalHours})]})]}),e.jsxs("div",{className:"tm-sig-fields",children:[e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(A,{size:14}),r.signerName," *"]}),e.jsx("input",{type:"text",value:l,onChange:s=>T(s.target.value),placeholder:r.signerNamePlaceholder})]}),e.jsxs("div",{className:"tm-sig-field-row",children:[e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(I,{size:14}),r.signerTitle]}),e.jsx("input",{type:"text",value:u,onChange:s=>P(s.target.value),placeholder:r.signerTitlePlaceholder})]}),e.jsxs("div",{className:"tm-sig-field",children:[e.jsxs("label",{children:[e.jsx(J,{size:14}),r.signerCompany]}),e.jsx("input",{type:"text",value:h,onChange:s=>D(s.target.value),placeholder:r.signerCompanyPlaceholder})]})]})]}),e.jsxs("div",{className:"tm-sig-area",children:[e.jsxs("div",{className:"tm-sig-label",children:[e.jsx(G,{size:14}),e.jsx("span",{children:r.signBelow})]}),e.jsxs("div",{className:"tm-sig-canvas-container",children:[e.jsx("canvas",{ref:E,width:500,height:180,className:"tm-sig-canvas",onMouseDown:C,onMouseMove:k,onMouseUp:p,onMouseLeave:p,onTouchStart:C,onTouchMove:k,onTouchEnd:p}),!d&&e.jsx("div",{className:"tm-sig-placeholder",children:r.signHere})]}),e.jsxs("button",{className:"tm-sig-clear",onClick:z,disabled:!d,children:[e.jsx(L,{size:14})," ",r.clear]})]}),e.jsx("p",{className:"tm-sig-certification",children:r.certification})]}),e.jsxs("div",{className:"tm-sig-footer",children:[e.jsx("button",{className:"tm-sig-btn secondary",onClick:g,disabled:x,children:r.cancel}),e.jsx("button",{className:"tm-sig-btn primary",onClick:B,disabled:!d||!l.trim()||x,children:x?r.saving:e.jsxs(e.Fragment,{children:[e.jsx(U,{size:16})," ",r.saveSignature]})})]})]})})}export{ee as default};
