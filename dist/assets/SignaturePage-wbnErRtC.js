import{aO as Ce,aP as ge,aQ as Fe,as as e,ar as re}from"./index-BFDJUxru.js";import{r as I,X as Pe,v as De,a7 as Ie,R as $e,d as Re,a as pe,ao as je,j as Z,D as he,F as _e,H as be,ac as ue,f as fe,N as Oe,l as Ae,B as Ee,q as Ne,y as ve,O as Me,c as me}from"./icons-B-oSmWeD.js";import{c as Te,a as we,b as se,f as b,d as W,e as le}from"./corCalculations-D9qkkIbo.js";import{E as ze,a as ne}from"./pdf-aQqpMATS.js";import"./react-DXGY7bZi.js";import"./supabase-VuevzHjS.js";const Se=o=>{if(!o)return"";const[j,S]=o.split(":"),y=parseInt(j),a=y>=12?"pm":"am";return`${y%12||12}:${S}${a}`},ke=o=>o.time_started&&o.time_ended?`${Se(o.time_started)} - ${Se(o.time_ended)}`:"-";async function qe(o){if(!o||o.length===0)return{totalPhotos:0,verified:0,failed:0,issues:[],manifest:[]};const j=[];let S=0,y=0;const a=[];for(const p of o)if(!(!p.photos||p.photos.length===0))for(const O of p.photos){const l={ticketId:p.id,workDate:p.work_date,url:O,verified:!1,error:null};try{await ge(O)?(l.verified=!0,S++):(l.error="Failed to load image",y++,a.push({ticketId:p.id,workDate:p.work_date,url:O,error:"Failed to load image"}))}catch(r){l.error=r.message||"Unknown error",y++,a.push({ticketId:p.id,workDate:p.work_date,url:O,error:l.error})}j.push(l)}return{totalPhotos:S+y,verified:S,failed:y,issues:a,manifest:j,allVerified:y===0,verifiedAt:new Date().toISOString()}}function Le(o,j,S,y){const a=JSON.stringify({cor:o,tmTickets:j,photoManifest:S,totals:y});let p=0;for(let l=0;l<a.length;l++){const r=a.charCodeAt(l);p=(p<<5)-p+r,p=p&p}const O=Math.abs(p).toString(16).padStart(16,"0");return{cor_data:{id:o.id,cor_number:o.cor_number,title:o.title,description:o.description,status:o.status,created_at:o.created_at,submitted_at:o.submitted_at,labor_items:o.labor_items,material_items:o.material_items,equipment_items:o.equipment_items,gc_markup_percent:o.gc_markup_percent,profit_markup_percent:o.profit_markup_percent},tickets_data:(j||[]).map(l=>({id:l.id,work_date:l.work_date,ce_pco_number:l.ce_pco_number,notes:l.notes,status:l.status,created_at:l.created_at,workers:l.t_and_m_workers||[],items:l.t_and_m_items||[],photos:l.photos||[],client_signature_name:l.client_signature_name,client_signature_date:l.client_signature_date})),photos_manifest:S,totals_snapshot:y,checksum:O}}async function Ue(o,j,S,y={},a=null,p={}){const{verifyPhotos:O=!1,createSnapshot:l=!1}=p;let r=null;O&&a?.length>0&&(r=await qe(a));const t=new ze,N=t.internal.pageSize.getWidth(),P=t.internal.pageSize.getHeight(),n=20;let s=n;const k=Te(o),c=y.primaryColor?Ce(y.primaryColor):[30,58,138],F=[241,245,249];let T=null;if(y.logoUrl)try{T=await ge(y.logoUrl)}catch(x){console.error("Error loading logo:",x)}if(T)try{t.addImage(T,"PNG",n,s,40,15),s+=20}catch{t.setFontSize(16),t.setFont("helvetica","bold"),t.setTextColor(...c),t.text(S?.name||"Company Name",n,s+10),s+=20}else t.setFontSize(16),t.setFont("helvetica","bold"),t.setTextColor(...c),t.text(S?.name||"Company Name",n,s+10),s+=20;t.setFontSize(20),t.setFont("helvetica","bold"),t.setTextColor(0,0,0),t.text("CHANGE ORDER REQUEST",n,s),s+=10,t.setFontSize(12),t.setFont("helvetica","normal"),t.setTextColor(100,100,100),t.text(o.cor_number||"COR-XXXX",n,s);const q=o.status?.replace("_"," ").toUpperCase()||"DRAFT";t.setTextColor(...c),t.text(q,N-n-t.getTextWidth(q),s),s+=12,t.setDrawColor(...c),t.setLineWidth(.5),t.line(n,s,N-n,s),s+=10,t.setFontSize(10),t.setTextColor(0,0,0);const R=n,B=N/2;t.setFont("helvetica","bold"),t.text("Project:",R,s),t.setFont("helvetica","normal"),t.text(j?.name||"Project Name",R+25,s),t.setFont("helvetica","bold"),t.text("Job #:",B,s),t.setFont("helvetica","normal"),t.text(j?.job_number||"N/A",B+25,s),s+=6,t.setFont("helvetica","bold"),t.text("Period:",R,s),t.setFont("helvetica","normal"),t.text(we(o.period_start,o.period_end),R+25,s),t.setFont("helvetica","bold"),t.text("Date:",B,s),t.setFont("helvetica","normal"),t.text(se(o.created_at),B+25,s),s+=10,t.setFont("helvetica","bold"),t.setFontSize(12),t.text(o.title||"Untitled Change Order",n,s),s+=8,t.setFont("helvetica","normal"),t.setFontSize(10),t.setTextColor(80,80,80);const E=t.splitTextToSize(o.scope_of_work||"No scope of work provided.",N-n*2);t.text(E,n,s),s+=E.length*5+10,o.change_order_labor?.length>0&&(t.setFont("helvetica","bold"),t.setFontSize(11),t.setTextColor(0,0,0),t.text("LABOR",n,s),s+=6,ne(t,{startY:s,head:[["Class","Type","Reg Hrs","Reg Rate","OT Hrs","OT Rate","Total"]],body:o.change_order_labor.map(x=>[x.labor_class,x.wage_type,x.regular_hours.toString(),`$${le(x.regular_rate)}/hr`,x.overtime_hours?.toString()||"-",x.overtime_hours?`$${le(x.overtime_rate)}/hr`:"-",b(x.total)]),foot:[[{content:`Subtotal: ${b(k.labor_subtotal)}`,colSpan:5,styles:{halign:"right",fontStyle:"bold"}},{content:`+${W(o.labor_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:b(k.labor_subtotal+k.labor_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:n,right:n},headStyles:{fillColor:c,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:F,textColor:[0,0,0],fontSize:8},theme:"striped"}),s=t.lastAutoTable.finalY+10),o.change_order_materials?.length>0&&(s>P-80&&(t.addPage(),s=n),t.setFont("helvetica","bold"),t.setFontSize(11),t.setTextColor(0,0,0),t.text("MATERIALS",n,s),s+=6,ne(t,{startY:s,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:o.change_order_materials.map(x=>[x.description,x.source_reference||x.source_type,x.quantity.toString(),x.unit,`$${le(x.unit_cost)}`,b(x.total)]),foot:[[{content:`Subtotal: ${b(k.materials_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${W(o.materials_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:b(k.materials_subtotal+k.materials_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:n,right:n},headStyles:{fillColor:c,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:F,textColor:[0,0,0],fontSize:8},theme:"striped"}),s=t.lastAutoTable.finalY+10),o.change_order_equipment?.length>0&&(s>P-80&&(t.addPage(),s=n),t.setFont("helvetica","bold"),t.setFontSize(11),t.setTextColor(0,0,0),t.text("EQUIPMENT",n,s),s+=6,ne(t,{startY:s,head:[["Description","Source","Qty","Unit","Unit Cost","Total"]],body:o.change_order_equipment.map(x=>[x.description,x.source_reference||x.source_type,x.quantity.toString(),x.unit,`$${le(x.unit_cost)}`,b(x.total)]),foot:[[{content:`Subtotal: ${b(k.equipment_subtotal)}`,colSpan:4,styles:{halign:"right",fontStyle:"bold"}},{content:`+${W(o.equipment_markup_percent||1500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:b(k.equipment_subtotal+k.equipment_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:n,right:n},headStyles:{fillColor:c,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:F,textColor:[0,0,0],fontSize:8},theme:"striped"}),s=t.lastAutoTable.finalY+10),o.change_order_subcontractors?.length>0&&(s>P-80&&(t.addPage(),s=n),t.setFont("helvetica","bold"),t.setFontSize(11),t.setTextColor(0,0,0),t.text("SUBCONTRACTORS",n,s),s+=6,ne(t,{startY:s,head:[["Company","Description","Source","Amount"]],body:o.change_order_subcontractors.map(x=>[x.company_name,x.description,x.source_reference||x.source_type,b(x.total)]),foot:[[{content:`Subtotal: ${b(k.subcontractors_subtotal)}`,colSpan:2,styles:{halign:"right",fontStyle:"bold"}},{content:`+${W(o.subcontractors_markup_percent||500)} Markup`,colSpan:1,styles:{halign:"right"}},{content:b(k.subcontractors_subtotal+k.subcontractors_markup_amount),styles:{fontStyle:"bold"}}]],margin:{left:n,right:n},headStyles:{fillColor:c,textColor:[255,255,255],fontStyle:"bold",fontSize:8},bodyStyles:{fontSize:8},footStyles:{fillColor:F,textColor:[0,0,0],fontSize:8},theme:"striped"}),s=t.lastAutoTable.finalY+10),s>P-100&&(t.addPage(),s=n),t.setFillColor(...F),t.roundedRect(n,s,N-n*2,70,3,3,"F"),s+=10,t.setFontSize(10),t.setFont("helvetica","normal"),t.setTextColor(0,0,0);const M=n+10,L=N-n-60;t.text("COR Subtotal:",M,s),t.setFont("helvetica","bold"),t.text(b(k.cor_subtotal),L,s,{align:"right"}),s+=8,t.setFont("helvetica","normal"),t.setFontSize(9),t.text(`Liability Insurance (${W(o.liability_insurance_percent||144)}):`,M,s),t.text(b(k.liability_insurance_amount),L,s,{align:"right"}),s+=6,t.text(`Bond (${W(o.bond_percent||100)}):`,M,s),t.text(b(k.bond_amount),L,s,{align:"right"}),s+=6,t.text(`City License Fee (${W(o.license_fee_percent||10)}):`,M,s),t.text(b(k.license_fee_amount),L,s,{align:"right"}),s+=10,t.setFillColor(...c),t.roundedRect(M-5,s-3,N-n*2-10,16,2,2,"F"),t.setTextColor(255,255,255),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("COR TOTAL:",M,s+8),t.text(b(k.cor_total),L,s+8,{align:"right"}),s+=25,s>P-120&&(t.addPage(),s=n),s+=10,t.setTextColor(0,0,0),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("AUTHORIZATION",n,s),s+=15,t.setFont("helvetica","normal"),t.setFontSize(9),t.setDrawColor(0,0,0);const K=(x,G,H,V,g,u,v)=>{t.setFont("helvetica","bold"),t.setFontSize(8),t.text(G,n,x),t.setFont("helvetica","normal"),t.setFontSize(9);const z=x+20;if(t.line(n,z,n+70,z),t.text("Signature",n,z+8),t.line(n+85,z,n+145,z),t.text("Title / Company",n+85,z+8),t.line(N-n-40,z,N-n,z),t.text("Date",N-n-40,z+8),H)try{if(t.addImage(H,"PNG",n,z-18,60,18),V&&(t.setFontSize(8),t.text(V,n,z+15)),g||u){const A=[g,u].filter(Boolean).join(" - ");t.text(A,n+85,z-5)}v&&t.text(se(v),N-n-40,z-5)}catch(A){console.error("Error adding signature:",A)}else t.setFont("helvetica","italic"),t.setFontSize(9),t.setTextColor(150,150,150),t.text("Awaiting Signature",n+5,z-5),t.setTextColor(0,0,0),t.setFont("helvetica","normal");return z+25};if(s=K(s,"GC AUTHORIZATION",o.gc_signature_data||o.gc_signature,o.gc_signature_name||o.gc_signer_name,o.gc_signature_title,o.gc_signature_company,o.gc_signature_date||o.signed_at),s+=10,s=K(s,"CLIENT AUTHORIZATION",o.client_signature_data,o.client_signature_name,o.client_signature_title,o.client_signature_company,o.client_signature_date),a&&a.length>0){const x=a.reduce((m,i)=>m+(i.t_and_m_workers?.reduce((f,_)=>f+(parseFloat(_.hours)||0),0)||0),0),G=a.reduce((m,i)=>m+(i.t_and_m_workers?.reduce((f,_)=>f+(parseFloat(_.overtime_hours)||0),0)||0),0),H=a.reduce((m,i)=>m+(i.photos?.length||0),0),V=a.filter(m=>m.client_signature_data).length,g=a.length>0?{start:a.reduce((m,i)=>!m||i.work_date<m?i.work_date:m,null),end:a.reduce((m,i)=>!m||i.work_date>m?i.work_date:m,null)}:null,u=new Uint8Array(3);crypto.getRandomValues(u);const v=Array.from(u,m=>m.toString(36)).join("").toUpperCase().substring(0,4),z=`FS-${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}${String(new Date().getDate()).padStart(2,"0")}-${v}`;if(t.addPage(),s=n,T)try{t.addImage(T,"PNG",n,s,50,18)}catch{t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(...c),t.text(S?.name||"Company Name",n,s+10)}else t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(...c),t.text(S?.name||"Company Name",n,s+10);s+=35,t.setDrawColor(...c),t.setLineWidth(.8),t.line(n,s,N-n,s),t.setLineWidth(.3),t.line(n,s+3,N-n,s+3),s+=15,t.setFontSize(22),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("SUPPORTING DOCUMENTATION",N/2,s,{align:"center"}),s+=8,t.setFontSize(12),t.setFont("helvetica","normal"),t.setTextColor(100,116,139),t.text("Change Order Request Backup",N/2,s,{align:"center"}),s+=8,t.setDrawColor(...c),t.setLineWidth(.3),t.line(n,s,N-n,s),t.setLineWidth(.8),t.line(n,s+3,N-n,s+3),s+=20,t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("COR Reference:",n,s),t.setFont("helvetica","normal"),t.text(o.cor_number||"N/A",n+35,s),t.setFont("helvetica","bold"),t.text("Project:",N/2,s),t.setFont("helvetica","normal"),t.text(j?.name||"N/A",N/2+20,s),s+=7,t.setFont("helvetica","bold"),t.text("Job #:",n,s),t.setFont("helvetica","normal"),t.text(j?.job_number||"N/A",n+35,s),s+=20,t.setFillColor(248,250,252),t.setDrawColor(203,213,225),t.roundedRect(n,s,N-n*2,65,4,4,"FD"),s+=10,t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text("DOCUMENTATION SUMMARY",n+10,s),t.setDrawColor(203,213,225),t.setLineWidth(.3),t.line(n+10,s+3,n+80,s+3),s+=12,t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(71,85,105);const A=n+15,J=n+70;t.text("T&M Tickets:",A,s),t.setFont("helvetica","bold"),t.text(String(a.length),J,s),t.setFont("helvetica","normal"),s+=7,t.text("Total Labor:",A,s),t.setFont("helvetica","bold"),t.text(`${x.toFixed(1)} hrs`,J,s),t.setFont("helvetica","normal"),s+=7,G>0&&(t.text("Total OT:",A,s),t.setFont("helvetica","bold"),t.text(`${G.toFixed(1)} hrs`,J,s),t.setFont("helvetica","normal"),s+=7),t.text("Photo Evidence:",A,s),t.setFont("helvetica","bold"),t.text(`${H} photos`,J,s),t.setFont("helvetica","normal"),s+=7,t.text("Client Verified:",A,s),t.setFont("helvetica","bold"),t.setTextColor(V>0?16:71,V>0?185:85,V>0?129:105),t.text(`${V} of ${a.length} tickets`,J,s),t.setTextColor(71,85,105),t.setFont("helvetica","normal"),s+=7,g?.start&&g?.end&&(t.text("Date Range:",A,s),t.setFont("helvetica","bold"),t.text(`${se(g.start)} - ${se(g.end)}`,J,s)),s+=30,t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(100,116,139);const U=new Date;t.text(`Generated: ${U.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})} at ${U.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`,n,s),s+=6,t.text(`Document ID: ${z}`,n,s);for(const m of a){t.addPage(),s=n;const i=!!m.client_signature_data,f=22,_=i?[16,185,129]:m.status==="approved"?[16,185,129]:[245,158,11];if(t.setFillColor(..._),t.rect(n,s,4,f,"F"),t.setFillColor(248,250,252),t.rect(n+4,s,N-n*2-4,f,"F"),t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(30,41,59),t.text(`T&M TICKET — ${se(m.work_date)}`,n+10,s+8),m.ce_pco_number&&(t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(59,130,246),t.text(`CE/PCO: ${m.ce_pco_number}`,n+10,s+16)),i&&(t.setFontSize(8),t.setFont("helvetica","bold"),t.setTextColor(16,185,129),t.text("✓ CLIENT VERIFIED",N-n-35,s+12)),s+=f+8,m.notes){t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("DESCRIPTION",n,s),s+=6,t.setFontSize(9),t.setFont("helvetica","normal"),t.setTextColor(51,65,85);const h=t.splitTextToSize(m.notes,N-n*2);t.text(h,n,s),s+=h.length*4+10}if(m.t_and_m_workers?.length>0&&(t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("LABOR",n,s),s+=6,ne(t,{startY:s,head:[["Worker","Time Period","Class","Reg Hrs","OT Hrs"]],body:m.t_and_m_workers.map(h=>[h.name,ke(h),h.role||h.labor_class||"Laborer",h.hours?.toString()||"0",h.overtime_hours?.toString()||"-"]),margin:{left:n,right:n},headStyles:{fillColor:c,textColor:[255,255,255],fontSize:8,cellPadding:3,fontStyle:"bold"},bodyStyles:{fontSize:8,cellPadding:3},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),s=t.lastAutoTable.finalY+10),m.t_and_m_items?.length>0&&(s>P-60&&(t.addPage(),s=n),t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("MATERIALS / EQUIPMENT",n,s),t.setFontSize(7),t.setFont("helvetica","normal"),t.setTextColor(100,116,139),t.text("Source: T&M Ticket",n+55,s),s+=6,ne(t,{startY:s,head:[["Item","Qty","Unit","Unit Cost","Total"]],body:m.t_and_m_items.map(h=>[h.materials_equipment?.name||h.description||"Item",h.quantity?.toString()||"1",h.materials_equipment?.unit||"ea",h.materials_equipment?.cost_per_unit?`$${h.materials_equipment.cost_per_unit}`:"-",h.materials_equipment?.cost_per_unit&&h.quantity?`$${(h.quantity*h.materials_equipment.cost_per_unit).toFixed(2)}`:"-"]),margin:{left:n,right:n},headStyles:{fillColor:c,textColor:[255,255,255],fontSize:8,cellPadding:3,fontStyle:"bold"},bodyStyles:{fontSize:8,cellPadding:3},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),s=t.lastAutoTable.finalY+10),m.photos?.length>0){s>P-80&&(t.addPage(),s=n),t.setFontSize(10),t.setFont("helvetica","bold"),t.setTextColor(71,85,105),t.text("PHOTO DOCUMENTATION",n,s),t.setFontSize(8),t.setFont("helvetica","normal"),t.setTextColor(59,130,246),t.text(`${m.photos.length} photo${m.photos.length!==1?"s":""}`,n+50,s),s+=8;let h=n;const d=55,D=45,X=6,ee=3,Q=1,C=await Fe(m.photos);for(let $=0;$<m.photos.length;$++){$>0&&$%ee===0&&(h=n,s+=D+X+4),s+D>P-20&&(t.addPage(),s=n,h=n);const te=C[$];te?(t.setDrawColor(200,200,200),t.setLineWidth(Q),t.rect(h-Q,s-Q,d+Q*2,D+Q*2,"S"),t.setFillColor(230,230,230),t.rect(h+2,s+2,d,D,"F"),t.addImage(te,"JPEG",h,s,d,D)):(t.setFillColor(245,245,245),t.rect(h,s,d,D,"F"),t.setDrawColor(200,200,200),t.rect(h,s,d,D,"S"),t.setFontSize(7),t.setTextColor(150,150,150),t.text("Photo unavailable",h+8,s+D/2)),h+=d+X}s+=D+12}if(m.client_signature_data){s>P-50&&(t.addPage(),s=n);const h=32,d=N-n*2;t.setFillColor(240,253,244),t.roundedRect(n,s,d,h,3,3,"F"),t.setFillColor(16,185,129),t.rect(n,s,4,h,"F"),t.setDrawColor(187,247,208),t.setLineWidth(.5),t.line(n+4,s,n+d,s);const D=n+14,X=s+h/2;t.setFillColor(16,185,129),t.circle(D,X,6,"F"),t.setFontSize(9),t.setTextColor(255,255,255),t.text("✓",D-2.5,X+3),t.setFontSize(9),t.setFont("helvetica","bold"),t.setTextColor(16,185,129),t.text("CLIENT VERIFIED",n+26,s+10);try{t.addImage(m.client_signature_data,"PNG",n+26,s+13,50,16);const C=m.client_signature_name||"Client",$=m.client_signature_title||"",te=m.client_signature_company||"",xe=m.client_signature_date?se(m.client_signature_date):"",de=n+85;t.setFont("helvetica","bold"),t.setFontSize(9),t.setTextColor(30,41,59),t.text(C,de,s+12),t.setFont("helvetica","normal"),t.setFontSize(8),t.setTextColor(71,85,105),($||te)&&t.text(`${$}${$&&te?", ":""}${te}`,de,s+18),xe&&(t.setTextColor(100,116,139),t.text(`Verified: ${xe}`,de,s+24))}catch{const Q=m.client_signature_name||"Client";t.setFont("helvetica","normal"),t.setFontSize(9),t.setTextColor(30,41,59),t.text(`Signed by: ${Q}`,n+26,s+20)}s+=h+8}s+=5,t.setDrawColor(200,200,200),t.setLineWidth(.2),t.line(n,s,N-n,s),s+=10}}const Y=t.internal.getNumberOfPages();for(let x=1;x<=Y;x++){t.setPage(x);const G=P-10;t.setFontSize(8),t.setTextColor(150,150,150),t.text(`Generated on ${new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,n,G),t.text(`Page ${x} of ${Y}`,N-n,G,{align:"right"})}const w=`${o.cor_number||"COR"}_${j?.job_number||"export"}${a?.length?"_with_backup":""}.pdf`;t.save(w);const ae={success:!0,fileName:w,exportedAt:new Date().toISOString(),photoManifest:r};return l&&(ae.snapshot=Le(o,a,r,k)),ae}async function He(o,j,S,y={}){const a=new ze("p","mm","letter"),p=a.internal.pageSize.getWidth(),O=a.internal.pageSize.getHeight(),l=20;let r=l;const t=y.primaryColor?Ce(y.primaryColor):[30,58,95];if(y.logoUrl)try{const c=await ge(y.logoUrl);c&&a.addImage(c,"PNG",l,r,40,15)}catch{S?.name&&(a.setFontSize(14),a.setFont("helvetica","bold"),a.setTextColor(...t),a.text(S.name,l,r+8))}else S?.name&&(a.setFontSize(14),a.setFont("helvetica","bold"),a.setTextColor(...t),a.text(S.name,l,r+8));if(a.setFontSize(16),a.setFont("helvetica","bold"),a.setTextColor(30,41,59),a.text("T&M TICKET",p-l,r+8,{align:"right"}),r+=25,a.setDrawColor(...t),a.setLineWidth(.5),a.line(l,r,p-l,r),r+=10,!!o.client_signature_data&&(a.setFillColor(240,253,244),a.roundedRect(p-l-45,r-5,45,12,2,2,"F"),a.setFontSize(9),a.setFont("helvetica","bold"),a.setTextColor(16,185,129),a.text("✓ CLIENT VERIFIED",p-l-42,r+3)),a.setFontSize(10),a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("Project:",l,r),a.setFont("helvetica","normal"),a.setTextColor(30,41,59),a.text(j?.name||"N/A",l+20,r),r+=6,j?.job_number&&(a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("Job #:",l,r),a.setFont("helvetica","normal"),a.setTextColor(30,41,59),a.text(j.job_number,l+20,r),r+=6),a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("Work Date:",l,r),a.setFont("helvetica","normal"),a.setTextColor(30,41,59),a.text(se(o.work_date||o.ticket_date),l+26,r),o.ce_pco_number&&(a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("CE/PCO:",l+70,r),a.setFont("helvetica","normal"),a.setTextColor(59,130,246),a.text(o.ce_pco_number,l+88,r)),r+=12,o.notes){a.setFontSize(10),a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("DESCRIPTION",l,r),r+=6,a.setFontSize(9),a.setFont("helvetica","normal"),a.setTextColor(51,65,85);const c=a.splitTextToSize(o.notes,p-l*2);a.text(c,l,r),r+=c.length*4+10}o.t_and_m_workers?.length>0&&(a.setFontSize(10),a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("LABOR",l,r),r+=6,ne(a,{startY:r,head:[["Worker","Time Period","Class","Reg Hrs","OT Hrs"]],body:o.t_and_m_workers.map(c=>[c.name,ke(c),c.role||c.labor_class||"Laborer",c.hours?.toString()||"0",c.overtime_hours?.toString()||"-"]),margin:{left:l,right:l},headStyles:{fillColor:t,textColor:[255,255,255],fontSize:8,cellPadding:3,fontStyle:"bold"},bodyStyles:{fontSize:8,cellPadding:3},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),r=a.lastAutoTable.finalY+10);const P=o.t_and_m_items||o.materials_equipment?.filter(c=>c.type==="material")||[];if(P.length>0&&(r>O-60&&(a.addPage(),r=l),a.setFontSize(10),a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("MATERIALS / EQUIPMENT",l,r),r+=6,ne(a,{startY:r,head:[["Item","Qty","Unit"]],body:P.map(c=>[c.materials_equipment?.name||c.description||c.name||"Item",c.quantity?.toString()||"1",c.materials_equipment?.unit||c.unit||"ea"]),margin:{left:l,right:l},headStyles:{fillColor:t,textColor:[255,255,255],fontSize:8,cellPadding:3,fontStyle:"bold"},bodyStyles:{fontSize:8,cellPadding:3},alternateRowStyles:{fillColor:[248,250,252]},theme:"grid"}),r=a.lastAutoTable.finalY+10),o.photos?.length>0){r>O-80&&(a.addPage(),r=l),a.setFontSize(10),a.setFont("helvetica","bold"),a.setTextColor(71,85,105),a.text("PHOTO DOCUMENTATION",l,r),a.setFontSize(8),a.setFont("helvetica","normal"),a.setTextColor(59,130,246),a.text(`${o.photos.length} photo${o.photos.length!==1?"s":""}`,l+50,r),r+=8;let c=l;const F=55,T=45,q=6,R=3,B=await Fe(o.photos);for(let E=0;E<o.photos.length;E++){E>0&&E%R===0&&(c=l,r+=T+q+4),r+T>O-20&&(a.addPage(),r=l,c=l);const M=B[E];M?(a.setDrawColor(200,200,200),a.setLineWidth(1),a.rect(c-1,r-1,F+2,T+2,"S"),a.setFillColor(230,230,230),a.rect(c+2,r+2,F,T,"F"),a.addImage(M,"JPEG",c,r,F,T)):(a.setFillColor(245,245,245),a.rect(c,r,F,T,"F"),a.setDrawColor(200,200,200),a.rect(c,r,F,T,"S"),a.setFontSize(7),a.setTextColor(150,150,150),a.text("Photo unavailable",c+8,r+T/2)),c+=F+q}r+=T+12}if(o.client_signature_data){r>O-50&&(a.addPage(),r=l);const c=32,F=p-l*2;a.setFillColor(240,253,244),a.roundedRect(l,r,F,c,3,3,"F"),a.setFillColor(16,185,129),a.rect(l,r,4,c,"F"),a.setDrawColor(187,247,208),a.setLineWidth(.5),a.line(l+4,r,l+F,r);const T=l+14,q=r+c/2;a.setFillColor(16,185,129),a.circle(T,q,6,"F"),a.setFontSize(9),a.setTextColor(255,255,255),a.text("✓",T-2.5,q+3),a.setFontSize(9),a.setFont("helvetica","bold"),a.setTextColor(16,185,129),a.text("CLIENT VERIFIED",l+26,r+10);try{a.addImage(o.client_signature_data,"PNG",l+26,r+13,50,16);const E=o.client_signature_name||"Client",M=o.client_signature_title||"",L=o.client_signature_company||"",K=o.client_signature_date?se(o.client_signature_date):"",Y=l+85;a.setFont("helvetica","bold"),a.setFontSize(9),a.setTextColor(30,41,59),a.text(E,Y,r+12),a.setFont("helvetica","normal"),a.setFontSize(8),a.setTextColor(71,85,105),(M||L)&&a.text(`${M}${M&&L?", ":""}${L}`,Y,r+18),K&&(a.setTextColor(100,116,139),a.text(`Verified: ${K}`,Y,r+24))}catch{const B=o.client_signature_name||"Client";a.setFont("helvetica","normal"),a.setFontSize(9),a.setTextColor(30,41,59),a.text(`Signed by: ${B}`,l+26,r+20)}r+=c+8}const n=a.internal.getNumberOfPages();for(let c=1;c<=n;c++){a.setPage(c);const F=O-10;a.setFontSize(8),a.setTextColor(150,150,150),a.text(`Generated on ${new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`,l,F),a.text(`Page ${c} of ${n}`,p-l,F,{align:"right"})}const k=`TM_Ticket_${se(o.work_date||o.ticket_date).replace(/\//g,"-")}${o.ce_pco_number?"_"+o.ce_pco_number:""}.pdf`;return a.save(k),{success:!0,fileName:k}}function ye({onSave:o,onClose:j,slot:S=1,documentType:y="cor",documentTitle:a="",signerName:p="",signerTitle:O="",signerCompany:l=""}){const r=I.useRef(null),[t,N]=I.useState(p),[P,n]=I.useState(O),[s,k]=I.useState(l),[c,F]=I.useState(!1),[T,q]=I.useState(!1),[R,B]=I.useState(!1),E=S===1?"GC Authorization":"Client Authorization",M=y==="cor"?"Change Order Request":"T&M Work Order";I.useEffect(()=>{const g=document.body.style.overflow,u=document.body.style.position,v=document.body.style.top,z=window.scrollY;return document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${z}px`,document.body.style.width="100%",()=>{document.body.style.overflow=g,document.body.style.position=u,document.body.style.top=v,document.body.style.width="",window.scrollTo(0,z)}},[]);const L=()=>{const g=r.current;return g?g.getContext("2d"):null},K=g=>{const u=r.current;if(!u)return{x:0,y:0};const v=u.getBoundingClientRect(),z=u.width/v.width,A=u.height/v.height,J=g.touches?.length?g.touches[0].clientX:g.clientX,U=g.touches?.length?g.touches[0].clientY:g.clientY;return{x:(J-v.left)*z,y:(U-v.top)*A}},Y=g=>{g.preventDefault();const u=L();if(!u)return;const{x:v,y:z}=K(g);u.beginPath(),u.moveTo(v,z),q(!0),F(!0)},w=g=>{if(!T)return;g.preventDefault();const u=L();if(!u)return;const{x:v,y:z}=K(g);u.lineTo(v,z),u.stroke()},ae=()=>{q(!1)},x=()=>{const g=r.current,u=L();!g||!u||(u.clearRect(0,0,g.width,g.height),F(!1))},G=g=>{if(!g)return;r.current=g;const u=g.getContext("2d");u.strokeStyle="#1e293b",u.lineWidth=2,u.lineCap="round",u.lineJoin="round"},H=c&&t.trim()&&R,V=()=>{if(!H)return;const g=r.current;if(!g)return;const u=g.toDataURL("image/png");o({signature:u,signerName:t.trim(),signerTitle:P.trim()||null,signerCompany:s.trim()||null,signedAt:new Date().toISOString()})};return e.jsx("div",{className:"modal-overlay",onClick:j,role:"dialog","aria-modal":"true","aria-labelledby":"signature-title",children:e.jsxs("div",{className:"modal-content signature-modal enhanced",onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("div",{className:"signature-header-info",children:[e.jsx("h2",{id:"signature-title",children:E}),a&&e.jsx("span",{className:"signature-doc-ref",children:a})]}),e.jsx("button",{className:"close-btn",onClick:j,"aria-label":"Close signature modal",children:e.jsx(Pe,{size:20,"aria-hidden":"true"})})]}),e.jsxs("div",{className:"modal-body signature-body",children:[e.jsxs("div",{className:"signature-slot-badge",children:[e.jsx(De,{size:14}),e.jsxs("span",{children:["Signature ",S," of 2"]})]}),e.jsxs("div",{className:"signature-fields",children:[e.jsxs("div",{className:"form-group required",children:[e.jsx("label",{htmlFor:"signer-name",children:"Print Name"}),e.jsx("input",{id:"signer-name",type:"text",value:t,onChange:g=>N(g.target.value),placeholder:"Enter your full legal name","aria-required":"true",className:"input-required"})]}),e.jsxs("div",{className:"signature-fields-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-title",children:"Title"}),e.jsx("input",{id:"signer-title",type:"text",value:P,onChange:g=>n(g.target.value),placeholder:"e.g., Project Manager"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"signer-company",children:"Company"}),e.jsx("input",{id:"signer-company",type:"text",value:s,onChange:g=>k(g.target.value),placeholder:"e.g., ABC Construction"})]})]})]}),e.jsxs("div",{className:"signature-area",children:[e.jsxs("div",{className:"signature-label",id:"signature-instructions",children:[e.jsx(Ie,{size:16,"aria-hidden":"true"}),e.jsx("span",{children:"Draw your signature below"})]}),e.jsxs("div",{className:"signature-canvas-container",children:[e.jsx("canvas",{ref:G,width:500,height:180,className:"signature-canvas",onMouseDown:Y,onMouseMove:w,onMouseUp:ae,onMouseLeave:ae,onTouchStart:Y,onTouchMove:w,onTouchEnd:ae,role:"img","aria-label":"Signature drawing area. Use mouse or touch to draw your signature.","aria-describedby":"signature-instructions",tabIndex:0}),!c&&e.jsx("div",{className:"signature-placeholder",children:"Sign here"})]}),e.jsxs("button",{className:"btn btn-ghost btn-small",onClick:x,disabled:!c,"aria-label":"Clear signature",children:[e.jsx($e,{size:14,"aria-hidden":"true"})," Clear"]})]}),e.jsx("div",{className:"signature-acknowledgment",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:g=>B(g.target.checked)}),e.jsxs("span",{children:["I acknowledge that this electronic signature is legally binding and that I have reviewed and approve this ",M,". I understand that my signature, name, and IP address will be recorded for verification purposes."]})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:j,"aria-label":"Cancel and close",children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:V,disabled:!H,"aria-label":"Submit signature",children:[e.jsx(Re,{size:16,"aria-hidden":"true"})," Submit Signature"]})]})]})})}const oe=o=>o?new Date(o).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",ie=o=>{if(!o)return"";const[j,S]=o.split(":"),y=parseInt(j),a=y>=12?"pm":"am";return`${y%12||12}:${S}${a}`},We=({status:o})=>{const j={draft:{label:"Draft",color:"#6b7280",bg:"#f3f4f6"},pending_approval:{label:"Pending Approval",color:"#d97706",bg:"#fef3c7"},approved:{label:"Approved",color:"#059669",bg:"#d1fae5"},rejected:{label:"Rejected",color:"#dc2626",bg:"#fee2e2"},billed:{label:"Billed",color:"#2563eb",bg:"#dbeafe"},closed:{label:"Closed",color:"#4b5563",bg:"#e5e7eb"}},S=j[o]||j.draft;return e.jsx("span",{className:"cor-status-badge",style:{color:S.color,backgroundColor:S.bg},children:S.label})};function Je({signatureToken:o}){const[j,S]=I.useState(!0),[y,a]=I.useState(null),[p,O]=I.useState(null),[l,r]=I.useState(null),[t,N]=I.useState(!1),[P,n]=I.useState(null),[s,k]=I.useState(!1),[c,F]=I.useState(null),[T,q]=I.useState(!1),[R,B]=I.useState([]),[E,M]=I.useState(!1),[L,K]=I.useState(new Set);I.useEffect(()=>{Y()},[o]);const Y=async()=>{try{S(!0),a(null);const i=await re.getSignatureRequestByToken(o);if(!i){a("This signature link is invalid or has expired.");return}if(i.status==="completed"){a("This document has already been fully signed.");return}if(i.status==="revoked"){a("This signature link has been revoked.");return}if(i.status==="expired"){a("This signature link has expired.");return}O(i);const f=await re.getDocumentForSigning(i.document_type,i.document_id);if(!f){a("The document associated with this link could not be found.");return}if(r(f),i.document_type==="cor"&&f?.id)try{const _=await re.getCORTickets(f.id);B(_||[])}catch(_){console.warn("Failed to load backup tickets:",_)}}catch(i){console.error("Error loading signature data:",i),a("Unable to load signature request. Please try again.")}finally{S(!1)}},w=I.useMemo(()=>!l||p?.document_type!=="cor"?null:Te(l),[l,p]),ae=()=>{if(!p)return{slot1:null,slot2:null,availableSlots:[]};const i=p.signatures||[],f=i.find(d=>d.signature_slot===1),_=i.find(d=>d.signature_slot===2),h=[];return f||h.push(1),_||h.push(2),{slot1:f,slot2:_,availableSlots:h}},x=async()=>{try{return(await(await fetch("https://api.ipify.org?format=json")).json()).ip}catch{return null}},G=async i=>{if(!(!p||!P))try{k(!0);const f=await x(),_=await re.addSignature(p.id,P,{...i,ipAddress:f,userAgent:navigator.userAgent});await re.syncSignatureToDocument(_,p),await Y(),N(!1),n(null),F("signed")}catch(f){console.error("Error submitting signature:",f),a("Failed to submit signature. Please try again.")}finally{k(!1)}},H=i=>{n(i),N(!0)},V=async()=>{if(!(!l||!p))try{q(!0);let i=null;if(J)try{i=await re.getCORTickets(l.id)}catch(_){console.warn("Failed to fetch T&M tickets for backup:",_)}const f={logoUrl:U?.logo_url,primaryColor:U?.branding_color};await Ue(l,m,U,f,i),F("PDF downloaded successfully!"),setTimeout(()=>F(null),3e3)}catch(i){console.error("Download failed:",i),a("Failed to generate PDF. Please try again.")}finally{q(!1)}},g=async()=>{if(!(!l||!p))try{q(!0);const i=l?.projects?.companies,f=l?.projects,_={logoUrl:i?.logo_url,primaryColor:i?.branding_color};await He(l,f,i,_),F("PDF downloaded successfully!"),setTimeout(()=>F(null),3e3)}catch(i){console.error("Download failed:",i),a("Failed to generate PDF. Please try again.")}finally{q(!1)}};if(j)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Loading document..."})]})});if(y)return e.jsx("div",{className:"signature-page",children:e.jsxs("div",{className:"signature-page-error",children:[e.jsx(pe,{size:48}),e.jsx("h2",{children:"Unable to Load Document"}),e.jsx("p",{children:y})]})});const{slot1:u,slot2:v,availableSlots:z}=ae(),A=u||v,J=p?.document_type==="cor",U=l?.projects?.companies,m=l?.projects;if(!J){const i=l.t_and_m_workers?.length||0,f=l.t_and_m_workers?.reduce((_,h)=>_+(h.hours||0),0)||0;return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[U?.logo_url?e.jsx("img",{src:U.logo_url,alt:U.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(je,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:U?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"T&M Ticket Signature"})]})]}),c==="signed"&&e.jsx("div",{className:"signature-signed-overlay",children:e.jsxs("div",{className:"signature-signed-content",children:[e.jsx(Z,{size:48}),e.jsx("h2",{children:"Document Signed Successfully"}),e.jsx("p",{children:"This document has been signed and submitted."}),e.jsx("button",{className:"btn btn-primary download-copy-btn",onClick:g,disabled:T,children:T?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"btn-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{size:18}),"Save a Copy for Your Records"]})}),e.jsx("p",{className:"close-prompt",children:"You may close this page when done."})]})}),e.jsxs("main",{className:"signature-page-content",children:[e.jsxs("div",{className:"signature-document-card",children:[e.jsxs("div",{className:"document-card-header",children:[e.jsx(_e,{size:20}),e.jsxs("div",{className:"document-card-title",children:[e.jsx("h2",{children:"T&M Ticket"}),e.jsx("span",{className:"document-subtitle",children:l.ce_pco_number?`CE/PCO: ${l.ce_pco_number}`:"Time & Materials"})]})]}),e.jsxs("div",{className:"document-card-details",children:[e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Project"}),e.jsx("span",{className:"detail-value",children:m?.name})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Work Date"}),e.jsx("span",{className:"detail-value",children:oe(l.work_date)})]}),e.jsxs("div",{className:"detail-row",children:[e.jsx("span",{className:"detail-label",children:"Workers"}),e.jsxs("span",{className:"detail-value",children:[i," (",f," hrs)"]})]}),l.notes&&e.jsxs("div",{className:"detail-row full-width",children:[e.jsx("span",{className:"detail-label",children:"Description"}),e.jsx("span",{className:"detail-value",children:l.notes})]})]}),l.t_and_m_workers?.length>0&&e.jsxs("div",{className:"signature-detail-section",children:[e.jsxs("h4",{children:[e.jsx(be,{size:16})," Workers"]}),e.jsxs("table",{className:"signature-detail-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Time"}),e.jsx("th",{children:"Reg Hrs"}),e.jsx("th",{children:"OT"})]})}),e.jsx("tbody",{children:l.t_and_m_workers.map((_,h)=>e.jsxs("tr",{children:[e.jsx("td",{children:_.name}),e.jsx("td",{children:_.role||"Laborer"}),e.jsx("td",{children:_.time_started&&_.time_ended?`${ie(_.time_started)} - ${ie(_.time_ended)}`:"-"}),e.jsx("td",{children:_.hours||0}),e.jsx("td",{children:_.overtime_hours||"-"})]},h))})]})]}),l.t_and_m_items?.length>0&&e.jsxs("div",{className:"signature-detail-section",children:[e.jsxs("h4",{children:[e.jsx(ue,{size:16})," Materials & Equipment"]}),e.jsxs("table",{className:"signature-detail-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"})]})}),e.jsx("tbody",{children:l.t_and_m_items.map((_,h)=>e.jsxs("tr",{children:[e.jsx("td",{children:_.custom_name||_.materials_equipment?.name||"Item"}),e.jsx("td",{children:_.quantity}),e.jsx("td",{children:_.materials_equipment?.unit||"each"})]},h))})]})]}),l.photos?.length>0&&e.jsxs("div",{className:"signature-detail-section",children:[e.jsxs("h4",{children:[e.jsx(fe,{size:16})," Photos (",l.photos.length,")"]}),e.jsx("div",{className:"signature-photo-grid",children:l.photos.map((_,h)=>e.jsx("div",{className:"signature-photo-thumb",children:e.jsx("img",{src:typeof _=="string"?_:_.url,alt:`Photo ${h+1}`,onError:d=>{d.target.style.display="none"}})},h))})]})]}),e.jsxs("div",{className:"signature-status-section",children:[e.jsx("h3",{children:"Signature"}),A?e.jsxs(e.Fragment,{children:[u&&ce(1,u,"GC Authorization",H,s),v&&ce(2,v,"Client Authorization",H,s)]}):e.jsxs(e.Fragment,{children:[ce(1,u,"GC Authorization",H,s),!u&&e.jsx("p",{className:"or-divider",children:"— or —"}),ce(2,v,"Client Authorization",H,s)]}),A&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(Z,{size:24}),e.jsx("p",{children:"This document has been signed."})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),t&&P&&e.jsx(ye,{slot:P,documentType:"tm_ticket",documentTitle:"T&M Ticket",onSave:G,onClose:()=>{N(!1),n(null)}})]})}return e.jsxs("div",{className:"signature-page",children:[e.jsxs("header",{className:"signature-page-header",children:[U?.logo_url?e.jsx("img",{src:U.logo_url,alt:U.name,className:"company-logo"}):e.jsx("div",{className:"company-logo-placeholder",children:e.jsx(je,{size:24})}),e.jsxs("div",{className:"company-info",children:[e.jsx("h1",{children:U?.name||"FieldSync"}),e.jsx("span",{className:"doc-type-label",children:"Change Order Request"})]})]}),c==="signed"&&e.jsx("div",{className:"signature-signed-overlay",children:e.jsxs("div",{className:"signature-signed-content",children:[e.jsx(Z,{size:48}),e.jsx("h2",{children:"Document Signed Successfully"}),e.jsx("p",{children:"This document has been signed and submitted."}),e.jsx("button",{className:"btn btn-primary download-copy-btn",onClick:V,disabled:T,children:T?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"btn-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{size:18}),"Save a Copy for Your Records"]})}),e.jsx("p",{className:"close-prompt",children:"You may close this page when done."})]})}),e.jsxs("main",{className:"signature-page-content cor-full-document",children:[e.jsxs("div",{className:"cor-header-card",children:[e.jsxs("div",{className:"cor-header-top",children:[e.jsxs("div",{className:"cor-title-section",children:[e.jsx("h2",{className:"cor-number",children:l.cor_number}),e.jsx(We,{status:l.status})]}),e.jsxs("div",{className:"cor-date",children:["Created ",oe(l.created_at)]})]}),e.jsx("h3",{className:"cor-title",children:l.title||"Untitled Change Order"}),e.jsxs("div",{className:"cor-info-grid",children:[e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Project"}),e.jsx("span",{className:"cor-info-value",children:m?.name})]}),m?.job_number&&e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Job #"}),e.jsx("span",{className:"cor-info-value",children:m.job_number})]}),e.jsxs("div",{className:"cor-info-item",children:[e.jsx("span",{className:"cor-info-label",children:"Period"}),e.jsx("span",{className:"cor-info-value",children:we(l.period_start,l.period_end)})]})]}),l.scope_of_work&&e.jsxs("div",{className:"cor-scope",children:[e.jsx("h4",{children:"Scope of Work"}),e.jsx("p",{children:l.scope_of_work})]})]}),l.change_order_labor?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Oe,{size:18}),e.jsx("h4",{children:"Labor"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Class"}),e.jsx("th",{children:"Type"}),e.jsx("th",{className:"text-right",children:"Reg Hrs"}),e.jsx("th",{className:"text-right",children:"Reg Rate"}),e.jsx("th",{className:"text-right",children:"OT Hrs"}),e.jsx("th",{className:"text-right",children:"OT Rate"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:l.change_order_labor.map((i,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.labor_class}),e.jsx("td",{children:i.wage_type}),e.jsx("td",{className:"text-right",children:i.regular_hours}),e.jsxs("td",{className:"text-right",children:["$",le(i.regular_rate),"/hr"]}),e.jsx("td",{className:"text-right",children:i.overtime_hours||"-"}),e.jsx("td",{className:"text-right",children:i.overtime_hours?`$${le(i.overtime_rate)}/hr`:"-"}),e.jsx("td",{className:"text-right",children:b(i.total)})]},f))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"5",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.labor_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"5",className:"text-right",children:["+ ",W(l.labor_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.labor_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"5",className:"text-right",children:e.jsx("strong",{children:"Labor Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:b(w.labor_subtotal+w.labor_markup_amount)})})]})]})]})})]}),l.change_order_materials?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(ue,{size:18}),e.jsx("h4",{children:"Materials"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:l.change_order_materials.map((i,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.description}),e.jsx("td",{children:i.source_reference||i.source_type}),e.jsx("td",{className:"text-right",children:i.quantity}),e.jsx("td",{children:i.unit}),e.jsxs("td",{className:"text-right",children:["$",le(i.unit_cost)]}),e.jsx("td",{className:"text-right",children:b(i.total)})]},f))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.materials_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",W(l.materials_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.materials_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Materials Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:b(w.materials_subtotal+w.materials_markup_amount)})})]})]})]})})]}),l.change_order_equipment?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Ae,{size:18}),e.jsx("h4",{children:"Equipment"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{className:"text-right",children:"Unit Cost"}),e.jsx("th",{className:"text-right",children:"Total"})]})}),e.jsx("tbody",{children:l.change_order_equipment.map((i,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.description}),e.jsx("td",{children:i.source_reference||i.source_type}),e.jsx("td",{className:"text-right",children:i.quantity}),e.jsx("td",{children:i.unit}),e.jsxs("td",{className:"text-right",children:["$",le(i.unit_cost)]}),e.jsx("td",{className:"text-right",children:b(i.total)})]},f))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.equipment_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"4",className:"text-right",children:["+ ",W(l.equipment_markup_percent||1500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.equipment_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"4",className:"text-right",children:e.jsx("strong",{children:"Equipment Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:b(w.equipment_subtotal+w.equipment_markup_amount)})})]})]})]})})]}),l.change_order_subcontractors?.length>0&&e.jsxs("div",{className:"cor-section",children:[e.jsxs("div",{className:"cor-section-header",children:[e.jsx(Ee,{size:18}),e.jsx("h4",{children:"Subcontractors"})]}),e.jsx("div",{className:"cor-table-wrapper",children:e.jsxs("table",{className:"cor-line-items-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Company"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Source"}),e.jsx("th",{className:"text-right",children:"Amount"})]})}),e.jsx("tbody",{children:l.change_order_subcontractors.map((i,f)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.company_name}),e.jsx("td",{children:i.description}),e.jsx("td",{children:i.source_reference||i.source_type}),e.jsx("td",{className:"text-right",children:b(i.total)})]},f))}),e.jsxs("tfoot",{children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2",className:"text-right",children:"Subtotal:"}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.subcontractors_subtotal)})]}),e.jsxs("tr",{className:"markup-row",children:[e.jsxs("td",{colSpan:"2",className:"text-right",children:["+ ",W(l.subcontractors_markup_percent||500)," Markup:"]}),e.jsx("td",{className:"text-right",colSpan:"2",children:b(w.subcontractors_markup_amount)})]}),e.jsxs("tr",{className:"section-total-row",children:[e.jsx("td",{colSpan:"2",className:"text-right",children:e.jsx("strong",{children:"Subcontractors Total:"})}),e.jsx("td",{className:"text-right",colSpan:"2",children:e.jsx("strong",{children:b(w.subcontractors_subtotal+w.subcontractors_markup_amount)})})]})]})]})})]}),R.length>0&&(()=>{const i=R.reduce((d,D)=>d+(D.t_and_m_workers?.reduce((X,ee)=>X+(parseFloat(ee.hours)||0),0)||0),0),f=R.reduce((d,D)=>d+(D.t_and_m_workers?.reduce((X,ee)=>X+(parseFloat(ee.overtime_hours)||0),0)||0),0),_=R.reduce((d,D)=>d+(D.photos?.length||0),0),h=R.filter(d=>d.client_signature_data).length;return e.jsxs("div",{className:"cor-section cor-backup-section",children:[e.jsxs("div",{className:"backup-official-header",children:[e.jsxs("div",{className:"backup-official-badge",children:[e.jsx(_e,{size:16}),e.jsx("span",{children:"Supporting Documentation"})]}),e.jsxs("div",{className:"backup-summary-bar",children:[e.jsxs("div",{className:"backup-stat",children:[e.jsx("span",{className:"backup-stat-value",children:R.length}),e.jsx("span",{className:"backup-stat-label",children:"Tickets"})]}),e.jsxs("div",{className:"backup-stat",children:[e.jsx("span",{className:"backup-stat-value",children:i.toFixed(1)}),e.jsx("span",{className:"backup-stat-label",children:"Labor Hrs"})]}),f>0&&e.jsxs("div",{className:"backup-stat",children:[e.jsx("span",{className:"backup-stat-value",children:f.toFixed(1)}),e.jsx("span",{className:"backup-stat-label",children:"OT Hrs"})]}),e.jsxs("div",{className:"backup-stat",children:[e.jsx("span",{className:"backup-stat-value",children:_}),e.jsx("span",{className:"backup-stat-label",children:"Photos"})]}),h>0&&e.jsxs("div",{className:"backup-stat verified",children:[e.jsx("span",{className:"backup-stat-value",children:h}),e.jsx("span",{className:"backup-stat-label",children:"Verified"})]})]})]}),e.jsxs("div",{className:"cor-section-header cor-backup-header",onClick:()=>M(!E),style:{cursor:"pointer",marginBottom:E?"1rem":0},children:[e.jsx("div",{className:"backup-header-left",children:e.jsx("span",{children:"View All T&M Tickets"})}),e.jsx("div",{className:"backup-header-toggle",children:E?e.jsx(Ne,{size:20}):e.jsx(ve,{size:20})})]}),E&&e.jsx("div",{className:"backup-tickets-list",style:{padding:"0 0.5rem"},children:R.map(d=>{const D=L.has(d.id),X=d.t_and_m_workers?.reduce((C,$)=>C+(parseFloat($.hours)||0),0)||0,ee=d.t_and_m_workers?.reduce((C,$)=>C+(parseFloat($.overtime_hours)||0),0)||0,Q=!!d.client_signature_data;return e.jsxs("div",{className:"backup-ticket-pro","data-verified":Q,"data-status":d.status||"pending",children:[e.jsxs("div",{className:"ticket-pro-header",onClick:()=>{const C=new Set(L);D?C.delete(d.id):C.add(d.id),K(C)},style:{cursor:"pointer"},children:[e.jsxs("div",{className:"ticket-date-badge",children:[e.jsx(Me,{size:14}),e.jsx("span",{children:oe(d.work_date)})]}),d.ce_pco_number&&e.jsx("span",{className:"ticket-pco-badge",children:d.ce_pco_number}),Q&&e.jsxs("span",{className:"ticket-verified-seal",children:[e.jsx(Z,{size:12})," Verified"]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-muted)"},children:[d.t_and_m_workers?.length||0," workers • ",X+ee," hrs"]}),D?e.jsx(Ne,{size:16}):e.jsx(ve,{size:16})]})]}),D&&e.jsxs("div",{className:"ticket-pro-body",children:[d.notes&&e.jsx("div",{className:"ticket-description-box",children:e.jsx("p",{children:d.notes})}),d.t_and_m_workers?.length>0&&e.jsxs("div",{className:"ticket-section-pro",children:[e.jsxs("div",{className:"ticket-section-header",children:[e.jsx(be,{size:14}),e.jsx("span",{children:"Labor"}),e.jsxs("span",{className:"section-count",children:[X+ee," hrs total"]})]}),e.jsx("div",{className:"worker-pro-grid",children:d.t_and_m_workers.map((C,$)=>e.jsxs("div",{className:"worker-pro-row",children:[e.jsxs("div",{children:[e.jsx("span",{className:"worker-name",children:C.name}),C.role&&e.jsxs("span",{className:"worker-role",children:[" • ",C.role]})]}),e.jsx("span",{className:"worker-time",children:C.time_started&&C.time_ended?`${ie(C.time_started)} - ${ie(C.time_ended)}`:"-"}),e.jsxs("span",{className:"worker-hours",children:[C.hours||0," hrs"]}),e.jsx("span",{className:"worker-ot",children:parseFloat(C.overtime_hours)>0?`+${C.overtime_hours} OT`:"-"})]},$))})]}),d.t_and_m_items?.length>0&&e.jsxs("div",{className:"ticket-section-pro",children:[e.jsxs("div",{className:"ticket-section-header",children:[e.jsx(ue,{size:14}),e.jsx("span",{children:"Materials / Equipment"}),e.jsxs("span",{className:"section-count",children:[d.t_and_m_items.length," items"]})]}),e.jsx("div",{className:"materials-pro-list",children:d.t_and_m_items.map((C,$)=>e.jsxs("div",{className:"material-pro-row",children:[e.jsx("span",{className:"material-name",children:C.materials_equipment?.name||C.description||"Item"}),e.jsxs("span",{className:"material-qty",children:[C.quantity||1," ",C.materials_equipment?.unit||"ea"]}),e.jsx("span",{className:"material-source",children:"T&M Ticket"})]},$))})]}),d.photos?.length>0&&e.jsxs("div",{className:"ticket-section-pro",children:[e.jsxs("div",{className:"ticket-section-header",children:[e.jsx(fe,{size:14}),e.jsx("span",{children:"Photo Evidence"}),e.jsx("span",{className:"section-count",children:d.photos.length})]}),e.jsx("div",{className:"photo-evidence-grid",children:d.photos.map((C,$)=>e.jsx("a",{href:C,target:"_blank",rel:"noopener noreferrer",className:"photo-evidence-item",children:e.jsx("img",{src:C,alt:`Evidence ${$+1}`,onError:te=>{te.target.onerror=null,te.target.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMiI+PHJlY3QgeD0iMyIgeT0iMyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiByeD0iMiIvPjxjaXJjbGUgY3g9IjguNSIgY3k9IjguNSIgcj0iMS41Ii8+PHBvbHlsaW5lIHBvaW50cz0iMjEgMTUgMTYgMTAgNSAyMSIvPjwvc3ZnPg=="}})},$))})]}),Q&&e.jsxs("div",{className:"ticket-verification-footer",children:[e.jsx("div",{className:"verification-seal-icon",children:e.jsx(Z,{size:22})}),d.client_signature_data&&e.jsx("img",{src:d.client_signature_data,alt:"Client Signature",className:"verification-signature-img"}),e.jsxs("div",{className:"verification-info",children:[e.jsx("span",{className:"signer-name",children:d.client_signature_name||"Client"}),(d.client_signature_title||d.client_signature_company)&&e.jsx("span",{className:"signer-title",children:[d.client_signature_title,d.client_signature_company].filter(Boolean).join(", ")}),d.client_signature_date&&e.jsxs("span",{className:"verify-date",children:["Verified ",oe(d.client_signature_date)]})]})]})]})]},d.id)})}),e.jsxs("div",{className:"backup-note",children:[e.jsx(pe,{size:14}),e.jsx("span",{children:"This documentation supports the work described in this Change Order Request."})]})]})})(),e.jsxs("div",{className:"cor-totals-card",children:[e.jsx("h4",{children:"COR Summary"}),e.jsxs("div",{className:"cor-totals-grid",children:[e.jsxs("div",{className:"cor-total-row",children:[e.jsx("span",{children:"COR Subtotal"}),e.jsx("span",{children:b(w.cor_subtotal)})]}),e.jsxs("div",{className:"cor-fees-section",children:[e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Liability Insurance (",W(l.liability_insurance_percent||144),")"]}),e.jsx("span",{children:b(w.liability_insurance_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["Bond (",W(l.bond_percent||100),")"]}),e.jsx("span",{children:b(w.bond_amount)})]}),e.jsxs("div",{className:"cor-fee-row",children:[e.jsxs("span",{children:["City License Fee (",W(l.license_fee_percent||10),")"]}),e.jsx("span",{children:b(w.license_fee_amount)})]})]}),e.jsxs("div",{className:"cor-grand-total",children:[e.jsx("span",{children:"COR TOTAL"}),e.jsx("span",{children:b(w.cor_total)})]})]})]}),e.jsxs("div",{className:"cor-signature-section",children:[e.jsx("h4",{children:"Authorization"}),e.jsx("p",{className:"signature-instruction",children:"By signing below, you authorize the above change order request and agree to the terms and costs outlined."}),e.jsx("div",{className:"signature-slots-grid",children:A?e.jsxs(e.Fragment,{children:[u&&e.jsxs("div",{className:"signature-slot-card signed",children:[e.jsxs("div",{className:"slot-header",children:[e.jsx(Z,{size:20,className:"status-icon signed"}),e.jsx("span",{className:"slot-label",children:"GC Authorization"})]}),e.jsxs("div",{className:"slot-signed-info",children:[u.signature_data&&e.jsx("img",{src:u.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:u.signer_name}),(u.signer_title||u.signer_company)&&e.jsxs("span",{className:"signer-org",children:[u.signer_title,u.signer_title&&u.signer_company&&" — ",u.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",oe(u.signed_at)]})]})]}),v&&e.jsxs("div",{className:"signature-slot-card signed",children:[e.jsxs("div",{className:"slot-header",children:[e.jsx(Z,{size:20,className:"status-icon signed"}),e.jsx("span",{className:"slot-label",children:"Client Authorization"})]}),e.jsxs("div",{className:"slot-signed-info",children:[v.signature_data&&e.jsx("img",{src:v.signature_data,alt:"Signature",className:"signature-image"}),e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:v.signer_name}),(v.signer_title||v.signer_company)&&e.jsxs("span",{className:"signer-org",children:[v.signer_title,v.signer_title&&v.signer_company&&" — ",v.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",oe(v.signed_at)]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`signature-slot-card ${u?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[u?e.jsx(Z,{size:20,className:"status-icon signed"}):e.jsx(me,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"GC Authorization"})]}),e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>H(1),disabled:s,children:"Sign as GC"})]}),e.jsx("p",{className:"or-divider",children:"— or —"}),e.jsxs("div",{className:`signature-slot-card ${v?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[v?e.jsx(Z,{size:20,className:"status-icon signed"}):e.jsx(me,{size:20,className:"status-icon pending"}),e.jsx("span",{className:"slot-label",children:"Client Authorization"})]}),e.jsx("button",{className:"btn btn-primary sign-btn",onClick:()=>H(2),disabled:s,children:"Sign as Client"})]})]})}),A&&e.jsxs("div",{className:"fully-signed-message",children:[e.jsx(Z,{size:24}),e.jsx("p",{children:"This change order request has been signed."})]}),e.jsxs("div",{className:"cor-download-section",children:[e.jsx("h4",{children:"Download Your Copy"}),e.jsx("p",{className:"download-description",children:A?"Download a PDF copy of this fully signed COR including all T&M backup documentation.":"Download a PDF copy of this COR for your records. Signature status will be included."}),e.jsx("button",{className:"btn btn-primary download-btn",onClick:V,disabled:T,children:T?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"download-spinner"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{size:18}),"Download COR + Backup"]})})]})]})]}),e.jsx("footer",{className:"signature-page-footer",children:e.jsx("p",{children:"Powered by FieldSync"})}),t&&P&&e.jsx(ye,{slot:P,documentType:p.document_type,documentTitle:`${l.cor_number} - ${l.title}`,onSave:G,onClose:()=>{N(!1),n(null)}})]})}function ce(o,j,S,y,a){return e.jsxs("div",{className:`signature-slot-card ${j?"signed":"unsigned"}`,children:[e.jsxs("div",{className:"slot-header",children:[j?e.jsx(Z,{size:20,className:"status-icon signed"}):e.jsx(me,{size:20,className:"status-icon pending"}),e.jsxs("span",{className:"slot-label",children:["Signature ",o," — ",S]})]}),j?e.jsxs("div",{className:"slot-signed-info",children:[e.jsxs("div",{className:"signer-details",children:[e.jsx("span",{className:"signer-name",children:j.signer_name}),(j.signer_title||j.signer_company)&&e.jsxs("span",{className:"signer-org",children:[j.signer_title,j.signer_title&&j.signer_company&&" — ",j.signer_company]})]}),e.jsxs("span",{className:"signed-date",children:["Signed ",oe(j.signed_at)]})]}):e.jsxs("button",{className:"btn btn-primary sign-btn",onClick:()=>y(o),disabled:a,children:["Sign as ",o===1?"GC":"Client"]})]})}export{Je as default};
//# sourceMappingURL=SignaturePage-wbnErRtC.js.map
